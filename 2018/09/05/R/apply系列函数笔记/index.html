<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="前言 R语言中的for循环通常比较慢，一般情况下不采用for循环，而是采用其它的实现方式，即使用apply系列函数。 apply系列函数的构成 apply系列函数包括apply，sapply，lapply等。它们的使用范围如下所示：     apply() apply函数的使用格式如下所示： 1apply(X, MARGIN, FUN, ...) 其中X是一个矩阵或数组；MA">
<meta property="og:type" content="article">
<meta property="og:title" content="apply系列函数笔记">
<meta property="og:url" content="http://rvdsd.top/2018/09/05/R/apply系列函数笔记/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:description" content="前言 R语言中的for循环通常比较慢，一般情况下不采用for循环，而是采用其它的实现方式，即使用apply系列函数。 apply系列函数的构成 apply系列函数包括apply，sapply，lapply等。它们的使用范围如下所示：     apply() apply函数的使用格式如下所示： 1apply(X, MARGIN, FUN, ...) 其中X是一个矩阵或数组；MA">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190605161239.png">
<meta property="og:updated_time" content="2019-07-05T02:08:55.930Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="apply系列函数笔记">
<meta name="twitter:description" content="前言 R语言中的for循环通常比较慢，一般情况下不采用for循环，而是采用其它的实现方式，即使用apply系列函数。 apply系列函数的构成 apply系列函数包括apply，sapply，lapply等。它们的使用范围如下所示：     apply() apply函数的使用格式如下所示： 1apply(X, MARGIN, FUN, ...) 其中X是一个矩阵或数组；MA">
<meta name="twitter:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190605161239.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/2018/09/05/R/apply系列函数笔记/"/>





  <title>apply系列函数笔记 | RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/09/05/R/apply系列函数笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">apply系列函数笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-05T12:00:00+08:00">
                2018-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,008
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言">前言</h2>
<p>R语言中的for循环通常比较慢，一般情况下不采用for循环，而是采用其它的实现方式，即使用apply系列函数。</p>
<h2 id="apply系列函数的构成">apply系列函数的构成</h2>
<p>apply系列函数包括<code>apply</code>，<code>sapply</code>，<code>lapply</code>等。它们的使用范围如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190605161239.png">

</div>
<h2 id="apply">apply()</h2>
<p>apply函数的使用格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apply(X, MARGIN, FUN, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中<code>X</code>是一个矩阵或数组；<code>MARGIN</code>是1或2，其中1表示对行使用函数，2表示对列使用函数；<code>FUN</code>是函数，<code>...</code>是f的可选参数，现在看一下使用案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">x &lt;- cbind(x1 = <span class="number">3</span>, x2 = c(<span class="number">4</span>:<span class="number">1</span>, <span class="number">2</span>:<span class="number">5</span>))</div><div class="line">x</div><div class="line"><span class="comment"># x1 x2</span></div><div class="line"><span class="comment"># [1,]  3  4</span></div><div class="line"><span class="comment"># [2,]  3  3</span></div><div class="line"><span class="comment"># [3,]  3  2</span></div><div class="line"><span class="comment"># [4,]  3  1</span></div><div class="line"><span class="comment"># [5,]  3  2</span></div><div class="line"><span class="comment"># [6,]  3  3</span></div><div class="line"><span class="comment"># [7,]  3  4</span></div><div class="line"><span class="comment"># [8,]  3  5</span></div><div class="line">dimnames(x)[[<span class="number">1</span>]] &lt;- letters[<span class="number">1</span>:<span class="number">8</span>]</div><div class="line">x</div><div class="line"><span class="comment"># x1 x2</span></div><div class="line"><span class="comment"># a  3  4</span></div><div class="line"><span class="comment"># b  3  3</span></div><div class="line"><span class="comment"># c  3  2</span></div><div class="line"><span class="comment"># d  3  1</span></div><div class="line"><span class="comment"># e  3  2</span></div><div class="line"><span class="comment"># f  3  3</span></div><div class="line"><span class="comment"># g  3  4</span></div><div class="line"><span class="comment"># h  3  5</span></div><div class="line">apply(x, <span class="number">2</span>, sd)</div><div class="line"><span class="comment"># 计算每1列的sd</span></div><div class="line"><span class="comment"># x1       x2 </span></div><div class="line"><span class="comment"># 0.000000 1.309307</span></div><div class="line"></div><div class="line">apply(x, <span class="number">2</span>, sum)</div><div class="line"><span class="comment"># 计算每1列的和</span></div><div class="line"><span class="comment"># x1 x2 </span></div><div class="line"><span class="comment"># 24 24 </span></div><div class="line"></div><div class="line">apply(x, <span class="number">1</span>, sum)</div><div class="line"><span class="comment"># 计算每一行的和</span></div><div class="line"><span class="comment"># a b c d e f g h </span></div><div class="line"><span class="comment"># 7 6 5 4 5 6 7 8 </span></div><div class="line"></div><div class="line">apply(x, <span class="number">2</span>, sort)</div><div class="line"><span class="comment"># 对列进行排序</span></div><div class="line"><span class="comment"># x1 x2</span></div><div class="line"><span class="comment"># [1,]  3  1</span></div><div class="line"><span class="comment"># [2,]  3  2</span></div><div class="line"><span class="comment"># [3,]  3  2</span></div><div class="line"><span class="comment"># [4,]  3  3</span></div><div class="line"><span class="comment"># [5,]  3  3</span></div><div class="line"><span class="comment"># [6,]  3  4</span></div><div class="line"><span class="comment"># [7,]  3  4</span></div><div class="line"><span class="comment"># [8,]  3  5</span></div></pre></td></tr></table></figure>
<p>再看一个案例，在下面的案例中，我们会创建一个矩阵，然后使用apply来计算这个矩阵的行或列的值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">counts &lt;- matrix(c(<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">1</span>), ncol = <span class="number">3</span>)</div><div class="line">colnames(counts) &lt;- c(<span class="string">'sparrow'</span>, <span class="string">'dove'</span>, <span class="string">'crow'</span>)</div><div class="line">counts</div><div class="line">apply(counts,<span class="number">2</span>,max)</div><div class="line">class(apply(counts,<span class="number">2</span>,max))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; counts &lt;- matrix(c(<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">1</span>), ncol = <span class="number">3</span>)</div><div class="line">&gt; colnames(counts) &lt;- c(<span class="string">'sparrow'</span>, <span class="string">'dove'</span>, <span class="string">'crow'</span>)</div><div class="line">&gt; counts</div><div class="line">     sparrow dove crow</div><div class="line">[<span class="number">1</span>,]       <span class="number">3</span>    <span class="number">6</span>    <span class="number">8</span></div><div class="line">[<span class="number">2</span>,]       <span class="number">2</span>    <span class="number">5</span>    <span class="number">6</span></div><div class="line">[<span class="number">3</span>,]       <span class="number">4</span>    <span class="number">1</span>    <span class="number">1</span></div><div class="line">&gt; apply(counts,<span class="number">2</span>,max)</div><div class="line">sparrow    dove    crow </div><div class="line">      <span class="number">4</span>       <span class="number">6</span>       <span class="number">8</span> </div><div class="line">&gt; class(apply(counts,<span class="number">2</span>,max))</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们创建了一个鸟类矩阵，第1列代表一个各类，第1行代表1天，我们计算了各类鸟在这3天中数量最多达到了多少，从结果中我们就可以发现，使用<code>apply</code>很容易就得到了想要的结果，这个结果中包含各个列中最大的数值，并以原列名作为向量值的名称，<code>apply</code>函数使用了到了3个参数，如下所示</p>
<ul>
<li>函数作用的对象，这里就是矩阵<code>counts</code>；</li>
<li>函数将作用的维度或索引，其中数字1表示行，2表示列。因此我们在上面的案例中使用了列作为函数的作用对象，我们就使用了2，除此之外，我们还有可能输入更多的参数，后面会提到。</li>
<li>执行函数的名称：我们求的每个列的最大值，因此使用了函数<code>max</code>，这个max可以使用引号，即<code>&quot;max&quot;</code>，也可以不加引号，即<code>max</code>。</li>
</ul>
<h3 id="传入更多参数">传入更多参数</h3>
<p>假设第2天没有出现鸽子(Dove)，那么就需要把counts矩阵中的对应位置改为NA，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">counts[<span class="number">2</span>,<span class="number">2</span>] &lt;- <span class="literal">NA</span></div><div class="line">counts</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; counts[<span class="number">2</span>,<span class="number">2</span>] &lt;- <span class="literal">NA</span></div><div class="line">&gt; counts</div><div class="line">     sparrow dove crow</div><div class="line">[<span class="number">1</span>,]       <span class="number">3</span>    <span class="number">6</span>    <span class="number">8</span></div><div class="line">[<span class="number">2</span>,]       <span class="number">2</span>   <span class="literal">NA</span>    <span class="number">6</span></div><div class="line">[<span class="number">3</span>,]       <span class="number">4</span>    <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>假设现在我们还使用max函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; apply(counts,<span class="number">2</span>,max)</div><div class="line">sparrow    dove    crow </div><div class="line">      <span class="number">4</span>      <span class="literal">NA</span>       <span class="number">8</span></div></pre></td></tr></table></figure>
<p>此时，出现了NA这个结果，这不是我们想要结果，因此我们需要向<code>apply()</code>函数传入更多的参数，这里就是传入<code>na.rm</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; apply(counts,<span class="number">2</span>,max, na.rm = <span class="literal">TRUE</span>)</div><div class="line">sparrow    dove    crow </div><div class="line">      <span class="number">4</span>       <span class="number">6</span>       <span class="number">8</span></div></pre></td></tr></table></figure>
<h2 id="sapply">sapply()</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sapply(X, FUN, <span class="keyword">...</span>, simplify = <span class="literal">TRUE</span>, USE.NAMES = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<ol style="list-style-type: decimal">
<li>第一个参数<code>X</code>是一个向量；</li>
<li>第二个参数<code>FUN</code>是目标函数的名称；</li>
</ol>
<h3 id="sapply案例1">sapply()案例1</h3>
<p><code>switch()</code>函数不能直接处理向量，但可以使用<code>sapply()</code>函数的特异将<code>switch()</code>作为目标函数来实现<code>switch()</code>的向量化，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; sapply(c(<span class="string">'a'</span>,<span class="string">'b'</span>),<span class="keyword">switch</span>,a=<span class="string">'Hello'</span>,b=<span class="string">'Goodbye'</span>)</div><div class="line">        a         b </div><div class="line">  <span class="string">"Hello"</span> <span class="string">"Goodbye"</span></div></pre></td></tr></table></figure>
<p>在这个案例中，<code>c('a','b')</code>是待处理的向量；<code>switch</code>是传入的目标函数，<code>a='Hello',b='Goodbye'</code>是传入<code>switch</code>函数的参数。</p>
<p>在这段代码中，<code>swtich</code>函数逐一对传入向量中的值<code>'a'</code>和<code>'b'</code>进行<code>switch</code>操作，并将后面的<code>a='Hello'</code>和<code>b='Goodbye'</code>作为参数传入<code>switch()</code>函数中。然后它将这两次调用的返回结果组成新的向量，并用传入的<code>c('a','b')</code>作为返回向量的值名称。</p>
<h3 id="sapply案例2">sapply()案例2</h3>
<p>计算数据集<code>iris</code>的平均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">head(iris)</div><div class="line">sapply(iris, mean)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; head(iris)</div><div class="line">  Sepal.Length Sepal.Width Petal.Length Petal.Width Species</div><div class="line"><span class="number">1</span>          <span class="number">5.1</span>         <span class="number">3.5</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">2</span>          <span class="number">4.9</span>         <span class="number">3.0</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">3</span>          <span class="number">4.7</span>         <span class="number">3.2</span>          <span class="number">1.3</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">4</span>          <span class="number">4.6</span>         <span class="number">3.1</span>          <span class="number">1.5</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">5</span>          <span class="number">5.0</span>         <span class="number">3.6</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">6</span>          <span class="number">5.4</span>         <span class="number">3.9</span>          <span class="number">1.7</span>         <span class="number">0.4</span>  setosa</div><div class="line">&gt; sapply(iris, mean)</div><div class="line">Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </div><div class="line">    <span class="number">5.843333</span>     <span class="number">3.057333</span>     <span class="number">3.758000</span>     <span class="number">1.199333</span>           <span class="literal">NA</span> </div><div class="line">Warning message:</div><div class="line">In mean.default(X[[i]], <span class="keyword">...</span>) : 参数不是数值也不是逻辑值：回覆<span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>R中出现了警告信息，这是因为<code>Species</code>不是一个数值列，因此可以编写一个函数放在<code>apply()</code>函数内部，检查参数的类型，如果是数值，返回均值，不是，返回<code>NA</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; sapply(iris, <span class="keyword">function</span>(x) ifelse(is.numeric(x), mean(x), <span class="literal">NA</span>))</div><div class="line">Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </div><div class="line">    <span class="number">5.843333</span>     <span class="number">3.057333</span>     <span class="number">3.758000</span>     <span class="number">1.199333</span>           <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>上面的<code>function(x) ifelse(is.numeric(x), mean(x), NA)</code>是匿名函数。</p>
<h3 id="switch函数"><code>switch()</code>函数</h3>
<p>此处复习一下<code>switch()</code>函数，这个函数从字面上理解就是<code>转换</code>的意思，它的语法为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span>(expr, list)</div></pre></td></tr></table></figure>
<p>其中<code>expr</code>是表达式，其值为一个<code>整数值</code>或<code>字符串</code>，<code>list</code>是一个列表。</p>
<p>如果<code>expr</code>的计算结果为整数，并且其值为<code>1-length(list)</code>之间，则<code>switch()</code>函数返回列表相应位置的值，如果<code>expr</code>的值超出范围，没有返回值，看如下案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">2</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">2</span>, <span class="string">"位置1"</span>,<span class="string">"位置2"</span>,<span class="string">"位置3"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"位置2"</span></div></pre></td></tr></table></figure>
<p><code>x</code>的值为2，<code>switch()</code>根据传入的2，输出列表中的<code>位置2</code>。</p>
<p>如果参数是字符串，可以看下面的案例；</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span>(<span class="string">"c"</span>, a=<span class="string">"位置1"</span>,b=<span class="string">"位置2"</span>,c=<span class="string">"位置3"</span>)</div></pre></td></tr></table></figure>
<h3 id="将函数应用于数据框">将函数应用于数据框</h3>
<p><code>sapply()</code>函数可以应用于列表和数据框，此时<code>sapply()</code>函数可以将列表中的每一个元素视为函数作用的对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">20</span>, <span class="number">110</span>, <span class="number">120</span>, <span class="number">23</span>),</div><div class="line">  type = c(<span class="string">"private"</span>,<span class="string">"public"</span>,<span class="string">"abroad"</span>,<span class="string">"other"</span>),</div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>, <span class="literal">FALSE</span>, <span class="literal">FALSE</span>)</div><div class="line">)</div><div class="line"></div><div class="line">str(clients)</div><div class="line">sapply(clients, class)</div><div class="line">class(sapply(clients, class))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; str(clients)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">4</span> obs. of  <span class="number">3</span> variables:</div><div class="line"> $ hours : num  <span class="number">20</span> <span class="number">110</span> <span class="number">120</span> <span class="number">23</span></div><div class="line"> $ type  : Factor w/ <span class="number">4</span> levels <span class="string">"abroad"</span>,<span class="string">"other"</span>,..: <span class="number">3</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"> $ public: logi  <span class="literal">TRUE</span> <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span></div><div class="line">&gt; sapply(clients, class)</div><div class="line">    hours      type    public </div><div class="line"><span class="string">"numeric"</span>  <span class="string">"factor"</span> <span class="string">"logical"</span> </div><div class="line">&gt; class(sapply(clients, class))</div><div class="line">[<span class="number">1</span>] <span class="string">"character"</span></div></pre></td></tr></table></figure>
<p>创建了一个数据框<code>clients</code>，<code>clients</code>中有3个变量，分别为<code>hours</code>，<code>type</code>，<code>public</code>，通过将<code>class()</code>函数传入<code>sapply()</code>，就查看了这3个变量的数据类型，其结果是一个向量形式。</p>
<h3 id="sapply结果的简化"><code>sapply()</code>结果的简化</h3>
<p><code>sapply()</code>函数的结果并非总是返回向量，它的标准返回类型是列表，但这个列表在必要的时候会被简化为<code>矩阵</code>或<code>向量</code>：</p>
<ul>
<li>如果目标函数处理完列表或向量的各个元素后，返回的结果都是一个数字，那么<code>sapply()</code>会将其简化为一个向量；</li>
<li>如果目标函数处理完列表或向量的各个元素后，返回的向量都具有相同的长度，那么结果为简化为一个矩阵；</li>
<li>其他的情况返回列表。</li>
</ul>
<p>例如要获取<code>clients</code>这个数据框中所有变量的唯一值，也就是说每个不同的值只出现一次（利用<code>unique()</code>函数），那么如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">20</span>, <span class="number">120</span>, <span class="number">120</span>, <span class="number">23</span>),</div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>,<span class="literal">TRUE</span>, <span class="literal">TRUE</span>))</div><div class="line"></div><div class="line">sapply(clients,unique)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sapply(clients,unique)</div><div class="line">$hours</div><div class="line">[<span class="number">1</span>]  <span class="number">20</span> <span class="number">120</span>  <span class="number">23</span></div><div class="line"></div><div class="line">$public</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p><code>sapply()</code>中有一个参数<code>simplify</code>，如果设为<code>simplify = FALSE</code>，结果就不会简化，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">20</span>, <span class="number">120</span>, <span class="number">120</span>, <span class="number">23</span>),</div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>,<span class="literal">TRUE</span>, <span class="literal">TRUE</span>))</div><div class="line"></div><div class="line">sapply(clients,class,simplify = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sapply(clients,class,simplify = <span class="literal">FALSE</span>)</div><div class="line">$hours</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line"></div><div class="line">$public</div><div class="line">[<span class="number">1</span>] <span class="string">"logical"</span></div></pre></td></tr></table></figure>
<h2 id="lapply">lapply()</h2>
<p><code>lapply()</code>函数的<code>l</code>表示<code>list</code>（列表），与<code>lapply()</code>函数类似的函数是<code>sapply()</code>，这个<code>s</code>表示<code>simplify</code>（简化）。<code>lapply()</code>返回的结果是列表，而<code>sapply()</code>返回的结果更加简化。</p>
<p><code>lapply()</code>函数的用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lapply(X, FUN, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<h3 id="lapply使用案例1"><code>lapply()</code>使用案例1</h3>
<p>用法直接看下面案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- list(a = <span class="number">1</span>:<span class="number">10</span>, beta = exp(-<span class="number">3</span>:<span class="number">3</span>), logic = c(<span class="literal">TRUE</span>,<span class="literal">FALSE</span>,<span class="literal">FALSE</span>,<span class="literal">TRUE</span>))</div><div class="line">x</div><div class="line">lapply(x, mean)</div><div class="line">lapply_result &lt;- lapply(x, mean)</div><div class="line">str(lapply_result)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- list(a = <span class="number">1</span>:<span class="number">10</span>, beta = exp(-<span class="number">3</span>:<span class="number">3</span>), logic = c(<span class="literal">TRUE</span>,<span class="literal">FALSE</span>,<span class="literal">FALSE</span>,<span class="literal">TRUE</span>))</div><div class="line">&gt; x</div><div class="line">$a</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line"></div><div class="line">$beta</div><div class="line">[<span class="number">1</span>]  <span class="number">0.04978707</span>  <span class="number">0.13533528</span>  <span class="number">0.36787944</span>  <span class="number">1.00000000</span>  <span class="number">2.71828183</span>  <span class="number">7.38905610</span> <span class="number">20.08553692</span></div><div class="line"></div><div class="line">$logic</div><div class="line">[<span class="number">1</span>]  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span></div><div class="line"></div><div class="line">&gt; lapply(x, mean)</div><div class="line">$a</div><div class="line">[<span class="number">1</span>] <span class="number">5.5</span></div><div class="line"></div><div class="line">$beta</div><div class="line">[<span class="number">1</span>] <span class="number">4.535125</span></div><div class="line"></div><div class="line">$logic</div><div class="line">[<span class="number">1</span>] <span class="number">0.5</span></div><div class="line"></div><div class="line">&gt; lapply_result &lt;- lapply(x, mean)</div><div class="line">&gt; str(lapply_result)</div><div class="line">List of <span class="number">3</span></div><div class="line"> $ a    : num <span class="number">5.5</span></div><div class="line"> $ beta : num <span class="number">4.54</span></div><div class="line"> $ logic: num <span class="number">0.5</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，<code>lapply()</code>函数的作用对象是列表(list)，其返回值也是一个列表。</p>
<h3 id="lapply使用案例2"><code>lapply()</code>使用案例2</h3>
<p>再看一个案例，注意将<code>lapply()</code>与<code>sapply()</code>进行比较：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; lapply(iris, class)</div><div class="line">$Sepal.Length</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line"></div><div class="line">$Sepal.Width</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line"></div><div class="line">$Petal.Length</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line"></div><div class="line">$Petal.Width</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line"></div><div class="line">$Species</div><div class="line">[<span class="number">1</span>] <span class="string">"factor"</span></div><div class="line"></div><div class="line">&gt; sapply(iris, class)</div><div class="line">Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </div><div class="line">   <span class="string">"numeric"</span>    <span class="string">"numeric"</span>    <span class="string">"numeric"</span>    <span class="string">"numeric"</span>     <span class="string">"factor"</span></div></pre></td></tr></table></figure>
<h3 id="lapply使用案例3"><code>lapply()</code>使用案例3</h3>
<p>再来看一个案例，先创建一个列表，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">prime_factors &lt;- list(</div><div class="line">  two = <span class="number">2</span>, </div><div class="line">  three = <span class="number">3</span>, </div><div class="line">  four = c(<span class="number">3</span>, <span class="number">2</span>),</div><div class="line">  five = <span class="number">5</span>,</div><div class="line">  six = c(<span class="number">2</span>,<span class="number">3</span>),</div><div class="line">  seven = <span class="number">7</span>,</div><div class="line">  eight = c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>),</div><div class="line">  nine = c(<span class="number">3</span>,<span class="number">3</span>),</div><div class="line">  ten = c(<span class="number">2</span>,<span class="number">5</span>)</div><div class="line">)</div><div class="line">head(prime_factors)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; head(prime_factors)</div><div class="line">$two</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$three</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$four</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">2</span></div><div class="line"></div><div class="line">$five</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div><div class="line"></div><div class="line">$six</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span></div><div class="line"></div><div class="line">$seven</div><div class="line">[<span class="number">1</span>] <span class="number">7</span></div></pre></td></tr></table></figure>
<p>现在我们要完成一项任务：以向量化的方式在每个列表元素中搜索唯一值。</p>
<p>常规思路是写一个for循环，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">unique_primes &lt;- vector(<span class="string">"list"</span>, length(prime_factors))</div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> seq_along(prime_factors))</div><div class="line">&#123;</div><div class="line">  unique_primes[[i]] &lt;- unique(prime_factors[[i]])</div><div class="line">&#125;</div><div class="line">names(unique_primes) &lt;- names(prime_factors)</div><div class="line">unique_primes</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; unique_primes</div><div class="line">$two</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$three</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$four</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">2</span></div><div class="line"></div><div class="line">$five</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div><div class="line"></div><div class="line">$six</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span></div><div class="line"></div><div class="line">$seven</div><div class="line">[<span class="number">1</span>] <span class="number">7</span></div><div class="line"></div><div class="line">$eight</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$nine</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$ten</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p>使用<code>lapply()</code>函数就能达到上述目的，并且代码更为简单：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; lapply(prime_factors, unique)</div><div class="line">$two</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$three</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$four</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">2</span></div><div class="line"></div><div class="line">$five</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div><div class="line"></div><div class="line">$six</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span></div><div class="line"></div><div class="line">$seven</div><div class="line">[<span class="number">1</span>] <span class="number">7</span></div><div class="line"></div><div class="line">$eight</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$nine</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$ten</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="lapply使用案例4"><code>lapply()</code>使用案例4</h3>
<p>在所有的案例中，<code>lapply</code>，<code>vapply</code>和<code>sapply</code>中的函数都是只有一个参数，例如<code>unique()</code>，<code>mean()</code>和<code>length()</code>等等，这些函数的特点就是只能传入一个向量化的参数。如果我们传入的函数有2个参数，怎么办？</p>
<p>此时，要分几种情况。</p>
<p>第一种，可以继续传入其他的标题参数，在这种方式下，只需要把函数名给lapply，然后再传入标题参数，例如我们使用传入的函数是<code>rep</code>，它的使用需要2个以参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; rep(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>),times=<span class="number">5</span>)</div><div class="line"> [<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>而参数<code>times</code>只允许传入单个数值（也就是标量）。此时在向<code>lapply()</code>函数传入<code>rep()</code>函数时，可以直接在后面添加上<code>times</code>的参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; complemented &lt;- c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">18</span>)</div><div class="line">&gt; lapply(complemented, rep, times=<span class="number">4</span>)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span></div><div class="line"></div><div class="line">[[<span class="number">3</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">6</span> <span class="number">6</span> <span class="number">6</span> <span class="number">6</span></div><div class="line"></div><div class="line">[[<span class="number">4</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">18</span> <span class="number">18</span> <span class="number">18</span> <span class="number">18</span></div></pre></td></tr></table></figure>
<p>不过，如果我们传入的函数中，第一个参数不是向量，是标量怎么办？</p>
<p>此时就可以自定义一个函数来封装一下我们的目标函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">complemented &lt;- c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">18</span>)</div><div class="line">rep4x &lt;- <span class="keyword">function</span>(x) rep(<span class="number">4</span>, times=x)</div><div class="line">lapply(complemented, rep4x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; complemented &lt;- c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">18</span>)</div><div class="line">&gt; rep4x &lt;- <span class="keyword">function</span>(x) rep(<span class="number">4</span>, times=x)</div><div class="line">&gt; lapply(complemented, rep4x)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">4</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">4</span> <span class="number">4</span></div><div class="line"></div><div class="line">[[<span class="number">3</span>]]</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span></div><div class="line"></div><div class="line">[[<span class="number">4</span>]]</div><div class="line"> [<span class="number">1</span>] <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>其实我们可以使用匿名函数来继续简上面的代码，上面的代码也就等于下面的代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">complemented &lt;- c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">18</span>)</div><div class="line">lapply(complemented, <span class="keyword">function</span>(x) rep(<span class="number">4</span>, times=x))</div></pre></td></tr></table></figure>
<h2 id="vapply函数">vapply()`函数</h2>
<p><code>vapply()</code>函数的含义是：应用于列表而返回向量(vector)，它的输入参数除了与<code>lapply()</code>部分相同外，也就说都要输入一个列表和函数，但<code>vapply()</code>还要输入第三个参数，即返回值的模板。</p>
<p>还以<code>lapply()</code>中的数据为例说明一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">prime_factors &lt;- list(</div><div class="line">  two = <span class="number">2</span>, </div><div class="line">  three = <span class="number">3</span>, </div><div class="line">  four = c(<span class="number">3</span>, <span class="number">2</span>),</div><div class="line">  five = <span class="number">5</span>,</div><div class="line">  six = c(<span class="number">2</span>,<span class="number">3</span>),</div><div class="line">  seven = <span class="number">7</span>,</div><div class="line">  eight = c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>),</div><div class="line">  nine = c(<span class="number">3</span>,<span class="number">3</span>),</div><div class="line">  ten = c(<span class="number">2</span>,<span class="number">5</span>)</div><div class="line">)</div><div class="line">head(prime_factors)</div><div class="line">vapply(prime_factors, length, numeric(<span class="number">1</span>))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&gt; prime_factors &lt;- list(</div><div class="line">+   two = <span class="number">2</span>, </div><div class="line">+   three = <span class="number">3</span>, </div><div class="line">+   four = c(<span class="number">3</span>, <span class="number">2</span>),</div><div class="line">+   five = <span class="number">5</span>,</div><div class="line">+   six = c(<span class="number">2</span>,<span class="number">3</span>),</div><div class="line">+   seven = <span class="number">7</span>,</div><div class="line">+   eight = c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>),</div><div class="line">+   nine = c(<span class="number">3</span>,<span class="number">3</span>),</div><div class="line">+   ten = c(<span class="number">2</span>,<span class="number">5</span>)</div><div class="line">+ )</div><div class="line">&gt; head(prime_factors)</div><div class="line">$two</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$three</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$four</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">2</span></div><div class="line"></div><div class="line">$five</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div><div class="line"></div><div class="line">$six</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span></div><div class="line"></div><div class="line">$seven</div><div class="line">[<span class="number">1</span>] <span class="number">7</span></div><div class="line"></div><div class="line">&gt; vapply(prime_factors, length, numeric(<span class="number">1</span>))</div><div class="line">  two three  four  five   six seven eight  nine   ten </div><div class="line">    <span class="number">1</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">3</span>     <span class="number">2</span>     <span class="number">2</span></div></pre></td></tr></table></figure>
<p>如果数据的输出不能匹配模板，那么<code>vapply()</code>就会抛出一个错误。在这个地方，我们还可以看一下<code>lapply()</code>和<code>sapply()</code>的输出结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&gt; lapply(prime_factors, length)</div><div class="line">$two</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line"></div><div class="line">$three</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line"></div><div class="line">$four</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$five</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line"></div><div class="line">$six</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$seven</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line"></div><div class="line">$eight</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div><div class="line"></div><div class="line">$nine</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$ten</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">&gt; sapply(prime_factors, length)</div><div class="line">  two three  four  five   six seven eight  nine   ten </div><div class="line">    <span class="number">1</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">3</span>     <span class="number">2</span>     <span class="number">2</span></div></pre></td></tr></table></figure>
<h2 id="tapply">tapply()</h2>
<p>tapply()函数经常用于处理因子类型的数据，这个t指的就是table，因子类型的数据经常与列联表有关。它执行的操作是，（暂）将数据进行分级，然后每组对应一个因子水平（或在多重因子的情况下对应一组因子水平的组合），得到数据的列联表，然后这些子向量应用函数<code>g()</code>，先看一个简单的案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ages &lt;- c(<span class="number">25</span>,<span class="number">26</span>,<span class="number">55</span>,<span class="number">37</span>,<span class="number">21</span>,<span class="number">42</span>)</div><div class="line">affils &lt;- c(<span class="string">"R"</span>,<span class="string">"D"</span>,<span class="string">"D"</span>,<span class="string">"R"</span>,<span class="string">"U"</span>,<span class="string">"D"</span>)</div><div class="line">tapply(ages,affils,mean)</div><div class="line"><span class="comment"># D  R  U </span></div><div class="line"><span class="comment"># 41 31 21</span></div></pre></td></tr></table></figure>
<p>再看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; tapply(iris$Sepal.Length, iris$Species, mean)</div><div class="line">    setosa versicolor  virginica </div><div class="line">     <span class="number">5.006</span>      <span class="number">5.936</span>      <span class="number">6.588</span></div></pre></td></tr></table></figure>
<p>在这个案例中，完成的任务是：告诉R提取<code>Sepal.Length</code>列的数据，然后根据<code>Spacies</code>将基分开，最后计算切分后每组数据的平均值。这是R代码的一个经典过程：切分(Split)，操作(Apply)，组合(Combine)，简称为SAC。</p>
<h3 id="使用tapply创建高维表格">使用<code>tapply()</code>创建高维表格</h3>
<h4 id="高维表格案例1">高维表格案例1</h4>
<p>以数据集<code>mtcars</code>为例，说明一下，先看一下这个数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; str(mtcars)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">32</span> obs. of  <span class="number">11</span> variables:</div><div class="line"> $ mpg : num  <span class="number">21</span> <span class="number">21</span> <span class="number">22.8</span> <span class="number">21.4</span> <span class="number">18.7</span> <span class="number">18.1</span> <span class="number">14.3</span> <span class="number">24.4</span> <span class="number">22.8</span> <span class="number">19.2</span> <span class="keyword">...</span></div><div class="line"> $ cyl : num  <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="keyword">...</span></div><div class="line"> $ disp: num  <span class="number">160</span> <span class="number">160</span> <span class="number">108</span> <span class="number">258</span> <span class="number">360</span> <span class="keyword">...</span></div><div class="line"> $ hp  : num  <span class="number">110</span> <span class="number">110</span> <span class="number">93</span> <span class="number">110</span> <span class="number">175</span> <span class="number">105</span> <span class="number">245</span> <span class="number">62</span> <span class="number">95</span> <span class="number">123</span> <span class="keyword">...</span></div><div class="line"> $ drat: num  <span class="number">3.9</span> <span class="number">3.9</span> <span class="number">3.85</span> <span class="number">3.08</span> <span class="number">3.15</span> <span class="number">2.76</span> <span class="number">3.21</span> <span class="number">3.69</span> <span class="number">3.92</span> <span class="number">3.92</span> <span class="keyword">...</span></div><div class="line"> $ wt  : num  <span class="number">2.62</span> <span class="number">2.88</span> <span class="number">2.32</span> <span class="number">3.21</span> <span class="number">3.44</span> <span class="keyword">...</span></div><div class="line"> $ qsec: num  <span class="number">16.5</span> <span class="number">17</span> <span class="number">18.6</span> <span class="number">19.4</span> <span class="number">17</span> <span class="keyword">...</span></div><div class="line"> $ vs  : num  <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div><div class="line"> $ am  : num  <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="keyword">...</span></div><div class="line"> $ gear: num  <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="keyword">...</span></div><div class="line"> $ carb: num  <span class="number">4</span> <span class="number">4</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">2</span> <span class="number">4</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>其中变量<code>am</code>表示发动机，其中<code>0</code>表示自动档，<code>1</code>表示自动档。由于看起来并不直观，我们可以创建一个名为<code>cars</code>的新对象，它是<code>mtcars</code>的拷贝，但将<code>am</code>数据列修改成了因子类型，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cars &lt;- within(mtcars, </div><div class="line">               am &lt;- factor(am, levels = <span class="number">0</span>:<span class="number">1</span>, labels = c(<span class="string">"Automatic"</span>, <span class="string">"Manual"</span>)))</div><div class="line">str(cars)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; str(cars)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">32</span> obs. of  <span class="number">11</span> variables:</div><div class="line"> $ mpg : num  <span class="number">21</span> <span class="number">21</span> <span class="number">22.8</span> <span class="number">21.4</span> <span class="number">18.7</span> <span class="number">18.1</span> <span class="number">14.3</span> <span class="number">24.4</span> <span class="number">22.8</span> <span class="number">19.2</span> <span class="keyword">...</span></div><div class="line"> $ cyl : num  <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="keyword">...</span></div><div class="line"> $ disp: num  <span class="number">160</span> <span class="number">160</span> <span class="number">108</span> <span class="number">258</span> <span class="number">360</span> <span class="keyword">...</span></div><div class="line"> $ hp  : num  <span class="number">110</span> <span class="number">110</span> <span class="number">93</span> <span class="number">110</span> <span class="number">175</span> <span class="number">105</span> <span class="number">245</span> <span class="number">62</span> <span class="number">95</span> <span class="number">123</span> <span class="keyword">...</span></div><div class="line"> $ drat: num  <span class="number">3.9</span> <span class="number">3.9</span> <span class="number">3.85</span> <span class="number">3.08</span> <span class="number">3.15</span> <span class="number">2.76</span> <span class="number">3.21</span> <span class="number">3.69</span> <span class="number">3.92</span> <span class="number">3.92</span> <span class="keyword">...</span></div><div class="line"> $ wt  : num  <span class="number">2.62</span> <span class="number">2.88</span> <span class="number">2.32</span> <span class="number">3.21</span> <span class="number">3.44</span> <span class="keyword">...</span></div><div class="line"> $ qsec: num  <span class="number">16.5</span> <span class="number">17</span> <span class="number">18.6</span> <span class="number">19.4</span> <span class="number">17</span> <span class="keyword">...</span></div><div class="line"> $ vs  : num  <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div><div class="line"> $ am  : Factor w/ <span class="number">2</span> levels <span class="string">"Automatic"</span>,<span class="string">"Manual"</span>: <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div><div class="line"> $ gear: num  <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="keyword">...</span></div><div class="line"> $ carb: num  <span class="number">4</span> <span class="number">4</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">2</span> <span class="number">4</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>现在使用<code>tapply()</code>来获取自动档和手动档每加仑汽油的平均行驶英里数(mpg)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; with(cars, tapply(mpg, am, mean))</div><div class="line">Automatic    Manual </div><div class="line"> <span class="number">17.14737</span>  <span class="number">24.39231</span></div></pre></td></tr></table></figure>
<p>这是一个一维表格，如果将换档类型(<code>am</code>)与挡位(<code>gear</code>)结合起来，就是下面的这个样子：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; with(cars, tapply(mpg, list(gear, am), mean))</div><div class="line">  Automatic Manual</div><div class="line"><span class="number">3</span>  <span class="number">16.10667</span>     <span class="literal">NA</span></div><div class="line"><span class="number">4</span>  <span class="number">21.05000</span> <span class="number">26.275</span></div><div class="line"><span class="number">5</span>        <span class="literal">NA</span> <span class="number">21.380</span></div></pre></td></tr></table></figure>
<p><code>tapply()</code>在创建表格型数据汇总方面与<code>table()</code>函数有点类似，但是<code>table()</code>只对对目标数据进行计数操作，而<code>tapply()</code>则可以指定任意函数作为操作函数。</p>
<h4 id="高维表格案例2">高维表格案例2</h4>
<p>再来看一个高维表格案例。</p>
<p>假定有一个经济数据集，其中包含性别、年龄和收入变量，在这里，如果我们调用<code>tapply(x,f,g)</code>，其中x表示收入，f是一对因子：一个因子性别，另一个因子为此人年龄是否大于25的编码，我们感兴趣的是找出按性别和年龄划分的人群平均收入，如果我们设置g()为mean()，tapply将返回这四个子组每一组的平均收入，这四组分别为：①25以下的男性；②25以上的男性；③25以下的女性；④25以上的女性，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">d &lt;- data.frame(list(gender=c(<span class="string">"M"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>),</div><div class="line">                     age=c(<span class="number">47</span>,<span class="number">59</span>,<span class="number">21</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">24</span>),</div><div class="line">                     income=c(<span class="number">55000</span>,<span class="number">88000</span>,<span class="number">32450</span>,<span class="number">76500</span>,<span class="number">123000</span>,<span class="number">45650</span>)))</div><div class="line">d$over25 &lt;- over25 &lt;- ifelse(d$age &gt;<span class="number">25</span>,<span class="number">1</span>,<span class="number">0</span>)</div><div class="line">d</div><div class="line"><span class="comment"># gender age income over25</span></div><div class="line"><span class="comment"># 1      M  47  55000      1</span></div><div class="line"><span class="comment"># 2      M  59  88000      1</span></div><div class="line"><span class="comment"># 3      F  21  32450      0</span></div><div class="line"><span class="comment"># 4      M  32  76500      1</span></div><div class="line"><span class="comment"># 5      F  33 123000      1</span></div><div class="line"><span class="comment"># 6      F  24  45650      0</span></div><div class="line">tapply(d$income,list(d$gender,d$over25),mean)</div><div class="line"><span class="comment"># 0         1</span></div><div class="line"><span class="comment"># F 39050 123000.00</span></div><div class="line"><span class="comment"># M    NA  73166.67</span></div></pre></td></tr></table></figure>
<h2 id="split">split()</h2>
<p>tapply()函数是将向量分割为组，然后针对每个组应用指定的函数，而split函数则是只进行分组，不进行计算，它的基本形式为<code>split(x,f)</code>，其中x是数据集，f为因子列表，这个函数可以将x划分为组，并返回分组的列表，这里需要注意的是，split的作用对象可以是向量，可以是数据框，而在tapply中只能是向量，使用方法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; d</div><div class="line">  gender age income over25</div><div class="line"><span class="number">1</span>      M  <span class="number">47</span>  <span class="number">55000</span>      <span class="number">1</span></div><div class="line"><span class="number">2</span>      M  <span class="number">59</span>  <span class="number">88000</span>      <span class="number">1</span></div><div class="line"><span class="number">3</span>      <span class="literal">F</span>  <span class="number">21</span>  <span class="number">32450</span>      <span class="number">0</span></div><div class="line"><span class="number">4</span>      M  <span class="number">32</span>  <span class="number">76500</span>      <span class="number">1</span></div><div class="line"><span class="number">5</span>      <span class="literal">F</span>  <span class="number">33</span> <span class="number">123000</span>      <span class="number">1</span></div><div class="line"><span class="number">6</span>      <span class="literal">F</span>  <span class="number">24</span>  <span class="number">45650</span>      <span class="number">0</span></div><div class="line">&gt; split(d$income,list(d$gender,d$over25))</div><div class="line">$F.0</div><div class="line">[<span class="number">1</span>] <span class="number">32450</span> <span class="number">45650</span></div><div class="line"></div><div class="line">$M.0</div><div class="line">numeric(<span class="number">0</span>)</div><div class="line"></div><div class="line">$F.1</div><div class="line">[<span class="number">1</span>] <span class="number">123000</span></div><div class="line"></div><div class="line">$M.1</div><div class="line">[<span class="number">1</span>] <span class="number">55000</span> <span class="number">88000</span> <span class="number">76500</span></div></pre></td></tr></table></figure>
<h2 id="by">by()</h2>
<p>tapply()函数的第1个参数必须是向量，对于矩阵或数据框，就不太适合了，因此可以使用by()函数，这个函数与tapply()的动作方式类似，但是by()可以应用于矩阵或数据框，第一个参数是指定数据集，第二个是分组因子，第三个是要应用的函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">head(iris)</div><div class="line"><span class="comment"># Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></div><div class="line"><span class="comment"># 1          5.1         3.5          1.4         0.2  setosa</span></div><div class="line"><span class="comment"># 2          4.9         3.0          1.4         0.2  setosa</span></div><div class="line"><span class="comment"># 3          4.7         3.2          1.3         0.2  setosa</span></div><div class="line"><span class="comment"># 4          4.6         3.1          1.5         0.2  setosa</span></div><div class="line"><span class="comment"># 5          5.0         3.6          1.4         0.2  setosa</span></div><div class="line"><span class="comment"># 6          5.4         3.9          1.7         0.4  setosa</span></div><div class="line">by(iris,iris$Species,<span class="keyword">function</span>(m) lm(m[,<span class="number">1</span>]~m[,<span class="number">2</span>]))</div><div class="line"><span class="comment"># iris$Species: setosa</span></div><div class="line"><span class="comment"># Call:</span></div><div class="line"><span class="comment">#   lm(formula = m[, 1] ~ m[, 2])</span></div><div class="line"><span class="comment"># Coefficients:</span></div><div class="line"><span class="comment">#   (Intercept)       m[, 2]  </span></div><div class="line"><span class="comment"># 2.6390       0.6905  </span></div><div class="line"><span class="comment"># --------------------------------------------------------------------------------- </span></div><div class="line"><span class="comment">#   iris$Species: versicolor</span></div><div class="line"><span class="comment"># Call:</span></div><div class="line"><span class="comment">#   lm(formula = m[, 1] ~ m[, 2])</span></div><div class="line"><span class="comment"># Coefficients:</span></div><div class="line"><span class="comment">#   (Intercept)       m[, 2]  </span></div><div class="line"><span class="comment"># 3.5397       0.8651  </span></div><div class="line"><span class="comment"># --------------------------------------------------------------------------------- </span></div><div class="line"><span class="comment">#   iris$Species: virginica</span></div><div class="line"><span class="comment"># Call:</span></div><div class="line"><span class="comment">#   lm(formula = m[, 1] ~ m[, 2])</span></div><div class="line"><span class="comment"># Coefficients:</span></div><div class="line"><span class="comment">#   (Intercept)       m[, 2]  </span></div><div class="line"><span class="comment"># 3.9068       0.9015</span></div></pre></td></tr></table></figure>
<h2 id="aggregate">aggregate()</h2>
<p>aggregate()函数可以对分组中的每一个变量使用tapply()函数，例如在R的CO2数据集中，按Treatment进行分级，并对每组数据找出其中位数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; head(CO2)</div><div class="line">  Plant   Type  Treatment conc uptake</div><div class="line"><span class="number">1</span>   Qn1 Quebec nonchilled   <span class="number">95</span>   <span class="number">16.0</span></div><div class="line"><span class="number">2</span>   Qn1 Quebec nonchilled  <span class="number">175</span>   <span class="number">30.4</span></div><div class="line"><span class="number">3</span>   Qn1 Quebec nonchilled  <span class="number">250</span>   <span class="number">34.8</span></div><div class="line"><span class="number">4</span>   Qn1 Quebec nonchilled  <span class="number">350</span>   <span class="number">37.2</span></div><div class="line"><span class="number">5</span>   Qn1 Quebec nonchilled  <span class="number">500</span>   <span class="number">35.3</span></div><div class="line"><span class="number">6</span>   Qn1 Quebec nonchilled  <span class="number">675</span>   <span class="number">39.2</span></div><div class="line">&gt; aggregate(CO2[,c(<span class="number">4</span>,<span class="number">5</span>)],list(CO2$Treatment),median)</div><div class="line">     Group.1 conc uptake</div><div class="line"><span class="number">1</span> nonchilled  <span class="number">350</span>   <span class="number">31.3</span></div><div class="line"><span class="number">2</span>    chilled  <span class="number">350</span>   <span class="number">19.7</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>《R语言轻松入门与提高》（Andrie de Vires, Joris Meys著，麦秆创智 译）</li>
<li>学习R.[美] Richard，Cotton 著刘军 译</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/03/BIoTools/Venn图/" rel="next" title="Venn图">
                <i class="fa fa-chevron-left"></i> Venn图
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/05/BIoTools/查找miRNA的前体序列/" rel="prev" title="查找miRNA的前体序列">
                查找miRNA的前体序列 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="vcomments"></div>
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">170</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apply系列函数的构成"><span class="nav-number">2.</span> <span class="nav-text">apply系列函数的构成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apply"><span class="nav-number">3.</span> <span class="nav-text">apply()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#传入更多参数"><span class="nav-number">3.1.</span> <span class="nav-text">传入更多参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sapply"><span class="nav-number">4.</span> <span class="nav-text">sapply()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sapply案例1"><span class="nav-number">4.1.</span> <span class="nav-text">sapply()案例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sapply案例2"><span class="nav-number">4.2.</span> <span class="nav-text">sapply()案例2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#switch函数"><span class="nav-number">4.3.</span> <span class="nav-text">switch()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将函数应用于数据框"><span class="nav-number">4.4.</span> <span class="nav-text">将函数应用于数据框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sapply结果的简化"><span class="nav-number">4.5.</span> <span class="nav-text">sapply()结果的简化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lapply"><span class="nav-number">5.</span> <span class="nav-text">lapply()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lapply使用案例1"><span class="nav-number">5.1.</span> <span class="nav-text">lapply()使用案例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lapply使用案例2"><span class="nav-number">5.2.</span> <span class="nav-text">lapply()使用案例2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lapply使用案例3"><span class="nav-number">5.3.</span> <span class="nav-text">lapply()使用案例3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lapply使用案例4"><span class="nav-number">5.4.</span> <span class="nav-text">lapply()使用案例4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vapply函数"><span class="nav-number">6.</span> <span class="nav-text">vapply()`函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tapply"><span class="nav-number">7.</span> <span class="nav-text">tapply()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用tapply创建高维表格"><span class="nav-number">7.1.</span> <span class="nav-text">使用tapply()创建高维表格</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#高维表格案例1"><span class="nav-number">7.1.1.</span> <span class="nav-text">高维表格案例1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#高维表格案例2"><span class="nav-number">7.1.2.</span> <span class="nav-text">高维表格案例2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#split"><span class="nav-number">8.</span> <span class="nav-text">split()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#by"><span class="nav-number">9.</span> <span class="nav-text">by()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#aggregate"><span class="nav-number">10.</span> <span class="nav-text">aggregate()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">11.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共648.1k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
