<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Linux,脚本,Shell,文本处理,gawk," />










<meta name="description" content="在gawk中使用变量 gawk支持两种变量，第一，内建变量；第二，自定义变量。gawk有一些内建变量，这些变量存放用来处理数据文件中的数据字段和记录的信息。用户也可以在gawk程序里创建自己的变量。 内建变量 字段和记录分隔符变量 前面笔记提到过gawk中的一种内建变量类型是数据字段变量。数据字段变量允许用户使用美元符号（$）和字段在该记录中的位置值来引用记录对应的字段。因此，要引用记录中">
<meta name="keywords" content="Linux,脚本,Shell,文本处理,gawk">
<meta property="og:type" content="article">
<meta property="og:title" content="Shell学习笔记（11）——gawk进阶">
<meta property="og:url" content="http://rvdsd.top/2018/05/11/Linux-shell11-gawk进阶/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:description" content="在gawk中使用变量 gawk支持两种变量，第一，内建变量；第二，自定义变量。gawk有一些内建变量，这些变量存放用来处理数据文件中的数据字段和记录的信息。用户也可以在gawk程序里创建自己的变量。 内建变量 字段和记录分隔符变量 前面笔记提到过gawk中的一种内建变量类型是数据字段变量。数据字段变量允许用户使用美元符号（$）和字段在该记录中的位置值来引用记录对应的字段。因此，要引用记录中">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-05-18T12:15:14.223Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shell学习笔记（11）——gawk进阶">
<meta name="twitter:description" content="在gawk中使用变量 gawk支持两种变量，第一，内建变量；第二，自定义变量。gawk有一些内建变量，这些变量存放用来处理数据文件中的数据字段和记录的信息。用户也可以在gawk程序里创建自己的变量。 内建变量 字段和记录分隔符变量 前面笔记提到过gawk中的一种内建变量类型是数据字段变量。数据字段变量允许用户使用美元符号（$）和字段在该记录中的位置值来引用记录对应的字段。因此，要引用记录中">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/2018/05/11/Linux-shell11-gawk进阶/"/>





  <title>Shell学习笔记（11）——gawk进阶 | RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/05/11/Linux-shell11-gawk进阶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Shell学习笔记（11）——gawk进阶</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-11T12:00:01+08:00">
                2018-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9,416
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  38
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="在gawk中使用变量">在gawk中使用变量</h2>
<p>gawk支持两种变量，第一，内建变量；第二，自定义变量。gawk有一些内建变量，这些变量存放用来处理数据文件中的数据字段和记录的信息。用户也可以在gawk程序里创建自己的变量。</p>
<h3 id="内建变量">内建变量</h3>
<h4 id="字段和记录分隔符变量">字段和记录分隔符变量</h4>
<p>前面笔记提到过gawk中的一种内建变量类型是数据字段变量。数据字段变量允许用户使用美元符号（<code>$</code>）和字段在该记录中的位置值来引用记录对应的字段。因此，要引用记录中的第一个数据字段，就用变量<code>$1</code>；要引用第二个字段，就用<code>$2</code>，依次类推。数据字段是由字段分隔符来划定的。默认情况下，字段分隔符是一个空白字符，也就是空格符或者制表符。也可以在命令行下使用命令行参数<code>-F</code>或者在gawk程序中使用特殊的内建变量<code>FS</code>来更改字段分隔符。内建变量<code>FS</code>是一组内建变量中的一个，这组变量用于控制gawk如何处理输入输出数据中的字段和记录下表列出了这些内建变量。</p>
<table>
<thead>
<tr class="header">
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FIELDWIDTHS</td>
<td>由空格分隔的一列数字，定义了每个数据字段确切宽度</td>
</tr>
<tr class="even">
<td>FS</td>
<td>输入字段分隔符</td>
</tr>
<tr class="odd">
<td>RS</td>
<td>输入记录分隔符</td>
</tr>
<tr class="even">
<td>OFS</td>
<td>输出字段分隔符</td>
</tr>
<tr class="odd">
<td>ORS</td>
<td>输出记录分隔符</td>
</tr>
</tbody>
</table>
<p>变量<code>FS</code>和<code>OFS</code>定义了gawk如何处理数据流中的数据字段，变量<code>FS</code>来定义记录中的字段分隔符。变量<code>OFS</code>具备相同的功能，只不过是用在<code>print</code>命令的输出上。默认情况下，gawk将<code>OFS</code>设成一个空格，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125;&#123;print $1, $2,$3&#125;' data1.txt </div><div class="line">Data11 data12 data13</div><div class="line">data21 data22 data23</div><div class="line">data31 data32 data33</div></pre></td></tr></table></figure>
<p>在这个案例中，print命令会自动将<code>OFS</code>变量的值放置在输出中的每个字段间。通过设置<code>OFS</code>变量，可以在输出中使用任意字符串来分隔字段，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=",";OFS="-"&#125;&#123;print $1,$2,$3&#125;' data1.txt </div><div class="line">Data11-data12-data13</div><div class="line">data21-data22-data23</div><div class="line">data31-data32-data33</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=",";OFS="--"&#125;&#123;print $1,$2,$3&#125;' data1.txt </div><div class="line">Data11--data12--data13</div><div class="line">data21--data22--data23</div><div class="line">data31--data32--data33</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=",";OFS="&lt;--&gt;"&#125;&#123;print $1,$2,$3&#125;' data1.txt </div><div class="line">Data11&lt;--&gt;data12&lt;--&gt;data13</div><div class="line">data21&lt;--&gt;data22&lt;--&gt;data23</div><div class="line">data31&lt;--&gt;data32&lt;--&gt;data33</div></pre></td></tr></table></figure>
<p><code>FIELDWIDTHS</code>变量允许你不依靠字段分隔符来读取记录，从字面上很好理解，间隔宽度。在一些应用程序中，数据并没有使用字段分隔符，而是被放置在了记录中的特定列。这种情况下，必须设定<code>FIELDWIDTHS</code>变量来匹配数据在记录中的位置。一旦设置了<code>FIELDWIDTH</code>变量，gawk就会忽略<code>FS</code>变量，并根据提供的字段宽度来计算字段。下面是个采用字段宽度而非字段分隔符的例子，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1b.txt </div><div class="line">1005.3247596.37</div><div class="line">115-2.349194.00</div><div class="line">05810.1298100.1</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FIELDWIDTHS="3 5 2 5 "&#125;&#123;print $1, $2, $3, $4&#125;' data1b.txt </div><div class="line">100 5.324 75 96.37</div><div class="line">115 -2.34 91 94.00</div><div class="line">058 10.12 98 100.1</div></pre></td></tr></table></figure>
<p><code>FIELDWIDTHS</code>变量定义了四个字段，即3 5 2 5 ，gawk依此来解析数据记录。每个记录中的数字串会根据已定义好的字段长度来分割。一旦设定了<code>FIELDWIDTHS</code>变量的值，就不能再改变了，这种方法并不适用于长的字段。</p>
<p>变量<code>RS</code>和<code>ORS</code>定义了gawk程序如何处理数据流中的字段。默认情况下，gawk将<code>RS</code>和<code>ORS</code>设为换行符。默认的<code>RS</code>值表明，输入数据流中的每行新文本就是一条新纪录。有时，你会在数据流中碰到占据多行的字段。典型的例子是包含地址和电话号码的数据，其中地址和电话号码各占一行，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Riley Mullen </div><div class="line">123 Main Street </div><div class="line">Chicago, IL 60601 </div><div class="line">(312)555-1234</div></pre></td></tr></table></figure>
<p>如果用默认的<code>FS</code>和<code>RS</code>变量值来读取这组数据，gawk就会把每行作为一条单独的记录来读取，并将记录中的空格当作字段分隔符。这可不是你希望看到的。要解决这个问题，只需把<code>FS</code>变量设置成换行符。这就表明数据流中的每行都是一个单独的字段，每行上的所有数据都属于同一个字段。此时要判断一个新的数据行从何开始。对于这一问题，可以把<code>RS</code>变量设置成空字符串，然后在数据记录间留一个空白行。gawk会把每个空白行当作一个记录分隔符，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data2.txt </div><div class="line">Riley Mullen</div><div class="line">123 Main Street</div><div class="line">Chicago, IL  60601</div><div class="line">(312)555-1234</div><div class="line"></div><div class="line">Frank Williams</div><div class="line">456 Oak Street</div><div class="line">Indianapolis, IN  46201</div><div class="line">(317)555-9876</div><div class="line"></div><div class="line">Haley Snell</div><div class="line">4231 Elm Street</div><div class="line">Detroit, MI 48201</div><div class="line">(313)555-4938</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS="\n";RS=""&#125; &#123;print $1,$4&#125;' data2.txt</div><div class="line">Riley Mullen (312)555-1234</div><div class="line">Frank Williams (317)555-9876</div><div class="line">Haley Snell (313)555-4938</div></pre></td></tr></table></figure>
<p>现在gawk把文件中的每行都当成一个字段，把空白行当作记录分隔符。</p>
<h4 id="数据变量">数据变量</h4>
<p>gawk还有其他一些内建变量来帮助你了解数据发生了什 么变化，并提取shell环境的信息。下表列出了gawk中的其他内建变量。</p>
<table>
<thead>
<tr class="header">
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ARGC</td>
<td>当前命令行参数个数</td>
</tr>
<tr class="even">
<td>ARGIND</td>
<td>当前文件在 ARGV 中的位置</td>
</tr>
<tr class="odd">
<td>ARGV</td>
<td>包含命令行参数的数组</td>
</tr>
<tr class="even">
<td>CONVFMT</td>
<td>数字的转换格式（参见 printf 语句），默认值为</td>
</tr>
<tr class="odd">
<td>ENVIRON</td>
<td>当前shell环境变量及其值组成的关联数组</td>
</tr>
<tr class="even">
<td>ERRNO</td>
<td>当读取或关闭输入文件发生错误时的系统错误号</td>
</tr>
<tr class="odd">
<td>FILENAME</td>
<td>用作gawk输入数据的数据文件的文件名</td>
</tr>
<tr class="even">
<td>FNR</td>
<td>当前数据文件中的数据行数</td>
</tr>
<tr class="odd">
<td>IGNORECASE</td>
<td>设成非零值时，忽略 gawk 命令中出现的字符串的字符大小写</td>
</tr>
<tr class="even">
<td>NF</td>
<td>数据文件中的字段总数</td>
</tr>
<tr class="odd">
<td>NR</td>
<td>已处理的输入记录数</td>
</tr>
<tr class="even">
<td>OFMT</td>
<td>数字的输出格式，默认值为 %.6 g</td>
</tr>
<tr class="odd">
<td>RLENGTH</td>
<td>由 match 函数所匹配的子字符串的长度</td>
</tr>
<tr class="even">
<td>RSTART</td>
<td>由 match 函数所匹配的子字符串的起始位置</td>
</tr>
</tbody>
</table>
<p>ARGC和ARGV变量允许从shell中获得命令行参数的总数以及它们的值，需要注意的是，gawk并不会将程序脚本当成命令行参数的一部分，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;print ARGC,ARGV[0]&#125;' data1.txt</div><div class="line">2 gawk</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;print ARGC,ARGV[1]&#125;' data1.txt</div><div class="line">2 data1.txt</div></pre></td></tr></table></figure>
<p>结果显示：ARGC的结果是2，表明命令行上有两个参数，这包括gawk命令和data1参数（记住，程序脚本并不算参数）。ARGV是包含命令行参数的数组，这个数组从索引0开始，代表的是命令，从结果可以看出，<code>ARGV[0]</code>是gawk，<code>ARGV[1]</code>的结果是data1，这是gawk命令后的第一个命令行参数。从代码可以看出，在脚本中引用gawk变量时，变量名前不加美元符。</p>
<p><code>ENVIRON</code>使用关联数组来提取shell环境变量。关联数组用文本作为数组的索引值，而不是数值。数组索引中的文本是shell环境变量名，而数组的值则是shell环境变量的值，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '</div><div class="line"><span class="meta">&gt;</span> BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> print ENVIRON["HOME"]</div><div class="line"><span class="meta">&gt;</span> print ENVIRON["PATH"]</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">/home/biotest</div><div class="line">/home/biotest/miniconda2/bin:/home/miniconda2/bin:/home/bio/miniconda2/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/biotest/home/test:/home/biotest/home/biotest:/home/biotest:/home/biotest/</div></pre></td></tr></table></figure>
<p><code>ENVIRON[&quot;HOME&quot;]</code>变量从shell中提取了<code>HOME</code>环境变量的值。<code>ENVIRON[&quot;PATH&quot;]</code>提取了<code>PATH</code>环境变量的值。可以用这种方法来从shell中提取任何环境变量的值，以供gawk程序使用。当要在gawk程序中跟踪数据字段和记录时，就需要变量<code>FNR</code>、<code>NF</code>和<code>NR</code>，有时用户如果不知道记录中有多少个数据字段。<code>NF</code>变量可以让用户在不知道具体位置的情况下指定记录中的最后一个数据字段，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=":";OFS=":"&#125;&#123;print $1,$NF&#125;' /etc/passwd</div><div class="line">root:/bin/bash</div><div class="line">daemon:/usr/sbin/nologin</div><div class="line">bin:/usr/sbin/nologin</div><div class="line">sys:/usr/sbin/nologin</div><div class="line">sync:/bin/sync</div><div class="line">...</div><div class="line">usbmux:/bin/false</div><div class="line">biotest:/bin/bash</div><div class="line">userid:</div><div class="line">501:</div><div class="line">502:</div><div class="line">503:</div><div class="line">511:</div><div class="line">512:</div><div class="line">513:</div><div class="line">test001:</div></pre></td></tr></table></figure>
<p>NF变量含有数据文件中最后一个数据字段的数字值。可以在它前面加个美元符将其用作字段变量。</p>
<p><code>FNR</code>和<code>NR</code>变量虽然类似，但又略有不同。<code>FNR</code>变量含有当前数据文件中已处理过的记录数，<code>NR</code>变量则含有已处理过的记录总数，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125;&#123;print $1, "FNR="FNR&#125;' data1.txt data1.txt</div><div class="line">Data11 FNR=1</div><div class="line">data21 FNR=2</div><div class="line">data31 FNR=3</div><div class="line">Data11 FNR=1</div><div class="line">data21 FNR=2</div><div class="line">data31 FNR=3</div></pre></td></tr></table></figure>
<p>在这个例子中，gawk程序的命令行定义了两个输入文件（两次指定的是同样的输入文件）。这个脚本会打印第一个数据字段的值和FNR变量的当前值。注意，当gawk程序处理第二个数据文件时，FNR值被设回了1。接着看NR变量的案例，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '</div><div class="line"><span class="meta">&gt;</span> BEGIN &#123;FS=","&#125;</div><div class="line"><span class="meta">&gt;</span> &#123;print $1, "FNR="FNR,"NR="NR&#125;</div><div class="line"><span class="meta">&gt;</span> END&#123;print "There were",NR,"records processed"&#125;' data1.txt data1.txt</div><div class="line">Data11 FNR=1 NR=1</div><div class="line">data21 FNR=2 NR=2</div><div class="line">data31 FNR=3 NR=3</div><div class="line">Data11 FNR=1 NR=4</div><div class="line">data21 FNR=2 NR=5</div><div class="line">data31 FNR=3 NR=6</div><div class="line">There were 6 records processed</div></pre></td></tr></table></figure>
<p>FNR变量的值在gawk处理第二个数据文件时被重置了，而NR变量则在处理第二个数据文件时继续计数。结果就是：如果只使用一个数据文件作为输入，FNR和NR的值是相同的；如果使用多个数据文件作为输入，FNR的值会在处理每个数据文件时被重置，而NR的值则会继续计数直到处理完所有的数据文件。</p>
<p>由于gawk脚本通常会比shell脚本中的其他部分还要大一些，因此用户可以shell的多行特性直接在命令行上运行了gawk脚本。在shell脚本中使用gawk时，应该将不同的gawk命令放到不同的行，这样会比较容易阅读和理解，不要在shell脚本中将所有的命令都塞到同一行。如果要在不同的shell脚本中用到同样的gawk脚本，可以将这段gawk脚本放到一个单独的文件中，并用-f参数来在shell脚本中引用即可。</p>
<h3 id="自定义变量">自定义变量</h3>
<h4 id="在脚本中给变量赋值">在脚本中给变量赋值</h4>
<p>在gawk程序中给变量赋值跟在shell脚本中赋值类似，都用赋值语句，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '</div><div class="line"><span class="meta">&gt;</span> BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> testing="This is a test"</div><div class="line"><span class="meta">&gt;</span> print testing</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">This is a test</div></pre></td></tr></table></figure>
<p>print语句的输出是testing变量的当前值。跟shell脚本变量一样，gawk变量可以保存数值或文本值，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '</div><div class="line"><span class="meta">&gt;</span> BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> testing="This is a test"</div><div class="line"><span class="meta">&gt;</span> print testing</div><div class="line"><span class="meta">&gt;</span> testing=45</div><div class="line"><span class="meta">&gt;</span> print testing</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">This is a test</div><div class="line">45</div></pre></td></tr></table></figure>
<p>在这个案例中，testing变量开始是文本，后来是数字，赋值语句可以包含数学公式，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;x=4;x=x*2+3;print x&#125;'</div><div class="line">11</div></pre></td></tr></table></figure>
<p>从结果可以看出，gawk包含了用来处理数字值的标准算数操作符，其中包括求余符号（%）和幂运算符号（^或**）。</p>
<h4 id="在命令行上给变量赋值">在命令行上给变量赋值</h4>
<p>gawk命令行可以给程序中的变量赋值，这样用户就能在正常的代码之外赋值，即时改变变量的值，在下面的例子中，有入眠使用命令行变量来显示文件中特定数据字段，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat script1.sh </div><div class="line">BEGIN&#123;FS=","&#125;</div><div class="line">&#123;print $n&#125;</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -f script1.sh n=2 data1.txt</div><div class="line">data12</div><div class="line">data22</div><div class="line">data32</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -f script1.sh n=3 data1.txt</div><div class="line">data13</div><div class="line">data23</div><div class="line">data33</div></pre></td></tr></table></figure>
<p>第一个例子显示了文件的第二个数据字段（<code>n=2</code>），第二个例子显示了第三个数据字段（<code>n=3</code>），只要在命令行上设置n变量的值就行。这个特性可以让用户在不改变脚本代码的情况下就能够改变脚本的行为，使用命令行参数来定义变量值会有一个问题，就是当设置了变量后，这个值在代码的BEGIN部分不可用，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat script2.sh </div><div class="line">BEGIN&#123;print "The starting value is",n; FS=","&#125;</div><div class="line">&#123;print $n&#125;</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -f script2.sh n=3 data1.txt</div><div class="line">The starting value is </div><div class="line">data13</div><div class="line">data23</div><div class="line">data33</div></pre></td></tr></table></figure>
<p>如果要解决这个问题，可以用-v命令行参数，此参数允许你在BEGIN代码之前设定变量。在命令行上， -v命令行参数必须放在脚本代码之前，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -v n=3 -f script2.sh data1.txt </div><div class="line">The starting value is 3</div><div class="line">data13</div><div class="line">data23</div><div class="line">data33</div></pre></td></tr></table></figure>
<p>从结果中可以看出，现在在BEGIN代码部分中的变量n的值已经是命令行上设定的那个值了。</p>
<h2 id="处理数组">处理数组</h2>
<p>为了在单个变量中存储多个值，许多编程语言都提供数组。gawk编程语言使用关联数组提供数组功能。关联数组跟数字数组不同之处在于，关联数据的索引值可以是任意文本字符串（我觉得跟Python中的字典类似）。你不需要用连续的数字来标识数组中的数据元素。相反，关联数组用各种字符串来引用值。每个索引字符串都必须能够唯一地标识出赋给它的数据元素。</p>
<h3 id="定义数组变量">定义数组变量</h3>
<p>可以用标准赋值语句来定义数组变量。数组变量赋值的格式为<code>var[index]=element</code>其中<code>var</code>是变量名，<code>index</code>是关联数组的索引值，<code>element</code>是数据元素值,在引用数组变量时，必须包含索引值来提取相应的数据元素值，下面是一些gawk中数组变量的例子，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> capital["Zhengzhou"]="Henan"</div><div class="line"><span class="meta">&gt;</span> print capital["Zhengzhou"]</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">Henan</div></pre></td></tr></table></figure>
<p>代码解释：与<code>var[index]=element</code>对应的是：<code>capital</code>是一个变量名，<code>Zhengzhou</code>是一个索引值，<code>Henan</code>是数据元素值。</p>
<p>在引用数组变量时，会得到数据元素的值。数据元素值是数字值时也一样，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> var[1]=34</div><div class="line"><span class="meta">&gt;</span> var[2]=3</div><div class="line"><span class="meta">&gt;</span> total=var[1]+var[2]</div><div class="line"><span class="meta">&gt;</span> print total</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">37</div></pre></td></tr></table></figure>
<h3 id="遍历数组变量">遍历数组变量</h3>
<p>关联数组变量的问题在于你可能无法知晓索引值是什么。跟使用连续数字作为索引值的数字数组不同，关联数组的索引可以是任何东西。如果要在gawk中遍历一个关联数组，可以用for语句的一种特殊形式，格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">for (var in array)</div><div class="line">&#123;</div><div class="line">    statements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个for语句会在每次循环时将关联数组array的下一个索引值赋给变量var，然后执行一遍statements。这个变量中存储的是索引值而不是数组元素值，可以将这个变量用作数组的索引，轻松地取出数据元素值，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> var["a"]=1</div><div class="line"><span class="meta">&gt;</span> var["g"]=2</div><div class="line"><span class="meta">&gt;</span> var["m"]=3</div><div class="line"><span class="meta">&gt;</span> var["u"]=4</div><div class="line"><span class="meta">&gt;</span> for (test in var)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> print "Index:",test," - Value:",var[test]</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">Index: u  - Value: 4</div><div class="line">Index: m  - Value: 3</div><div class="line">Index: a  - Value: 1</div><div class="line">Index: g  - Value: 2</div></pre></td></tr></table></figure>
<p>从结果可以发现，索引值返回的顺序并没有按照变量的变量进行返回，不过它们都能够指向对应的数据元素值，这一点需要注意。</p>
<h3 id="删除数组变量">删除数组变量</h3>
<p>从关联数组中删除数组索引的命令为<code>delete array[index]</code>，删除命令会从数组中删除关联索引值和相关的数据元素值，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> var["a"]=1</div><div class="line"><span class="meta">&gt;</span> var["g"]=2</div><div class="line"><span class="meta">&gt;</span> for (test in var)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> print "Index:",test,"-Value:",var[test]</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> delete var["g"]</div><div class="line"><span class="meta">&gt;</span> print "---"</div><div class="line"><span class="meta">&gt;</span> for (test in var)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> print "Index:",test,"-Value:",var[test]</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">Index: a -Value: 1</div><div class="line">Index: g -Value: 2</div><div class="line">---</div><div class="line">Index: a -Value: 1</div></pre></td></tr></table></figure>
<p>一旦从关联数组中删除了索引值，你就没法再用它来提取元素值。</p>
<h2 id="使用模式">使用模式</h2>
<p>gawk程序支持多种类型的匹配模式来过滤数据记录，BEGIN和END关键字是用来在读取数据流之前或之后执行命令的特殊模式。类似地，用户可以创建其他模式在数据流中出现匹配数据时执行一些命令。</p>
<h3 id="正则表达式">正则表达式</h3>
<p>在使用正则表达式时，正则表达式必须出现在它要控制的程序脚本的左花括号前，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt </div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125; /11/&#123;print $1&#125;' data1.txt</div><div class="line">Data11</div></pre></td></tr></table></figure>
<p>正则表达式<code>/11/</code>匹配了数据字段中含有字符串<code>11</code>的记录。gawk程序会用正则表达式对记录中所有的数据字段进行匹配，包括字段分隔符，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125;/,d/&#123;print $1&#125;' data1.txt</div><div class="line">Data11</div><div class="line">data21</div><div class="line">data31</div></pre></td></tr></table></figure>
<p>这个例子使用正则表达式匹配了用作字段分隔符的逗号（<code>/,</code>）。但这可能会造成如下问题：当试图匹配某个数据字段中的特定数据时，这些数据又出现在其他数据字段中。如果需要用正则表达式匹配某个特定的数据实例，应该使用匹配操作符。</p>
<h3 id="匹配操作符">匹配操作符</h3>
<p>匹配操作符（matching operator）允许将正则表达式限定在记录中的特定数据字段。匹配操作符是波浪线（<code>~</code>）。可以指定匹配操作符、数据字段变量以及要匹配的正则表达式。例如<code>＄1~/^data/</code>中，<code>$1</code>变量代表记录中的第1个数据字段，这个表达式会过滤出第1个字段以文本data开头的所有记录，下面是gawk使用匹配操作符的例子，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125; $2~/data2/&#123;print $0&#125;' data1.txt</div><div class="line">data21,data22,data23,data24,data25</div></pre></td></tr></table></figure>
<p>匹配操作符会用正则表达式<code>/^data2/</code>来比较第二个数据字段，该正则表达式指明字符串要以文本<code>data2</code>开头，常常利用gawk的这个特性来搜索相应的数据元素，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -F: '$1~/biotest/&#123;print $1,$NF&#125;' /etc/passwd</div><div class="line">biotest /bin/bash</div></pre></td></tr></table></figure>
<p>这段代码会在第一个数据字段中查找文本biotest。如果在记录中找到了这个模式，它会打印该记录的第一个和最后一个数据字段值。也可以用<code>!</code>符号来排除正则表达式的匹配，即<code>$1 !~/expression/</code>，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -F: '$1 !~ /biotest/&#123;print $1, $NF&#125;' /etc/passwd</div><div class="line">root /bin/bash</div><div class="line">daemon /usr/sbin/nologin</div><div class="line">bin /usr/sbin/nologin</div><div class="line">sys /usr/sbin/nologin</div><div class="line">sync /bin/sync</div><div class="line">...</div></pre></td></tr></table></figure>
<p>在这段代码中，gawk程序脚本会打印<code>/etc/passwd</code>文件中与用户ID biotest不匹配的用户ID和登录shell。</p>
<h3 id="数学表达式">数学表达式</h3>
<p>除了正则表达式，也可以在匹配模式中用数学表达式。这个功能在匹配数据字段中的数字值时非常方便。举个例子，如果你想显示所有属于root用户组（组ID为0）的系统用户，可以用以下的脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -F: '$4 ==0&#123;print $1&#125;' /etc/passwd</div><div class="line">root</div></pre></td></tr></table></figure>
<p>这段脚本会查看第四个数据字段含有值 0 的记录。在这个Linux系统中，有1个用户账户属于root用户组。</p>
<p>可以使用任何常见的数学比较表达式，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x == y ：值x等于y。 </div><div class="line">x &lt;= y ：值x小于等于y。 </div><div class="line">x &lt; y ：值x小于y。 </div><div class="line">x &gt;= y ：值x大于等于y。 </div><div class="line">x &gt; y ：值x大于y。</div></pre></td></tr></table></figure>
<p>也可以对文本数据使用表达式，但这一点与正则表达式不同，gawk的表达式必须完全匹配，数据必须跟模式严格匹配，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -F, '$1=="data"&#123;print $1&#125;' data1.txt</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -F, '$1=="Data11"&#123;print $1&#125;' data1.txt</div><div class="line">Data11</div></pre></td></tr></table></figure>
<p>第一个测试没有匹配任何记录，因为第一个数据字段的值不在任何记录中。第二个测试用值Data11匹配了一条记录。</p>
<h2 id="结构化命令">结构化命令</h2>
<p>gawk编程语言支持常见的结构化编程命令。</p>
<h3 id="if语句">if语句</h3>
<p>gawk编程语言支持标准的<code>if-then-else</code>格式的if语句。必须为if语句定义一个求值的条件，并将其用圆括号括起来。如果条件求值为<code>TRUE</code>，紧跟在if语句后的语句会执行。如果条件求值为<code>FALSE</code>，这条语句就会被跳过，格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (conditon)</div><div class="line">    statement1</div><div class="line"><span class="meta">#</span> 或者放到一行上</div><div class="line">if (condition) statement1</div></pre></td></tr></table></figure>
<p>下面的例子就说明了这种用法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data4.txt10</div><div class="line">5</div><div class="line">13</div><div class="line">50</div><div class="line">34</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;if($1 &gt; 20) print $1&#125;' data4.txt</div><div class="line">50</div><div class="line">34</div></pre></td></tr></table></figure>
<p>如果需要在if语句中执行多条语句，就必须用花括号将它们括起来，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> if($1&gt;20)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> x=$1*2</div><div class="line"><span class="meta">&gt;</span> print x</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> &#125;' data4.txt</div><div class="line">100</div><div class="line">68</div></pre></td></tr></table></figure>
<p>gawk的if语句也支持else子句，允许在if语句条件不成立的情况下执行一条或多条语句，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> if ($1&gt;20)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> x=$1*2</div><div class="line"><span class="meta">&gt;</span> print x</div><div class="line"><span class="meta">&gt;</span> &#125; else</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> x=$1/2</div><div class="line"><span class="meta">&gt;</span> print x</div><div class="line"><span class="meta">&gt;</span> &#125;&#125;' data4.txt</div><div class="line">5</div><div class="line">2.5</div><div class="line">6.5</div><div class="line">100</div><div class="line">68</div></pre></td></tr></table></figure>
<p>可以在单行上使用else子句，但必须在if语句部分之后使用分号，格式为<code>if (condition) statement1; else statement2</code>，案例如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;if ($1&gt;20) print $1*2;else print $1/2&#125;' data4.txt</div><div class="line">5</div><div class="line">2.5</div><div class="line">6.5</div><div class="line">100</div><div class="line">68</div></pre></td></tr></table></figure>
<h3 id="while-语句">while 语句</h3>
<p>whlie语句的基本格式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">while (conditoin)</div><div class="line">&#123;</div><div class="line">    statements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>while循环可以遍历一组数据，并检查迭代的结束条件。如果在计算中必须使用每条记录中的多个数据值，就能够使用到while语句，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data5.txt </div><div class="line">130 120 135</div><div class="line">160 113 140 </div><div class="line">145 170 215</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> total=0</div><div class="line"><span class="meta">&gt;</span> i=1</div><div class="line"><span class="meta">&gt;</span> while(i&lt;4)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> total+=$i</div><div class="line"><span class="meta">&gt;</span> i++</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> avg=total/3</div><div class="line"><span class="meta">&gt;</span> print "Average:",avg</div><div class="line"><span class="meta">&gt;</span> &#125;' data5.txt</div><div class="line">Average: 128.333</div><div class="line">Average: 137.667</div><div class="line">Average: 176.667</div></pre></td></tr></table></figure>
<p>while语句会遍历记录中的数据字段，将每个值都加到total变量上，并将计数器变量i增值。当计数器值等于4时，while的条件变成了FALSE，循环结束，然后执行脚本中的下一条语句。这条语句会计算并打印出平均值。这个过程会在数据文件中的每条记录上不断重复。</p>
<p>gawk编程语言支持在while循环中使用<code>break</code>语句和<code>continue</code>语句，允许你从循环中跳出，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> total=0</div><div class="line"><span class="meta">&gt;</span> i=1</div><div class="line"><span class="meta">&gt;</span> while(i&lt;4)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> total +=$i</div><div class="line"><span class="meta">&gt;</span> if(i==2)</div><div class="line"><span class="meta">&gt;</span> break</div><div class="line"><span class="meta">&gt;</span> i++</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> avg=total/2</div><div class="line"><span class="meta">&gt;</span> print "The average of the first two data elements is:",avg</div><div class="line"><span class="meta">&gt;</span> &#125;' data5.txt</div><div class="line">The average of the first two data elements is: 125</div><div class="line">The average of the first two data elements is: 136.5</div><div class="line">The average of the first two data elements is: 157.5</div></pre></td></tr></table></figure>
<p>break语句用来在i变量的值为2时从while循环中跳出。</p>
<h3 id="do-while-语句">do-while 语句</h3>
<p><code>do-while</code>语句会在检查条件语句之前执行命令，下面是do-while语句的格式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">do</div><div class="line">&#123;</div><div class="line">    statements</div><div class="line">    &#125; while(condition)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种格式保证了语句会在条件被求值之前至少执行一次，当需要在求值条件前执行语句时，这个特性非常方便，案例如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> total=0</div><div class="line"><span class="meta">&gt;</span> i=1</div><div class="line"><span class="meta">&gt;</span> do</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> total+=$i</div><div class="line"><span class="meta">&gt;</span> i++</div><div class="line"><span class="meta">&gt;</span> &#125; while (total&lt;150)</div><div class="line"><span class="meta">&gt;</span> print total&#125;' data5.txt</div><div class="line">250</div><div class="line">160</div><div class="line">315</div></pre></td></tr></table></figure>
<p>这个脚本会读取每条记录的数据字段并将它们加在一起，直到累加结果达到150。如果第一个数据字段大于150（就像在第二条记录中看到的那样），则脚本会保证在条件被求值前至少读取第一个数据字段的内容。</p>
<h3 id="for语句">for语句</h3>
<p>格式为<code>for (variable assignment; condition; iteration process)</code>，案例如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> total=0</div><div class="line"><span class="meta">&gt;</span> for (i=1;i&lt;4;i++)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> total+=$i</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> avg=total/3</div><div class="line"><span class="meta">&gt;</span> print "Average:",avg</div><div class="line"><span class="meta">&gt;</span> &#125;' data5.txt</div><div class="line">Average: 128.333</div><div class="line">Average: 137.667</div><div class="line">Average: 176.667</div></pre></td></tr></table></figure>
<h3 id="格式化打印">格式化打印</h3>
<p>gawk中的格式化打印命令是<code>printf</code>，格式为<code>printf &quot;format string&quot;,vaar1,var2...</code>，其中<code>format string</code>是关键部分，它会用文本元素和格式化指定符</p>
<p>来具体指定如何呈现格式化输出。格式化指定符是一种特殊的代码，会指明显示什么类型的变量以及如何显示。gawk程序会将每个格式化指定符作为占位符，供命令中的变量使用。第一个格式化指定符对应列出的第一个变量，第二个对应第二个变量，依此类推。格式化指定符的格式为<code>%[modifier] control-letter</code>，其中，<code>control-letter</code>是一个单字符代码，用于指明显示什么类型的数据，而<code>modifier</code>则定义了可选的格式化特性。下列出了可用在格式化指定符中的控制字母（其实很多编程语言的格式化输出大同小异）。</p>
<table>
<thead>
<tr class="header">
<th>控制字母</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>c</td>
<td>将一个数作为ASCII字符显示</td>
</tr>
<tr class="even">
<td>d</td>
<td>显示一个整数值</td>
</tr>
<tr class="odd">
<td>i</td>
<td>显示一个整数值（跟 d 一样）</td>
</tr>
<tr class="even">
<td>e</td>
<td>用科学计数法显示一个数</td>
</tr>
<tr class="odd">
<td>f</td>
<td>显示一个浮点值</td>
</tr>
<tr class="even">
<td>g</td>
<td>用科学计数法或浮点数显示（选择较短的格式）</td>
</tr>
<tr class="odd">
<td>o</td>
<td>显示一个八进制值</td>
</tr>
<tr class="even">
<td>s</td>
<td>显示一个文本字符串</td>
</tr>
<tr class="odd">
<td>x</td>
<td>显示一个十六进制值</td>
</tr>
<tr class="even">
<td>X</td>
<td>显示一个十六进制值，但用大写字母A~F</td>
</tr>
</tbody>
</table>
<p>因此，如果显示一个字符串变量，可以用格式化指定符<code>%s</code>。如果要显示一个整数值，可以用<code>%d</code>或<code>%i</code>（<code>%d</code>是十进制数的C风格显示方式）。如果你要用科学计数法显示很大的值，就用<code>%e</code>格式化指定符，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> x=10*100</div><div class="line"><span class="meta">&gt;</span> printf "The answer is: %e\n",x</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">The answer is: 1.000000e+03</div></pre></td></tr></table></figure>
<p>除了控制字母外，还有3种修饰符可以用来进一步控制输出：</p>
<ol style="list-style-type: decimal">
<li><code>width</code>：指定了输出字段最小宽度的数字值。如果输出短于这个值， printf 会将文本右 对齐，并用空格进行填充。如果输出比指定的宽度还要长，则按照实际的长度输出。 </li>
<li><code>prec</code>：这是一个数字值，指定了浮点数中小数点后面位数，或者文本字符串中显示的最 大字符数。 </li>
<li><code>- （减号）</code>：指明在向格式化空间中放入数据时采用左对齐而不是右对齐。</li>
</ol>
<p>下面是一个案例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data2.txt</div><div class="line">Riley Mullen</div><div class="line">123 Main Street</div><div class="line">Chicago, IL  60601</div><div class="line">(312)555-1234</div><div class="line"></div><div class="line">Frank Williams</div><div class="line">456 Oak Street</div><div class="line">Indianapolis, IN  46201</div><div class="line">(317)555-9876</div><div class="line"></div><div class="line">Haley Snell</div><div class="line">4231 Elm Street</div><div class="line">Detroit, MI 48201</div><div class="line">(313)555-4938</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS="\n";RS=""&#125;&#123;print $1,$4&#125;' data2.txt</div><div class="line">Riley Mullen (312)555-1234</div><div class="line">Frank Williams (317)555-9876</div><div class="line">Haley Snell (313)555-4938</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS="\n";RS=""&#125;&#123;printf "%s %s\n",$1,$4&#125;' data2.txt</div><div class="line">Riley Mullen (312)555-1234</div><div class="line">Frank Williams (317)555-9876</div><div class="line">Haley Snell (313)555-4938</div><div class="line"><span class="meta">#</span> printf会产生跟print命令相同的输出。printf命令用%s格式化指定符来作为这两个字符串值的占位符。</div></pre></td></tr></table></figure>
<p>在printf命令的末尾手动添加换行符来生成新行。没添加的话，printf命令会继续在同一行打印后续输出。如果需要用几个单独的printf命令在同一行上打印多个输出，这就会非常有用，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125;&#123;printf "%s ",$1&#125;' data1.txt</div><div class="line">Data11 data21 data31 biotest@ubuntu:~/advance_gawk$ gawtf "%s ",$1&#125; END&#123;printf "\n"&#125;' data1.txt</div><div class="line">Data11 data21 data31 </div><div class="line">biotest@ubuntu:~/advance_gawk$</div></pre></td></tr></table></figure>
<p>从结果可以看出，第一次命令没有加换行符，结果出来后直接就是命令提示符，即<code>biotest@ubuntu:~/advance_gawk$</code>，如果加换行符后，就正常了，再看一个案例，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data2.txtRiley Mullen</div><div class="line">123 Main Street</div><div class="line">Chicago, IL  60601</div><div class="line">(312)555-1234</div><div class="line"></div><div class="line">Frank Williams</div><div class="line">456 Oak Street</div><div class="line">Indianapolis, IN  46201</div><div class="line">(317)555-9876</div><div class="line"></div><div class="line">Haley Snell</div><div class="line">4231 Elm Street</div><div class="line">Detroit, MI 48201</div><div class="line">(313)555-4938</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS="\n";RS=""&#125;&#123;printf "%16s %s\n",$1,$4&#125;' data2.txt</div><div class="line">    Riley Mullen (312)555-1234</div><div class="line">  Frank Williams (317)555-9876</div><div class="line">     Haley Snell (313)555-4938</div></pre></td></tr></table></figure>
<p>通过添加一个值为16的修饰符，这表示强制第一个字符串的输出宽度为16个字符。默认情况下，printf命令使用右对齐来将数据放到格式化空间中。要改成左对齐，只需给修饰符加一个减号即可，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS="\n";RS=""&#125;&#123;printf "%-16s %s\n",$1,$4&#125;' data2.txt</div><div class="line">Riley Mullen     (312)555-1234</div><div class="line">Frank Williams   (317)555-9876</div><div class="line">Haley Snell      (313)555-4938</div></pre></td></tr></table></figure>
<p>printf命令也能处理浮点值，通过为变量指定一个格式，可以让输出看起来更统一，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data5.txt</div><div class="line">130 120 135</div><div class="line">160 113 140 </div><div class="line">145 170 215</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '&#123;</div><div class="line"><span class="meta">&gt;</span> total=0</div><div class="line"><span class="meta">&gt;</span> for (i=0;i&lt;4;i++)</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> total+=$i</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> avg=total/3</div><div class="line"><span class="meta">&gt;</span> printf "Average: %5.1f\n",avg</div><div class="line"><span class="meta">&gt;</span> &#125;' data5.txt</div><div class="line">Average: 171.7</div><div class="line">Average: 191.0</div><div class="line">Average: 225.0</div></pre></td></tr></table></figure>
<p>可以使用<code>%5.1f</code>格式指定符来强制printf命令输出5位的浮点数，并且将浮点值近似到小数点后一位。</p>
<h2 id="内建函数">内建函数</h2>
<p>gawk内置了一些处理数字、字符串以及时间的函数。</p>
<h3 id="数学函数">数学函数</h3>
<p>如下表所示：</p>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>atan2(x, y)</td>
<td>x/y的反正切，x和y以弧度为单位</td>
</tr>
<tr class="even">
<td>cos(x)</td>
<td>x的余弦，x以弧度为单位</td>
</tr>
<tr class="odd">
<td>exp(x)</td>
<td>x的指数函数</td>
</tr>
<tr class="even">
<td>int(x)</td>
<td>x的整数部分，取靠近零一侧的值，5.6取5，-5.6取-5。</td>
</tr>
<tr class="odd">
<td>log(x)</td>
<td>x的自然对数</td>
</tr>
<tr class="even">
<td>rand( )</td>
<td>比0大比1小的随机浮点值，创建随机数</td>
</tr>
<tr class="odd">
<td>sin(x)</td>
<td>x的正弦，x以弧度为单位</td>
</tr>
<tr class="even">
<td>sqrt(x)</td>
<td>x的平方根</td>
</tr>
<tr class="odd">
<td>srand(x)</td>
<td>为计算随机数指定一个种子值</td>
</tr>
</tbody>
</table>
<p>gawk语言对于它能够处理的数值有一个限定区间，如果超出了这个区间，就会得到一条错误消息，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;x=exp(100);print x&#125;'</div><div class="line">26881171418161356094253400435962903554686976</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;x=exp(1000);print x&#125;'</div><div class="line">gawk: cmd. line:1: warning: exp: argument 1000 is out of range</div><div class="line">inf</div></pre></td></tr></table></figure>
<p>第一个例子会计算e的100次幂，虽然数值很大，但尚在系统的区间内。第二个例子尝试计算e的1000次幂，已经超出了系统的数值区间，所以就生成了一条错误消息。</p>
<p>gawk还有一些按位操作数据的函数，如下表所示：</p>
<table>
<thead>
<tr class="header">
<th>运算</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>and(v1,v2)</td>
<td>执行值v1和v2的按位与运算。</td>
</tr>
<tr class="even">
<td>compl(val)</td>
<td>执行val的补运算。</td>
</tr>
<tr class="odd">
<td>lshift(val,count)</td>
<td>将值val左移count位</td>
</tr>
<tr class="even">
<td>or(v1,v2)</td>
<td>执行值v1和v2的按位或运算</td>
</tr>
<tr class="odd">
<td>rshift(val,count)</td>
<td>将值val右移count位。</td>
</tr>
<tr class="even">
<td>xor(v1,v2)</td>
<td>执行值v1和v2的按位异或运算。</td>
</tr>
</tbody>
</table>
<p>位操作函数通常用于听任二进制值时。</p>
<h3 id="字符串函数">字符串函数</h3>
<p>gawk的字符串函数如下表所示：</p>
<table>
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asort(s[,d])</td>
<td>将数组s按数据元素值排序。索引值会被替换成表示新的排序顺序的连续数字。另外，如果指定了d，则排序后的数组会存储在数组d中</td>
</tr>
<tr class="even">
<td>asorti(s[,d])</td>
<td>将数组s按索引值排序。生成的数组会将索引值作为数据元素值，用连续数字索引来表明排序顺序。另外如果指定了d，排序后的数组会存储在数组d中</td>
</tr>
<tr class="odd">
<td>gensub(r,s,h[,t])</td>
<td>查找变量$0或目标字符串t（如果提供了的话）来匹配正则表达式r。如果h是一个以g或G开头的字符串，就用s替换掉匹配的文本。如果h是一个数字，它表示要替换掉第h处r匹配的地方</td>
</tr>
<tr class="even">
<td>gsub(r,s[,t])</td>
<td>查找变量$0或目标字符串t（如果提供了的话）来匹配正则表达式r。如果找到了，就全部替换成字符串s</td>
</tr>
<tr class="odd">
<td>index(s,t)</td>
<td>返回字符串t在字符串s中的索引值，如果没找到的话返回0</td>
</tr>
<tr class="even">
<td>length([s])</td>
<td>返回字符串s的长度；如果没有指定的话，返回$0的长度</td>
</tr>
<tr class="odd">
<td>match(s,r[,a])</td>
<td>返回字符串s中正则表达式r出现位置的索引。如果指定了数组a，它会存储s中匹配正则表达式的那部分</td>
</tr>
<tr class="even">
<td>split(s,a[,r])</td>
<td>将s用FS字符或正则表达式r（如果指定了的话）分开放到数组a中。返回字段的总数</td>
</tr>
<tr class="odd">
<td>sprintf(format,variables)</td>
<td>用提供的format和variables返回一个类似于printf输出的字符串</td>
</tr>
<tr class="even">
<td>sub(r,s[,t])</td>
<td>在变量$0或目标字符串t中查找正则表达式r的匹配。如果找到了，就用字符串s替换掉第一处匹配</td>
</tr>
<tr class="odd">
<td>substr(s,i[,n])</td>
<td>返回s中从索引值i开始的n个字符组成的子字符串。如果未提供n，则返回s剩下的部分</td>
</tr>
<tr class="even">
<td>tolower(s)</td>
<td>将s中的所有字符转换成小写</td>
</tr>
<tr class="odd">
<td>toupper(s)</td>
<td>将s中的所有字符转换成大写</td>
</tr>
</tbody>
</table>
<p>下面是一个案例: <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;x="testing";print toupper(x);print length(x)&#125;'</div><div class="line">TESTING</div><div class="line">7</div></pre></td></tr></table></figure></p>
<p>但一些字符串函数的用法相当复杂。asort和asorti函数是新加入的gawk函数，允许你基于数据元素值（asort）或索引值（asorti）对数组变量进行排序。这里有个使用asort的例子。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line">var["a"]=11</div><div class="line">var["g"]=2</div><div class="line">var["m"]=31</div><div class="line">var["u"]=14</div><div class="line">asort(var,test)</div><div class="line">for(i in test)</div><div class="line">print "Index:",i," - value:",test[i]</div><div class="line">&#125;'</div><div class="line">Index: 1  - value: 2</div><div class="line">Index: 2  - value: 11</div><div class="line">Index: 3  - value: 14</div><div class="line">Index: 4  - value: 31</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line">var["a"]=11</div><div class="line">var["g"]=2</div><div class="line">var["m"]=31</div><div class="line">var["u"]=14</div><div class="line">asorti(var,test)</div><div class="line">for(i in test)</div><div class="line">print "Index:",i," - value:",test[i]</div><div class="line">&#125;'</div><div class="line">Index: 1  - value: a</div><div class="line">Index: 2  - value: g</div><div class="line">Index: 3  - value: m</div><div class="line">Index: 4  - value: u</div></pre></td></tr></table></figure>
<p>从结果可以看出，新数组test含有排序后的原数组的数据元素，但索引值现在变为表明正确顺序的数字值了。asort是对数组的值进行排序；而asorti是对数组的索引进行排序。</p>
<p>split 函数是将数据字段放到数组中以供进一步处理的好办法，如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data1.txt</div><div class="line">Data11,data12,data13,data14,data15</div><div class="line">data21,data22,data23,data24,data25</div><div class="line">data31,data32,data33,data34,data35</div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;FS=","&#125;&#123;</div><div class="line"><span class="meta">&gt;</span> split($0,var)</div><div class="line"><span class="meta">&gt;</span> print var[1],var[5]</div><div class="line"><span class="meta">&gt;</span> &#125;' data1.txt</div><div class="line">Data11 data15</div><div class="line">data21 data25</div><div class="line">data31 data35</div></pre></td></tr></table></figure></p>
<p>新数组使用连续数字作为数组索引，从含有第一个数据字段的索引值 1 开始。</p>
<h3 id="时间函数">时间函数</h3>
<p>gawk的时间是函数下如下表所示：</p>
<table>
<colgroup>
<col width="32%">
<col width="67%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>mktime(datespec)</td>
<td>将一个按YYYY MM DD HH MM SS [DST]格式指定的日期转换成时间戳值</td>
</tr>
<tr class="even">
<td>strftime(format [,timestamp])</td>
<td>将当前时间的时间戳或timestamp（如果提供了的话）转化格式化日期（采用shell函数date()的格式）</td>
</tr>
<tr class="odd">
<td>systime( )</td>
<td>返回当前时间的时间戳</td>
</tr>
</tbody>
</table>
<p>时间函数常用来处理日志文件，而日志文件则常含有需要进行比较的日期。通过将日期的文本表示形式转换成epoch时间（自1970-01-0100:00:00UTC到现在的秒数），可以轻松地比较日期。下面是在gawk程序中使用时间函数的例子。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk 'BEGIN&#123;</div><div class="line"><span class="meta">&gt;</span> date=systime()</div><div class="line"><span class="meta">&gt;</span> day=strftime("%A,%B %d,%Y",date)</div><div class="line"><span class="meta">&gt;</span> print day</div><div class="line"><span class="meta">&gt;</span> &#125;'</div><div class="line">Tuesday,May 15,2018</div></pre></td></tr></table></figure>
<p>该例用systime函数从系统获取当前的epoch时间戳，然后用strftime函数将它转换成用户可读的格式，转换过程中使用了shell命令date的日期格式化字符。</p>
<h2 id="自定义函数">自定义函数</h2>
<p>自定义函数需要用到function关键字，如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function name([variables])</div><div class="line">&#123;</div><div class="line">    statements    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面看一个简单的函数： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function printthird()</div><div class="line">&#123;</div><div class="line">    print $3</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个函数会打印记录中的第3个数据字段，函数还可以使用return语句返回值，即<code>return value</code>，值可以是变量，也可以是表达，如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">funciotn myrand(limit)</div><div class="line">&#123;</div><div class="line">    return int(limit*rand())</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以将函数的返回值赋值给gawk程序中的一个变量，例如<code>x=myrand(100)</code>，这个变量包含函数的返回值。</p>
<h3 id="自定义函数使用">自定义函数使用</h3>
<p>在定义函数时，它必须出现在所有代码块之前（包括BEGIN代码块）。这种形式有助于将函数代码与gawk程序的其他部分分开，如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ gawk '</div><div class="line"><span class="meta">&gt;</span> function myprint()</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> printf "%-16s - %s\n",$1,$4</div><div class="line"><span class="meta">&gt;</span> &#125;</div><div class="line"><span class="meta">&gt;</span> BEGIN&#123;FS="\n";RS=""&#125;</div><div class="line"><span class="meta">&gt;</span> &#123;</div><div class="line"><span class="meta">&gt;</span> myprint()</div><div class="line"><span class="meta">&gt;</span> &#125;' data2.txt</div><div class="line">Riley Mullen     - (312)555-1234</div><div class="line">Frank Williams   - (317)555-9876</div><div class="line">Haley Snell      - (313)555-4938</div></pre></td></tr></table></figure></p>
<p>这个函数定义了myprint()函数，它会格式化记录中的第一个和第四个数据字段以供打印输出。gawk程序然后用该函数显示出数据文件中的数据。一旦定义了函数，就能在程序的代码中随意使用。在涉及很大的代码量时，这会省去许多工作。</p>
<p>### 创建函数库</p>
<p>gawk提供了一种途径来将多个函数 放到一个库文件中，这样能在所有的gawk程序中使用了，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> cat funclib </div><div class="line">function myprint()</div><div class="line">&#123;</div><div class="line">   printf "%-16s-%s\n",$1,$4</div><div class="line">&#125;</div><div class="line"></div><div class="line">function myrand(limit)</div><div class="line">&#123;</div><div class="line">   return int(limit*rand())</div><div class="line">&#125;</div><div class="line"></div><div class="line">function printthird()</div><div class="line">&#123;</div><div class="line">   print $3</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>funclib文件含有三个函数定义。需要使用<code>-f</code>命令行参数来使用它们。但不能将<code>-f</code>命令行参数和内联gawk脚本放到一起使用，不过可以在同一个命令行中使用多个<code>-f</code>参数。因此，要使用库，只要创建一个含有你的gawk程序的文件，然后在命令行上同时指定库文件和程序文件就行了，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat script4.sh</div><div class="line">BEGIN&#123; FS="\n";RS=""&#125;</div><div class="line">&#123;</div><div class="line">   myprint()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat data2.txt </div><div class="line">Riley Mullen</div><div class="line">123 Main Street</div><div class="line">Chicago, IL  60601</div><div class="line">(312)555-1234</div><div class="line"></div><div class="line">Frank Williams</div><div class="line">456 Oak Street</div><div class="line">Indianapolis, IN  46201</div><div class="line">(317)555-9876</div><div class="line"></div><div class="line">Haley Snell</div><div class="line">4231 Elm Street</div><div class="line">Detroit, MI 48201</div><div class="line">(313)555-4938</div><div class="line"></div><div class="line">biotest@ubuntu:~/advance_gawk$ gawk -f funclib.sh -f script4.sh data2.txt</div><div class="line">Riley Mullen    -(312)555-1234</div><div class="line">Frank Williams  -(317)555-9876</div><div class="line">Haley Snell     -(313)555-4938</div></pre></td></tr></table></figure></p>
<h2 id="实例">实例</h2>
<p>现在有一个数据文件，其中包含了两支队伍（每队两名选手）的保龄球比赛 得分情况，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ cat scores.txt </div><div class="line">Rich Blum, team1, 100,115,95</div><div class="line">Barbara Blum, team1, 110, 115,100</div><div class="line">Christine Bresnahan, team2, 120, 115,118</div><div class="line">Time Bresnahan, team2, 125, 112, 116</div></pre></td></tr></table></figure>
<p>每位选手都有三场比赛的成绩，这些成绩都保存在数据文件中，每位选手由位于第二列的队名来标识。下面的脚本对每队的成绩进行了排序，并计算了总分和平均分，如下所示： <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>!/bin/bash</div><div class="line"></div><div class="line">for team in $(gawk 'BEGIN&#123;FS=","&#125;&#123;print $2&#125;' scores.txt| uniq)</div><div class="line">do</div><div class="line">    gawk -v team=$team 'BEGIN&#123;FS=",";total=0&#125;</div><div class="line">    &#123;</div><div class="line">        if($2==team)</div><div class="line">        &#123;</div><div class="line">            total+=$3+$4+$5;</div><div class="line">        &#125;</div><div class="line">     &#125;</div><div class="line">     END &#123;</div><div class="line">         avg=total/6;</div><div class="line">         print "Total for",team, "is",total,",the average is",avg</div><div class="line">&#125;' scores.txt</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>运行结果如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/advance_gawk$ bash bowling.sh </div><div class="line">Total for team1 is 635 ,the average is 105.833</div><div class="line">Total for team2 is 706 ,the average is 117.667</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" <i class="fa fa-tag"></i> Linux</a>
          
            <a href="/tags/脚本/" <i class="fa fa-tag"></i> 脚本</a>
          
            <a href="/tags/Shell/" <i class="fa fa-tag"></i> Shell</a>
          
            <a href="/tags/文本处理/" <i class="fa fa-tag"></i> 文本处理</a>
          
            <a href="/tags/gawk/" <i class="fa fa-tag"></i> gawk</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/10/Linux-shell10-sed进阶/" rel="next" title="Shell学习笔记（10）——sed进阶">
                <i class="fa fa-chevron-left"></i> Shell学习笔记（10）——sed进阶
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/12/Perl学习笔记（1）-基础笔记/" rel="prev" title="Perl学习笔记（1）-基础语法">
                Perl学习笔记（1）-基础语法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#在gawk中使用变量"><span class="nav-number">1.</span> <span class="nav-text">在gawk中使用变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内建变量"><span class="nav-number">1.1.</span> <span class="nav-text">内建变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#字段和记录分隔符变量"><span class="nav-number">1.1.1.</span> <span class="nav-text">字段和记录分隔符变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据变量"><span class="nav-number">1.1.2.</span> <span class="nav-text">数据变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义变量"><span class="nav-number">1.2.</span> <span class="nav-text">自定义变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在脚本中给变量赋值"><span class="nav-number">1.2.1.</span> <span class="nav-text">在脚本中给变量赋值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在命令行上给变量赋值"><span class="nav-number">1.2.2.</span> <span class="nav-text">在命令行上给变量赋值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理数组"><span class="nav-number">2.</span> <span class="nav-text">处理数组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义数组变量"><span class="nav-number">2.1.</span> <span class="nav-text">定义数组变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遍历数组变量"><span class="nav-number">2.2.</span> <span class="nav-text">遍历数组变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除数组变量"><span class="nav-number">2.3.</span> <span class="nav-text">删除数组变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用模式"><span class="nav-number">3.</span> <span class="nav-text">使用模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#正则表达式"><span class="nav-number">3.1.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配操作符"><span class="nav-number">3.2.</span> <span class="nav-text">匹配操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数学表达式"><span class="nav-number">3.3.</span> <span class="nav-text">数学表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结构化命令"><span class="nav-number">4.</span> <span class="nav-text">结构化命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if语句"><span class="nav-number">4.1.</span> <span class="nav-text">if语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while-语句"><span class="nav-number">4.2.</span> <span class="nav-text">while 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#do-while-语句"><span class="nav-number">4.3.</span> <span class="nav-text">do-while 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for语句"><span class="nav-number">4.4.</span> <span class="nav-text">for语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#格式化打印"><span class="nav-number">4.5.</span> <span class="nav-text">格式化打印</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内建函数"><span class="nav-number">5.</span> <span class="nav-text">内建函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数学函数"><span class="nav-number">5.1.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串函数"><span class="nav-number">5.2.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时间函数"><span class="nav-number">5.3.</span> <span class="nav-text">时间函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义函数"><span class="nav-number">6.</span> <span class="nav-text">自定义函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义函数使用"><span class="nav-number">6.1.</span> <span class="nav-text">自定义函数使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">7.</span> <span class="nav-text">实例</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共247.2k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
