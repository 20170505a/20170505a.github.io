<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="if语句 用法如下所示： 12if(条件) 表达式if(条件) 表达式1 else 表达式2 其中if语句具体就是包含下面3个元素：  关键字if； 条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE； 执行语句，也就是上面提到的表达式。  if语句案例1-简单案例 先看一个简单的案例，代码如下所示： 12345p &amp;lt;- 0.03 ;&amp;#123;if (p &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言笔记之循环语句">
<meta property="og:url" content="http://rvdsd.top/2017/04/10/R/R语言笔记之循环语句/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:description" content="if语句 用法如下所示： 12if(条件) 表达式if(条件) 表达式1 else 表达式2 其中if语句具体就是包含下面3个元素：  关键字if； 条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE； 执行语句，也就是上面提到的表达式。  if语句案例1-简单案例 先看一个简单的案例，代码如下所示： 12345p &amp;lt;- 0.03 ;&amp;#123;if (p &amp;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim">
<meta property="og:updated_time" content="2019-06-22T06:17:21.490Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R语言笔记之循环语句">
<meta name="twitter:description" content="if语句 用法如下所示： 12if(条件) 表达式if(条件) 表达式1 else 表达式2 其中if语句具体就是包含下面3个元素：  关键字if； 条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE； 执行语句，也就是上面提到的表达式。  if语句案例1-简单案例 先看一个简单的案例，代码如下所示： 12345p &amp;lt;- 0.03 ;&amp;#123;if (p &amp;">
<meta name="twitter:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/2017/04/10/R/R语言笔记之循环语句/"/>





  <title>R语言笔记之循环语句 | RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/10/R/R语言笔记之循环语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">R语言笔记之循环语句</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T12:00:00+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,133
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="if语句">if语句</h2>
<p>用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件) 表达式</div><div class="line"><span class="keyword">if</span>(条件) 表达式<span class="number">1</span> <span class="keyword">else</span> 表达式<span class="number">2</span></div></pre></td></tr></table></figure>
<p>其中<code>if</code>语句具体就是包含下面3个元素：</p>
<ol style="list-style-type: decimal">
<li>关键字<code>if</code>；</li>
<li>条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE；</li>
<li>执行语句，也就是上面提到的<code>表达式</code>。</li>
</ol>
<h3 id="if语句案例1-简单案例"><code>if</code>语句案例1-简单案例</h3>
<p>先看一个简单的案例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line"><span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line"><span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line">+     <span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">+         print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line">+     <span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">+ &#125;</div><div class="line">[<span class="number">1</span>] <span class="string">"p&lt;=0.05!"</span></div></pre></td></tr></table></figure>
<h3 id="if语句案例2-函数体中添加if语句"><code>if</code>语句案例2-函数体中添加if语句</h3>
<p>现在编写一个函数,命名为<code>priceCalulator()</code>，这个函数的功能在于按照服务时长计算应该收取的费用，函数接收2个参数，分别是服务时长（hours）与每小时的单价(pph)，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在如果我们还要添加一个功能，例如有一批大客户，如果他们的服务需求时间长高于100小时，就打9折，也就是说，如果hours大于100，最后的总价乘以0.9，代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>)&#123;</div><div class="line">    net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  &#125;</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours = <span class="number">55</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2200</span></div><div class="line">&gt; priceCalculator(hours = <span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">3960</span></div></pre></td></tr></table></figure>
<h3 id="if语句的省略形式"><code>if</code>语句的省略形式</h3>
<p>如果if语句的条件只有一行的话，那么就可以省略两旁的大括号，例如前面的服务计费案例可以改为如下形式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div></pre></td></tr></table></figure>
<p>完整的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ifelse语句"><code>ifelse</code>语句</h2>
<p><code>if...else</code>是<code>if</code>条件语句的扩展，它的用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件语句<span class="number">1</span>)&#123;</div><div class="line">    表达式<span class="number">1</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;表达式<span class="number">2</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<p>其中，当<code>条件语句1</code>为<code>TRUE</code>时，执行<code>表达式1</code>，当<code>条件语句1</code>为<code>FALSE</code>时，执行<code>表达式2</code>。</p>
<p>还以前面的<code>if</code>语句中的服务费用案例继续说明一下，在一些国家，针对不同类型的客户（公共组织或私有组织），除了就会的服务费外，还会收取不同的税(VAT)，假设公共组织需要支付6%的VAT，而私有组织需要支付12%的VAT，此时可以在<code>priceCalculator()</code>函数中添加一个新的参数<code>public</code>，用于判断组织是否是公共组织，现在代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例如同样工作25时，对于公共和私有组织客户的收费是不一样的，计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">TRUE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">FALSE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程就使用到了<code>if...else...</code>语句，如果参数<code>public</code>的值为<code>TRUE</code>，那么税后价是总价乘以1.06，否则要乘以1.12。</p>
<p>对于<code>if...else...</code>语句的表达式而言，如果只有一行代码，可以省略大括号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(public) tot.price &lt;- net.price * <span class="number">1.06</span> <span class="keyword">else</span></div><div class="line">  tot.price &lt;- net.price * <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>其中<code>else</code>要放到行末，不能放到下一行的行首，这是因为只要一个命令明显没有结束，R会自动读取多行代码，将它们合成一行，如果<code>else</code>没有放在行末，那么R会认为第一行代码已经结束，从而在执行下一行代码时报错，只有当条件表达式出现在函数中，并且一次性地Source整个脚本文件时，else才能出现在行首。</p>
<p><code>if...else...</code>还能继续简化，我们可以把<code>if</code>理解为一个函数，它的计算结果是<code>TRUE</code>或<code>FALSE</code>，因此可以把if表达式赋予一个对象，或者直接用到计算中，这里可以省略重新计算<code>net.price</code>的过程，直接将结果赋给tot.price`，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot.price &lt;- net.price * <span class="keyword">if</span>(public) <span class="number">1.06</span> <span class="keyword">else</span> <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>如果这么写，R会先执行<code>if...else</code>表达式，得到结果后，再乘以<code>net.price</code>，然后将结果赋给<code>tot.price</code>。</p>
<h2 id="判断选择的向量化">判断选择的向量化</h2>
<p>还以上面的<code>priceCalculator()</code>函数为例说明一下，这个函数的参数是一个数，而非一个向量，如果要计算一个向量就会出现警告信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span></div><div class="line">Warning message:</div><div class="line">In <span class="keyword">if</span> (hours &gt; <span class="number">100</span>) net.price &lt;- net.price * <span class="number">0.9</span> :</div><div class="line">  the condition has length &gt; <span class="number">1</span> and only the first element will be used</div></pre></td></tr></table></figure>
<p>从警告信息可以看出，R会告诉我们丢失了一些信息，并且反映出了整个计算结果就是错误的，因此第二个客户的最终结果应该是4198，而非4664，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4198</span></div></pre></td></tr></table></figure>
<p>这是因为警告信息中提示，<code>if</code>表达式只能处理单个值，而<code>hours &gt; 100</code>返回的是两个值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; c (<span class="number">25</span>, <span class="number">110</span>) &gt; <span class="number">100</span></div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<h2 id="ifelse函数"><code>ifelse()</code>函数</h2>
<p>如果使用<code>ifelse()</code>函数就能解决上面提到的问题，<code>ifelse()</code>函数接收3个参数：</p>
<ol style="list-style-type: decimal">
<li>包含逻辑值的条件向量；</li>
<li>包含返回值的向量，它仅在对应条件向量值为TRUE时才被返回；</li>
<li>另外一个包含返回值的向量，它仅在对应条件向量为FALSE时才被返回。</li>
</ol>
<h3 id="ifelse案例1-简单案例"><code>ifelse</code>案例1-简单案例</h3>
<p>先看一个简单的<code>ifelse</code>案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(c(<span class="number">1</span>,<span class="number">3</span>) &lt; <span class="number">2.5</span>, <span class="number">1</span>:<span class="number">2</span>, <span class="number">3</span>:<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>这行语句的运行过程为：</p>
<ol style="list-style-type: decimal">
<li>条件表达式<code>c(1,3) &lt; 2.5</code>被解析成一个逻辑向量，计算结果为<code>[1]  TRUE FALSE</code>；</li>
<li>这个逻辑向量的第一个值为<code>TRUE</code>，因此1确实小于2.5，所以结果向量的第1个元素为第2个参数的第1个元素，也就是1；</li>
<li>条件向量的第2个值为<code>FALSE</code>，因为3比2.5大，所以<code>ifelse()</code>函数将取第3个参数的第2个值（也就是4）作为结果向量的第2个元素。</li>
<li>把选出的值合成一个向量作为结果返回。</li>
</ol>
<p>再来看一个简单的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">ifelse(x != <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) </div><div class="line"><span class="comment"># 若果x的值不等于1，输出1，否则输出0</span></div><div class="line"><span class="comment"># [1] 0 0 0 1 1 0 0</span></div></pre></td></tr></table></figure>
<p>现在我们更改<code>priceCalculator()</code>函数，假设有2个客户，服务时长分别为25小时和110小时，那么就可以采用下面的代码完成计算：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; my.hours &lt;- c(<span class="number">25</span>, <span class="number">110</span>)</div><div class="line">&gt; my.hours*<span class="number">40</span>*ifelse(my.hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">3960</span></div></pre></td></tr></table></figure>
<p>在上面的代码中，<code>ifelse()</code>函数会计算<code>my.hours &gt; 100</code>的结果，分别是<code>FALSE</code>和<code>TRUE</code>，其中，25对应的是<code>FALSE</code>，那么结果就是<code>my.hour*40*1</code>，110对应的是<code>TRUE</code>，结果就是<code>my.hour*40*0.9</code>。</p>
<p>现在继续改造<code>priceCalculator()</code>函数，例之成为真正能处理向量的函数，此时需要改造<code>public</code>参数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  net.price &lt;- net.price * ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price * ifelse(public, <span class="number">1.06</span>, <span class="number">1.12</span>)</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>, <span class="literal">FALSE</span>, <span class="literal">FALSE</span>)</div><div class="line">)</div><div class="line"></div><div class="line">with(clients, priceCalculator(hours, public = public))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; with(clients, priceCalculator(hours, public = public))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4198</span> <span class="number">5040</span> <span class="number">1792</span></div></pre></td></tr></table></figure>
<h3 id="ifelse案例2-在函数中添加ifelse">ifelse案例2-在函数中添加<code>ifelse</code></h3>
<p>看一个案例，有两个向量，分别为x和y，它们是时间序列，例如它们是每小时收集的气温和气压测量值，我们定义两者的相关性为x和y同时上升或下降次数占总观测数的比例（其实就是Kendall’s tau方法），也就是计算<code>y[i+1]-y[i]1</code>与<code>x[i+1]-x[i]</code>符号相同时的次数占总数<code>i</code>的比例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findud &lt;- <span class="keyword">function</span>(v)&#123;</div><div class="line">  vud &lt;- v[-<span class="number">1</span>]-v[-length(v)]</div><div class="line">  <span class="keyword">return</span>(ifelse(vud &gt; <span class="number">0</span>, <span class="number">1</span>,-<span class="number">1</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  ud &lt;- lapply(list(x,y),findud)</div><div class="line">  <span class="keyword">return</span>(mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">5</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">88</span>)</div><div class="line">&gt; y &lt;- c(<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">23</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">&gt; udcorr(x,y)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div></pre></td></tr></table></figure>
<p>在这个案例中，x和y在10次中同时上升3次（第一次同时上升是12到13，2到3），并同时下降1次，得到的相关性估计为4/10=0.4。</p>
<p>这个函数的思路就是先把x和y的值编码为1和-1，其中1代表当前观测值较前一个增加，-1表示减少，这个转换过程就是通过<code>vud &lt;- v[-1]-v[-length(v)]</code>这行代码实现的，它具体是怎么实现的呢，以向量x为例说明一下，看下面的示意图就行了：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，<code>x[-1]-x[-11]</code>表示的就是第2个元素减去第1个元素，第3个元素减去第2个元素等等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; x[-<span class="number">1</span>]-x[-<span class="number">11</span>]</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p><code>return(ifelse(vud &gt; 0, 1,-1))</code>这个语句就是把上面的向量再转换为1与-1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(x[-<span class="number">1</span>]-x[-<span class="number">11</span>] &gt;<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>)</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>接着又构建了一个<code>udcorr</code>这个函数。其中<code>ud &lt;- lapply(list(x,y),findud)</code>这行的功能就是，使用<code>lapply()</code>函数对xy构成的这个列表使用findud函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; list(x,y)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">4</span>  <span class="number">2</span>  <span class="number">3</span> <span class="number">23</span>  <span class="number">6</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span>  <span class="number">6</span>  <span class="number">3</span>  <span class="number">2</span></div><div class="line"></div><div class="line">&gt; lapply(list(x,y),findud)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span></div></pre></td></tr></table></figure>
<p>最后使用<code>return(mean(ud[[1]] == ud[[2]]))</code>这行代码来计算里面的均数，因为<code>ud[[1]] == ud[[2]]</code>的结果是一个逻辑向量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div></pre></td></tr></table></figure>
<p>对于逻辑向量来说，TRUE就是1，FALSE就是0，因此计算这个向量的均值就是计算TRUE占总向量数目的比例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]])</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div><div class="line"></div><div class="line"><span class="comment"># 逻辑向量也能使用数学函数，如下所示，TRUE就是1</span></div><div class="line">&gt; sum(c(<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div></pre></td></tr></table></figure>
<p>但是在R中，上面的代码可以用<code>diff()</code>这个函数来进行计算，这个函数可以对向量做“滞后”运算，这个运算的效果如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，这个滞后运算其实就是后一个数减去前一个数。与滞后运算相匹配的函数是<code>sign()</code>函数，它可以将正值与负值转换为1，-1或0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div><div class="line">&gt; sign(diff(x))</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>因此，我们可以把<code>undcorr()</code>函数换一种方式写，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  mean(sign(diff(x))==sign(diff(y)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ifelse案例3-转换某个字符串"><code>ifelse</code>案例3-转换某个字符串</h3>
<p><code>ifelse()</code>可以嵌套使用，看一个案例，<code>g</code>是一个鲍鱼的数据集，性别被编号为M、F或I（I是指Infant，幼虫的意思），现在我们将这些编号转换为1、2或3，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; g &lt;- c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>,<span class="string">"M"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; g</div><div class="line">[<span class="number">1</span>] <span class="string">"M"</span> <span class="string">"F"</span> <span class="string">"F"</span> <span class="string">"I"</span> <span class="string">"M"</span> <span class="string">"M"</span> <span class="string">"F"</span></div><div class="line">&gt; ifelse(g == <span class="string">"M"</span>,<span class="number">1</span>,ifelse(g == <span class="string">"F"</span>,<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程是这个样子的：</p>
<ol style="list-style-type: decimal">
<li>R先执行外层的<code>ifelse()</code>，其中当<code>g==&quot;M&quot;</code>时，返回1；否则就返回<code>ifelse(g == &quot;F&quot;,2,3)</code>；</li>
<li>当返回的是<code>ifelse(g == &quot;F&quot;,2,3)</code>，这是一个表达式，还能计算，那么如果<code>g==&quot;F&quot;</code>，就返回2，否则返回3。</li>
</ol>
<p>如果希望按照性别形成子集，那么可以使用<code>which()</code>函数寻找M、F或I对应元素的编号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; m &lt;- which(g == <span class="string">"M"</span>)</div><div class="line">&gt; f &lt;- which(g == <span class="string">"F"</span>)</div><div class="line">&gt; i &lt;- which(g == <span class="string">"I"</span>)</div><div class="line">&gt; m</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">&gt; f</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">&gt; i</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>如果想把这些子集保存在一个列表中，可以按下面的代码操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">grps &lt;- list()</div><div class="line"><span class="keyword">for</span> (gen <span class="keyword">in</span> c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>))&#123;</div><div class="line">  grps[[gen]] &lt;- which(g == gen)</div><div class="line">&#125;</div><div class="line">grps</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; grps</div><div class="line">$M</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">$<span class="literal">F</span></div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">$I</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<h3 id="嵌套if...else...表达式">嵌套<code>if...else...</code>表达式</h3>
<p>有的时候需要处理大于2种的选择，此时就需要使用嵌套<code>if...else...</code>嵌套语句，例如还以前面的<code>priceCalculator()</code>函数为例说明一下，客户假设说有3种，私有组织，税率为12%，公共组织税率为6%，国外客户为0%，现在改造<code>priceCalculator()</code>函数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(client ==<span class="string">'private'</span>)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">if</span>(client == <span class="string">'public'</span>)&#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2240</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2120</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2000</span></div></pre></td></tr></table></figure>
<p>虽然代码已经进行了改造，可以根据不同的客户类型计算不同的收费，但是此时这个函数还只一次只能处理一个值，无法进行向量化逻辑嵌套，对此，可以使用<code>ifelse()</code>函数进行嵌套，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- ifelse(client ==<span class="string">'private'</span>, <span class="number">1.12</span>, </div><div class="line">                ifelse(client==<span class="string">'public'</span>, <span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">privateData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>)</div><div class="line">)</div><div class="line">with(privateData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">publicData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">)</div><div class="line">with(publicData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">abroadData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(abroadData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">mixData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(mixData, priceCalculator(hours, client = type))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; with(privateData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4928</span> <span class="number">5600</span> <span class="number">1792</span></div><div class="line">&gt; </div><div class="line">&gt; publicData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(publicData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span> <span class="number">5300</span> <span class="number">1696</span></div><div class="line">&gt; </div><div class="line">&gt; abroadData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(abroadData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">4400</span> <span class="number">5000</span> <span class="number">1600</span></div><div class="line">&gt; </div><div class="line">&gt; mixData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(mixData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4664</span> <span class="number">5000</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="switch处理多种选择"><code>switch</code>处理多种选择</h2>
<p><code>if...else...</code>嵌套语句适用于多种条件的判断，假如判断的条件只有1个就不需要使用<code>if</code>嵌套，使用<code>switch()</code>函数即可。</p>
<p>在前面的<code>priceCalculator()</code>函数的案例中，税率实际上取决于客户的类型，即公共组织、私有组织或者外国客户，我们有3种可能，每种对应一种特定的税率，在这种情况下，就可以使用<code>switch</code>函数来简化判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>完整代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">numeric(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><code>switch()</code>函数调用的过程如下：</p>
<ol style="list-style-type: decimal">
<li>用一个单一值(Single Value)作为第1个参数（这里就是client），需要注意的是，<code>switch()</code>无法处理向量化数据，只能处理单一的数据，因此第1个参数不能是向量；</li>
<li>在第1个参数后，列出所有可能的情况及对应的值。</li>
<li>这里需要注意的是，我们只列出了3种情况，其实第3种情况<code>abroad</code>对应的是<code>其它情况</code>，如果使用其它的字符口中，则无法进行计算，后面会提到如何解这个问题。</li>
</ol>
<p><code>switch()</code>函数的第1个参数并不一定是一个特定的值，也可以是某个表达式，只要导出的结果是一个字符向量或数字即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">1</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some value"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">2</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"something else"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">3</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some more"</span></div></pre></td></tr></table></figure>
<h3 id="在switch中使用默认值">在<code>switch()</code>中使用默认值</h3>
<p>在<code>switch()</code>函数的调用中，并不需要列出所有可能的情况，如果对于所有不满足条件的判断值，都返回同一个结果的话，可以把这个结果放在参数列表的末尾，并去掉前面的判断值，因此可以看下面的代码，这与<code>ifelse</code>调用的结果一样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, pblic=<span class="number">1.06</span>, <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>现在就可以使用这个解决前面提出的那个问题了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div></pre></td></tr></table></figure>
<p>在<code>switch()</code>函数中的第3个参数里，把<code>abroad=1</code>改为<code>1</code>则就说明了，这是其他情况，而非仅仅是<code>abroad</code>这一种情况。</p>
<h2 id="for-循环">for 循环</h2>
<p><code>for</code>循环用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> values)&#123;</div><div class="line">    <span class="keyword">...</span> do someting...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="for循环案例1-简单案例"><code>for</code>循环案例1-简单案例</h3>
<p>先看一个for循环的最简单案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">cat(i);</div><div class="line">cat(<span class="string">" "</span>);</div><div class="line">i=i+<span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">+     cat(i);</div><div class="line">+     cat(<span class="string">" "</span>);</div><div class="line">+     i=i+<span class="number">3</span>;</div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></div></pre></td></tr></table></figure>
<p>从上面结果，我们可以看出，循环中处理的对象是1:20这20个数，对每个数进行操作不管循环内部i如何变化。因此，循环体内的i=i+3就不会对循环条件中的变量造成改变，具体执行过程相当于：<code>i=1</code> <code>-&gt;</code> <code>i=i+3</code>，此时<code>i=4</code>；<code>-&gt;</code> 第一次循环结束，第二次循环开始，<code>i=2</code>。尤其注意，i变成4又变成2，所以打印出来的结果是，1,2,3,4….20的连续值。如果想要随意的改变条件中的变量，可以使用while循环，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; i=<span class="number">1</span> </div><div class="line">&gt; <span class="keyword">while</span>(i&lt;=<span class="number">20</span>)&#123; </div><div class="line">+     cat(i); </div><div class="line">+     cat(<span class="string">" "</span>); </div><div class="line">+     i=i+<span class="number">3</span> </div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">7</span> <span class="number">10</span> <span class="number">13</span> <span class="number">16</span> <span class="number">19</span></div></pre></td></tr></table></figure>
<h3 id="for循环案例2-pricecalculator函数"><code>for</code>循环案例2-<code>priceCalculator()</code>函数</h3>
<p>现在使用<code>for</code>循环来改造原来的<code>priceCalculator()</code>函数，使这个函数可以一次地计算出多个客户类型的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph*</div><div class="line">    ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  </div><div class="line">  VAT &lt;- numeric(<span class="number">0</span>)</div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> client)&#123;</div><div class="line">    VAT &lt;- c(VAT, <span class="keyword">switch</span>(i, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这段代码中，做了以下修改：</p>
<ol style="list-style-type: decimal">
<li>创建了一个长度为0的数值向量，即<code>VAT &lt;- numeric(0)</code>；</li>
<li>对向量<code>client</code>中的每个值，用<code>switch()</code>来进行逻辑判断，选出对应的<code>VAT</code>值；</li>
<li>每次循环，都将<code>switch()</code>的结果放入向量VAT的末尾。</li>
</ol>
<p>这个函数的计算结果就是向量VAT包含每个客户对应的税率值，看一下计算结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>),</div><div class="line">  type = c(<span class="string">'public'</span>,<span class="string">'abroad'</span>,<span class="string">'private'</span>,<span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">clients</div><div class="line">priceCalculator(clients$hours,client = clients$type)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; clients</div><div class="line">  hours    type</div><div class="line"><span class="number">1</span>    <span class="number">25</span>  public</div><div class="line"><span class="number">2</span>   <span class="number">110</span>  abroad</div><div class="line"><span class="number">3</span>   <span class="number">125</span> private</div><div class="line"><span class="number">4</span>    <span class="number">40</span>  abroad</div><div class="line">&gt; priceCalculator(clients$hours,client = clients$type)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">3960</span> <span class="number">5040</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="any与all">any()与all()</h2>
<p>使用<code>any()</code>和<code>all()</code>函数可以对某个变量进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">10</span></div><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line">&gt; any(x&gt;<span class="number">8</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; any(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">0</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p>现在看一个案例，假设一个向量由若干个0或1构成，我们想要找𡵾其中连续出现1的游程（在一个0和1组成的序列中，一个由连续的0或1构成的串称为一个游程(run)）。例如对于向量x(假设它为1,0,0,1,1,1,0,1,1)，从它第4个索引处开始有长度为3的游程，而长度为2的游程分别始于第4，第5和第8索引的位置，因此现在我们构建一个函数，返回结果为(4,5,8)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findruns &lt;- <span class="keyword">function</span>(x,k)&#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  runs &lt;- <span class="literal">NULL</span></div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(n-k+<span class="number">1</span>))&#123;</div><div class="line">    <span class="keyword">if</span> (all(x[i:(i+k-<span class="number">1</span>)]==<span class="number">1</span>)) </div><div class="line">       runs &lt;- c(runs,i)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span>(runs)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在运行这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">&gt; findruns(x,<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div><div class="line">&gt; findruns(x,<span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">5</span> <span class="number">8</span></div><div class="line">&gt; findruns(x,<span class="number">6</span>)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/09/R/函数构建与循环/" rel="next" title="R语言笔记之函数构建">
                <i class="fa fa-chevron-left"></i> R语言笔记之函数构建
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/10/R/数据的导入与导出/" rel="prev" title="R语言笔记之数据的导入与导出">
                R语言笔记之数据的导入与导出 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="vcomments"></div>
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">243</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">117</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#if语句"><span class="nav-number">1.</span> <span class="nav-text">if语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if语句案例1-简单案例"><span class="nav-number">1.1.</span> <span class="nav-text">if语句案例1-简单案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if语句案例2-函数体中添加if语句"><span class="nav-number">1.2.</span> <span class="nav-text">if语句案例2-函数体中添加if语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if语句的省略形式"><span class="nav-number">1.3.</span> <span class="nav-text">if语句的省略形式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ifelse语句"><span class="nav-number">2.</span> <span class="nav-text">ifelse语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#判断选择的向量化"><span class="nav-number">3.</span> <span class="nav-text">判断选择的向量化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ifelse函数"><span class="nav-number">4.</span> <span class="nav-text">ifelse()函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ifelse案例1-简单案例"><span class="nav-number">4.1.</span> <span class="nav-text">ifelse案例1-简单案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ifelse案例2-在函数中添加ifelse"><span class="nav-number">4.2.</span> <span class="nav-text">ifelse案例2-在函数中添加ifelse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ifelse案例3-转换某个字符串"><span class="nav-number">4.3.</span> <span class="nav-text">ifelse案例3-转换某个字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套if...else...表达式"><span class="nav-number">4.4.</span> <span class="nav-text">嵌套if...else...表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#switch处理多种选择"><span class="nav-number">5.</span> <span class="nav-text">switch处理多种选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在switch中使用默认值"><span class="nav-number">5.1.</span> <span class="nav-text">在switch()中使用默认值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#for-循环"><span class="nav-number">6.</span> <span class="nav-text">for 循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#for循环案例1-简单案例"><span class="nav-number">6.1.</span> <span class="nav-text">for循环案例1-简单案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for循环案例2-pricecalculator函数"><span class="nav-number">6.2.</span> <span class="nav-text">for循环案例2-priceCalculator()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#any与all"><span class="nav-number">7.</span> <span class="nav-text">any()与all()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">8.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:0px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共963.7k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
