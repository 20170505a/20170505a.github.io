<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="R函数," />










<meta name="description" content="函数的编写 格式如下所示： 123456函数名 &amp;lt;- function(数据,参数1=默认值,...)&amp;#123;异常处理;表达式(循环/判别);return(返回值);&amp;#125; 函数案例A 输入直角三角形的两个边长，求斜边长 12345rcal &amp;lt;- function(x,y)&amp;#123; z &amp;lt;- x^2 + y^2 result &amp;lt;- sqrt(z) r">
<meta name="keywords" content="R函数">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言笔记之函数构建">
<meta property="og:url" content="http://rvdsd.top/2017/04/09/R/函数构建与循环/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:description" content="函数的编写 格式如下所示： 123456函数名 &amp;lt;- function(数据,参数1=默认值,...)&amp;#123;异常处理;表达式(循环/判别);return(返回值);&amp;#125; 函数案例A 输入直角三角形的两个边长，求斜边长 12345rcal &amp;lt;- function(x,y)&amp;#123; z &amp;lt;- x^2 + y^2 result &amp;lt;- sqrt(z) r">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621203341.png">
<meta property="og:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621205945.png">
<meta property="og:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190617074809.png">
<meta property="og:updated_time" content="2019-07-21T02:57:47.340Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R语言笔记之函数构建">
<meta name="twitter:description" content="函数的编写 格式如下所示： 123456函数名 &amp;lt;- function(数据,参数1=默认值,...)&amp;#123;异常处理;表达式(循环/判别);return(返回值);&amp;#125; 函数案例A 输入直角三角形的两个边长，求斜边长 12345rcal &amp;lt;- function(x,y)&amp;#123; z &amp;lt;- x^2 + y^2 result &amp;lt;- sqrt(z) r">
<meta name="twitter:image" content="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621203341.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/2017/04/09/R/函数构建与循环/"/>





  <title>R语言笔记之函数构建 | RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/09/R/函数构建与循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">R语言笔记之函数构建</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-09T12:00:00+08:00">
                2017-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,993
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  30
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="函数的编写">函数的编写</h2>
<p>格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">函数名 &lt;- <span class="keyword">function</span>(数据,参数<span class="number">1</span>=默认值,<span class="keyword">...</span>)</div><div class="line">&#123;</div><div class="line">异常处理;</div><div class="line">表达式(循环/判别);</div><div class="line"><span class="keyword">return</span>(返回值);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数案例a">函数案例A</h3>
<p>输入直角三角形的两个边长，求斜边长</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">result &lt;- sqrt(z) </div><div class="line"><span class="keyword">return</span>(result) </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">+     z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">+     result &lt;- sqrt(z) </div><div class="line">+     <span class="keyword">return</span>(result) </div><div class="line">+ &#125; </div><div class="line">&gt; rcal(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="函数案例b">函数案例B</h3>
<p>给出两个数字后，直接给出这两个数的平方和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line"><span class="keyword">return</span>(z3);</div><div class="line">&#125;</div><div class="line">sqtest(<span class="number">3</span>,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">+     z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line">+     <span class="keyword">return</span>(z3);</div><div class="line">+ &#125;</div><div class="line">&gt; sqtest(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">25</span></div></pre></td></tr></table></figure>
<h3 id="函数案例c-转换百分比">函数案例C-转换百分比</h3>
<p>创建一个函数，将小数转换为百分数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">addPercent(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; addPercent(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>在R中，函数其实就是一种对象，可以像操作其他对象一样操作了娄，例如可以将函数赋予一个新的对象来实现它的拷贝，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">ppaste &lt;- addPercent</div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">ppaste(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; ppaste &lt;- addPercent</div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; ppaste(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>需要注意的是，我们在输入<code>ppaste &lt;- addPercent</code>，函数<code>addPercent</code>后面我们并没有加<code>()</code>，这说明，只是将函数<code>addPercet</code>本身给<code>ppaste</code>这个变量，而不是调用<code>addPercent</code>这个函数。当我们输入<code>ppaste</code>，不加括号时，就会出现函数的内容，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; ppaste</div><div class="line"><span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实在R中，只输入函数本身，不输入括号，都会显示函数的内容，再看如下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; mean</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"mean"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000baf0a08</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div><div class="line">&gt; sd</div><div class="line"><span class="keyword">function</span> (x, na.rm = <span class="literal">FALSE</span>) </div><div class="line">sqrt(var(<span class="keyword">if</span> (is.vector(x) || is.factor(x)) x <span class="keyword">else</span> as.double(x), </div><div class="line">    na.rm = na.rm))</div><div class="line">&lt;bytecode: <span class="number">0x0000000004c04a38</span>&gt;</div><div class="line">&lt;environment: namespace:stats&gt;</div></pre></td></tr></table></figure>
<h3 id="函数的返回结果">函数的返回结果</h3>
<p>还以前面的<code>addPercent()</code>函数为例说明一下，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在大括号中最后一行是<code>return(result)</code>，把它删掉，再运行代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">addPercent(x)</div><div class="line">print(addPercent(x))</div></pre></td></tr></table></figure>
<p>可以发现，<code>addPercent(x)</code>没有返回结果，而<code>print(addPercent(x))</code>返回了原计算结果。因此在这里看来，<code>return(result)</code>这行代码是多余的，其实不一定，如果我们想要提前结束函数的运行，就会有用了，现在把<code>addPercent()</code>改造一下，加入一行代码，即<code>if(!is.numeric(x)) return(NULL)</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  <span class="keyword">if</span>(!is.numeric(x)) <span class="keyword">return</span>(<span class="literal">NULL</span>)</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">y &lt;- c(<span class="string">"Hello, R"</span>)</div><div class="line">addPercent(x)</div><div class="line">addPercent(y)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x)</div><div class="line">&gt; addPercent(y)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<p>变量<code>x</code>是数字，运行没问题，但变量<code>y</code>是字符串，就出现了问题，此时<code>reurn()</code>语句就派上了用场，函数判断出来了变量<code>y</code>不是数字，就返回了<code>NULL</code>。</p>
<h3 id="函数的简化">函数的简化</h3>
<p>只要函数体只包含一行代码，那么包围函数体的大括号<code>{}</code>有的时候可以省略，将这行代码直接放在参数列表后面即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">odds(<span class="number">0.8</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">&gt; odds(<span class="number">0.8</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>现在我们使用这种方式来重写<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">addPercent(<span class="number">0.0021</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下不所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">&gt; addPercent(<span class="number">0.0021</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.2%"</span></div></pre></td></tr></table></figure>
<p>但是，通常情况下并不推荐这么写，因为可读性太差。其实这种方式还可以继续简化，那就是匿名函数。</p>
<h3 id="给函数添加更多的参数">给函数添加更多的参数</h3>
<p><code>addPercent()</code>会自动将传入的数字乘以100，如果待转换的数字已经是百分数了，那么就需要将其除以100，再传入参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">addPercent(percentages/<span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">&gt; addPercent(percentages/<span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2%"</span>  <span class="string">"120.4%"</span> <span class="string">"33%"</span></div></pre></td></tr></table></figure>
<p>此时，为了更加方法，可以给<code>addPercent()</code>函数再添加一个参数，用于控制数字的乘或除，例如我们添加一个<code>mult</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">addPercent(decimalstages, mult = <span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2 % "</span>  <span class="string">"120.4 % "</span> <span class="string">"33 % "</span>   </div><div class="line">&gt; addPercent(decimalstages, mult = <span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="设置默认值">设置默认值</h4>
<p>还以上面的案例为例说明一下，如果我们忘记了传递<code>mult</code>参数，那么就会出错，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">Error <span class="keyword">in</span> addPercent(decimalstages) : </div><div class="line">  argument <span class="string">"mult"</span> is missing, with no default</div></pre></td></tr></table></figure>
<p>为避免这种情况，可以为<code>mult</code>参数添加一个默认值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(decimalstages)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="三点参数">三点参数</h4>
<p>如果我们再为<code>addPercent()</code>函数添加一个参数用于控制保留的小数位置，此时就已经有了3个参数，参数已经比较多了，这样参数的传入列表会很长，R中为此有一个很好的解决方案，就是三点参数（<code>...</code>），其实从R的很多函数中我们就能看到这种形式，例如我们在<code>pheatmap</code>这个包中的<code>pheatmap()</code>这个函数中就能看到这种形式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">pheatmap(mat, color = colorRampPalette(rev(brewer.pal(n = <span class="number">7</span>, name =</div><div class="line">  <span class="string">"RdYlBu"</span>)))(<span class="number">100</span>), kmeans_k = <span class="literal">NA</span>, breaks = <span class="literal">NA</span>, border_color = <span class="string">"grey60"</span>,</div><div class="line">  cellwidth = <span class="literal">NA</span>, cellheight = <span class="literal">NA</span>, scale = <span class="string">"none"</span>, cluster_rows = <span class="literal">TRUE</span>,</div><div class="line">  cluster_cols = <span class="literal">TRUE</span>, clustering_distance_rows = <span class="string">"euclidean"</span>,</div><div class="line">  clustering_distance_cols = <span class="string">"euclidean"</span>, clustering_method = <span class="string">"complete"</span>,</div><div class="line">  clustering_callback = identity2, cutree_rows = <span class="literal">NA</span>, cutree_cols = <span class="literal">NA</span>,</div><div class="line">  treeheight_row = ifelse((class(cluster_rows) == <span class="string">"hclust"</span>) || cluster_rows,</div><div class="line">  <span class="number">50</span>, <span class="number">0</span>), treeheight_col = ifelse((class(cluster_cols) == <span class="string">"hclust"</span>) ||</div><div class="line">  cluster_cols, <span class="number">50</span>, <span class="number">0</span>), legend = <span class="literal">TRUE</span>, legend_breaks = <span class="literal">NA</span>,</div><div class="line">  legend_labels = <span class="literal">NA</span>, annotation_row = <span class="literal">NA</span>, annotation_col = <span class="literal">NA</span>,</div><div class="line">  annotation = <span class="literal">NA</span>, annotation_colors = <span class="literal">NA</span>, annotation_legend = <span class="literal">TRUE</span>,</div><div class="line">  annotation_names_row = <span class="literal">TRUE</span>, annotation_names_col = <span class="literal">TRUE</span>,</div><div class="line">  drop_levels = <span class="literal">TRUE</span>, show_rownames = <span class="literal">T</span>, show_colnames = <span class="literal">T</span>, main = <span class="literal">NA</span>,</div><div class="line">  fontsize = <span class="number">10</span>, fontsize_row = fontsize, fontsize_col = fontsize,</div><div class="line">  angle_col = c(<span class="string">"270"</span>, <span class="string">"0"</span>, <span class="string">"45"</span>, <span class="string">"90"</span>, <span class="string">"315"</span>), display_numbers = <span class="literal">F</span>,</div><div class="line">  number_format = <span class="string">"%.2f"</span>, number_color = <span class="string">"grey30"</span>, fontsize_number = <span class="number">0.8</span></div><div class="line">  * fontsize, gaps_row = <span class="literal">NULL</span>, gaps_col = <span class="literal">NULL</span>, labels_row = <span class="literal">NULL</span>,</div><div class="line">  labels_col = <span class="literal">NULL</span>, filename = <span class="literal">NA</span>, width = <span class="literal">NA</span>, height = <span class="literal">NA</span>,</div><div class="line">  silent = <span class="literal">FALSE</span>, na_col = <span class="string">"#DDDDDD"</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>可以看到，最后就是三个点（<code>...</code>），说明参数列表还有，省略了。</p>
<p>现在使用这种三点参数来修改<code>addPercent()</code>函数，其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.3331</span>, <span class="number">0.13323</span>, <span class="number">1.33334</span>)</div><div class="line">addPercent(decimalstages, digits = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages, digits = <span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"33.31 % "</span>  <span class="string">"13.32 % "</span>  <span class="string">"133.33 % "</span></div><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"33 % "</span>  <span class="string">"13 % "</span>  <span class="string">"133 % "</span></div></pre></td></tr></table></figure>
<h3 id="将函数当作参数">将函数当作参数</h3>
<p>在R中，可以将函数当作参数，例如在<code>apply()</code>系列函数中就能遇到。在前面的案例中，<code>addPercent()</code>中使用了<code>round()</code>函数，但是如果我们想要使用其它的函数，例如<code>signif()</code>，那么就可以将这个函数当作参数，具体的实现形式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种形式下，在<code>percent &lt;- FUN(x*mult, ...)</code>这一步，默认情况下使用的是<code>round()</code>函数，如果要使用<code>signif()</code>这个函数，使用<code>addPercent()</code>时，直接在<code>FUN=</code>中直接添加上<code>signif</code>即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.1223</span>, <span class="number">0.8956</span>, <span class="number">0.4234</span>)</div><div class="line">addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"12.2 % "</span> <span class="string">"89.6 % "</span> <span class="string">"42.3 % "</span></div></pre></td></tr></table></figure>
<p>现在解释一下这个函数的调用过程：</p>
<ol style="list-style-type: decimal">
<li>向量<code>x</code>乘以<code>mult</code>（默认是100）；</li>
<li>R将<code>signif()</code>函数的代码传递给<code>FUN</code>参数，这样<code>FUN()</code>就成了<code>signif()</code>函数的一份拷贝，功能和行为都与之相同；</li>
<li>R接收参数<code>digits</code>并将其传递给<code>FUN()</code>。</li>
</ol>
<p>在这里需要注意的是，<code>FUN=signif</code>这个参数中,<code>signif</code>并没有添加小括号，如果添加了小括号，就是将<code>signif()</code>函数的调用结果而非函数本身赋值给参数<code>FUN</code>。</p>
<h3 id="匿名函数">匿名函数</h3>
<p>在上面的案例中，参数<code>FUN</code>其实可以传递各种参数，甚至也可以没有函数名称，直接复制代码即可，因此<code>FUN</code>参数除了使用函数名进行赋值外，还可以直接将代码放在<code>FUN</code>中，这种直接放代码的形式就是以匿名函数的方式进行传递的，所谓的匿名函数（<code>Anonymous Function</code>）就是指没有名称的函数，看下面的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>其实还可以继续简化，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits/sum(profits))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits/sum(profits))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>匿名函数的使用前提是，①函数本身代码很短，②只会使用一次，不会用在别的地方。</p>
<h3 id="函数匹配">函数匹配</h3>
<p>前面提到的“将函数作为参数”案例中，通过将函数名将代码传递一个参数，这就意味着，假如有一个与函数名相同的对象，就会出错，例如我们在调用<code>addPercent()</code>函数之前，再定义一个名为<code>round</code>的对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div></pre></td></tr></table></figure>
<p>此时再调用<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">Error <span class="keyword">in</span> FUN(x * mult, <span class="keyword">...</span>) : could not find <span class="keyword">function</span> <span class="string">"FUN"</span></div></pre></td></tr></table></figure>
<p>此时就出错了，因为R没有将<code>round()</code>函数传递给<code>FUN</code>，而是把向量<code>round</code>赋予给了<code>FUN</code>，为了避免这种情况，可以调用一下<code>match.fun()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">[<span class="number">1</span>] <span class="string">"45 % "</span>   <span class="string">"-45 % "</span>  <span class="string">"5850 % "</span></div></pre></td></tr></table></figure>
<p><code>match.fun</code>函数会查找与名称<code>round</code>相匹配的函数，并将代码复制给<code>FUN</code>，而不会找到<code>round</code>向量，另外，<code>match.fun()</code>还支持字符对象，例如<code>FUN='round'</code>这样传递参数也是有效的。</p>
<h2 id="处理作用域">处理作用域</h2>
<p>在前面的案例中，我们只使用了Workspace，也就是说，创建的每一个以对象都存在于整个环境中，这个环境被称为全局环境（Global Environment）。在前面的案例中，函数内部的 一些参数，例如x，mult和FUN并非都是创建在Workspace中的对象，它们是在函数内部创建的对象，这些变量在退出函数回到Workspace后都无法使用了，看下面的一个案例：</p>
<p>首选创建一个对象<code>x</code>和函数<code>test()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x &lt;- <span class="number">1</span>:<span class="number">5</span></div><div class="line">test &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">"This is x: "</span>, x, <span class="string">"\n"</span>)</div><div class="line">  rm(x)</div><div class="line">  cat(<span class="string">"This is x after removing it:"</span>, x, <span class="string">"\n"</span>)</div><div class="line">&#125;</div><div class="line">x</div><div class="line">test(<span class="number">5</span>:<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div><div class="line">&gt; test(<span class="number">5</span>:<span class="number">1</span>)</div><div class="line">This is x:  <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> </div><div class="line">This is x after removing it: <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p>从上面的案例可以发现，<code>test()</code>这个函数的功能就是接收一个参数<code>x</code>，输出到控制台，然后将其删除，并再次输出。函数内部虽然已经使用了<code>rm(x)</code>来删除这个<code>x</code>，但是<code>x</code>还是能输出，不过，两次输出的<code>x</code>内容并不一样。</p>
<h3 id="函数的检索路径">函数的检索路径</h3>
<p>在一个函数被调用时，它将首选创建一个临时的本地环境(Local Environment)，这个本地环境嵌套在全局环境中，这意味着本地环境中仍然可以访问全局环境内的对象。只要函数执行完毕，本地环境就会立即释放，同时其中的所有对象也会被销毁。</p>
<p>换一种说法就是：函数创建的环境始终位于调用它的环境之内，而调用它的环境被称为父环境(Parent Environment)。所以，当我们从Worksapce中通过脚本或命令行调用某个函数时，它的父环境恰好为全局环境。</p>
<p>下图就是<code>test()</code>函数调用的原理：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621203341.png">

</div>
<p>外层的大矩形表示全局环境，而内层的灰色矩形则表示test函数的本地环境。在全局环境中，我们将对象<code>x</code>赋值为<code>1:5</code>，而在调用函数内部，则另外创建了一个参数<code>x</code>，赋值为<code>5:1</code>，这个参数成为了本地环境中的一个对象。</p>
<p>当R在代码中发现了一个对象<code>x</code>时，它将首先检索本地环境。而恰好能够找到参数<code>x</code>，所以它将被用在第一次的<code>cat()</code>调用中，接下来一行，R移除了这个对象<code>x</code>。所以，当R到达第三行时，就再也找不到本地环境中的对象<code>x</code>了。</p>
<p>此时，R会顺序环境栈上移，到达全局环境，并在其中查找名为<code>x</code>的对象，由于其中也恰好有<code>x</code>，因此它将被用于第二次的<code>cat()</code>调用。</p>
<p>如果在函数内部使用<code>rm()</code>，在默认情况下，它只会删除位于函数中的对象，这可以避免在函数中使用更大范围数据集所带来的内存消耗风险，因为我们可以在使用这个对象后立即将其删除，而无需等待函数执行完毕。</p>
<h3 id="使用内部函数">使用内部函数</h3>
<p><code>test()</code>函数出现的调用全局环境对象的问题其实是没有意义的，因为我们从一开始就应该避免函数对全局环境对象的依赖。事实上，R背后隐藏的整个概念都不支持将全局变量应用到函数内部。R作为一门函数式编程语言，它的一个主要思想就是在于任何函数的输出结果都不能依赖于外部环境，而仅仅是由传入的参数决定。只要各个参数的值相同，结果就不会发生变化。这种操作的优势在于，有时候我们想要在某个函数内部重复地执行某种操作，但离开这个函数后，这一操作又是没有意义的。</p>
<p>假设我们要比较几盏灯在半供电和全供电时亮度的差异，而用来遮挡外面太阳光的窗帘又不能完全阻挡光线的进入，因此还需要测量日光提供的亮度，然后将灯光的测量结果减去日光的亮度，来修正最终的结果。</p>
<p>要计算半供电时的灯光效率，可以实现下面的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z)  - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>ccalculate.eff()</code>函数内部，可以看到有另外一个函数的定义：<code>min.base()</code>，这个函数定义在<code>calculate.eff()</code>函数的本地环境中，并且也会在离开函数时销毁，也就是说，它并不存在于Workspace内。</p>
<p>我们可以像下面这样调用这个函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z) z - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div><div class="line"></div><div class="line">half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">calculate.eff(half, full,nothing)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">&gt; full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">&gt; nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">&gt; calculate.eff(half, full,nothing)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4270093</span> <span class="number">0.6258612</span> <span class="number">0.3129473</span></div></pre></td></tr></table></figure>
<p>从源代码中可以看到，<code>min.base()</code>的定义中使用了对象<code>control</code>，但这个对象并没有出现在函数的参数列表中，其原因可以看一下这个函数的调用过程，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621205945.png">

</div>
<p>调用过程如下所示：</p>
<ol style="list-style-type: decimal">
<li>函数<code>calculate.eff()</code>创建了一个本地环境，包含对象<code>x</code>（其值为<code>fifty</code>），<code>y</code>（其值为<code>hundred</code>），<code>control</code>（值为<code>nothing</code>），以及函数<code>min.base()</code>；</li>
<li>函数<code>min.base()</code>在<code>calculate.eff()</code>函数内创建了一个新的本地环境，包含对象<code>z</code>，值为<code>x</code>；</li>
<li><code>min.base()</code>在<code>calculate.eff()</code>的环境内查找对象<code>control</code>，计算其中每个元素的平均值，并将<code>z</code>的每个元素减去这个平均值，之后返回结果；</li>
<li>与前一个过程相同，只是<code>z</code>的值换成了<code>y</code>。</li>
<li><code>3</code>和<code>4</code>的结果相除，结果返回到全局环境。</li>
</ol>
<p>本地环境所嵌入的环境实际上是函数被定义的地方，而非调用的地方。假设我们在<code>calculate.eff()</code>内使用<code>addPercent()</code>来格式化数字，那么<code>addPercent()</code>所创建的本地环境不会被嵌入在<code>calculate.eff()</code>中，而是在全局环境内，也就是<code>addPercent()</code>被定义的地方。</p>
<h3 id="方法分配">方法分配</h3>
<p>关于函数的另外一个问题就是函数的方法问题。因为理解了这方面的知识，才能理解函数如何能够根据传入参数的类型来确定返回不同的结果。R中有一个机制被称为<code>通用函数系统</code>（Generic Function System），它允许用户使用相同的名称调用不同的函数。</p>
<p>例如，当我们输出一个列表时，输出会以行的方式进行排列，当我们输出一个数据框的时候，则会以列的方式显示，由此可见，<code>print()</code>函数对待列表和数据框的方式是不同的，但是所用的函数却是一样的。</p>
<p>现在看一下<code>print()</code>函数的代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; print</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"print"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000d7d7150</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div></pre></td></tr></table></figure>
<p>最后两行可以忽略，它表示的是<code>外层空间</code>的东西，供R语言的高手使用，第1行可以看出来，<code>print()</code>这个函数的函数体只有一行代码。</p>
<p>像这种什么都不做，仅仅是将对象正确地传递给其他函数的函数被称为<code>通用函数</code>(<code>Generic Function</code>)。<code>print()</code>就是一个通用函数。真正完成实际工作的函数被称<code>方法</code>（<code>Methods</code>）。可见，所有的方法都是函数，但并不是每个函数都是方法。</p>
<h4 id="通过usemethod调用方法">通过<code>UseMethod</code>调用方法</h4>
<p><code>print()</code>仅靠那一行代码肯定是完成无法完成不同方式打印向量、数据框、列表等复杂任务的，真正完成的其实是<code>UseMethod()</code>这个函数，这个函数做的所有事情就是告诉R查找一个能够处理传入参数<code>x</code>类型相匹配的函数。R会完整地遍历定义的函数名称，查找以<code>print</code>形状，后面接一个点号加上对象类型名的函数。</p>
<p>我们也可以通过<code>apropos('print\\.')</code>的命令来实现这个过程，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; apropos(<span class="string">'print\\.'</span>)</div><div class="line"> [<span class="number">1</span>] <span class="string">".rs.rnbHooks.print.html"</span>             <span class="string">".rs.rnbHooks.print.htmlwidget"</span>      </div><div class="line"> [<span class="number">3</span>] <span class="string">".rs.rnbHooks.print.knit_asis"</span>        <span class="string">".rs.rnbHooks.print.knit_image_paths"</span></div><div class="line"> [<span class="number">5</span>] <span class="string">".rs.rnbHooks.print.shiny.tag"</span>        <span class="string">".rs.rnbHooks.print.shiny.tag.list"</span>  </div><div class="line"> [<span class="number">7</span>] <span class="string">"print.AsIs"</span>                          <span class="string">"print.by"</span>                           </div><div class="line"> [<span class="number">9</span>] <span class="string">"print.condition"</span>                     <span class="string">"print.connection"</span>                   </div><div class="line">[<span class="number">11</span>] <span class="string">"print.data.frame"</span>                    <span class="string">"print.Date"</span>                         </div><div class="line">[<span class="number">13</span>] <span class="string">"print.default"</span>                       <span class="string">"print.difftime"</span>                     </div><div class="line">[<span class="number">15</span>] <span class="string">"print.Dlist"</span>                         <span class="string">"print.DLLInfo"</span>                      </div><div class="line">[<span class="number">17</span>] <span class="string">"print.DLLInfoList"</span>                   <span class="string">"print.DLLRegisteredRoutines"</span>        </div><div class="line">[<span class="number">19</span>] <span class="string">"print.eigen"</span>                         <span class="string">"print.factor"</span>                       </div><div class="line">[<span class="number">21</span>] <span class="string">"print.function"</span>                      <span class="string">"print.hexmode"</span>                      </div><div class="line">[<span class="number">23</span>] <span class="string">"print.libraryIQR"</span>                    <span class="string">"print.listof"</span>                       </div><div class="line">[<span class="number">25</span>] <span class="string">"print.NativeRoutineList"</span>             <span class="string">"print.noquote"</span>                      </div><div class="line">[<span class="number">27</span>] <span class="string">"print.numeric_version"</span>               <span class="string">"print.octmode"</span>                      </div><div class="line">[<span class="number">29</span>] <span class="string">"print.packageInfo"</span>                   <span class="string">"print.POSIXct"</span>                      </div><div class="line">[<span class="number">31</span>] <span class="string">"print.POSIXlt"</span>                       <span class="string">"print.proc_time"</span>                    </div><div class="line">[<span class="number">33</span>] <span class="string">"print.restart"</span>                       <span class="string">"print.rle"</span>                          </div><div class="line">[<span class="number">35</span>] <span class="string">"print.simple.list"</span>                   <span class="string">"print.srcfile"</span>                      </div><div class="line">[<span class="number">37</span>] <span class="string">"print.srcref"</span>                        <span class="string">"print.summary.table"</span>                </div><div class="line">[<span class="number">39</span>] <span class="string">"print.summary.warnings"</span>              <span class="string">"print.summaryDefault"</span>               </div><div class="line">[<span class="number">41</span>] <span class="string">"print.table"</span>                         <span class="string">"print.warnings"</span></div></pre></td></tr></table></figure>
<p><code>apropos()</code>括号内的引号之间可以添加正则表达式，这与<code>grep()</code>函数非常类似。假如我们要打印一个数据框，那么R将查找函数<code>print.data.frame()</code>，并使用它来打印作为参数传入的对象，我们可以手工调用这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">print(small.one)</div><div class="line">print.data.frame(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print.data.frame(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div></pre></td></tr></table></figure>
<p>函数的输出结果与调用通过的<code>print(small.one)</code>函数是完全相同的，因为<code>print()</code>将打印<code>small.one</code>的任务完全交给了<code>print.data.frame()</code>函数来完成。</p>
<h4 id="使用默认方法">使用默认方法</h4>
<p>对于列表来说，你可能会觉得<code>print.list()</code>函数承担了打印任务，但实际上<code>print.list()</code>函数并不存在，此时R会忽略对象的类型，直接调用默认方法<code>print.default()</code>来打印列表。</p>
<p>许多通过函数都有一个默认方法，当无法调用特定方法执行时将派上用场，如果存在默认方法，那么它的名称必然是函数名后面加点，再加上<code>default</code>。我们来看一下默认方法打印<code>small.one</code>这个变量的结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">print.default(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; print.default(small.one)</div><div class="line">$a</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span></div><div class="line"></div><div class="line">$b</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">1</span></div><div class="line"></div><div class="line">attr(,<span class="string">"class"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<h4 id="实现自己的通用函数">实现自己的通用函数</h4>
<p>用户自己也可以实现自己的通用函数。现在看前面的<code>addPercent()</code>函数，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于<code>addPercent()</code>函数来说，传入的参数<code>x</code>不能是字符向量，因为它无法参与后面的乘法运算，但可以利用方法分配机制，实现一个特定的函数来处理这一问题，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的是，这里的对象不是向量，而是字符，同样的原理，之前那个<code>addPercent(0</code>函数也应该变成针对特定类型对象的方法，将名称改为<code>addPercent.numeric</code>。在实现方法分配时，如果代码不是过长，应该尽量把所有函数的实现放在同一个脚本文件中，这样只要运行一个脚本，就可以使用完整的函数功能。</p>
<p>接着定义最外层的<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函数只定义了两个参数，<code>x</code>和<code>...</code>，<code>...</code>参数确保在<code>addPercent.numeric()</code>函数中使用的其它参数依然有效，这些附加参数将会原封不动地传递给内部调用的函数。当把完整的脚本文件发送给控制台后，就哦可以向<code>addPercent()</code>函数传入字符向量或数值向量了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">Error <span class="keyword">in</span> UseMethod(<span class="string">"addPercent"</span>) : </div><div class="line">  no applicable method <span class="keyword">for</span> <span class="string">'addPercent'</span> applied to an object of class <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<p>其中，<code>addPercent(small.one)</code>这行代码出错。出错的信息显示，没有适当的方法用于处理传入的数据框，此时 们还可以修改这种错误提示，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码的功能在于显示一条信息，这条信息相对于R默认的错误信息更容易理解，现在运行完整代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">You should <span class="keyword">try</span> a numeric or character vector.</div></pre></td></tr></table></figure>
<h2 id="函数返回多个结果">函数返回多个结果</h2>
<p>当函数需要返回多个结果时，通常用<code>list</code>的形式返回结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vms = <span class="keyword">function</span>(x)&#123;</div><div class="line">  xx=rev(sort(x)) </div><div class="line"><span class="comment"># 对向量x从小到大排序，然后用ver()转换为从大到小排序</span></div><div class="line">  xx=xx[<span class="number">1</span>:<span class="number">5</span>]</div><div class="line"><span class="comment"># 提取前5个元素</span></div><div class="line">  mean(xx)</div><div class="line"><span class="comment">#求均值</span></div><div class="line">  <span class="keyword">return</span>(list(xbar=mean(xx),top5=xx))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; y &lt;- c(12,4,65,22,33,123,322,90)</div><div class="line">&gt; vms(y)</div><div class="line">$xbar</div><div class="line">[1] 126.6</div><div class="line"></div><div class="line">$top5</div><div class="line">[1] 322 123  90  65  33</div></pre></td></tr></table></figure>
<h2 id="optimize解函数方程"><code>optimize()</code>解函数方程</h2>
<p>用到的函数是<code>optimize()</code>，先看一个案例：</p>
<p>经济学的一个基本模型就是随着价格上涨，产品的销量会下降，可以使用如下的函数来表示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div></pre></td></tr></table></figure>
<p>那么期望收益就是产品价格与销量的乘积，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div></pre></td></tr></table></figure>
<p>现在使用<code>curve()</code>函数将这两个函数画出来，它接收一个函数作为参数，并绘制出一定范围内的函数图像，我们假设定价范围在50美元到60美元之间，那么这个图像如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div><div class="line">par(mfrow = c(<span class="number">1</span>, <span class="number">2</span>))</div><div class="line">curve(sales, from = <span class="number">50</span>, to = <span class="number">150</span>, xname=<span class="string">"price"</span>, ylab= <span class="string">"Sales"</span>, main=<span class="string">"Sales"</span>)</div><div class="line">curve(revenue, from=<span class="number">50</span>, to=<span class="number">150</span>, xname=<span class="string">"price"</span>, ylab=<span class="string">"Revenue"</span>, main=<span class="string">"Revenue"</span>)</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190617074809.png">

</div>
<p>从上图的右图可以看出来，收益明显有一个最高点，因此现在使用R中的<code>optimize()</code>函数计算出这个最大值，如果要使用<code>optimize()</code>这个函数，要输入它目标函数（这里是<code>revenue()</code>)和区间（这里是<code>50~150</code>），默认情况下，<code>optimize()</code>计算的是最小值，但此时我们要计算最大值，就需要调整一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div><div class="line">$maximum</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line"></div><div class="line">$objective</div><div class="line">[<span class="number">1</span>] <span class="number">5000</span></div></pre></td></tr></table></figure>
<h2 id="replicate函数"><code>replicate()</code>函数</h2>
<p><code>replicate</code>函数与<code>rep</code>函数类似，<code>rep</code>函数的功能是将一个参数重复数次，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; rep(<span class="number">1</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></div><div class="line">&gt; rep(c(<span class="number">1</span>,<span class="number">4</span>),<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>而<code>replicate</code>函数则是把某个表达式重复计算数次，多数情况下，它们的计算结果都相同，除非是使用了随机数时才有可能不同，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; replicate(<span class="number">5</span>, runif(<span class="number">1</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">0.7306532</span> <span class="number">0.8837189</span> <span class="number">0.5781437</span> <span class="number">0.2151454</span> <span class="number">0.4487271</span></div><div class="line">&gt; rep(runif(<span class="number">1</span>),<span class="number">5</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span></div></pre></td></tr></table></figure>
<p><code>replicate</code>函数的这种功能在比较复杂的例子中使用很广，例如Monte Carlo个分析中。</p>
<p>现在看一个比较简单的案例。</p>
<p>在这个案例中，我们会分析某人上下班时使用不同交通工具所花费的时间，我们在这个案例中会创建一个<code>time_for_commute</code>函数，这个函数用<code>sample</code>随机挑选一种交通工具（小汽车、公交车或自行车），然后使用<code>rnorm</code>或<code>rlnorm</code>找到一个正态分布或对数正态分布的行程时间，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">time_for_commute &lt;- <span class="keyword">function</span>()&#123;</div><div class="line">  <span class="comment"># select communication tool</span></div><div class="line">  mode_of_transport &lt;- sample(</div><div class="line">    c(<span class="string">"car"</span>, <span class="string">"bus"</span>, <span class="string">"train"</span>, <span class="string">"bike"</span>),</div><div class="line">    size = <span class="number">1</span>,</div><div class="line">    prob = c(<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">0.4</span>)</div><div class="line">)</div><div class="line">  time &lt;- <span class="keyword">switch</span>(</div><div class="line">    mode_of_transport,</div><div class="line">    car = rlnorm(<span class="number">1</span>, log(<span class="number">30</span>), <span class="number">0.5</span>),</div><div class="line">    bus = rlnorm(<span class="number">1</span>, log(<span class="number">40</span>), <span class="number">0.5</span>),</div><div class="line">    train = rnorm(<span class="number">1</span>, <span class="number">30</span>, <span class="number">10</span>),</div><div class="line">    bike = rnorm(<span class="number">1</span>, <span class="number">60</span>, <span class="number">5</span>))</div><div class="line">  names(time) &lt;- mode_of_transport</div><div class="line">  time</div><div class="line">&#125;</div><div class="line"></div><div class="line">replicate(<span class="number">5</span>, time_for_commute())</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; replicate(<span class="number">5</span>, time_for_commute())</div><div class="line">   train      bus      bus     bike      bus </div><div class="line"><span class="number">56.38663</span> <span class="number">53.76305</span> <span class="number">29.99244</span> <span class="number">60.87293</span> <span class="number">98.38907</span></div></pre></td></tr></table></figure>
<p>代码解释：<code>switch</code>语句很难使这个函数被量化，这就说明，为了找到上下班时间的分布，我们需要多次调用<code>time_for_commute</code>来生成每天的数据。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey [法] Andrie de Vries 著</li>
<li>学习R.[美] Richard，Cotton 著刘军 译</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/R函数/" <i class="fa fa-tag"></i> R函数</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/08/R/字符串与日期与格式化代码/" rel="next" title="R语言笔记之字符串-日期-格式化代码">
                <i class="fa fa-chevron-left"></i> R语言笔记之字符串-日期-格式化代码
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/10/R/R语言笔记之循环语句/" rel="prev" title="R语言笔记之循环语句">
                R语言笔记之循环语句 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="vcomments"></div>
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">212</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">99</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#函数的编写"><span class="nav-number">1.</span> <span class="nav-text">函数的编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#函数案例a"><span class="nav-number">1.1.</span> <span class="nav-text">函数案例A</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数案例b"><span class="nav-number">1.2.</span> <span class="nav-text">函数案例B</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数案例c-转换百分比"><span class="nav-number">1.3.</span> <span class="nav-text">函数案例C-转换百分比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数的返回结果"><span class="nav-number">1.4.</span> <span class="nav-text">函数的返回结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数的简化"><span class="nav-number">1.5.</span> <span class="nav-text">函数的简化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#给函数添加更多的参数"><span class="nav-number">1.6.</span> <span class="nav-text">给函数添加更多的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#设置默认值"><span class="nav-number">1.6.1.</span> <span class="nav-text">设置默认值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三点参数"><span class="nav-number">1.6.2.</span> <span class="nav-text">三点参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将函数当作参数"><span class="nav-number">1.7.</span> <span class="nav-text">将函数当作参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匿名函数"><span class="nav-number">1.8.</span> <span class="nav-text">匿名函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数匹配"><span class="nav-number">1.9.</span> <span class="nav-text">函数匹配</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理作用域"><span class="nav-number">2.</span> <span class="nav-text">处理作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#函数的检索路径"><span class="nav-number">2.1.</span> <span class="nav-text">函数的检索路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用内部函数"><span class="nav-number">2.2.</span> <span class="nav-text">使用内部函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法分配"><span class="nav-number">2.3.</span> <span class="nav-text">方法分配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通过usemethod调用方法"><span class="nav-number">2.3.1.</span> <span class="nav-text">通过UseMethod调用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用默认方法"><span class="nav-number">2.3.2.</span> <span class="nav-text">使用默认方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现自己的通用函数"><span class="nav-number">2.3.3.</span> <span class="nav-text">实现自己的通用函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数返回多个结果"><span class="nav-number">3.</span> <span class="nav-text">函数返回多个结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#optimize解函数方程"><span class="nav-number">4.</span> <span class="nav-text">optimize()解函数方程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#replicate函数"><span class="nav-number">5.</span> <span class="nav-text">replicate()函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:0px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共831.5k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
