<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="基础统计,基础知识," />










<meta name="description" content="方差分析的基本思想及应用条件 方差分析的基本思想 在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中处理因素(treatment)至少有两个水平（level）。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就是方差分析（ANOVA，analysis of variance），这是由英">
<meta name="keywords" content="基础统计,基础知识">
<meta property="og:type" content="article">
<meta property="og:title" content="方差分析笔记">
<meta property="og:url" content="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07方差分析/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:description" content="方差分析的基本思想及应用条件 方差分析的基本思想 在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中处理因素(treatment)至少有两个水平（level）。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就是方差分析（ANOVA，analysis of variance），这是由英">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova11.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/data_szq_402.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova1.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova2.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova4.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova1_mean_sd.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova13.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova12.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180825/c6CKBdgLGa.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova5.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova_tukey.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/anova_tukey_plot.png">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/j88jcgEj31.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/jk1GHii3D5.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/0F8L0C037K.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/5aiA3d3hH3.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/DDCgeCg9hm.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/l5fc8dkH3L.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/G6Bb7ab555.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/87j25BaCDh.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/mBj67K9cJb.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/CClLcmkD0I.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/02k82Je8ik.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/aKHCmAJIC8.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/b9h4ecdbab.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/j03JJ82GEd.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/CJakL2FEj5.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/LHlIFDl6i8.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/dGA75G6F4C.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/Afm3BbLIhg.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/kiHjimfk23.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/gHeEhkhEA9.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/H8j7Fe7gm2.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/JaKGbC7FaJ.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/63h0dmEF13.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180825/4gllA65BHi.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/glC2LhlkjL.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/Aj5f749J58.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/IfEf36023e.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/gGg62Ff2ch.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/D0L7aI6LDj.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/19E9gHIA32.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/D0L7aI6LDj.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/aJC1F9L1bg.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/7069Ef5AL9.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/cc7iib1Fk4.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/m6cK3G2Bcl.png?imageslim">
<meta property="og:image" content="http://ortxpw68f.bkt.clouddn.com/professional/180822/8iAKii5Hi3.png?imageslim">
<meta property="og:updated_time" content="2018-08-27T09:37:45.164Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="方差分析笔记">
<meta name="twitter:description" content="方差分析的基本思想及应用条件 方差分析的基本思想 在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中处理因素(treatment)至少有两个水平（level）。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就是方差分析（ANOVA，analysis of variance），这是由英">
<meta name="twitter:image" content="http://ortxpw68f.bkt.clouddn.com/anova11.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07方差分析/"/>





  <title>方差分析笔记 | RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07方差分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">方差分析笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T12:01:00+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13,332
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  53
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="方差分析的基本思想及应用条件">方差分析的基本思想及应用条件</h2>
<h3 id="方差分析的基本思想">方差分析的基本思想</h3>
<p>在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中<code>处理因素(treatment)</code>至少有两个<code>水平（level）</code>。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就<code>是方差分析（ANOVA，analysis of variance）</code>，这是由英国统计学家R.A.Fisher首创，以F命名，故方差分析又称为F检验。</p>
<p>设处理因素有<span class="math inline">\(g(g\geq 2)\)</span>个不同水平，实验对象随机分为<span class="math inline">\(g\)</span>组，分别接受不同水平的干预，第<span class="math inline">\(i(i=1,2,\dots,g)\)</span>组的样本含量为<span class="math inline">\(n_{i}\)</span>，第<span class="math inline">\(i\)</span>处理组的第<span class="math inline">\(j(j=1,2,...n_{i})\)</span>个观测值用<span class="math inline">\(X_{ij}\)</span>来表示，其计算结果可能可以整理成以下面的形式，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova11.png">

</div>
<p>方差分析的目的就是在<span class="math inline">\(H_{0}:\mu_{1}=\mu_{2}\dots=\mu_\)</span> 成立的条件下，通过分析各处理组均数之间的差别大小，推荐<span class="math inline">\(g\)</span>个总体均数<span class="math inline">\(\bar{X}_{i}\)</span>间有无差别，从面说明处理因素的效应是否存在。</p>
<p>记总均数为<span class="math inline">\(\bar{X}=\sum_{i=1}^g\sum_{j=1}^{n_{j}}X_{ij}/N\)</span>，各处理组均数为<span class="math inline">\(\bar{X}=\sum_{j=1}^{n_{i}}X_{ij}/n_{i}\)</span>,总例数为<span class="math inline">\(N=n_{1}+n_{2}+\dots+n_{g}\)</span>，g为处理组数。</p>
<p>实验数据有三个不同的变异： <strong>1. 总变异</strong>。全部观测值大小不同，这种变异称为总变异。总变异的大小可能用离均差平方和(sum of squares of deviations from eman,SS)来表示，即各观测值<span class="math inline">\(X_{ij}\)</span>与总均数<span class="math inline">\(\bar{X}\)</span>差值的平方和，记为<span class="math inline">\(SS_{总}\)</span>。公式略。</p>
<p><strong>2. 组间变异</strong>。各处理组由于接受处理的水平不同，各组的样本均数<span class="math inline">\(\bar{X}_{i}（i=1,2,\dots,g）\)</span>也大小不等，这种变异称为组间变异，其大小用各组均数<span class="math inline">\(\bar{X_{i}}\)</span>与总均数<span class="math inline">\(\bar{X}\)</span>的离均差平方和表示，记为<span class="math inline">\(SS_{组间}\)</span>，计算公式略。</p>
<p>各组均数之间相关越悬殊，它们与总均数的差值越在在，<span class="math inline">\(SS_{组间}\)</span>就越大，反之<span class="math inline">\(SS_{组间}\)</span>就越小。<span class="math inline">\(SS_{组间}\)</span>反应了各组均数的变异，存在这种变异的原因有：①随机误差；②处理的不同水平可能对实验结果的影响。</p>
<p><strong>3. 组内变异</strong>。在同一处理组中，虽然每个实验对象接受的处理相同，但观测值仍各不相同，这种变异称为组内变异（误差）。组内变异用组内各观测值<span class="math inline">\(X_{ij}\)</span>与其所在组的均数<span class="math inline">\(\bar{X_{i}}\)</span>的差值的平方和表示，记为<span class="math inline">\(SS_{组内}\)</span>，表示随机误差的影响。公式略。</p>
<p>总离均差平方和分解为组间离均差平方和与组内离均差平方和，就有了以下公式： <span class="math inline">\(SS_{总}=SS_{组间}+SS_{组内}\)</span></p>
<p>各离均差平方和的自由度为：</p>
<p><span class="math inline">\(\nu_{总}=N-1，\nu_{组间}=g-1,\nu_{组内}=N-g\)</span></p>
<p>变异程序除与离均差平方和的大小腾外，还与其自由度有关，由于各部分自由度不相等，因此积分离均差平方和不能直接比较，须将各部分离均差平方和除以相应的自由度，其比值称为均方差，简称为均方（mean square, MS)。公式为：</p>
<p><span class="math inline">\(MS_{组间}=\frac{SS_{组间}}{\nu_{组间}}\)</span> <span class="math inline">\(MS_{组内}=\frac{SS_{组内}}{\nu_{组内}}\)</span></p>
<p>如果各组样本的总体均数相等(<span class="math inline">\(H_{0}:\mu_{1}=\mu_{2}\dots=\mu_\)</span>)，即各处理组的样本来自相同的总体，无处理因素的作用，则组间变异同组内变异一样，只反映随机误差作用的大小，组间均方与组内无方的比值称为F统计量，如下所示：</p>
<p><span class="math inline">\(F=\frac{MS_{组间}}{MS_{组内}}\)</span></p>
<p>如果F值接近于1，就没有理由拒绝<span class="math inline">\(H_{0}\)</span>;反之，F值越大，拒绝<span class="math inline">\(H_{0}\)</span>的理由越充分，数理统计的理论证明，当<span class="math inline">\(H_{0}\)</span>成立时，F统计量服从F分布，方差分析是单侧F检验。</p>
<h2 id="变异是方差分析的基本思想">变异是方差分析的基本思想</h2>
<p>上面的话可能不太好理解。现在用大白话来理解一下，例如我们要研究某个化合物是否有改善肥胖的效果，我们最初肯定是要做动物实验，动物实验的话，例如采用C57的小鼠，分为5组，第1组，给生理盐水，第2组，给减肥药（相当于阳性对照），第3组，给高剂量的化合物，第4组，给中剂量的化合物，第5组，给低剂量的化合物。分别喂一段时间后，我们发现小鼠的体重有所变化，这个变化由两部分构成，第一个就是外界的刺激因素导致的，第二种就是小鼠自身导致的。这种变化我们可以称为<code>变异（variance）</code>，方差分析研究的本质就是这种变异（体重的变化，不是基因变异那种变异），方差分析的英语就是<code>Analysis of variance</code>，如果外界的刺激的因素导致的变异程度远远大于小鼠自身因素导致的变异，那么我们就可以认为，导致小鼠体重这种变异是由外界刺激引起的。</p>
<p>不过这样还有一个问题，因为数据越多，变异程度就越大，为了解决这个问题，就需要用变异除以自由度（例数-1），这样比较的就是平均的变异，因此方差分析中就出现了均方（MS）和组内均方的概念。组间均方/组内均方就是通常所说的F值，实际上代表了这样一个含义：如果组间变异远远大于组内变异，那么组间均方除以组内均方的值肯定很大，反之，这一值就会很小。但是，到底大到什么程度才认为有统计学意义呢，那就得根据F分布来判断。</p>
<h3 id="方差分析的应用条件">方差分析的应用条件</h3>
<p>多个样本均数比较的方差分析其应用条件为：</p>
<p>①各样本是相互独立的随机样本，均来自正态分布总体；</p>
<p>②相互比较的各样本的总体方差相等，即具有等方差齐性；</p>
<p>③每个样本之间都是独立的。</p>
<h2 id="r中的方差分析函数">R中的方差分析函数</h2>
<p>所用的函数为aov()： 语法为：<code>aov（formula,data=dataframe）</code> 其中formula可使用的特殊符号如下，其中y为因变量，A、B、C为自变量：</p>
<table>
<thead>
<tr class="header">
<th>符号</th>
<th>用法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>～</td>
<td>分隔符，左边为因变量，右边为自变量。例y～A+B+C</td>
</tr>
<tr class="even">
<td>+</td>
<td>分隔自变量</td>
</tr>
<tr class="odd">
<td>：</td>
<td>表示交互项，如y～A+B+A:B</td>
</tr>
<tr class="even">
<td>*</td>
<td>表示所有可能的交互项，如y～A * B *C等价于y～A+B+C+A:B+A:C+B:C+A:B:C</td>
</tr>
<tr class="odd">
<td>^</td>
<td>表示交互项达到的某个次数，如y～(A+B+C)^2等价于y～A+B+C+A:B+A:C+B:C</td>
</tr>
<tr class="even">
<td>.</td>
<td>表示包含除因变量以外的所有变量。如y～.</td>
</tr>
</tbody>
</table>
<h2 id="单因素方差分析">单因素方差分析</h2>
<p>单因素方差分析（one-way ANOVA）是指对单因素试验结果进行分析，检验因素对试验结果有无显著性影响的方法。单因素方差分析是用来检验多个平均数之间的差异，从而确定因素对试验结果有无显著性影响的一种统计方法。对于完全随机设计试验且处理数大于2时可以用单因素方差分析（等于2 时用t检验）。离差平方和的分解公式为：SST(总和)=SSR(组间)+SSE(组内)，F统计量为MSR/MSE，MSR=SSR/k-1,MSE=SSE/n-k。其中SST为总离差、SSR为组间平方和、SSE为组内平方和或残差平方和、MSR为组间均方差、MSE为组内均方差。</p>
<h4 id="anova-案例a">ANOVA-案例A</h4>
<p>单因素方差分析例4-2：某医生为了研究一种降血脂新药的临床疗效，按统一纳入标准选择120名高血脂患者，采用完全随机设计方法将患者等分为4组（具体分组方法见例4-1），进行双盲试验。6周后测得低密度脂蛋白作为试验结果，见表4-3。问4个处理组患者的低密度脂蛋白含量总体均数有无差别? 数据如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/data_szq_402.png">

</div>
<p><strong>计算过程如下所示：</strong></p>
<h5 id="导入数据">1. 导入数据</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">anova1 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_402.csv&quot;,sep=&quot;,&quot;)</div><div class="line">library(reshape2)</div><div class="line">anova1 &lt;- melt(anova1)</div></pre></td></tr></table></figure>
<h5 id="正态检验">2.正态检验</h5>
<p>方差分析需要一定的假设，即数据集应该符合正态和各组的方差相等，可以分别用<code>shapiro.test</code>和<code>bartlett.test</code>检验从P值观察到这两个假设是符合的。对于不符合假设的情况，我们就要用到非参数方法，例如Kruskal-Wallis秩和检验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">group &lt;- c(&quot;control&quot;,&quot;high&quot;,&quot;middle&quot;,&quot;control&quot;)</div><div class="line"></div><div class="line">for(i in group)&#123;</div><div class="line">  print(shapiro.test(anova1[anova1$variable==i,]$value))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95229</span>, p-value = <span class="number">0.1947</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95833</span>, p-value = <span class="number">0.2806</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.9445</span>, p-value = <span class="number">0.1202</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95229</span>, p-value = <span class="number">0.1947</span></div></pre></td></tr></table></figure>
<p>P值大于0.05说明数据正态P值大于0.05说明数据正态</p>
<h5 id="方差齐性检验"><strong>3. 方差齐性检验:</strong></h5>
<p>方差齐性检验就是检验各组样本所代表的总体方差是否一致的检验，两样本方差齐性检验使用Bartlett法，同样，它也适用于多样本的方差齐性检验，它是它要求所检验的样本总体符合正态分页，当不符合正态分布的时候，就不能使用，则要用Levene检验。Levene检验不受数据颁贩限制，是一种稳健的检验，因而被广泛地认为是一种标准的检验方差齐性的检验。</p>
<p><strong>方差齐性通常用bartlett检验</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bartlett.test(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova1.png">

</div>
<p>结果显示p值大于0.05，可认为方差齐性。</p>
<p>或者用<strong>levene检验：</strong></p>
<p>Levene检验既可以用于正态分布的数据，也可以用于非正态分布的数据或分布不明的数据，具有比较稳健的特点，检验效果也比较理理想。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(car)</div><div class="line">leveneTest(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova2.png">

</div>
<p>结果发现sig值大于0.05,表明符合方差齐性假设,可以进行进一步的参数检验。</p>
<h5 id="检验整体均值是否有差异"><strong>4. 检验整体均值是否有差异</strong></h5>
<p>方差例如技术的目的就是要比较因素A的r水平上，试验结果是否有显著差异，以样本作为检验的标准，写出检验假设，如下所示：</p>
<p><span class="math inline">\(H_{0}:\alpha_{1}=\alpha_{2}=\cdots=\alpha_{r},\)</span>，<span class="math inline">\(H_{1}:\alpha_{1},\alpha_{2},\cdots,\alpha_{r}\)</span></p>
<p>如果拒绝原假设，则说明样本来自不同的正态总体，则由因素A的各个水平所造成的均值差异有统计意义；若不能拒绝原假设，说明样本来自相同的正态总体，因素的 不同水平之间无差异。在这个案例中，我们研究的就是不同剂量的药物对低密度脂蛋白的水平是否产生影响，我们可以使用3个函数来进行计算。</p>
<h6 id="aov">aov()</h6>
<p>aov函数的使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aov(formula,data=<span class="literal">NULL</span>,projections=<span class="literal">FALSE</span>,qr=<span class="literal">TRUE</span>,contrasts=<span class="literal">NULL</span>,<span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中formula表示主方差分析的公式，在单因素方差分析中，即为<code>x~A</code>；data表示方差分析的数据框；projections为逻辑值，表示是否返回预测结果；qr是逻辑值，表示是否返回QR分解结果，默认为TRUE；contrasts是公式中的一些因子的对比列表，计算过程如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result &lt;- aov(value~variable,data=anova1)</div><div class="line">summary(result)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova4.png">

</div>
<p>其中Residuals是残差，variable代表不同的组，p值小于0.001，因此各组之间存在显著性差异。另外，R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。</p>
<h6 id="oneway.test">oneway.test()</h6>
<p>也可以采用<code>oneway.test()</code>函数进行检验，</p>
<p><code>oneway.test()</code>函数的用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneway.test(formual,data,subset,na.action,var.equal=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>若各水平下的总体方差相等，且参数var.equal=TRUE，那么等于同函数aov()所作的方差分析结果。在默认情况下，各水平的总体方差不相等(var.equal=FALSE)，则使用Welch的近似方法，在任何多个样本的情况下作两样本Welch检验，在满足方差齐发的条件下，使用oneway.test()的计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; result2 &lt;- oneway.test(value~variable,data=anova1,var.equal=<span class="literal">TRUE</span>)</div><div class="line">&gt; result2</div><div class="line"></div><div class="line">	One-way analysis of means</div><div class="line"></div><div class="line">data:  value and variable</div><div class="line"><span class="literal">F</span> = <span class="number">24.884</span>, num df = <span class="number">3</span>, denom df = <span class="number">116</span>, p-value = <span class="number">1.674e-12</span></div></pre></td></tr></table></figure>
<h6 id="lm">lm()</h6>
<p>单因素方差分析的数学模型可以看作是一种特殊的线性模型，因此方差分析还可以通过线性模型函数lm()计算得到，再利用anova()提取其中的方差分析表，因此aov(formula)等价于anova(lm(formula))，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; anova(lm(value~variable,data=anova1))</div><div class="line">Analysis of Variance Table</div><div class="line"></div><div class="line">Response: value</div><div class="line">           Df Sum Sq Mean Sq <span class="literal">F</span> value    Pr(&gt;<span class="literal">F</span>)    </div><div class="line">variable    <span class="number">3</span> <span class="number">32.156</span> <span class="number">10.7187</span>  <span class="number">24.884</span> <span class="number">1.674e-12</span> ***</div><div class="line">Residuals <span class="number">116</span> <span class="number">49.967</span>  <span class="number">0.4308</span>                      </div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div></pre></td></tr></table></figure>
<h5 id="均数间的两两比较"><strong>5. 均数间的两两比较</strong></h5>
<p>方差分析得出总体之间有差异，要进一步知道哪两组之间有差异，就要使用均数间的多重比较，常用的比较方法有SNK检验（q检验），LSD检验，Bonferroni检验，Dunnett检验，TurkeyHSD检验，下面是对一些常用的两两比较方法的汇总：</p>
<h6 id="常见的两两比较方法">5.1 常见的两两比较方法</h6>
<p><strong>LSD</strong>：相当于t检验，只不过它需要在方差分析一定要有统计学差异的情况下才用。所以LSD法并没有控制假阳性错误。一般情况下，如果你在设计初期就有很明确的目的，可以考虑这种方法，因为每一对比较都是有特定意义的，不用非得控制假阳性错误。</p>
<p><strong>SNK</strong>法是先按多组均值大小排序，然后按一个有点类似于t检验的公式分别比较（不过误差计算不同）。比如a、b、c三组均值分别是a最小，c最大，b居中。那么比较时，很显然a和c差别最大，所以在最后的界值上做一些调整。例如，原来可能t检验的界值是2.83，只要t值大于2.83就算有差异，现在把界值调大，比如调到3.40，a和c的比较计算的t值，只有大于3.4才算有差异。这种调整的界值叫做q界值。这种方法对假阳性错误的控制依然不到位。所以如果你想控制假阳性，不要选这种方法。</p>
<p><strong>Bonferroni法</strong>大概是最流行的一种方法，因为简单。它的思想是调整检验水准，根据比较的次数重新设定检验水准，然后根据P值做出结论。比如常规的检验水准是0.05，只要P小于0.05就认为有统计学差异。但是如果用Bonferroni法调整，则需要0.05除以比较次数，如比较6次，这时调整后的检验水准是0.05/6=0.0083，也就是说，P值小于0.0083才算有差异。这种方法其实更像是一种检验水准调整方法，简单易用，不仅可以用于均值的两两比较，也可用于率的两两比较。比如你要做三组的卡方检验，想进一步两两比较，就可以考虑用这种方式，即分别做两组的卡方，但是一共比较3次，所以P值小于0.0167才算有差异。这种方法的缺点是，当比较次数多时，结果过于保守，比如比较10次，那就需要P值小于0.005才算有差异，有时很难达到。</p>
<p>再说点其它国内课本上不大介绍但是国外介绍比较多的几种方法。</p>
<p><strong>Tukey法</strong>，有时也叫<strong>Tukey HSD法</strong>（Honestly Significant Difference test），这种方法大概是统计学家最认可一致的方法了，绝大多数统计学家都相信，Tukey法的检验效率可能是最高的。Tukey法也是基于q检验，大概意思是先确定一个最大差异的临界值，然后分别对其中两组比较，看看哪两组差值大于这个界值，就算有差异。Tukey法是大多数统计学家首先推荐的两两比较方法，不过这种方法只适用于组间例数相等的情况。对于组间例数不等的时候，可用修正的Tukey法，也叫作Tukey-Kramer法。</p>
<p><strong>现在计算各组之间的均数与SD</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=mean)</div><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=sd)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova1_mean_sd.png">

</div>
<p><strong>绘制箱形图可能观察到不同因素对于因变量的影响</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot.design(value ~ variable,data =anova1, main = &quot;Group means&quot;) </div><div class="line"># plot.design was inclued in packages &quot;graphics&quot;</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova13.png">

</div>
<p><strong>绘制有置信区间的组均值图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(gplots)</div><div class="line">plotmeans(value ~ variable,data =anova1 )</div></pre></td></tr></table></figure>
<p>图片如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/anova12.png"></p>
<p>单因素方差分析是从总体的角度上说明各效应的均值之间存在着显著差异，但具体在哪些水平下的均值存在较大差异，还不清楚，因此我们要对每一对样本均值进行一一比较，既要进行组间均值的两两比较。最常用，也是最直接的方法就是多重t检验方法，其对因子A每个水平下的数据两两比较均值进行t检验，但估计方差时用的是全部数据的误差均方和<span class="math inline">\(MS_{E}\)</span>，检验的假设为：</p>
<p><span class="math inline">\(H_{0}:\mu_{i}=\nu_{j},i\neq j,i,j=1,2,\cdots,r\)</span></p>
<p>构建t检验统计量，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180825/c6CKBdgLGa.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在原假设成立的情况下，该统计量服从自由度为n-r的t分布，所以检验拒绝为<span class="math inline">\(|T_{ij}&gt;t_{\alpha/2}(n-r)\)</span>。</p>
<p>多重t检验的思路简单，但是这样的方法不能直接使用，这是因为在样本之间多次重复使用t检验会大大增加犯第一类错误的概率。例如因子A有三个水平，需要比较3次(n=k(k-1)/2)，显著性水平为0.05，回此每次比较犯第一类错误的概率就是0.05，那么截取次比较同时进行，犯第一次错误的总概率为<span class="math inline">\(1-(1-\alpha)^n=1-0.95^3=0.1426\)</span>，这个数字就比较大了，因此直接使用多重t检验的结果不一定是可靠的，统计学家们提供了很多方法对P值进行修正，R中的P值修正函数是<code>p.ajdust()</code>，其调用格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.adjust(p,method=p.ajdust.methods,n=length(p))</div></pre></td></tr></table></figure>
<p>在R中，输入如下指令可以看到调整方法的列表，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; p.adjust.methods</div><div class="line">[<span class="number">1</span>] <span class="string">"holm"</span>       <span class="string">"hochberg"</span>   <span class="string">"hommel"</span>     <span class="string">"bonferroni"</span> <span class="string">"BH"</span>         <span class="string">"BY"</span>         <span class="string">"fdr"</span>       </div><div class="line">[<span class="number">8</span>] <span class="string">"none"</span></div></pre></td></tr></table></figure>
<p>当多重检验次数较多时，bonferroni修正方法的效果比较好，思路也很简单：如果在同一个数据集上同时进行n个独立的假设检验，那么用于每一个假设的统计显著水平，应为仅检验一个假设时显著水平的<code>1/n</code>，即<span class="math inline">\(\alpha&#39;=\alpha/n\)</span>，其中n为多重t检验的次数。</p>
<p>在R中计算均值的多重t检验时，用函数<code>pairwise.t.test()</code>返回多重比较的修正P值，其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pairwise.t.test(x, g, p.adjust.method = p.adjust.methods,</div><div class="line">                pool.sd = !paired, paired = <span class="literal">FALSE</span>,</div><div class="line">                alternative = c(<span class="string">"two.sided"</span>, <span class="string">"less"</span>, <span class="string">"greater"</span>),</div><div class="line">                <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中参数x是响应向量，g是因子向量，p.adjust.methods给出了P值的修正方法，默认按Holm方法修正，若不作任何调整则设为none；paired为逻辑值，指示是否要配对t检验；alternative指明检验的方向问题。现在对前面的结果进行多重t检验，使用bonferroni修正方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; pairwise.t.test(anova1$value,anova1$variable,p.adjust.method = <span class="string">"bonferroni"</span>)</div><div class="line"></div><div class="line">	Pairwise comparisons using t tests with pooled SD </div><div class="line"></div><div class="line">data:  anova1$value and anova1$variable </div><div class="line"></div><div class="line">       control low     middle </div><div class="line">low    <span class="number">0.00029</span> -       -      </div><div class="line">middle <span class="number">0.00020</span> <span class="number">1.00000</span> -      </div><div class="line">high   <span class="number">2.1e-13</span> <span class="number">0.00013</span> <span class="number">0.00020</span></div><div class="line"></div><div class="line">P value adjustment method: bonferroni</div></pre></td></tr></table></figure>
<p>经过修正后的p值会比原理增大很多，这在一定程度上克服了多重t检验增加犯第一类错误概率的缺点，从上面结果来看，除了middle与low组外，其余组之间的p值都很小，说明这几个样本之间有差异。</p>
<p>再看其它的两两比较方法，这些方法有LSD，TukeyHSD，Scheffe检验，</p>
<h6 id="lsd检验">LSD检验</h6>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(agricolae) #此包中有LSD检验</div><div class="line">result &lt;- LSD.test(result,&quot;variable&quot;,p.adj=&quot;bonferroni&quot;)</div><div class="line">result</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova5.png">

</div>
<p>注：R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。 Bonferroni校正(“bonferroni”)，用于多重比较的p值校正，次数不多时适用。如果在同一数据集上同时检验n个独立的假设，那么用于每一假设的统计显著水平，应为仅检验一个假设时的显著水平的1/n。举个例子：如要在同一数据集上检验两个独立的假设，显著水平设为常见的0.05。此时用于检验该两个假设应使用更严格的0.025。即0.05* (1/2)。该方法是由Carlo Emilio Bonferroni发展的，因此称Bonferroni校正。在药理实验中，动物数通常不会太多，用Bonferroni校正的居多。</p>
<h6 id="tukeyhsd检验">TukeyHSD检验</h6>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">result2 &lt;- aov(value~variable,data=anova1)</div><div class="line">result.tukey &lt;- TukeyHSD(result2)</div><div class="line">result.tukey</div><div class="line">plot(result.tukey)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova_tukey.png">

</div>
<p>图片结果：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/anova_tukey_plot.png">

</div>
<h6 id="glht函数做tukey检验">glht()函数做Tukey检验</h6>
<p>此外，<code>multcomp</code>包中<code>glht()</code>函数提供了多重均值更全面的方法，适用于线性模型和广义线性模型，下面的代码重现Tukey HSD检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(multcomp)</div><div class="line">result4 &lt;- aov(value ~ variable, data = anova1)</div><div class="line">tukey4 &lt;- glht(result4, linfct=mcp(variable=<span class="string">"Tukey"</span>))</div><div class="line">summary(tukey4)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; summary(tukey4)</div><div class="line"></div><div class="line">	 Simultaneous Tests <span class="keyword">for</span> General Linear Hypotheses</div><div class="line"></div><div class="line">Multiple Comparisons of Means: Tukey Contrasts</div><div class="line"></div><div class="line"></div><div class="line">Fit: aov(formula = value ~ variable, data = anova1)</div><div class="line"></div><div class="line">Linear Hypotheses:</div><div class="line">                      Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">low - control == <span class="number">0</span>    -<span class="number">0.71500</span>    <span class="number">0.16946</span>  -<span class="number">4.219</span> <span class="number">0.000291</span> ***</div><div class="line">middle - control == <span class="number">0</span> -<span class="number">0.73233</span>    <span class="number">0.16946</span>  -<span class="number">4.322</span> <span class="number">0.000171</span> ***</div><div class="line">high - control == <span class="number">0</span>   -<span class="number">1.46400</span>    <span class="number">0.16946</span>  -<span class="number">8.639</span>  &lt; <span class="number">1e-04</span> ***</div><div class="line">middle - low == <span class="number">0</span>     -<span class="number">0.01733</span>    <span class="number">0.16946</span>  -<span class="number">0.102</span> <span class="number">0.999615</span>    </div><div class="line">high - low == <span class="number">0</span>       -<span class="number">0.74900</span>    <span class="number">0.16946</span>  -<span class="number">4.420</span> <span class="number">0.000108</span> ***</div><div class="line">high - middle == <span class="number">0</span>    -<span class="number">0.73167</span>    <span class="number">0.16946</span>  -<span class="number">4.318</span> <span class="number">0.000170</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line">(Adjusted p values reported -- single-step method)</div></pre></td></tr></table></figure>
<p>绘制不同组的箱线图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot(cld(tukey4,level = <span class="number">.05</span>),col=<span class="string">"lightgrey"</span>)</div><div class="line"><span class="comment">#cld()函数中level选项设置了使用显著水平0.05，即95%的置信区间</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/j88jcgEj31.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h5 id="残差分析">7.残差分析</h5>
<p>这一步做残差分析就是为了再次验证原始数据是否服从正态分布，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">residual &lt;- rstudent(result4)</div><div class="line">qqnorm(residual, pch=<span class="number">20</span>, cex=<span class="number">2</span>)</div><div class="line">qqline(residual, col=<span class="string">"gray60"</span>, lwd=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>残差的QQ图如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/jk1GHii3D5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>shapiro检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; shapiro.test(residual)</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  residual</div><div class="line">W = <span class="number">0.9884</span>, p-value = <span class="number">0.4026</span></div></pre></td></tr></table></figure>
<p>p值的为0.4026，可以认为残差满足正态性。</p>
<p>绘制残差图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(residual ~ anova1$variable, main=<span class="string">"各组的残差图"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/0F8L0C037K.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>对残差进行方差齐性检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(car)</div><div class="line">&gt; leveneTest(result4)</div><div class="line">Levene<span class="string">'s Test for Homogeneity of Variance (center = median)</span></div><div class="line"><span class="string">       Df F value Pr(&gt;F)</span></div><div class="line"><span class="string">group   3   1.493 0.2201</span></div><div class="line"><span class="string">      116</span></div></pre></td></tr></table></figure>
<p>P值大于0.05，可以认为残差满足方差齐性。</p>
<h4 id="anova-案例b">ANOVA-案例B</h4>
<p>再看一个案例，进行一次完整的ANOVA分析，如下所示：</p>
<p>某单位研究不同药物对小白鼠的镇咳作用，抽取40只小白鼠随机分配到各个药物组中，实验时先用0.2mL NH4OH对小白鼠喷雾，测定其发生咳嗽时间。以给药前后发生咳嗽时间的差值衡量不同药物的镇咳作用，结果见表5.1.试比较3种药物的平均推迟咳嗽时间的差异有无差异。（王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.）</p>
<p>计算过程如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">anova2 &lt;- read.csv(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_anova_01.csv"</span>,sep=<span class="string">","</span>)</div><div class="line"><span class="comment"># input raw data </span></div><div class="line"><span class="comment"># 王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.例5.1</span></div><div class="line"></div><div class="line">anova2$group &lt;- as.factor(anova2$group)</div><div class="line"><span class="keyword">library</span>(car)</div><div class="line">leveneTest(anova2$time~anova2$group)</div><div class="line">result &lt;- aov(anova2$time~anova2$group)</div><div class="line">summary(result)</div><div class="line">compareresult &lt;- TukeyHSD(result)</div><div class="line">compareresult</div><div class="line">plot(compareresult)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">3</span>)&#123;</div><div class="line">+   result &lt;- shapiro.test(filter(anova2,group==i)$time)</div><div class="line">+   print(result)</div><div class="line">+ &#125;</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.9778</span>, p-value = <span class="number">0.9523</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.98349</span>, p-value = <span class="number">0.9878</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.94005</span>, p-value = <span class="number">0.5536</span></div><div class="line"></div><div class="line">&gt; </div><div class="line">&gt; <span class="comment"># test for homogeneity var</span></div><div class="line">&gt; leveneTest(anova2$time~anova2$group)</div><div class="line">Levene<span class="string">'s Test for Homogeneity of Variance (center = median)</span></div><div class="line"><span class="string">      Df F value Pr(&gt;F)</span></div><div class="line"><span class="string">group  2  1.4002 0.2593</span></div><div class="line"><span class="string">      37               </span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## test for mean of all samples</span></div><div class="line"><span class="string">&gt; result &lt;- aov(anova2$time~anova2$group)</span></div><div class="line"><span class="string">&gt; summary(result)</span></div><div class="line"><span class="string">             Df Sum Sq Mean Sq F value Pr(&gt;F)  </span></div><div class="line"><span class="string">anova2$group  2   5062  2531.2   3.485 0.0411 *</span></div><div class="line"><span class="string">Residuals    37  26877   726.4                 </span></div><div class="line"><span class="string">---</span></div><div class="line"><span class="string">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## GLM for mean of all samples</span></div><div class="line"><span class="string">&gt; anova(lm(anova2$time~anova2$group))</span></div><div class="line"><span class="string">Analysis of Variance Table</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Response: anova2$time</span></div><div class="line"><span class="string">             Df  Sum Sq Mean Sq F value  Pr(&gt;F)  </span></div><div class="line"><span class="string">anova2$group  2  5062.5 2531.23  3.4845 0.04107 *</span></div><div class="line"><span class="string">Residuals    37 26877.4  726.42                  </span></div><div class="line"><span class="string">---</span></div><div class="line"><span class="string">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## test for each pair of samples</span></div><div class="line"><span class="string">&gt; ## TukeyHSD</span></div><div class="line"><span class="string">&gt; TukeyHSD(result)</span></div><div class="line"><span class="string">  Tukey multiple comparisons of means</span></div><div class="line"><span class="string">    95% family-wise confidence level</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Fit: aov(formula = anova2$time ~ anova2$group)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">$`anova2$group`</span></div><div class="line"><span class="string">        diff        lwr      upr     p adj</span></div><div class="line"><span class="string">2-1 12.33333 -11.694604 36.36127 0.4302024</span></div><div class="line"><span class="string">3-1 29.03333   2.169283 55.89738 0.0317315</span></div><div class="line"><span class="string">3-2 16.70000 -10.164050 43.56405 0.2944100</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">&gt; pairwise.t.test(anova2$time,anova2$group,p.adjust.method = "bonferroni")</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">	Pairwise comparisons using t tests with pooled SD </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  anova2$time and anova2$group </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">  1     2    </span></div><div class="line"><span class="string">2 0.654 -    </span></div><div class="line"><span class="string">3 0.036 0.413</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">P value adjustment method: bonferroni</span></div></pre></td></tr></table></figure>
<h3 id="section"></h3>
<h2 id="重复测量方差分析">重复测量方差分析</h2>
<h3 id="未设立平等对照的前后测量">未设立平等对照的前后测量</h3>
<p>重复测量资料(repeated measurement data)最常见的情况是同一个试验对象前后有2次测量结果的试验结果，也称作前后测量设计(premeasure-postmeasure design)，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/5aiA3d3hH3.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>… …</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/DDCgeCg9hm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>虽然这个表和配对设计的t检验结果表达完全相同，但却是属于两种不同类型的设计，其区别在于</p>
<ol style="list-style-type: decimal">
<li>配对设计中同一对子的两个实验单位可以随机分配处理，两个实验单位同期观察试验结果，哦可以比较处理组间差别。前后测量设计不能同期观察试验结果，虽然可以在前后测量之间安排处理，但本质上比较的是前后差别，推论处理是否有效是有条件的，即假定测量时间对观察结果没有影响。</li>
<li>配对t检验要求同一对子的两个实验单位的观察结果分别与差值相互独立，差值服从正态分布。而胶后测量设计前后两次观察结果通常与差值不独立，大多数情况下第一次观察结果与差值存在负相关关系，例如上表，治疗前舒张压与差值的相关系数为-0.602。</li>
<li>配对设计用平均差值推论处理的作用，前后测量测序除了分析平均差值外，还可以进行相关回归分析，由上表计算，治疗前后舒张压的相关系数为0.963，P&lt;0.01，用治疗前舒张压(X)推论治疗后舒张压(Y)的回归方向为<span class="math inline">\(\hat{Y}=-49.534+1.266X\)</span>，截矩检验P=0.014，回归系数检验P&lt;0.01。</li>
</ol>
<h3 id="设立平等对照的前后测量">设立平等对照的前后测量</h3>
<p>第1张表中的高血压患者治疗后的舒张压平均下降了16mmHg，虽然经配对t检验，t=16.18，P&lt;0.01，这也未必说明治疗有效，因为住院休息，环境和情绪的改变同样可以使血压恢复平衡。因此，确定疗效的前后测量设计必须增加平行对照，例如将20位轻度高血压患者随机分配到处理组和对照组，试验结果见表12-2.如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/l5fc8dkH3L.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>比较这张表中处理组与对照组之间的差别，似乎可以用前后测量的差值(d)做两组均数比较的t检验，但上表中处理组与对照组的差值d方差不齐（F值为6.58，P&lt;0.01），不符合两无数比较t检验的前提条件，更为重要的是，如果处理组与对照组基线值（治疗前的舒张压）不同，那么差值不能作为判别组间差别的依据。</p>
<h3 id="重复测试设计">重复测试设计</h3>
<p>当前后测量设计的重复测量次数m&gt;=3时，称为<strong>重复测试设计</strong>或<strong>重复测量数据</strong>，重复测试数据类似于随机区间设计数据，如下表所示，而且同样可以计算出随机区组设计的方差分析表：</p>
<h3 id="案例分析b">案例分析B</h3>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/G6Bb7ab555.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下表是随机区组数据的方差分析表：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/87j25BaCDh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>但重复测量设计与随机区级设计有区别，它们的区别在于：</p>
<p>（一）重复测量设计中的“处理”是在区组（受试者）间随机分配，区组内的各时间点是固定的，不能随机分配，如下表所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/mBj67K9cJb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>A、B两种处理随机分配给各个患者后，每个患者测量的时间是相同的，随机区组设计要求每个区组内实验单位彼此独立，处理只能在区组内随机分配，每个实验单位接受的处理是不相同的，如下所示（随机区间设计）：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/CClLcmkD0I.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>（二）重复测量设计区组内实验单位彼此不独立，如在表12-3中，每个受试者血糖浓度的个体特征是用4个时间点的测量值刻画的，如下图所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/02k82Je8ik.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>同一受试者的血样重复测量结果是高度相关的，相关系数如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/aKHCmAJIC8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>更准确地说，表12-3重复测量数据用随机区组方差分析比较处理组间差异，前提条件是要满足<strong>“球对称(sphericity)”</strong>假设，即重复测量误差的协方差矩阵经正交对比变换后，与单位矩阵<span class="math inline">\(I_{4\times4}\)</span>成比较，表12-3数据Mauchly“球对称”检验结果见表12-7，其中<span class="math inline">\(\chi^2=15.44,\nu=5,P=0.01\)</span>，拒绝“球对称”假设，即表12-3的数据不满足随机区组方差分析（表12-4）“球对称”的条件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/b9h4ecdbab.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>此时，就需要对组内效应的F界值进行校正，校正的方法是用“球对称”系数<span class="math inline">\(\epsilon\)</span>乘以组内效应F界值的自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(\nu_{2}\)</span>，得到<span class="math inline">\(\tau_{1}=\nu_{1}\epsilon,\tau_{2}=\nu_{2}\epsilon\)</span>，用<span class="math inline">\(F_{\alpha,(\tau_{1},\tau_{2})}\)</span>作为检验界值，“球对称”系数的常用估计方法有Greenhouse-Geisser、Huynh-Feldt和Lower-bound三种方法，例如，表12-4组内效应的F界值为<span class="math inline">\(F_{0.05,(3,21)}=3.07\)</span>，Greenhouse-Geisser的校正系数0.536校正后的F界值为<span class="math inline">\(F_{0.05,(1.6,11.25)}\approx F_{0.05,(1,11)}=4.84\)</span>，大于未校正的界值3.07，也就是说当重复测量数据不满足”球对称“假设时，采用随机区组设计方差分析时，增大了I型错误（无差别判断为有差别）的概率，当样本含量较小时，Mauchly”球对称“检验交通较低，易发生II型错误（不满足”球对称“判断为满足），此时，对处理组内效应F界值的自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(\nu_{2}\)</span>仍要进行校正，以得到可信的统计结论。</p>
<h3 id="重复测量数据的两因素两水平分析">重复测量数据的两因素两水平分析</h3>
<h4 id="两因素离均差平方和分解">两因素离均差平方和分解</h4>
<p>将重复测量测序的干预因素作为A因素，共两个水平，1水平为”对照“，2水平为”干预“；前后两次测量时间作为B因素，共两个水平，1水平为”第1次测量时间“，2水平为”第2次测量时间“，这样共有(a1b1)、(a1b2)、(a2b1)、(a2b2)4个”处理“组，各组观察值的合计分别为T1、T2、T3、T4表示，A因素两水平的小计分别用A1、A2表示，B因素两水平的小计分别用B1、B2表示，处理组和对照组的例数相等，即n=n1=n2，<code>SS处理</code>可分解为A因素的离均差平方和<span class="math inline">\(SS_{A}\)</span>，B因素的离均差平方和<span class="math inline">\(SS_{B}\)</span>，AB交互作用的离均差平方和<span class="math inline">\(SS_{AB}\)</span>三部分，见表12-8，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/j03JJ82GEd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将表12-2的数据按照表12-8进行两因素离均差平方和进行分解，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/CJakL2FEj5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/LHlIFDl6i8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>主效应与交互作用的离均差平方和分解：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/dGA75G6F4C.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="组间组内离均差平方和分解与方差分析">组间、组内离均差平方和分解与方差分析</h3>
<p>重复测量数据的差异由两部分组成。一是观察对象的个体差异，其离均差平方和记作<code>SS组间</code>，二是每个观察对象前后两次观察之间的差异，其离均差平方和记作<code>SS组内</code>，设两组观察对象都为n，每个观察对象前后两次观察的合计值为<code>Mj</code>，<code>SS组间</code>和<code>SS组内</code>的计算方法见表12-9，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/Afm3BbLIhg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><code>SS组间</code>、<code>SS组内</code>分解完毕后，就可以用方差分析对A因素主效应、B因素主效应和AB因素交互作用进行假设检验了，由于A因素（干预分组）的作用于观察以刚，作用效应在<code>SS组间</code>，方差分析按表12-10进行，B因素主效应（测量前后）和AB交互作用的效应在<code>SS组内</code>,方差分析按表12-11进行，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/kiHjimfk23.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在根据表12-2中的数据，对处理组与对照组、治疗前后舒张压的差别进行统计分析。</p>
<h4 id="计算ss_组间ss_组内">1.计算<span class="math inline">\(SS_{组间}\)</span>、<span class="math inline">\(SS_{组内}\)</span></h4>
<p>表12-2共有20名患者，每个患者舒张压的合计为M1=130+114=244，M2=124+110=234，…，M19=120+124=244，M20=134+128=262，由于前面已经计算出C=580328.1，按表12-9中的公式计算，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/gHeEhkhEA9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="测量前后比较与交互作用分析">2.测量前后比较与交互作用分析</h4>
<p>由于已经计算出了<span class="math inline">\(SS_{B}=1020.1,SS_{AB}=348.1\)</span>，现在<code>SS组内</code>=1702，代入表12-11，得到方差分析表，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/H8j7Fe7gm2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="处理组与对照组比较">3.处理组与对照组比较</h4>
<p>前面已经计算出<span class="math inline">\(SS_{A}=202.5\)</span>，现在<code>SS组间</code>=2517.9，代入表12-10，得到方差分析表，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/JaKGbC7FaJ.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="结论">4.结论</h4>
<p>①由表12-12的方差分析表可知，治疗前后舒张压的交效应有差别(P&lt;0.01)，由于表12-2计算可知，治疗前的平均舒张压为(126.2+124.8)/2=125.5mmHg，治疗后的平均舒张压为(110.2+120.6)/2=115.4mmHg，治疗前后舒张压主效应的估计值为115.4-125.5=-9.6mmHg。①由表12-13方差分析表，不考虑测量时间，处理组与对照组舒张压的主效应未见差别(P&gt;0.05)，由原始数据过计算，处理组的平均舒张压为(126.2+110.2)/2=118.2mmHg，对照组的平均舒张压为(124.8+120.6)/2=122.7mmHg，处理组与对照组舒张压主效应的估计值为118.2-122.7=-4.5mmHg。③由表12-12方差分析表可知，测量前后与处理存在交互作用(P&lt;0.01)，即处理组和对照组治疗前后的舒张压的变化幅度不同。由单独效应、主效应和交互作用的概念可知，若存在交互作用，单独分析主效应的意义不大，需要爱一分析各因素的单位效应，按表12-2计算处理组和对照组的单独效应，处理组和对照组治疗前的基线数据没有统计学差异，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/63h0dmEF13.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>但处理组和舒张压平均下降16.0mmmHg，对照组平均仅下降4.2mmHg，AB交互作用F=18.8，P&lt;0.01，说明处理组的降压效应优于对照组。</p>
<h2 id="随机区组设计">随机区组设计</h2>
<p>随机区组设计(randomized block design)又称为配伍组设计，是配对设计的扩展。具体做法是：先按影响实验结果的非处理因素（如性别、体重、年龄、职业、病情、病程等）将实验对象配成区组(block)，再分别将各区组内的实验对象随机分配到各处理组或对照组。与完全随机设计相比，随机区组设计的特点是随机同分配的次数要重复多次，每次随机分配都对同一个区组内的实验对象进行，且各个处理组的实验对象数量相同，区组内均衡。在进行统计分析时，将区组变异离均差平方和从完全随机设计的组内离均差平方和中分离出来，从而减小组内离均差平方和（误差平方和），提高统计检验效率。若将区组作为另一处理因素的不同水平，随机区组设计等同于无重复观察的两因素设计。</p>
<p>现在看一下随机区组设计的案例。</p>
<p>如何按随机区组设计，分配5个区组的15只小白鼠接受甲、乙、丙三种抗癌药物？</p>
<p>方法为先将小白鼠的体重从轻到重编号，体重相近的3只小白鼠配成一个区组（下表中第一行和第二行），然后对这些小鼠分配随机数，在每个区组内将随机数按大小排序（下表第四行），各区组中序号为1的接受甲药、序号为2的接受乙药、序号为3的接受丙药，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180825/4gllA65BHi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>随机区组设计资料在进行统计分析时，需要根据数据特征选择方法，对于正态分布且方差齐同的资料，采用双向分类的方差分析(two-way classification ANOVA)或配对t检验(g=2)，当不满足方差分析或t检验条件时，可以进行变量变换后采用双向分析的方差分析或采用Fredman M检验。</p>
<h2 id="重复测量数据的两因素多水平分析">重复测量数据的两因素多水平分析</h2>
<p>大多数医学实验都有重复测量记录，如果统计分析时只分析最后一次的测量结果，那就会丧失很多“过程“信息，如果通过记录不同时间点的重复观察数据了解测量指标的时间变化趋势、药物在血中浓度变化的时间分析特征、不同时间的治疗效果等。在临床上，各个单个时间的测量值或许都在正常参考值范围以内（或以外），但如果发现该测量值持续上升（或下降），也说明患者的状态处理变化中，在统计分析时，保留”处理“前的基线(baseline)，如前面所述的患者治疗前收缩压，可以评价随机分级的均衡性，也能够提高统计分析的效率。</p>
<h3 id="实验设计方法">实验设计方法</h3>
<p>一般来说，任何实验设计都可以采用重复测量计算，即在实验过得中定期记录观察结果。所谓重复测量数据的两因素多水平设计，两因素指干预（A因素）和测量时间（B因素），多水平指干预（A因素）有g（大于等于2）个水平，测量时间（B因素）有m（大于等于2）个水平（时间点），即每个观察对象有m个重复测量数据，随机化分组是将作用于观察对象的g个干预随机分配，前面提到的重复测量数据的两因素两水平是两因素多水平的设计的特征，即g=m=2.</p>
<h3 id="试验结果的方差分析">试验结果的方差分析</h3>
<p>重复测量数据的统计分析有许多统计方法供选用，可以用单因素方差分析，也可以用多变量方差分析(MANOVA)，其中单因素方差分析最简单。设有观察对象随机等分成g个干预组，每组倒数为n，重复测量次数为m，每个观察对象测量值合计为<span class="math inline">\(M_{j}\)</span>，g个干预组，每组的测量值合计为<span class="math inline">\(A_{i}\)</span>。多个干预组比较的方差分析用表12-14，设<span class="math inline">\(B_{j}\)</span>表示第j个时间的测量值合计，<span class="math inline">\(T_{ij}\)</span>表示第i个干预，第j个时间的点测量值合计，多个时间点测量前后与交互作用的方差分析见表12-15，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/glC2LhlkjL.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="案例分析b-1">案例分析B</h3>
<p>将手术要求基本相同的15名患者随机分为3组，在手术过程中分别采用A、B、C三种麻醉诱导方法，在T0（诱导前）、T1、T2、T3、T4五个时间点测量患者的收缩压，数据记录见表12-16，试进行方差分析，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/Aj5f749J58.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="分解ss_组间ss_组内">1.分解<span class="math inline">\(SS_{组间}，SS_{组内}\)</span></h4>
<p>g=3,m=5,n=5,15名患者的合计分别为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/IfEf36023e.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="分解ss_ass_bss_ab">2.分解<span class="math inline">\(SS_{A}，SS_{B},SS_{AB}\)</span></h4>
<p>分组计算不同麻醉诱导、不同时间点患者的收缩压的合计值(<span class="math inline">\(T_{ij}\)</span>)，见表12-17，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/gGg62Ff2ch.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="方差分析表">3.方差分析表</h4>
<p>按表12-14、12-15列出方差分析表。</p>
<h4 id="f值的界值校正">4.F值的界值校正</h4>
<p>按表12-15的Lower-Bound自由度校正方法，<span class="math inline">\(F_{B}\)</span>的校正自由度<span class="math inline">\(\tau_{1}=1,\tau_{2}=g(n-1)=3 \times(5-1)=12\)</span>，查F界值表，<span class="math inline">\(F_{B}\)</span>的校正界值为<span class="math inline">\(F_{0.01,(1,12)=9.33}\)</span>（校正前为<span class="math inline">\(F_{0.01,(4,48)=3.74}\)</span>）。<span class="math inline">\(F_{AB}\)</span>的校正自由度<span class="math inline">\(\tau_{1}=g-1=2,\tau_{2}=g(n-1)=3 \times(5-1)=12\)</span>，查F界值表，<span class="math inline">\(F_{AB}\)</span>的校正界值为<span class="math inline">\(F_{0.01,(2,12)=6.93}\)</span>（校正前为<span class="math inline">\(F_{0.01,(8,48)=2.90}\)</span>），校正后的自由度和P值见下表：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/D0L7aI6LDj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="结论-1">5.结论</h4>
<p>不同麻醉诱导方法存在组间差别，见表12-18：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/19E9gHIA32.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>患者的收缩压在不同的诱导方法下，不同诱导时相变化的趋势不同，见表12-19:</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/D0L7aI6LDj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中A组不同诱导时间收缩压相对稳定，见表12-20，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/aJC1F9L1bg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="重复测量数据的多重比较">重复测量数据的多重比较</h3>
<p>重复测量数据的多重比较是一个比较复杂的问题，对不同研究有不同的要求，例如前面提到的，A、B、C三种麻醉诱导方法存在差别，每组患者不同诱导时相收缩压的趋势不同，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/7069Ef5AL9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>多重比较可能包括3种情况，一是A、B、C三组收缩压均数差别的两两比较，需要重复检验3次（A与B，A与C，B与C）；二是各组T0，T1，T2，T3和T4这5个不同时相收缩压均数变化曲线是否有固定趋势（<span class="math inline">\(H_{0}:\mu_{i}=\mu,i=1,2,3,4,5\)</span>)其中，<span class="math inline">\(\mu\)</span>是收缩压均数，如果拒绝H0，对于5次重复测量结果，曲线经下次多项式(polynomial)变换，需要检验下次多项式1次(linear)、2次(quadratic)、3次(cubic)、4次(order 4)是否为0，上图中的三条曲线共需要重复检验12次；三是各组T0，T1，T2，T3，T4这5个不同时相收缩压均数的两两比较，每组需要比较10次，3组共要做30次重复检验 。因此，前面提到的例题的多重检比较需要做2+12+30=44次。下面我们列出了SPSS重复测量数据的多重比较的计算结果。</p>
<h4 id="组间差别多重比较">组间差别多重比较</h4>
<p>在表12-18基础上进行两两比较，误差均方为<span class="math inline">\(\sqrt{946.48/4}=15.38\)</span>，由表12-20可知，A、B、C三组收缩压均数分别为119.68、124.48、128.20，两两比较可以选择LSD、SNK、Bonferroni等多重比较方法，下图为LSD两两比较结果，其中A与C的差别有统计学意义，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/cc7iib1Fk4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="时间趋势比较">时间趋势比较</h4>
<p>由表12-20可知，A组5个时相的收缩压分别为121.00，112.40，118.40，125.80，120.80，在SPSS中选择Polynomial正交多项式。表12-23就列出了A组收缩压均数5个时相的时间趋势检验结果，正交多项式1次项、3次项有统计学意义(P&lt;0.05)，拒绝<span class="math inline">\(H_{0}:\mu_{i}\neq \mu\)</span>。B组和C组的时间趋势检验结果见表12-24、表12-25，正交多项式1次项、2次项、4次项均有统计学意义，拒绝<span class="math inline">\(H_{0}:\mu_{i}\neq \mu\)</span>。如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/m6cK3G2Bcl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="时间点的多重比较">时间点的多重比较</h4>
<p>一些医学研究关心同一个处理重复测量数据时间点的两两差别，如例12-3中A组5个时相收缩压均数之间的差别。由于当时间点较多时，重复检验次数将难以承受，如果假定5个处理组，10个时间点，重复检验次数就是5x45=225次。因此，时间点多重比较通常采用事前检验(prior tests)的策略。事前检验与事后检验(ost hoc tests)的不同之处在于，事前检验的检验次数是在试验开始前就确定了，无论方差分析结论如何都执行重复检验，比较的时间点按专业意义设定，如试验后各时间点均数与基线比较，重复检验次数比较少。事后检验则是方差分析结果拒绝<span class="math inline">\(H_{0}\)</span>才进行两两比较，通常所有的时间上炽都要比较、重复检验次数较多。</p>
<p>按照事前检验策略，例12-3中A组5个时间收缩压均数差别的两两比较，只比较麻醉诱导后各时相T1，T2，T3，T4与诱导前T0的差别，只需要检验4次，采用Bonferroni多重比较方法，设定α=0.05，检验的名义水准为<span class="math inline">\(a&#39;=0.05/4=0.0125\)</span>，下表为SPSS的检验结果，可以发现，A组麻醉诱导后的4个时相与诱导前比较的重复检验，仅T1收缩压降低(P&lt;0.05)。B组诱导后T2收缩压降低，T3、T4收缩压增高(P&lt;0.05)，C组诱导后T2收缩压降低，T3收缩压升高(P&lt;0.05)，因此A组麻醉诱导后收缩压的波动小于B组和C组，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/8iAKii5Hi3.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h1 id="例11-122析因设计">例11-1：2×2析因设计</h1>
<p>将20只家兔随机等分4组，每组5只，进行神经损伤后的缝合试验。处理由两个因素组合而成，A因素为缝合方法，有两水平，一水平为外膜缝合，另一水平为束膜缝合，B因素为缝合后的时间，有两水平，一水平为缝合后1月，另一水平为缝合后2月。试验结果为家兔神经缝合后的轴突通过率(%)（注：测量指标，视为计量资料），见表11-1。欲比较不同缝合方法及缝合后时间对轴突通过率的影响，试做析因方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data1101 &lt;- c(10,10,40,50,10,30,30,70,60,30,10,20,30,50,30,50,50,70,60,30)</div><div class="line">factor_a &lt;- gl(2,10) # a取两个水平，每个水平数量是10个，排列顺序是1...2...</div><div class="line">factor_b &lt;- rep(gl(2,5),2) # b取两个水平，每个水平是10个，排列顺序是1..2..1..2</div><div class="line">data1101.aov &lt;- aov(data1101~factor_a+factor_b+factor_a*factor_b) # factor_a*factor_b表示a与b的交互作用</div><div class="line">summary(data1101.aov)</div></pre></td></tr></table></figure>
<p>从上述分析结果可以看出，只有B因素的主效应达到了p&lt;0.05，而A因素的主效应p&gt;0.05，A与B的交互作用的p&gt;0.05，结论为：沿不能认为两咱缝合方法对神经轴突通过率有影响，但缝合后2个月与1个月相比，神经轴突通过率提高了。</p>
<h1 id="例11-2ij两因素析因分析">例11-2：I×J两因素析因分析</h1>
<p>观察A,B两种镇痛药物联合运用在产妇分娩时的镇痛效果。A药取3个剂量：1.0mg，2.5mg，5.0mg；B药也取3个剂量：5 ，15 ，30 。共9个处理组。将27名产妇随机等分为9组，每组3名产妇，记录每名产妇分娩时的镇痛时间，结果见表11-7。试分析A,B两药联合运用的镇痛效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data1102 &lt;- c(105,80,65,75,115,80,85,120,125,115,105,80,125,130,90,65,120,100,75,95,85,135,120,150,180,190,160)</div><div class="line">drug_a &lt;- factor(rep(gl(3,3),3))</div><div class="line">drug_b &lt;- factor(gl(3,9))</div><div class="line">data1102.aov &lt;- aov(data1102~drug_a+drug_b+drug_a*drug_b)</div><div class="line">summary(data1102.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-3ijk三因素析因分析">例11-3：I×J×K三因素析因分析</h1>
<p>用5×2×2析因设计研究5种类型的军装在两种环境、两种活动状态下的散热效果，将100名受试者随机等分20组，观察指标是受试者的主观热感觉(从“冷”到“热”按等级评分)，结果见表11-11。试进行方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data1103 &lt;- c(0.25,0.3,0.75,0.2,-0.1,-0.25,0.1,-0.5,-1,0,1.25,0.5,0.6,0.85,2.5,-0.75,-0.35,0.4,-0.5,0.1,0.4,0.05,-0.2,0.9,-0.1,4.75,4.6,4.55,4.25,4.72,3.45,4.8,3.5,3.1,4.3,4,4,4.25,4,4.1,4.85,5.2,4.1,5,4.8,4.55,4.3,4.4,4.2,3.6,0.5,1.5,0.75,-0.75,1.75,2.1,1.5,2.65,0.9,2.4,2.75,1.25,3,0.95,1.75,1,1.37,0.05,0.62,3.05,2.35,2.55,1.17,1.05,2.75,3.75,4,4.1,3.27,4.8,4,4.05,5,4.25,4.02,4,4.15,4.2,4,4.15,4.25,4.1,4.15,4.25,4.75,4.6,4.25,4.17,4.25,4.8)</div><div class="line"></div><div class="line">a &lt;- factor(rep(1:5,20))</div><div class="line">b &lt;- factor(rep(1:2,each=50))</div><div class="line">c &lt;- factor(rep(c(1,2,1,2),each=25))</div><div class="line"></div><div class="line">data1103.aov &lt;- aov(data1103~a+b+c+a*b+a*c+b*c+a*b*c)</div><div class="line">summary(data1103.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-4">例11-4</h1>
<p>研究雌螺产卵的最优条件，在20cm2的泥盒里饲养同龄雌螺10只，试验条件有4个因素（见表11-15），每个因素2个水平。试在考虑温度与含氧量对雌螺产卵有交互作用的情况下安排正交试验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data1104 &lt;- c(86, 95,91,94,91,96,83,88)</div><div class="line">A &lt;- factor(rep(1:2,each=4))</div><div class="line">B &lt;- factor(gl(2,2,8))</div><div class="line">AB &lt;- factor(c(1,1,2,2,2,2,1,1))</div><div class="line">C &lt;- factor(rep(1:2,4))</div><div class="line">D &lt;- factor(c(1,2,2,1,2,1,1,2))</div><div class="line">data1104.aov &lt;- aov(data1104~A+B+AB+C+D)</div><div class="line">summary(data1104.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-5">例11-5</h1>
<p>研究高频呼吸机A，B，C，D，E五个参数对通气量的影响，每个参数有高、低两个水平，试按正交设计安排试验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data1105 &lt;- c(16.26, 19.38,23.6,28.43,20.28,34.88,49.1,47.44,18.32,24.85,39.45,32.08,45.5,50.3,55.26,66.64)</div><div class="line">A &lt;- factor(rep(1:2,each=8)) # 产生2个水平的因子，每个因子8个</div><div class="line">B &lt;- factor(gl(2,4,16)) # 产生2个水平的因子，每个因子4个，并且把向量B补充到16个元素</div><div class="line">C &lt;- factor(gl(2,2,16))</div><div class="line">D &lt;- factor(rep(1:2,8)) # 产生2个水平的因子，2个水平的因子作为整体，复制8遍</div><div class="line">E &lt;- factor(c(1,2,2,1,2,1,1,2,2,1, 1,2,1,2,2,1))</div><div class="line"></div><div class="line">data1105.aov &lt;- aov(data1105~A+B+C+D+E)</div><div class="line">summary(data1103.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-6">例11-6</h1>
<p>试验甲、乙、丙三种催化剂在不同温度下对某化合物的转化作用。由于各催化剂所要求的温度范围不同，将催化剂作为一级实验因素（I=3），温度作为二级实验因素（J=3），采用嵌套设计，每个处理重复2次（n=2），试验结果见表11-25。试做方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">catalyst &lt;- factor(gl(3,6,18))</div><div class="line">temperature &lt;- factor(rep(c(70,80,90,55,65,75,90,95,100),each=2))</div><div class="line">data1106 &lt;- c(82, 84,91,88,85,83,65,61,62,59,56,60,71,67,75,78,85,89)</div><div class="line"></div><div class="line">data1106.aov &lt;- aov(data1106~catalyst+temperature)</div><div class="line">summary(data1106.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-7">例11-7</h1>
<p>试验一种全身注射抗毒素对皮肤损伤的保护作用试验，将10只家兔随机等分两组，一组注射抗毒素，一组注射生理盐水作对照。分组后，每只家兔取甲、乙两部位，分别随机分配注射低浓度毒素和高浓度毒素，观察指标为皮肤受损直径(mm)，试验结果见表11-31。试做方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A &lt;- factor(gl(2,5,20))</div><div class="line">B &lt;- factor(rep(1:2,each=10))</div><div class="line">data1107 &lt;- c(15.75,15.5,15.5,17,16.5,18.25,18.5,19.75,21.5,20.75,19,20.75,18.5,20.5,20,22.25,21.5,23.5,24.75,23.75)</div><div class="line">data1107.aov &lt;- aov(data1107~A+B)</div><div class="line">summary(data1107.aov)</div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>白话统计.冯国双</li>
<li>医学统计学.孙振球.第四版</li>
<li>数据分析：R语言实战.李诗羽.电子工业出版社</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/基础统计/" <i class="fa fa-tag"></i> 基础统计</a>
          
            <a href="/tags/基础知识/" <i class="fa fa-tag"></i> 基础知识</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/04/BioStatistics/生物统计-04常见概率分布/" rel="next" title="常见概率分布笔记">
                <i class="fa fa-chevron-left"></i> 常见概率分布笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/05/BioStatistics/生物统计-07协方差分析/" rel="prev" title="协方差分析笔记">
                协方差分析笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="vcomments"></div>
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">151</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#方差分析的基本思想及应用条件"><span class="nav-number">1.</span> <span class="nav-text">方差分析的基本思想及应用条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方差分析的基本思想"><span class="nav-number">1.1.</span> <span class="nav-text">方差分析的基本思想</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#变异是方差分析的基本思想"><span class="nav-number">2.</span> <span class="nav-text">变异是方差分析的基本思想</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方差分析的应用条件"><span class="nav-number">2.1.</span> <span class="nav-text">方差分析的应用条件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#r中的方差分析函数"><span class="nav-number">3.</span> <span class="nav-text">R中的方差分析函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单因素方差分析"><span class="nav-number">4.</span> <span class="nav-text">单因素方差分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#anova-案例a"><span class="nav-number">4.0.1.</span> <span class="nav-text">ANOVA-案例A</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#导入数据"><span class="nav-number">4.0.1.1.</span> <span class="nav-text">1. 导入数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#正态检验"><span class="nav-number">4.0.1.2.</span> <span class="nav-text">2.正态检验</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方差齐性检验"><span class="nav-number">4.0.1.3.</span> <span class="nav-text">3. 方差齐性检验:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#检验整体均值是否有差异"><span class="nav-number">4.0.1.4.</span> <span class="nav-text">4. 检验整体均值是否有差异</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#aov"><span class="nav-number">4.0.1.4.1.</span> <span class="nav-text">aov()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#oneway.test"><span class="nav-number">4.0.1.4.2.</span> <span class="nav-text">oneway.test()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#lm"><span class="nav-number">4.0.1.4.3.</span> <span class="nav-text">lm()</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#均数间的两两比较"><span class="nav-number">4.0.1.5.</span> <span class="nav-text">5. 均数间的两两比较</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#常见的两两比较方法"><span class="nav-number">4.0.1.5.1.</span> <span class="nav-text">5.1 常见的两两比较方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#lsd检验"><span class="nav-number">4.0.1.5.2.</span> <span class="nav-text">LSD检验</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#tukeyhsd检验"><span class="nav-number">4.0.1.5.3.</span> <span class="nav-text">TukeyHSD检验</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#glht函数做tukey检验"><span class="nav-number">4.0.1.5.4.</span> <span class="nav-text">glht()函数做Tukey检验</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#残差分析"><span class="nav-number">4.0.1.6.</span> <span class="nav-text">7.残差分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#anova-案例b"><span class="nav-number">4.0.2.</span> <span class="nav-text">ANOVA-案例B</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#section"><span class="nav-number">4.1.</span> <span class="nav-text"></span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重复测量方差分析"><span class="nav-number">5.</span> <span class="nav-text">重复测量方差分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#未设立平等对照的前后测量"><span class="nav-number">5.1.</span> <span class="nav-text">未设立平等对照的前后测量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设立平等对照的前后测量"><span class="nav-number">5.2.</span> <span class="nav-text">设立平等对照的前后测量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重复测试设计"><span class="nav-number">5.3.</span> <span class="nav-text">重复测试设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例分析b"><span class="nav-number">5.4.</span> <span class="nav-text">案例分析B</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重复测量数据的两因素两水平分析"><span class="nav-number">5.5.</span> <span class="nav-text">重复测量数据的两因素两水平分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#两因素离均差平方和分解"><span class="nav-number">5.5.1.</span> <span class="nav-text">两因素离均差平方和分解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组间组内离均差平方和分解与方差分析"><span class="nav-number">5.6.</span> <span class="nav-text">组间、组内离均差平方和分解与方差分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#计算ss_组间ss_组内"><span class="nav-number">5.6.1.</span> <span class="nav-text">1.计算\(SS_{组间}\)、\(SS_{组内}\)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测量前后比较与交互作用分析"><span class="nav-number">5.6.2.</span> <span class="nav-text">2.测量前后比较与交互作用分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理组与对照组比较"><span class="nav-number">5.6.3.</span> <span class="nav-text">3.处理组与对照组比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结论"><span class="nav-number">5.6.4.</span> <span class="nav-text">4.结论</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随机区组设计"><span class="nav-number">6.</span> <span class="nav-text">随机区组设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重复测量数据的两因素多水平分析"><span class="nav-number">7.</span> <span class="nav-text">重复测量数据的两因素多水平分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实验设计方法"><span class="nav-number">7.1.</span> <span class="nav-text">实验设计方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#试验结果的方差分析"><span class="nav-number">7.2.</span> <span class="nav-text">试验结果的方差分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例分析b-1"><span class="nav-number">7.3.</span> <span class="nav-text">案例分析B</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分解ss_组间ss_组内"><span class="nav-number">7.3.1.</span> <span class="nav-text">1.分解\(SS_{组间}，SS_{组内}\)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分解ss_ass_bss_ab"><span class="nav-number">7.3.2.</span> <span class="nav-text">2.分解\(SS_{A}，SS_{B},SS_{AB}\)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方差分析表"><span class="nav-number">7.3.3.</span> <span class="nav-text">3.方差分析表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#f值的界值校正"><span class="nav-number">7.3.4.</span> <span class="nav-text">4.F值的界值校正</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结论-1"><span class="nav-number">7.3.5.</span> <span class="nav-text">5.结论</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重复测量数据的多重比较"><span class="nav-number">7.4.</span> <span class="nav-text">重复测量数据的多重比较</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#组间差别多重比较"><span class="nav-number">7.4.1.</span> <span class="nav-text">组间差别多重比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间趋势比较"><span class="nav-number">7.4.2.</span> <span class="nav-text">时间趋势比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间点的多重比较"><span class="nav-number">7.4.3.</span> <span class="nav-text">时间点的多重比较</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-122析因设计"><span class="nav-number"></span> <span class="nav-text">例11-1：2×2析因设计</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-2ij两因素析因分析"><span class="nav-number"></span> <span class="nav-text">例11-2：I×J两因素析因分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-3ijk三因素析因分析"><span class="nav-number"></span> <span class="nav-text">例11-3：I×J×K三因素析因分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-4"><span class="nav-number"></span> <span class="nav-text">例11-4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-5"><span class="nav-number"></span> <span class="nav-text">例11-5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-6"><span class="nav-number"></span> <span class="nav-text">例11-6</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#例11-7"><span class="nav-number"></span> <span class="nav-text">例11-7</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共560.8k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  










  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.1.4/dist/Valine.min.js"></script>
  <script type="text/javascript">
    new Valine({
        av: AV,
        el: '#vcomments' ,
        verify: true,
        notify: true,
        app_id: '4ORLDMxXCFDLSHPJ4wSSDkkw-gzGzoHsz',
        app_key: 'HSWpCY7XlN0pGV5DCrKoC0ic',
        placeholder: 'Comment input placeholder'
    });
  </script>



  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
