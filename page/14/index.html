<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/14/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/14/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/18/R/ggplot2(8) - 坐标轴/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/18/R/ggplot2(8) - 坐标轴/" itemprop="url">ggplot2(8)-坐标轴</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T12:00:00+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,582
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="交换x轴与y轴">交换x轴与y轴</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lm8E3DAKd6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在将上图中的x轴与y轴进行交换：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+coord_flip()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GkKFebe46g.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>逆转转换后的原x轴变量</p>
<p>中图中交换了x轴与y轴后，发现x轴的分类变量从原来的从左向右排列变成了从下往上排列，但通过scale_x_discrete()参数可以进行逆转：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+coord_flip()+scale_x_discrete(limits=rev(levels(PlantGrowth$group)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0ljd32IkHh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="设置连续型坐标轴的值域">设置连续型坐标轴的值域</h2>
<h3 id="设置y轴的范围">设置y轴的范围：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2H9jKcKKGi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="将y轴的范围扩大">将y轴的范围扩大</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + ylim(<span class="number">0</span>,max(PlantGrowth$weight))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/G33bjl5Efl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="调整y轴的范围并且在0510处加上标记">调整y轴的范围，并且在0,5,10处加上标记</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_y_continuous(limits=c(<span class="number">0</span>,<span class="number">10</span>),breaks=c(<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HCblg7iGHb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>breaks参数中可以加入多个标记，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/97e6ked7GH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_y_continuous(limit=c(<span class="number">5</span>,<span class="number">6.5</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/I1871D7I23.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="可以使用expand_limits来单向扩展值域">可以使用expand_limits()来单向扩展值域</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + expand_limits(y=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LCHafLdfg8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="反转一条连续型坐标轴">反转一条连续型坐标轴</h2>
<p>可以用scale_y_reverse()来翻转坐标轴：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+scale_y_reverse()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/D41CA2eFHe.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>通过指定y轴的坐标范围也可以实现以上效果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+ylim(<span class="number">6.5</span>,<span class="number">3.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/AjkfHeLmk0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>翻转坐标轴并设定值域：</p>
<p>注意y轴数值的变化：</p>
<p>d<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2Ii117jCd2.png?imageslim" alt="mark"></p>
<h2 id="修改x轴上的类别的顺序">修改x轴上的类别的顺序</h2>
<h3 id="基础绘图">基础绘图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1KflEf9Jd9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="改变x轴的顺序">改变x轴的顺序</h3>
<p>可以发现，上述图的x轴顺序是ctr1,trt1,trt2，现在改变x轴的顺序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_x_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"ctrl"</span>,<span class="string">"trt2"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0Bk7km1AEf.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述代码改变x轴的顺序，将原来的顺序ctrl，trt1,trt2改变为trt1,ctrl,trt2。</p>
<h3 id="反转x轴有关类型的顺序">反转x轴有关类型的顺序</h3>
<p>可以用scale_x_discrete(limits=rev())来实现，原图如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/IBBgbg1ACg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>反转后的如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_x_discrete(limits=rev(levels(PlantGrowth$group)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8c0gjgLBLf.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="显示其中的两项">显示其中的两项</h3>
<p>下面的代码则只显示ctrl与trt1两组的箱线图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_x_discrete(limits=c(<span class="string">"ctrl"</span>,<span class="string">"trt1"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/798cBIa36j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="设置x轴与y轴的缩放比例">设置x轴与y轴的缩放比例</h2>
<p>先看一下原图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(marathon,<span class="number">8</span>) <span class="comment"># 先查看一下数据集，数据集marathon中包括跑步者的全程马拉松和半程马拉松</span></div><div class="line"></div><div class="line"><span class="comment">##       Half     Full</span></div><div class="line"><span class="comment">## 1 66.80000 141.4833</span></div><div class="line"><span class="comment">## 2 67.88333 147.2667</span></div><div class="line"><span class="comment">## 3 68.70000 147.8833</span></div><div class="line"><span class="comment">## 4 69.90000 156.7500</span></div><div class="line"><span class="comment">## 5 69.95000 147.4333</span></div><div class="line"><span class="comment">## 6 70.11667 150.0000</span></div><div class="line"><span class="comment">## 7 70.63333 147.2333</span></div><div class="line"><span class="comment">## 8 70.65000 159.0000</span></div><div class="line"></div><div class="line">sp &lt;- ggplot(marathon,aes(x=Half,y=Full)) + geom_point()</div><div class="line">sp</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KCa0Em2Kek.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="缩小x轴与y轴">缩小x轴与y轴</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + coord_fixed()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/D8DggLBCcH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>原图中的y轴与x轴的单位长度之比为并不为1:1,加了coord_fixed()之后，y轴长度与x轴长度的单位长度之比为1:1。通过下面的案例可以更加清楚地说明。</p>
<p>下面的代码把x轴与y轴的单位长度设置相同，即两个刻度之间间距都是30</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp + coord_fixed()+</div><div class="line">  scale_y_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">30</span>))+</div><div class="line">  scale_x_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">30</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1m3b9d71mF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="改变x轴与y轴的比例">改变x轴与y轴的比例</h3>
<p>通过coord_fixed(ratio=1/2)参数实现，先看一下最基本的实现方法：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + coord_fixed(ratio=<span class="number">1</span>/<span class="number">2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J02IlKiGKh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述的图形的坐标轴表示x轴是y轴的1/2，但并不直观，接下来进行更直观的设置。</p>
<p>把x轴的最小刻度设置为15，把y轴的最小刻度设置为30：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp + coord_fixed(ratio=<span class="number">1</span>/<span class="number">2</span>)+</div><div class="line">  scale_y_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">30</span>))+</div><div class="line">  scale_x_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">15</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J4CCb57eI9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="设置刻度线的位置">设置刻度线的位置</h2>
<h3 id="原始绘图">原始绘图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8dlfdldFl3.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述图形的坐标轴是均匀分布的，从3.5到6.0，每个间隔是0.5，现在进行更改。</p>
<h3 id="更改y轴的位置">更改y轴的位置</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+</div><div class="line">  scale_y_continuous(breaks=c(<span class="number">4</span>,<span class="number">4.25</span>,<span class="number">4.5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/B0332GLjCk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>可以看出来，上述的y轴坐刻度已经发生了改变，变成了4,4.25,4.5,5,6,8。其中scale_y_continuous()表示y轴的数据是连续型的。如果是离散型的则用scale_y_discrete()。</p>
<h3 id="不同类型的x轴刻度">不同类型的x轴刻度</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight))+geom_boxplot()+</div><div class="line">  scale_x_discrete(limits=c(<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>),breaks=<span class="string">"ctrl"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/28afm5gHha.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述的代码表示，限定x轴上只显示trt2与ctrl两组数据，但只显示ctrl这个类型的标签。</p>
<h2 id="移除刻度线和标签">移除刻度线和标签</h2>
<h3 id="基本图形">基本图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight)) + geom_boxplot() <span class="comment"># 先看一下最基本的图形</span></div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HDgEG2iF77.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="移除y轴刻度">移除y轴刻度</h3>
<p>用到的代码是theme(axis.text.y=element_blank())，即通过主题的应用，把y轴的刻度改为空白，即axis.text.y=element_blank()。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(axis.text.y=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BHHCG2b70c.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上面的图形把y轴的刻度标签移除了，只是把数字移除了，但刻度还存在，可以进一步把y轴的刻度线移除，如下所示，现在将x轴与y轴的上的刻度全移除，与上面的一样，即axis.ticks=element_blank()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(axis.ticks=element_blank(),axis.text.y=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HLGIHFgHhi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述图形把y轴的刻度标签（数字）与刻度线移除了。</p>
<h3 id="移除刻度线刻度标签网格">移除刻度线，刻度标签，网格</h3>
<p>可以通过一个参数把y轴的刻度线，刻度标签，网格线都移除，即scale_y_continuous(breaks=NULL)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_y_continuous(breaks=<span class="literal">NULL</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/H61cFK2IAe.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="更换主题">更换主题</h2>
<p>ggplot中的背景色默认的是灰色主题，有的时候与论文中排版不协调，可以更换为白色主题，需要的参数是theme_bw()，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_y_continuous(breaks=<span class="literal">NULL</span>)+theme_bw()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mj1GHm17Lc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改刻度标签的文本">修改刻度标签的文本</h2>
<h3 id="基本图形-1">基本图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hwp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))+geom_point()</div><div class="line">hwp</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BC6KGmFE9c.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="更改y轴的坐标标签">更改y轴的坐标标签</h3>
<p>上述图形的y轴表示的是身高（heightIn），数字表示的是身高的数值，现在可以将数值更改为另外一种标签，即把50,56,60,66,72位置的刻度标签从数值改为“Tiny”,“Really”,“Short”,“Medium”,“Tallish”，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + scale_y_continuous(breaks=c(<span class="number">50</span>,<span class="number">56</span>,<span class="number">60</span>,<span class="number">66</span>,<span class="number">72</span>),labels=c(<span class="string">"Tiny"</span>,<span class="string">"Really\nshort"</span>,<span class="string">"Short"</span>,<span class="string">"Medium"</span>,<span class="string">"Tallish"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/990jeDgBcl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述图形的y轴表示的内容与原始图形的一样，只是标签变了，其中<code>&quot;Really\nshort&quot;</code>表示换行。</p>
<h3 id="对标签的进一步优化">对标签的进一步优化</h3>
<p>下面的代码是构建一个函数，将数值转化为英尺与英寸的格式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">footinch_formatter &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  foot &lt;- floor(x/<span class="number">12</span>) <span class="comment"># floor()是取小数的整数部分</span></div><div class="line">  inch &lt;- x%%<span class="number">12</span> <span class="comment"># %%取余数</span></div><div class="line">  <span class="keyword">return</span>(paste(foot,<span class="string">"'"</span>,inch,<span class="string">"\""</span>,sep=<span class="string">""</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">footinch_formatter(<span class="number">56</span>:<span class="number">64</span>) <span class="comment"># 案例</span></div><div class="line"></div><div class="line"><span class="comment">## [1] "4'8\""  "4'9\""  "4'10\"" "4'11\"" "5'0\""  "5'1\""  "5'2\""  "5'3\"" </span></div><div class="line"><span class="comment">## [9] "5'4\""</span></div></pre></td></tr></table></figure>
<h3 id="用labels参数将上述的函数传递给标签">用labels参数将上述的函数传递给标签</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + scale_y_continuous(labels=footinch_formatter)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lI08LlEiG9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="设置刻度">设置刻度</h3>
<p>从48到72，每个间隔4</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + scale_y_continuous(breaks=seq(<span class="number">48</span>,<span class="number">72</span>,<span class="number">4</span>),labels=footinch_formatter)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2gFAaBaJ8L.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="其余的格式设定">其余的格式设定</h3>
<p>可以把一些时间测试转化为HH:MM:SS(时:分:秒)或者其他类似的格式。如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">timeHMS_formatter &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  h &lt;- floor(x/<span class="number">60</span>) <span class="comment"># 小时部分</span></div><div class="line">  m &lt;- floor(x%%<span class="number">60</span>) <span class="comment"># 分钟部分</span></div><div class="line">  s &lt;- round(<span class="number">60</span>*(x%%<span class="number">1</span>)) <span class="comment"># 舍入到最接近的秒数</span></div><div class="line">  lab &lt;- sprintf(<span class="string">"%02d:%02d:%02d"</span>,h,m,s) <span class="comment"># 格式化数据</span></div><div class="line">  lab &lt;- gsub(<span class="string">"^00:"</span>,<span class="string">""</span>,lab) <span class="comment">#　如果开头存在00:则移除</span></div><div class="line">  lab &lt;- gsub(<span class="string">"^00"</span>,<span class="string">""</span>,lab) <span class="comment"># 如果形状存在0则移除</span></div><div class="line">  <span class="keyword">return</span>(lab)</div><div class="line">&#125;</div><div class="line"></div><div class="line">timeHMS_formatter(c(<span class="number">.33</span>,<span class="number">50</span>,<span class="number">51.25</span>,<span class="number">59.32</span>,<span class="number">60</span>,<span class="number">60.1</span>,<span class="number">130.23</span>))</div><div class="line"></div><div class="line"><span class="comment">## [1] ":20"      "50:00"    "51:15"    "59:19"    "01:00:00" "01:00:06"</span></div><div class="line"><span class="comment">## [7] "02:10:14"</span></div><div class="line"></div><div class="line">另外有scales包，里面有可以格式化的函数，如下所示：</div><div class="line"></div><div class="line"><span class="keyword">library</span>(scales)</div><div class="line">comma(<span class="number">1230092123</span>) <span class="comment"># 在千、百万、十亿等位置向数字添加逗号</span></div><div class="line"></div><div class="line"><span class="comment">## [1] "1,230,092,123"</span></div><div class="line"></div><div class="line">dollar(<span class="number">34.33</span>) <span class="comment"># 添加一个美元符号</span></div><div class="line"></div><div class="line"><span class="comment">## [1] "$34.33"</span></div><div class="line"></div><div class="line">percent(c(<span class="number">89.34</span>,<span class="number">0.034</span>)) <span class="comment">#　乘以100，传到到最接近的整数值，并加添一个百分号</span></div><div class="line"></div><div class="line"><span class="comment">## [1] "8,930%" "0%"</span></div><div class="line"></div><div class="line">scientific(<span class="number">1892321122232</span>) <span class="comment"># 科学计数法</span></div><div class="line"></div><div class="line"><span class="comment">## [1] "1.89e+12"</span></div></pre></td></tr></table></figure>
<h2 id="修改刻度标签的外观">修改刻度标签的外观</h2>
<h3 id="基本图形-2">基本图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bp &lt;- ggplot(PlantGrowth,aes(x=group,y=weight)) +</div><div class="line">  geom_boxplot()</div><div class="line">bp</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/a4AFDa3iJ8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下面的命令将x轴上的三个分类变量ctrl,trt1,trt2的名称更改为Control,Treatment1,Treatment2:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">bp &lt;- ggplot(PlantGrowth,aes(x=group,y=weight)) +</div><div class="line">  geom_boxplot() +</div><div class="line">  scale_x_discrete(breaks=c(<span class="string">"ctrl"</span>,<span class="string">"trt1"</span>,<span class="string">"trt2"</span>),</div><div class="line">                   labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>))</div><div class="line">bp</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LjFAE6jLLd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="对标签进行旋转">对标签进行旋转</h3>
<p>把x轴上的标签改为垂直，上图中的标签太长，可以将其从水平位置更改到垂直位置： angle参数用于更改标签的角度，下面是将标签更改为垂直： 其中hjust用于控制纵向对齐，vjust用于控制横向对齐。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bp + theme(axis.text.x = element_text(angle=<span class="number">90</span>,hjust=<span class="number">1</span>,vjust=<span class="number">0.5</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/F98gE7HAf8.png?imageslim" alt="mark">把把x轴上的标签旋转30度：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bp + theme(axis.text.x = element_text(angle=<span class="number">30</span>,hjust=<span class="number">1</span>,vjust=<span class="number">0.5</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kLfAfjjdA4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="更改标签的大小样式字体">更改标签的大小，样式，字体</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bp + theme(axis.text.x = element_text(family=<span class="string">"Times"</span>,face=<span class="string">"italic"</span>,colour=<span class="string">"darkred"</span>,size=rel(<span class="number">0.9</span>)))</div><div class="line"><span class="comment">#上述命令中size=rel(0.9)表示当前主题基础字体大小的0.9</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/F2Gh50Be6E.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="设置坐标轴标签">设置坐标轴标签</h3>
<p>下面命令是在x轴与y轴上分别添加文本：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + xlab(<span class="string">"Age in years"</span>) + ylab(<span class="string">"Height in inches"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/27CkGfgAIH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上面的命令是通过xlab()与ylab()来实现的，另外一种方法是通过labs()来实现：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + labs(x=<span class="string">"Age in years"</span>,y=<span class="string">"Height in inches"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/29FDHeA2FJ.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="坐标标签换行">坐标标签换行</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + scale_x_continuous(name=<span class="string">"Age\n(years)"</span>) <span class="comment"># 换行</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/13c71HefJ0.png?imageslim" alt="mark">4</p>
<h2 id="移除坐标轴标签">移除坐标轴标签</h2>
<h3 id="原始图形">原始图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight)) + geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/l3lDKIb7BB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="去掉坐标的标签">去掉坐标的标签</h3>
<p>下面的命令是将x轴的坐标标签去掉，即去掉了“group”字样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(axis.title.x=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9F6eB6l65j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="使用xlab去除坐标标签">使用xlab去除坐标标签</h3>
<p>上面的代码是将x轴的坐标标签去掉，下方没有空余空间，另外一种方式是将坐标标签去空白表示，有空余空间，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + xlab(<span class="string">""</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kJHK96Alk5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>解释：当用them()来设置axis.title.x=element_blank()时，x轴或y轴标度的名称是不会改变的，只是没有显示其文本，并且不会为其留出空间，而用xlab(“”)时，则是将标度的名称改变成了空白，还是会为名称留出空间。</p>
<h2 id="修改坐标轴标签的外观">修改坐标轴标签的外观</h2>
<h3 id="原始图形-1">原始图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">hwp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))+geom_point()</div><div class="line">hwp</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/FH5aGFe8J7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在将上述图形中的x轴坐标标签修改为深红色(darkred)，斜体(italic)，大小为14(size=14):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + theme(axis.title.x=element_text(face=<span class="string">"italic"</span>,colour=<span class="string">"darkred"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Lma509bDJ6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将y轴的标签向左旋转0度（angle=0），斜体（italic）大小为14（size=14）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwp + ylab(<span class="string">"Height\n(inches)"</span>)+theme(axis.title.y=element_text(angle=<span class="number">0</span>,face=<span class="string">"italic"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9bDHA4eJec.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将y轴的标签向左旋转90度（angle=90,y轴标签的文字默认是水平的），斜体（italic），深红色（darkred），大小为14（size=14）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hwp + ylab(<span class="string">"Height\n(inches)"</span>)+</div><div class="line">  theme(axis.title.y=element_text(angle=<span class="number">30</span>,face=<span class="string">"italic"</span>,colour=<span class="string">"darkred"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/39eae2IJD1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="沿坐标轴添加直线">沿坐标轴添加直线：</h2>
<h3 id="初始图形">初始图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point()</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/e8ddIgbd6D.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="沿坐标轴添加直线-1">沿坐标轴添加直线：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(axis.line=element_line(colour=<span class="string">"black"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4jd5Kal6lG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="更改主题">更改主题</h2>
<p>如果绘图的主题在绘图区域的周围只有一条边，例如theme_bw()主题，则需要同时重置panel.border参数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + theme_bw()+</div><div class="line">  theme(panel.border = element_blank(),</div><div class="line">        axis.line = element_line(colour=<span class="string">"black"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lEaIgg5dGj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果坐标轴上的直线太粗，则末端不会重合，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + theme_bw()+</div><div class="line">  theme(panel.border = element_blank(),</div><div class="line">        axis.line = element_line(colour=<span class="string">"black"</span>,size=<span class="number">4</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/i886m0EDD2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果需要末端进行重合，需要添加lineed=“square”命令：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + theme_bw()+</div><div class="line">  theme(panel.border = element_blank(),</div><div class="line">        axis.line = element_line(colour=<span class="string">"black"</span>,size=<span class="number">4</span>,lineend=<span class="string">"square"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/L32EkKL6Bl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="使用对数坐标轴">使用对数坐标轴</h2>
<h3 id="初始图形-1">初始图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">p &lt;- ggplot(Animals,aes(x=body,y=brain,label=rownames(Animals)))+geom_text(size=<span class="number">3</span>)</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8b57LgDJ64.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="修改坐标轴为对数">修改坐标轴为对数</h3>
<p>现在将上述图形的x轴与y轴取对数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_x_log10() + scale_y_log10()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dAfc0bL30E.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="添加刻度标签">添加刻度标签：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_x_log10(breaks=<span class="number">10</span>^(-<span class="number">1</span>:<span class="number">5</span>))+scale_y_log10(breaks=<span class="number">10</span>^(<span class="number">0</span>:<span class="number">3</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/456L80LBdm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="把坐标轴的标签转化为指数记数法">把坐标轴的标签转化为指数记数法：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(scales)</div><div class="line">p + scale_x_log10(breaks=<span class="number">10</span>^(-<span class="number">1</span>:<span class="number">5</span>),</div><div class="line">                  labels=trans_format(<span class="string">"log10"</span>,math_format(<span class="number">10</span>^.x)))+</div><div class="line">  scale_y_log10(breaks=<span class="number">10</span>^(<span class="number">0</span>:<span class="number">3</span>),</div><div class="line">                labels=trans_format(<span class="string">"log10"</span>,math_format(<span class="number">10</span>^.x)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/97gbacGD6a.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下面的代码表示，先对x轴与y轴的坐标进行转换，将转换后的数据映射到坐标轴上，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(Animals,aes(x=log10(body),y=log10(brain),label=rownames(Animals)))+geom_text(size=<span class="number">5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ikdkfh5E0c.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下面的代码是将x轴与y轴的坐标进行对数转换，对x轴进行自然对数变换，对y轴进行以2为底数的对数变换。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p + scale_x_continuous(trans = log_trans(),</div><div class="line">                       breaks = trans_breaks(<span class="string">"log"</span>,<span class="keyword">function</span>(x) exp(x)),</div><div class="line">                       labels = trans_format(<span class="string">"log"</span>,math_format(e^.x)))+</div><div class="line">  scale_y_continuous(trans = log2_trans(),</div><div class="line">                     breaks = trans_breaks(<span class="string">"log2"</span>,<span class="keyword">function</span>(x) <span class="number">2</span>^x),</div><div class="line">                     labels= trans_format(<span class="string">"log2"</span>,math_format(<span class="number">2</span>^.x)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ligKb4hd6J.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="折线图的坐标转换">折线图的坐标转换</h3>
<p>原始图形</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(aapl,aes(x=date,y=adj_price))+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Fa25hgbd3j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在对y轴进行对数变换：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(aapl,aes(x=date,y=adj_price))+geom_line()+</div><div class="line">  scale_y_log10(breaks=c(<span class="number">2</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">250</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KdFGj6BmmK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="为对数坐标轴添加刻度">为对数坐标轴添加刻度</h3>
<p>用到的函数是<code>annotation_logticks()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/gmKk6Kml7l.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="进行一步优化刻度线">进行一步优化刻度线</h3>
<p>对x轴或y轴的刻度进一步设置时，可以用<code>minor_breaks=log10(5)+ -2:5)</code>，即<code>minor_breaks=log10(5*10^(minpow:maxpow))</code>，这个是用来调整图形中的网格线，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ggplot(Animals,aes(x=body,y=brain,label=rownames(Animals)))+</div><div class="line">  geom_text(size=<span class="number">3</span>)+</div><div class="line">  annotation_logticks()+</div><div class="line">  scale_x_log10(breaks=trans_breaks(<span class="string">"log10"</span>,<span class="keyword">function</span>(x) <span class="number">10</span>^x),</div><div class="line">                labels=trans_format(<span class="string">"log10"</span>,math_format(<span class="number">10</span>^.x)),</div><div class="line">                minor_breaks=log10(<span class="number">5</span>)+ -<span class="number">2</span>:<span class="number">5</span>)+</div><div class="line">    scale_y_log10(breaks=trans_breaks(<span class="string">"log10"</span>,<span class="keyword">function</span>(x) <span class="number">10</span>^x),</div><div class="line">                labels=trans_format(<span class="string">"log10"</span>,math_format(<span class="number">10</span>^.x)),</div><div class="line">                minor_breaks=log10(<span class="number">5</span>)+ -<span class="number">1</span>:<span class="number">3</span>)+</div><div class="line">  coord_fixed()+</div><div class="line">  theme_bw()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1Gi3F1f8fC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制环状图形">绘制环状图形</h2>
<h3 id="基础图形">基础图形</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">head(wind,<span class="number">8</span>)</div><div class="line"></div><div class="line"><span class="comment">##    TimeUTC Temp WindAvg WindMax WindDir SpeedCat DirCat</span></div><div class="line"><span class="comment">## 3        0 3.54    9.52   10.39      89    10-15     90</span></div><div class="line"><span class="comment">## 4        5 3.52    9.10    9.90      92     5-10     90</span></div><div class="line"><span class="comment">## 5       10 3.53    8.73    9.51      92     5-10     90</span></div><div class="line"><span class="comment">## 6       15 3.63    8.97    9.90      94     5-10     90</span></div><div class="line"><span class="comment">## 7       20 3.71    8.51    9.41      97     5-10     90</span></div><div class="line"><span class="comment">## 8       25 3.73    8.43    9.02      95     5-10     90</span></div><div class="line"><span class="comment">## 9       30 3.56    8.12    8.92      98     5-10    105</span></div><div class="line"><span class="comment">## 10      35 3.63    8.47    9.11     101     5-10    105</span></div></pre></td></tr></table></figure>
<p>先以直方图的形式绘制出来，x轴是DirCat，按SpeedCat进行填充，条形图的组距是15，开始位置是-7.5,x轴的位置范围是0到360。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(wind,aes(x=DirCat,fill=SpeedCat))+</div><div class="line">  geom_histogram(binwidth=<span class="number">15</span>,origin=-<span class="number">7.5</span>)+</div><div class="line">  scale_y_continuous(breaks=seq(<span class="number">0</span>,<span class="number">60</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Ld36iJ6hCk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>极坐标只是将上述的条形图卷曲成了圆形，书中的坐标轴标记是0到60，最小单位是10，但按照书中的代码并不能绘图出来，因此，下面的代码中加入了scale_y_continuous(breaks=seq(0,60,10))。如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(wind,aes(x=DirCat,fill=SpeedCat))+</div><div class="line">  geom_histogram(binwidth=<span class="number">15</span>,origin=-<span class="number">7.5</span>)+</div><div class="line">  scale_y_continuous(breaks=seq(<span class="number">0</span>,<span class="number">60</span>,<span class="number">10</span>))+</div><div class="line">  coord_polar()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/D1EKdB2HBc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="极坐标的进一步优化">极坐标的进一步优化</h3>
<p>改变直方图的轮廓为黑色（colour=“black”），尺寸为0.25(size=0.25)，改变图例的顺序(fill=guide_legend(reverse=TRUE))，优化颜色(scale_fill_brewer())，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggplot(wind,aes(x=DirCat,fill=SpeedCat))+</div><div class="line">    geom_histogram(binwidth=<span class="number">15</span>,origin=-<span class="number">7.5</span>,colour=<span class="string">"black"</span>,size=<span class="number">0.25</span>)+</div><div class="line">    guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+</div><div class="line">    coord_polar()+</div><div class="line">    scale_x_continuous(limits=c(<span class="number">0</span>,<span class="number">360</span>),breaks=seq(<span class="number">0</span>,<span class="number">360</span>,by=<span class="number">45</span>),minor_breaks=seq(<span class="number">0</span>,<span class="number">360</span>,by=<span class="number">15</span>))+scale_fill_brewer()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g4cmDFddBK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/17/R/ggplot2(7) - 注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/17/R/ggplot2(7) - 注解/" itemprop="url">ggplot2(7)-注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T12:00:00+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,322
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="添加文本注解">添加文本注解</h2>
<p>添加文本注解的函数是<code>annotate()</code>，查看数据集</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(faithful)</div><div class="line">  eruptions waiting</div><div class="line"><span class="number">1</span>     <span class="number">3.600</span>      <span class="number">79</span></div><div class="line"><span class="number">2</span>     <span class="number">1.800</span>      <span class="number">54</span></div><div class="line"><span class="number">3</span>     <span class="number">3.333</span>      <span class="number">74</span></div><div class="line"><span class="number">4</span>     <span class="number">2.283</span>      <span class="number">62</span></div><div class="line"><span class="number">5</span>     <span class="number">4.533</span>      <span class="number">85</span></div><div class="line"><span class="number">6</span>     <span class="number">2.883</span>      <span class="number">55</span></div></pre></td></tr></table></figure>
<p>绘图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">p &lt;- ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point()</div><div class="line">p + annotate(<span class="string">"text"</span>,x=<span class="number">3</span>,y=<span class="number">48</span>,label=<span class="string">"Group 1"</span>)+</div><div class="line">  annotate(<span class="string">"text"</span>,x=<span class="number">4.5</span>,y=<span class="number">66</span>,label=<span class="string">"Group 2"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mACjdGmff6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="对注解进行修饰">对注解进行修饰</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>,x=<span class="number">3</span>,y=<span class="number">48</span>,label=<span class="string">"Group 1"</span>,family=<span class="string">"serif"</span>,</div><div class="line">             fontface=<span class="string">"italic"</span>,colour=<span class="string">"darkred"</span>,size=<span class="number">3</span>)+</div><div class="line">  annotate(<span class="string">"text"</span>,x=<span class="number">4.5</span>,y=<span class="number">66</span>,label=<span class="string">"Group 2"</span>, family=<span class="string">"serif"</span>,</div><div class="line">           fontface=<span class="string">"italic"</span>,colour=<span class="string">"darkred"</span>,size=<span class="number">3</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/iHi00iLimc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在添加文本的时候，不要用geom_text() ，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>,x=<span class="number">3</span>,y=<span class="number">48</span>, label=<span class="string">"Group 1"</span>,alpha=<span class="number">0.1</span>)+</div><div class="line">  geom_text(x=<span class="number">4.5</span>,y=<span class="number">61</span>,label=<span class="string">"Group 2"</span>,alpha=<span class="number">0.1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/cI5JiB4FiL.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果坐标轴是连续型的，可以使用Inf和-Inf在绘图区域的边放置文本注解。同时用vjust与hjust来进行微调。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>,x=-<span class="literal">Inf</span>,y=<span class="literal">Inf</span>,label=<span class="string">"Upper left"</span>,hjust=-<span class="number">0.2</span>,vjust=<span class="number">2</span>)+</div><div class="line">  annotate(<span class="string">"text"</span>,x=mean(range(faithful$eruptions)),y=-<span class="literal">Inf</span>,vjust=-<span class="number">0.4</span>,label=<span class="string">"Bottom middle"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BmfEH5mFA0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="使用数学表达式">使用数学表达式</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(data.frame(x=c(-<span class="number">3</span>,<span class="number">3</span>)),aes(x=x))+stat_function(fun=dnorm)</div><div class="line">p + annotate(<span class="string">"text"</span>,x=<span class="number">2</span>,y=<span class="number">0.3</span>,parse=<span class="literal">TRUE</span>,label=<span class="string">"frac(1,sqrt(2*pi))*e^&#123;-x^2/2&#125;"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CEm7AJf445.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果要显示两个相邻的变量，需要在它们之间放置一个星号(<code>*</code>)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>,x=<span class="number">0</span>,y=<span class="number">0.05</span>,parse=<span class="literal">TRUE</span>,size=<span class="number">4</span>,</div><div class="line">             label=<span class="string">"'Function:'*y==frac(1,sqrt(2*pi))*e^&#123;-x^2/2&#125;"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/7g3LD1Ab4d.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加直线">添加直线</h2>
<p>横线：geom_hline()，即h对应的是horizon 竖线：geom_vline()，即v对应的是vertical</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+geom_point()</div><div class="line">p + geom_hline(yintercept=<span class="number">60</span>)+geom_vline(xintercept=<span class="number">14</span>) <span class="comment"># 添加横线与竖线</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ggmiJKm6fk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="以下是添加有角度的直线">以下是添加有角度的直线</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_abline(intercept=<span class="number">37.4</span>,slop=<span class="number">1.75</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3bhl6AEHKD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="将数据映射到yintercept上">将数据映射到yintercept上</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">hw_means &lt;- ddply(heightweight,<span class="string">"sex"</span>,summarise,heightIn=mean(heightIn))</div><div class="line"><span class="comment"># 这一段话的意思是，对heightweight的数据集进行处理，将其按照sex进行分类，增加一列为heightIn，heightIn的值是分类后原数据集中heightIn的均值</span></div><div class="line">hw_means</div><div class="line"></div><div class="line"><span class="comment">##   sex heightIn</span></div><div class="line"><span class="comment">## 1   f 60.52613</span></div><div class="line"><span class="comment">## 2   m 62.06000</span></div><div class="line">p + geom_hline(aes(yintercept=heightIn,colour=sex),data=hw_means,linetype=<span class="string">"dashed"</span>,size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/D1fGhcj02k.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="当数据是离散型">当数据是离散型</h2>
<p>下面的两个图形中，坐标轴中有ctrl,trt1,trt2三个标签，分别是因子水平1,2,3</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">head(PlantGrowth)</div><div class="line"></div><div class="line"><span class="comment">##   weight group</span></div><div class="line"><span class="comment">## 1   4.17  ctrl</span></div><div class="line"><span class="comment">## 2   5.58  ctrl</span></div><div class="line"><span class="comment">## 3   5.18  ctrl</span></div><div class="line"><span class="comment">## 4   6.11  ctrl</span></div><div class="line"><span class="comment">## 5   4.50  ctrl</span></div><div class="line"><span class="comment">## 6   4.61  ctrl</span></div><div class="line"></div><div class="line">pg &lt;- ggplot(PlantGrowth,aes(x=group,y=weight))+geom_point()</div><div class="line">pg</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/m4EDaGD1Jd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加线段与箭头">添加线段与箭头</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(subset(climate,Source==<span class="string">"Berkeley"</span>),aes(x=Year,y=Anomaly10y))+</div><div class="line">  geom_line()</div><div class="line">p + annotate(<span class="string">"segment"</span>,x=<span class="number">1950</span>,xend=<span class="number">1980</span>,y=-<span class="number">0.25</span>,yend=-<span class="number">0.25</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/544G0k3gcE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="添加箭头">添加箭头</h3>
<p>用grid包中的arrow()函数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(grid)</div><div class="line">p + annotate(<span class="string">"segment"</span>,x=<span class="number">1850</span>,xend=<span class="number">1820</span>,y=-<span class="number">0.8</span>,yend=-<span class="number">0.95</span>,colour=<span class="string">"blue"</span>,size=<span class="number">2</span>,arrow=arrow())+</div><div class="line">  annotate(<span class="string">"segment"</span>,x=<span class="number">1950</span>,xend=<span class="number">1980</span>,y=-<span class="number">0.25</span>,yend=-<span class="number">0.25</span>,</div><div class="line">           arrow=arrow(ends=<span class="string">"both"</span>,angle=<span class="number">90</span>,length=unit(<span class="number">0.2</span>,<span class="string">"cm"</span>)))</div><div class="line"><span class="comment"># 参数angle是角度，length是设置长度，默认的是英寸</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Gb1L9Am236.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加矩形阴影">添加矩形阴影</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;-ggplot(subset(climate,Source==<span class="string">"Berkeley"</span>),aes(x=Year,y=Anomaly10y))+geom_line() </div><div class="line">p+annotate(<span class="string">"rect"</span>,xmin=<span class="number">1950</span>,xmax=<span class="number">1980</span>,ymin=-<span class="number">1</span>,ymax=<span class="number">1</span>,alpha=<span class="number">0.1</span>,fill=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fakJ3KJ8eF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图是先添加曲线，然后加入面积，面积在曲线的上层，如果改变添加顺序，可以调整图形的叠加：</p>
<p>下面的例子是把线添加到矩形上面：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"rect"</span>,xmin=<span class="number">1950</span>,xmax=<span class="number">1980</span>,ymin=-<span class="number">1</span>,ymax=<span class="number">1</span>,alpha=<span class="number">1</span>,fill=<span class="string">"blue"</span>)+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LADcg6BkFl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下面的图形是把矩形放到线上面：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_line()+annotate(<span class="string">"rect"</span>,xmin=<span class="number">1950</span>,xmax=<span class="number">1980</span>,ymin=-<span class="number">1</span>,ymax=<span class="number">1</span>,alpha=<span class="number">1</span>,fill=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kmLilaGiAd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="高亮某一元素">高亮某一元素</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">pg &lt;- PlantGrowth</div><div class="line">pg$h1 &lt;- <span class="string">"no"</span> <span class="comment"># 添加一列h1，全都为no</span></div><div class="line">pg$h1[pg$group==<span class="string">"trt2"</span>] &lt;- <span class="string">"yes"</span></div><div class="line"><span class="comment"># 把pg的grouop中是trt2的改为yes</span></div><div class="line">ggplot(pg,aes(x=group,y=weight,fill=h1))+geom_boxplot()+</div><div class="line">  scale_fill_manual(values=c(<span class="string">"grey85"</span>,<span class="string">"#FFDDCC"</span>),guide=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fHK4H80aeC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在上述案例中，可以将group映射给fill，得到的结果相同：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight,fill=group))+geom_boxplot()+</div><div class="line">  scale_fill_manual(values=c(<span class="string">"grey85"</span>,<span class="string">"grey85"</span>,<span class="string">"#FFDDCC"</span>),guide=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9j0g8DkHcD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加误差线">添加误差线</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ce &lt;- subset(cabbage_exp,Cultivar==<span class="string">"c39"</span>)</div><div class="line">ggplot(ce,aes(x=Date,y=Weight))+ geom_bar(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>,stat = <span class="string">"identity"</span>)+geom_errorbar(aes(ymin=Weight-se,ymax=Weight+se),width=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KEJ0egLH8m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="为折线图添加误差线">为折线图添加误差线：</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(ce,aes(x=Date,y=Weight))+</div><div class="line">  geom_line(aes(group=<span class="number">1</span>))+</div><div class="line">  geom_point(size=<span class="number">4</span>)+</div><div class="line">  geom_errorbar(aes(ymin=Weight-se,ymax=Weight+se),width=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CcIGIFbhj2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="条形图误差线">条形图误差线</h2>
<p>条形图的修改 默认情况下，geom_bar()的并列宽度是0.9，如果在geom_errorbar()中不进行指定，则误差线不会与条形图正中央对齐，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">head(cabbage_exp)</div><div class="line"></div><div class="line"><span class="comment">##   Cultivar Date Weight        sd  n         se</span></div><div class="line"><span class="comment">## 1      c39  d16   3.18 0.9566144 10 0.30250803</span></div><div class="line"><span class="comment">## 2      c39  d20   2.80 0.2788867 10 0.08819171</span></div><div class="line"><span class="comment">## 3      c39  d21   2.74 0.9834181 10 0.31098410</span></div><div class="line"><span class="comment">## 4      c52  d16   2.26 0.4452215 10 0.14079141</span></div><div class="line"><span class="comment">## 5      c52  d20   3.11 0.7908505 10 0.25008887</span></div><div class="line"><span class="comment">## 6      c52  d21   1.47 0.2110819 10 0.06674995</span></div><div class="line"></div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+</div><div class="line">  geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_errorbar(aes(ymin=Weight-se,ymax=Weight+se),position=<span class="string">"dodge"</span>,width=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BJefAjGc4C.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果在geom_errorbar()中进行了设置，即position=positon_dodge(0.9),则误差线则与条形图中央进行对齐：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+</div><div class="line">  geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_errorbar(aes(ymin=Weight-se,ymax=Weight+se),</div><div class="line">                position=position_dodge(<span class="number">0.9</span>),width=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Hj9BmHe1KF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="误差线的调节">误差线的调节</h2>
<p>如果误差线与线和点的颜色不同，则应先绘制误差线，再绘制线，这样误差线就在线的下层：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">pd &lt;- position_dodge(<span class="number">0.3</span>)</div><div class="line"></div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,colour=Cultivar,group=Cultivar))+</div><div class="line">  geom_errorbar(aes(ymin=Weight-se,ymax=Weight+se),</div><div class="line">                width=<span class="number">0.2</span>,size=<span class="number">0.25</span>,colour=<span class="string">"black"</span>,position=pd)+</div><div class="line">  geom_line(position=pd)+</div><div class="line">  geom_point(position=pd,size=<span class="number">2.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J6mdg3k68b.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/16/R/ggplot2(6) - 描述数据分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/16/R/ggplot2(6) - 描述数据分布/" itemprop="url">ggplot2(6)-描述数据分布</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:00:00+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,231
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="绘制简单直方图">绘制简单直方图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">ggplot(faithful,aes(x=waiting)) + geom_histogram()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aaijA7c2KG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="快速建立直方图">快速建立直方图</h2>
<p>可以将数据框参数设定为NULL，然后向其传递一个向量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w &lt;- faithful$waiting</div><div class="line">ggplot(<span class="literal">NULL</span>,aes(x=w)) + geom_histogram()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KHAG5DL6j8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="调节组距">调节组距</h3>
<p>默认的数据被分为30组，可以通过binwidth()参数才调节：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting)) + </div><div class="line">  geom_histogram(binwidth=<span class="number">5</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>) </div><div class="line"><span class="comment"># 设定组距为5</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/hlBbC05kid.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>把数据分为15组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">binsize &lt;- diff(range(faithful$waiting))/<span class="number">15</span> <span class="comment"># 把数据分为15组,diff()是差分函数，什么是差分，不懂</span></div><div class="line"></div><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_histogram(binwidth=binsize,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/JGKb6EiHAj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>有时候，直方图的外观会非常依赖于组距及组边界。现在我们将组距离设为8，同时设定分组原点(origin)参数，令组边界分别位于31、39、47等，在第二张图中，对origin参数增加4，令组边界分别位于35、43、51等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h &lt;- ggplot(faithful,aes(x=waiting)) </div><div class="line">h + geom_histogram(binwidth=<span class="number">8</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>,boundary=<span class="number">31</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ahL2cdj2EE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h &lt;- ggplot(faithful,aes(x=waiting)) </div><div class="line">h + geom_histogram(binwidth=<span class="number">8</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>,boundary=<span class="number">35</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/m71eiJK7CG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="基于分组数据绘制分组直方图">基于分组数据绘制分组直方图</h2>
<p>以MASS包中的birthwt数据集为例说明：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">head(birthwt)</div><div class="line"></div><div class="line"><span class="comment">##    low age lwt race smoke ptl ht ui ftv  bwt</span></div><div class="line"><span class="comment">## 85   0  19 182    2     0   0  0  1   0 2523</span></div><div class="line"><span class="comment">## 86   0  33 155    3     0   0  0  0   3 2551</span></div><div class="line"><span class="comment">## 87   0  20 105    1     1   0  0  0   1 2557</span></div><div class="line"><span class="comment">## 88   0  21 108    1     1   0  0  1   2 2594</span></div><div class="line"><span class="comment">## 89   0  18 107    1     1   0  0  1   0 2600</span></div><div class="line"><span class="comment">## 91   0  21 124    3     0   0  0  0   0 2622</span></div></pre></td></tr></table></figure>
<p>此数据集中包括了婴儿出生体重及一系列导致出生体重过低的危险因子的数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt)) + </div><div class="line">  geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/A7mL9b1k5g.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="修改分面标签">修改分面标签</h3>
<p>上图中的分布依据是smoke,此数据只有0与1两种，因此不清楚表示什么意思，因此要进行修改，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">birthwt1 &lt;- birthwt <span class="comment"># 复制一份数据</span></div><div class="line">birthwt1$smoke &lt;- factor(birthwt$smoke)</div><div class="line">levels(birthwt1$smoke)</div><div class="line"></div><div class="line"><span class="comment">## [1] "0" "1"</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">birthwt1$smoke &lt;- revalue(birthwt1$smoke,c(<span class="string">"0"</span>=<span class="string">"No Smoke"</span>,<span class="string">"1"</span>=<span class="string">"Smoke"</span>))</div><div class="line"><span class="comment"># 替换因子的名称</span></div><div class="line"></div><div class="line">ggplot(birthwt1,aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>) + </div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CaleK4BjK5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="样本数目不同时的分面">样本数目不同时的分面</h3>
<p>默认情况下，y轴是相同的范围，但图形会不美观，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(race~.)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6HF0EFAJg8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="分面时y轴的设置">分面时y轴的设置</h3>
<p>如果scales=“free”则可以单独设定各个分面的y轴标度，但这种设制只适用于y轴标度，对x轴没有影响，x轴仍然是固定的：</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt))+</div><div class="line">  geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(race~.,scales=<span class="string">"free"</span>)</div></pre></td></tr></table></figure></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aJ1LKadfII.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="另外一种分面">另外一种分面</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+</div><div class="line">  geom_histogram(position=<span class="string">"identity"</span>,alpha=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6H4kcjack0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><code>position=&quot;identity&quot;</code>避免将数据堆积在一起，如果没有，则图形如下所示： 4</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+</div><div class="line">  geom_histogram(alpha=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/I91A70Eh75.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制密度曲线图">绘制密度曲线图</h2>
<h3 id="基本绘图">基本绘图</h3>
<p>用到geom_density()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+ geom_density()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GHJ8HHj5he.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果不想绘制曲线的两侧与底部：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  expand_limits(y=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/32433dLmAi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="带宽的调整">带宽的调整</h3>
<p>对核密度曲线进行带宽的调整，通过参数adjust来实现：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>,adjust=<span class="number">0.25</span>,colour=<span class="string">"red"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>,adjust=<span class="number">2</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KJ32eci6DC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="手动添加x轴的范围">手动添加x轴的范围</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_density(fill=<span class="string">"blue"</span>,alpha=<span class="number">0.2</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KLcLgg2CiK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="去掉密度曲线下的横线">去掉密度曲线下的横线</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_density(fill=<span class="string">"blue"</span>,colour=<span class="string">"NA"</span>,alpha=<span class="number">0.2</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kiH2kdDm96.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="直方图与密度曲线的叠加">直方图与密度曲线的叠加</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting,y=..density..))+</div><div class="line">  geom_histogram(fill=<span class="string">"cornsilk"</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">0.2</span>)+</div><div class="line">  geom_density(colour=<span class="string">"NA"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div><div class="line"><span class="comment"># geom_density(colour="NA")表示去掉密度图的最低部的直线</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Kkdh6A242j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="基于分组数据绘制分组密度曲线">基于分组数据绘制分组密度曲线</h3>
<p>把变量smoke映射给colour</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">birthwt1 &lt;- birthwt</div><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,colour=smoke))+geom_density()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LIgH9gCfjf.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="把变量smoke映射给fill">把变量smoke映射给fill</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+geom_density(alpha=<span class="number">0.3</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8j79gcH69e.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="分面">分面</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt))+</div><div class="line">geom_density(colour=<span class="string">"NA"</span>)+</div><div class="line">geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ciLmCJKa10.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="直方图与密度曲线叠加的分面">直方图与密度曲线叠加的分面</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt,y=..density..))+</div><div class="line">  geom_histogram(binwidth=<span class="number">200</span>,fill=<span class="string">"cornsilk"</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">0.2</span>)+geom_density()+</div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GJmBl7gfHE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制频数多边形">绘制频数多边形</h2>
<h3 id="基本绘图-1">基本绘图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+geom_freqpoly()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g0KGcG4gI2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="更改组距">更改组距</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+geom_freqpoly(binwidth=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mbmflbl34E.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="箱线图">箱线图</h2>
<h3 id="基本绘图-2">基本绘图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/04Fa86i9ag.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="更改箱线图的宽度">更改箱线图的宽度</h3>
<p>geom_boxplot(width=0.5)参数可以更改箱子的宽度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot(width=0.5)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/L7e7kD5kgd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="更改异常值的点">更改异常值的点</h3>
<p>geom_boxplot(outlier.size=5,outlier.shape=21)可以更改异常值的大小与形状：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+</div><div class="line">  geom_boxplot(outlier.size=<span class="number">5</span>,outlier.shape=<span class="number">22</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DjkeGaL85h.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="单组箱线图的绘制">单组箱线图的绘制</h3>
<p>把x轴设制为1，即x轴对应的全部的数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=<span class="number">1</span>,y=bwt))+geom_boxplot()+</div><div class="line">  scale_x_continuous(breaks=<span class="literal">NULL</span>)+</div><div class="line">  theme(axis.title.x=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EhDK8HBh1f.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述命令类似于boxplot()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boxplot(birthwt$bwt)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aCijKfi6f1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="向箱线图添加槽口">向箱线图添加槽口</h3>
<p>槽口即notch，添加槽口的用处于在查看不同的中位数是否有差异。如果各箱线图的槽口互不重合，说明中位数有差异。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot(notch=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/cL3dJJ0gI4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述命令会出现notch went outside hinges. Try setting notch=FALSE.这表示中间的箱子对应的槽口的上边界溢出了箱体，由于闪出的距离较小，因此在图片中基本上看不到。</p>
<h3 id="向箱线图中添加均值">向箱线图中添加均值</h3>
<p>用到stat_summary()函数，箱线图需要注意的是，箱线图中间的线是中位数，不是均值。对于正态分布的数据，中位数与均值会比较接近，但对于偏态分布则不同。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot()+</div><div class="line">  stat_summary(fun.y=<span class="string">"mean"</span>,geom=<span class="string">"point"</span>,shape=<span class="number">23</span>,size=<span class="number">3</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dJb87AB4kB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制小提琴图">绘制小提琴图</h2>
<p>小提琴图是一种对多组数据的分布进行比较的方法，使用普通的密度曲线对多组数据进行可视化时，图中的曲线会彼此干扰，因而不宜用来对多组数据的分布进行比较，而小提琴图是并排排列的，用它对多组数据分布进行比较更容易。</p>
<h3 id="基础绘图">基础绘图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(heightweight,aes(x=sex,y=heightIn))</div><div class="line">p + geom_violin()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ilaIlmkI7A.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下面是密度曲线的常规绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(colour=sex,x=heightIn))+geom_density()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DH9FLfejkK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="小提琴图添加中位数">小提琴图添加中位数</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_violin() +</div><div class="line">  geom_boxplot(width=<span class="number">0.1</span>,fill=<span class="string">"black"</span>,outlier.colour=<span class="literal">NA</span>)+</div><div class="line">  stat_summary(fun.y=median,geom=<span class="string">"point"</span>,fill=<span class="string">"white"</span>,shape=<span class="number">21</span>,size=<span class="number">2.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6eGcf92JH1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="保留小提琴尾部">保留小提琴尾部</h3>
<p>上图中的小提琴尾部没有保留，进行了截断，可以通过trim=FALSE设置保留小提琴的尾部：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(trim=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1gfLHCcH31.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="调节小提琴的平滑度">调节小提琴的平滑度</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(adjust=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d551aack21.png?imageslim" alt="如果adjust缩小，则不平滑： mark">
<p class="caption">如果adjust缩小，则不平滑： mark</p>
</div>
<p>如果adjust缩小，则不平滑：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(adjust=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fc92LcA5ki.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制wilkinson点图">绘制Wilkinson点图</h2>
<p>Wilkinson图中点的分组和排列取决于数据，每个点的宽度对应了最大组距。系数默认的最大组距是数据范围的1/30，可以通过binwidth参数对其进行调整。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">countries2009 &lt;- subset(countries,Year==<span class="number">2009</span> &amp; healthexp &gt;<span class="number">2000</span>)</div><div class="line">p &lt;- ggplot(countries2009,aes(x=infmortality))</div><div class="line">p + geom_dotplot()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/07h0eiDG3E.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图中geom_dotplot()函数沿着x轴方向对数据进行分组并在y轴方向上对点进行堆积，图中各点看起来是堆积的，但受限于ggplot2的绘图设计，图形上y轴的刻度线并没有明确的含义，因此可以去掉：</p>
<p>去掉y轴标签的参数是scale_y_continuous()，另外 theme(axis.title.y=element_blank())主要用于移除坐标轴的标签（标签是count)。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(binwidth=<span class="number">0.25</span>) + geom_rug()+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>)+</div><div class="line">  theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/f1i8AlKCjg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>可以通过加入参数method=“histodot”参数来设置点图的位置：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(method=<span class="string">"histodot"</span>,binwidth=<span class="number">0.25</span>) + geom_rug()+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>)+theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9I3mCcml1i.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>中心堆叠</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(binwidth=<span class="number">0.25</span>,stackdir = <span class="string">"center"</span>)+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>) +</div><div class="line">  theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4jKHHdC010.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="基于分组数据绘制分组点图">基于分组数据绘制分组点图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_dotplot(binaxis = <span class="string">"y"</span>,binwidht=<span class="number">0.5</span>,stackdir = <span class="string">"center"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1ejDAkKhdl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="将箱线图叠加到点图上">将箱线图叠加到点图上</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_boxplot(outlier.colour=<span class="literal">NA</span>,width=<span class="number">0.5</span>)+</div><div class="line">  geom_dotplot(binaxis=<span class="string">"y"</span>,binwidth =<span class="number">0.5</span>,stackdir=<span class="string">"center"</span>,fill=<span class="literal">NA</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/gaBCeCLkBH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="将箱线图放在点图旁边">将箱线图放在点图旁边</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_boxplot(aes(x=as.numeric(sex)+<span class="number">0.2</span>,group=sex),width=<span class="number">0.25</span>)+</div><div class="line">  geom_dotplot(aes(x=as.numeric(sex)-<span class="number">0.2</span>,group=sex),binaxis=<span class="string">"y"</span>,bindwidth=<span class="number">0.5</span>,stackdir=<span class="string">"center"</span>)+</div><div class="line">  scale_x_continuous(breaks=<span class="number">1</span>:nlevels(heightweight$sex),labels=levels(heightweight$sex))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3AGE05b840.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制二维数据的图">绘制二维数据的图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(faithful,aes(x=eruptions,y=waiting))</div><div class="line">p + geom_point()+stat_density2d()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DLhcCBLE92.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>可以用<code>..level..</code>将密度映射给等高线的颜色：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(colour=..level..))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/36JmI1el8j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="将高度映射为渐变">将高度映射为渐变</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(fill=..density..),geom=<span class="string">"raster"</span>,contour=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/b4hiHLhBfB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="将密度估计映射给瓦片颜色tile">将密度估计映射给瓦片颜色(tile)</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + geom_point()+</div><div class="line">  stat_density2d(aes(alpha=..density..),geom=<span class="string">"tile"</span>,contour=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/24jd73Fkeg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>另外一种图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(fill=..density..),geom=<span class="string">"raster"</span>,contour=<span class="literal">FALSE</span>,h=c(<span class="number">0.5</span>,<span class="number">5</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g8FlaFhlA6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/15/R/ggplot2(5) -  折线图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/15/R/ggplot2(5) -  折线图/" itemprop="url">ggplot2(5)-折线图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-15T12:00:00+08:00">
                2017-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,392
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集">数据集</h2>
<p>查看数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; BOD</div><div class="line">  Time demand</div><div class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">8.3</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>   <span class="number">10.3</span></div><div class="line"><span class="number">3</span>    <span class="number">3</span>   <span class="number">19.0</span></div><div class="line"><span class="number">4</span>    <span class="number">4</span>   <span class="number">16.0</span></div><div class="line"><span class="number">5</span>    <span class="number">5</span>   <span class="number">15.6</span></div><div class="line"><span class="number">6</span>    <span class="number">7</span>   <span class="number">19.8</span></div></pre></td></tr></table></figure>
<h2 id="基础绘图">基础绘图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Ab0d0lkkHf.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="x轴的变量为分类变量的折线图">x轴的变量为分类变量的折线图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BOD1 &lt;- BOD</div><div class="line">BOD1$Time &lt;- factor(BOD1$Time)</div><div class="line">ggplot(BOD1,aes(x=Time,y=demand,group=<span class="number">1</span>))+geom_line()</div></pre></td></tr></table></figure>
<p>上一段代码中，group=1表示这些数据点属于一组，用一条折线将其连接起来。并且注意与第1张图在x轴坐标上的区别。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2EmbIB7L7d.png?imageslim" alt="mark"></p>
<h2 id="扩大y轴的范围">扩大y轴的范围</h2>
<p>下面的这段代码用<code>ylim(0,max(BOD$demand))</code>将y轴的范围进行修改，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()+ylim(<span class="number">0</span>,max(BOD$demand))</div><div class="line"><span class="comment"># 等价于：</span></div><div class="line"><span class="comment"># ggplot(BOD,aes(x=Time,y=demand))+geom_line()+expand_limits(y=0)</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lf5cI2GDFG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="向折线图添加数据标记">向折线图添加数据标记</h2>
<h3 id="向折线图中添加数据点">向折线图中添加数据点</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()+geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0iH6AH6G6B.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>再来看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(worldpop,aes(x=Year,y=Population))+geom_line()+geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/h94F1ghmbA.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>可以看到，数据集中在右侧，现在对y取以10为底的对数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(worldpop,aes(x=Year,y=Population))+geom_line() + geom_point() + scale_y_log10()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LKK1FAebKg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制多重折线图">绘制多重折线图</h2>
<p>下面的代码绘制多重折线图，里面有两个分类用颜色来区分不同的分类(supp)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">tg &lt;- ddply(ToothGrowth,c(<span class="string">"supp"</span>,<span class="string">"dose"</span>),summarise,length=mean(len))</div><div class="line"><span class="comment"># 这一段话的意思是，对ToothGrowth的数据集进行处理，将其按照supp与dose进行分类，增加一列为length，length的值是分类后的len的值</span></div><div class="line"></div><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp)) + geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Jg04D42ae6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="用线型linetype来区分不同的分类supp">用线型(linetype)来区分不同的分类(supp)</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,linetype=supp)) + geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/15kID2lhD0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="现在将x轴转化为分类变量">现在将x轴转化为分类变量</h3>
<p>上面的例子中，dose为连续型变量，转化后注意一下x轴的变化。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=factor(dose),y=length,colour=supp,group=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p>注意，上面的代码中，需要加入group=supp这个参数。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/G9AJ5i2JLg.png?imageslim" alt="mark"></p>
<p>现在看一个反例，在这个案例中，没有指定正确的分组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length)) + geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DL40cLEalg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>当没有指定的分组时，x轴上的每个位置就是对应多个点，ggplot()就会将这些点都放在同一个组中，并且将它们用一根折线连接，开场锯齿状折线图。如果指定任意离散型变量，映射给colour，linetype的话，则会出现折线图的分组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp)) + geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J5JK6CiDhB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改点的形状">修改点的形状</h2>
<p>可以增加点的形状属性（用shape=supp）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,shape=supp)) + geom_line() + geom_point(size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/k2jJGjkDlj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改点的颜色">修改点的颜色</h2>
<p>可以增加点的形状属性（用shape=supp） 修改点的颜色的时候，要用到fill参数与shape参数，如只用fill，而不用shape的时候，则颜色不会出现，这个时候只是单纯的一个点，不会出现内部的颜色，只有当shape参数设置后，颜色才能出现。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,fill=supp)) + geom_line() + geom_point(size=<span class="number">4</span>,shape=<span class="number">21</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/jmJbg3dDk9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改颜色属性错开重复的点">修改颜色属性：错开重复的点：</h2>
<p>在上一个图形中，右边最后一个点两条折线重合了，现在要改一下，避开两点的重合，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,shape=supp))+</div><div class="line">  geom_line(position=position_dodge(<span class="number">0.2</span>))+ </div><div class="line"><span class="comment"># 将线左右移开0.2，左线往左移，右线往右移</span></div><div class="line">  geom_point(position=position_dodge(<span class="number">0.2</span>),size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ig5m1ebA5l.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改线条样式">修改线条样式</h2>
<p>线条样式的属性有线型(linetype)、线宽(size)、颜色(colour)。下面的例子是更改线型为虚线(dashed)，蓝色(blue)：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line(linetype=<span class="string">"dashed"</span>,size=<span class="number">1</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9cK5e8138e.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其它颜色设置，如下所示：</p>
<h3 id="线条颜色">线条颜色</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp))+</div><div class="line">  geom_line()+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Pastel1"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fh6I08llld.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="线条加粗">线条加粗</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,group=supp))+</div><div class="line">  geom_line(colour=<span class="string">"darkgreen"</span>,size=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/if8j8JbFFf.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="虚线加形状">虚线加形状</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp))+</div><div class="line">  geom_line(linetype=<span class="string">"dashed"</span>)+</div><div class="line">  geom_point(shape=<span class="number">22</span>,size=<span class="number">3</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/479i77hiHc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="修改数据标记">修改数据标记</h2>
<p>修改数据点的样式，包括点的大小(size)、颜色(colour)，填充色(fill)</p>
<h3 id="修改颜色与形状">修改颜色与形状</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line()+</div><div class="line">  geom_point(size=<span class="number">4</span>,shape=<span class="number">22</span>,colour=<span class="string">"green"</span>,fill=<span class="string">"pink"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/26bBibBJIb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="修改颜色与形状2">修改颜色与形状2</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line()+</div><div class="line">  geom_point(size=<span class="number">4</span>,shape=<span class="number">21</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HH76L6ACeJ.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="将不同的分类的标记点修改为不同的属性">将不同的分类的标记点修改为不同的属性</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pd &lt;- position_dodge(<span class="number">0.2</span>)</div><div class="line">ggplot(tg, aes(x=dose,y=length,fill=supp))+</div><div class="line">  geom_line(position=pd)+</div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">3</span>,position=pd)+</div><div class="line">  scale_fill_manual(values=c(<span class="string">"black"</span>,<span class="string">"white"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/K0aAl088E5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制面积图">绘制面积图</h2>
<h3 id="基础绘图-1">基础绘图</h3>
<p>以下的数据集是一个时间序列数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sunspotyear &lt;- data.frame(</div><div class="line">  Year = as.numeric(time(sunspot.year)),</div><div class="line">  Sunspots = as.numeric(sunspot.year)</div><div class="line">)</div><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+geom_area()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J45geE054d.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="修改面积颜色属性">修改面积颜色属性</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,fill=<span class="string">"green"</span>,alpha=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/C1DHDiEJ1m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="修改颜色底部边框属性">修改颜色底部边框属性：</h3>
<p>把上图中的底部横线去掉，即在geom_are()中去掉colour=“black”，此语气的意思是给面积部分加上边框。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/jmdgDihHlC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="去掉所有边框">去掉所有边框</h3>
<p>若无geom_line()参数，则图形直接为面积，没有边框：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+</div><div class="line">  geom_area(fill=<span class="string">"green"</span>,alpha=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dEKcaaf7Jg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制堆积面积图">绘制堆积面积图</h2>
<h3 id="基础绘图-2">基础绘图</h3>
<p>查看数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">head(uspopage,<span class="number">10</span>) <span class="comment"># 查看uspopage数据集的前10行</span></div><div class="line"></div><div class="line"><span class="comment">##    Year AgeGroup Thousands</span></div><div class="line"><span class="comment">## 1  1900       &lt;5      9181</span></div><div class="line"><span class="comment">## 2  1900     5-14     16966</span></div><div class="line"><span class="comment">## 3  1900    15-24     14951</span></div><div class="line"><span class="comment">## 4  1900    25-34     12161</span></div><div class="line"><span class="comment">## 5  1900    35-44      9273</span></div><div class="line"><span class="comment">## 6  1900    45-54      6437</span></div><div class="line"><span class="comment">## 7  1900    55-64      4026</span></div><div class="line"><span class="comment">## 8  1900      &gt;64      3099</span></div><div class="line"><span class="comment">## 9  1901       &lt;5      9336</span></div><div class="line"><span class="comment">## 10 1901     5-14     17158</span></div><div class="line"></div><div class="line">str(uspopage) <span class="comment"># 查看数据集的格式</span></div><div class="line"></div><div class="line"><span class="comment">## 'data.frame':    824 obs. of  3 variables:</span></div><div class="line"><span class="comment">##  $ Year     : int  1900 1900 1900 1900 1900 1900 1900 1900 1901 1901 ...</span></div><div class="line"><span class="comment">##  $ AgeGroup : Factor w/ 8 levels "&lt;5","5-14","15-24",..: 1 2 3 4 5 6 7 8 1 2 ...</span></div><div class="line"><span class="comment">##  $ Thousands: int  9181 16966 14951 12161 9273 6437 4026 3099 9336 17158 ...</span></div></pre></td></tr></table></figure>
<p>绘图</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup)) + geom_area()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dJBmH9bcKk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>注意上图中图例的位置，图例中的年龄分组顺序与主图中的年龄分组顺序是相反的。下面的代码将这二者调为一致：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>,breaks=rev(levels(uspopage$AgeGroup)))</div><div class="line"><span class="comment"># rev用于将因子顺序倒置，即将图例中的顺序倒置</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8FHKFac6k4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="反转堆积图顺序">反转堆积图顺序</h3>
<p>上图从下往上是按照年龄由小至大的顺序堆积的，现在按照由大到小堆积：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ccfD7LF2A5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="desc函数">desc()函数</h3>
<p>注意上一段代码中的desc()函数，下面为例说明一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>) <span class="comment"># 建立一个普通的向量</span></div><div class="line">x</div><div class="line"><span class="comment">##[1] 1 2 3 9 3 2 1</span></div><div class="line">desc(x)</div><div class="line"><span class="comment">## [1] -1 -2 -3 -9 -3 -2 -1</span></div></pre></td></tr></table></figure>
<p>可以发现，desc()的功能是将x中的元素前面加一个负号，x是一个普通的向量，其元素是数值，如果x的元素是因子型向量的话，结果如下：</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">x &lt;- factor(x)</div><div class="line">x <span class="comment"># 可以发现，x中有四个水平，即1、2、3、9</span></div><div class="line"><span class="comment">## [1] 1 2 3 9 3 2 1</span></div><div class="line"><span class="comment">## Levels: 1 2 3 9</span></div><div class="line">desc(x) <span class="comment"># 这个显示的是x中因子水平的排序的负值</span></div><div class="line"><span class="comment">## [1] -1 -2 -3 -4 -3 -2 -1</span></div></pre></td></tr></table></figure></p>
<p>再看一个例子，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">y &lt;- factor(c(<span class="string">"a"</span>,<span class="string">"c"</span>,<span class="string">"b"</span>,<span class="string">"b"</span>,<span class="string">"d"</span>))</div><div class="line">str(y)</div><div class="line"><span class="comment">##  Factor w/ 4 levels "a","b","c","d": 1 3 2 2 4</span></div><div class="line">desc(y)</div><div class="line"><span class="comment">## [1] -1 -3 -2 -2 -4</span></div></pre></td></tr></table></figure>
<h3 id="堆叠去掉两边的边框">堆叠去掉两边的边框</h3>
<p>将上一个堆叠图中的边框去掉：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="literal">NA</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)+</div><div class="line">  geom_line(position=<span class="string">"stack"</span>,size=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lldaj35AI7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上述代码的最后一行是绘制曲线，如果去掉，则剩余的代码只是单纯的堆积图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="literal">NA</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/FGeh8Hic1B.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制百分比堆积面积图">绘制百分比堆积面积图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">uspopage_prop &lt;- ddply(uspopage,<span class="string">"Year"</span>,transform,Percent = Thousands/sum(Thousands)*<span class="number">100</span>)</div><div class="line"><span class="comment">#　上段代码的意思是把数据集uspopage中的数据按照Year进行分类，在分类内部，计算每个Thousands所占的百分比，并把计算的结果给Percent</span></div><div class="line">head(uspopage_prop,<span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="comment">##    Year AgeGroup Thousands   Percent</span></div><div class="line"><span class="comment">## 1  1900       &lt;5      9181 12.065340</span></div><div class="line"><span class="comment">## 2  1900     5-14     16966 22.296107</span></div><div class="line"><span class="comment">## 3  1900    15-24     14951 19.648067</span></div><div class="line"><span class="comment">## 4  1900    25-34     12161 15.981549</span></div><div class="line"><span class="comment">## 5  1900    35-44      9273 12.186243</span></div><div class="line"><span class="comment">## 6  1900    45-54      6437  8.459274</span></div><div class="line"><span class="comment">## 7  1900    55-64      4026  5.290825</span></div><div class="line"><span class="comment">## 8  1900      &gt;64      3099  4.072594</span></div><div class="line"><span class="comment">## 9  1901       &lt;5      9336 12.033409</span></div><div class="line"><span class="comment">## 10 1901     5-14     17158 22.115385</span></div></pre></td></tr></table></figure>
<p>绘图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage_prop,aes(x=Year,y=Percent,fill=AgeGroup))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>,breaks=rev(levels(uspopage$AgeGroup)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/e5H61AAeml.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加置信域">添加置信域</h2>
<p>置信域中用到的数据集是climate，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">head(climate)</div><div class="line"></div><div class="line"><span class="comment">##     Source Year Anomaly1y Anomaly5y Anomaly10y Unc10y</span></div><div class="line"><span class="comment">## 1 Berkeley 1800        NA        NA     -0.435  0.505</span></div><div class="line"><span class="comment">## 2 Berkeley 1801        NA        NA     -0.453  0.493</span></div><div class="line"><span class="comment">## 3 Berkeley 1802        NA        NA     -0.460  0.486</span></div><div class="line"><span class="comment">## 4 Berkeley 1803        NA        NA     -0.493  0.489</span></div><div class="line"><span class="comment">## 5 Berkeley 1804        NA        NA     -0.536  0.483</span></div><div class="line"><span class="comment">## 6 Berkeley 1805        NA        NA     -0.541  0.475</span></div></pre></td></tr></table></figure>
<p>变量Anomaly10y表示的意思是相对于1950-1980平均水平变异的10年移动平均。变量Unc10y表示其95%置信区间。现在令ymax与ymin分别为Anomaly10y加减Unc10y，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">clim &lt;- subset(climate,Source == <span class="string">"Berkeley"</span>,</div><div class="line">               select = c(<span class="string">"Year"</span>,<span class="string">"Anomaly10y"</span>,<span class="string">"Unc10y"</span>))</div><div class="line"><span class="comment"># 上面一段代码表示，取数据集中climate的Source中的Berkeley，并选择其中的Year,Anomaly10y,unc10y</span></div><div class="line">head(clim)</div><div class="line"></div><div class="line"><span class="comment">##   Year Anomaly10y Unc10y</span></div><div class="line"><span class="comment">## 1 1800     -0.435  0.505</span></div><div class="line"><span class="comment">## 2 1801     -0.453  0.493</span></div><div class="line"><span class="comment">## 3 1802     -0.460  0.486</span></div><div class="line"><span class="comment">## 4 1803     -0.493  0.489</span></div><div class="line"><span class="comment">## 5 1804     -0.536  0.483</span></div><div class="line"><span class="comment">## 6 1805     -0.541  0.475</span></div></pre></td></tr></table></figure>
<p>下面绘制置信区间，用到的是geom_ribbon()函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lF7lFd2bBa.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="绘制上下边界">绘制上下边界</h3>
<p>这个例子是用虚线来表示上下置信区间：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(clim,aes(x=Year,y=Anomaly10y))+</div><div class="line">  geom_line(aes(y=Anomaly10y-Unc10y),colour=<span class="string">"grey50"</span>,linetype=<span class="string">"dotted"</span>)+</div><div class="line">  geom_line(aes(y=Anomaly10y+Unc10y),colour=<span class="string">"grey50"</span>,linetype=<span class="string">"dotted"</span>)+</div><div class="line">  geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/7cIJG87f1l.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/14/R/ggplot2(4) - 散点图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/14/R/ggplot2(4) - 散点图/" itemprop="url">ggplot2(4)-散点图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-14T12:00:00+08:00">
                2017-04-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,175
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集">数据集</h2>
<p>使用的数据信为<code>gcookhook</code>包中的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(heightweight)</div></pre></td></tr></table></figure>
<p>数据如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight)</div><div class="line">  sex ageYear ageMonth heightIn weightLb</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>      <span class="number">143</span>     <span class="number">56.3</span>     <span class="number">85.0</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>      <span class="number">155</span>     <span class="number">62.3</span>    <span class="number">105.0</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>      <span class="number">153</span>     <span class="number">63.3</span>    <span class="number">108.0</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>      <span class="number">161</span>     <span class="number">59.0</span>     <span class="number">92.0</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>      <span class="number">191</span>     <span class="number">62.5</span>    <span class="number">112.5</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>      <span class="number">171</span>     <span class="number">62.5</span>    <span class="number">112.0</span></div></pre></td></tr></table></figure>
<h2 id="基本散点图">基本散点图</h2>
<p>用到的函数是<code>geom_point()</code>，默认为黑色圆点：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">head(heightweight[,c(<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) </div><div class="line"><span class="comment"># 只显示ageYear与heightIn这两列，等价于heightweight[,c(2,4)]</span></div><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point()</div></pre></td></tr></table></figure>
<p>数据如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight[,c(<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) </div><div class="line">  ageYear heightIn</div><div class="line"><span class="number">1</span>   <span class="number">11.92</span>     <span class="number">56.3</span></div><div class="line"><span class="number">2</span>   <span class="number">12.92</span>     <span class="number">62.3</span></div><div class="line"><span class="number">3</span>   <span class="number">12.75</span>     <span class="number">63.3</span></div><div class="line"><span class="number">4</span>   <span class="number">13.42</span>     <span class="number">59.0</span></div><div class="line"><span class="number">5</span>   <span class="number">15.92</span>     <span class="number">62.5</span></div><div class="line"><span class="number">6</span>   <span class="number">14.25</span>     <span class="number">62.5</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1k58gCCfmE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="改变形状">改变形状</h2>
<p>在geom_point()参数中加入shape=21，改为圆点：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point(shape=<span class="number">21</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c7jkgDfLCg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="改变大小">改变大小</h2>
<p>在geom_point()参数中加入size=2，将原来的点扩大2倍：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + </div><div class="line">  geom_point(size=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Dj5gcbG9db.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>还可以改变点的其它属性：其它属性包括点形(shape)，颜色(colour)。</p>
<h2 id="分组">分组</h2>
<h3 id="以颜色分组">以颜色分组</h3>
<p>把根据性别(sex)进行分组，用不同的颜色把不同性别表示出来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight[,c(<span class="string">"sex"</span>,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) <span class="comment"># 列出要绘图的列</span></div><div class="line">  sex ageYear heightIn</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>     <span class="number">56.3</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>     <span class="number">62.3</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>     <span class="number">63.3</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>     <span class="number">59.0</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>     <span class="number">62.5</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>     <span class="number">62.5</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex)) + </div><div class="line">  geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/H4FAhjDCLg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="用形状分组">用形状分组</h3>
<p>用不同的形状把不同性别表示出来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex)) + </div><div class="line">  geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CFdHejb2fD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="用形状和颜色两个图形属性同时分组">用形状和颜色两个图形属性同时分组</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex)) + geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aFg545ECke.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="用内置的函数进行形状与颜色的设置">用内置的函数进行形状与颜色的设置</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex)) + </div><div class="line">  geom_point()+</div><div class="line">  scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">2</span>)) + </div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c03b7A8d1j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="使用不同于默认设置的点型">使用不同于默认设置的点型</h3>
<p>使用参数geom_point()中的shape=可以设置不同的点型：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point(shape=<span class="number">3</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/j65ghFfE4m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="用scale_shape_manual来修饰点型">用scale_shape_manual()来修饰点型</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex)) + </div><div class="line">  geom_point(size=<span class="number">3</span>) +</div><div class="line">  scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">4</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LdILl0kJFj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="满足某一条的绘图">满足某一条的绘图</h2>
<p>下面以heightweight数据集为例，在数据集中增加一个用来标识儿童体重是否超过100磅的列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hw &lt;- heightweight</div><div class="line">hw$weightGroup &lt;- cut(hw$weightLb,breaks=c(-<span class="literal">Inf</span>, <span class="number">100</span>, <span class="literal">Inf</span>),</div><div class="line">                      labels=c(<span class="string">"&lt; 100"</span>, <span class="string">"&gt;=100"</span>))</div><div class="line">head(hw)</div></pre></td></tr></table></figure>
<p>最终数据如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; hw &lt;- heightweight</div><div class="line">&gt; hw$weightGroup &lt;- cut(hw$weightLb,breaks=c(-<span class="literal">Inf</span>, <span class="number">100</span>, <span class="literal">Inf</span>),</div><div class="line">+                       labels=c(<span class="string">"&lt; 100"</span>, <span class="string">"&gt;=100"</span>))</div><div class="line">&gt; head(hw)</div><div class="line">  sex ageYear ageMonth heightIn weightLb weightGroup</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>      <span class="number">143</span>     <span class="number">56.3</span>     <span class="number">85.0</span>       &lt; <span class="number">100</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>      <span class="number">155</span>     <span class="number">62.3</span>    <span class="number">105.0</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>      <span class="number">153</span>     <span class="number">63.3</span>    <span class="number">108.0</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>      <span class="number">161</span>     <span class="number">59.0</span>     <span class="number">92.0</span>       &lt; <span class="number">100</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>      <span class="number">191</span>     <span class="number">62.5</span>    <span class="number">112.5</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>      <span class="number">171</span>     <span class="number">62.5</span>    <span class="number">112.0</span>       &gt;=<span class="number">100</span></div></pre></td></tr></table></figure>
<p>上一段代码中，将hw中的weightLb的数据分开，区间是负无穷(-Inf)到100，100到正无穷(Inf)，将分割的结果给weightGroup，其标签为“&lt; 100”, “&gt;=100”</p>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggplot(hw,aes(x=ageYear,y=heightIn,shape=sex,fill=weightGroup)) + </div><div class="line">  geom_point(size=<span class="number">2.5</span>)+</div><div class="line">  scale_shape_manual(values=c(<span class="number">21</span>,<span class="number">24</span>)) +scale_fill_manual(values=c(<span class="literal">NA</span>,<span class="string">"black"</span>),guide=guide_legend(override.aes=list(shape=<span class="number">21</span>)))</div><div class="line"><span class="comment"># guide_legend(override.aes=list(shape=21))指定图例中的点</span></div><div class="line"><span class="comment"># scale_shape_manual(values=c(21,24))设置点的</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mjB5d50bkJ.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="用连续型变量映射到点的颜色或大小属性上">用连续型变量映射到点的颜色或大小属性上</h2>
<h3 id="把体重映射到颜色上">把体重映射到颜色上：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=weightLb)) + geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kbfEm3makA.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="把体重映射到大小上">把体重映射到大小上</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb)) + geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Bm5mg4KHgj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="精确绘图控制">精确绘图控制</h3>
<h4 id="连续型图例">连续型图例</h4>
<p>将数值最小值的用黑色表示，数值最高的是白色表示，<code>scale_fill_gradient()</code>用以控制颜色的渐变，这样图例是连续型的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb)) + </div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">2.5</span>) +</div><div class="line">  scale_fill_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/48Dm0gEdGF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="离散型图例">离散型图例</h4>
<p>下面的图例是离散的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb)) +</div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">2.5</span>) +</div><div class="line">  scale_fill_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>,breaks=seq(<span class="number">70</span>,<span class="number">170</span>,by=<span class="number">20</span>),guide=guide_legend())</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CIbcGeK6gl.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="避开重复的点">避开重复的点</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb,colour=sex)) +</div><div class="line">  geom_point(alpha=<span class="number">0.5</span>) +</div><div class="line">  scale_size_area() + <span class="comment"># 把相应的数值与点的面积对应起来</span></div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>) <span class="comment"># 修改颜色</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ddl8gJ1Idi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="图形重复问题">图形重复问题</h2>
<p>先看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EFbbB74C2c.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上面例子中，点比较多有54000个，有重叠的部分。但可以通过调节点的透明度进行调节：</p>
<p>透明度为0.1：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + geom_point()</div><div class="line">sp + geom_point(alpha=<span class="number">0.1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/76K63c3fgc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="另外一种解决数据点重叠的方法">另外一种解决数据点重叠的方法</h3>
<p>将数据点进行分箱(bin)，并以矩形来表示，同时将数据点的密度映射为矩形 填充色，stat_bin2d()的功能在于将数据进行分箱，默认的是把每个坐标轴上对应的点分30个箱子，即把数据集分为900个箱子如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + stat_bin2d()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GLL811bC5h.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>分箱数据的进一步优化：</p>
<p>stat_bin2d(bins=52)可以把每个坐标轴的数据点分为52个箱子，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + stat_bin2d(bins=<span class="number">52</span>) + </div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,limits=c(<span class="number">0</span>,<span class="number">6000</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/FekLf0HfHa.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="分箱数据形状的改变">分箱数据形状的改变：</h3>
<p>默认的分箱形状是正方形，可以换一下:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(hexbin) <span class="comment"># 用到里面的函数stat_binhex()</span></div><div class="line">sp + stat_binhex() +</div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,</div><div class="line">                      limits=c(<span class="number">0</span>,<span class="number">8000</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/F9KC562b3F.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图的图例是连续型变量，现在改为离散型变量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sp + stat_binhex() +</div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,</div><div class="line">                    breaks=c(<span class="number">0</span>,<span class="number">250</span>,<span class="number">500</span>,<span class="number">1000</span>,<span class="number">2000</span>,<span class="number">4000</span>,<span class="number">6000</span>),</div><div class="line">                    limits=c(<span class="number">0</span>,<span class="number">6000</span>))+</div><div class="line">   guides(fill=guide_legend(reverse=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6861ffa4cD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="x轴是离散型变量">x轴是离散型变量</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp1 &lt;- ggplot(ChickWeight,aes(x=Time,y=weight))</div><div class="line">sp1 + geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/49ej2AfB2K.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图所示，x轴上的Time是因子型变量，映射到y轴上的点有重复，现在添加geom_point(position=“jitter”)可以添加一定的扰动，避开重复：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_point(position=<span class="string">"jitter"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fA155jH6Lk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>对振动的程度，也可以进行修饰,width是水平方向的扰动，height是垂直方向上的扰动：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_point(position=position_jitter(width=<span class="number">0.1</span>,height=<span class="number">0</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lKDD7F5mAi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="箱线图">箱线图</h2>
<p>如果x轴是因子型变量，y轴是连续型变量，则用箱线图比较合适：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_boxplot(aes(group=Time))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2cFb2e7HfE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加回归模型拟合线">添加回归模型拟合线</h2>
<h3 id="基本绘图">基本绘图</h3>
<p>用stat_smooth()添加置信域，默认的是95%，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))</div><div class="line">sp + geom_point() + stat_smooth(method=lm)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BA6B50K5De.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>用stat_smooth(method=lm, levels=0.99)可以对置信域进行修改：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point() + stat_smooth(method=lm, levels=<span class="number">0.99</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Ghd92JdlDH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="去掉置信区间">去掉置信区间</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point() + stat_smooth(method=lm,se=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0k7A0gfakh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="置信区间的颜色设置">置信区间的颜色设置</h3>
<p>将点改为灰色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>)+</div><div class="line">  stat_smooth(method=lm,se=<span class="literal">FALSE</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/k4ijg52ibG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>置信区间的其他拟合方式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>) + stat_smooth()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GELh0FE8if.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>loess拟合，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>) + stat_smooth(method=loess)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c7JeA4fjgj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="logistics回归">Logistics回归</h2>
<h3 id="数据集-1">数据集</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">b &lt;- biopsy</div><div class="line">b$classen[b$class==<span class="string">"benign"</span>] &lt;- <span class="number">0</span></div><div class="line">b$classen[b$class==<span class="string">"malignant"</span>] &lt;- <span class="number">1</span></div><div class="line">head(b,<span class="number">10</span>)</div></pre></td></tr></table></figure>
<p>数据如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; head(b,<span class="number">10</span>)</div><div class="line">        ID V1 V2 V3 V4 V5 V6 V7 V8 V9     class classen</div><div class="line"><span class="number">1</span>  <span class="number">1000025</span>  <span class="number">5</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">2</span>  <span class="number">1002945</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">7</span> <span class="number">10</span>  <span class="number">3</span>  <span class="number">2</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">3</span>  <span class="number">1015425</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">4</span>  <span class="number">1016277</span>  <span class="number">6</span>  <span class="number">8</span>  <span class="number">8</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">7</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">5</span>  <span class="number">1017023</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">6</span>  <span class="number">1017122</span>  <span class="number">8</span> <span class="number">10</span> <span class="number">10</span>  <span class="number">8</span>  <span class="number">7</span> <span class="number">10</span>  <span class="number">9</span>  <span class="number">7</span>  <span class="number">1</span> malignant       <span class="number">1</span></div><div class="line"><span class="number">7</span>  <span class="number">1018099</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span> <span class="number">10</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">8</span>  <span class="number">1018561</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">9</span>  <span class="number">1033078</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">5</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">10</span> <span class="number">1033078</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(b,aes(x=V1,y=classen))+</div><div class="line">  geom_point(position=position_jitter(width=<span class="number">0.3</span>,height=<span class="number">0.06</span>),alpha=<span class="number">0.4</span>,shape=<span class="number">21</span>,size=<span class="number">1.5</span>)+</div><div class="line">  stat_smooth(method=glm,method.args = list(family = <span class="string">"binomial"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/5hhGJe8h63.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="有分组变量的的散点图拟合">有分组变量的的散点图拟合</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">sps &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+</div><div class="line">  geom_point() +</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>)</div><div class="line">sps + geom_smooth()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6D9b2eadhK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="基于数据集对拟合线进行外推">基于数据集对拟合线进行外推：</h2>
<p>此时需要添加<code>fullrange=TRUE</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3E3cFg4m60.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="向已有散点图添加拟合曲线">向已有散点图添加拟合曲线</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">model &lt;- lm(heightIn~ageYear+I(ageYear^<span class="number">2</span>),heightweight)</div><div class="line">model</div><div class="line"><span class="comment"># 创建一个包含变量ageYear的列，并对其进行插值</span></div><div class="line">xmin &lt;- min(heightweight$ageYear)</div><div class="line">xmax &lt;- max(heightweight$ageYear)</div><div class="line">predicted &lt;- data.frame(ageYear=seq(xmin,xmax,length.out = <span class="number">1000</span>))</div><div class="line"><span class="comment"># 计算变量heightIn的预测值</span></div><div class="line">predicted$heightIn &lt;- predict(model,predicted)</div><div class="line">head(predicted)</div><div class="line"><span class="comment">#下面代码是将数据点与模型预测值一起绘制在图形上：</span></div><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))+</div><div class="line">  geom_point()</div><div class="line">sp + geom_line(data=predicted,size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; model</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = heightIn ~ ageYear + I(ageYear^<span class="number">2</span>), data = heightweight)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line"> (Intercept)       ageYear  I(ageYear^<span class="number">2</span>)  </div><div class="line">    -<span class="number">10.3136</span>        <span class="number">8.6673</span>       -<span class="number">0.2478</span>  </div><div class="line"></div><div class="line">&gt; <span class="comment"># 创建一个包含变量ageYear的列，并对其进行插值</span></div><div class="line">&gt; xmin &lt;- min(heightweight$ageYear)</div><div class="line">&gt; xmax &lt;- max(heightweight$ageYear)</div><div class="line">&gt; predicted &lt;- data.frame(ageYear=seq(xmin,xmax,length.out = <span class="number">1000</span>))</div><div class="line">&gt; <span class="comment"># 计算变量heightIn的预测值</span></div><div class="line">&gt; predicted$heightIn &lt;- predict(model,predicted)</div><div class="line">&gt; head(predicted)</div><div class="line">   ageYear heightIn</div><div class="line"><span class="number">1</span> <span class="number">11.58000</span> <span class="number">56.82624</span></div><div class="line"><span class="number">2</span> <span class="number">11.58593</span> <span class="number">56.84358</span></div><div class="line"><span class="number">3</span> <span class="number">11.59185</span> <span class="number">56.86091</span></div><div class="line"><span class="number">4</span> <span class="number">11.59778</span> <span class="number">56.87822</span></div><div class="line"><span class="number">5</span> <span class="number">11.60370</span> <span class="number">56.89551</span></div><div class="line"><span class="number">6</span> <span class="number">11.60963</span> <span class="number">56.91279</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4Il7KGli1j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="定义函数绘制拟合曲线">定义函数绘制拟合曲线</h2>
<p>定义predictvals()函数可以简化向散点图添加模型拟合线的过程。使用时，只需要向其传递一个模型作为参数，该函数就会自动查询变量名、预测变量范围、并返回一个包含预测变量和模型预测值的数据框。将该数据框传递给geom_line()函数，即可绘制出模型拟合线：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 根据模型和变量xvar预测变量yvar</span></div><div class="line"><span class="comment"># 仅支持单一预测变量的模型</span></div><div class="line"><span class="comment"># xrange:x轴范围，当值为NULL时，等于模型对象中提取的x轴范围；当设定为包含两个数字的向量时，两个数字分别对应于x轴的上下限</span></div><div class="line"><span class="comment"># sample: x轴上包含的样本数</span></div><div class="line"><span class="comment"># ...：可传递给predict()函数的其他参数：</span></div><div class="line"></div><div class="line">predictvals &lt;- <span class="keyword">function</span>(model, xvar,yvar,xrange=<span class="literal">NULL</span>,samples=<span class="number">100</span>, <span class="keyword">...</span>)&#123;</div><div class="line">  <span class="comment"># 如果xrange没有输入，则从模型对象中自动提取x轴范围作为参数</span></div><div class="line">  <span class="comment"># 提取xrange参数的方法如下所示</span></div><div class="line">  <span class="keyword">if</span> (is.null(xrange))&#123;</div><div class="line">    <span class="keyword">if</span>(any(class(model)%<span class="keyword">in</span>%c(<span class="string">"lm"</span>,<span class="string">"glm"</span>)))</div><div class="line">      xrange &lt;- range(model$model[[xvar]]) <span class="keyword">else</span> <span class="keyword">if</span>(any(class(model) %<span class="keyword">in</span>% <span class="string">"loess"</span>))</div><div class="line">      xrange &lt;- range(model$x)</div><div class="line">  &#125;</div><div class="line">      </div><div class="line">  newdata &lt;- data.frame(x=seq(xrange[<span class="number">1</span>],xrange[<span class="number">2</span>],length.out=samples))</div><div class="line">  names(newdata) &lt;- xvar</div><div class="line">  newdata[[yvar]] &lt;- predict(model,newdata=newdata,<span class="keyword">...</span>)</div><div class="line">  newdata</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用lm()函数与loess()函数可以对数据集建立线性模型和LOESS模型：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">modlinear &lt;- lm(heightIn~ageYear,heightweight)</div><div class="line">modloess &lt;- loess(heightIn~ageYear,heightweight)</div></pre></td></tr></table></figure>
<p>针对两个模型分别调用predictvals()函数，并将得到的结果（数据框）传递给geom_line()：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">lm_predicted &lt;- predictvals(modlinear,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line">loess_predicted &lt;- predictvals(modloess,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line"></div><div class="line">sp + geom_line(data=lm_predicted,colour=<span class="string">"red"</span>,size=<span class="number">0.8</span>)+</div><div class="line">  geom_line(data=loess_predicted,colour=<span class="string">"blue"</span>,size=<span class="number">0.8</span>)+geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/5Jk913106L.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>另外一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">b &lt;- biopsy</div><div class="line"></div><div class="line">b$classn[b$class==<span class="string">"benign"</span>] &lt;- <span class="number">0</span></div><div class="line">b$classn[b$class==<span class="string">"malignant"</span>] &lt;- <span class="number">1</span></div><div class="line"></div><div class="line">fitlogistic &lt;- glm(classn ~ V1,b,family=binomial)</div><div class="line"></div><div class="line"><span class="comment"># 获得预测值 </span></div><div class="line">glm_predicted &lt;- predictvals(fitlogistic,<span class="string">"V1"</span>,<span class="string">"classn"</span>,type=<span class="string">"response"</span>)</div><div class="line"></div><div class="line">ggplot(b,aes(x=V1,y=classn))+</div><div class="line">  geom_point(position=position_jitter(width=<span class="number">0.3</span>,height=<span class="number">0.08</span>),alpha=<span class="number">0.4</span>,shape=<span class="number">21</span>,size=<span class="number">1.5</span>)+</div><div class="line">  geom_line(data=glm_predicted,colour=<span class="string">"blue"</span>,size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Jjlellf6ge.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加来自多个模型的拟合线">添加来自多个模型的拟合线</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">make_model &lt;- <span class="keyword">function</span>(data)&#123;</div><div class="line">  lm(heightIn~ageYear,data)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">models&lt;- dlply(heightweight,<span class="string">"sex"</span>,.fun=make_model)</div><div class="line"></div><div class="line"><span class="comment"># 有了模型对象之后，配合使用ldply()函数和predictvals()函数即可获取两个模型对应的预测值</span></div><div class="line"></div><div class="line">predvals &lt;- ldply(models,.fun=predictvals,xvar=<span class="string">"ageYear"</span>,yvar=<span class="string">"heightIn"</span>)</div><div class="line">head(predvals)</div></pre></td></tr></table></figure>
<p>查看数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(predvals)</div><div class="line">  sex  ageYear heightIn</div><div class="line"><span class="number">1</span>   f <span class="number">11.58000</span> <span class="number">57.96250</span></div><div class="line"><span class="number">2</span>   f <span class="number">11.63980</span> <span class="number">58.03478</span></div><div class="line"><span class="number">3</span>   f <span class="number">11.69960</span> <span class="number">58.10707</span></div><div class="line"><span class="number">4</span>   f <span class="number">11.75939</span> <span class="number">58.17936</span></div><div class="line"><span class="number">5</span>   f <span class="number">11.81919</span> <span class="number">58.25165</span></div><div class="line"><span class="number">6</span>   f <span class="number">11.87899</span> <span class="number">58.32394</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+</div><div class="line">  geom_point()+</div><div class="line">  geom_line(data=predvals)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/AdKdI2K6ge.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图中男性的数据点（即m颜色的点）终止于年龄最大点，女性的数据点（即f的颜色点）终止于女性组中年龄的最大点，为了使两组预测线对应的x轴范围与整个数据集的范围相同，可以向其传递一个xrange参数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">predvals &lt;- ldply(models,.fun=predictvals,xvar=<span class="string">"ageYear"</span>,yvar=<span class="string">"heightIn"</span>,xrange=range(heightweight$ageYear))</div><div class="line"></div><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+geom_point()+geom_line(data=predvals)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3mGgba6ih8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="向散点图中添加模型系数">向散点图中添加模型系数</h2>
<p>如果需要向拟合曲线中添加系数，则如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">model &lt;- lm(heightIn~ageYear,heightweight)</div><div class="line">summary(model)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; summary(model)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = heightIn ~ ageYear, data = heightweight)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">    Min      1Q  Median      3Q     Max </div><div class="line">-<span class="number">8.3517</span> -<span class="number">1.9006</span>  <span class="number">0.1378</span>  <span class="number">1.9071</span>  <span class="number">8.3371</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">(Intercept)  <span class="number">37.4356</span>     <span class="number">1.8281</span>   <span class="number">20.48</span>   &lt;<span class="number">2e-16</span> ***</div><div class="line">ageYear       <span class="number">1.7483</span>     <span class="number">0.1329</span>   <span class="number">13.15</span>   &lt;<span class="number">2e-16</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">2.989</span> on <span class="number">234</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.4249</span>,	Adjusted R-squared:  <span class="number">0.4225</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">172.9</span> on <span class="number">1</span> and <span class="number">234</span> DF,  p-value: &lt; <span class="number">2.2e-16</span></div></pre></td></tr></table></figure>
<p>由分析结果可知，模型的R^2=0.4249，则可以用annotate()函数将其添加到曲线上：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pred &lt;- predictvals(model,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point()+geom_line(data=pred)</div><div class="line">sp+annotate(<span class="string">"text"</span>,label=<span class="string">"r^2=0.42"</span>,x=<span class="number">16.5</span>,y=<span class="number">52</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HbeFJh2f5m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果不想使用纯文本字符串当注释的话，可以通过设置parse=TRUE调用R的数学表达式来输入公式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + annotate(<span class="string">"text"</span>,label=<span class="string">"r^2==0.42"</span>,parse=<span class="literal">TRUE</span>,x=<span class="number">16.5</span>,y=<span class="number">52</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8G959ILifI.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加公式">添加公式</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">eqn &lt;- as.character(as.expression(</div><div class="line">  substitute(italic(y)==a+b*italic(x)*<span class="string">","</span>~~italic(r)^<span class="number">2</span>~<span class="string">"="</span>~r2,</div><div class="line">             list(a=format(coef(model)[<span class="number">1</span>],digits=<span class="number">3</span>),</div><div class="line">                  b=format(coef(model)[<span class="number">2</span>],digits=<span class="number">3</span>),</div><div class="line">                  r2=format(summary(model)$r.squared,digits=<span class="number">2</span>)))</div><div class="line">))</div><div class="line"></div><div class="line">parse(text=eqn)</div><div class="line"></div><div class="line"><span class="comment">## expression(italic(y) == "37.4" + "1.75" * italic(x) * "," ~ ~italic(r)^2 ~ </span></div><div class="line"><span class="comment">##     "=" ~ "0.42")</span></div><div class="line"></div><div class="line">sp + annotate(<span class="string">"text"</span>,label=eqn,parse=<span class="literal">TRUE</span>,x=<span class="literal">Inf</span>,y=-<span class="literal">Inf</span>,hjust=<span class="number">1.1</span>,vjust=-<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/h80ijJa15b.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="向散点图添加边际地毯">向散点图添加边际地毯</h2>
<p>用到的函数是geom_rug(),以faithful数据集为例说明：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(faithful)</div><div class="line">  eruptions waiting</div><div class="line"><span class="number">1</span>     <span class="number">3.600</span>      <span class="number">79</span></div><div class="line"><span class="number">2</span>     <span class="number">1.800</span>      <span class="number">54</span></div><div class="line"><span class="number">3</span>     <span class="number">3.333</span>      <span class="number">74</span></div><div class="line"><span class="number">4</span>     <span class="number">2.283</span>      <span class="number">62</span></div><div class="line"><span class="number">5</span>     <span class="number">4.533</span>      <span class="number">85</span></div><div class="line"><span class="number">6</span>     <span class="number">2.883</span>      <span class="number">55</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point() + geom_rug()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4dg2eLaIdI.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加扰动避免重叠">添加扰动，避免重叠</h2>
<p>上图中的waiting中的边际地毯线有重叠的（虽然看起来很稀疏，其实都重叠在了一起），因此通过向边际地毯线的位置坐标添加扰动并设定size减少线宽可以减轻边际地毯线的重叠程度。如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point()+geom_rug(position=<span class="string">"jitter"</span>,size=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HhGC4L4249.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="向散点图添加标签">向散点图添加标签</h2>
<p>用annotate()可以向数据点中添加标签，以countries数据集为例说明，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">data1 &lt;- subset(countries,Year==<span class="number">2009</span>&amp;healthexp&gt;<span class="number">2000</span>)</div><div class="line">head(data1)</div></pre></td></tr></table></figure>
<p>数据如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(data1)</div><div class="line">          Name Code Year      GDP laborrate healthexp infmortality</div><div class="line"><span class="number">254</span>    Andorra  AND <span class="number">2009</span>       <span class="literal">NA</span>        <span class="literal">NA</span>  <span class="number">3089.636</span>          <span class="number">3.1</span></div><div class="line"><span class="number">560</span>  Australia  AUS <span class="number">2009</span> <span class="number">42130.82</span>      <span class="number">65.2</span>  <span class="number">3867.429</span>          <span class="number">4.2</span></div><div class="line"><span class="number">611</span>    Austria  AUT <span class="number">2009</span> <span class="number">45555.43</span>      <span class="number">60.4</span>  <span class="number">5037.311</span>          <span class="number">3.6</span></div><div class="line"><span class="number">968</span>    Belgium  BEL <span class="number">2009</span> <span class="number">43640.20</span>      <span class="number">53.5</span>  <span class="number">5104.019</span>          <span class="number">3.6</span></div><div class="line"><span class="number">1733</span>    Canada  CAN <span class="number">2009</span> <span class="number">39599.04</span>      <span class="number">67.8</span>  <span class="number">4379.761</span>          <span class="number">5.2</span></div><div class="line"><span class="number">2702</span>   Denmark  DNK <span class="number">2009</span> <span class="number">55933.35</span>      <span class="number">65.4</span>  <span class="number">6272.729</span>          <span class="number">3.4</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(data1,aes(x=healthexp,y=infmortality))+geom_point()</div><div class="line">sp + annotate(<span class="string">"text"</span>,x=<span class="number">4350</span>,y=<span class="number">5.4</span>,label=<span class="string">"Canada"</span>)+annotate(<span class="string">"text"</span>,x=<span class="number">7400</span>,y=<span class="number">6.8</span>,label=<span class="string">"USA"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1mLfGhhBAh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="如果要向每一个数据点添加标签如下所示">如果要向每一个数据点添加标签，如下所示：</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/eJiiFhD8e1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="对数据点的标签进行微调">对数据点的标签进行微调</h3>
<p>vjust=0时，标签文本的基线会与数据点对齐，设定vjust=1时，标签文本的顶部会与数据点对齐。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),vjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/I1ahDLKc34.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="添加y的取值">添加y的取值</h3>
<p>也可以添加y的映射来进行微调</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(y=infmortality+<span class="number">0.1</span>,label=Name),size=<span class="number">4</span>,vjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/bDHI5dm4BG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="左对齐">左对齐</h3>
<p>添加参数hjust=0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>,hjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/m13kI4jGjK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="右对齐">右对齐</h3>
<p>添加参数hjust=1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>,hjust=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><strong><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ggLiALF7h5.png?imageslim" alt="mark"></strong></p>
<h3 id="有针对性的增加标签">有针对性的增加标签</h3>
<p>如果只想给为个别数据点添加标签，但希望R自动设定标签位置的话，可以给数据框增加一个只包含拟使用的标签的新列。一个可行的方案是：首先，将所用数据复制一个副本，并将Name复制为Name1</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">data1$Name1 &lt;- data1$Name</div><div class="line">idx &lt;- data1$Name1 %<span class="keyword">in</span>% c(<span class="string">"Canada"</span>,<span class="string">"Ireland"</span>,<span class="string">"United Kingdom"</span>,<span class="string">"United States"</span>,<span class="string">"New Zealand"</span>,<span class="string">"Iceland"</span>,<span class="string">"Japan"</span>,<span class="string">"Luxembourg"</span>,<span class="string">"Netherlands"</span>,<span class="string">"Switzerland"</span>)</div><div class="line">idx</div><div class="line"></div><div class="line"><span class="comment">##  [1] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE</span></div><div class="line"><span class="comment">## [12]  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></div><div class="line"><span class="comment">## [23] FALSE FALSE  TRUE  TRUE  TRUE</span></div><div class="line">data1$Name1[!idx] &lt;- <span class="literal">NA</span></div><div class="line"><span class="comment"># 把需要的标签留下</span></div><div class="line"></div><div class="line">head(data1)</div><div class="line"></div><div class="line"><span class="comment">##           Name Code Year      GDP laborrate healthexp infmortality  Name1</span></div><div class="line"><span class="comment">## 254    Andorra  AND 2009       NA        NA  3089.636          3.1   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 560  Australia  AUS 2009 42130.82      65.2  3867.429          4.2   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 611    Austria  AUT 2009 45555.43      60.4  5037.311          3.6   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 968    Belgium  BEL 2009 43640.20      53.5  5104.019          3.6   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 1733    Canada  CAN 2009 39599.04      67.8  4379.761          5.2 Canada</span></div><div class="line"><span class="comment">## 2702   Denmark  DNK 2009 55933.35      65.4  6272.729          3.4   &lt;NA&gt;</span></div><div class="line"></div><div class="line">ggplot(data1,aes(x=healthexp,y=infmortality))+</div><div class="line">  geom_point()+</div><div class="line">  geom_text(aes(x=healthexp+<span class="number">100</span>,label=Name1),size=<span class="number">4</span>,hjust=<span class="number">0</span>)+</div><div class="line">  xlim(<span class="number">2000</span>,<span class="number">10000</span>)</div><div class="line"></div><div class="line"><span class="comment">## Warning in loop_apply(n, do.ply): Removed 17 rows containing missing</span></div><div class="line"><span class="comment">## values (geom_text).</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g47B8cfc7L.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>注意<code>%in%</code>的功能，此符号的功能是如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">12</span>)</div><div class="line">y &lt;- c(<span class="number">1</span>,<span class="number">5</span>,<span class="number">12</span>)</div><div class="line">x%<span class="keyword">in</span>%y</div><div class="line"></div><div class="line"><span class="comment">##  [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</span></div><div class="line"><span class="comment">## [12]  TRUE</span></div><div class="line"></div><div class="line">x[x%<span class="keyword">in</span>%y] <span class="comment"># 找出x中包含y的元素</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  1  5  5  5  5 12</span></div></pre></td></tr></table></figure>
<p>可以看出，%in%的功能是在x中查找y，如果有则为TRUE，若无则为FALSE。</p>
<h2 id="气泡图">气泡图</h2>
<p>气泡图的每个面积正比于变量值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">data2 &lt;- subset(countries,Year==<span class="number">2009</span>&amp;Name %<span class="keyword">in</span>% c(<span class="string">"Canada"</span>,<span class="string">"Ireland"</span>,<span class="string">"United Kingdom"</span>,<span class="string">"United States"</span>,<span class="string">"New Zealand"</span>,<span class="string">"Iceland"</span>,<span class="string">"Japan"</span>,<span class="string">"Luxembourg"</span>,<span class="string">"Netherlands"</span>,<span class="string">"Switzerland"</span>))</div><div class="line"></div><div class="line">head(data2)</div><div class="line"></div><div class="line"><span class="comment">##             Name Code Year       GDP laborrate healthexp infmortality</span></div><div class="line"><span class="comment">## 1733      Canada  CAN 2009  39599.04      67.8  4379.761          5.2</span></div><div class="line"><span class="comment">## 4436     Iceland  ISL 2009  37972.24      77.5  3130.391          1.7</span></div><div class="line"><span class="comment">## 4691     Ireland  IRL 2009  49737.93      63.6  4951.845          3.4</span></div><div class="line"><span class="comment">## 4946       Japan  JPN 2009  39456.44      59.5  3321.466          2.4</span></div><div class="line"><span class="comment">## 5864  Luxembourg  LUX 2009 106252.24      55.5  8182.855          2.2</span></div><div class="line"><span class="comment">## 7088 Netherlands  NLD 2009  48068.35      66.1  5163.740          3.8</span></div><div class="line"></div><div class="line"><span class="comment"># 如果把GDP映射给size，则表示把GDP映射给了点的半径，并非面积，如下所示：</span></div><div class="line">p &lt;- ggplot(data2,aes(x=healthexp,y=infmortality,size=GDP))+</div><div class="line">  geom_point(shape=<span class="number">21</span>,colour=<span class="string">"black"</span>,fill=<span class="string">"cornsilk"</span>)</div><div class="line">p</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kDFgD1dl31.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果想要把数据点的值映射给面积，用到的函数是scale_size_area()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_size_area(max_size=<span class="number">15</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J55h36mm6D.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="其他用法">其他用法</h3>
<p>当x轴与y轴都为分类变量时，气泡图可以用来表示风格点上的变量值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 以HairEyeColor数据集为例</span></div><div class="line">HairEyeColor</div><div class="line"></div><div class="line"><span class="comment">## , , Sex = Male</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##        Eye</span></div><div class="line"><span class="comment">## Hair    Brown Blue Hazel Green</span></div><div class="line"><span class="comment">##   Black    32   11    10     3</span></div><div class="line"><span class="comment">##   Brown    53   50    25    15</span></div><div class="line"><span class="comment">##   Red      10   10     7     7</span></div><div class="line"><span class="comment">##   Blond     3   30     5     8</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , Sex = Female</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##        Eye</span></div><div class="line"><span class="comment">## Hair    Brown Blue Hazel Green</span></div><div class="line"><span class="comment">##   Black    36    9     5     2</span></div><div class="line"><span class="comment">##   Brown    66   34    29    14</span></div><div class="line"><span class="comment">##   Red      16    7     7     7</span></div><div class="line"><span class="comment">##   Blond     4   64     5     8</span></div><div class="line"></div><div class="line">hec &lt;- HairEyeColor[,,<span class="string">"Male"</span>] + HairEyeColor[,,<span class="string">"Female"</span>]</div><div class="line"><span class="keyword">library</span>(reshape2)</div><div class="line"></div><div class="line">hec &lt;- melt(hec,value.name=<span class="string">"count"</span>)</div><div class="line"></div><div class="line">ggplot(hec,aes(x=Eye,y=Hair))+</div><div class="line">  geom_point(aes(size=count),shape=<span class="number">21</span>,colour=<span class="string">"black"</span>,fill=<span class="string">"cornsilk"</span>)+</div><div class="line">  scale_size_area(max_size=<span class="number">20</span>,guide=<span class="literal">FALSE</span>)+</div><div class="line">  geom_text(aes(y=as.numeric(Hair)-sqrt(count)/<span class="number">22</span>,label=count),vjust=<span class="number">1</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6bcEJikla4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制散点矩阵图">绘制散点矩阵图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">c2009 &lt;- subset(countries,Year == <span class="number">2009</span>,</div><div class="line">                select = c(Name,GDP,laborrate,healthexp,infmortality))</div><div class="line"></div><div class="line">head(c2009)</div><div class="line"></div><div class="line"><span class="comment">##               Name      GDP laborrate  healthexp infmortality</span></div><div class="line"><span class="comment">## 50     Afghanistan       NA      59.8   50.88597        103.2</span></div><div class="line"><span class="comment">## 101        Albania 3772.605      59.5  264.60406         17.2</span></div><div class="line"><span class="comment">## 152        Algeria 4022.199      58.5  267.94653         32.0</span></div><div class="line"><span class="comment">## 203 American Samoa       NA        NA         NA           NA</span></div><div class="line"><span class="comment">## 254        Andorra       NA        NA 3089.63589          3.1</span></div><div class="line"><span class="comment">## 305         Angola 4068.576      81.3  203.80787         99.9</span></div><div class="line"></div><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>])</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d6E58FEJjE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上面的绘图没有使用ggplot2，是因为它不能绘制散点图矩阵（至少绘制的效果不佳），上述绘图过得也可以使用自定义的面板函数，现在我们定义一个<code>panel.cor</code>函数来展示变量两两之间的相关系数，以代替默认的散点图。相关系数较大的位置将对应较大的字符，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">panel.cor &lt;- <span class="keyword">function</span>(x,y,digits=<span class="number">2</span>, prefix=<span class="string">""</span>,cex.cor,<span class="keyword">...</span>)&#123;</div><div class="line">  usr &lt;- par(<span class="string">"usr"</span>)</div><div class="line">  on.exit(par(<span class="string">"usr"</span>))</div><div class="line">  par(usr=c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>))</div><div class="line">  r &lt;- abs(cor(x,y,use=<span class="string">"complete.obs"</span>))</div><div class="line">  txt &lt;- format(c(r,<span class="number">0.123456789</span>),digits=digits)[<span class="number">1</span>]</div><div class="line">  txt &lt;- paste(prefix, txt, sep=<span class="string">""</span>)</div><div class="line">  <span class="keyword">if</span>(missing(cex.cor)) cex.cor &lt;- <span class="number">0.8</span>/strwidth(txt)</div><div class="line">  text(<span class="number">0.5</span>,<span class="number">0.5</span>,txt,cex=cex.cor*(<span class="number">1</span>+r)/<span class="number">2</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了在面板的对角线上展示各个变量的直方图，我们再定义一个<code>panel.hist</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">panel.hist &lt;- <span class="keyword">function</span>(x,<span class="keyword">...</span>)&#123;</div><div class="line">  usr &lt;-par(<span class="string">"usr"</span>)</div><div class="line">  on.exit(par(usr))</div><div class="line">  par(usr=c(usr[<span class="number">1</span>:<span class="number">2</span>],<span class="number">0</span>,<span class="number">1.5</span>))</div><div class="line">  h&lt;-hist(x,plot=<span class="literal">FALSE</span>)</div><div class="line">  breaks&lt;-h$breaks</div><div class="line">  nB &lt;- length(breaks)</div><div class="line">  y&lt;-h$counts</div><div class="line">  y&lt;-y/max(y)</div><div class="line">  rect(breaks[-nB],<span class="number">0</span>,breaks[-<span class="number">1</span>],y,col=<span class="string">"white"</span>,<span class="keyword">...</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的函数都源于<code>pairs</code>函数的帮助页面，可以直接复制这个函数的相关代码，定义了这些函数后，我们哦可以高骼它来绘制散点图矩阵。令<code>pairs()</code>函数在面板的上三角执行<code>panel.cor</code>函数，在面板的对角线执行<code>panel.hist</code>函数，在绘图时也添加了一些东西，在面板的下三角执行<code>panel.smooth</code>函数，这个函数将在散点图矩阵的下三角绘制散点图，并添加一个LOWESS平滑曲线，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>],upper.panel=panel.cor,</div><div class="line">      diag.panel = panel.hist,</div><div class="line">      lower.panel = panel.smooth)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d591DFbe6G.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>也许我们希望用线性模型来代替LOWESS模型，<code>panel.lm</code>函数可以完成该操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">panel.lm &lt;- <span class="keyword">function</span>(x,y,col=par(<span class="string">"col"</span>),bg=<span class="literal">NA</span>,pch=par(<span class="string">"pch"</span>),</div><div class="line">                     cex=<span class="number">1</span>,col.smooth=<span class="string">"black"</span>,<span class="keyword">...</span>)&#123;</div><div class="line">  points(x,y,pch=pch,col=col,bg=bg,cex=cex)</div><div class="line">  abline(stats::lm(y~x),col=col.smooth,<span class="keyword">...</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这次系统默认的线条颜色不再是红色，而是黑色，调用函数<code>pairs()</code>时（与函数panel.smooth配合使用），设定col.smooth参数可以对线条颜色进行修改，为了便于辩认数据点，我们在图中使用更小的点，该操作可以通过<code>pch=&quot;.&quot;</code>来实现，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>],pch=<span class="string">"."</span>,</div><div class="line">        upper.panel=panel.cor,</div><div class="line">        diag.panel = panel.hist,</div><div class="line">        lower.panel = panel.lm)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kH91kDg75H.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>cex参数可以控制图中点的大小，cex参数的默认值是1，其值越大，数据点越大，但如果cex小于0.5，那么图形输出为PDF文件时可能无法很好地渲染。</p>
<h3 id="ggally包的ggpairs函数">GGally包的ggpairs函数</h3>
<p>使用GGally包的ggpairs函数也能绘制散点矩阵图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggpairs(c2009[,<span class="number">2</span>:<span class="number">5</span>])</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/387lC2aCf1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/13/R/ggplot2(3) - 条形图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/13/R/ggplot2(3) - 条形图/" itemprop="url">ggplot2(3)-条形图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T12:00:00+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,210
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集">数据集</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(pg_mean)</div></pre></td></tr></table></figure>
<h2 id="简单绘图">简单绘图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group, y=weight))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/39AEB9lKag.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>代码解释：<code>geom_bar()</code>表示绘制的是条形图，geom是图形的意思，例如点、线、多边形等。</p>
<h2 id="x轴变量类型">x轴变量类型</h2>
<p>条形图的x轴变量是离散型变量，如果数据集中的是连续型变量，则需要用factor()转化为因子型变量，以下是未转化前的图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; BOD</div><div class="line">  Time demand</div><div class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">8.3</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>   <span class="number">10.3</span></div><div class="line"><span class="number">3</span>    <span class="number">3</span>   <span class="number">19.0</span></div><div class="line"><span class="number">4</span>    <span class="number">4</span>   <span class="number">16.0</span></div><div class="line"><span class="number">5</span>    <span class="number">5</span>   <span class="number">15.6</span></div><div class="line"><span class="number">6</span>    <span class="number">7</span>   <span class="number">19.8</span></div><div class="line">str(BOD)</div><div class="line"><span class="comment">## 'data.frame':    6 obs. of  2 variables:</span></div><div class="line"><span class="comment">##  $ Time  : num  1 2 3 4 5 7</span></div><div class="line"><span class="comment">##  $ demand: num  8.3 10.3 19 16 15.6 19.8</span></div><div class="line"><span class="comment">##  - attr(*, "reference")= chr "A1.4, p. 270"</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD, aes(x=Time, y=demand)) + geom_bar(stat=<span class="string">"identity"</span>)</div><div class="line"><span class="comment"># 绘图函数里的stat参数表示对样本点做统计的方式，默认为identity，表示一个x对应一个y，同时还可以是bin，表示一个x对应落到该x的样本数。”说白了就是，identity提取横坐标x对应的y值，bin提取横坐标x的频数</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fGG5Cg7FJm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在将Time转化为factor，再进行绘图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD, aes(x=factor(Time), y=demand)) + geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DCj3bhdhJ5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="颜色填充">颜色填充</h2>
<p>以下的代码中，将上述条形图的颜色进行调整，用浅蓝色进行填充，用黑色描边：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=<span class="string">"identity"</span>,fill=<span class="string">"lightblue"</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3DII8mK842.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="簇状条形图">簇状条形图</h2>
<p>此例子中用gcookbook包中的cabbage_exp数据集。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">head(cabbage_exp) <span class="comment"># 查看数据集</span></div><div class="line"></div><div class="line"><span class="comment">##   Cultivar Date Weight        sd  n         se</span></div><div class="line"><span class="comment">## 1      c39  d16   3.18 0.9566144 10 0.30250803</span></div><div class="line"><span class="comment">## 2      c39  d20   2.80 0.2788867 10 0.08819171</span></div><div class="line"><span class="comment">## 3      c39  d21   2.74 0.9834181 10 0.31098410</span></div><div class="line"><span class="comment">## 4      c52  d16   2.26 0.4452215 10 0.14079141</span></div><div class="line"><span class="comment">## 5      c52  d20   3.11 0.7908505 10 0.25008887</span></div><div class="line"><span class="comment">## 6      c52  d21   1.47 0.2110819 10 0.06674995</span></div></pre></td></tr></table></figure>
<p>绘图:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1ai3a40Lf4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>注意参数中的position=“dodge”,若无此参数，则Cultivar的两个变量会叠加，dodge意思是“避开”，即添加上此参数，两个变量避开，若无此参数，图像如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/B86jc4gi7a.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="颜色的设置">颜色的设置</h2>
<p><code>RColorBrewer</code>包中有各种颜色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>,colour=<span class="string">"red"</span>)+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/a7lHji8jIE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="频数条形图">频数条形图：</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds,aes(x=cut))+geom_bar()</div><div class="line"><span class="comment"># 等价于geom_bar(stat="bin")</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/78k6FK49ba.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>geom_bar()默认情况下参数为stat=“bin”,当x轴的变量是分类变量，即因子型向量时此函数会自动计算每组变量对应的观测数，如上图所示，如果x是连续型变量，则出现的是直方图，如下图所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds,aes(x=carat))+geom_bar()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/JmB59jHK17.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="对条形图进行上色">对条形图进行上色</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">upc &lt;- subset(uspopchange,rank(Change)&gt;<span class="number">40</span>) <span class="comment"># rank()是秩的顺序</span></div><div class="line">upc</div><div class="line"></div><div class="line"><span class="comment">##             State Abb Region Change</span></div><div class="line"><span class="comment">## 3         Arizona  AZ   West   24.6</span></div><div class="line"><span class="comment">## 6        Colorado  CO   West   16.9</span></div><div class="line"><span class="comment">## 10        Florida  FL  South   17.6</span></div><div class="line"><span class="comment">## 11        Georgia  GA  South   18.3</span></div><div class="line"><span class="comment">## 13          Idaho  ID   West   21.1</span></div><div class="line"><span class="comment">## 29         Nevada  NV   West   35.1</span></div><div class="line"><span class="comment">## 34 North Carolina  NC  South   18.5</span></div><div class="line"><span class="comment">## 41 South Carolina  SC  South   15.3</span></div><div class="line"><span class="comment">## 44          Texas  TX  South   20.6</span></div><div class="line"><span class="comment">## 45           Utah  UT   West   23.8</span></div><div class="line"></div><div class="line">ggplot(upc,aes(x=Abb,y=Change,fill=Region))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4gfdb1Fgel.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>还可以使用颜色代码进行上色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(upc,aes(x=reorder(Abb,Change),y=Change,fill=Region))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+scale_fill_manual(values=c(<span class="string">"#669933"</span>,<span class="string">"#FFCC66"</span>))+xlab(<span class="string">"State"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GaIj74gldg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="正负条形图上色">正负条形图上色</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">csub &lt;- subset(climate,Source==<span class="string">"Berkeley"</span> &amp; Year &gt;= <span class="number">1900</span>)</div><div class="line">csub$pos &lt;- csub$Anomaly10y&gt;=<span class="number">0</span> <span class="comment"># 将正数转化为T，负数转化为F</span></div><div class="line">ggplot(csub,aes(x=Year,y=Anomaly10y,fill=pos))+geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/e5f5i1FDcj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="调节上色顺序">调节上色顺序</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(csub,aes(x=Year,y=Anomaly10y,fill=pos))+geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>,size=<span class="number">0.25</span>)+scale_fill_manual(values=c(<span class="string">"#CCEEFF"</span>,<span class="string">"#FFDDDD"</span>),guide=<span class="literal">FALSE</span>) </div><div class="line"><span class="comment"># guide=FALSE消除图例</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kBjgj3CL5m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="调节条形图之间的间距">调节条形图之间的间距</h2>
<p>先看一下原始图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/E7IC0G9g2H.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将间隔改为0.5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=&quot;identity&quot;,width=0.5)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fLkE3B9eK1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将间隔改为1（最大）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3mB7gHb9Ke.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="簇状条形图间隔的改变">簇状条形图间隔的改变</h2>
<p>原始图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">0.5</span>,position=<span class="string">"dodge"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9Fd1706dK8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>更改：参数是position=position_dodge()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">0.5</span>,position=position_dodge(<span class="number">0.7</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/la15DgB2fd.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="堆积条形图">堆积条形图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/IJ32CHkGGK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>注意图例中的变化，guides(fill=guide_legend(reverse=TRUE))</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)+guides(fill=guide_legend(reverse=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dgI1chIBD1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="调整堆叠的顺序">调整堆叠的顺序</h3>
<p>用于plyr包中desc()函数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar,order=desc(Cultivar)))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lE2ceGfm4A.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="堆叠图的美化">堆叠图的美化</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/K8679g72D3.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制百分比条形图">绘制百分比条形图</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ce &lt;- ddply(cabbage_exp,<span class="string">"Date"</span>,transform,percent_weight=Weight/sum(Weight)*<span class="number">100</span>)</div><div class="line">ggplot(ce,aes(x=Date,y=percent_weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/gc6I6cFa4C.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="百分比条形图的美化">百分比条形图的美化</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(ce,aes(x=Date,y=percent_weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/H7mHL1m448.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="添加数据标签">添加数据标签</h2>
<p>标签在条形图顶端下方：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/E653ABHfFG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>标签在条形图顶端上方：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=-<span class="number">0.2</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/497kEJa3d4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="调节y轴与标签">调节y轴与标签：</h2>
<p>调节y轴的上限</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=-<span class="number">0.2</span>)+ylim(<span class="number">0</span>,max(cabbage_exp$Weight)*<span class="number">1.05</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EK3HJfHDB5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>设定标签的y轴位置使其高于条形图顶端</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(y=Weight+<span class="number">0.1</span>,label=Weight))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mfJBL0iiC7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="簇状条形图的标签设置">簇状条形图的标签设置</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+</div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"dodge"</span>)+</div><div class="line">  geom_text(aes(label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>,position=position_dodge(<span class="number">0.9</span>),size=<span class="number">5</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/7l82689Ih5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="堆积簇状条形图的标签设置-位于顶端">堆积簇状条形图的标签设置-位于顶端</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)) </div><div class="line"><span class="comment"># cumsum累积加，例如cumsum(seq(1,10))</span></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_text(aes(y=label_y,label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/icHJlJLD71.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="堆积簇状条形图的标签设置-位于中央">堆积簇状条形图的标签设置-位于中央</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)-<span class="number">0.5</span>*Weight) </div><div class="line"></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_text(aes(y=label_y,label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4aiE3aF1JA.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="堆积簇状条形图的标签设置-添加单位">堆积簇状条形图的标签设置-添加单位</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)-<span class="number">0.5</span>*Weight) </div><div class="line"></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">    geom_text(aes(y=label_y,label=paste(format(Weight,nsmall=<span class="number">2</span>),<span class="string">"kg"</span>)),size=<span class="number">4</span>)+</div><div class="line">  guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/G9cb2G07cE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="绘制cleveland图">绘制Cleveland图</h2>
<h3 id="基础绘图">基础绘图</h3>
<p>用到的是geom_point()，先看一个最基本的图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tophit &lt;- tophitters2001[<span class="number">1</span>:<span class="number">25</span>,]</div><div class="line">ggplot(tophit,aes(x=avg,y=name))+geom_point()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4Kg4mI5DI4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="排序">排序</h3>
<p>上图是用字母顺序来排列的，下面的图是用avg的大小来排列的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=avg,y=reorder(name,avg)))+</div><div class="line">  geom_point(size=<span class="number">3</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.x=element_blank(),</div><div class="line">       panel.grid.minor.x=element_blank(),</div><div class="line">       panel.grid.major.y=element_line(colour=<span class="string">"grey60"</span>,linetype=<span class="string">"dashed"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/A0JG3lE4Ef.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="x轴与y轴互换">x轴与y轴互换</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=reorder(name,avg),y=avg))+</div><div class="line">  geom_point(size=<span class="number">3</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(axis.text.x = element_text(angle=<span class="number">60</span>,hjust=<span class="number">1</span>),</div><div class="line">        panel.grid.major.y=element_blank(),</div><div class="line">        panel.grid.minor.y=element_blank(),</div><div class="line">        panel.grid.major.x=element_line(colour=<span class="string">"grey60"</span>,linetype=<span class="string">"dashed"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d7Jg63c9fk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="火柴杆图">火柴杆图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">nameorder &lt;- tophit$name[order(tophit$lg,tophit$avg)]</div><div class="line">tophit$name &lt;- factor(tophit$name,levels=nameorder)</div><div class="line">&gt; head(tophit)</div><div class="line">         id   first   last           name year stint team lg   g  ab   r   h 2b 3b hr rbi sb cs</div><div class="line"><span class="number">1</span> walkela01   Larry Walker   Larry Walker <span class="number">2001</span>     <span class="number">1</span>  COL NL <span class="number">142</span> <span class="number">497</span> <span class="number">107</span> <span class="number">174</span> <span class="number">35</span>  <span class="number">3</span> <span class="number">38</span> <span class="number">123</span> <span class="number">14</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span> suzukic01  Ichiro Suzuki  Ichiro Suzuki <span class="number">2001</span>     <span class="number">1</span>  SEA AL <span class="number">157</span> <span class="number">692</span> <span class="number">127</span> <span class="number">242</span> <span class="number">34</span>  <span class="number">8</span>  <span class="number">8</span>  <span class="number">69</span> <span class="number">56</span> <span class="number">14</span></div><div class="line"><span class="number">3</span> giambja01   Jason Giambi   Jason Giambi <span class="number">2001</span>     <span class="number">1</span>  OAK AL <span class="number">154</span> <span class="number">520</span> <span class="number">109</span> <span class="number">178</span> <span class="number">47</span>  <span class="number">2</span> <span class="number">38</span> <span class="number">120</span>  <span class="number">2</span>  <span class="number">0</span></div><div class="line"><span class="number">4</span> alomaro01 Roberto Alomar Roberto Alomar <span class="number">2001</span>     <span class="number">1</span>  CLE AL <span class="number">157</span> <span class="number">575</span> <span class="number">113</span> <span class="number">193</span> <span class="number">34</span> <span class="number">12</span> <span class="number">20</span> <span class="number">100</span> <span class="number">30</span>  <span class="number">6</span></div><div class="line"><span class="number">5</span> heltoto01    Todd Helton    Todd Helton <span class="number">2001</span>     <span class="number">1</span>  COL NL <span class="number">159</span> <span class="number">587</span> <span class="number">132</span> <span class="number">197</span> <span class="number">54</span>  <span class="number">2</span> <span class="number">49</span> <span class="number">146</span>  <span class="number">7</span>  <span class="number">5</span></div><div class="line"><span class="number">6</span>  aloumo01  Moises   Alou    Moises Alou <span class="number">2001</span>     <span class="number">1</span>  HOU NL <span class="number">136</span> <span class="number">513</span>  <span class="number">79</span> <span class="number">170</span> <span class="number">31</span>  <span class="number">1</span> <span class="number">27</span> <span class="number">108</span>  <span class="number">5</span>  <span class="number">1</span></div><div class="line">   bb  so ibb hbp sh sf gidp    avg</div><div class="line"><span class="number">1</span>  <span class="number">82</span> <span class="number">103</span>   <span class="number">6</span>  <span class="number">14</span>  <span class="number">0</span>  <span class="number">8</span>    <span class="number">9</span> <span class="number">0.3501</span></div><div class="line"><span class="number">2</span>  <span class="number">30</span>  <span class="number">53</span>  <span class="number">10</span>   <span class="number">8</span>  <span class="number">4</span>  <span class="number">4</span>    <span class="number">3</span> <span class="number">0.3497</span></div><div class="line"><span class="number">3</span> <span class="number">129</span>  <span class="number">83</span>  <span class="number">24</span>  <span class="number">13</span>  <span class="number">0</span>  <span class="number">9</span>   <span class="number">17</span> <span class="number">0.3423</span></div><div class="line"><span class="number">4</span>  <span class="number">80</span>  <span class="number">71</span>   <span class="number">5</span>   <span class="number">4</span>  <span class="number">9</span>  <span class="number">9</span>    <span class="number">9</span> <span class="number">0.3357</span></div><div class="line"><span class="number">5</span>  <span class="number">98</span> <span class="number">104</span>  <span class="number">15</span>   <span class="number">5</span>  <span class="number">1</span>  <span class="number">5</span>   <span class="number">14</span> <span class="number">0.3356</span></div><div class="line"><span class="number">6</span>  <span class="number">57</span>  <span class="number">57</span>  <span class="number">14</span>   <span class="number">3</span>  <span class="number">0</span>  <span class="number">8</span>   <span class="number">18</span> <span class="number">0.3314</span></div><div class="line"></div><div class="line"></div><div class="line">ggplot(tophit,aes(x=avg,y=name))+</div><div class="line">  geom_segment(aes(yend=name),xend=<span class="number">0</span>,colour=<span class="string">"grey"</span>)+</div><div class="line">  geom_point(size=<span class="number">3</span>,aes(colour=lg))+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>,limits=c(<span class="string">"NL"</span>,<span class="string">"AL"</span>))+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.y=element_blank(),</div><div class="line">        legend.position=c(<span class="number">1</span>,<span class="number">0.55</span>),</div><div class="line">        legend.justification=c(<span class="number">1</span>,<span class="number">0.5</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lH339B2F9b.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>注：order()函数的意思是，把原向量的元素按从小到大排列，输出原来向量的所在位置，而sort()则是把原向量的元素从小到大排列，输出元素值。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a&lt;-c(<span class="number">3</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">19</span>)</div><div class="line">sort(a) <span class="comment"># sort(); 输出排序后的结果</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  0  3  9 12 19</span></div><div class="line"></div><div class="line">order(a) <span class="comment"># 输出排序后的各个向量位置</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3 1 2 4 5</span></div><div class="line"></div><div class="line"><span class="comment"># 3表示原向量中第3个元素排在第1位，1的意思是原向量中第1个排在第2位，</span></div></pre></td></tr></table></figure>
<h3 id="以队为分组变量进行分面">以队为分组变量进行分面</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=avg,y=name))+</div><div class="line">  geom_segment(aes(yend=name),xend=<span class="number">0</span>,colour=<span class="string">"grey50"</span>)+</div><div class="line">  geom_point(size=<span class="number">3</span>,aes(colour=lg))+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>,limits=c(<span class="string">"NL"</span>,<span class="string">"AL"</span>),guide=<span class="literal">FALSE</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.y=element_blank())+</div><div class="line">  facet_grid(lg~.,scales=<span class="string">"free_y"</span>,space=<span class="string">"free_y"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/hbf22CLj19.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/12/R/dplyr笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/12/R/dplyr笔记/" itemprop="url">R语言笔记之dplyr</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-12T12:00:00+08:00">
                2017-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,775
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装">安装</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"dplyr"</span>)</div><div class="line"><span class="keyword">library</span>(dplyr)</div></pre></td></tr></table></figure>
<h2 id="数据集">数据集</h2>
<p>现在使用<code>datasets</code>包中的<code>ChickWeight</code>数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(datasets)</div><div class="line">&gt; dim(ChickWeight)</div><div class="line">[<span class="number">1</span>] <span class="number">578</span>   <span class="number">4</span></div><div class="line">&gt; head(ChickWeight)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line">&gt; str(ChickWeight)</div><div class="line">Classes ‘nfnGroupedData’, ‘nfGroupedData’, ‘groupedData’ and <span class="string">'data.frame'</span>:	<span class="number">578</span> obs. of  <span class="number">4</span> variables:</div><div class="line"> $ weight: num  <span class="number">42</span> <span class="number">51</span> <span class="number">59</span> <span class="number">64</span> <span class="number">76</span> <span class="number">93</span> <span class="number">106</span> <span class="number">125</span> <span class="number">149</span> <span class="number">171</span> <span class="keyword">...</span></div><div class="line"> $ Time  : num  <span class="number">0</span> <span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">10</span> <span class="number">12</span> <span class="number">14</span> <span class="number">16</span> <span class="number">18</span> <span class="keyword">...</span></div><div class="line"> $ Chick : Ord.factor w/ <span class="number">50</span> levels <span class="string">"18"</span>&lt;<span class="string">"16"</span>&lt;<span class="string">"15"</span>&lt;..: <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="keyword">...</span></div><div class="line"> $ Diet  : Factor w/ <span class="number">4</span> levels <span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div><div class="line"> - attr(*, <span class="string">"formula"</span>)=Class <span class="string">'formula'</span>  language weight ~ Time | Chick</div><div class="line">  .. ..- attr(*, <span class="string">".Environment"</span>)=&lt;environment: R_EmptyEnv&gt; </div><div class="line"> - attr(*, <span class="string">"outer"</span>)=Class <span class="string">'formula'</span>  language ~Diet</div><div class="line">  .. ..- attr(*, <span class="string">".Environment"</span>)=&lt;environment: R_EmptyEnv&gt; </div><div class="line"> - attr(*, <span class="string">"labels"</span>)=List of <span class="number">2</span></div><div class="line">  ..$ x: chr <span class="string">"Time"</span></div><div class="line">  ..$ y: chr <span class="string">"Body weight"</span></div><div class="line"> - attr(*, <span class="string">"units"</span>)=List of <span class="number">2</span></div><div class="line">  ..$ x: chr <span class="string">"(days)"</span></div><div class="line">  ..$ y: chr <span class="string">"(gm)"</span></div></pre></td></tr></table></figure>
<p>从上面结果可以看出来，ChickWeight含有4个变量，分别为数值型变量weight，数值型变量Time，因子型变量Chick，因子型变量Diet。</p>
<h2 id="tibble数据类型">tibble数据类型</h2>
<p>tibble是R语言中一个用来替换data.frame类型的扩展的数据框，tibble继承了data.frame，是弱类型的，同时与data.frame有相同的语法，使用起来更方便。tibble对data.frame做了重新的设计：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">tibble，不关心输入类型，可存储任意类型，包括list类型</div><div class="line">tibble，没有行名设置 row.names</div><div class="line">tibble，支持任意的列名</div><div class="line">tibble，会自动添加列名</div><div class="line">tibble，类型只能回收长度为1的输入</div><div class="line">tibble，会懒加载参数，并按顺序运行</div><div class="line">tibble，是tbl_df类型</div></pre></td></tr></table></figure>
<p>这里再注明一下，tibble这个包是包含在tidyverse项目中的，tidyverse是一组处理与可视化R包的集合，其中包含以下的包：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ggplot2 - 可视化数据</div><div class="line">dplyr - 数据操作语法，可以用它解决大部分数据处理问题</div><div class="line">tidyr - 清理数据</div><div class="line">readr - 读入表格数据</div><div class="line">purrr - 提供一个完整一致的工具集增强R的函数编程</div><div class="line">tibble - 新一代数据框</div><div class="line">stringr - 提供函数集用来处理字符数据</div><div class="line">forcats - 提供有用工具用来处理因子问题</div><div class="line"></div><div class="line"><span class="comment"># 安装tidyverse：</span></div><div class="line">install.packages(<span class="string">"tidyverse"</span>)</div><div class="line"><span class="keyword">library</span>(tidyverse)</div></pre></td></tr></table></figure>
<h2 id="计数count">计数<code>count</code></h2>
<p>dplyr包中的count函数可以进行计数，用法为<code>count(x, ..., wt = NULL, sort = FALSE)</code>，其中<code>x</code>是目标数据集，<code>...</code>是数据集中的变量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; count(ChickWeight,Diet)</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet      n</div><div class="line">  &lt;fct&gt; &lt;int&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>       <span class="number">220</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>       <span class="number">120</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>       <span class="number">120</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>       <span class="number">118</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，输出的结果是一个tibble，其中它与data.frame不同的地方在于，它会在行名称的下面再加一行，就上面的结果而言，它添加了一行为<code>&lt;fct&gt;, &lt;int&gt;</code>的信息，指明了不同列的类型，其它的数据类型信息如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">int，代表integer</div><div class="line">dbl，代表double</div><div class="line">chr，代表character向量或字符串。</div><div class="line">dttm，代表日期+时间(a date + a time)</div><div class="line">lgl，代表逻辑判断<span class="literal">TRUE</span>或者<span class="literal">FALSE</span></div><div class="line">fctr，代表因子类型factor</div><div class="line">date，代表日期dates.</div></pre></td></tr></table></figure>
<h2 id="汇总summaryise">汇总<code>summaryise()</code></h2>
<p>summaryise()，用法为<code>summarise(.data, ...)</code>，其中<code>.data</code>是数据集，<code>...</code>是需要汇总的函数，用法如下所示</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; summarise(ChickWeight,mean(weight,na.rm=<span class="literal">TRUE</span>))</div><div class="line">  mean(weight, na.rm = <span class="literal">TRUE</span>)</div><div class="line"><span class="number">1</span>                   <span class="number">121.8183</span></div><div class="line">&gt; summarise(ChickWeight,mean(Time,na.rm=<span class="literal">TRUE</span>),min(weight))</div><div class="line">  mean(Time, na.rm = <span class="literal">TRUE</span>) min(weight)</div><div class="line"><span class="number">1</span>                 <span class="number">10.71799</span>          <span class="number">35</span></div></pre></td></tr></table></figure>
<h2 id="分组group_by">分组<code>group_by</code></h2>
<p><code>group_by</code>，用法为<code>group_by(.data, ..., add = FALSE)</code>，其中<code>.data</code>是数据集，<code>...</code>是分组对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; CW_g1 &lt;- group_by(ChickWeight,Diet)</div><div class="line">&gt; CW_g1</div><div class="line"><span class="comment"># A tibble: 578 x 4</span></div><div class="line"><span class="comment"># Groups:   Diet [4]</span></div><div class="line">   weight  Time Chick Diet </div><div class="line"> *  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;</div><div class="line"> <span class="number">1</span>     <span class="number">42</span>     <span class="number">0</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">2</span>     <span class="number">51</span>     <span class="number">2</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">3</span>     <span class="number">59</span>     <span class="number">4</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">4</span>     <span class="number">64</span>     <span class="number">6</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">5</span>     <span class="number">76</span>     <span class="number">8</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">6</span>     <span class="number">93</span>    <span class="number">10</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">7</span>    <span class="number">106</span>    <span class="number">12</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">8</span>    <span class="number">125</span>    <span class="number">14</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">9</span>    <span class="number">149</span>    <span class="number">16</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"><span class="number">10</span>    <span class="number">171</span>    <span class="number">18</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"><span class="comment"># ... with 568 more rows</span></div></pre></td></tr></table></figure>
<p>group_by可以和summarise连用，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; summarise(group_by(ChickWeight,Diet),mean(Time,na.rm=<span class="literal">TRUE</span>))</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet  `mean(Time, na.rm = TRUE)`</div><div class="line">  &lt;fct&gt;                      &lt;dbl&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>                           <span class="number">10.5</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>                           <span class="number">10.8</span></div></pre></td></tr></table></figure>
<h2 id="筛选filter">筛选<code>filter</code></h2>
<p><code>filter()</code>函数，用法为<code>filter(.data, ...)</code>。举例说明，如下所示：</p>
<p>挑选出weight大于等于40的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F1 &lt;- filter(ChickWeight,weight &gt;= <span class="number">40</span>)</div><div class="line">&gt; head(CW_F1)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>挑选出weight大于等于40，并且Time大于等于2的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F2&lt;- filter(ChickWeight,weight &gt;= <span class="number">40</span>,Time&gt;=<span class="number">2</span>)</div><div class="line">&gt; head(CW_F2)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>    <span class="number">106</span>   <span class="number">12</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>挑选出Diet为1的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F3&lt;- filter(ChickWeight,Diet==<span class="number">1</span>)</div><div class="line">&gt; head(CW_F3)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>操行出Diet为1或3的数据，此时需要使用<code>%in%</code>符号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CW_F4&lt;- filter(ChickWeight,Diet %<span class="keyword">in</span>% c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">CW_F4</div></pre></td></tr></table></figure>
<p>挑选出Chick为2，Diet为1的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F5&lt;- filter(ChickWeight,Diet==<span class="number">1</span>,Chick==<span class="number">2</span>)</div><div class="line">&gt; head(CW_F5)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">40</span>    <span class="number">0</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">49</span>    <span class="number">2</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">58</span>    <span class="number">4</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">72</span>    <span class="number">6</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">84</span>    <span class="number">8</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>    <span class="number">103</span>   <span class="number">10</span>     <span class="number">2</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="挑选满足条件的某一列select">挑选满足条件的某一列<code>select</code></h2>
<p>filter在使用时，它是将满足某一条件的整个数据集都给拿了出来，而select函数则是只将某一列拿出来，例如我们现在只将weight和Diet挑选出来，并与filter对比一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CW_s1&lt;-selet(ChickWeight,weight,Diet)</div></pre></td></tr></table></figure>
<p>排列某一列，只选择剩下的部分，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,-weight))</div><div class="line">  Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>除去某2列，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,-weight,-Diet))</div><div class="line">  Time Chick</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span></div></pre></td></tr></table></figure>
<p>选择从Time到Diet这之间的列，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,Time:Diet))</div><div class="line">  Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="添加mutate">添加<code>mutate</code></h2>
<p><code>mutate()</code>可以添加不同的列，现在我们在原始数据后面加上一列，名称是Diff，列的内容是该行weight值与weight均值之差，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_m1 &lt;- mutate(ChickWeight,Diff=(weight-mean(weight)))</div><div class="line">&gt; head(CW_m1)</div><div class="line">  weight Time Chick Diet      Diff</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">79.81834</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">70.81834</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">62.81834</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">57.81834</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">45.81834</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">28.81834</span></div></pre></td></tr></table></figure>
<h2 id="管道命令in">管道命令<code>%in%</code></h2>
<p><code>%in%</code>是dplyr的管道命令，可以将几个函数串联起来。看下面的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CW_p1 &lt;- ChickWeight%&gt;%</div><div class="line">  filter(Chick!=c(<span class="number">15</span>,<span class="number">18</span>,<span class="number">20</span>,<span class="number">17</span>))%&gt;%</div><div class="line">  group_by(Diet)%&gt;%</div><div class="line">  summarise(mean(Time,na.rm=<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; CW_p1 &lt;- ChickWeight%&gt;%</div><div class="line">+   filter(Chick!=c(<span class="number">15</span>,<span class="number">18</span>,<span class="number">20</span>,<span class="number">17</span>))%&gt;%</div><div class="line">+   group_by(Diet)%&gt;%</div><div class="line">+   summarise(mean(Time,na.rm=<span class="literal">TRUE</span>))</div><div class="line">Warning messages:</div><div class="line"><span class="number">1</span>: In is.na(e1) | is.na(e2) :</div><div class="line">  longer object length is not a multiple of shorter object length</div><div class="line"><span class="number">2</span>: In `!=.default`(Chick, c(<span class="number">15</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">17</span>)) :</div><div class="line">  longer object length is not a multiple of shorter object length</div><div class="line">&gt; CW_p1</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet  `mean(Time, na.rm = TRUE)`</div><div class="line">  &lt;fct&gt;                      &lt;dbl&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>                           <span class="number">10.5</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>                           <span class="number">10.8</span></div></pre></td></tr></table></figure>
<p>再看一案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CW_p2 &lt;- ChickWeight%&gt;%</div><div class="line">  filter(weight&gt;=<span class="number">50</span>,Diet!=<span class="number">1</span>)%&gt;%</div><div class="line">  mutate(DiffTime=(Time-mean(Time,na.rm=<span class="literal">TRUE</span>)))%&gt;%</div><div class="line">  select(Diet:DiffTime)</div><div class="line">head(CW_p2)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(CW_p2)</div><div class="line">  Diet    DiffTime</div><div class="line"><span class="number">1</span>    <span class="number">2</span> -<span class="number">10.2310127</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>  -<span class="number">8.2310127</span></div><div class="line"><span class="number">3</span>    <span class="number">2</span>  -<span class="number">6.2310127</span></div><div class="line"><span class="number">4</span>    <span class="number">2</span>  -<span class="number">4.2310127</span></div><div class="line"><span class="number">5</span>    <span class="number">2</span>  -<span class="number">2.2310127</span></div><div class="line"><span class="number">6</span>    <span class="number">2</span>  -<span class="number">0.2310127</span></div></pre></td></tr></table></figure>
<h2 id="排序arrange">排序<code>arrange</code></h2>
<p><code>arrange()</code>可以将数据集进行排序，用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(arrange(ChickWeight,desc(weight)))</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">373</span>   <span class="number">21</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">2</span>    <span class="number">361</span>   <span class="number">20</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">3</span>    <span class="number">341</span>   <span class="number">21</span>    <span class="number">34</span>    <span class="number">3</span></div><div class="line"><span class="number">4</span>    <span class="number">332</span>   <span class="number">18</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">5</span>    <span class="number">331</span>   <span class="number">21</span>    <span class="number">21</span>    <span class="number">2</span></div><div class="line"><span class="number">6</span>    <span class="number">327</span>   <span class="number">20</span>    <span class="number">34</span>    <span class="number">3</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://mp.weixin.qq.com/s?__biz=MzI3MTM3OTExNQ==&amp;mid=2247484766&amp;idx=1&amp;sn=dcc57331b24218554e0460805939dcb8&amp;chksm=eac3fa9addb4738ca192ef01d1b92cfd0f78cdd0475c13feadece8f9f6cad2ae083615c84d52&amp;mpshare=1&amp;scene=1&amp;srcid=1001zguL8UAOBMPnRamkpY1x#rd" target="_blank" rel="external">时光加速器－dplyr.李楠 克里克学苑</a></li>
<li><a href="http://blog.fens.me/r-tibble/" target="_blank" rel="external">R语言数据科学新类型tibble</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/10/R/数据的导入与导出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/R/数据的导入与导出/" itemprop="url">R语言笔记之数据的导入与导出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T12:00:00+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,445
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据的导入">数据的导入</h2>
<p>所用到的函数与包如下： read.table() read.csv() head() xlsx包 read.xlsx() RODBC包 odbcConnect() sqlQuery() sqlSave() RMySQL包 dbConnect() dbSentQuery() fetch()</p>
<h2 id="从csv文件导入"> 从csv文件导入</h2>
<p>此方法可以用以导入Excel数据，将Excel数据转化为csv格式。 CSV是（逗号分隔值）的英文缩写，通常都是纯文本文件。其打开格式为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mydataframe&lt;-read.table(file,header=logical_value,ep=<span class="string">"delimiter"</span>,row.names=<span class="string">"name"</span>)</div><div class="line">fiel:csv文件</div><div class="line">header:逻辑值，首先是否包括变量名</div><div class="line">sep:分隔符</div><div class="line">row.names:指定一个或多个表示行标识符的变量</div><div class="line">grades&lt;-read.table(<span class="string">"studentgrades.csv"</span>,header=<span class="literal">TRUE</span>,sep=<span class="string">","</span>,row.names=<span class="string">"STUDENTID"</span>)</div></pre></td></tr></table></figure>
<p>表示从当前目录中读取一个名为studentgrades.csv的逗号分隔文件，从文件的第一行取得变量名字，将STUDENTID指定为行标识符，整个结果保存到grades的数据框中。</p>
<h2 id="从剪切板导入"> 从剪切板导入</h2>
<p>通常情况下就是在Excel中复制，接着输入以下命令就可以导入数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt;- read.table(<span class="string">"clipboard"</span>, header = <span class="literal">T</span>, sep=<span class="string">"\t"</span>)</div></pre></td></tr></table></figure>
<h2 id="导入文本文件"> 导入文本文件</h2>
<p>一般采用read.table()函数和read.csv()函数实现文本文件数据的读取，对于这两个函数有几个重要的参数：</p>
<ol style="list-style-type: decimal">
<li>file指定外部文件的路径和文件名；</li>
<li>header指定是否将原数据的第一行最为字段名，read.table()函数默认设置为FALSE，而read.csv()函数默认设置为TRUE；</li>
<li>sep指定字段之间的分割符，read.table()函数默认设置为空格“”，而read.csv()函数默认设置为逗号；</li>
<li>除此，read.table()函数还可以设置读入数据集的行名、列名、字符串是否转换为因子、缺失值的形式等，详细可查看read.table()函数的帮助文档。</li>
</ol>
<p>我的电脑桌面中有两个文本文件，即iris.csv和iris.txt。文件打开如下图： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/i0ad21J31d.png?imageslim" alt="mark"></p>
<p>现在通过read.table()函数和read.csv()函数读取这两个文件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iris1 &lt;- read.table(file = <span class="string">'C:\\Users\\admin\\Desktop\\iris.txt'</span>, col.names = c(<span class="string">'x1'</span>,<span class="string">'x2'</span>,<span class="string">'x3'</span>,<span class="string">'x4'</span>,<span class="string">'y'</span>))</div><div class="line">head(iris1)</div></pre></td></tr></table></figure>
<p>备注：<code>read.csv</code>, <code>read.csv2</code>,<code>read.delim</code>这三个函数都是<code>read.table()</code>函数的特化。</p>
<h2 id="read.csv">read.csv()</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iris3 &lt;- read.csv(file = file.choose())</div><div class="line">head(iris3)</div></pre></td></tr></table></figure>
<h2 id="从scan导入数据"> 从scan导入数据</h2>
<p>主要用于键盘输入数据，详细使用方法：</p>
<h3 id="scan函数"> scan() 函数</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">scan(file = <span class="string">""</span>, what = double(<span class="number">0</span>), nmax = -<span class="number">1</span>, n = -<span class="number">1</span>, sep = <span class="string">""</span>,</div><div class="line">     quote = <span class="keyword">if</span>(identical(sep, <span class="string">"\n"</span>)) <span class="string">""</span> <span class="keyword">else</span> <span class="string">"'\""</span>, dec = <span class="string">"."</span>,</div><div class="line">     skip = <span class="number">0</span>, nlines = <span class="number">0</span>, na.strings = <span class="string">"NA"</span>,</div><div class="line">     flush = <span class="literal">FALSE</span>, fill = <span class="literal">FALSE</span>, strip.white = <span class="literal">FALSE</span>,</div><div class="line">     quiet = <span class="literal">FALSE</span>, blank.lines.skip = <span class="literal">TRUE</span>, multi.line = <span class="literal">TRUE</span>,</div><div class="line">     comment.char = <span class="string">""</span>, allowEscapes = <span class="literal">FALSE</span>, encoding = <span class="string">"unknown"</span>)</div></pre></td></tr></table></figure>
<p><strong>参数使用如下所示：</strong> 1. what:声明读入为字符类型数据，可能指定读入的精度/类型，例如：what=integer(0)；what=numeric(0)；what=character(0)； 如果SCAN()读入有字符与数字，用what=“”来进行声明，则会把读入的数字隐式的都转变成字符； 2. sep：指定各个读入的数据之间的分隔符；默认情况下分隔符：空格、tab；如果不是其它分隔符，例如“：/”通过SEP来指定； 3. 可以通过list指定读入变量的变量名，同时生成的对象为列表，则可以同时读入字符与数字； 4. Skip 从第几行开始读入数据； 5. Nlines 指定最大读入行数； 6. 如果通过键盘输入的时候，不希望出现下标提示，则可以使用：quiet=TRUE； 7. encoding =””指定的编码格式，有时候读入的中文可能会出现乱码的时候，可能通过这个参数来指定：Latin-1 或者 UTF-8</p>
<h2 id="使用表格输入数据"> 使用表格输入数据</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mydata&lt;-data.frame(age=numeric(<span class="number">0</span>),</div><div class="line">                   gender=character(<span class="number">0</span>),</div><div class="line">                   weight=numeric(<span class="number">0</span>))</div><div class="line">mydata&lt;-edit(mydata)</div></pre></td></tr></table></figure>
<p>创建一个名为mydata的数据框，含三个变量，age为数据型，gender为字符型，weight为数值型。edit调用文本编辑器，键入数据。其中numeric(0)创建一个指定模型但不含实际数据的变量。如果再次调用mydata&lt;-edit(mydata)能够用来修改数据，或者使用fix(mydata)也行。</p>
<h2 id="使用readxl包来读取excel文件">使用<code>readxl</code>包来读取excel文件</h2>
<p><code>readxl</code>包中的几个函数可以读取excel文件，主要有<code>read_excel</code>，<code>read_xls</code>，<code>read_xlsx</code>。其中各个函数的参数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">read_excel(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div><div class="line"></div><div class="line">read_xls(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div><div class="line"></div><div class="line">read_xlsx(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div></pre></td></tr></table></figure>
<p>参数意义如下所示：</p>
<table>
<colgroup>
<col width="17%">
<col width="82%">
</colgroup>
<thead>
<tr class="header">
<th align="right">参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">path</td>
<td>xls/xlsx文件的路径</td>
</tr>
<tr class="even">
<td align="right">sheet</td>
<td>Excel文件中Sheet的参数，可以是一个字符串，也就是sheet的名称，可以是一个整数，它表示sheet的位置。如果不输入这个参数，默认输入第1个sheet的数据。</td>
</tr>
<tr class="odd">
<td align="right">range</td>
<td>sheet中单元格的范围，例如可以输入<code>range=B2:G14</code>。也可以指定某个sheet，例如<code>range=&quot;mtcars!B1:D5&quot;</code>。</td>
</tr>
<tr class="even">
<td align="right">col_names</td>
<td><code>TRUE</code> 使用第一行作为行名， <code>FALSE</code> 使用默认的名字，或者是使用一个字符串或字符串向量来表示第一行的名称。</td>
</tr>
<tr class="odd">
<td align="right">col_types</td>
<td>Either <code>NULL</code> to guess all from the spreadsheet or a character vector containing one entry per column from these options: “skip”, “guess”, “logical”, “numeric”, “date”, “text” or “list”. If exactly one <code>col_type</code> is specified, it will be recycled. The content of a cell in a skipped column is never read and that column will not appear in the data frame output. A list cell loads a column as a list of length 1 vectors, which are typed using the type guessing logic from <code>col_types = NULL</code>, but on a cell-by-cell basis.</td>
</tr>
<tr class="even">
<td align="right">na</td>
<td>Character vector of strings to interpret as missing values. By default, readxl treats blank cells as missing data.</td>
</tr>
<tr class="odd">
<td align="right">trim_ws</td>
<td>Should leading and trailing whitespace be trimmed?</td>
</tr>
<tr class="even">
<td align="right">skip</td>
<td>Minimum number of rows to skip before reading anything, be it column names or data. Leading empty rows are automatically skipped, so this is a lower bound. Ignored if <code>range</code> is given.</td>
</tr>
<tr class="odd">
<td align="right">n_max</td>
<td>Maximum number of data rows to read. Trailing empty rows are automatically skipped, so this is an upper bound on the number of rows in the returned tibble. Ignored if <code>range</code> is given.</td>
</tr>
<tr class="even">
<td align="right">guess_max</td>
<td>Maximum number of data rows to use for guessing column types.</td>
</tr>
<tr class="odd">
<td align="right">progress</td>
<td>Display a progress spinner? By default, the spinner appears only in an interactive session, outside the context of knitting a document, and when the call is likely to run for several seconds or more. See <code>readxl_progress()</code> for more details.</td>
</tr>
<tr class="even">
<td align="right">.name_repair</td>
<td>Handling of column names. By default, readxl ensures column names are not empty and are unique. If the tibble package version is recent enough, there is full support for <code>.name_repair</code> as documented in <code>tibble::tibble()</code>. If an older version of tibble is present, readxl falls back to name repair in the style of tibble v1.4.2.</td>
</tr>
</tbody>
</table>
<p>具体的可以参考<a href="https://readxl.tidyverse.org/reference/read_excel.html" target="_blank" rel="external">readxl资料</a>。</p>
<h2 id="批量读取数据">批量读取数据</h2>
<p>读取N个Excel文件，并将这N个Excel文件进行合并，分为四种情况，代码如下所示，其中read_excel函数所在的包为readxl。</p>
<p>解决方案如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data1'</span>) </div><div class="line"><span class="comment"># 设置R的工作空间</span></div><div class="line"><span class="comment">#res &lt;- NULL</span></div><div class="line"></div><div class="line">data1 &lt;- data.frame()</div><div class="line"><span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">4</span>)&#123;</div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,<span class="string">'test'</span>,i,<span class="string">'.xlsx'</span>)   <span class="comment"># 构造数据路径</span></div><div class="line">res &lt;- c(res,path)</div><div class="line">data1 &lt;- rbind(data1,read_excel(path = path))   <span class="comment"># 读取并合并数据</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件没有规律的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data2'</span>)  <span class="comment"># 设置工作空间</span></div><div class="line">filenames &lt;- dir()   <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line">data2 &lt;- data.frame()   <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> filenames)&#123;</div><div class="line"><span class="comment"># 构造数据路径</span></div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"><span class="comment">#res &lt;- c(res,path)</span></div><div class="line"><span class="comment"># 读取并合并数据</span></div><div class="line">data2 &lt;- rbind(data2,read_excel(path = path))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件名没有规律的情况，并且只读取某做后缀的文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加载第三方扩展包，用于编写SQL语句</span></div><div class="line"> <span class="keyword">library</span>(sqldf)</div><div class="line"> <span class="comment"># 设置工作空间</span></div><div class="line"> setwd(<span class="string">'D:\\data file\\data4'</span>)</div><div class="line"> <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line"> filenames &lt;- dir()</div><div class="line"> <span class="comment"># 通过正则，获取所有xlsx结尾的文件名</span></div><div class="line"> filenames2 &lt;- grep(<span class="string">'\\.xlsx'</span>, filenames, value = <span class="literal">TRUE</span>)</div><div class="line"> <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"> data4 &lt;- data.frame()</div><div class="line"> <span class="comment">#通过循环完成数据合并</span></div><div class="line"> <span class="keyword">for</span> (i <span class="keyword">in</span> filenames2)&#123;</div><div class="line"> <span class="comment"># 构造数据路径</span></div><div class="line"> path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"> <span class="comment">#res &lt;- c(res,path)</span></div><div class="line"> <span class="comment"># 使用read_excel函数读取xlsx文件</span></div><div class="line"> data &lt;- read_excel(path = path)</div><div class="line"> <span class="comment"># 使用sqldf函数编写SQL语句，并把结果合并起来</span></div><div class="line"> data4 &lt;- rbind(data4, sqldf(<span class="string">"select id,name,gender,age from data"</span>))</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="导出数据"> 导出数据</h2>
<h3 id="导出的路径"> 导出的路径</h3>
<p>为了避免在导出路径中使用转义字符，可以使用file.path()函数来构建正确的路径，这个函数的工作原理类似于paste()，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.path(<span class="string">"d:"</span>,<span class="string">"download"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"d:/download"</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p> file.path(“d:”,“download”) [1] “d:/download”</p>
</blockquote>
<h3 id="导出为txt格式"> 导出为txt格式</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> a</div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">5</span>  <span class="number">4</span></div><div class="line">&gt; b</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="literal">NA</span>  <span class="string">"4"</span></div><div class="line"> c &lt;- data.frame(a,b)</div><div class="line"> c</div><div class="line">   a    b</div><div class="line"><span class="number">1</span>  <span class="number">1</span>    a</div><div class="line"><span class="number">2</span>  <span class="number">2</span>    b</div><div class="line"><span class="number">3</span>  <span class="number">4</span>    c</div><div class="line"><span class="number">4</span> <span class="literal">NA</span>    d</div><div class="line"><span class="number">5</span>  <span class="number">5</span> &lt;<span class="literal">NA</span>&gt;</div><div class="line"><span class="number">6</span>  <span class="number">4</span>    <span class="number">4</span></div><div class="line"> write.table(c,file = <span class="string">"c:\\data.txt"</span>,sep = <span class="string">","</span>,quote = <span class="literal">FALSE</span>, append = <span class="literal">FALSE</span>, na = <span class="string">"NA"</span>)</div></pre></td></tr></table></figure>
<p>c为导出的数据，file为导出的路径，sep = “,”表示用逗号隔开数据，quote = FALSE表示消除字符串的引号标志，append = FALSE打开一个新文件，如果为TRUE则表示将此数据追加到已经存在的文件中，na=”NA”表示用NA来代表na值。</p>
<h2 id="读取错误">读取错误</h2>
<p>R语言读取Excel文件有时会出错，如果要读取某些Excel表格文件，操作如下所示：</p>
<ol style="list-style-type: decimal">
<li>用鼠标选中据，然后Ctrl+C复制；</li>
<li>在Rstudio中输入：read.table(“clipboard”,header=T)-&gt;x1，显示以下结果：</li>
</ol>
<blockquote>
<p>Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :    line 2 did not have 8 elements</p>
</blockquote>
<p>大概意思是，有两行数据的元素不满足8个（即第No.2不满足8个元素），无法读取，因此需要改变一下代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x &lt;- read.table(<span class="string">"clipboard"</span>,sep=<span class="string">"\t"</span>,header=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<p> 这样就能正常读取了，因为Excel的文件中，每个单元格就是以制表符将它们分开的，而sep=“”的意思就是，读取数据的时候，以制表符进行分割来读取。</p>
<h2 id="r语言与目录操作">R语言与目录操作</h2>
<h3 id="设置目录file.path">设置目录<code>file.path()</code></h3>
<p>在R中，目录的表达方法与Windows有所不同，在Windows中，如果要表示D盘下的某个目录，就是<code>D:\biotest</code>，用的是<code>\</code>，而在R中，则是<code>/</code>或<code>\\</code>，即<code>D:/biotest</code>或<code>D:\\biotest</code>。为了避免在R中使用转义字符，可以使用<code>file.path()</code>函数来构建正确的路径。这个函数类似于<code>paste()</code>，会将传入的各个参数拼接在一起，与操作系统的设置无关，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div></pre></td></tr></table></figure>
<p>使用<code>file.path()</code>来设置工作目录非常方便，可以逐一指定目录，它会将各个目录连接起来，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/"</span></div><div class="line">&gt; setwd(file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>))</div><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div></pre></td></tr></table></figure>
<h3 id="操作文件dir或list.files">操作文件<code>dir()</code>或<code>list.files()</code></h3>
<p>有的时候，在R中如果要遍历某个指定目录下的所有文件和文件夹，并对它们进行某种操作，如果要获得指定目录下的文件列表，可以使用<code>list.files()</code>或<code>dir()</code>函数，这两个函数的功能是一样的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div><div class="line">&gt; list.files()</div><div class="line"> [<span class="number">1</span>] <span class="string">"kegg"</span>                                          </div><div class="line"> [<span class="number">2</span>] <span class="string">"Miniconda2-latest-Linux-x86_64.sh"</span>             </div><div class="line"> [<span class="number">3</span>] <span class="string">"NGS 数据过滤之 Trimmomatic 详细说明 - 简书.pdf"</span></div><div class="line"> [<span class="number">4</span>] <span class="string">"nohup.out"</span>                                     </div><div class="line"> [<span class="number">5</span>] <span class="string">"paper and manual"</span>                              </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span>                                      </div><div class="line">&gt; dir()</div><div class="line"> [<span class="number">1</span>] <span class="string">"kegg"</span>                                          </div><div class="line"> [<span class="number">2</span>] <span class="string">"Miniconda2-latest-Linux-x86_64.sh"</span>             </div><div class="line"> [<span class="number">3</span>] <span class="string">"NGS 数据过滤之 Trimmomatic 详细说明 - 简书.pdf"</span></div><div class="line"> [<span class="number">4</span>] <span class="string">"nohup.out"</span>                                     </div><div class="line"> [<span class="number">5</span>] <span class="string">"paper and manual"</span>                              </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>也可以查看某个特定文件夹的内容：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; dir(file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>,<span class="string">"kegg"</span>))</div><div class="line"> [<span class="number">1</span>] <span class="string">"eco00640.eco.kegg.png"</span>                       </div><div class="line"> [<span class="number">2</span>] <span class="string">"eco00640.png"</span>                                </div><div class="line"> [<span class="number">3</span>] <span class="string">"eco00640.xml"</span>                                </div><div class="line"> [<span class="number">4</span>] <span class="string">"hsa00640.gene.ensprot.cpd.cas.png"</span>           </div><div class="line"> [<span class="number">5</span>] <span class="string">"hsa00640.gene.entrez.cpd.kc.png"</span>      </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<h3 id="文件操作函数汇总">文件操作函数汇总</h3>
<p>常用的几个操作文件以及目录的函数，如下所示：</p>
<table style="width:100%;">
<colgroup>
<col width="18%">
<col width="81%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>list.files</code></td>
<td>列出某个目录下的所有文件</td>
</tr>
<tr class="even">
<td><code>list.dirs</code></td>
<td>列出某个目录下的所有子目录</td>
</tr>
<tr class="odd">
<td><code>file.exists</code></td>
<td>检查某个特定的文件是否存在于某个目录下</td>
</tr>
<tr class="even">
<td><code>file.create</code></td>
<td>创建一个文件</td>
</tr>
<tr class="odd">
<td><code>file.remove</code></td>
<td>删除文件</td>
</tr>
<tr class="even">
<td><code>tempfile</code></td>
<td>返回一个临时文件的名称，例如想要在临时文件夹中创建一个文件，就可以将这个函数的返回值传入<code>file.create()</code>或<code>write.table()</code>函数中</td>
</tr>
<tr class="odd">
<td><code>tempdir</code></td>
<td>返回文件系统中临时文件目录的路径。</td>
</tr>
</tbody>
</table>
<h3 id="文件操作案例">文件操作案例</h3>
<p>现在创建一个临时文件，并将<code>iris</code>数据框传入其中，然后为了测试数据是否已经写入，再读取这个文件，并将结果保存到一个变量中，然后检查这个变量，最后将这个临时文件删除。</p>
<p>第一步，使用<code>tempfile()</code>函数得到一个字符串，它表示系统临时目录中的一个临时文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my.file &lt;- tempfile()</div><div class="line">my.file</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; my.file &lt;- tempfile()</div><div class="line">&gt; my.file</div><div class="line">[<span class="number">1</span>] <span class="string">"C:\\Users\\Public\\Documents\\Wondershare\\CreatorTemp\\RtmpCWS6Kb\\file26fc52842c9e"</span></div></pre></td></tr></table></figure>
<p>结果返回的是一个字符串，而不是文件，其实文件并不存在，现在通过<code>write.csv</code>将<code>iris</code>写入到<code>my.file</code>，然后使用<code>list.files()</code>来查看R创建的文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">write.csv(iris,file=my.file)</div><div class="line">list.files(tempdir())</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; write.csv(iris,file=my.file)</div><div class="line">&gt; list.files(tempdir())</div><div class="line">[<span class="number">1</span>] <span class="string">"file26fc25291904"</span>                                </div><div class="line">[<span class="number">2</span>] <span class="string">"file26fc52842c9e"</span>                                </div><div class="line">[<span class="number">3</span>] <span class="string">"libloc_185_b6156d26.rds"</span>                         </div><div class="line">[<span class="number">4</span>] <span class="string">"libloc_196_12ea9df4.rds"</span>                         </div><div class="line">[<span class="number">5</span>] <span class="string">"rs-graphics-c18658be-c44b-4ca8-b450-15a567601981"</span></div></pre></td></tr></table></figure>
<p>其中，<code>file26fc52842c9e</code>是临时文件，使用<code>read.csv</code>将文件导入到一个名为<code>file.iris</code>的变量中，并使用<code>str()</code>查看，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.iris &lt;- read.csv(my.file)</div><div class="line">str(file.iris)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; file.iris &lt;- read.csv(my.file)</div><div class="line">&gt; str(file.iris)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">150</span> obs. of  <span class="number">6</span> variables:</div><div class="line"> $ X           : int  <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Length: num  <span class="number">5.1</span> <span class="number">4.9</span> <span class="number">4.7</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">5.4</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">4.4</span> <span class="number">4.9</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Width : num  <span class="number">3.5</span> <span class="number">3</span> <span class="number">3.2</span> <span class="number">3.1</span> <span class="number">3.6</span> <span class="number">3.9</span> <span class="number">3.4</span> <span class="number">3.4</span> <span class="number">2.9</span> <span class="number">3.1</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Length: num  <span class="number">1.4</span> <span class="number">1.4</span> <span class="number">1.3</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.7</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Width : num  <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.4</span> <span class="number">0.3</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.1</span> <span class="keyword">...</span></div><div class="line"> $ Species     : Factor w/ <span class="number">3</span> levels <span class="string">"setosa"</span>,<span class="string">"versicolor"</span>,..: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>最后为了恢复文件系统原来的状态，使用<code>file.remove()</code>删除这个临时文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.remove(my.file)</div><div class="line">list.files(tempdir())</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; list.files(tempdir())</div><div class="line">[<span class="number">1</span>] <span class="string">"file26fc25291904"</span>                                </div><div class="line">[<span class="number">2</span>] <span class="string">"libloc_185_b6156d26.rds"</span>                         </div><div class="line">[<span class="number">3</span>] <span class="string">"libloc_196_12ea9df4.rds"</span>                         </div><div class="line">[<span class="number">4</span>] <span class="string">"rs-graphics-c18658be-c44b-4ca8-b450-15a567601981"</span></div></pre></td></tr></table></figure>
<p><code>file26fc52842c9e</code>这个文件已经被删除了。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/10/R/R语言笔记之循环语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/R/R语言笔记之循环语句/" itemprop="url">R语言笔记之循环语句</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T12:00:00+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,133
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="if语句">if语句</h2>
<p>用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件) 表达式</div><div class="line"><span class="keyword">if</span>(条件) 表达式<span class="number">1</span> <span class="keyword">else</span> 表达式<span class="number">2</span></div></pre></td></tr></table></figure>
<p>其中<code>if</code>语句具体就是包含下面3个元素：</p>
<ol style="list-style-type: decimal">
<li>关键字<code>if</code>；</li>
<li>条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE；</li>
<li>执行语句，也就是上面提到的<code>表达式</code>。</li>
</ol>
<h3 id="if语句案例1-简单案例"><code>if</code>语句案例1-简单案例</h3>
<p>先看一个简单的案例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line"><span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line"><span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line">+     <span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">+         print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line">+     <span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">+ &#125;</div><div class="line">[<span class="number">1</span>] <span class="string">"p&lt;=0.05!"</span></div></pre></td></tr></table></figure>
<h3 id="if语句案例2-函数体中添加if语句"><code>if</code>语句案例2-函数体中添加if语句</h3>
<p>现在编写一个函数,命名为<code>priceCalulator()</code>，这个函数的功能在于按照服务时长计算应该收取的费用，函数接收2个参数，分别是服务时长（hours）与每小时的单价(pph)，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在如果我们还要添加一个功能，例如有一批大客户，如果他们的服务需求时间长高于100小时，就打9折，也就是说，如果hours大于100，最后的总价乘以0.9，代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>)&#123;</div><div class="line">    net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  &#125;</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours = <span class="number">55</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2200</span></div><div class="line">&gt; priceCalculator(hours = <span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">3960</span></div></pre></td></tr></table></figure>
<h3 id="if语句的省略形式"><code>if</code>语句的省略形式</h3>
<p>如果if语句的条件只有一行的话，那么就可以省略两旁的大括号，例如前面的服务计费案例可以改为如下形式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div></pre></td></tr></table></figure>
<p>完整的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ifelse语句"><code>ifelse</code>语句</h2>
<p><code>if...else</code>是<code>if</code>条件语句的扩展，它的用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件语句<span class="number">1</span>)&#123;</div><div class="line">    表达式<span class="number">1</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;表达式<span class="number">2</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<p>其中，当<code>条件语句1</code>为<code>TRUE</code>时，执行<code>表达式1</code>，当<code>条件语句1</code>为<code>FALSE</code>时，执行<code>表达式2</code>。</p>
<p>还以前面的<code>if</code>语句中的服务费用案例继续说明一下，在一些国家，针对不同类型的客户（公共组织或私有组织），除了就会的服务费外，还会收取不同的税(VAT)，假设公共组织需要支付6%的VAT，而私有组织需要支付12%的VAT，此时可以在<code>priceCalculator()</code>函数中添加一个新的参数<code>public</code>，用于判断组织是否是公共组织，现在代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例如同样工作25时，对于公共和私有组织客户的收费是不一样的，计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">TRUE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">FALSE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程就使用到了<code>if...else...</code>语句，如果参数<code>public</code>的值为<code>TRUE</code>，那么税后价是总价乘以1.06，否则要乘以1.12。</p>
<p>对于<code>if...else...</code>语句的表达式而言，如果只有一行代码，可以省略大括号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(public) tot.price &lt;- net.price * <span class="number">1.06</span> <span class="keyword">else</span></div><div class="line">  tot.price &lt;- net.price * <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>其中<code>else</code>要放到行末，不能放到下一行的行首，这是因为只要一个命令明显没有结束，R会自动读取多行代码，将它们合成一行，如果<code>else</code>没有放在行末，那么R会认为第一行代码已经结束，从而在执行下一行代码时报错，只有当条件表达式出现在函数中，并且一次性地Source整个脚本文件时，else才能出现在行首。</p>
<p><code>if...else...</code>还能继续简化，我们可以把<code>if</code>理解为一个函数，它的计算结果是<code>TRUE</code>或<code>FALSE</code>，因此可以把if表达式赋予一个对象，或者直接用到计算中，这里可以省略重新计算<code>net.price</code>的过程，直接将结果赋给tot.price`，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot.price &lt;- net.price * <span class="keyword">if</span>(public) <span class="number">1.06</span> <span class="keyword">else</span> <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>如果这么写，R会先执行<code>if...else</code>表达式，得到结果后，再乘以<code>net.price</code>，然后将结果赋给<code>tot.price</code>。</p>
<h2 id="判断选择的向量化">判断选择的向量化</h2>
<p>还以上面的<code>priceCalculator()</code>函数为例说明一下，这个函数的参数是一个数，而非一个向量，如果要计算一个向量就会出现警告信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span></div><div class="line">Warning message:</div><div class="line">In <span class="keyword">if</span> (hours &gt; <span class="number">100</span>) net.price &lt;- net.price * <span class="number">0.9</span> :</div><div class="line">  the condition has length &gt; <span class="number">1</span> and only the first element will be used</div></pre></td></tr></table></figure>
<p>从警告信息可以看出，R会告诉我们丢失了一些信息，并且反映出了整个计算结果就是错误的，因此第二个客户的最终结果应该是4198，而非4664，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4198</span></div></pre></td></tr></table></figure>
<p>这是因为警告信息中提示，<code>if</code>表达式只能处理单个值，而<code>hours &gt; 100</code>返回的是两个值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; c (<span class="number">25</span>, <span class="number">110</span>) &gt; <span class="number">100</span></div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<h2 id="ifelse函数"><code>ifelse()</code>函数</h2>
<p>如果使用<code>ifelse()</code>函数就能解决上面提到的问题，<code>ifelse()</code>函数接收3个参数：</p>
<ol style="list-style-type: decimal">
<li>包含逻辑值的条件向量；</li>
<li>包含返回值的向量，它仅在对应条件向量值为TRUE时才被返回；</li>
<li>另外一个包含返回值的向量，它仅在对应条件向量为FALSE时才被返回。</li>
</ol>
<h3 id="ifelse案例1-简单案例"><code>ifelse</code>案例1-简单案例</h3>
<p>先看一个简单的<code>ifelse</code>案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(c(<span class="number">1</span>,<span class="number">3</span>) &lt; <span class="number">2.5</span>, <span class="number">1</span>:<span class="number">2</span>, <span class="number">3</span>:<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>这行语句的运行过程为：</p>
<ol style="list-style-type: decimal">
<li>条件表达式<code>c(1,3) &lt; 2.5</code>被解析成一个逻辑向量，计算结果为<code>[1]  TRUE FALSE</code>；</li>
<li>这个逻辑向量的第一个值为<code>TRUE</code>，因此1确实小于2.5，所以结果向量的第1个元素为第2个参数的第1个元素，也就是1；</li>
<li>条件向量的第2个值为<code>FALSE</code>，因为3比2.5大，所以<code>ifelse()</code>函数将取第3个参数的第2个值（也就是4）作为结果向量的第2个元素。</li>
<li>把选出的值合成一个向量作为结果返回。</li>
</ol>
<p>再来看一个简单的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">ifelse(x != <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) </div><div class="line"><span class="comment"># 若果x的值不等于1，输出1，否则输出0</span></div><div class="line"><span class="comment"># [1] 0 0 0 1 1 0 0</span></div></pre></td></tr></table></figure>
<p>现在我们更改<code>priceCalculator()</code>函数，假设有2个客户，服务时长分别为25小时和110小时，那么就可以采用下面的代码完成计算：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; my.hours &lt;- c(<span class="number">25</span>, <span class="number">110</span>)</div><div class="line">&gt; my.hours*<span class="number">40</span>*ifelse(my.hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">3960</span></div></pre></td></tr></table></figure>
<p>在上面的代码中，<code>ifelse()</code>函数会计算<code>my.hours &gt; 100</code>的结果，分别是<code>FALSE</code>和<code>TRUE</code>，其中，25对应的是<code>FALSE</code>，那么结果就是<code>my.hour*40*1</code>，110对应的是<code>TRUE</code>，结果就是<code>my.hour*40*0.9</code>。</p>
<p>现在继续改造<code>priceCalculator()</code>函数，例之成为真正能处理向量的函数，此时需要改造<code>public</code>参数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  net.price &lt;- net.price * ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price * ifelse(public, <span class="number">1.06</span>, <span class="number">1.12</span>)</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>, <span class="literal">FALSE</span>, <span class="literal">FALSE</span>)</div><div class="line">)</div><div class="line"></div><div class="line">with(clients, priceCalculator(hours, public = public))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; with(clients, priceCalculator(hours, public = public))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4198</span> <span class="number">5040</span> <span class="number">1792</span></div></pre></td></tr></table></figure>
<h3 id="ifelse案例2-在函数中添加ifelse">ifelse案例2-在函数中添加<code>ifelse</code></h3>
<p>看一个案例，有两个向量，分别为x和y，它们是时间序列，例如它们是每小时收集的气温和气压测量值，我们定义两者的相关性为x和y同时上升或下降次数占总观测数的比例（其实就是Kendall’s tau方法），也就是计算<code>y[i+1]-y[i]1</code>与<code>x[i+1]-x[i]</code>符号相同时的次数占总数<code>i</code>的比例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findud &lt;- <span class="keyword">function</span>(v)&#123;</div><div class="line">  vud &lt;- v[-<span class="number">1</span>]-v[-length(v)]</div><div class="line">  <span class="keyword">return</span>(ifelse(vud &gt; <span class="number">0</span>, <span class="number">1</span>,-<span class="number">1</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  ud &lt;- lapply(list(x,y),findud)</div><div class="line">  <span class="keyword">return</span>(mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">5</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">88</span>)</div><div class="line">&gt; y &lt;- c(<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">23</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">&gt; udcorr(x,y)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div></pre></td></tr></table></figure>
<p>在这个案例中，x和y在10次中同时上升3次（第一次同时上升是12到13，2到3），并同时下降1次，得到的相关性估计为4/10=0.4。</p>
<p>这个函数的思路就是先把x和y的值编码为1和-1，其中1代表当前观测值较前一个增加，-1表示减少，这个转换过程就是通过<code>vud &lt;- v[-1]-v[-length(v)]</code>这行代码实现的，它具体是怎么实现的呢，以向量x为例说明一下，看下面的示意图就行了：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，<code>x[-1]-x[-11]</code>表示的就是第2个元素减去第1个元素，第3个元素减去第2个元素等等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; x[-<span class="number">1</span>]-x[-<span class="number">11</span>]</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p><code>return(ifelse(vud &gt; 0, 1,-1))</code>这个语句就是把上面的向量再转换为1与-1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(x[-<span class="number">1</span>]-x[-<span class="number">11</span>] &gt;<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>)</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>接着又构建了一个<code>udcorr</code>这个函数。其中<code>ud &lt;- lapply(list(x,y),findud)</code>这行的功能就是，使用<code>lapply()</code>函数对xy构成的这个列表使用findud函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; list(x,y)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">4</span>  <span class="number">2</span>  <span class="number">3</span> <span class="number">23</span>  <span class="number">6</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span>  <span class="number">6</span>  <span class="number">3</span>  <span class="number">2</span></div><div class="line"></div><div class="line">&gt; lapply(list(x,y),findud)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span></div></pre></td></tr></table></figure>
<p>最后使用<code>return(mean(ud[[1]] == ud[[2]]))</code>这行代码来计算里面的均数，因为<code>ud[[1]] == ud[[2]]</code>的结果是一个逻辑向量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div></pre></td></tr></table></figure>
<p>对于逻辑向量来说，TRUE就是1，FALSE就是0，因此计算这个向量的均值就是计算TRUE占总向量数目的比例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]])</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div><div class="line"></div><div class="line"><span class="comment"># 逻辑向量也能使用数学函数，如下所示，TRUE就是1</span></div><div class="line">&gt; sum(c(<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div></pre></td></tr></table></figure>
<p>但是在R中，上面的代码可以用<code>diff()</code>这个函数来进行计算，这个函数可以对向量做“滞后”运算，这个运算的效果如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，这个滞后运算其实就是后一个数减去前一个数。与滞后运算相匹配的函数是<code>sign()</code>函数，它可以将正值与负值转换为1，-1或0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div><div class="line">&gt; sign(diff(x))</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>因此，我们可以把<code>undcorr()</code>函数换一种方式写，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  mean(sign(diff(x))==sign(diff(y)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ifelse案例3-转换某个字符串"><code>ifelse</code>案例3-转换某个字符串</h3>
<p><code>ifelse()</code>可以嵌套使用，看一个案例，<code>g</code>是一个鲍鱼的数据集，性别被编号为M、F或I（I是指Infant，幼虫的意思），现在我们将这些编号转换为1、2或3，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; g &lt;- c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>,<span class="string">"M"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; g</div><div class="line">[<span class="number">1</span>] <span class="string">"M"</span> <span class="string">"F"</span> <span class="string">"F"</span> <span class="string">"I"</span> <span class="string">"M"</span> <span class="string">"M"</span> <span class="string">"F"</span></div><div class="line">&gt; ifelse(g == <span class="string">"M"</span>,<span class="number">1</span>,ifelse(g == <span class="string">"F"</span>,<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程是这个样子的：</p>
<ol style="list-style-type: decimal">
<li>R先执行外层的<code>ifelse()</code>，其中当<code>g==&quot;M&quot;</code>时，返回1；否则就返回<code>ifelse(g == &quot;F&quot;,2,3)</code>；</li>
<li>当返回的是<code>ifelse(g == &quot;F&quot;,2,3)</code>，这是一个表达式，还能计算，那么如果<code>g==&quot;F&quot;</code>，就返回2，否则返回3。</li>
</ol>
<p>如果希望按照性别形成子集，那么可以使用<code>which()</code>函数寻找M、F或I对应元素的编号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; m &lt;- which(g == <span class="string">"M"</span>)</div><div class="line">&gt; f &lt;- which(g == <span class="string">"F"</span>)</div><div class="line">&gt; i &lt;- which(g == <span class="string">"I"</span>)</div><div class="line">&gt; m</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">&gt; f</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">&gt; i</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>如果想把这些子集保存在一个列表中，可以按下面的代码操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">grps &lt;- list()</div><div class="line"><span class="keyword">for</span> (gen <span class="keyword">in</span> c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>))&#123;</div><div class="line">  grps[[gen]] &lt;- which(g == gen)</div><div class="line">&#125;</div><div class="line">grps</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; grps</div><div class="line">$M</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">$<span class="literal">F</span></div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">$I</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<h3 id="嵌套if...else...表达式">嵌套<code>if...else...</code>表达式</h3>
<p>有的时候需要处理大于2种的选择，此时就需要使用嵌套<code>if...else...</code>嵌套语句，例如还以前面的<code>priceCalculator()</code>函数为例说明一下，客户假设说有3种，私有组织，税率为12%，公共组织税率为6%，国外客户为0%，现在改造<code>priceCalculator()</code>函数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(client ==<span class="string">'private'</span>)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">if</span>(client == <span class="string">'public'</span>)&#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2240</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2120</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2000</span></div></pre></td></tr></table></figure>
<p>虽然代码已经进行了改造，可以根据不同的客户类型计算不同的收费，但是此时这个函数还只一次只能处理一个值，无法进行向量化逻辑嵌套，对此，可以使用<code>ifelse()</code>函数进行嵌套，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- ifelse(client ==<span class="string">'private'</span>, <span class="number">1.12</span>, </div><div class="line">                ifelse(client==<span class="string">'public'</span>, <span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">privateData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>)</div><div class="line">)</div><div class="line">with(privateData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">publicData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">)</div><div class="line">with(publicData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">abroadData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(abroadData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">mixData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(mixData, priceCalculator(hours, client = type))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; with(privateData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4928</span> <span class="number">5600</span> <span class="number">1792</span></div><div class="line">&gt; </div><div class="line">&gt; publicData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(publicData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span> <span class="number">5300</span> <span class="number">1696</span></div><div class="line">&gt; </div><div class="line">&gt; abroadData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(abroadData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">4400</span> <span class="number">5000</span> <span class="number">1600</span></div><div class="line">&gt; </div><div class="line">&gt; mixData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(mixData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4664</span> <span class="number">5000</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="switch处理多种选择"><code>switch</code>处理多种选择</h2>
<p><code>if...else...</code>嵌套语句适用于多种条件的判断，假如判断的条件只有1个就不需要使用<code>if</code>嵌套，使用<code>switch()</code>函数即可。</p>
<p>在前面的<code>priceCalculator()</code>函数的案例中，税率实际上取决于客户的类型，即公共组织、私有组织或者外国客户，我们有3种可能，每种对应一种特定的税率，在这种情况下，就可以使用<code>switch</code>函数来简化判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>完整代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">numeric(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><code>switch()</code>函数调用的过程如下：</p>
<ol style="list-style-type: decimal">
<li>用一个单一值(Single Value)作为第1个参数（这里就是client），需要注意的是，<code>switch()</code>无法处理向量化数据，只能处理单一的数据，因此第1个参数不能是向量；</li>
<li>在第1个参数后，列出所有可能的情况及对应的值。</li>
<li>这里需要注意的是，我们只列出了3种情况，其实第3种情况<code>abroad</code>对应的是<code>其它情况</code>，如果使用其它的字符口中，则无法进行计算，后面会提到如何解这个问题。</li>
</ol>
<p><code>switch()</code>函数的第1个参数并不一定是一个特定的值，也可以是某个表达式，只要导出的结果是一个字符向量或数字即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">1</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some value"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">2</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"something else"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">3</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some more"</span></div></pre></td></tr></table></figure>
<h3 id="在switch中使用默认值">在<code>switch()</code>中使用默认值</h3>
<p>在<code>switch()</code>函数的调用中，并不需要列出所有可能的情况，如果对于所有不满足条件的判断值，都返回同一个结果的话，可以把这个结果放在参数列表的末尾，并去掉前面的判断值，因此可以看下面的代码，这与<code>ifelse</code>调用的结果一样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, pblic=<span class="number">1.06</span>, <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>现在就可以使用这个解决前面提出的那个问题了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div></pre></td></tr></table></figure>
<p>在<code>switch()</code>函数中的第3个参数里，把<code>abroad=1</code>改为<code>1</code>则就说明了，这是其他情况，而非仅仅是<code>abroad</code>这一种情况。</p>
<h2 id="for-循环">for 循环</h2>
<p><code>for</code>循环用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> values)&#123;</div><div class="line">    <span class="keyword">...</span> do someting...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="for循环案例1-简单案例"><code>for</code>循环案例1-简单案例</h3>
<p>先看一个for循环的最简单案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">cat(i);</div><div class="line">cat(<span class="string">" "</span>);</div><div class="line">i=i+<span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">+     cat(i);</div><div class="line">+     cat(<span class="string">" "</span>);</div><div class="line">+     i=i+<span class="number">3</span>;</div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></div></pre></td></tr></table></figure>
<p>从上面结果，我们可以看出，循环中处理的对象是1:20这20个数，对每个数进行操作不管循环内部i如何变化。因此，循环体内的i=i+3就不会对循环条件中的变量造成改变，具体执行过程相当于：<code>i=1</code> <code>-&gt;</code> <code>i=i+3</code>，此时<code>i=4</code>；<code>-&gt;</code> 第一次循环结束，第二次循环开始，<code>i=2</code>。尤其注意，i变成4又变成2，所以打印出来的结果是，1,2,3,4….20的连续值。如果想要随意的改变条件中的变量，可以使用while循环，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; i=<span class="number">1</span> </div><div class="line">&gt; <span class="keyword">while</span>(i&lt;=<span class="number">20</span>)&#123; </div><div class="line">+     cat(i); </div><div class="line">+     cat(<span class="string">" "</span>); </div><div class="line">+     i=i+<span class="number">3</span> </div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">7</span> <span class="number">10</span> <span class="number">13</span> <span class="number">16</span> <span class="number">19</span></div></pre></td></tr></table></figure>
<h3 id="for循环案例2-pricecalculator函数"><code>for</code>循环案例2-<code>priceCalculator()</code>函数</h3>
<p>现在使用<code>for</code>循环来改造原来的<code>priceCalculator()</code>函数，使这个函数可以一次地计算出多个客户类型的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph*</div><div class="line">    ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  </div><div class="line">  VAT &lt;- numeric(<span class="number">0</span>)</div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> client)&#123;</div><div class="line">    VAT &lt;- c(VAT, <span class="keyword">switch</span>(i, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这段代码中，做了以下修改：</p>
<ol style="list-style-type: decimal">
<li>创建了一个长度为0的数值向量，即<code>VAT &lt;- numeric(0)</code>；</li>
<li>对向量<code>client</code>中的每个值，用<code>switch()</code>来进行逻辑判断，选出对应的<code>VAT</code>值；</li>
<li>每次循环，都将<code>switch()</code>的结果放入向量VAT的末尾。</li>
</ol>
<p>这个函数的计算结果就是向量VAT包含每个客户对应的税率值，看一下计算结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>),</div><div class="line">  type = c(<span class="string">'public'</span>,<span class="string">'abroad'</span>,<span class="string">'private'</span>,<span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">clients</div><div class="line">priceCalculator(clients$hours,client = clients$type)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; clients</div><div class="line">  hours    type</div><div class="line"><span class="number">1</span>    <span class="number">25</span>  public</div><div class="line"><span class="number">2</span>   <span class="number">110</span>  abroad</div><div class="line"><span class="number">3</span>   <span class="number">125</span> private</div><div class="line"><span class="number">4</span>    <span class="number">40</span>  abroad</div><div class="line">&gt; priceCalculator(clients$hours,client = clients$type)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">3960</span> <span class="number">5040</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="any与all">any()与all()</h2>
<p>使用<code>any()</code>和<code>all()</code>函数可以对某个变量进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">10</span></div><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line">&gt; any(x&gt;<span class="number">8</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; any(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">0</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p>现在看一个案例，假设一个向量由若干个0或1构成，我们想要找𡵾其中连续出现1的游程（在一个0和1组成的序列中，一个由连续的0或1构成的串称为一个游程(run)）。例如对于向量x(假设它为1,0,0,1,1,1,0,1,1)，从它第4个索引处开始有长度为3的游程，而长度为2的游程分别始于第4，第5和第8索引的位置，因此现在我们构建一个函数，返回结果为(4,5,8)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findruns &lt;- <span class="keyword">function</span>(x,k)&#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  runs &lt;- <span class="literal">NULL</span></div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(n-k+<span class="number">1</span>))&#123;</div><div class="line">    <span class="keyword">if</span> (all(x[i:(i+k-<span class="number">1</span>)]==<span class="number">1</span>)) </div><div class="line">       runs &lt;- c(runs,i)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span>(runs)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在运行这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">&gt; findruns(x,<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div><div class="line">&gt; findruns(x,<span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">5</span> <span class="number">8</span></div><div class="line">&gt; findruns(x,<span class="number">6</span>)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/09/R/函数构建与循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/09/R/函数构建与循环/" itemprop="url">R语言笔记之函数构建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-09T12:00:00+08:00">
                2017-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,569
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  28
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="函数的编写">函数的编写</h2>
<p>格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">函数名 &lt;- <span class="keyword">function</span>(数据,参数<span class="number">1</span>=默认值,<span class="keyword">...</span>)</div><div class="line">&#123;</div><div class="line">异常处理;</div><div class="line">表达式(循环/判别);</div><div class="line"><span class="keyword">return</span>(返回值);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数案例a">函数案例A</h3>
<p>输入直角三角形的两个边长，求斜边长</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">result &lt;- sqrt(z) </div><div class="line"><span class="keyword">return</span>(result) </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">+     z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">+     result &lt;- sqrt(z) </div><div class="line">+     <span class="keyword">return</span>(result) </div><div class="line">+ &#125; </div><div class="line">&gt; rcal(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="函数案例b">函数案例B</h3>
<p>给出两个数字后，直接给出这两个数的平方和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line"><span class="keyword">return</span>(z3);</div><div class="line">&#125;</div><div class="line">sqtest(<span class="number">3</span>,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">+     z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line">+     <span class="keyword">return</span>(z3);</div><div class="line">+ &#125;</div><div class="line">&gt; sqtest(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">25</span></div></pre></td></tr></table></figure>
<h3 id="函数案例c-转换百分比">函数案例C-转换百分比</h3>
<p>创建一个函数，将小数转换为百分数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">addPercent(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; addPercent(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>在R中，函数其实就是一种对象，可以像操作其他对象一样操作了娄，例如可以将函数赋予一个新的对象来实现它的拷贝，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">ppaste &lt;- addPercent</div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">ppaste(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; ppaste &lt;- addPercent</div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; ppaste(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>需要注意的是，我们在输入<code>ppaste &lt;- addPercent</code>，函数<code>addPercent</code>后面我们并没有加<code>()</code>，这说明，只是将函数<code>addPercet</code>本身给<code>ppaste</code>这个变量，而不是调用<code>addPercent</code>这个函数。当我们输入<code>ppaste</code>，不加括号时，就会出现函数的内容，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; ppaste</div><div class="line"><span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实在R中，只输入函数本身，不输入括号，都会显示函数的内容，再看如下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; mean</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"mean"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000baf0a08</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div><div class="line">&gt; sd</div><div class="line"><span class="keyword">function</span> (x, na.rm = <span class="literal">FALSE</span>) </div><div class="line">sqrt(var(<span class="keyword">if</span> (is.vector(x) || is.factor(x)) x <span class="keyword">else</span> as.double(x), </div><div class="line">    na.rm = na.rm))</div><div class="line">&lt;bytecode: <span class="number">0x0000000004c04a38</span>&gt;</div><div class="line">&lt;environment: namespace:stats&gt;</div></pre></td></tr></table></figure>
<h3 id="函数的返回结果">函数的返回结果</h3>
<p>还以前面的<code>addPercent()</code>函数为例说明一下，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在大括号中最后一行是<code>return(result)</code>，把它删掉，再运行代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">addPercent(x)</div><div class="line">print(addPercent(x))</div></pre></td></tr></table></figure>
<p>可以发现，<code>addPercent(x)</code>没有返回结果，而<code>print(addPercent(x))</code>返回了原计算结果。因此在这里看来，<code>return(result)</code>这行代码是多余的，其实不一定，如果我们想要提前结束函数的运行，就会有用了，现在把<code>addPercent()</code>改造一下，加入一行代码，即<code>if(!is.numeric(x)) return(NULL)</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  <span class="keyword">if</span>(!is.numeric(x)) <span class="keyword">return</span>(<span class="literal">NULL</span>)</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">y &lt;- c(<span class="string">"Hello, R"</span>)</div><div class="line">addPercent(x)</div><div class="line">addPercent(y)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x)</div><div class="line">&gt; addPercent(y)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<p>变量<code>x</code>是数字，运行没问题，但变量<code>y</code>是字符串，就出现了问题，此时<code>reurn()</code>语句就派上了用场，函数判断出来了变量<code>y</code>不是数字，就返回了<code>NULL</code>。</p>
<h3 id="函数的简化">函数的简化</h3>
<p>只要函数体只包含一行代码，那么包围函数体的大括号<code>{}</code>有的时候可以省略，将这行代码直接放在参数列表后面即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">odds(<span class="number">0.8</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">&gt; odds(<span class="number">0.8</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>现在我们使用这种方式来重写<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">addPercent(<span class="number">0.0021</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下不所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">&gt; addPercent(<span class="number">0.0021</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.2%"</span></div></pre></td></tr></table></figure>
<p>但是，通常情况下并不推荐这么写，因为可读性太差。其实这种方式还可以继续简化，那就是匿名函数。</p>
<h3 id="给函数添加更多的参数">给函数添加更多的参数</h3>
<p><code>addPercent()</code>会自动将传入的数字乘以100，如果待转换的数字已经是百分数了，那么就需要将其除以100，再传入参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">addPercent(percentages/<span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">&gt; addPercent(percentages/<span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2%"</span>  <span class="string">"120.4%"</span> <span class="string">"33%"</span></div></pre></td></tr></table></figure>
<p>此时，为了更加方法，可以给<code>addPercent()</code>函数再添加一个参数，用于控制数字的乘或除，例如我们添加一个<code>mult</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">addPercent(decimalstages, mult = <span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2 % "</span>  <span class="string">"120.4 % "</span> <span class="string">"33 % "</span>   </div><div class="line">&gt; addPercent(decimalstages, mult = <span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="设置默认值">设置默认值</h4>
<p>还以上面的案例为例说明一下，如果我们忘记了传递<code>mult</code>参数，那么就会出错，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">Error <span class="keyword">in</span> addPercent(decimalstages) : </div><div class="line">  argument <span class="string">"mult"</span> is missing, with no default</div></pre></td></tr></table></figure>
<p>为避免这种情况，可以为<code>mult</code>参数添加一个默认值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(decimalstages)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="三点参数">三点参数</h4>
<p>如果我们再为<code>addPercent()</code>函数添加一个参数用于控制保留的小数位置，此时就已经有了3个参数，参数已经比较多了，这样参数的传入列表会很长，R中为此有一个很好的解决方案，就是三点参数（<code>...</code>），其实从R的很多函数中我们就能看到这种形式，例如我们在<code>pheatmap</code>这个包中的<code>pheatmap()</code>这个函数中就能看到这种形式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">pheatmap(mat, color = colorRampPalette(rev(brewer.pal(n = <span class="number">7</span>, name =</div><div class="line">  <span class="string">"RdYlBu"</span>)))(<span class="number">100</span>), kmeans_k = <span class="literal">NA</span>, breaks = <span class="literal">NA</span>, border_color = <span class="string">"grey60"</span>,</div><div class="line">  cellwidth = <span class="literal">NA</span>, cellheight = <span class="literal">NA</span>, scale = <span class="string">"none"</span>, cluster_rows = <span class="literal">TRUE</span>,</div><div class="line">  cluster_cols = <span class="literal">TRUE</span>, clustering_distance_rows = <span class="string">"euclidean"</span>,</div><div class="line">  clustering_distance_cols = <span class="string">"euclidean"</span>, clustering_method = <span class="string">"complete"</span>,</div><div class="line">  clustering_callback = identity2, cutree_rows = <span class="literal">NA</span>, cutree_cols = <span class="literal">NA</span>,</div><div class="line">  treeheight_row = ifelse((class(cluster_rows) == <span class="string">"hclust"</span>) || cluster_rows,</div><div class="line">  <span class="number">50</span>, <span class="number">0</span>), treeheight_col = ifelse((class(cluster_cols) == <span class="string">"hclust"</span>) ||</div><div class="line">  cluster_cols, <span class="number">50</span>, <span class="number">0</span>), legend = <span class="literal">TRUE</span>, legend_breaks = <span class="literal">NA</span>,</div><div class="line">  legend_labels = <span class="literal">NA</span>, annotation_row = <span class="literal">NA</span>, annotation_col = <span class="literal">NA</span>,</div><div class="line">  annotation = <span class="literal">NA</span>, annotation_colors = <span class="literal">NA</span>, annotation_legend = <span class="literal">TRUE</span>,</div><div class="line">  annotation_names_row = <span class="literal">TRUE</span>, annotation_names_col = <span class="literal">TRUE</span>,</div><div class="line">  drop_levels = <span class="literal">TRUE</span>, show_rownames = <span class="literal">T</span>, show_colnames = <span class="literal">T</span>, main = <span class="literal">NA</span>,</div><div class="line">  fontsize = <span class="number">10</span>, fontsize_row = fontsize, fontsize_col = fontsize,</div><div class="line">  angle_col = c(<span class="string">"270"</span>, <span class="string">"0"</span>, <span class="string">"45"</span>, <span class="string">"90"</span>, <span class="string">"315"</span>), display_numbers = <span class="literal">F</span>,</div><div class="line">  number_format = <span class="string">"%.2f"</span>, number_color = <span class="string">"grey30"</span>, fontsize_number = <span class="number">0.8</span></div><div class="line">  * fontsize, gaps_row = <span class="literal">NULL</span>, gaps_col = <span class="literal">NULL</span>, labels_row = <span class="literal">NULL</span>,</div><div class="line">  labels_col = <span class="literal">NULL</span>, filename = <span class="literal">NA</span>, width = <span class="literal">NA</span>, height = <span class="literal">NA</span>,</div><div class="line">  silent = <span class="literal">FALSE</span>, na_col = <span class="string">"#DDDDDD"</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>可以看到，最后就是三个点（<code>...</code>），说明参数列表还有，省略了。</p>
<p>现在使用这种三点参数来修改<code>addPercent()</code>函数，其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.3331</span>, <span class="number">0.13323</span>, <span class="number">1.33334</span>)</div><div class="line">addPercent(decimalstages, digits = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages, digits = <span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"33.31 % "</span>  <span class="string">"13.32 % "</span>  <span class="string">"133.33 % "</span></div><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"33 % "</span>  <span class="string">"13 % "</span>  <span class="string">"133 % "</span></div></pre></td></tr></table></figure>
<h3 id="将函数当作参数">将函数当作参数</h3>
<p>在R中，可以将函数当作参数，例如在<code>apply()</code>系列函数中就能遇到。在前面的案例中，<code>addPercent()</code>中使用了<code>round()</code>函数，但是如果我们想要使用其它的函数，例如<code>signif()</code>，那么就可以将这个函数当作参数，具体的实现形式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种形式下，在<code>percent &lt;- FUN(x*mult, ...)</code>这一步，默认情况下使用的是<code>round()</code>函数，如果要使用<code>signif()</code>这个函数，使用<code>addPercent()</code>时，直接在<code>FUN=</code>中直接添加上<code>signif</code>即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.1223</span>, <span class="number">0.8956</span>, <span class="number">0.4234</span>)</div><div class="line">addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"12.2 % "</span> <span class="string">"89.6 % "</span> <span class="string">"42.3 % "</span></div></pre></td></tr></table></figure>
<p>现在解释一下这个函数的调用过程：</p>
<ol style="list-style-type: decimal">
<li>向量<code>x</code>乘以<code>mult</code>（默认是100）；</li>
<li>R将<code>signif()</code>函数的代码传递给<code>FUN</code>参数，这样<code>FUN()</code>就成了<code>signif()</code>函数的一份拷贝，功能和行为都与之相同；</li>
<li>R接收参数<code>digits</code>并将其传递给<code>FUN()</code>。</li>
</ol>
<p>在这里需要注意的是，<code>FUN=signif</code>这个参数中,<code>signif</code>并没有添加小括号，如果添加了小括号，就是将<code>signif()</code>函数的调用结果而非函数本身赋值给参数<code>FUN</code>。</p>
<h3 id="匿名函数">匿名函数</h3>
<p>在上面的案例中，参数<code>FUN</code>其实可以传递各种参数，甚至也可以没有函数名称，直接复制代码即可，因此<code>FUN</code>参数除了使用函数名进行赋值外，还可以直接将代码放在<code>FUN</code>中，这种直接放代码的形式就是以匿名函数的方式进行传递的，所谓的匿名函数（<code>Anonymous Function</code>）就是指没有名称的函数，看下面的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>其实还可以继续简化，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits/sum(profits))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits/sum(profits))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>匿名函数的使用前提是，①函数本身代码很短，②只会使用一次，不会用在别的地方。</p>
<h3 id="函数匹配">函数匹配</h3>
<p>前面提到的“将函数作为参数”案例中，通过将函数名将代码传递一个参数，这就意味着，假如有一个与函数名相同的对象，就会出错，例如我们在调用<code>addPercent()</code>函数之前，再定义一个名为<code>round</code>的对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div></pre></td></tr></table></figure>
<p>此时再调用<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">Error <span class="keyword">in</span> FUN(x * mult, <span class="keyword">...</span>) : could not find <span class="keyword">function</span> <span class="string">"FUN"</span></div></pre></td></tr></table></figure>
<p>此时就出错了，因为R没有将<code>round()</code>函数传递给<code>FUN</code>，而是把向量<code>round</code>赋予给了<code>FUN</code>，为了避免这种情况，可以调用一下<code>match.fun()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">[<span class="number">1</span>] <span class="string">"45 % "</span>   <span class="string">"-45 % "</span>  <span class="string">"5850 % "</span></div></pre></td></tr></table></figure>
<p><code>match.fun</code>函数会查找与名称<code>round</code>相匹配的函数，并将代码复制给<code>FUN</code>，而不会找到<code>round</code>向量，另外，<code>match.fun()</code>还支持字符对象，例如<code>FUN='round'</code>这样传递参数也是有效的。</p>
<h2 id="处理作用域">处理作用域</h2>
<p>在前面的案例中，我们只使用了Workspace，也就是说，创建的每一个以对象都存在于整个环境中，这个环境被称为全局环境（Global Environment）。在前面的案例中，函数内部的 一些参数，例如x，mult和FUN并非都是创建在Workspace中的对象，它们是在函数内部创建的对象，这些变量在退出函数回到Workspace后都无法使用了，看下面的一个案例：</p>
<p>首选创建一个对象<code>x</code>和函数<code>test()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x &lt;- <span class="number">1</span>:<span class="number">5</span></div><div class="line">test &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">"This is x: "</span>, x, <span class="string">"\n"</span>)</div><div class="line">  rm(x)</div><div class="line">  cat(<span class="string">"This is x after removing it:"</span>, x, <span class="string">"\n"</span>)</div><div class="line">&#125;</div><div class="line">x</div><div class="line">test(<span class="number">5</span>:<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div><div class="line">&gt; test(<span class="number">5</span>:<span class="number">1</span>)</div><div class="line">This is x:  <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> </div><div class="line">This is x after removing it: <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p>从上面的案例可以发现，<code>test()</code>这个函数的功能就是接收一个参数<code>x</code>，输出到控制台，然后将其删除，并再次输出。函数内部虽然已经使用了<code>rm(x)</code>来删除这个<code>x</code>，但是<code>x</code>还是能输出，不过，两次输出的<code>x</code>内容并不一样。</p>
<h3 id="函数的检索路径">函数的检索路径</h3>
<p>在一个函数被调用时，它将首选创建一个临时的本地环境(Local Environment)，这个本地环境嵌套在全局环境中，这意味着本地环境中仍然可以访问全局环境内的对象。只要函数执行完毕，本地环境就会立即释放，同时其中的所有对象也会被销毁。</p>
<p>换一种说法就是：函数创建的环境始终位于调用它的环境之内，而调用它的环境被称为父环境(Parent Environment)。所以，当我们从Worksapce中通过脚本或命令行调用某个函数时，它的父环境恰好为全局环境。</p>
<p>下图就是<code>test()</code>函数调用的原理：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621203341.png">

</div>
<p>外层的大矩形表示全局环境，而内层的灰色矩形则表示test函数的本地环境。在全局环境中，我们将对象<code>x</code>赋值为<code>1:5</code>，而在调用函数内部，则另外创建了一个参数<code>x</code>，赋值为<code>5:1</code>，这个参数成为了本地环境中的一个对象。</p>
<p>当R在代码中发现了一个对象<code>x</code>时，它将首先检索本地环境。而恰好能够找到参数<code>x</code>，所以它将被用在第一次的<code>cat()</code>调用中，接下来一行，R移除了这个对象<code>x</code>。所以，当R到达第三行时，就再也找不到本地环境中的对象<code>x</code>了。</p>
<p>此时，R会顺序环境栈上移，到达全局环境，并在其中查找名为<code>x</code>的对象，由于其中也恰好有<code>x</code>，因此它将被用于第二次的<code>cat()</code>调用。</p>
<p>如果在函数内部使用<code>rm()</code>，在默认情况下，它只会删除位于函数中的对象，这可以避免在函数中使用更大范围数据集所带来的内存消耗风险，因为我们可以在使用这个对象后立即将其删除，而无需等待函数执行完毕。</p>
<h3 id="使用内部函数">使用内部函数</h3>
<p><code>test()</code>函数出现的调用全局环境对象的问题其实是没有意义的，因为我们从一开始就应该避免函数对全局环境对象的依赖。事实上，R背后隐藏的整个概念都不支持将全局变量应用到函数内部。R作为一门函数式编程语言，它的一个主要思想就是在于任何函数的输出结果都不能依赖于外部环境，而仅仅是由传入的参数决定。只要各个参数的值相同，结果就不会发生变化。这种操作的优势在于，有时候我们想要在某个函数内部重复地执行某种操作，但离开这个函数后，这一操作又是没有意义的。</p>
<p>假设我们要比较几盏灯在半供电和全供电时亮度的差异，而用来遮挡外面太阳光的窗帘又不能完全阻挡光线的进入，因此还需要测量日光提供的亮度，然后将灯光的测量结果减去日光的亮度，来修正最终的结果。</p>
<p>要计算半供电时的灯光效率，可以实现下面的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z)  - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>ccalculate.eff()</code>函数内部，可以看到有另外一个函数的定义：<code>min.base()</code>，这个函数定义在<code>calculate.eff()</code>函数的本地环境中，并且也会在离开函数时销毁，也就是说，它并不存在于Workspace内。</p>
<p>我们可以像下面这样调用这个函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z) z - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div><div class="line"></div><div class="line">half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">calculate.eff(half, full,nothing)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">&gt; full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">&gt; nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">&gt; calculate.eff(half, full,nothing)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4270093</span> <span class="number">0.6258612</span> <span class="number">0.3129473</span></div></pre></td></tr></table></figure>
<p>从源代码中可以看到，<code>min.base()</code>的定义中使用了对象<code>control</code>，但这个对象并没有出现在函数的参数列表中，其原因可以看一下这个函数的调用过程，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621205945.png">

</div>
<p>调用过程如下所示：</p>
<ol style="list-style-type: decimal">
<li>函数<code>calculate.eff()</code>创建了一个本地环境，包含对象<code>x</code>（其值为<code>fifty</code>），<code>y</code>（其值为<code>hundred</code>），<code>control</code>（值为<code>nothing</code>），以及函数<code>min.base()</code>；</li>
<li>函数<code>min.base()</code>在<code>calculate.eff()</code>函数内创建了一个新的本地环境，包含对象<code>z</code>，值为<code>x</code>；</li>
<li><code>min.base()</code>在<code>calculate.eff()</code>的环境内查找对象<code>control</code>，计算其中每个元素的平均值，并将<code>z</code>的每个元素减去这个平均值，之后返回结果；</li>
<li>与前一个过程相同，只是<code>z</code>的值换成了<code>y</code>。</li>
<li><code>3</code>和<code>4</code>的结果相除，结果返回到全局环境。</li>
</ol>
<p>本地环境所嵌入的环境实际上是函数被定义的地方，而非调用的地方。假设我们在<code>calculate.eff()</code>内使用<code>addPercent()</code>来格式化数字，那么<code>addPercent()</code>所创建的本地环境不会被嵌入在<code>calculate.eff()</code>中，而是在全局环境内，也就是<code>addPercent()</code>被定义的地方。</p>
<h3 id="方法分配">方法分配</h3>
<p>关于函数的另外一个问题就是函数的方法问题。因为理解了这方面的知识，才能理解函数如何能够根据传入参数的类型来确定返回不同的结果。R中有一个机制被称为<code>通用函数系统</code>（Generic Function System），它允许用户使用相同的名称调用不同的函数。</p>
<p>例如，当我们输出一个列表时，输出会以行的方式进行排列，当我们输出一个数据框的时候，则会以列的方式显示，由此可见，<code>print()</code>函数对待列表和数据框的方式是不同的，但是所用的函数却是一样的。</p>
<p>现在看一下<code>print()</code>函数的代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; print</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"print"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000d7d7150</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div></pre></td></tr></table></figure>
<p>最后两行可以忽略，它表示的是<code>外层空间</code>的东西，供R语言的高手使用，第1行可以看出来，<code>print()</code>这个函数的函数体只有一行代码。</p>
<p>像这种什么都不做，仅仅是将对象正确地传递给其他函数的函数被称为<code>通用函数</code>(<code>Generic Function</code>)。<code>print()</code>就是一个通用函数。真正完成实际工作的函数被称<code>方法</code>（<code>Methods</code>）。可见，所有的方法都是函数，但并不是每个函数都是方法。</p>
<h4 id="通过usemethod调用方法">通过<code>UseMethod</code>调用方法</h4>
<p><code>print()</code>仅靠那一行代码肯定是完成无法完成不同方式打印向量、数据框、列表等复杂任务的，真正完成的其实是<code>UseMethod()</code>这个函数，这个函数做的所有事情就是告诉R查找一个能够处理传入参数<code>x</code>类型相匹配的函数。R会完整地遍历定义的函数名称，查找以<code>print</code>形状，后面接一个点号加上对象类型名的函数。</p>
<p>我们也可以通过<code>apropos('print\\.')</code>的命令来实现这个过程，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; apropos(<span class="string">'print\\.'</span>)</div><div class="line"> [<span class="number">1</span>] <span class="string">".rs.rnbHooks.print.html"</span>             <span class="string">".rs.rnbHooks.print.htmlwidget"</span>      </div><div class="line"> [<span class="number">3</span>] <span class="string">".rs.rnbHooks.print.knit_asis"</span>        <span class="string">".rs.rnbHooks.print.knit_image_paths"</span></div><div class="line"> [<span class="number">5</span>] <span class="string">".rs.rnbHooks.print.shiny.tag"</span>        <span class="string">".rs.rnbHooks.print.shiny.tag.list"</span>  </div><div class="line"> [<span class="number">7</span>] <span class="string">"print.AsIs"</span>                          <span class="string">"print.by"</span>                           </div><div class="line"> [<span class="number">9</span>] <span class="string">"print.condition"</span>                     <span class="string">"print.connection"</span>                   </div><div class="line">[<span class="number">11</span>] <span class="string">"print.data.frame"</span>                    <span class="string">"print.Date"</span>                         </div><div class="line">[<span class="number">13</span>] <span class="string">"print.default"</span>                       <span class="string">"print.difftime"</span>                     </div><div class="line">[<span class="number">15</span>] <span class="string">"print.Dlist"</span>                         <span class="string">"print.DLLInfo"</span>                      </div><div class="line">[<span class="number">17</span>] <span class="string">"print.DLLInfoList"</span>                   <span class="string">"print.DLLRegisteredRoutines"</span>        </div><div class="line">[<span class="number">19</span>] <span class="string">"print.eigen"</span>                         <span class="string">"print.factor"</span>                       </div><div class="line">[<span class="number">21</span>] <span class="string">"print.function"</span>                      <span class="string">"print.hexmode"</span>                      </div><div class="line">[<span class="number">23</span>] <span class="string">"print.libraryIQR"</span>                    <span class="string">"print.listof"</span>                       </div><div class="line">[<span class="number">25</span>] <span class="string">"print.NativeRoutineList"</span>             <span class="string">"print.noquote"</span>                      </div><div class="line">[<span class="number">27</span>] <span class="string">"print.numeric_version"</span>               <span class="string">"print.octmode"</span>                      </div><div class="line">[<span class="number">29</span>] <span class="string">"print.packageInfo"</span>                   <span class="string">"print.POSIXct"</span>                      </div><div class="line">[<span class="number">31</span>] <span class="string">"print.POSIXlt"</span>                       <span class="string">"print.proc_time"</span>                    </div><div class="line">[<span class="number">33</span>] <span class="string">"print.restart"</span>                       <span class="string">"print.rle"</span>                          </div><div class="line">[<span class="number">35</span>] <span class="string">"print.simple.list"</span>                   <span class="string">"print.srcfile"</span>                      </div><div class="line">[<span class="number">37</span>] <span class="string">"print.srcref"</span>                        <span class="string">"print.summary.table"</span>                </div><div class="line">[<span class="number">39</span>] <span class="string">"print.summary.warnings"</span>              <span class="string">"print.summaryDefault"</span>               </div><div class="line">[<span class="number">41</span>] <span class="string">"print.table"</span>                         <span class="string">"print.warnings"</span></div></pre></td></tr></table></figure>
<p><code>apropos()</code>括号内的引号之间可以添加正则表达式，这与<code>grep()</code>函数非常类似。假如我们要打印一个数据框，那么R将查找函数<code>print.data.frame()</code>，并使用它来打印作为参数传入的对象，我们可以手工调用这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">print(small.one)</div><div class="line">print.data.frame(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print.data.frame(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div></pre></td></tr></table></figure>
<p>函数的输出结果与调用通过的<code>print(small.one)</code>函数是完全相同的，因为<code>print()</code>将打印<code>small.one</code>的任务完全交给了<code>print.data.frame()</code>函数来完成。</p>
<h4 id="使用默认方法">使用默认方法</h4>
<p>对于列表来说，你可能会觉得<code>print.list()</code>函数承担了打印任务，但实际上<code>print.list()</code>函数并不存在，此时R会忽略对象的类型，直接调用默认方法<code>print.default()</code>来打印列表。</p>
<p>许多通过函数都有一个默认方法，当无法调用特定方法执行时将派上用场，如果存在默认方法，那么它的名称必然是函数名后面加点，再加上<code>default</code>。我们来看一下默认方法打印<code>small.one</code>这个变量的结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">print.default(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; print.default(small.one)</div><div class="line">$a</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span></div><div class="line"></div><div class="line">$b</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">1</span></div><div class="line"></div><div class="line">attr(,<span class="string">"class"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<h4 id="实现自己的通用函数">实现自己的通用函数</h4>
<p>用户自己也可以实现自己的通用函数。现在看前面的<code>addPercent()</code>函数，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于<code>addPercent()</code>函数来说，传入的参数<code>x</code>不能是字符向量，因为它无法参与后面的乘法运算，但可以利用方法分配机制，实现一个特定的函数来处理这一问题，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的是，这里的对象不是向量，而是字符，同样的原理，之前那个<code>addPercent(0</code>函数也应该变成针对特定类型对象的方法，将名称改为<code>addPercent.numeric</code>。在实现方法分配时，如果代码不是过长，应该尽量把所有函数的实现放在同一个脚本文件中，这样只要运行一个脚本，就可以使用完整的函数功能。</p>
<p>接着定义最外层的<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函数只定义了两个参数，<code>x</code>和<code>...</code>，<code>...</code>参数确保在<code>addPercent.numeric()</code>函数中使用的其它参数依然有效，这些附加参数将会原封不动地传递给内部调用的函数。当把完整的脚本文件发送给控制台后，就哦可以向<code>addPercent()</code>函数传入字符向量或数值向量了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">Error <span class="keyword">in</span> UseMethod(<span class="string">"addPercent"</span>) : </div><div class="line">  no applicable method <span class="keyword">for</span> <span class="string">'addPercent'</span> applied to an object of class <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<p>其中，<code>addPercent(small.one)</code>这行代码出错。出错的信息显示，没有适当的方法用于处理传入的数据框，此时 们还可以修改这种错误提示，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码的功能在于显示一条信息，这条信息相对于R默认的错误信息更容易理解，现在运行完整代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">You should <span class="keyword">try</span> a numeric or character vector.</div></pre></td></tr></table></figure>
<h2 id="函数返回多个结果">函数返回多个结果</h2>
<p>当函数需要返回多个结果时，通常用<code>list</code>的形式返回结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vms = <span class="keyword">function</span>(x)&#123;</div><div class="line">  xx=rev(sort(x)) </div><div class="line"><span class="comment"># 对向量x从小到大排序，然后用ver()转换为从大到小排序</span></div><div class="line">  xx=xx[<span class="number">1</span>:<span class="number">5</span>]</div><div class="line"><span class="comment"># 提取前5个元素</span></div><div class="line">  mean(xx)</div><div class="line"><span class="comment">#求均值</span></div><div class="line">  <span class="keyword">return</span>(list(xbar=mean(xx),top5=xx))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; y &lt;- c(12,4,65,22,33,123,322,90)</div><div class="line">&gt; vms(y)</div><div class="line">$xbar</div><div class="line">[1] 126.6</div><div class="line"></div><div class="line">$top5</div><div class="line">[1] 322 123  90  65  33</div></pre></td></tr></table></figure>
<h2 id="使用单变量求解函数方程">使用单变量求解函数方程</h2>
<p>用到的函数是<code>optimize()</code>，先看一个案例：</p>
<p>经济学的一个基本模型就是随着价格上涨，产品的销量会下降，可以使用如下的函数来表示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div></pre></td></tr></table></figure>
<p>那么期望收益就是产品价格与销量的乘积，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div></pre></td></tr></table></figure>
<p>现在使用<code>curve()</code>函数将这两个函数画出来，它接收一个函数作为参数，并绘制出一定范围内的函数图像，我们假设定价范围在50美元到60美元之间，那么这个图像如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div><div class="line">par(mfrow = c(<span class="number">1</span>, <span class="number">2</span>))</div><div class="line">curve(sales, from = <span class="number">50</span>, to = <span class="number">150</span>, xname=<span class="string">"price"</span>, ylab= <span class="string">"Sales"</span>, main=<span class="string">"Sales"</span>)</div><div class="line">curve(revenue, from=<span class="number">50</span>, to=<span class="number">150</span>, xname=<span class="string">"price"</span>, ylab=<span class="string">"Revenue"</span>, main=<span class="string">"Revenue"</span>)</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190617074809.png">

</div>
<p>从上图的右图可以看出来，收益明显有一个最高点，因此现在使用R中的<code>optimize()</code>函数计算出这个最大值，如果要使用<code>optimize()</code>这个函数，要输入它目标函数（这里是<code>revenue()</code>)和区间（这里是<code>50~150</code>），默认情况下，<code>optimize()</code>计算的是最小值，但此时我们要计算最大值，就需要调整一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div><div class="line">$maximum</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line"></div><div class="line">$objective</div><div class="line">[<span class="number">1</span>] <span class="number">5000</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey [法] Andrie de Vries 著</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">149</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共562.4k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
