<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/13/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/13/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/16/R/ggplot2(6) - 描述数据分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/16/R/ggplot2(6) - 描述数据分布/" itemprop="url">ggplot2(6)-描述数据分布</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:00:00+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,173
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="绘制简单直方图"><a href="#绘制简单直方图" class="headerlink" title="绘制简单直方图"></a>绘制简单直方图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">ggplot(faithful,aes(x=waiting)) + geom_histogram()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aaijA7c2KG.png?imageslim" alt="mark"></p>
<h2 id="快速建立直方图"><a href="#快速建立直方图" class="headerlink" title="快速建立直方图"></a>快速建立直方图</h2><p>可以将数据框参数设定为NULL，然后向其传递一个向量： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w &lt;- faithful$waiting</div><div class="line">ggplot(<span class="literal">NULL</span>,aes(x=w)) + geom_histogram()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KHAG5DL6j8.png?imageslim" alt="mark"></p>
<h3 id="调节组距"><a href="#调节组距" class="headerlink" title="调节组距"></a>调节组距</h3><p>默认的数据被分为30组，可以通过binwidth()参数才调节： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting)) + </div><div class="line">  geom_histogram(binwidth=<span class="number">5</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>) </div><div class="line"><span class="comment"># 设定组距为5</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/hlBbC05kid.png?imageslim" alt="mark"></p>
<p>把数据分为15组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">binsize &lt;- diff(range(faithful$waiting))/<span class="number">15</span> <span class="comment"># 把数据分为15组,diff()是差分函数，什么是差分，不懂</span></div><div class="line"></div><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_histogram(binwidth=binsize,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/JGKb6EiHAj.png?imageslim" alt="mark"></p>
<p>有时候，直方图的外观会非常依赖于组距及组边界。现在我们将组距离设为8，同时设定分组原点(origin)参数，令组边界分别位于31、39、47等，在第二张图中，对origin参数增加4，令组边界分别位于35、43、51等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h &lt;- ggplot(faithful,aes(x=waiting)) </div><div class="line">h + geom_histogram(binwidth=<span class="number">8</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>,boundary=<span class="number">31</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ahL2cdj2EE.png?imageslim" alt="mark"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h &lt;- ggplot(faithful,aes(x=waiting)) </div><div class="line">h + geom_histogram(binwidth=<span class="number">8</span>,fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>,boundary=<span class="number">35</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/m71eiJK7CG.png?imageslim" alt="mark"></p>
<h2 id="基于分组数据绘制分组直方图"><a href="#基于分组数据绘制分组直方图" class="headerlink" title="基于分组数据绘制分组直方图"></a>基于分组数据绘制分组直方图</h2><p>以MASS包中的birthwt数据集为例说明： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">head(birthwt)</div><div class="line"></div><div class="line"><span class="comment">##    low age lwt race smoke ptl ht ui ftv  bwt</span></div><div class="line"><span class="comment">## 85   0  19 182    2     0   0  0  1   0 2523</span></div><div class="line"><span class="comment">## 86   0  33 155    3     0   0  0  0   3 2551</span></div><div class="line"><span class="comment">## 87   0  20 105    1     1   0  0  0   1 2557</span></div><div class="line"><span class="comment">## 88   0  21 108    1     1   0  0  1   2 2594</span></div><div class="line"><span class="comment">## 89   0  18 107    1     1   0  0  1   0 2600</span></div><div class="line"><span class="comment">## 91   0  21 124    3     0   0  0  0   0 2622</span></div></pre></td></tr></table></figure>
<p>此数据集中包括了婴儿出生体重及一系列导致出生体重过低的危险因子的数据。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt)) + </div><div class="line">  geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/A7mL9b1k5g.png?imageslim" alt="mark"></p>
<h3 id="修改分面标签"><a href="#修改分面标签" class="headerlink" title="修改分面标签"></a>修改分面标签</h3><p>上图中的分布依据是smoke,此数据只有0与1两种，因此不清楚表示什么意思，因此要进行修改，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">birthwt1 &lt;- birthwt <span class="comment"># 复制一份数据</span></div><div class="line">birthwt1$smoke &lt;- factor(birthwt$smoke)</div><div class="line">levels(birthwt1$smoke)</div><div class="line"></div><div class="line"><span class="comment">## [1] "0" "1"</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">birthwt1$smoke &lt;- revalue(birthwt1$smoke,c(<span class="string">"0"</span>=<span class="string">"No Smoke"</span>,<span class="string">"1"</span>=<span class="string">"Smoke"</span>))</div><div class="line"><span class="comment"># 替换因子的名称</span></div><div class="line"></div><div class="line">ggplot(birthwt1,aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>) + </div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CaleK4BjK5.png?imageslim" alt="mark"></p>
<h3 id="样本数目不同时的分面"><a href="#样本数目不同时的分面" class="headerlink" title="样本数目不同时的分面"></a>样本数目不同时的分面</h3><p>默认情况下，y轴是相同的范围，但图形会不美观，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(race~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6HF0EFAJg8.png?imageslim" alt="mark"></p>
<h3 id="分面时y轴的设置"><a href="#分面时y轴的设置" class="headerlink" title="分面时y轴的设置"></a>分面时y轴的设置</h3><p>如果scales=”free”则可以单独设定各个分面的y轴标度，但这种设制只适用于y轴标度，对x轴没有影响，x轴仍然是固定的：</p>
 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=bwt))+</div><div class="line">  geom_histogram(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">  facet_grid(race~.,scales=<span class="string">"free"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aJ1LKadfII.png?imageslim" alt="mark"></p>
<h3 id="另外一种分面"><a href="#另外一种分面" class="headerlink" title="另外一种分面"></a>另外一种分面</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+</div><div class="line">  geom_histogram(position=<span class="string">"identity"</span>,alpha=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6H4kcjack0.png?imageslim" alt="mark"></p>
<p><code>position=&quot;identity&quot;</code>避免将数据堆积在一起，如果没有，则图形如下所示： 4</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+</div><div class="line">  geom_histogram(alpha=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/I91A70Eh75.png?imageslim" alt="mark"></p>
<h2 id="绘制密度曲线图"><a href="#绘制密度曲线图" class="headerlink" title="绘制密度曲线图"></a>绘制密度曲线图</h2><h3 id="基本绘图"><a href="#基本绘图" class="headerlink" title="基本绘图"></a>基本绘图</h3><p>用到geom_density() </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+ geom_density()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GHJ8HHj5he.png?imageslim" alt="mark"></p>
<p>如果不想绘制曲线的两侧与底部： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  expand_limits(y=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/32433dLmAi.png?imageslim" alt="mark"></p>
<h3 id="带宽的调整"><a href="#带宽的调整" class="headerlink" title="带宽的调整"></a>带宽的调整</h3><p>对核密度曲线进行带宽的调整，通过参数adjust来实现： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>,adjust=<span class="number">0.25</span>,colour=<span class="string">"red"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>,adjust=<span class="number">2</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KJ32eci6DC.png?imageslim" alt="mark"></p>
<h3 id="手动添加x轴的范围"><a href="#手动添加x轴的范围" class="headerlink" title="手动添加x轴的范围"></a>手动添加x轴的范围</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_density(fill=<span class="string">"blue"</span>,alpha=<span class="number">0.2</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/KLcLgg2CiK.png?imageslim" alt="mark"></p>
<h3 id="去掉密度曲线下的横线"><a href="#去掉密度曲线下的横线" class="headerlink" title="去掉密度曲线下的横线"></a>去掉密度曲线下的横线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+</div><div class="line">  geom_density(fill=<span class="string">"blue"</span>,colour=<span class="string">"NA"</span>,alpha=<span class="number">0.2</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kiH2kdDm96.png?imageslim" alt="mark"></p>
<h3 id="直方图与密度曲线的叠加"><a href="#直方图与密度曲线的叠加" class="headerlink" title="直方图与密度曲线的叠加"></a>直方图与密度曲线的叠加</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting,y=..density..))+</div><div class="line">  geom_histogram(fill=<span class="string">"cornsilk"</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">0.2</span>)+</div><div class="line">  geom_density(colour=<span class="string">"NA"</span>)+</div><div class="line">  geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">  xlim(<span class="number">35</span>,<span class="number">105</span>)</div><div class="line"><span class="comment"># geom_density(colour="NA")表示去掉密度图的最低部的直线</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Kkdh6A242j.png?imageslim" alt="mark"></p>
<h3 id="基于分组数据绘制分组密度曲线"><a href="#基于分组数据绘制分组密度曲线" class="headerlink" title="基于分组数据绘制分组密度曲线"></a>基于分组数据绘制分组密度曲线</h3><p>把变量smoke映射给colour</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">birthwt1 &lt;- birthwt</div><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line">ggplot(birthwt1,aes(x=bwt,colour=smoke))+geom_density()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LIgH9gCfjf.png?imageslim" alt="mark"></p>
<h3 id="把变量smoke映射给fill"><a href="#把变量smoke映射给fill" class="headerlink" title="把变量smoke映射给fill"></a>把变量smoke映射给fill</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt,fill=smoke))+geom_density(alpha=<span class="number">0.3</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8j79gcH69e.png?imageslim" alt="mark"></p>
<h3 id="分面"><a href="#分面" class="headerlink" title="分面"></a>分面</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt))+</div><div class="line">geom_density(colour=<span class="string">"NA"</span>)+</div><div class="line">geom_line(stat=<span class="string">"density"</span>)+</div><div class="line">facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ciLmCJKa10.png?imageslim" alt="mark"></p>
<h3 id="直方图与密度曲线叠加的分面"><a href="#直方图与密度曲线叠加的分面" class="headerlink" title="直方图与密度曲线叠加的分面"></a>直方图与密度曲线叠加的分面</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt1,aes(x=bwt,y=..density..))+</div><div class="line">  geom_histogram(binwidth=<span class="number">200</span>,fill=<span class="string">"cornsilk"</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">0.2</span>)+geom_density()+</div><div class="line">  facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GJmBl7gfHE.png?imageslim" alt="mark"></p>
<h2 id="绘制频数多边形"><a href="#绘制频数多边形" class="headerlink" title="绘制频数多边形"></a>绘制频数多边形</h2><h3 id="基本绘图-1"><a href="#基本绘图-1" class="headerlink" title="基本绘图"></a>基本绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+geom_freqpoly()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g0KGcG4gI2.png?imageslim" alt="mark"></p>
<h3 id="更改组距"><a href="#更改组距" class="headerlink" title="更改组距"></a>更改组距</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=waiting))+geom_freqpoly(binwidth=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mbmflbl34E.png?imageslim" alt="mark"></p>
<h2 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h2><h3 id="基本绘图-2"><a href="#基本绘图-2" class="headerlink" title="基本绘图"></a>基本绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/04Fa86i9ag.png?imageslim" alt="mark"></p>
<h3 id="更改箱线图的宽度"><a href="#更改箱线图的宽度" class="headerlink" title="更改箱线图的宽度"></a>更改箱线图的宽度</h3><p>geom_boxplot(width=0.5)参数可以更改箱子的宽度 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot(width=0.5)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/L7e7kD5kgd.png?imageslim" alt="mark"></p>
<h3 id="更改异常值的点"><a href="#更改异常值的点" class="headerlink" title="更改异常值的点"></a>更改异常值的点</h3><p>geom_boxplot(outlier.size=5,outlier.shape=21)可以更改异常值的大小与形状： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+</div><div class="line">  geom_boxplot(outlier.size=<span class="number">5</span>,outlier.shape=<span class="number">22</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DjkeGaL85h.png?imageslim" alt="mark"></p>
<h3 id="单组箱线图的绘制"><a href="#单组箱线图的绘制" class="headerlink" title="单组箱线图的绘制"></a>单组箱线图的绘制</h3><p>把x轴设制为1，即x轴对应的全部的数据： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=<span class="number">1</span>,y=bwt))+geom_boxplot()+</div><div class="line">  scale_x_continuous(breaks=<span class="literal">NULL</span>)+</div><div class="line">  theme(axis.title.x=element_blank())</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EhDK8HBh1f.png?imageslim" alt="mark"></p>
<p>上述命令类似于boxplot() </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boxplot(birthwt$bwt)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aCijKfi6f1.png?imageslim" alt="mark"></p>
<h3 id="向箱线图添加槽口"><a href="#向箱线图添加槽口" class="headerlink" title="向箱线图添加槽口"></a>向箱线图添加槽口</h3><p>槽口即notch，添加槽口的用处于在查看不同的中位数是否有差异。如果各箱线图的槽口互不重合，说明中位数有差异。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot(notch=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/cL3dJJ0gI4.png?imageslim" alt="mark"></p>
<p>上述命令会出现notch went outside hinges. Try setting notch=FALSE.这表示中间的箱子对应的槽口的上边界溢出了箱体，由于闪出的距离较小，因此在图片中基本上看不到。 </p>
<h3 id="向箱线图中添加均值"><a href="#向箱线图中添加均值" class="headerlink" title="向箱线图中添加均值"></a>向箱线图中添加均值</h3><p>用到stat_summary()函数，箱线图需要注意的是，箱线图中间的线是中位数，不是均值。对于正态分布的数据，中位数与均值会比较接近，但对于偏态分布则不同。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(birthwt,aes(x=factor(race),y=bwt))+geom_boxplot()+</div><div class="line">  stat_summary(fun.y=<span class="string">"mean"</span>,geom=<span class="string">"point"</span>,shape=<span class="number">23</span>,size=<span class="number">3</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dJb87AB4kB.png?imageslim" alt="mark"></p>
<h2 id="绘制小提琴图"><a href="#绘制小提琴图" class="headerlink" title="绘制小提琴图"></a>绘制小提琴图</h2><p>小提琴图是一种对多组数据的分布进行比较的方法，使用普通的密度曲线对多组数据进行可视化时，图中的曲线会彼此干扰，因而不宜用来对多组数据的分布进行比较，而小提琴图是并排排列的，用它对多组数据分布进行比较更容易。 </p>
<h3 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(heightweight,aes(x=sex,y=heightIn))</div><div class="line">p + geom_violin()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ilaIlmkI7A.png?imageslim" alt="mark"></p>
<p>下面是密度曲线的常规绘图： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(colour=sex,x=heightIn))+geom_density()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DH9FLfejkK.png?imageslim" alt="mark"></p>
<h3 id="小提琴图添加中位数"><a href="#小提琴图添加中位数" class="headerlink" title="小提琴图添加中位数"></a>小提琴图添加中位数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_violin() +</div><div class="line">  geom_boxplot(width=<span class="number">0.1</span>,fill=<span class="string">"black"</span>,outlier.colour=<span class="literal">NA</span>)+</div><div class="line">  stat_summary(fun.y=median,geom=<span class="string">"point"</span>,fill=<span class="string">"white"</span>,shape=<span class="number">21</span>,size=<span class="number">2.5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6eGcf92JH1.png?imageslim" alt="mark"></p>
<h3 id="保留小提琴尾部"><a href="#保留小提琴尾部" class="headerlink" title="保留小提琴尾部"></a>保留小提琴尾部</h3><p>上图中的小提琴尾部没有保留，进行了截断，可以通过trim=FALSE设置保留小提琴的尾部： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(trim=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1gfLHCcH31.png?imageslim" alt="mark"></p>
<h3 id="调节小提琴的平滑度"><a href="#调节小提琴的平滑度" class="headerlink" title="调节小提琴的平滑度"></a>调节小提琴的平滑度</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(adjust=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d551aack21.png?imageslim" alt="如果adjust缩小，则不平滑： mark"></p>
<p>如果adjust缩小，则不平滑： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_violin(adjust=<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fc92LcA5ki.png?imageslim" alt="mark"></p>
<h2 id="绘制Wilkinson点图"><a href="#绘制Wilkinson点图" class="headerlink" title="绘制Wilkinson点图"></a>绘制Wilkinson点图</h2><p>Wilkinson图中点的分组和排列取决于数据，每个点的宽度对应了最大组距。系数默认的最大组距是数据范围的1/30，可以通过binwidth参数对其进行调整。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">countries2009 &lt;- subset(countries,Year==<span class="number">2009</span> &amp; healthexp &gt;<span class="number">2000</span>)</div><div class="line">p &lt;- ggplot(countries2009,aes(x=infmortality))</div><div class="line">p + geom_dotplot()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/07h0eiDG3E.png?imageslim" alt="mark"></p>
<p>上图中geom_dotplot()函数沿着x轴方向对数据进行分组并在y轴方向上对点进行堆积，图中各点看起来是堆积的，但受限于ggplot2的绘图设计，图形上y轴的刻度线并没有明确的含义，因此可以去掉：</p>
<p>去掉y轴标签的参数是scale_y_continuous()，另外 theme(axis.title.y=element_blank())主要用于移除坐标轴的标签（标签是count)。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(binwidth=<span class="number">0.25</span>) + geom_rug()+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>)+</div><div class="line">  theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/f1i8AlKCjg.png?imageslim" alt="mark"></p>
<p>可以通过加入参数method=”histodot”参数来设置点图的位置： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(method=<span class="string">"histodot"</span>,binwidth=<span class="number">0.25</span>) + geom_rug()+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>)+theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9I3mCcml1i.png?imageslim" alt="mark"></p>
<p>中心堆叠 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + geom_dotplot(binwidth=<span class="number">0.25</span>,stackdir = <span class="string">"center"</span>)+</div><div class="line">  scale_y_continuous(breaks=<span class="literal">NULL</span>) +</div><div class="line">  theme(axis.title.y=element_blank())</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4jKHHdC010.png?imageslim" alt="mark"></p>
<h3 id="基于分组数据绘制分组点图"><a href="#基于分组数据绘制分组点图" class="headerlink" title="基于分组数据绘制分组点图"></a>基于分组数据绘制分组点图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_dotplot(binaxis = <span class="string">"y"</span>,binwidht=<span class="number">0.5</span>,stackdir = <span class="string">"center"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1ejDAkKhdl.png?imageslim" alt="mark"></p>
<h3 id="将箱线图叠加到点图上"><a href="#将箱线图叠加到点图上" class="headerlink" title="将箱线图叠加到点图上"></a>将箱线图叠加到点图上</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_boxplot(outlier.colour=<span class="literal">NA</span>,width=<span class="number">0.5</span>)+</div><div class="line">  geom_dotplot(binaxis=<span class="string">"y"</span>,binwidth =<span class="number">0.5</span>,stackdir=<span class="string">"center"</span>,fill=<span class="literal">NA</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/gaBCeCLkBH.png?imageslim" alt="mark"></p>
<h3 id="将箱线图放在点图旁边"><a href="#将箱线图放在点图旁边" class="headerlink" title="将箱线图放在点图旁边"></a>将箱线图放在点图旁边</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=sex,y=heightIn))+</div><div class="line">  geom_boxplot(aes(x=as.numeric(sex)+<span class="number">0.2</span>,group=sex),width=<span class="number">0.25</span>)+</div><div class="line">  geom_dotplot(aes(x=as.numeric(sex)-<span class="number">0.2</span>,group=sex),binaxis=<span class="string">"y"</span>,bindwidth=<span class="number">0.5</span>,stackdir=<span class="string">"center"</span>)+</div><div class="line">  scale_x_continuous(breaks=<span class="number">1</span>:nlevels(heightweight$sex),labels=levels(heightweight$sex))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3AGE05b840.png?imageslim" alt="mark"></p>
<h2 id="绘制二维数据的图"><a href="#绘制二维数据的图" class="headerlink" title="绘制二维数据的图"></a>绘制二维数据的图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(faithful,aes(x=eruptions,y=waiting))</div><div class="line">p + geom_point()+stat_density2d()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DLhcCBLE92.png?imageslim" alt="mark"></p>
<p>可以用<code>..level..</code>将密度映射给等高线的颜色：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(colour=..level..))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/36JmI1el8j.png?imageslim" alt="mark"></p>
<h2 id="将高度映射为渐变"><a href="#将高度映射为渐变" class="headerlink" title="将高度映射为渐变"></a>将高度映射为渐变</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(fill=..density..),geom=<span class="string">"raster"</span>,contour=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/b4hiHLhBfB.png?imageslim" alt="mark"></p>
<h2 id="将密度估计映射给瓦片颜色-tile"><a href="#将密度估计映射给瓦片颜色-tile" class="headerlink" title="将密度估计映射给瓦片颜色(tile)"></a>将密度估计映射给瓦片颜色(tile)</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + geom_point()+</div><div class="line">  stat_density2d(aes(alpha=..density..),geom=<span class="string">"tile"</span>,contour=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/24jd73Fkeg.png?imageslim" alt="mark"></p>
<p>另外一种图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + stat_density2d(aes(fill=..density..),geom=<span class="string">"raster"</span>,contour=<span class="literal">FALSE</span>,h=c(<span class="number">0.5</span>,<span class="number">5</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g8FlaFhlA6.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/15/R/ggplot2(5) -  折线图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/15/R/ggplot2(5) -  折线图/" itemprop="url">ggplot2(5)-折线图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-15T12:00:00+08:00">
                2017-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,361
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><p>查看数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; BOD</div><div class="line">  Time demand</div><div class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">8.3</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>   <span class="number">10.3</span></div><div class="line"><span class="number">3</span>    <span class="number">3</span>   <span class="number">19.0</span></div><div class="line"><span class="number">4</span>    <span class="number">4</span>   <span class="number">16.0</span></div><div class="line"><span class="number">5</span>    <span class="number">5</span>   <span class="number">15.6</span></div><div class="line"><span class="number">6</span>    <span class="number">7</span>   <span class="number">19.8</span></div></pre></td></tr></table></figure>
<h2 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Ab0d0lkkHf.png?imageslim" alt="mark"></p>
<h2 id="x轴的变量为分类变量的折线图"><a href="#x轴的变量为分类变量的折线图" class="headerlink" title="x轴的变量为分类变量的折线图"></a>x轴的变量为分类变量的折线图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BOD1 &lt;- BOD</div><div class="line">BOD1$Time &lt;- factor(BOD1$Time)</div><div class="line">ggplot(BOD1,aes(x=Time,y=demand,group=<span class="number">1</span>))+geom_line()</div></pre></td></tr></table></figure>
<p>上一段代码中，group=1表示这些数据点属于一组，用一条折线将其连接起来。并且注意与第1张图在x轴坐标上的区别。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2EmbIB7L7d.png?imageslim" alt="mark"></p>
<h2 id="扩大y轴的范围"><a href="#扩大y轴的范围" class="headerlink" title="扩大y轴的范围"></a>扩大y轴的范围</h2><p>下面的这段代码用<code>ylim(0,max(BOD$demand))</code>将y轴的范围进行修改，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()+ylim(<span class="number">0</span>,max(BOD$demand))</div><div class="line"><span class="comment"># 等价于：</span></div><div class="line"><span class="comment"># ggplot(BOD,aes(x=Time,y=demand))+geom_line()+expand_limits(y=0)</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lf5cI2GDFG.png?imageslim" alt="mark"></p>
<h2 id="向折线图添加数据标记"><a href="#向折线图添加数据标记" class="headerlink" title="向折线图添加数据标记"></a>向折线图添加数据标记</h2><h3 id="向折线图中添加数据点"><a href="#向折线图中添加数据点" class="headerlink" title="向折线图中添加数据点"></a>向折线图中添加数据点</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+geom_line()+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0iH6AH6G6B.png?imageslim" alt="mark"></p>
<p>再来看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(worldpop,aes(x=Year,y=Population))+geom_line()+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/h94F1ghmbA.png?imageslim" alt="mark"></p>
<p>可以看到，数据集中在右侧，现在对y取以10为底的对数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(worldpop,aes(x=Year,y=Population))+geom_line() + geom_point() + scale_y_log10()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LKK1FAebKg.png?imageslim" alt="mark"></p>
<h2 id="绘制多重折线图"><a href="#绘制多重折线图" class="headerlink" title="绘制多重折线图"></a>绘制多重折线图</h2><p>下面的代码绘制多重折线图，里面有两个分类用颜色来区分不同的分类(supp) </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">tg &lt;- ddply(ToothGrowth,c(<span class="string">"supp"</span>,<span class="string">"dose"</span>),summarise,length=mean(len))</div><div class="line"><span class="comment"># 这一段话的意思是，对ToothGrowth的数据集进行处理，将其按照supp与dose进行分类，增加一列为length，length的值是分类后的len的值</span></div><div class="line"></div><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Jg04D42ae6.png?imageslim" alt="mark"></p>
<h3 id="用线型-linetype-来区分不同的分类-supp"><a href="#用线型-linetype-来区分不同的分类-supp" class="headerlink" title="用线型(linetype)来区分不同的分类(supp)"></a>用线型(linetype)来区分不同的分类(supp)</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,linetype=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/15kID2lhD0.png?imageslim" alt="mark"></p>
<h3 id="现在将x轴转化为分类变量"><a href="#现在将x轴转化为分类变量" class="headerlink" title="现在将x轴转化为分类变量"></a>现在将x轴转化为分类变量</h3><p>上面的例子中，dose为连续型变量，转化后注意一下x轴的变化。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=factor(dose),y=length,colour=supp,group=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p>注意，上面的代码中，需要加入group=supp这个参数。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/G9AJ5i2JLg.png?imageslim" alt="mark"></p>
<p>现在看一个反例，在这个案例中，没有指定正确的分组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length)) + geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DL40cLEalg.png?imageslim" alt="mark"></p>
<p>当没有指定的分组时，x轴上的每个位置就是对应多个点，ggplot()就会将这些点都放在同一个组中，并且将它们用一根折线连接，开场锯齿状折线图。如果指定任意离散型变量，映射给colour，linetype的话，则会出现折线图的分组，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J5JK6CiDhB.png?imageslim" alt="mark"></p>
<h2 id="修改点的形状"><a href="#修改点的形状" class="headerlink" title="修改点的形状"></a>修改点的形状</h2><p>可以增加点的形状属性（用shape=supp） </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,shape=supp)) + geom_line() + geom_point(size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/k2jJGjkDlj.png?imageslim" alt="mark"></p>
<h2 id="修改点的颜色"><a href="#修改点的颜色" class="headerlink" title="修改点的颜色"></a>修改点的颜色</h2><p>可以增加点的形状属性（用shape=supp） 修改点的颜色的时候，要用到fill参数与shape参数，如只用fill，而不用shape的时候，则颜色不会出现，这个时候只是单纯的一个点，不会出现内部的颜色，只有当shape参数设置后，颜色才能出现。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,fill=supp)) + geom_line() + geom_point(size=<span class="number">4</span>,shape=<span class="number">21</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/jmJbg3dDk9.png?imageslim" alt="mark"></p>
<h2 id="修改颜色属性：错开重复的点："><a href="#修改颜色属性：错开重复的点：" class="headerlink" title="修改颜色属性：错开重复的点："></a>修改颜色属性：错开重复的点：</h2><p>在上一个图形中，右边最后一个点两条折线重合了，现在要改一下，避开两点的重合，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,shape=supp))+</div><div class="line">  geom_line(position=position_dodge(<span class="number">0.2</span>))+ </div><div class="line"><span class="comment"># 将线左右移开0.2，左线往左移，右线往右移</span></div><div class="line">  geom_point(position=position_dodge(<span class="number">0.2</span>),size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ig5m1ebA5l.png?imageslim" alt="mark"></p>
<h2 id="修改线条样式"><a href="#修改线条样式" class="headerlink" title="修改线条样式"></a>修改线条样式</h2><p>线条样式的属性有线型(linetype)、线宽(size)、颜色(colour)。下面的例子是更改线型为虚线(dashed)，蓝色(blue)： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line(linetype=<span class="string">"dashed"</span>,size=<span class="number">1</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9cK5e8138e.png?imageslim" alt="mark"></p>
<p>其它颜色设置，如下所示：</p>
<h3 id="线条颜色"><a href="#线条颜色" class="headerlink" title="线条颜色"></a>线条颜色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp))+</div><div class="line">  geom_line()+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Pastel1"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fh6I08llld.png?imageslim" alt="mark"></p>
<h3 id="线条加粗"><a href="#线条加粗" class="headerlink" title="线条加粗"></a>线条加粗</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,group=supp))+</div><div class="line">  geom_line(colour=<span class="string">"darkgreen"</span>,size=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/if8j8JbFFf.png?imageslim" alt="mark"></p>
<h3 id="虚线加形状"><a href="#虚线加形状" class="headerlink" title="虚线加形状"></a>虚线加形状</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(tg,aes(x=dose,y=length,colour=supp))+</div><div class="line">  geom_line(linetype=<span class="string">"dashed"</span>)+</div><div class="line">  geom_point(shape=<span class="number">22</span>,size=<span class="number">3</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/479i77hiHc.png?imageslim" alt="mark"></p>
<h2 id="修改数据标记"><a href="#修改数据标记" class="headerlink" title="修改数据标记"></a>修改数据标记</h2><p>修改数据点的样式，包括点的大小(size)、颜色(colour)，填充色(fill) </p>
<h3 id="修改颜色与形状"><a href="#修改颜色与形状" class="headerlink" title="修改颜色与形状"></a>修改颜色与形状</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line()+</div><div class="line">  geom_point(size=<span class="number">4</span>,shape=<span class="number">22</span>,colour=<span class="string">"green"</span>,fill=<span class="string">"pink"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/26bBibBJIb.png?imageslim" alt="mark"></p>
<h3 id="修改颜色与形状2"><a href="#修改颜色与形状2" class="headerlink" title="修改颜色与形状2"></a>修改颜色与形状2</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(x=Time,y=demand))+</div><div class="line">  geom_line()+</div><div class="line">  geom_point(size=<span class="number">4</span>,shape=<span class="number">21</span>,fill=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HH76L6ACeJ.png?imageslim" alt="mark"></p>
<h3 id="将不同的分类的标记点修改为不同的属性"><a href="#将不同的分类的标记点修改为不同的属性" class="headerlink" title="将不同的分类的标记点修改为不同的属性"></a>将不同的分类的标记点修改为不同的属性</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pd &lt;- position_dodge(<span class="number">0.2</span>)</div><div class="line">ggplot(tg, aes(x=dose,y=length,fill=supp))+</div><div class="line">  geom_line(position=pd)+</div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">3</span>,position=pd)+</div><div class="line">  scale_fill_manual(values=c(<span class="string">"black"</span>,<span class="string">"white"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/K0aAl088E5.png?imageslim" alt="mark"></p>
<h2 id="绘制面积图"><a href="#绘制面积图" class="headerlink" title="绘制面积图"></a>绘制面积图</h2><h3 id="基础绘图-1"><a href="#基础绘图-1" class="headerlink" title="基础绘图"></a>基础绘图</h3><p>以下的数据集是一个时间序列数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sunspotyear &lt;- data.frame(</div><div class="line">  Year = as.numeric(time(sunspot.year)),</div><div class="line">  Sunspots = as.numeric(sunspot.year)</div><div class="line">)</div><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+geom_area()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J45geE054d.png?imageslim" alt="mark"></p>
<h3 id="修改面积颜色属性"><a href="#修改面积颜色属性" class="headerlink" title="修改面积颜色属性"></a>修改面积颜色属性</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,fill=<span class="string">"green"</span>,alpha=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/C1DHDiEJ1m.png?imageslim" alt="mark"></p>
<h3 id="修改颜色底部边框属性："><a href="#修改颜色底部边框属性：" class="headerlink" title="修改颜色底部边框属性："></a>修改颜色底部边框属性：</h3><p>把上图中的底部横线去掉，即在geom_are()中去掉colour=”black”，此语气的意思是给面积部分加上边框。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/jmdgDihHlC.png?imageslim" alt="mark"></p>
<h3 id="去掉所有边框"><a href="#去掉所有边框" class="headerlink" title="去掉所有边框"></a>去掉所有边框</h3><p>若无geom_line()参数，则图形直接为面积，没有边框： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(sunspotyear,aes(x=Year,y=Sunspots))+</div><div class="line">  geom_area(fill=<span class="string">"green"</span>,alpha=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dEKcaaf7Jg.png?imageslim" alt="mark"></p>
<h2 id="绘制堆积面积图"><a href="#绘制堆积面积图" class="headerlink" title="绘制堆积面积图"></a>绘制堆积面积图</h2><h3 id="基础绘图-2"><a href="#基础绘图-2" class="headerlink" title="基础绘图"></a>基础绘图</h3><p>查看数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">head(uspopage,<span class="number">10</span>) <span class="comment"># 查看uspopage数据集的前10行</span></div><div class="line"></div><div class="line"><span class="comment">##    Year AgeGroup Thousands</span></div><div class="line"><span class="comment">## 1  1900       &lt;5      9181</span></div><div class="line"><span class="comment">## 2  1900     5-14     16966</span></div><div class="line"><span class="comment">## 3  1900    15-24     14951</span></div><div class="line"><span class="comment">## 4  1900    25-34     12161</span></div><div class="line"><span class="comment">## 5  1900    35-44      9273</span></div><div class="line"><span class="comment">## 6  1900    45-54      6437</span></div><div class="line"><span class="comment">## 7  1900    55-64      4026</span></div><div class="line"><span class="comment">## 8  1900      &gt;64      3099</span></div><div class="line"><span class="comment">## 9  1901       &lt;5      9336</span></div><div class="line"><span class="comment">## 10 1901     5-14     17158</span></div><div class="line"></div><div class="line">str(uspopage) <span class="comment"># 查看数据集的格式</span></div><div class="line"></div><div class="line"><span class="comment">## 'data.frame':    824 obs. of  3 variables:</span></div><div class="line"><span class="comment">##  $ Year     : int  1900 1900 1900 1900 1900 1900 1900 1900 1901 1901 ...</span></div><div class="line"><span class="comment">##  $ AgeGroup : Factor w/ 8 levels "&lt;5","5-14","15-24",..: 1 2 3 4 5 6 7 8 1 2 ...</span></div><div class="line"><span class="comment">##  $ Thousands: int  9181 16966 14951 12161 9273 6437 4026 3099 9336 17158 ...</span></div></pre></td></tr></table></figure>
<p>绘图</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup)) + geom_area()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dJBmH9bcKk.png?imageslim" alt="mark"></p>
<p>注意上图中图例的位置，图例中的年龄分组顺序与主图中的年龄分组顺序是相反的。下面的代码将这二者调为一致： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>,breaks=rev(levels(uspopage$AgeGroup)))</div><div class="line"><span class="comment"># rev用于将因子顺序倒置，即将图例中的顺序倒置</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8FHKFac6k4.png?imageslim" alt="mark"></p>
<h3 id="反转堆积图顺序"><a href="#反转堆积图顺序" class="headerlink" title="反转堆积图顺序"></a>反转堆积图顺序</h3><p>上图从下往上是按照年龄由小至大的顺序堆积的，现在按照由大到小堆积： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ccfD7LF2A5.png?imageslim" alt="mark"></p>
<h3 id="desc-函数"><a href="#desc-函数" class="headerlink" title="desc()函数"></a>desc()函数</h3><p>注意上一段代码中的desc()函数，下面为例说明一下： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>) <span class="comment"># 建立一个普通的向量</span></div><div class="line">x</div><div class="line"><span class="comment">##[1] 1 2 3 9 3 2 1</span></div><div class="line">desc(x)</div><div class="line"><span class="comment">## [1] -1 -2 -3 -9 -3 -2 -1</span></div></pre></td></tr></table></figure>
<p>可以发现，desc()的功能是将x中的元素前面加一个负号，x是一个普通的向量，其元素是数值，如果x的元素是因子型向量的话，结果如下：</p>
 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">x &lt;- factor(x)</div><div class="line">x <span class="comment"># 可以发现，x中有四个水平，即1、2、3、9</span></div><div class="line"><span class="comment">## [1] 1 2 3 9 3 2 1</span></div><div class="line"><span class="comment">## Levels: 1 2 3 9</span></div><div class="line">desc(x) <span class="comment"># 这个显示的是x中因子水平的排序的负值</span></div><div class="line"><span class="comment">## [1] -1 -2 -3 -4 -3 -2 -1</span></div></pre></td></tr></table></figure>
<p>再看一个例子，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">y &lt;- factor(c(<span class="string">"a"</span>,<span class="string">"c"</span>,<span class="string">"b"</span>,<span class="string">"b"</span>,<span class="string">"d"</span>))</div><div class="line">str(y)</div><div class="line"><span class="comment">##  Factor w/ 4 levels "a","b","c","d": 1 3 2 2 4</span></div><div class="line">desc(y)</div><div class="line"><span class="comment">## [1] -1 -3 -2 -2 -4</span></div></pre></td></tr></table></figure>
<h3 id="堆叠去掉两边的边框"><a href="#堆叠去掉两边的边框" class="headerlink" title="堆叠去掉两边的边框"></a>堆叠去掉两边的边框</h3><p>将上一个堆叠图中的边框去掉： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="literal">NA</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)+</div><div class="line">  geom_line(position=<span class="string">"stack"</span>,size=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lldaj35AI7.png?imageslim" alt="mark"></p>
<p>上述代码的最后一行是绘制曲线，如果去掉，则剩余的代码只是单纯的堆积图： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup,order=desc(AgeGroup)))+</div><div class="line">  geom_area(colour=<span class="literal">NA</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/FGeh8Hic1B.png?imageslim" alt="mark"></p>
<h2 id="绘制百分比堆积面积图"><a href="#绘制百分比堆积面积图" class="headerlink" title="绘制百分比堆积面积图"></a>绘制百分比堆积面积图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">uspopage_prop &lt;- ddply(uspopage,<span class="string">"Year"</span>,transform,Percent = Thousands/sum(Thousands)*<span class="number">100</span>)</div><div class="line"><span class="comment">#　上段代码的意思是把数据集uspopage中的数据按照Year进行分类，在分类内部，计算每个Thousands所占的百分比，并把计算的结果给Percent</span></div><div class="line">head(uspopage_prop,<span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="comment">##    Year AgeGroup Thousands   Percent</span></div><div class="line"><span class="comment">## 1  1900       &lt;5      9181 12.065340</span></div><div class="line"><span class="comment">## 2  1900     5-14     16966 22.296107</span></div><div class="line"><span class="comment">## 3  1900    15-24     14951 19.648067</span></div><div class="line"><span class="comment">## 4  1900    25-34     12161 15.981549</span></div><div class="line"><span class="comment">## 5  1900    35-44      9273 12.186243</span></div><div class="line"><span class="comment">## 6  1900    45-54      6437  8.459274</span></div><div class="line"><span class="comment">## 7  1900    55-64      4026  5.290825</span></div><div class="line"><span class="comment">## 8  1900      &gt;64      3099  4.072594</span></div><div class="line"><span class="comment">## 9  1901       &lt;5      9336 12.033409</span></div><div class="line"><span class="comment">## 10 1901     5-14     17158 22.115385</span></div></pre></td></tr></table></figure>
<p>绘图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage_prop,aes(x=Year,y=Percent,fill=AgeGroup))+</div><div class="line">  geom_area(colour=<span class="string">"black"</span>,size=<span class="number">0.2</span>,alpha=<span class="number">0.4</span>)+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>,breaks=rev(levels(uspopage$AgeGroup)))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/e5H61AAeml.png?imageslim" alt="mark"></p>
<h2 id="添加置信域"><a href="#添加置信域" class="headerlink" title="添加置信域"></a>添加置信域</h2><p>置信域中用到的数据集是climate，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">head(climate)</div><div class="line"></div><div class="line"><span class="comment">##     Source Year Anomaly1y Anomaly5y Anomaly10y Unc10y</span></div><div class="line"><span class="comment">## 1 Berkeley 1800        NA        NA     -0.435  0.505</span></div><div class="line"><span class="comment">## 2 Berkeley 1801        NA        NA     -0.453  0.493</span></div><div class="line"><span class="comment">## 3 Berkeley 1802        NA        NA     -0.460  0.486</span></div><div class="line"><span class="comment">## 4 Berkeley 1803        NA        NA     -0.493  0.489</span></div><div class="line"><span class="comment">## 5 Berkeley 1804        NA        NA     -0.536  0.483</span></div><div class="line"><span class="comment">## 6 Berkeley 1805        NA        NA     -0.541  0.475</span></div></pre></td></tr></table></figure>
<p>变量Anomaly10y表示的意思是相对于1950-1980平均水平变异的10年移动平均。变量Unc10y表示其95%置信区间。现在令ymax与ymin分别为Anomaly10y加减Unc10y，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">clim &lt;- subset(climate,Source == <span class="string">"Berkeley"</span>,</div><div class="line">               select = c(<span class="string">"Year"</span>,<span class="string">"Anomaly10y"</span>,<span class="string">"Unc10y"</span>))</div><div class="line"><span class="comment"># 上面一段代码表示，取数据集中climate的Source中的Berkeley，并选择其中的Year,Anomaly10y,unc10y</span></div><div class="line">head(clim)</div><div class="line"></div><div class="line"><span class="comment">##   Year Anomaly10y Unc10y</span></div><div class="line"><span class="comment">## 1 1800     -0.435  0.505</span></div><div class="line"><span class="comment">## 2 1801     -0.453  0.493</span></div><div class="line"><span class="comment">## 3 1802     -0.460  0.486</span></div><div class="line"><span class="comment">## 4 1803     -0.493  0.489</span></div><div class="line"><span class="comment">## 5 1804     -0.536  0.483</span></div><div class="line"><span class="comment">## 6 1805     -0.541  0.475</span></div></pre></td></tr></table></figure>
<p>下面绘制置信区间，用到的是geom_ribbon()函数： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lF7lFd2bBa.png?imageslim" alt="mark"></p>
<h3 id="绘制上下边界"><a href="#绘制上下边界" class="headerlink" title="绘制上下边界"></a>绘制上下边界</h3><p>这个例子是用虚线来表示上下置信区间： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(clim,aes(x=Year,y=Anomaly10y))+</div><div class="line">  geom_line(aes(y=Anomaly10y-Unc10y),colour=<span class="string">"grey50"</span>,linetype=<span class="string">"dotted"</span>)+</div><div class="line">  geom_line(aes(y=Anomaly10y+Unc10y),colour=<span class="string">"grey50"</span>,linetype=<span class="string">"dotted"</span>)+</div><div class="line">  geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/7cIJG87f1l.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/14/R/ggplot2(4) - 散点图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/14/R/ggplot2(4) - 散点图/" itemprop="url">ggplot2(4)-散点图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-14T12:00:00+08:00">
                2017-04-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,118
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><p>使用的数据信为<code>gcookhook</code>包中的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(heightweight)</div></pre></td></tr></table></figure>
<p>数据如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight)</div><div class="line">  sex ageYear ageMonth heightIn weightLb</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>      <span class="number">143</span>     <span class="number">56.3</span>     <span class="number">85.0</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>      <span class="number">155</span>     <span class="number">62.3</span>    <span class="number">105.0</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>      <span class="number">153</span>     <span class="number">63.3</span>    <span class="number">108.0</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>      <span class="number">161</span>     <span class="number">59.0</span>     <span class="number">92.0</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>      <span class="number">191</span>     <span class="number">62.5</span>    <span class="number">112.5</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>      <span class="number">171</span>     <span class="number">62.5</span>    <span class="number">112.0</span></div></pre></td></tr></table></figure>
<h2 id="基本散点图"><a href="#基本散点图" class="headerlink" title="基本散点图"></a>基本散点图</h2><p>用到的函数是<code>geom_point()</code>，默认为黑色圆点： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">head(heightweight[,c(<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) </div><div class="line"><span class="comment"># 只显示ageYear与heightIn这两列，等价于heightweight[,c(2,4)]</span></div><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point()</div></pre></td></tr></table></figure>
<p>数据如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight[,c(<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) </div><div class="line">  ageYear heightIn</div><div class="line"><span class="number">1</span>   <span class="number">11.92</span>     <span class="number">56.3</span></div><div class="line"><span class="number">2</span>   <span class="number">12.92</span>     <span class="number">62.3</span></div><div class="line"><span class="number">3</span>   <span class="number">12.75</span>     <span class="number">63.3</span></div><div class="line"><span class="number">4</span>   <span class="number">13.42</span>     <span class="number">59.0</span></div><div class="line"><span class="number">5</span>   <span class="number">15.92</span>     <span class="number">62.5</span></div><div class="line"><span class="number">6</span>   <span class="number">14.25</span>     <span class="number">62.5</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1k58gCCfmE.png?imageslim" alt="mark"></p>
<h2 id="改变形状"><a href="#改变形状" class="headerlink" title="改变形状"></a>改变形状</h2><p>在geom_point()参数中加入shape=21，改为圆点： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point(shape=<span class="number">21</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c7jkgDfLCg.png?imageslim" alt="mark"></p>
<h2 id="改变大小"><a href="#改变大小" class="headerlink" title="改变大小"></a>改变大小</h2><p>在geom_point()参数中加入size=2，将原来的点扩大2倍： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + </div><div class="line">  geom_point(size=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Dj5gcbG9db.png?imageslim" alt="mark"></p>
<p>还可以改变点的其它属性：其它属性包括点形(shape)，颜色(colour)。</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><h3 id="以颜色分组"><a href="#以颜色分组" class="headerlink" title="以颜色分组"></a>以颜色分组</h3><p>把根据性别(sex)进行分组，用不同的颜色把不同性别表示出来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(heightweight[,c(<span class="string">"sex"</span>,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)]) <span class="comment"># 列出要绘图的列</span></div><div class="line">  sex ageYear heightIn</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>     <span class="number">56.3</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>     <span class="number">62.3</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>     <span class="number">63.3</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>     <span class="number">59.0</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>     <span class="number">62.5</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>     <span class="number">62.5</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex)) + </div><div class="line">  geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/H4FAhjDCLg.png?imageslim" alt="mark"></p>
<h3 id="用形状分组"><a href="#用形状分组" class="headerlink" title="用形状分组"></a>用形状分组</h3><p>用不同的形状把不同性别表示出来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex)) + </div><div class="line">  geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CFdHejb2fD.png?imageslim" alt="mark"></p>
<h3 id="用形状和颜色两个图形属性同时分组"><a href="#用形状和颜色两个图形属性同时分组" class="headerlink" title="用形状和颜色两个图形属性同时分组"></a>用形状和颜色两个图形属性同时分组</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex)) + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/aFg545ECke.png?imageslim" alt="mark"></p>
<h3 id="用内置的函数进行形状与颜色的设置"><a href="#用内置的函数进行形状与颜色的设置" class="headerlink" title="用内置的函数进行形状与颜色的设置"></a>用内置的函数进行形状与颜色的设置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex)) + </div><div class="line">  geom_point()+</div><div class="line">  scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">2</span>)) + </div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c03b7A8d1j.png?imageslim" alt="mark"></p>
<h3 id="使用不同于默认设置的点型"><a href="#使用不同于默认设置的点型" class="headerlink" title="使用不同于默认设置的点型"></a>使用不同于默认设置的点型</h3><p>使用参数geom_point()中的shape=可以设置不同的点型：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point(shape=<span class="number">3</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/j65ghFfE4m.png?imageslim" alt="mark"></p>
<h3 id="用scale-shape-manual-来修饰点型"><a href="#用scale-shape-manual-来修饰点型" class="headerlink" title="用scale_shape_manual()来修饰点型"></a>用scale_shape_manual()来修饰点型</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex)) + </div><div class="line">  geom_point(size=<span class="number">3</span>) +</div><div class="line">  scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">4</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/LdILl0kJFj.png?imageslim" alt="mark"></p>
<h2 id="满足某一条的绘图"><a href="#满足某一条的绘图" class="headerlink" title="满足某一条的绘图"></a>满足某一条的绘图</h2><p>下面以heightweight数据集为例，在数据集中增加一个用来标识儿童体重是否超过100磅的列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hw &lt;- heightweight</div><div class="line">hw$weightGroup &lt;- cut(hw$weightLb,breaks=c(-<span class="literal">Inf</span>, <span class="number">100</span>, <span class="literal">Inf</span>),</div><div class="line">                      labels=c(<span class="string">"&lt; 100"</span>, <span class="string">"&gt;=100"</span>))</div><div class="line">head(hw)</div></pre></td></tr></table></figure>
<p>最终数据如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; hw &lt;- heightweight</div><div class="line">&gt; hw$weightGroup &lt;- cut(hw$weightLb,breaks=c(-<span class="literal">Inf</span>, <span class="number">100</span>, <span class="literal">Inf</span>),</div><div class="line">+                       labels=c(<span class="string">"&lt; 100"</span>, <span class="string">"&gt;=100"</span>))</div><div class="line">&gt; head(hw)</div><div class="line">  sex ageYear ageMonth heightIn weightLb weightGroup</div><div class="line"><span class="number">1</span>   f   <span class="number">11.92</span>      <span class="number">143</span>     <span class="number">56.3</span>     <span class="number">85.0</span>       &lt; <span class="number">100</span></div><div class="line"><span class="number">2</span>   f   <span class="number">12.92</span>      <span class="number">155</span>     <span class="number">62.3</span>    <span class="number">105.0</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">3</span>   f   <span class="number">12.75</span>      <span class="number">153</span>     <span class="number">63.3</span>    <span class="number">108.0</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">4</span>   f   <span class="number">13.42</span>      <span class="number">161</span>     <span class="number">59.0</span>     <span class="number">92.0</span>       &lt; <span class="number">100</span></div><div class="line"><span class="number">5</span>   f   <span class="number">15.92</span>      <span class="number">191</span>     <span class="number">62.5</span>    <span class="number">112.5</span>       &gt;=<span class="number">100</span></div><div class="line"><span class="number">6</span>   f   <span class="number">14.25</span>      <span class="number">171</span>     <span class="number">62.5</span>    <span class="number">112.0</span>       &gt;=<span class="number">100</span></div></pre></td></tr></table></figure>
<p>上一段代码中，将hw中的weightLb的数据分开，区间是负无穷(-Inf)到100，100到正无穷(Inf)，将分割的结果给weightGroup，其标签为”&lt; 100”, “&gt;=100” </p>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ggplot(hw,aes(x=ageYear,y=heightIn,shape=sex,fill=weightGroup)) + </div><div class="line">  geom_point(size=<span class="number">2.5</span>)+</div><div class="line">  scale_shape_manual(values=c(<span class="number">21</span>,<span class="number">24</span>)) +scale_fill_manual(values=c(<span class="literal">NA</span>,<span class="string">"black"</span>),guide=guide_legend(override.aes=list(shape=<span class="number">21</span>)))</div><div class="line"><span class="comment"># guide_legend(override.aes=list(shape=21))指定图例中的点</span></div><div class="line"><span class="comment"># scale_shape_manual(values=c(21,24))设置点的</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mjB5d50bkJ.png?imageslim" alt="mark"></p>
<h2 id="用连续型变量映射到点的颜色或大小属性上"><a href="#用连续型变量映射到点的颜色或大小属性上" class="headerlink" title="用连续型变量映射到点的颜色或大小属性上"></a>用连续型变量映射到点的颜色或大小属性上</h2><h3 id="把体重映射到颜色上："><a href="#把体重映射到颜色上：" class="headerlink" title="把体重映射到颜色上："></a>把体重映射到颜色上：</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=weightLb)) + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kbfEm3makA.png?imageslim" alt="mark"></p>
<h3 id="把体重映射到大小上"><a href="#把体重映射到大小上" class="headerlink" title="把体重映射到大小上"></a>把体重映射到大小上</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb)) + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Bm5mg4KHgj.png?imageslim" alt="mark"></p>
<h3 id="精确绘图控制"><a href="#精确绘图控制" class="headerlink" title="精确绘图控制"></a>精确绘图控制</h3><h4 id="连续型图例"><a href="#连续型图例" class="headerlink" title="连续型图例"></a>连续型图例</h4><p>将数值最小值的用黑色表示，数值最高的是白色表示，<code>scale_fill_gradient()</code>用以控制颜色的渐变，这样图例是连续型的： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb)) + </div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">2.5</span>) +</div><div class="line">  scale_fill_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/48Dm0gEdGF.png?imageslim" alt="mark"></p>
<h4 id="离散型图例"><a href="#离散型图例" class="headerlink" title="离散型图例"></a>离散型图例</h4><p>下面的图例是离散的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb)) +</div><div class="line">  geom_point(shape=<span class="number">21</span>,size=<span class="number">2.5</span>) +</div><div class="line">  scale_fill_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>,breaks=seq(<span class="number">70</span>,<span class="number">170</span>,by=<span class="number">20</span>),guide=guide_legend())</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/CIbcGeK6gl.png?imageslim" alt="mark"></p>
<h2 id="避开重复的点"><a href="#避开重复的点" class="headerlink" title="避开重复的点"></a>避开重复的点</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb,colour=sex)) +</div><div class="line">  geom_point(alpha=<span class="number">0.5</span>) +</div><div class="line">  scale_size_area() + <span class="comment"># 把相应的数值与点的面积对应起来</span></div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>) <span class="comment"># 修改颜色</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ddl8gJ1Idi.png?imageslim" alt="mark"></p>
<h2 id="图形重复问题"><a href="#图形重复问题" class="headerlink" title="图形重复问题"></a>图形重复问题</h2><p>先看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EFbbB74C2c.png?imageslim" alt="mark"></p>
<p>上面例子中，点比较多有54000个，有重叠的部分。但可以通过调节点的透明度进行调节： </p>
<p>透明度为0.1： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + geom_point()</div><div class="line">sp + geom_point(alpha=<span class="number">0.1</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/76K63c3fgc.png?imageslim" alt="mark"></p>
<h3 id="另外一种解决数据点重叠的方法"><a href="#另外一种解决数据点重叠的方法" class="headerlink" title="另外一种解决数据点重叠的方法"></a>另外一种解决数据点重叠的方法</h3><p>将数据点进行分箱(bin)，并以矩形来表示，同时将数据点的密度映射为矩形 填充色，stat_bin2d()的功能在于将数据进行分箱，默认的是把每个坐标轴上对应的点分30个箱子，即把数据集分为900个箱子如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + stat_bin2d()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GLL811bC5h.png?imageslim" alt="mark"></p>
<p>分箱数据的进一步优化：</p>
<p>stat_bin2d(bins=52)可以把每个坐标轴的数据点分为52个箱子，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(diamonds,aes(x=carat,y=price))</div><div class="line">sp + stat_bin2d(bins=<span class="number">52</span>) + </div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,limits=c(<span class="number">0</span>,<span class="number">6000</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/FekLf0HfHa.png?imageslim" alt="mark"></p>
<h3 id="分箱数据形状的改变："><a href="#分箱数据形状的改变：" class="headerlink" title="分箱数据形状的改变："></a>分箱数据形状的改变：</h3><p>默认的分箱形状是正方形，可以换一下:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(hexbin) <span class="comment"># 用到里面的函数stat_binhex()</span></div><div class="line">sp + stat_binhex() +</div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,</div><div class="line">                      limits=c(<span class="number">0</span>,<span class="number">8000</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/F9KC562b3F.png?imageslim" alt="mark"></p>
<p>上图的图例是连续型变量，现在改为离散型变量： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sp + stat_binhex() +</div><div class="line">  scale_fill_gradient(low=<span class="string">"lightblue"</span>,high=<span class="string">"red"</span>,</div><div class="line">                    breaks=c(<span class="number">0</span>,<span class="number">250</span>,<span class="number">500</span>,<span class="number">1000</span>,<span class="number">2000</span>,<span class="number">4000</span>,<span class="number">6000</span>),</div><div class="line">                    limits=c(<span class="number">0</span>,<span class="number">6000</span>))+</div><div class="line">   guides(fill=guide_legend(reverse=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6861ffa4cD.png?imageslim" alt="mark"></p>
<h2 id="x轴是离散型变量"><a href="#x轴是离散型变量" class="headerlink" title="x轴是离散型变量"></a>x轴是离散型变量</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp1 &lt;- ggplot(ChickWeight,aes(x=Time,y=weight))</div><div class="line">sp1 + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/49ej2AfB2K.png?imageslim" alt="mark"></p>
<p>上图所示，x轴上的Time是因子型变量，映射到y轴上的点有重复，现在添加geom_point(position=”jitter”)可以添加一定的扰动，避开重复： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_point(position=<span class="string">"jitter"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fA155jH6Lk.png?imageslim" alt="mark"></p>
<p>对振动的程度，也可以进行修饰,width是水平方向的扰动，height是垂直方向上的扰动： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_point(position=position_jitter(width=<span class="number">0.1</span>,height=<span class="number">0</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lKDD7F5mAi.png?imageslim" alt="mark"></p>
<h2 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h2><p>如果x轴是因子型变量，y轴是连续型变量，则用箱线图比较合适： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp1 + geom_boxplot(aes(group=Time))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/2cFb2e7HfE.png?imageslim" alt="mark"></p>
<h2 id="添加回归模型拟合线"><a href="#添加回归模型拟合线" class="headerlink" title="添加回归模型拟合线"></a>添加回归模型拟合线</h2><h3 id="基本绘图"><a href="#基本绘图" class="headerlink" title="基本绘图"></a>基本绘图</h3><p>用stat_smooth()添加置信域，默认的是95%，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))</div><div class="line">sp + geom_point() + stat_smooth(method=lm)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/BA6B50K5De.png?imageslim" alt="mark"></p>
<p>用stat_smooth(method=lm, levels=0.99)可以对置信域进行修改：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point() + stat_smooth(method=lm, levels=<span class="number">0.99</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Ghd92JdlDH.png?imageslim" alt="mark"></p>
<h3 id="去掉置信区间"><a href="#去掉置信区间" class="headerlink" title="去掉置信区间"></a>去掉置信区间</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point() + stat_smooth(method=lm,se=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/0k7A0gfakh.png?imageslim" alt="mark"></p>
<h3 id="置信区间的颜色设置"><a href="#置信区间的颜色设置" class="headerlink" title="置信区间的颜色设置"></a>置信区间的颜色设置</h3><p>将点改为灰色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>)+</div><div class="line">  stat_smooth(method=lm,se=<span class="literal">FALSE</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/k4ijg52ibG.png?imageslim" alt="mark"></p>
<p>置信区间的其他拟合方式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>) + stat_smooth()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GELh0FE8if.png?imageslim" alt="mark"></p>
<p>loess拟合，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_point(colour=<span class="string">"grey60"</span>) + stat_smooth(method=loess)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/c7JeA4fjgj.png?imageslim" alt="mark"></p>
<h2 id="Logistics回归"><a href="#Logistics回归" class="headerlink" title="Logistics回归"></a>Logistics回归</h2><h3 id="数据集-1"><a href="#数据集-1" class="headerlink" title="数据集"></a>数据集</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">b &lt;- biopsy</div><div class="line">b$classen[b$class==<span class="string">"benign"</span>] &lt;- <span class="number">0</span></div><div class="line">b$classen[b$class==<span class="string">"malignant"</span>] &lt;- <span class="number">1</span></div><div class="line">head(b,<span class="number">10</span>)</div></pre></td></tr></table></figure>
<p>数据如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; head(b,<span class="number">10</span>)</div><div class="line">        ID V1 V2 V3 V4 V5 V6 V7 V8 V9     class classen</div><div class="line"><span class="number">1</span>  <span class="number">1000025</span>  <span class="number">5</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">2</span>  <span class="number">1002945</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">7</span> <span class="number">10</span>  <span class="number">3</span>  <span class="number">2</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">3</span>  <span class="number">1015425</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">4</span>  <span class="number">1016277</span>  <span class="number">6</span>  <span class="number">8</span>  <span class="number">8</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">7</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">5</span>  <span class="number">1017023</span>  <span class="number">4</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">6</span>  <span class="number">1017122</span>  <span class="number">8</span> <span class="number">10</span> <span class="number">10</span>  <span class="number">8</span>  <span class="number">7</span> <span class="number">10</span>  <span class="number">9</span>  <span class="number">7</span>  <span class="number">1</span> malignant       <span class="number">1</span></div><div class="line"><span class="number">7</span>  <span class="number">1018099</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span> <span class="number">10</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">8</span>  <span class="number">1018561</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">9</span>  <span class="number">1033078</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">5</span>    benign       <span class="number">0</span></div><div class="line"><span class="number">10</span> <span class="number">1033078</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">1</span>  <span class="number">1</span>    benign       <span class="number">0</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(b,aes(x=V1,y=classen))+</div><div class="line">  geom_point(position=position_jitter(width=<span class="number">0.3</span>,height=<span class="number">0.06</span>),alpha=<span class="number">0.4</span>,shape=<span class="number">21</span>,size=<span class="number">1.5</span>)+</div><div class="line">  stat_smooth(method=glm,method.args = list(family = <span class="string">"binomial"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/5hhGJe8h63.png?imageslim" alt="mark"></p>
<h2 id="有分组变量的的散点图拟合"><a href="#有分组变量的的散点图拟合" class="headerlink" title="有分组变量的的散点图拟合"></a>有分组变量的的散点图拟合</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">sps &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+</div><div class="line">  geom_point() +</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>)</div><div class="line">sps + geom_smooth()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6D9b2eadhK.png?imageslim" alt="mark"></p>
<h2 id="基于数据集对拟合线进行外推："><a href="#基于数据集对拟合线进行外推：" class="headerlink" title="基于数据集对拟合线进行外推："></a>基于数据集对拟合线进行外推：</h2><p>此时需要添加<code>fullrange=TRUE</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3E3cFg4m60.png?imageslim" alt="mark"></p>
<h2 id="向已有散点图添加拟合曲线"><a href="#向已有散点图添加拟合曲线" class="headerlink" title="向已有散点图添加拟合曲线"></a>向已有散点图添加拟合曲线</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">model &lt;- lm(heightIn~ageYear+I(ageYear^<span class="number">2</span>),heightweight)</div><div class="line">model</div><div class="line"><span class="comment"># 创建一个包含变量ageYear的列，并对其进行插值</span></div><div class="line">xmin &lt;- min(heightweight$ageYear)</div><div class="line">xmax &lt;- max(heightweight$ageYear)</div><div class="line">predicted &lt;- data.frame(ageYear=seq(xmin,xmax,length.out = <span class="number">1000</span>))</div><div class="line"><span class="comment"># 计算变量heightIn的预测值</span></div><div class="line">predicted$heightIn &lt;- predict(model,predicted)</div><div class="line">head(predicted)</div><div class="line"><span class="comment">#下面代码是将数据点与模型预测值一起绘制在图形上：</span></div><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn))+</div><div class="line">  geom_point()</div><div class="line">sp + geom_line(data=predicted,size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; model</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = heightIn ~ ageYear + I(ageYear^<span class="number">2</span>), data = heightweight)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line"> (Intercept)       ageYear  I(ageYear^<span class="number">2</span>)  </div><div class="line">    -<span class="number">10.3136</span>        <span class="number">8.6673</span>       -<span class="number">0.2478</span>  </div><div class="line"></div><div class="line">&gt; <span class="comment"># 创建一个包含变量ageYear的列，并对其进行插值</span></div><div class="line">&gt; xmin &lt;- min(heightweight$ageYear)</div><div class="line">&gt; xmax &lt;- max(heightweight$ageYear)</div><div class="line">&gt; predicted &lt;- data.frame(ageYear=seq(xmin,xmax,length.out = <span class="number">1000</span>))</div><div class="line">&gt; <span class="comment"># 计算变量heightIn的预测值</span></div><div class="line">&gt; predicted$heightIn &lt;- predict(model,predicted)</div><div class="line">&gt; head(predicted)</div><div class="line">   ageYear heightIn</div><div class="line"><span class="number">1</span> <span class="number">11.58000</span> <span class="number">56.82624</span></div><div class="line"><span class="number">2</span> <span class="number">11.58593</span> <span class="number">56.84358</span></div><div class="line"><span class="number">3</span> <span class="number">11.59185</span> <span class="number">56.86091</span></div><div class="line"><span class="number">4</span> <span class="number">11.59778</span> <span class="number">56.87822</span></div><div class="line"><span class="number">5</span> <span class="number">11.60370</span> <span class="number">56.89551</span></div><div class="line"><span class="number">6</span> <span class="number">11.60963</span> <span class="number">56.91279</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4Il7KGli1j.png?imageslim" alt="mark"></p>
<h2 id="定义函数绘制拟合曲线"><a href="#定义函数绘制拟合曲线" class="headerlink" title="定义函数绘制拟合曲线"></a>定义函数绘制拟合曲线</h2><p>定义predictvals()函数可以简化向散点图添加模型拟合线的过程。使用时，只需要向其传递一个模型作为参数，该函数就会自动查询变量名、预测变量范围、并返回一个包含预测变量和模型预测值的数据框。将该数据框传递给geom_line()函数，即可绘制出模型拟合线：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 根据模型和变量xvar预测变量yvar</span></div><div class="line"><span class="comment"># 仅支持单一预测变量的模型</span></div><div class="line"><span class="comment"># xrange:x轴范围，当值为NULL时，等于模型对象中提取的x轴范围；当设定为包含两个数字的向量时，两个数字分别对应于x轴的上下限</span></div><div class="line"><span class="comment"># sample: x轴上包含的样本数</span></div><div class="line"><span class="comment"># ...：可传递给predict()函数的其他参数：</span></div><div class="line"></div><div class="line">predictvals &lt;- <span class="keyword">function</span>(model, xvar,yvar,xrange=<span class="literal">NULL</span>,samples=<span class="number">100</span>, <span class="keyword">...</span>)&#123;</div><div class="line">  <span class="comment"># 如果xrange没有输入，则从模型对象中自动提取x轴范围作为参数</span></div><div class="line">  <span class="comment"># 提取xrange参数的方法如下所示</span></div><div class="line">  <span class="keyword">if</span> (is.null(xrange))&#123;</div><div class="line">    <span class="keyword">if</span>(any(class(model)%<span class="keyword">in</span>%c(<span class="string">"lm"</span>,<span class="string">"glm"</span>)))</div><div class="line">      xrange &lt;- range(model$model[[xvar]]) <span class="keyword">else</span> <span class="keyword">if</span>(any(class(model) %<span class="keyword">in</span>% <span class="string">"loess"</span>))</div><div class="line">      xrange &lt;- range(model$x)</div><div class="line">  &#125;</div><div class="line">      </div><div class="line">  newdata &lt;- data.frame(x=seq(xrange[<span class="number">1</span>],xrange[<span class="number">2</span>],length.out=samples))</div><div class="line">  names(newdata) &lt;- xvar</div><div class="line">  newdata[[yvar]] &lt;- predict(model,newdata=newdata,<span class="keyword">...</span>)</div><div class="line">  newdata</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用lm()函数与loess()函数可以对数据集建立线性模型和LOESS模型： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">modlinear &lt;- lm(heightIn~ageYear,heightweight)</div><div class="line">modloess &lt;- loess(heightIn~ageYear,heightweight)</div></pre></td></tr></table></figure>
<p>针对两个模型分别调用predictvals()函数，并将得到的结果（数据框）传递给geom_line()： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">lm_predicted &lt;- predictvals(modlinear,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line">loess_predicted &lt;- predictvals(modloess,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line"></div><div class="line">sp + geom_line(data=lm_predicted,colour=<span class="string">"red"</span>,size=<span class="number">0.8</span>)+</div><div class="line">  geom_line(data=loess_predicted,colour=<span class="string">"blue"</span>,size=<span class="number">0.8</span>)+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/5Jk913106L.png?imageslim" alt="mark"></p>
<p>另外一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">b &lt;- biopsy</div><div class="line"></div><div class="line">b$classn[b$class==<span class="string">"benign"</span>] &lt;- <span class="number">0</span></div><div class="line">b$classn[b$class==<span class="string">"malignant"</span>] &lt;- <span class="number">1</span></div><div class="line"></div><div class="line">fitlogistic &lt;- glm(classn ~ V1,b,family=binomial)</div><div class="line"></div><div class="line"><span class="comment"># 获得预测值 </span></div><div class="line">glm_predicted &lt;- predictvals(fitlogistic,<span class="string">"V1"</span>,<span class="string">"classn"</span>,type=<span class="string">"response"</span>)</div><div class="line"></div><div class="line">ggplot(b,aes(x=V1,y=classn))+</div><div class="line">  geom_point(position=position_jitter(width=<span class="number">0.3</span>,height=<span class="number">0.08</span>),alpha=<span class="number">0.4</span>,shape=<span class="number">21</span>,size=<span class="number">1.5</span>)+</div><div class="line">  geom_line(data=glm_predicted,colour=<span class="string">"blue"</span>,size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/Jjlellf6ge.png?imageslim" alt="mark"></p>
<h2 id="添加来自多个模型的拟合线"><a href="#添加来自多个模型的拟合线" class="headerlink" title="添加来自多个模型的拟合线"></a>添加来自多个模型的拟合线</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">make_model &lt;- <span class="keyword">function</span>(data)&#123;</div><div class="line">  lm(heightIn~ageYear,data)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">models&lt;- dlply(heightweight,<span class="string">"sex"</span>,.fun=make_model)</div><div class="line"></div><div class="line"><span class="comment"># 有了模型对象之后，配合使用ldply()函数和predictvals()函数即可获取两个模型对应的预测值</span></div><div class="line"></div><div class="line">predvals &lt;- ldply(models,.fun=predictvals,xvar=<span class="string">"ageYear"</span>,yvar=<span class="string">"heightIn"</span>)</div><div class="line">head(predvals)</div></pre></td></tr></table></figure>
<p>查看数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(predvals)</div><div class="line">  sex  ageYear heightIn</div><div class="line"><span class="number">1</span>   f <span class="number">11.58000</span> <span class="number">57.96250</span></div><div class="line"><span class="number">2</span>   f <span class="number">11.63980</span> <span class="number">58.03478</span></div><div class="line"><span class="number">3</span>   f <span class="number">11.69960</span> <span class="number">58.10707</span></div><div class="line"><span class="number">4</span>   f <span class="number">11.75939</span> <span class="number">58.17936</span></div><div class="line"><span class="number">5</span>   f <span class="number">11.81919</span> <span class="number">58.25165</span></div><div class="line"><span class="number">6</span>   f <span class="number">11.87899</span> <span class="number">58.32394</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+</div><div class="line">  geom_point()+</div><div class="line">  geom_line(data=predvals)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/AdKdI2K6ge.png?imageslim" alt="mark"></p>
<p>上图中男性的数据点（即m颜色的点）终止于年龄最大点，女性的数据点（即f的颜色点）终止于女性组中年龄的最大点，为了使两组预测线对应的x轴范围与整个数据集的范围相同，可以向其传递一个xrange参数： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">predvals &lt;- ldply(models,.fun=predictvals,xvar=<span class="string">"ageYear"</span>,yvar=<span class="string">"heightIn"</span>,xrange=range(heightweight$ageYear))</div><div class="line"></div><div class="line">ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+geom_point()+geom_line(data=predvals)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3mGgba6ih8.png?imageslim" alt="mark"></p>
<h2 id="向散点图中添加模型系数"><a href="#向散点图中添加模型系数" class="headerlink" title="向散点图中添加模型系数"></a>向散点图中添加模型系数</h2><p>如果需要向拟合曲线中添加系数，则如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">model &lt;- lm(heightIn~ageYear,heightweight)</div><div class="line">summary(model)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; summary(model)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = heightIn ~ ageYear, data = heightweight)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">    Min      1Q  Median      3Q     Max </div><div class="line">-<span class="number">8.3517</span> -<span class="number">1.9006</span>  <span class="number">0.1378</span>  <span class="number">1.9071</span>  <span class="number">8.3371</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">(Intercept)  <span class="number">37.4356</span>     <span class="number">1.8281</span>   <span class="number">20.48</span>   &lt;<span class="number">2e-16</span> ***</div><div class="line">ageYear       <span class="number">1.7483</span>     <span class="number">0.1329</span>   <span class="number">13.15</span>   &lt;<span class="number">2e-16</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">2.989</span> on <span class="number">234</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.4249</span>,	Adjusted R-squared:  <span class="number">0.4225</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">172.9</span> on <span class="number">1</span> and <span class="number">234</span> DF,  p-value: &lt; <span class="number">2.2e-16</span></div></pre></td></tr></table></figure>
<p>由分析结果可知，模型的R^2=0.4249，则可以用annotate()函数将其添加到曲线上： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pred &lt;- predictvals(model,<span class="string">"ageYear"</span>,<span class="string">"heightIn"</span>)</div><div class="line">sp &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn)) + geom_point()+geom_line(data=pred)</div><div class="line">sp+annotate(<span class="string">"text"</span>,label=<span class="string">"r^2=0.42"</span>,x=<span class="number">16.5</span>,y=<span class="number">52</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HbeFJh2f5m.png?imageslim" alt="mark"></p>
<p>如果不想使用纯文本字符串当注释的话，可以通过设置parse=TRUE调用R的数学表达式来输入公式： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + annotate(<span class="string">"text"</span>,label=<span class="string">"r^2==0.42"</span>,parse=<span class="literal">TRUE</span>,x=<span class="number">16.5</span>,y=<span class="number">52</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/8G959ILifI.png?imageslim" alt="mark"></p>
<h2 id="添加公式"><a href="#添加公式" class="headerlink" title="添加公式"></a>添加公式</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">eqn &lt;- as.character(as.expression(</div><div class="line">  substitute(italic(y)==a+b*italic(x)*<span class="string">","</span>~~italic(r)^<span class="number">2</span>~<span class="string">"="</span>~r2,</div><div class="line">             list(a=format(coef(model)[<span class="number">1</span>],digits=<span class="number">3</span>),</div><div class="line">                  b=format(coef(model)[<span class="number">2</span>],digits=<span class="number">3</span>),</div><div class="line">                  r2=format(summary(model)$r.squared,digits=<span class="number">2</span>)))</div><div class="line">))</div><div class="line"></div><div class="line">parse(text=eqn)</div><div class="line"></div><div class="line"><span class="comment">## expression(italic(y) == "37.4" + "1.75" * italic(x) * "," ~ ~italic(r)^2 ~ </span></div><div class="line"><span class="comment">##     "=" ~ "0.42")</span></div><div class="line"></div><div class="line">sp + annotate(<span class="string">"text"</span>,label=eqn,parse=<span class="literal">TRUE</span>,x=<span class="literal">Inf</span>,y=-<span class="literal">Inf</span>,hjust=<span class="number">1.1</span>,vjust=-<span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/h80ijJa15b.png?imageslim" alt="mark"></p>
<h2 id="向散点图添加边际地毯"><a href="#向散点图添加边际地毯" class="headerlink" title="向散点图添加边际地毯"></a>向散点图添加边际地毯</h2><p>用到的函数是geom_rug(),以faithful数据集为例说明： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(faithful)</div><div class="line">  eruptions waiting</div><div class="line"><span class="number">1</span>     <span class="number">3.600</span>      <span class="number">79</span></div><div class="line"><span class="number">2</span>     <span class="number">1.800</span>      <span class="number">54</span></div><div class="line"><span class="number">3</span>     <span class="number">3.333</span>      <span class="number">74</span></div><div class="line"><span class="number">4</span>     <span class="number">2.283</span>      <span class="number">62</span></div><div class="line"><span class="number">5</span>     <span class="number">4.533</span>      <span class="number">85</span></div><div class="line"><span class="number">6</span>     <span class="number">2.883</span>      <span class="number">55</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point() + geom_rug()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4dg2eLaIdI.png?imageslim" alt="mark"></p>
<h2 id="添加扰动，避免重叠"><a href="#添加扰动，避免重叠" class="headerlink" title="添加扰动，避免重叠"></a>添加扰动，避免重叠</h2><p>上图中的waiting中的边际地毯线有重叠的（虽然看起来很稀疏，其实都重叠在了一起），因此通过向边际地毯线的位置坐标添加扰动并设定size减少线宽可以减轻边际地毯线的重叠程度。如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point()+geom_rug(position=<span class="string">"jitter"</span>,size=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/HhGC4L4249.png?imageslim" alt="mark"></p>
<h2 id="向散点图添加标签"><a href="#向散点图添加标签" class="headerlink" title="向散点图添加标签"></a>向散点图添加标签</h2><p>用annotate()可以向数据点中添加标签，以countries数据集为例说明，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">data1 &lt;- subset(countries,Year==<span class="number">2009</span>&amp;healthexp&gt;<span class="number">2000</span>)</div><div class="line">head(data1)</div></pre></td></tr></table></figure>
<p>数据如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(data1)</div><div class="line">          Name Code Year      GDP laborrate healthexp infmortality</div><div class="line"><span class="number">254</span>    Andorra  AND <span class="number">2009</span>       <span class="literal">NA</span>        <span class="literal">NA</span>  <span class="number">3089.636</span>          <span class="number">3.1</span></div><div class="line"><span class="number">560</span>  Australia  AUS <span class="number">2009</span> <span class="number">42130.82</span>      <span class="number">65.2</span>  <span class="number">3867.429</span>          <span class="number">4.2</span></div><div class="line"><span class="number">611</span>    Austria  AUT <span class="number">2009</span> <span class="number">45555.43</span>      <span class="number">60.4</span>  <span class="number">5037.311</span>          <span class="number">3.6</span></div><div class="line"><span class="number">968</span>    Belgium  BEL <span class="number">2009</span> <span class="number">43640.20</span>      <span class="number">53.5</span>  <span class="number">5104.019</span>          <span class="number">3.6</span></div><div class="line"><span class="number">1733</span>    Canada  CAN <span class="number">2009</span> <span class="number">39599.04</span>      <span class="number">67.8</span>  <span class="number">4379.761</span>          <span class="number">5.2</span></div><div class="line"><span class="number">2702</span>   Denmark  DNK <span class="number">2009</span> <span class="number">55933.35</span>      <span class="number">65.4</span>  <span class="number">6272.729</span>          <span class="number">3.4</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sp &lt;- ggplot(data1,aes(x=healthexp,y=infmortality))+geom_point()</div><div class="line">sp + annotate(<span class="string">"text"</span>,x=<span class="number">4350</span>,y=<span class="number">5.4</span>,label=<span class="string">"Canada"</span>)+annotate(<span class="string">"text"</span>,x=<span class="number">7400</span>,y=<span class="number">6.8</span>,label=<span class="string">"USA"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1mLfGhhBAh.png?imageslim" alt="mark"></p>
<h3 id="如果要向每一个数据点添加标签，如下所示："><a href="#如果要向每一个数据点添加标签，如下所示：" class="headerlink" title="如果要向每一个数据点添加标签，如下所示："></a>如果要向每一个数据点添加标签，如下所示：</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/eJiiFhD8e1.png?imageslim" alt="mark"></p>
<h3 id="对数据点的标签进行微调"><a href="#对数据点的标签进行微调" class="headerlink" title="对数据点的标签进行微调"></a>对数据点的标签进行微调</h3><p>vjust=0时，标签文本的基线会与数据点对齐，设定vjust=1时，标签文本的顶部会与数据点对齐。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),vjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/I1ahDLKc34.png?imageslim" alt="mark"></p>
<h3 id="添加y的取值"><a href="#添加y的取值" class="headerlink" title="添加y的取值"></a>添加y的取值</h3><p>也可以添加y的映射来进行微调 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(y=infmortality+<span class="number">0.1</span>,label=Name),size=<span class="number">4</span>,vjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/bDHI5dm4BG.png?imageslim" alt="mark"></p>
<h3 id="左对齐"><a href="#左对齐" class="headerlink" title="左对齐"></a>左对齐</h3><p>添加参数hjust=0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>,hjust=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/m13kI4jGjK.png?imageslim" alt="mark"></p>
<h3 id="右对齐"><a href="#右对齐" class="headerlink" title="右对齐"></a>右对齐</h3><p>添加参数hjust=1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sp + geom_text(aes(label=Name),size=<span class="number">4</span>,hjust=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><strong><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/ggLiALF7h5.png?imageslim" alt="mark"></strong></p>
<h3 id="有针对性的增加标签"><a href="#有针对性的增加标签" class="headerlink" title="有针对性的增加标签"></a>有针对性的增加标签</h3><p>如果只想给为个别数据点添加标签，但希望R自动设定标签位置的话，可以给数据框增加一个只包含拟使用的标签的新列。一个可行的方案是：首先，将所用数据复制一个副本，并将Name复制为Name1 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">data1$Name1 &lt;- data1$Name</div><div class="line">idx &lt;- data1$Name1 %<span class="keyword">in</span>% c(<span class="string">"Canada"</span>,<span class="string">"Ireland"</span>,<span class="string">"United Kingdom"</span>,<span class="string">"United States"</span>,<span class="string">"New Zealand"</span>,<span class="string">"Iceland"</span>,<span class="string">"Japan"</span>,<span class="string">"Luxembourg"</span>,<span class="string">"Netherlands"</span>,<span class="string">"Switzerland"</span>)</div><div class="line">idx</div><div class="line"></div><div class="line"><span class="comment">##  [1] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE</span></div><div class="line"><span class="comment">## [12]  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></div><div class="line"><span class="comment">## [23] FALSE FALSE  TRUE  TRUE  TRUE</span></div><div class="line">data1$Name1[!idx] &lt;- <span class="literal">NA</span></div><div class="line"><span class="comment"># 把需要的标签留下</span></div><div class="line"></div><div class="line">head(data1)</div><div class="line"></div><div class="line"><span class="comment">##           Name Code Year      GDP laborrate healthexp infmortality  Name1</span></div><div class="line"><span class="comment">## 254    Andorra  AND 2009       NA        NA  3089.636          3.1   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 560  Australia  AUS 2009 42130.82      65.2  3867.429          4.2   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 611    Austria  AUT 2009 45555.43      60.4  5037.311          3.6   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 968    Belgium  BEL 2009 43640.20      53.5  5104.019          3.6   &lt;NA&gt;</span></div><div class="line"><span class="comment">## 1733    Canada  CAN 2009 39599.04      67.8  4379.761          5.2 Canada</span></div><div class="line"><span class="comment">## 2702   Denmark  DNK 2009 55933.35      65.4  6272.729          3.4   &lt;NA&gt;</span></div><div class="line"></div><div class="line">ggplot(data1,aes(x=healthexp,y=infmortality))+</div><div class="line">  geom_point()+</div><div class="line">  geom_text(aes(x=healthexp+<span class="number">100</span>,label=Name1),size=<span class="number">4</span>,hjust=<span class="number">0</span>)+</div><div class="line">  xlim(<span class="number">2000</span>,<span class="number">10000</span>)</div><div class="line"></div><div class="line"><span class="comment">## Warning in loop_apply(n, do.ply): Removed 17 rows containing missing</span></div><div class="line"><span class="comment">## values (geom_text).</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/g47B8cfc7L.png?imageslim" alt="mark"></p>
<p>注意<code>%in%</code>的功能，此符号的功能是如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">12</span>)</div><div class="line">y &lt;- c(<span class="number">1</span>,<span class="number">5</span>,<span class="number">12</span>)</div><div class="line">x%<span class="keyword">in</span>%y</div><div class="line"></div><div class="line"><span class="comment">##  [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</span></div><div class="line"><span class="comment">## [12]  TRUE</span></div><div class="line"></div><div class="line">x[x%<span class="keyword">in</span>%y] <span class="comment"># 找出x中包含y的元素</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  1  5  5  5  5 12</span></div></pre></td></tr></table></figure>
<p>可以看出，%in%的功能是在x中查找y，如果有则为TRUE，若无则为FALSE。</p>
<h2 id="气泡图"><a href="#气泡图" class="headerlink" title="气泡图"></a>气泡图</h2><p>气泡图的每个面积正比于变量值 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">data2 &lt;- subset(countries,Year==<span class="number">2009</span>&amp;Name %<span class="keyword">in</span>% c(<span class="string">"Canada"</span>,<span class="string">"Ireland"</span>,<span class="string">"United Kingdom"</span>,<span class="string">"United States"</span>,<span class="string">"New Zealand"</span>,<span class="string">"Iceland"</span>,<span class="string">"Japan"</span>,<span class="string">"Luxembourg"</span>,<span class="string">"Netherlands"</span>,<span class="string">"Switzerland"</span>))</div><div class="line"></div><div class="line">head(data2)</div><div class="line"></div><div class="line"><span class="comment">##             Name Code Year       GDP laborrate healthexp infmortality</span></div><div class="line"><span class="comment">## 1733      Canada  CAN 2009  39599.04      67.8  4379.761          5.2</span></div><div class="line"><span class="comment">## 4436     Iceland  ISL 2009  37972.24      77.5  3130.391          1.7</span></div><div class="line"><span class="comment">## 4691     Ireland  IRL 2009  49737.93      63.6  4951.845          3.4</span></div><div class="line"><span class="comment">## 4946       Japan  JPN 2009  39456.44      59.5  3321.466          2.4</span></div><div class="line"><span class="comment">## 5864  Luxembourg  LUX 2009 106252.24      55.5  8182.855          2.2</span></div><div class="line"><span class="comment">## 7088 Netherlands  NLD 2009  48068.35      66.1  5163.740          3.8</span></div><div class="line"></div><div class="line"><span class="comment"># 如果把GDP映射给size，则表示把GDP映射给了点的半径，并非面积，如下所示：</span></div><div class="line">p &lt;- ggplot(data2,aes(x=healthexp,y=infmortality,size=GDP))+</div><div class="line">  geom_point(shape=<span class="number">21</span>,colour=<span class="string">"black"</span>,fill=<span class="string">"cornsilk"</span>)</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kDFgD1dl31.png?imageslim" alt="mark"></p>
<p>如果想要把数据点的值映射给面积，用到的函数是scale_size_area() </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_size_area(max_size=<span class="number">15</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/J55h36mm6D.png?imageslim" alt="mark"></p>
<h3 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h3><p>当x轴与y轴都为分类变量时，气泡图可以用来表示风格点上的变量值，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 以HairEyeColor数据集为例</span></div><div class="line">HairEyeColor</div><div class="line"></div><div class="line"><span class="comment">## , , Sex = Male</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##        Eye</span></div><div class="line"><span class="comment">## Hair    Brown Blue Hazel Green</span></div><div class="line"><span class="comment">##   Black    32   11    10     3</span></div><div class="line"><span class="comment">##   Brown    53   50    25    15</span></div><div class="line"><span class="comment">##   Red      10   10     7     7</span></div><div class="line"><span class="comment">##   Blond     3   30     5     8</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , Sex = Female</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##        Eye</span></div><div class="line"><span class="comment">## Hair    Brown Blue Hazel Green</span></div><div class="line"><span class="comment">##   Black    36    9     5     2</span></div><div class="line"><span class="comment">##   Brown    66   34    29    14</span></div><div class="line"><span class="comment">##   Red      16    7     7     7</span></div><div class="line"><span class="comment">##   Blond     4   64     5     8</span></div><div class="line"></div><div class="line">hec &lt;- HairEyeColor[,,<span class="string">"Male"</span>] + HairEyeColor[,,<span class="string">"Female"</span>]</div><div class="line"><span class="keyword">library</span>(reshape2)</div><div class="line"></div><div class="line">hec &lt;- melt(hec,value.name=<span class="string">"count"</span>)</div><div class="line"></div><div class="line">ggplot(hec,aes(x=Eye,y=Hair))+</div><div class="line">  geom_point(aes(size=count),shape=<span class="number">21</span>,colour=<span class="string">"black"</span>,fill=<span class="string">"cornsilk"</span>)+</div><div class="line">  scale_size_area(max_size=<span class="number">20</span>,guide=<span class="literal">FALSE</span>)+</div><div class="line">  geom_text(aes(y=as.numeric(Hair)-sqrt(count)/<span class="number">22</span>,label=count),vjust=<span class="number">1</span>,colour=<span class="string">"grey60"</span>,size=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/6bcEJikla4.png?imageslim" alt="mark"></p>
<h2 id="绘制散点矩阵图"><a href="#绘制散点矩阵图" class="headerlink" title="绘制散点矩阵图"></a>绘制散点矩阵图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">c2009 &lt;- subset(countries,Year == <span class="number">2009</span>,</div><div class="line">                select = c(Name,GDP,laborrate,healthexp,infmortality))</div><div class="line"></div><div class="line">head(c2009)</div><div class="line"></div><div class="line"><span class="comment">##               Name      GDP laborrate  healthexp infmortality</span></div><div class="line"><span class="comment">## 50     Afghanistan       NA      59.8   50.88597        103.2</span></div><div class="line"><span class="comment">## 101        Albania 3772.605      59.5  264.60406         17.2</span></div><div class="line"><span class="comment">## 152        Algeria 4022.199      58.5  267.94653         32.0</span></div><div class="line"><span class="comment">## 203 American Samoa       NA        NA         NA           NA</span></div><div class="line"><span class="comment">## 254        Andorra       NA        NA 3089.63589          3.1</span></div><div class="line"><span class="comment">## 305         Angola 4068.576      81.3  203.80787         99.9</span></div><div class="line"></div><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>])</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d6E58FEJjE.png?imageslim" alt="mark"></p>
<p>上面的绘图没有使用ggplot2，是因为它不能绘制散点图矩阵（至少绘制的效果不佳），上述绘图过得也可以使用自定义的面板函数，现在我们定义一个<code>panel.cor</code>函数来展示变量两两之间的相关系数，以代替默认的散点图。相关系数较大的位置将对应较大的字符，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">panel.cor &lt;- <span class="keyword">function</span>(x,y,digits=<span class="number">2</span>, prefix=<span class="string">""</span>,cex.cor,<span class="keyword">...</span>)&#123;</div><div class="line">  usr &lt;- par(<span class="string">"usr"</span>)</div><div class="line">  on.exit(par(<span class="string">"usr"</span>))</div><div class="line">  par(usr=c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>))</div><div class="line">  r &lt;- abs(cor(x,y,use=<span class="string">"complete.obs"</span>))</div><div class="line">  txt &lt;- format(c(r,<span class="number">0.123456789</span>),digits=digits)[<span class="number">1</span>]</div><div class="line">  txt &lt;- paste(prefix, txt, sep=<span class="string">""</span>)</div><div class="line">  <span class="keyword">if</span>(missing(cex.cor)) cex.cor &lt;- <span class="number">0.8</span>/strwidth(txt)</div><div class="line">  text(<span class="number">0.5</span>,<span class="number">0.5</span>,txt,cex=cex.cor*(<span class="number">1</span>+r)/<span class="number">2</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了在面板的对角线上展示各个变量的直方图，我们再定义一个<code>panel.hist</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">panel.hist &lt;- <span class="keyword">function</span>(x,<span class="keyword">...</span>)&#123;</div><div class="line">  usr &lt;-par(<span class="string">"usr"</span>)</div><div class="line">  on.exit(par(usr))</div><div class="line">  par(usr=c(usr[<span class="number">1</span>:<span class="number">2</span>],<span class="number">0</span>,<span class="number">1.5</span>))</div><div class="line">  h&lt;-hist(x,plot=<span class="literal">FALSE</span>)</div><div class="line">  breaks&lt;-h$breaks</div><div class="line">  nB &lt;- length(breaks)</div><div class="line">  y&lt;-h$counts</div><div class="line">  y&lt;-y/max(y)</div><div class="line">  rect(breaks[-nB],<span class="number">0</span>,breaks[-<span class="number">1</span>],y,col=<span class="string">"white"</span>,<span class="keyword">...</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的函数都源于<code>pairs</code>函数的帮助页面，可以直接复制这个函数的相关代码，定义了这些函数后，我们哦可以高骼它来绘制散点图矩阵。令<code>pairs()</code>函数在面板的上三角执行<code>panel.cor</code>函数，在面板的对角线执行<code>panel.hist</code>函数，在绘图时也添加了一些东西，在面板的下三角执行<code>panel.smooth</code>函数，这个函数将在散点图矩阵的下三角绘制散点图，并添加一个LOWESS平滑曲线，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>],upper.panel=panel.cor,</div><div class="line">      diag.panel = panel.hist,</div><div class="line">      lower.panel = panel.smooth)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d591DFbe6G.png?imageslim" alt="mark"></p>
<p>也许我们希望用线性模型来代替LOWESS模型，<code>panel.lm</code>函数可以完成该操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">panel.lm &lt;- <span class="keyword">function</span>(x,y,col=par(<span class="string">"col"</span>),bg=<span class="literal">NA</span>,pch=par(<span class="string">"pch"</span>),</div><div class="line">                     cex=<span class="number">1</span>,col.smooth=<span class="string">"black"</span>,<span class="keyword">...</span>)&#123;</div><div class="line">  points(x,y,pch=pch,col=col,bg=bg,cex=cex)</div><div class="line">  abline(stats::lm(y~x),col=col.smooth,<span class="keyword">...</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这次系统默认的线条颜色不再是红色，而是黑色，调用函数<code>pairs()</code>时（与函数panel.smooth配合使用），设定col.smooth参数可以对线条颜色进行修改，为了便于辩认数据点，我们在图中使用更小的点，该操作可以通过<code>pch=&quot;.&quot;</code>来实现，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pairs(c2009[,<span class="number">2</span>:<span class="number">5</span>],pch=<span class="string">"."</span>,</div><div class="line">        upper.panel=panel.cor,</div><div class="line">        diag.panel = panel.hist,</div><div class="line">        lower.panel = panel.lm)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kH91kDg75H.png?imageslim" alt="mark"></p>
<p>cex参数可以控制图中点的大小，cex参数的默认值是1，其值越大，数据点越大，但如果cex小于0.5，那么图形输出为PDF文件时可能无法很好地渲染。</p>
<h3 id="GGally包的ggpairs函数"><a href="#GGally包的ggpairs函数" class="headerlink" title="GGally包的ggpairs函数"></a>GGally包的ggpairs函数</h3><p>使用GGally包的ggpairs函数也能绘制散点矩阵图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggpairs(c2009[,<span class="number">2</span>:<span class="number">5</span>])</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/387lC2aCf1.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/13/R/ggplot2(3) - 条形图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/13/R/ggplot2(3) - 条形图/" itemprop="url">ggplot2(3)-条形图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T12:00:00+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,173
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(pg_mean)</div></pre></td></tr></table></figure>
<h2 id="简单绘图"><a href="#简单绘图" class="headerlink" title="简单绘图"></a>简单绘图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group, y=weight))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/39AEB9lKag.png?imageslim" alt="mark"></p>
<p>代码解释：<code>geom_bar()</code>表示绘制的是条形图，geom是图形的意思，例如点、线、多边形等。</p>
<h2 id="x轴变量类型"><a href="#x轴变量类型" class="headerlink" title="x轴变量类型"></a>x轴变量类型</h2><p>条形图的x轴变量是离散型变量，如果数据集中的是连续型变量，则需要用factor()转化为因子型变量，以下是未转化前的图形： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; BOD</div><div class="line">  Time demand</div><div class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">8.3</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>   <span class="number">10.3</span></div><div class="line"><span class="number">3</span>    <span class="number">3</span>   <span class="number">19.0</span></div><div class="line"><span class="number">4</span>    <span class="number">4</span>   <span class="number">16.0</span></div><div class="line"><span class="number">5</span>    <span class="number">5</span>   <span class="number">15.6</span></div><div class="line"><span class="number">6</span>    <span class="number">7</span>   <span class="number">19.8</span></div><div class="line">str(BOD)</div><div class="line"><span class="comment">## 'data.frame':    6 obs. of  2 variables:</span></div><div class="line"><span class="comment">##  $ Time  : num  1 2 3 4 5 7</span></div><div class="line"><span class="comment">##  $ demand: num  8.3 10.3 19 16 15.6 19.8</span></div><div class="line"><span class="comment">##  - attr(*, "reference")= chr "A1.4, p. 270"</span></div></pre></td></tr></table></figure>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD, aes(x=Time, y=demand)) + geom_bar(stat=<span class="string">"identity"</span>)</div><div class="line"><span class="comment"># 绘图函数里的stat参数表示对样本点做统计的方式，默认为identity，表示一个x对应一个y，同时还可以是bin，表示一个x对应落到该x的样本数。”说白了就是，identity提取横坐标x对应的y值，bin提取横坐标x的频数</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fGG5Cg7FJm.png?imageslim" alt="mark"></p>
<p>现在将Time转化为factor，再进行绘图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD, aes(x=factor(Time), y=demand)) + geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/DCj3bhdhJ5.png?imageslim" alt="mark"></p>
<h2 id="颜色填充"><a href="#颜色填充" class="headerlink" title="颜色填充"></a>颜色填充</h2><p>以下的代码中，将上述条形图的颜色进行调整，用浅蓝色进行填充，用黑色描边： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=<span class="string">"identity"</span>,fill=<span class="string">"lightblue"</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3DII8mK842.png?imageslim" alt="mark"></p>
<h2 id="簇状条形图"><a href="#簇状条形图" class="headerlink" title="簇状条形图"></a>簇状条形图</h2><p>此例子中用gcookbook包中的cabbage_exp数据集。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">head(cabbage_exp) <span class="comment"># 查看数据集</span></div><div class="line"></div><div class="line"><span class="comment">##   Cultivar Date Weight        sd  n         se</span></div><div class="line"><span class="comment">## 1      c39  d16   3.18 0.9566144 10 0.30250803</span></div><div class="line"><span class="comment">## 2      c39  d20   2.80 0.2788867 10 0.08819171</span></div><div class="line"><span class="comment">## 3      c39  d21   2.74 0.9834181 10 0.31098410</span></div><div class="line"><span class="comment">## 4      c52  d16   2.26 0.4452215 10 0.14079141</span></div><div class="line"><span class="comment">## 5      c52  d20   3.11 0.7908505 10 0.25008887</span></div><div class="line"><span class="comment">## 6      c52  d21   1.47 0.2110819 10 0.06674995</span></div></pre></td></tr></table></figure>
<p>绘图:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/1ai3a40Lf4.png?imageslim" alt="mark"></p>
<p>注意参数中的position=”dodge”,若无此参数，则Cultivar的两个变量会叠加，dodge意思是“避开”，即添加上此参数，两个变量避开，若无此参数，图像如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/B86jc4gi7a.png?imageslim" alt="mark"></p>
<h2 id="颜色的设置"><a href="#颜色的设置" class="headerlink" title="颜色的设置"></a>颜色的设置</h2><p><code>RColorBrewer</code>包中有各种颜色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(position=<span class="string">"dodge"</span>,stat=<span class="string">"identity"</span>,colour=<span class="string">"red"</span>)+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/a7lHji8jIE.png?imageslim" alt="mark"></p>
<h2 id="频数条形图："><a href="#频数条形图：" class="headerlink" title="频数条形图："></a>频数条形图：</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds,aes(x=cut))+geom_bar()</div><div class="line"><span class="comment"># 等价于geom_bar(stat="bin")</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/78k6FK49ba.png?imageslim" alt="mark"></p>
<p>geom_bar()默认情况下参数为stat=”bin”,当x轴的变量是分类变量，即因子型向量时此函数会自动计算每组变量对应的观测数，如上图所示，如果x是连续型变量，则出现的是直方图，如下图所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds,aes(x=carat))+geom_bar()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/JmB59jHK17.png?imageslim" alt="mark"></p>
<h2 id="对条形图进行上色"><a href="#对条形图进行上色" class="headerlink" title="对条形图进行上色"></a>对条形图进行上色</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">upc &lt;- subset(uspopchange,rank(Change)&gt;<span class="number">40</span>) <span class="comment"># rank()是秩的顺序</span></div><div class="line">upc</div><div class="line"></div><div class="line"><span class="comment">##             State Abb Region Change</span></div><div class="line"><span class="comment">## 3         Arizona  AZ   West   24.6</span></div><div class="line"><span class="comment">## 6        Colorado  CO   West   16.9</span></div><div class="line"><span class="comment">## 10        Florida  FL  South   17.6</span></div><div class="line"><span class="comment">## 11        Georgia  GA  South   18.3</span></div><div class="line"><span class="comment">## 13          Idaho  ID   West   21.1</span></div><div class="line"><span class="comment">## 29         Nevada  NV   West   35.1</span></div><div class="line"><span class="comment">## 34 North Carolina  NC  South   18.5</span></div><div class="line"><span class="comment">## 41 South Carolina  SC  South   15.3</span></div><div class="line"><span class="comment">## 44          Texas  TX  South   20.6</span></div><div class="line"><span class="comment">## 45           Utah  UT   West   23.8</span></div><div class="line"></div><div class="line">ggplot(upc,aes(x=Abb,y=Change,fill=Region))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4gfdb1Fgel.png?imageslim" alt="mark"></p>
<p>还可以使用颜色代码进行上色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(upc,aes(x=reorder(Abb,Change),y=Change,fill=Region))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+scale_fill_manual(values=c(<span class="string">"#669933"</span>,<span class="string">"#FFCC66"</span>))+xlab(<span class="string">"State"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/GaIj74gldg.png?imageslim" alt="mark"></p>
<h3 id="正负条形图上色"><a href="#正负条形图上色" class="headerlink" title="正负条形图上色"></a>正负条形图上色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">csub &lt;- subset(climate,Source==<span class="string">"Berkeley"</span> &amp; Year &gt;= <span class="number">1900</span>)</div><div class="line">csub$pos &lt;- csub$Anomaly10y&gt;=<span class="number">0</span> <span class="comment"># 将正数转化为T，负数转化为F</span></div><div class="line">ggplot(csub,aes(x=Year,y=Anomaly10y,fill=pos))+geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/e5f5i1FDcj.png?imageslim" alt="mark"></p>
<h3 id="调节上色顺序"><a href="#调节上色顺序" class="headerlink" title="调节上色顺序"></a>调节上色顺序</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(csub,aes(x=Year,y=Anomaly10y,fill=pos))+geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>,size=<span class="number">0.25</span>)+scale_fill_manual(values=c(<span class="string">"#CCEEFF"</span>,<span class="string">"#FFDDDD"</span>),guide=<span class="literal">FALSE</span>) </div><div class="line"><span class="comment"># guide=FALSE消除图例</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/kBjgj3CL5m.png?imageslim" alt="mark"></p>
<h2 id="调节条形图之间的间距"><a href="#调节条形图之间的间距" class="headerlink" title="调节条形图之间的间距"></a>调节条形图之间的间距</h2><p>先看一下原始图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/E7IC0G9g2H.png?imageslim" alt="mark"></p>
<p>将间隔改为0.5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=&quot;identity&quot;,width=0.5)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/fLkE3B9eK1.png?imageslim" alt="mark"></p>
<p>将间隔改为1（最大）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(pg_mean,aes(x=group,y=weight))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/3mB7gHb9Ke.png?imageslim" alt="mark"></p>
<h2 id="簇状条形图间隔的改变"><a href="#簇状条形图间隔的改变" class="headerlink" title="簇状条形图间隔的改变"></a>簇状条形图间隔的改变</h2><p>原始图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">0.5</span>,position=<span class="string">"dodge"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/9Fd1706dK8.png?imageslim" alt="mark"></p>
<p>更改：参数是position=position_dodge() </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,width=<span class="number">0.5</span>,position=position_dodge(<span class="number">0.7</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/la15DgB2fd.png?imageslim" alt="mark"></p>
<h2 id="堆积条形图"><a href="#堆积条形图" class="headerlink" title="堆积条形图"></a>堆积条形图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/IJ32CHkGGK.png?imageslim" alt="mark"></p>
<p>注意图例中的变化，guides(fill=guide_legend(reverse=TRUE)) </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)+guides(fill=guide_legend(reverse=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/dgI1chIBD1.png?imageslim" alt="mark"></p>
<h3 id="调整堆叠的顺序"><a href="#调整堆叠的顺序" class="headerlink" title="调整堆叠的顺序"></a>调整堆叠的顺序</h3><p>用于plyr包中desc()函数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar,order=desc(Cultivar)))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lE2ceGfm4A.png?imageslim" alt="mark"></p>
<h3 id="堆叠图的美化"><a href="#堆叠图的美化" class="headerlink" title="堆叠图的美化"></a>堆叠图的美化</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/K8679g72D3.png?imageslim" alt="mark"></p>
<h2 id="绘制百分比条形图"><a href="#绘制百分比条形图" class="headerlink" title="绘制百分比条形图"></a>绘制百分比条形图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ce &lt;- ddply(cabbage_exp,<span class="string">"Date"</span>,transform,percent_weight=Weight/sum(Weight)*<span class="number">100</span>)</div><div class="line">ggplot(ce,aes(x=Date,y=percent_weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/gc6I6cFa4C.png?imageslim" alt="mark"></p>
<h3 id="百分比条形图的美化"><a href="#百分比条形图的美化" class="headerlink" title="百分比条形图的美化"></a>百分比条形图的美化</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(ce,aes(x=Date,y=percent_weight,fill=Cultivar))+geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+scale_fill_brewer(palette=<span class="string">"Pastell"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/H7mHL1m448.png?imageslim" alt="mark"></p>
<h2 id="添加数据标签"><a href="#添加数据标签" class="headerlink" title="添加数据标签"></a>添加数据标签</h2><p>标签在条形图顶端下方： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/E653ABHfFG.png?imageslim" alt="mark"></p>
<p>标签在条形图顶端上方：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=-<span class="number">0.2</span>,colour=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/497kEJa3d4.png?imageslim" alt="mark"></p>
<h2 id="调节y轴与标签："><a href="#调节y轴与标签：" class="headerlink" title="调节y轴与标签："></a>调节y轴与标签：</h2><p>调节y轴的上限</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(label=Weight),vjust=-<span class="number">0.2</span>)+ylim(<span class="number">0</span>,max(cabbage_exp$Weight)*<span class="number">1.05</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/EK3HJfHDB5.png?imageslim" alt="mark"></p>
<p>设定标签的y轴位置使其高于条形图顶端</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=interaction(Date,Cultivar),y=Weight))+geom_bar(stat=<span class="string">"identity"</span>)+geom_text(aes(y=Weight+<span class="number">0.1</span>,label=Weight))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/mfJBL0iiC7.png?imageslim" alt="mark"></p>
<h3 id="簇状条形图的标签设置"><a href="#簇状条形图的标签设置" class="headerlink" title="簇状条形图的标签设置"></a>簇状条形图的标签设置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+</div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"dodge"</span>)+</div><div class="line">  geom_text(aes(label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>,position=position_dodge(<span class="number">0.9</span>),size=<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/7l82689Ih5.png?imageslim" alt="mark"></p>
<h3 id="堆积簇状条形图的标签设置-位于顶端"><a href="#堆积簇状条形图的标签设置-位于顶端" class="headerlink" title="堆积簇状条形图的标签设置-位于顶端"></a>堆积簇状条形图的标签设置-位于顶端</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)) </div><div class="line"><span class="comment"># cumsum累积加，例如cumsum(seq(1,10))</span></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_text(aes(y=label_y,label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/icHJlJLD71.png?imageslim" alt="mark"></p>
<h3 id="堆积簇状条形图的标签设置-位于中央"><a href="#堆积簇状条形图的标签设置-位于中央" class="headerlink" title="堆积簇状条形图的标签设置-位于中央"></a>堆积簇状条形图的标签设置-位于中央</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)-<span class="number">0.5</span>*Weight) </div><div class="line"></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>)+</div><div class="line">  geom_text(aes(y=label_y,label=Weight),vjust=<span class="number">1.5</span>,colour=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4aiE3aF1JA.png?imageslim" alt="mark"></p>
<h3 id="堆积簇状条形图的标签设置-添加单位"><a href="#堆积簇状条形图的标签设置-添加单位" class="headerlink" title="堆积簇状条形图的标签设置-添加单位"></a>堆积簇状条形图的标签设置-添加单位</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ce &lt;- arrange(cabbage_exp,Date,Cultivar)</div><div class="line">ce &lt;- ddply(ce,<span class="string">"Date"</span>,transform,label_y=cumsum(Weight)-<span class="number">0.5</span>*Weight) </div><div class="line"></div><div class="line">ggplot(ce,aes(x=Date,y=Weight,fill=Cultivar))+  </div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>)+</div><div class="line">    geom_text(aes(y=label_y,label=paste(format(Weight,nsmall=<span class="number">2</span>),<span class="string">"kg"</span>)),size=<span class="number">4</span>)+</div><div class="line">  guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/G9cb2G07cE.png?imageslim" alt="mark"></p>
<h2 id="绘制Cleveland图"><a href="#绘制Cleveland图" class="headerlink" title="绘制Cleveland图"></a>绘制Cleveland图</h2><h3 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h3><p>用到的是geom_point()，先看一个最基本的图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tophit &lt;- tophitters2001[<span class="number">1</span>:<span class="number">25</span>,]</div><div class="line">ggplot(tophit,aes(x=avg,y=name))+geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/4Kg4mI5DI4.png?imageslim" alt="mark"></p>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>上图是用字母顺序来排列的，下面的图是用avg的大小来排列的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=avg,y=reorder(name,avg)))+</div><div class="line">  geom_point(size=<span class="number">3</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.x=element_blank(),</div><div class="line">       panel.grid.minor.x=element_blank(),</div><div class="line">       panel.grid.major.y=element_line(colour=<span class="string">"grey60"</span>,linetype=<span class="string">"dashed"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/A0JG3lE4Ef.png?imageslim" alt="mark"></p>
<h3 id="x轴与y轴互换"><a href="#x轴与y轴互换" class="headerlink" title="x轴与y轴互换"></a>x轴与y轴互换</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=reorder(name,avg),y=avg))+</div><div class="line">  geom_point(size=<span class="number">3</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(axis.text.x = element_text(angle=<span class="number">60</span>,hjust=<span class="number">1</span>),</div><div class="line">        panel.grid.major.y=element_blank(),</div><div class="line">        panel.grid.minor.y=element_blank(),</div><div class="line">        panel.grid.major.x=element_line(colour=<span class="string">"grey60"</span>,linetype=<span class="string">"dashed"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/d7Jg63c9fk.png?imageslim" alt="mark"></p>
<h3 id="火柴杆图"><a href="#火柴杆图" class="headerlink" title="火柴杆图"></a>火柴杆图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">nameorder &lt;- tophit$name[order(tophit$lg,tophit$avg)]</div><div class="line">tophit$name &lt;- factor(tophit$name,levels=nameorder)</div><div class="line">&gt; head(tophit)</div><div class="line">         id   first   last           name year stint team lg   g  ab   r   h 2b 3b hr rbi sb cs</div><div class="line"><span class="number">1</span> walkela01   Larry Walker   Larry Walker <span class="number">2001</span>     <span class="number">1</span>  COL NL <span class="number">142</span> <span class="number">497</span> <span class="number">107</span> <span class="number">174</span> <span class="number">35</span>  <span class="number">3</span> <span class="number">38</span> <span class="number">123</span> <span class="number">14</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span> suzukic01  Ichiro Suzuki  Ichiro Suzuki <span class="number">2001</span>     <span class="number">1</span>  SEA AL <span class="number">157</span> <span class="number">692</span> <span class="number">127</span> <span class="number">242</span> <span class="number">34</span>  <span class="number">8</span>  <span class="number">8</span>  <span class="number">69</span> <span class="number">56</span> <span class="number">14</span></div><div class="line"><span class="number">3</span> giambja01   Jason Giambi   Jason Giambi <span class="number">2001</span>     <span class="number">1</span>  OAK AL <span class="number">154</span> <span class="number">520</span> <span class="number">109</span> <span class="number">178</span> <span class="number">47</span>  <span class="number">2</span> <span class="number">38</span> <span class="number">120</span>  <span class="number">2</span>  <span class="number">0</span></div><div class="line"><span class="number">4</span> alomaro01 Roberto Alomar Roberto Alomar <span class="number">2001</span>     <span class="number">1</span>  CLE AL <span class="number">157</span> <span class="number">575</span> <span class="number">113</span> <span class="number">193</span> <span class="number">34</span> <span class="number">12</span> <span class="number">20</span> <span class="number">100</span> <span class="number">30</span>  <span class="number">6</span></div><div class="line"><span class="number">5</span> heltoto01    Todd Helton    Todd Helton <span class="number">2001</span>     <span class="number">1</span>  COL NL <span class="number">159</span> <span class="number">587</span> <span class="number">132</span> <span class="number">197</span> <span class="number">54</span>  <span class="number">2</span> <span class="number">49</span> <span class="number">146</span>  <span class="number">7</span>  <span class="number">5</span></div><div class="line"><span class="number">6</span>  aloumo01  Moises   Alou    Moises Alou <span class="number">2001</span>     <span class="number">1</span>  HOU NL <span class="number">136</span> <span class="number">513</span>  <span class="number">79</span> <span class="number">170</span> <span class="number">31</span>  <span class="number">1</span> <span class="number">27</span> <span class="number">108</span>  <span class="number">5</span>  <span class="number">1</span></div><div class="line">   bb  so ibb hbp sh sf gidp    avg</div><div class="line"><span class="number">1</span>  <span class="number">82</span> <span class="number">103</span>   <span class="number">6</span>  <span class="number">14</span>  <span class="number">0</span>  <span class="number">8</span>    <span class="number">9</span> <span class="number">0.3501</span></div><div class="line"><span class="number">2</span>  <span class="number">30</span>  <span class="number">53</span>  <span class="number">10</span>   <span class="number">8</span>  <span class="number">4</span>  <span class="number">4</span>    <span class="number">3</span> <span class="number">0.3497</span></div><div class="line"><span class="number">3</span> <span class="number">129</span>  <span class="number">83</span>  <span class="number">24</span>  <span class="number">13</span>  <span class="number">0</span>  <span class="number">9</span>   <span class="number">17</span> <span class="number">0.3423</span></div><div class="line"><span class="number">4</span>  <span class="number">80</span>  <span class="number">71</span>   <span class="number">5</span>   <span class="number">4</span>  <span class="number">9</span>  <span class="number">9</span>    <span class="number">9</span> <span class="number">0.3357</span></div><div class="line"><span class="number">5</span>  <span class="number">98</span> <span class="number">104</span>  <span class="number">15</span>   <span class="number">5</span>  <span class="number">1</span>  <span class="number">5</span>   <span class="number">14</span> <span class="number">0.3356</span></div><div class="line"><span class="number">6</span>  <span class="number">57</span>  <span class="number">57</span>  <span class="number">14</span>   <span class="number">3</span>  <span class="number">0</span>  <span class="number">8</span>   <span class="number">18</span> <span class="number">0.3314</span></div><div class="line"></div><div class="line"></div><div class="line">ggplot(tophit,aes(x=avg,y=name))+</div><div class="line">  geom_segment(aes(yend=name),xend=<span class="number">0</span>,colour=<span class="string">"grey"</span>)+</div><div class="line">  geom_point(size=<span class="number">3</span>,aes(colour=lg))+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>,limits=c(<span class="string">"NL"</span>,<span class="string">"AL"</span>))+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.y=element_blank(),</div><div class="line">        legend.position=c(<span class="number">1</span>,<span class="number">0.55</span>),</div><div class="line">        legend.justification=c(<span class="number">1</span>,<span class="number">0.5</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/lH339B2F9b.png?imageslim" alt="mark"></p>
<p>注：order()函数的意思是，把原向量的元素按从小到大排列，输出原来向量的所在位置，而sort()则是把原向量的元素从小到大排列，输出元素值。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a&lt;-c(<span class="number">3</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">19</span>)</div><div class="line">sort(a) <span class="comment"># sort(); 输出排序后的结果</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  0  3  9 12 19</span></div><div class="line"></div><div class="line">order(a) <span class="comment"># 输出排序后的各个向量位置</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3 1 2 4 5</span></div><div class="line"></div><div class="line"><span class="comment"># 3表示原向量中第3个元素排在第1位，1的意思是原向量中第1个排在第2位，</span></div></pre></td></tr></table></figure>
<h3 id="以队为分组变量进行分面"><a href="#以队为分组变量进行分面" class="headerlink" title="以队为分组变量进行分面"></a>以队为分组变量进行分面</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit,aes(x=avg,y=name))+</div><div class="line">  geom_segment(aes(yend=name),xend=<span class="number">0</span>,colour=<span class="string">"grey50"</span>)+</div><div class="line">  geom_point(size=<span class="number">3</span>,aes(colour=lg))+</div><div class="line">  scale_colour_brewer(palette=<span class="string">"Set1"</span>,limits=c(<span class="string">"NL"</span>,<span class="string">"AL"</span>),guide=<span class="literal">FALSE</span>)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.grid.major.y=element_blank())+</div><div class="line">  facet_grid(lg~.,scales=<span class="string">"free_y"</span>,space=<span class="string">"free_y"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180831/hbf22CLj19.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/08/R/R笔记（8）-dplyr笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/08/R/R笔记（8）-dplyr笔记/" itemprop="url">R笔记（8）——dplyr笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-08T12:00:00+08:00">
                2017-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,308
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"dplyr"</span>)</div><div class="line"><span class="keyword">library</span>(dplyr)</div></pre></td></tr></table></figure>
<h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><p>现在使用<code>datasets</code>包中的<code>ChickWeight</code>数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(datasets)</div><div class="line">&gt; dim(ChickWeight)</div><div class="line">[<span class="number">1</span>] <span class="number">578</span>   <span class="number">4</span></div><div class="line">&gt; head(ChickWeight)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line">&gt; str(ChickWeight)</div><div class="line">Classes ‘nfnGroupedData’, ‘nfGroupedData’, ‘groupedData’ and <span class="string">'data.frame'</span>:	<span class="number">578</span> obs. of  <span class="number">4</span> variables:</div><div class="line"> $ weight: num  <span class="number">42</span> <span class="number">51</span> <span class="number">59</span> <span class="number">64</span> <span class="number">76</span> <span class="number">93</span> <span class="number">106</span> <span class="number">125</span> <span class="number">149</span> <span class="number">171</span> <span class="keyword">...</span></div><div class="line"> $ Time  : num  <span class="number">0</span> <span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">10</span> <span class="number">12</span> <span class="number">14</span> <span class="number">16</span> <span class="number">18</span> <span class="keyword">...</span></div><div class="line"> $ Chick : Ord.factor w/ <span class="number">50</span> levels <span class="string">"18"</span>&lt;<span class="string">"16"</span>&lt;<span class="string">"15"</span>&lt;..: <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="number">15</span> <span class="keyword">...</span></div><div class="line"> $ Diet  : Factor w/ <span class="number">4</span> levels <span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div><div class="line"> - attr(*, <span class="string">"formula"</span>)=Class <span class="string">'formula'</span>  language weight ~ Time | Chick</div><div class="line">  .. ..- attr(*, <span class="string">".Environment"</span>)=&lt;environment: R_EmptyEnv&gt; </div><div class="line"> - attr(*, <span class="string">"outer"</span>)=Class <span class="string">'formula'</span>  language ~Diet</div><div class="line">  .. ..- attr(*, <span class="string">".Environment"</span>)=&lt;environment: R_EmptyEnv&gt; </div><div class="line"> - attr(*, <span class="string">"labels"</span>)=List of <span class="number">2</span></div><div class="line">  ..$ x: chr <span class="string">"Time"</span></div><div class="line">  ..$ y: chr <span class="string">"Body weight"</span></div><div class="line"> - attr(*, <span class="string">"units"</span>)=List of <span class="number">2</span></div><div class="line">  ..$ x: chr <span class="string">"(days)"</span></div><div class="line">  ..$ y: chr <span class="string">"(gm)"</span></div></pre></td></tr></table></figure>
<p>从上面结果可以看出来，ChickWeight含有4个变量，分别为数值型变量weight，数值型变量Time，因子型变量Chick，因子型变量Diet。</p>
<h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p>dplyr包中的count函数可以进行计数，用法为<code>count(x, ..., wt = NULL, sort = FALSE)</code>，其中<code>x</code>是目标数据集，<code>...</code>是数据集中的变量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; count(ChickWeight,Diet)</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet      n</div><div class="line">  &lt;fct&gt; &lt;int&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>       <span class="number">220</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>       <span class="number">120</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>       <span class="number">120</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>       <span class="number">118</span></div></pre></td></tr></table></figure>
<h2 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h2><p>summaryise()，用法为<code>summarise(.data, ...)</code>，其中<code>.data</code>是数据集，<code>...</code>是需要汇总的函数，用法如下所示</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; summarise(ChickWeight,mean(weight,na.rm=<span class="literal">TRUE</span>))</div><div class="line">  mean(weight, na.rm = <span class="literal">TRUE</span>)</div><div class="line"><span class="number">1</span>                   <span class="number">121.8183</span></div><div class="line">&gt; summarise(ChickWeight,mean(Time,na.rm=<span class="literal">TRUE</span>),min(weight))</div><div class="line">  mean(Time, na.rm = <span class="literal">TRUE</span>) min(weight)</div><div class="line"><span class="number">1</span>                 <span class="number">10.71799</span>          <span class="number">35</span></div></pre></td></tr></table></figure>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p><code>group_by</code>，用法为<code>group_by(.data, ..., add = FALSE)</code>，其中<code>.data</code>是数据集，<code>...</code>是分组对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; CW_g1 &lt;- group_by(ChickWeight,Diet)</div><div class="line">&gt; CW_g1</div><div class="line"><span class="comment"># A tibble: 578 x 4</span></div><div class="line"><span class="comment"># Groups:   Diet [4]</span></div><div class="line">   weight  Time Chick Diet </div><div class="line"> *  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;</div><div class="line"> <span class="number">1</span>     <span class="number">42</span>     <span class="number">0</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">2</span>     <span class="number">51</span>     <span class="number">2</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">3</span>     <span class="number">59</span>     <span class="number">4</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">4</span>     <span class="number">64</span>     <span class="number">6</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">5</span>     <span class="number">76</span>     <span class="number">8</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">6</span>     <span class="number">93</span>    <span class="number">10</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">7</span>    <span class="number">106</span>    <span class="number">12</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">8</span>    <span class="number">125</span>    <span class="number">14</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"> <span class="number">9</span>    <span class="number">149</span>    <span class="number">16</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"><span class="number">10</span>    <span class="number">171</span>    <span class="number">18</span> <span class="number">1</span>     <span class="number">1</span>    </div><div class="line"><span class="comment"># ... with 568 more rows</span></div></pre></td></tr></table></figure>
<p>group_by可以和summarise连用，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; summarise(group_by(ChickWeight,Diet),mean(Time,na.rm=<span class="literal">TRUE</span>))</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet  `mean(Time, na.rm = TRUE)`</div><div class="line">  &lt;fct&gt;                      &lt;dbl&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>                           <span class="number">10.5</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>                           <span class="number">10.8</span></div></pre></td></tr></table></figure>
<h2 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h2><p><code>filter()</code>函数，用法为<code>filter(.data, ...)</code>。举例说明，如下所示：</p>
<p>挑选出weight大于等于40的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F1 &lt;- filter(ChickWeight,weight &gt;= <span class="number">40</span>)</div><div class="line">&gt; head(CW_F1)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>挑选出weight大于等于40，并且Time大于等于2的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F2&lt;- filter(ChickWeight,weight &gt;= <span class="number">40</span>,Time&gt;=<span class="number">2</span>)</div><div class="line">&gt; head(CW_F2)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>    <span class="number">106</span>   <span class="number">12</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>挑选出Diet为1的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F3&lt;- filter(ChickWeight,Diet==<span class="number">1</span>)</div><div class="line">&gt; head(CW_F3)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>操行出Diet为1或3的数据，此时需要使用<code>%in%</code>符号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CW_F4&lt;- filter(ChickWeight,Diet %<span class="keyword">in</span>% c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">CW_F4</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/f52fB772k9.png?imageslim" alt="mark"></p>
<p>挑选出Chick为2，Diet为1的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_F5&lt;- filter(ChickWeight,Diet==<span class="number">1</span>,Chick==<span class="number">2</span>)</div><div class="line">&gt; head(CW_F5)</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>     <span class="number">40</span>    <span class="number">0</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>     <span class="number">49</span>    <span class="number">2</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>     <span class="number">58</span>    <span class="number">4</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>     <span class="number">72</span>    <span class="number">6</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>     <span class="number">84</span>    <span class="number">8</span>     <span class="number">2</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>    <span class="number">103</span>   <span class="number">10</span>     <span class="number">2</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="挑选满足条件的某一列"><a href="#挑选满足条件的某一列" class="headerlink" title="挑选满足条件的某一列"></a>挑选满足条件的某一列</h2><p>filter在使用时，它是将满足某一条件的整个数据集都给拿了出来，而select函数则是只将某一列拿出来，例如我们现在只将weight和Diet挑选出来，并与filter对比一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>排列某一列，只选择剩下的部分，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,-weight))</div><div class="line">  Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<p>除去某2列，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,-weight,-Diet))</div><div class="line">  Time Chick</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span></div></pre></td></tr></table></figure>
<p>选择从Time到Diet这之间的列，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(select(ChickWeight,Time:Diet))</div><div class="line">  Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">3</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">5</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span></div><div class="line"><span class="number">6</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="相加"><a href="#相加" class="headerlink" title="相加"></a>相加</h2><p><code>mutate()</code>可以添加不同的列，现在我们在原始数据后面加上一列，名称是Diff，列的内容是该行weight值与weight均值之差，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; CW_m1 &lt;- mutate(ChickWeight,Diff=(weight-mean(weight)))</div><div class="line">&gt; head(CW_m1)</div><div class="line">  weight Time Chick Diet      Diff</div><div class="line"><span class="number">1</span>     <span class="number">42</span>    <span class="number">0</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">79.81834</span></div><div class="line"><span class="number">2</span>     <span class="number">51</span>    <span class="number">2</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">70.81834</span></div><div class="line"><span class="number">3</span>     <span class="number">59</span>    <span class="number">4</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">62.81834</span></div><div class="line"><span class="number">4</span>     <span class="number">64</span>    <span class="number">6</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">57.81834</span></div><div class="line"><span class="number">5</span>     <span class="number">76</span>    <span class="number">8</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">45.81834</span></div><div class="line"><span class="number">6</span>     <span class="number">93</span>   <span class="number">10</span>     <span class="number">1</span>    <span class="number">1</span> -<span class="number">28.81834</span></div></pre></td></tr></table></figure>
<h2 id="管道命令"><a href="#管道命令" class="headerlink" title="管道命令"></a>管道命令</h2><p><code>%in%</code>是dplyr的管道命令，可以将几个函数串联起来。看下面的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; CW_p1 &lt;- ChickWeight%&gt;%</div><div class="line">+   filter(Chick!=c(<span class="number">15</span>,<span class="number">18</span>,<span class="number">20</span>,<span class="number">17</span>))%&gt;%</div><div class="line">+   group_by(Diet)%&gt;%</div><div class="line">+   summarise(mean(Time,na.rm=<span class="literal">TRUE</span>))</div><div class="line">Warning messages:</div><div class="line"><span class="number">1</span>: In is.na(e1) | is.na(e2) :</div><div class="line">  longer object length is not a multiple of shorter object length</div><div class="line"><span class="number">2</span>: In `!=.default`(Chick, c(<span class="number">15</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">17</span>)) :</div><div class="line">  longer object length is not a multiple of shorter object length</div><div class="line">&gt; CW_p1</div><div class="line"><span class="comment"># A tibble: 4 x 2</span></div><div class="line">  Diet  `mean(Time, na.rm = TRUE)`</div><div class="line">  &lt;fct&gt;                      &lt;dbl&gt;</div><div class="line"><span class="number">1</span> <span class="number">1</span>                           <span class="number">10.5</span></div><div class="line"><span class="number">2</span> <span class="number">2</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">3</span> <span class="number">3</span>                           <span class="number">10.9</span></div><div class="line"><span class="number">4</span> <span class="number">4</span>                           <span class="number">10.8</span></div></pre></td></tr></table></figure>
<p>再看一案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CW_p2 &lt;- ChickWeight%&gt;%</div><div class="line">  filter(weight&gt;=<span class="number">50</span>,Diet!=<span class="number">1</span>)%&gt;%</div><div class="line">  mutate(DiffTime=(Time-mean(Time,na.rm=<span class="literal">TRUE</span>)))%&gt;%</div><div class="line">  select(Diet:DiffTime)</div><div class="line">head(CW_p2)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(CW_p2)</div><div class="line">  Diet    DiffTime</div><div class="line"><span class="number">1</span>    <span class="number">2</span> -<span class="number">10.2310127</span></div><div class="line"><span class="number">2</span>    <span class="number">2</span>  -<span class="number">8.2310127</span></div><div class="line"><span class="number">3</span>    <span class="number">2</span>  -<span class="number">6.2310127</span></div><div class="line"><span class="number">4</span>    <span class="number">2</span>  -<span class="number">4.2310127</span></div><div class="line"><span class="number">5</span>    <span class="number">2</span>  -<span class="number">2.2310127</span></div><div class="line"><span class="number">6</span>    <span class="number">2</span>  -<span class="number">0.2310127</span></div></pre></td></tr></table></figure>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p><code>arrange()</code>可以将数据集进行排序，用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(arrange(ChickWeight,desc(weight)))</div><div class="line">  weight Time Chick Diet</div><div class="line"><span class="number">1</span>    <span class="number">373</span>   <span class="number">21</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">2</span>    <span class="number">361</span>   <span class="number">20</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">3</span>    <span class="number">341</span>   <span class="number">21</span>    <span class="number">34</span>    <span class="number">3</span></div><div class="line"><span class="number">4</span>    <span class="number">332</span>   <span class="number">18</span>    <span class="number">35</span>    <span class="number">3</span></div><div class="line"><span class="number">5</span>    <span class="number">331</span>   <span class="number">21</span>    <span class="number">21</span>    <span class="number">2</span></div><div class="line"><span class="number">6</span>    <span class="number">327</span>   <span class="number">20</span>    <span class="number">34</span>    <span class="number">3</span></div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://mp.weixin.qq.com/s?__biz=MzI3MTM3OTExNQ==&amp;mid=2247484766&amp;idx=1&amp;sn=dcc57331b24218554e0460805939dcb8&amp;chksm=eac3fa9addb4738ca192ef01d1b92cfd0f78cdd0475c13feadece8f9f6cad2ae083615c84d52&amp;mpshare=1&amp;scene=1&amp;srcid=1001zguL8UAOBMPnRamkpY1x#rd" target="_blank" rel="external">时光加速器－dplyr.李楠 克里克学苑</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/06/R/R笔记（6）-数据的导入与导出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/06/R/R笔记（6）-数据的导入与导出/" itemprop="url">R笔记（6）——数据的导入与导出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-06T12:00:00+08:00">
                2017-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,118
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据的导入"><a href="#数据的导入" class="headerlink" title="数据的导入"></a>数据的导入</h2><p>所用到的函数与包如下：<br>read.table()<br>read.csv()<br>head()<br>xlsx包<br>read.xlsx()<br>RODBC包<br>odbcConnect()<br>sqlQuery()<br>sqlSave()<br>RMySQL包<br>dbConnect()<br>dbSentQuery()<br>fetch()</p>
<h2 id="从csv文件导入"><a href="#从csv文件导入" class="headerlink" title="从csv文件导入"></a>从csv文件导入</h2><p>此方法可以用以导入Excel数据，将Excel数据转化为csv格式。<br>CSV是（逗号分隔值）的英文缩写，通常都是纯文本文件。其打开格式为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mydataframe&lt;-read.table(file,header=logical_value,ep=<span class="string">"delimiter"</span>,row.names=<span class="string">"name"</span>)</div><div class="line">fiel:csv文件</div><div class="line">header:逻辑值，首先是否包括变量名</div><div class="line">sep:分隔符</div><div class="line">row.names:指定一个或多个表示行标识符的变量</div><div class="line">grades&lt;-read.table(<span class="string">"studentgrades.csv"</span>,header=<span class="literal">TRUE</span>,sep=<span class="string">","</span>,row.names=<span class="string">"STUDENTID"</span>)</div></pre></td></tr></table></figure>
<p>表示从当前目录中读取一个名为studentgrades.csv的逗号分隔文件，从文件的第一行取得变量名字，将STUDENTID指定为行标识符，整个结果保存到grades的数据框中。</p>
<h2 id="从剪切板导入"><a href="#从剪切板导入" class="headerlink" title="从剪切板导入"></a>从剪切板导入</h2><p>通常情况下就是在Excel中复制，接着输入以下命令就可以导入数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt;- read.table(<span class="string">"clipboard"</span>, header = <span class="literal">T</span>, sep=<span class="string">"\t"</span>)</div></pre></td></tr></table></figure>
<h2 id="导入文本文件"><a href="#导入文本文件" class="headerlink" title="导入文本文件"></a>导入文本文件</h2><p>一般采用read.table()函数和read.csv()函数实现文本文件数据的读取，对于这两个函数有几个重要的参数：</p>
<ol>
<li>file指定外部文件的路径和文件名；</li>
<li>header指定是否将原数据的第一行最为字段名，read.table()函数默认设置为FALSE，而read.csv()函数默认设置为TRUE；</li>
<li>sep指定字段之间的分割符，read.table()函数默认设置为空格””，而read.csv()函数默认设置为逗号；</li>
<li>除此，read.table()函数还可以设置读入数据集的行名、列名、字符串是否转换为因子、缺失值的形式等，详细可查看read.table()函数的帮助文档。</li>
</ol>
<p>我的电脑桌面中有两个文本文件，即iris.csv和iris.txt。文件打开如下图：<br><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/i0ad21J31d.png?imageslim" alt="mark"></p>
<p>现在通过read.table()函数和read.csv()函数读取这两个文件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iris1 &lt;- read.table(file = <span class="string">'C:\\Users\\admin\\Desktop\\iris.txt'</span>, col.names = c(<span class="string">'x1'</span>,<span class="string">'x2'</span>,<span class="string">'x3'</span>,<span class="string">'x4'</span>,<span class="string">'y'</span>))</div><div class="line">head(iris1)</div></pre></td></tr></table></figure>
<h2 id="read-csv"><a href="#read-csv" class="headerlink" title="read.csv()"></a>read.csv()</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iris3 &lt;- read.csv(file = file.choose())</div><div class="line">head(iris3)</div></pre></td></tr></table></figure>
<h2 id="从scan导入数据"><a href="#从scan导入数据" class="headerlink" title="从scan导入数据"></a>从scan导入数据</h2><p>主要用于键盘输入数据，详细使用方法：</p>
<h3 id="scan-函数"><a href="#scan-函数" class="headerlink" title="scan() 函数"></a>scan() 函数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">scan(file = <span class="string">""</span>, what = double(<span class="number">0</span>), nmax = -<span class="number">1</span>, n = -<span class="number">1</span>, sep = <span class="string">""</span>,</div><div class="line">     quote = <span class="keyword">if</span>(identical(sep, <span class="string">"\n"</span>)) <span class="string">""</span> <span class="keyword">else</span> <span class="string">"'\""</span>, dec = <span class="string">"."</span>,</div><div class="line">     skip = <span class="number">0</span>, nlines = <span class="number">0</span>, na.strings = <span class="string">"NA"</span>,</div><div class="line">     flush = <span class="literal">FALSE</span>, fill = <span class="literal">FALSE</span>, strip.white = <span class="literal">FALSE</span>,</div><div class="line">     quiet = <span class="literal">FALSE</span>, blank.lines.skip = <span class="literal">TRUE</span>, multi.line = <span class="literal">TRUE</span>,</div><div class="line">     comment.char = <span class="string">""</span>, allowEscapes = <span class="literal">FALSE</span>, encoding = <span class="string">"unknown"</span>)</div></pre></td></tr></table></figure>
<p><strong>参数使用如下所示：</strong></p>
<ol>
<li>what:声明读入为字符类型数据，可能指定读入的精度/类型，例如：what=integer(0)；what=numeric(0)；what=character(0)；<br>如果SCAN()读入有字符与数字，用what=””来进行声明，则会把读入的数字隐式的都转变成字符；</li>
<li>sep：指定各个读入的数据之间的分隔符；默认情况下分隔符：空格、tab；如果不是其它分隔符，例如“：/”通过SEP来指定；</li>
<li>可以通过list指定读入变量的变量名，同时生成的对象为列表，则可以同时读入字符与数字；</li>
<li>Skip 从第几行开始读入数据；</li>
<li>Nlines 指定最大读入行数；</li>
<li>如果通过键盘输入的时候，不希望出现下标提示，则可以使用：quiet=TRUE；</li>
<li>encoding =””指定的编码格式，有时候读入的中文可能会出现乱码的时候，可能通过这个参数来指定：Latin-1 或者 UTF-8</li>
</ol>
<h2 id="使用表格输入数据"><a href="#使用表格输入数据" class="headerlink" title="使用表格输入数据"></a>使用表格输入数据</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mydata&lt;-data.frame(age=numeric(<span class="number">0</span>),</div><div class="line">                   gender=character(<span class="number">0</span>),</div><div class="line">                   weight=numeric(<span class="number">0</span>))</div><div class="line">mydata&lt;-edit(mydata)</div></pre></td></tr></table></figure>
<p>创建一个名为mydata的数据框，含三个变量，age为数据型，gender为字符型，weight为数值型。edit调用文本编辑器，键入数据。其中numeric(0)创建一个指定模型但不含实际数据的变量。如果再次调用mydata&lt;-edit(mydata)能够用来修改数据，或者使用fix(mydata)也行。</p>
<h2 id="利用xlsx包来读取Excel"><a href="#利用xlsx包来读取Excel" class="headerlink" title="利用xlsx包来读取Excel"></a>利用xlsx包来读取Excel</h2><p>读取xls或xlsx格式时，需要将数据转换为csv，用read.csv()函数读取；要么直接使用xlsx软件包中的read.xlsx()函数直接读取电子表格数据，用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(xlsx)</div><div class="line">iris4 &lt;- read.xlsx(file = file.choose(), sheetIndex = <span class="number">1</span>)</div><div class="line">head(iris4)</div></pre></td></tr></table></figure>
<h3 id="利用RODBC包来读取Excel"><a href="#利用RODBC包来读取Excel" class="headerlink" title="利用RODBC包来读取Excel"></a>利用RODBC包来读取Excel</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; install.packages(<span class="string">"RODBC"</span>) <span class="comment">#安装RODBC包</span></div><div class="line">&gt; channel&lt;-odbcConnectExcel(<span class="string">"excel2003.xls"</span>)<span class="comment">#excel2003为一个Excel文件</span></div><div class="line">&gt; mydataframe&lt;-sqlFetch(channel,<span class="string">"sheet1"</span>) <span class="comment">#sqlFetch从channel中读入数据到mydataframe中，将sheet1表格导入</span></div><div class="line">&gt; mydataframe</div><div class="line"> </div><div class="line">install.packages(<span class="string">"xlsx"</span>) <span class="comment">#安装xlsx包</span></div><div class="line"><span class="keyword">library</span>(xlsx)</div><div class="line">workbook&lt;-<span class="string">"d:/r/excel2007.xlsx"</span></div><div class="line">mydataframe2&lt;-read.xlsx(workbook,<span class="number">1</span>)<span class="comment">#1表示导入的第1张表</span></div></pre></td></tr></table></figure>
<h3 id="利用XLConnectJars包的XLConnect函数来读取Excel"><a href="#利用XLConnectJars包的XLConnect函数来读取Excel" class="headerlink" title="利用XLConnectJars包的XLConnect函数来读取Excel"></a>利用XLConnectJars包的XLConnect函数来读取Excel</h3><p>在利用XLConnect来读取Excel时，经常会出现错误，这是因为需要安装jdk环境（版本大于1.6），因此需要安装，安装后再安装XLConnectjars包与XLConnect包，安装完Jdk后，输入以下代码<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Sys.setenv(JAVA_HOME=<span class="string">'C:\\Program Files\\Java\\jdk1.7.0_75\\jre'</span>)</div></pre></td></tr></table></figure></p>
<p>直接读取excel文件，就是这个包依赖于XLConnectJars包，比较大(15.7M)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; install.packages(&quot;XLConnect&quot;)</div><div class="line">&gt; library(&quot;XLConnect&quot;)</div><div class="line">&gt; df = readWorksheetFromFile(&quot;c:/r-workspace/contacts.xls&quot;, sheet=1, header=TRUE)</div><div class="line">&gt; df</div><div class="line">  name gender address</div><div class="line">1 张三     男    北京</div><div class="line">2 李四     男    上海</div><div class="line">3 王五     女    广州</div><div class="line">4 赵六     女    深圳</div><div class="line">5 田七     男    南京</div></pre></td></tr></table></figure>
<h2 id="批量读取数据"><a href="#批量读取数据" class="headerlink" title="批量读取数据"></a>批量读取数据</h2><p>读取N个Excel文件，并将这N个Excel文件进行合并，分为四种情况，代码如下所示，其中read_excel函数所在的包为readxl。</p>
<p>对于文件名有规律的情况，如下图所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/3IJki27BL8.png?imageslim" alt="mark"></p>
<p>解决方案如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data1'</span>) </div><div class="line"><span class="comment"># 设置R的工作空间</span></div><div class="line"><span class="comment">#res &lt;- NULL</span></div><div class="line"></div><div class="line">data1 &lt;- data.frame()</div><div class="line"><span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">4</span>)&#123;</div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,<span class="string">'test'</span>,i,<span class="string">'.xlsx'</span>)   <span class="comment"># 构造数据路径</span></div><div class="line">res &lt;- c(res,path)</div><div class="line">data1 &lt;- rbind(data1,read_excel(path = path))   <span class="comment"># 读取并合并数据</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件没有规律的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data2'</span>)  <span class="comment"># 设置工作空间</span></div><div class="line">filenames &lt;- dir()   <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line">data2 &lt;- data.frame()   <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> filenames)&#123;</div><div class="line"><span class="comment"># 构造数据路径</span></div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"><span class="comment">#res &lt;- c(res,path)</span></div><div class="line"><span class="comment"># 读取并合并数据</span></div><div class="line">data2 &lt;- rbind(data2,read_excel(path = path))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件名没有规律的情况，并且只读取某做后缀的文件，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/bIFEDBjmC9.png?imageslim" alt="mark"></p>
<p>文件内容结构不一致,但变量名称一致，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/KImJBHK7hf.png?imageslim" alt="mark"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加载第三方扩展包，用于编写SQL语句</span></div><div class="line"> <span class="keyword">library</span>(sqldf)</div><div class="line"> <span class="comment"># 设置工作空间</span></div><div class="line"> setwd(<span class="string">'D:\\data file\\data4'</span>)</div><div class="line"> <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line"> filenames &lt;- dir()</div><div class="line"> <span class="comment"># 通过正则，获取所有xlsx结尾的文件名</span></div><div class="line"> filenames2 &lt;- grep(<span class="string">'\\.xlsx'</span>, filenames, value = <span class="literal">TRUE</span>)</div><div class="line"> <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"> data4 &lt;- data.frame()</div><div class="line"> <span class="comment">#通过循环完成数据合并</span></div><div class="line"> <span class="keyword">for</span> (i <span class="keyword">in</span> filenames2)&#123;</div><div class="line"> <span class="comment"># 构造数据路径</span></div><div class="line"> path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"> <span class="comment">#res &lt;- c(res,path)</span></div><div class="line"> <span class="comment"># 使用read_excel函数读取xlsx文件</span></div><div class="line"> data &lt;- read_excel(path = path)</div><div class="line"> <span class="comment"># 使用sqldf函数编写SQL语句，并把结果合并起来</span></div><div class="line"> data4 &lt;- rbind(data4, sqldf(<span class="string">"select id,name,gender,age from data"</span>))</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h2><h3 id="导出的路径"><a href="#导出的路径" class="headerlink" title="导出的路径"></a>导出的路径</h3><p>为了避免在导出路径中使用转义字符，可以使用file.path()函数来构建正确的路径，这个函数的工作原理类似于paste()，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.path(<span class="string">"d:"</span>,<span class="string">"download"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"d:/download"</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>file.path(“d:”,”download”)<br>[1] “d:/download”</p>
</blockquote>
<h3 id="导出为txt格式"><a href="#导出为txt格式" class="headerlink" title="导出为txt格式"></a>导出为txt格式</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> a</div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">5</span>  <span class="number">4</span></div><div class="line">&gt; b</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="literal">NA</span>  <span class="string">"4"</span></div><div class="line"> c &lt;- data.frame(a,b)</div><div class="line"> c</div><div class="line">   a    b</div><div class="line"><span class="number">1</span>  <span class="number">1</span>    a</div><div class="line"><span class="number">2</span>  <span class="number">2</span>    b</div><div class="line"><span class="number">3</span>  <span class="number">4</span>    c</div><div class="line"><span class="number">4</span> <span class="literal">NA</span>    d</div><div class="line"><span class="number">5</span>  <span class="number">5</span> &lt;<span class="literal">NA</span>&gt;</div><div class="line"><span class="number">6</span>  <span class="number">4</span>    <span class="number">4</span></div><div class="line"> write.table(c,file = <span class="string">"c:\\data.txt"</span>,sep = <span class="string">","</span>,quote = <span class="literal">FALSE</span>, append = <span class="literal">FALSE</span>, na = <span class="string">"NA"</span>)</div></pre></td></tr></table></figure>
<p>c为导出的数据，file为导出的路径，sep = “,”表示用逗号隔开数据，quote = FALSE表示消除字符串的引号标志，append = FALSE打开一个新文件，如果为TRUE则表示将此数据追加到已经存在的文件中，na=”NA”表示用NA来代表na值。</p>
<h2 id="读取错误"><a href="#读取错误" class="headerlink" title="读取错误"></a>读取错误</h2><p>R语言读取Excel文件有时会出错，如果要读取以下的Excel表格文件，</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/GJj9jHELEj.png?imageslim" alt="mark"></p>
<p>  操作如下所示：</p>
<ol>
<li>用鼠标选中据，然后Ctrl+C复制；</li>
<li>在Rstudio中输入：read.table(“clipboard”,header=T)-&gt;x1，显示以下结果：</li>
</ol>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/Fd8204g0EC.png?imageslim" alt="mark"></p>
<p>Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :<br>  line 2 did not have 8 elements</p>
<p>大概意思是，有两行数据的元素不满足8个（即第No.2不满足8个元素），无法读取，因此需要改变一下代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x &lt;- read.table(<span class="string">"clipboard"</span>,sep=<span class="string">"\t"</span>,header=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<p>  如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/7I89J18DJG.png?imageslim" alt="mark"></p>
<p>这样就能正常读取了，因为Excel的文件中，每个单元格就是以制表符将它们分开的，而sep=“\t”的意思就是，读取数据的时候，以制表符进行分割来读取。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/05/R/R笔记（5）-函数构建与循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/R/R笔记（5）-函数构建与循环/" itemprop="url">R笔记（5）——函数构建与循环</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T12:00:00+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,174
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="函数的编写"><a href="#函数的编写" class="headerlink" title="函数的编写"></a>函数的编写</h2><p>格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">函数名 &lt;- <span class="keyword">function</span>(数据,参数<span class="number">1</span>=默认值,<span class="keyword">...</span>)</div><div class="line">&#123;</div><div class="line">异常处理;</div><div class="line">表达式(循环/判别);</div><div class="line"><span class="keyword">return</span>(返回值);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数案例A"><a href="#函数案例A" class="headerlink" title="函数案例A"></a>函数案例A</h3><p>输入直角三角形的两个边长，求斜边长</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">result &lt;- sqrt(z) </div><div class="line"><span class="keyword">return</span>(result) </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">+     z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">+     result &lt;- sqrt(z) </div><div class="line">+     <span class="keyword">return</span>(result) </div><div class="line">+ &#125; </div><div class="line">&gt; rcal(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="函数案例B"><a href="#函数案例B" class="headerlink" title="函数案例B"></a>函数案例B</h3><p>给出两个数字后，直接给出这两个数的平方和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line"><span class="keyword">return</span>(z3);</div><div class="line">&#125;</div><div class="line">sqtest(<span class="number">3</span>,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">+     z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line">+     <span class="keyword">return</span>(z3);</div><div class="line">+ &#125;</div><div class="line">&gt; sqtest(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">25</span></div></pre></td></tr></table></figure>
<h3 id="函数的返回结果"><a href="#函数的返回结果" class="headerlink" title="函数的返回结果"></a>函数的返回结果</h3><p>当函数需要返回多个结果时，通常用<code>list</code>的形式返回结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vms = <span class="keyword">function</span>(x)&#123;</div><div class="line">  xx=rev(sort(x)) </div><div class="line"><span class="comment"># 对向量x从小到大排序，然后用ver()转换为从大到小排序</span></div><div class="line">  xx=xx[<span class="number">1</span>:<span class="number">5</span>]</div><div class="line"><span class="comment"># 提取前5个元素</span></div><div class="line">  mean(xx)</div><div class="line"><span class="comment">#求均值</span></div><div class="line">  <span class="keyword">return</span>(list(xbar=mean(xx),top5=xx))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; y &lt;- c(12,4,65,22,33,123,322,90)</div><div class="line">&gt; vms(y)</div><div class="line">$xbar</div><div class="line">[1] 126.6</div><div class="line"></div><div class="line">$top5</div><div class="line">[1] 322 123  90  65  33</div></pre></td></tr></table></figure>
<h2 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h2><p>用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件) 表达式</div><div class="line"><span class="keyword">if</span>(条件) 表达式<span class="number">1</span> <span class="keyword">else</span> 表达式<span class="number">2</span></div></pre></td></tr></table></figure>
<p>运行如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line"><span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line"><span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line">+     <span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">+         print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line">+     <span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">+ &#125;</div><div class="line">[<span class="number">1</span>] <span class="string">"p&lt;=0.05!"</span></div></pre></td></tr></table></figure>
<h2 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h2><p>用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">cat(i);</div><div class="line">cat(<span class="string">" "</span>);</div><div class="line">i=i+<span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">+     cat(i);</div><div class="line">+     cat(<span class="string">" "</span>);</div><div class="line">+     i=i+<span class="number">3</span>;</div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></div></pre></td></tr></table></figure>
<p>从上面结果，我们可以看出，循环中处理的对象是1:20这20个数，对每个数进行操作不管循环内部i如何变化。因此，循环体内的i=i+3就不会对循环条件中的变量造成改变，具体执行过程相当于：<code>i=1</code> <code>-&gt;</code> <code>i=i+3</code>，此时<code>i=4</code>；<code>-&gt;</code> 第一次循环结束，第二次循环开始，<code>i=2</code>。尤其注意，i变成4又变成2，所以打印出来的结果是，1,2,3,4….20的连续值。如果想要随意的改变条件中的变量，可以使用while循环，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; i=<span class="number">1</span> </div><div class="line">&gt; <span class="keyword">while</span>(i&lt;=<span class="number">20</span>)&#123; </div><div class="line">+     cat(i); </div><div class="line">+     cat(<span class="string">" "</span>); </div><div class="line">+     i=i+<span class="number">3</span> </div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">7</span> <span class="number">10</span> <span class="number">13</span> <span class="number">16</span> <span class="number">19</span></div></pre></td></tr></table></figure>
<h2 id="ifelse"><a href="#ifelse" class="headerlink" title="ifelse"></a>ifelse</h2><p>用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifelse(test, yes, no)</div></pre></td></tr></table></figure>
<p>它表示，如果<code>test</code>为真，输出<code>yes</code>值，否则输出<code>no</code>值，看一个案例：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">ifelse(x != <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) </div><div class="line"><span class="comment"># 若果x的值不等于1，输出1，否则输出0</span></div><div class="line"><span class="comment"># [1] 0 0 0 1 1 0 0</span></div></pre></td></tr></table></figure></p>
<h3 id="ifelse案例1"><a href="#ifelse案例1" class="headerlink" title="ifelse案例1"></a>ifelse案例1</h3><p>看一个案例，有两个向量，分别为x和y，它们是时间序列，例如它们是每小时收集的气温和气压测量值，我们定义两者的相关性为x和y同时上升或下降次数占总观测数的比例（其实就是Kendall’s tau方法），也就是计算<code>y[i+1]-y[i]1</code>与<code>x[i+1]-x[i]</code>符号相同时的次数占总数<code>i</code>的比例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findud &lt;- <span class="keyword">function</span>(v)&#123;</div><div class="line">  vud &lt;- v[-<span class="number">1</span>]-v[-length(v)]</div><div class="line">  <span class="keyword">return</span>(ifelse(vud &gt; <span class="number">0</span>, <span class="number">1</span>,-<span class="number">1</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  ud &lt;- lapply(list(x,y),findud)</div><div class="line">  <span class="keyword">return</span>(mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">5</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">88</span>)</div><div class="line">&gt; y &lt;- c(<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">23</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">&gt; udcorr(x,y)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div></pre></td></tr></table></figure>
<p>在这个案例中，x和y在10次中同时上升3次（第一次同时上升是12到13，2到3），并同时下降1次，得到的相关性估计为4/10=0.4。</p>
<p>这个函数的思路就是先把x和y的值编码为1和-1，其中1代表当前观测值较前一个增加，-1表示减少，这个转换过程就是通过<code>vud &lt;- v[-1]-v[-length(v)]</code>这行代码实现的，它具体是怎么实现的呢，以向量x为例说明一下，看下面的示意图就行了：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim" alt="mark"></p>
<p>其中，<code>x[-1]-x[-11]</code>表示的就是第2个元素减去第1个元素，第3个元素减去第2个元素等等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; x[-<span class="number">1</span>]-x[-<span class="number">11</span>]</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p><code>return(ifelse(vud &gt; 0, 1,-1))</code>这个语句就是把上面的向量再转换为1与-1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(x[-<span class="number">1</span>]-x[-<span class="number">11</span>] &gt;<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>)</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>接着又构建了一个<code>udcorr</code>这个函数。其中<code>ud &lt;- lapply(list(x,y),findud)</code>这行的功能就是，使用<code>lapply()</code>函数对xy构成的这个列表使用findud函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; list(x,y)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">4</span>  <span class="number">2</span>  <span class="number">3</span> <span class="number">23</span>  <span class="number">6</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span>  <span class="number">6</span>  <span class="number">3</span>  <span class="number">2</span></div><div class="line"></div><div class="line">&gt; lapply(list(x,y),findud)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span></div></pre></td></tr></table></figure>
<p>最后使用<code>return(mean(ud[[1]] == ud[[2]]))</code>这行代码来计算里面的均数，因为<code>ud[[1]] == ud[[2]]</code>的结果是一个逻辑向量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div></pre></td></tr></table></figure>
<p>对于逻辑向量来说，TRUE就是1，FALSE就是0，因此计算这个向量的均值就是计算TRUE占总向量数目的比例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]])</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div><div class="line"></div><div class="line"><span class="comment"># 逻辑向量也能使用数学函数，如下所示，TRUE就是1</span></div><div class="line">&gt; sum(c(<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div></pre></td></tr></table></figure>
<p>但是在R中，上面的代码可以用<code>diff()</code>这个函数来进行计算，这个函数可以对向量做”滞后”运算，这个运算的效果如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，这个滞后运算其实就是后一个数减去前一个数。与滞后运算相匹配的函数是<code>sign()</code>函数，它可以将正值与负值转换为1，-1或0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div><div class="line">&gt; sign(diff(x))</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>因此，我们可以把<code>undcorr()</code>函数换一种方式写，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  mean(sign(diff(x))==sign(diff(y)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ifelse案例2-复杂案例"><a href="#ifelse案例2-复杂案例" class="headerlink" title="ifelse案例2:复杂案例"></a>ifelse案例2:复杂案例</h3><p><code>ifelse()</code>可以嵌套使用，看一个案例，<code>g</code>是一个鲍鱼的数据集，性别被编号为M、F或I（I是指Infant，幼虫的意思），现在我们将这些编号转换为1、2或3，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; g &lt;- c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>,<span class="string">"M"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; g</div><div class="line">[<span class="number">1</span>] <span class="string">"M"</span> <span class="string">"F"</span> <span class="string">"F"</span> <span class="string">"I"</span> <span class="string">"M"</span> <span class="string">"M"</span> <span class="string">"F"</span></div><div class="line">&gt; ifelse(g == <span class="string">"M"</span>,<span class="number">1</span>,ifelse(g == <span class="string">"F"</span>,<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程是这个样子的：</p>
<ol>
<li>R先执行外层的<code>ifelse()</code>，其中当<code>g==&quot;M&quot;</code>时，返回1；否则就返回<code>ifelse(g == &quot;F&quot;,2,3)</code>；</li>
<li>当返回的是<code>ifelse(g == &quot;F&quot;,2,3)</code>，这是一个表达式，还能计算，那么如果<code>g==&quot;F&quot;</code>，就返回2，否则返回3。</li>
</ol>
<p>如果希望按照性别形成子集，那么可以使用<code>which()</code>函数寻找M、F或I对应元素的编号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; m &lt;- which(g == <span class="string">"M"</span>)</div><div class="line">&gt; f &lt;- which(g == <span class="string">"F"</span>)</div><div class="line">&gt; i &lt;- which(g == <span class="string">"I"</span>)</div><div class="line">&gt; m</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">&gt; f</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">&gt; i</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>如果想把这些子集保存在一个列表中，可以按下面的代码操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">grps &lt;- list()</div><div class="line"><span class="keyword">for</span> (gen <span class="keyword">in</span> c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>))&#123;</div><div class="line">  grps[[gen]] &lt;- which(g == gen)</div><div class="line">&#125;</div><div class="line">grps</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; grps</div><div class="line">$M</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">$<span class="literal">F</span></div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">$I</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<h2 id="any-与all"><a href="#any-与all" class="headerlink" title="any()与all()"></a>any()与all()</h2><p>使用<code>any()</code>和<code>all()</code>函数可以对某个变量进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">10</span></div><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line">&gt; any(x&gt;<span class="number">8</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; any(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">0</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p>现在看一个案例，假设一个向量由若干个0或1构成，我们想要找𡵾其中连续出现1的游程（在一个0和1组成的序列中，一个由连续的0或1构成的串称为一个游程(run)）。例如对于向量x(假设它为1,0,0,1,1,1,0,1,1)，从它第4个索引处开始有长度为3的游程，而长度为2的游程分别始于第4，第5和第8索引的位置，因此现在我们构建一个函数，返回结果为(4,5,8)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findruns &lt;- <span class="keyword">function</span>(x,k)&#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  runs &lt;- <span class="literal">NULL</span></div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(n-k+<span class="number">1</span>))&#123;</div><div class="line">    <span class="keyword">if</span> (all(x[i:(i+k-<span class="number">1</span>)]==<span class="number">1</span>)) </div><div class="line">       runs &lt;- c(runs,i)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span>(runs)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在运行这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">&gt; findruns(x,<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div><div class="line">&gt; findruns(x,<span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">5</span> <span class="number">8</span></div><div class="line">&gt; findruns(x,<span class="number">6</span>)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/04/R/R笔记（4）-字符串与日期/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/04/R/R笔记（4）-字符串与日期/" itemprop="url">R笔记（4）——字符串与日期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-04T12:00:00+08:00">
                2017-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,920
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="字符串常用函数"><a href="#字符串常用函数" class="headerlink" title="字符串常用函数"></a>字符串常用函数</h2><p>is.character()：判断是否是字符串；<br>nchar()：有几个字符；<br>length()：变量的长度<br>如下所示<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="string">"Hello, World!"</span>;x</div><div class="line">[<span class="number">1</span>] <span class="string">"Hello, World!"</span></div><div class="line">&gt; is.character(x)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; length(x)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line">&gt; nchar(x)</div><div class="line">[<span class="number">1</span>] <span class="number">13</span></div><div class="line">&gt; x2 &lt;- c(<span class="string">"Hello"</span>,<span class="string">"World!"</span>)</div><div class="line">&gt; length(x2)</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line">&gt; nchar(x2)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">6</span></div></pre></td></tr></table></figure></p>
<h2 id="内置数据集"><a href="#内置数据集" class="headerlink" title="内置数据集"></a>内置数据集</h2><p>R中有两个内置数据集，分别为LETTERS和letters，分别为大写字母和小写字母，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; letters</div><div class="line"> [<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span> <span class="string">"f"</span> <span class="string">"g"</span> <span class="string">"h"</span> <span class="string">"i"</span> <span class="string">"j"</span> <span class="string">"k"</span> <span class="string">"l"</span> <span class="string">"m"</span> <span class="string">"n"</span> <span class="string">"o"</span> <span class="string">"p"</span> <span class="string">"q"</span> <span class="string">"r"</span> <span class="string">"s"</span> <span class="string">"t"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"u"</span> <span class="string">"v"</span> <span class="string">"w"</span> <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; LETTERS</div><div class="line"> [<span class="number">1</span>] <span class="string">"A"</span> <span class="string">"B"</span> <span class="string">"C"</span> <span class="string">"D"</span> <span class="string">"E"</span> <span class="string">"F"</span> <span class="string">"G"</span> <span class="string">"H"</span> <span class="string">"I"</span> <span class="string">"J"</span> <span class="string">"K"</span> <span class="string">"L"</span> <span class="string">"M"</span> <span class="string">"N"</span> <span class="string">"O"</span> <span class="string">"P"</span> <span class="string">"Q"</span> <span class="string">"R"</span> <span class="string">"S"</span> <span class="string">"T"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"U"</span> <span class="string">"V"</span> <span class="string">"W"</span> <span class="string">"X"</span> <span class="string">"Y"</span> <span class="string">"Z"</span></div><div class="line">&gt; letters[<span class="number">2</span>:<span class="number">5</span>]</div><div class="line">[<span class="number">1</span>] <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span></div><div class="line">&gt; LETTERS[<span class="number">4</span>:<span class="number">9</span>]</div><div class="line">[<span class="number">1</span>] <span class="string">"D"</span> <span class="string">"E"</span> <span class="string">"F"</span> <span class="string">"G"</span> <span class="string">"H"</span> <span class="string">"I"</span></div></pre></td></tr></table></figure></p>
<h2 id="字符串的连接和分离"><a href="#字符串的连接和分离" class="headerlink" title="字符串的连接和分离"></a>字符串的连接和分离</h2><h3 id="字符串的分离"><a href="#字符串的分离" class="headerlink" title="字符串的分离"></a>字符串的分离</h3><p>strsplit()函数用于分离字符串，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; pangram &lt;- <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; pangram</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; result_split &lt;- strsplit(pangram,<span class="string">" "</span>)</div><div class="line">&gt; result_split</div><div class="line">[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="string">"The"</span>   <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"over"</span>  <span class="string">"the"</span>   <span class="string">"lazy"</span>  <span class="string">"dog"</span></div></pre></td></tr></table></figure></p>
<h3 id="字符串的连接"><a href="#字符串的连接" class="headerlink" title="字符串的连接"></a>字符串的连接</h3><p>字符串的连接用的是paste函数，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(c(<span class="string">"hello"</span>,<span class="string">"world"</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"hello"</span> <span class="string">"world"</span></div></pre></td></tr></table></figure></p>
<p>在为某些数据添加新的一列，进行分组时，很有用，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; myvars&lt;-paste(<span class="string">"q"</span>,<span class="number">1</span>:<span class="number">5</span>,sep=<span class="string">""</span>) <span class="comment"># 将q分别与1到5这五个数字连接起来</span></div><div class="line">&gt; myvars</div><div class="line">[<span class="number">1</span>] <span class="string">"q1"</span> <span class="string">"q2"</span> <span class="string">"q3"</span> <span class="string">"q4"</span> <span class="string">"q5"</span></div></pre></td></tr></table></figure>
<h3 id="字符串连接的注意事项"><a href="#字符串连接的注意事项" class="headerlink" title="字符串连接的注意事项"></a>字符串连接的注意事项</h3><p>以字符串的分离结果为数据进行连接，结果如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(result_split,collapse=<span class="string">" "</span>)-&gt;x3;x3</div><div class="line">[<span class="number">1</span>] <span class="string">"c(\"The\", \"quick\", \"brown\", \"fox\", \"jumps\", \"over\", \"the\", \"lazy\", \"dog\")"</span></div></pre></td></tr></table></figure></p>
<p>会发现字符之间出现的斜杠，原理如下：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">List of <span class="number">1</span></div><div class="line"> $ : chr [<span class="number">1</span>:<span class="number">9</span>] <span class="string">"The"</span> <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span> <span class="keyword">...</span></div><div class="line">&gt; result_split[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="string">"The"</span>   <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"over"</span>  <span class="string">"the"</span>   <span class="string">"lazy"</span>  <span class="string">"dog"</span>  </div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">" "</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; str(result_split) </div><div class="line">List of <span class="number">1</span></div><div class="line"> $ : chr [<span class="number">1</span>:<span class="number">9</span>] <span class="string">"The"</span> <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span> <span class="keyword">...</span></div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">" "</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">"*"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The*quick*brown*fox*jumps*over*the*lazy*dog"</span></div></pre></td></tr></table></figure></p>
<p>因为分离后的字符串结果为列表（list），对列表直接用paste进行连接时，容易出现这种情况，因此要对列表的第1个元素进行连接才能避免这种情况。另外，在进行连接时主，要用于collapase参数，即用什么连接，案例中使用了空格与星号进行连接。</p>
<h3 id="同时调用sep和collapse进行连接"><a href="#同时调用sep和collapse进行连接" class="headerlink" title="同时调用sep和collapse进行连接"></a>同时调用sep和collapse进行连接</h3><p>以下面的这个例子中，先使用sep对不同向量进行连接，然后用collapse进行连接。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(LETTERS[<span class="number">1</span>:<span class="number">5</span>],<span class="number">1</span>:<span class="number">5</span>,sep=<span class="string">"_"</span>,collapse = <span class="string">"---"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"A_1---B_2---C_3---D_4---E_5"</span></div></pre></td></tr></table></figure></p>
<h3 id="paste创建有规律的变量名"><a href="#paste创建有规律的变量名" class="headerlink" title="paste创建有规律的变量名"></a>paste创建有规律的变量名</h3><p>创造含有sample1-5的五个元素的向量：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(<span class="string">"Sample"</span>,<span class="number">1</span>:<span class="number">5</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"Sample 1"</span> <span class="string">"Sample 2"</span> <span class="string">"Sample 3"</span> <span class="string">"Sample 4"</span> <span class="string">"Sample 5"</span></div></pre></td></tr></table></figure></p>
<h2 id="字符的排序"><a href="#字符的排序" class="headerlink" title="字符的排序"></a>字符的排序</h2><p>排序用sort(),如果要倒序，则添加<code>decreasing = TRUE</code>，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; sort(letters)</div><div class="line"> [<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span> <span class="string">"f"</span> <span class="string">"g"</span> <span class="string">"h"</span> <span class="string">"i"</span> <span class="string">"j"</span> <span class="string">"k"</span> <span class="string">"l"</span> <span class="string">"m"</span> <span class="string">"n"</span> <span class="string">"o"</span> <span class="string">"p"</span> <span class="string">"q"</span> <span class="string">"r"</span> <span class="string">"s"</span> <span class="string">"t"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"u"</span> <span class="string">"v"</span> <span class="string">"w"</span> <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; sort(letters,decreasing = <span class="literal">TRUE</span>)</div><div class="line"> [<span class="number">1</span>] <span class="string">"z"</span> <span class="string">"y"</span> <span class="string">"x"</span> <span class="string">"w"</span> <span class="string">"v"</span> <span class="string">"u"</span> <span class="string">"t"</span> <span class="string">"s"</span> <span class="string">"r"</span> <span class="string">"q"</span> <span class="string">"p"</span> <span class="string">"o"</span> <span class="string">"n"</span> <span class="string">"m"</span> <span class="string">"l"</span> <span class="string">"k"</span> <span class="string">"j"</span> <span class="string">"i"</span> <span class="string">"h"</span> <span class="string">"g"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"f"</span> <span class="string">"e"</span> <span class="string">"d"</span> <span class="string">"c"</span> <span class="string">"b"</span> <span class="string">"a"</span></div><div class="line">&gt; sort(result_split[[<span class="number">1</span>]])</div><div class="line">[<span class="number">1</span>] <span class="string">"brown"</span> <span class="string">"dog"</span>   <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"lazy"</span>  <span class="string">"over"</span>  <span class="string">"quick"</span> <span class="string">"the"</span>   <span class="string">"The"</span></div></pre></td></tr></table></figure></p>
<h2 id="查找文本"><a href="#查找文本" class="headerlink" title="查找文本"></a>查找文本</h2><p>所用的案例是美国州的名字，数据集为state.name，如果要获取字符串的子字符串，则有2种方法，分别为：</p>
<ol>
<li>通过位置：例如让R返回从第5个位置开始的紧接的第3个字母。</li>
<li>通过模式，例如返回匹配某个模式的子集。</li>
</ol>
<h3 id="通过位置查询"><a href="#通过位置查询" class="headerlink" title="通过位置查询"></a>通过位置查询</h3><p>此函数为substr，现在返回state.name中各个元素的第3到第6的子字符串，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; head(state.name)</div><div class="line">[<span class="number">1</span>] <span class="string">"Alabama"</span>    <span class="string">"Alaska"</span>     <span class="string">"Arizona"</span>    <span class="string">"Arkansas"</span>   <span class="string">"California"</span> <span class="string">"Colorado"</span>  </div><div class="line">&gt; head(substr(state.name, start = <span class="number">3</span>,<span class="keyword">stop</span>=<span class="number">6</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"abam"</span> <span class="string">"aska"</span> <span class="string">"izon"</span> <span class="string">"kans"</span> <span class="string">"lifo"</span> <span class="string">"lora"</span></div></pre></td></tr></table></figure></p>
<h3 id="通过模式查找匹配字符串"><a href="#通过模式查找匹配字符串" class="headerlink" title="通过模式查找匹配字符串"></a>通过模式查找匹配字符串</h3><p>grep()函数可提取子字符串，它需要2个参数：</p>
<ol>
<li>pattern：想要查询的模式；</li>
<li>x：被查询的向量。</li>
</ol>
<p><strong>需要注意的是grep()函数区分大小写</strong><br>现在查找名称中含有“New”的州，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; grep(<span class="string">"New"</span>,state.name)</div><div class="line">[<span class="number">1</span>] <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></div><div class="line">&gt; grep(<span class="string">"new"</span>,state.name)</div><div class="line">integer(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>返回的是数值变量，它表示的是元素的位置，例如：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; grep(<span class="string">"New"</span>,state.name)</div><div class="line">[<span class="number">1</span>] <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></div><div class="line">&gt; state.name[c(<span class="number">29</span>,<span class="number">30</span>)]</div><div class="line">[<span class="number">1</span>] <span class="string">"New Hampshire"</span> <span class="string">"New Jersey"</span></div></pre></td></tr></table></figure></p>
<p>可以直接返回元素，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; state.name[grep(<span class="string">"New"</span>,state.name)]</div><div class="line">[<span class="number">1</span>] <span class="string">"New Hampshire"</span> <span class="string">"New Jersey"</span>    <span class="string">"New Mexico"</span>    <span class="string">"New York"</span></div></pre></td></tr></table></figure></p>
<h3 id="文本替换"><a href="#文本替换" class="headerlink" title="文本替换"></a>文本替换</h3><p>sub()函数可以用于检索文本中的特定模式，并将其替换为其它的文本；<br>gsub()可以实现所有的替换功能，它的三个参数为：查找的字符串，替换的字符串与被修改的文本。<br>例如替换A real world is cute中的cute与ugly:<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x1 &lt;- <span class="string">"A real world is cute."</span></div><div class="line">x1</div><div class="line">gsub(<span class="string">"cute"</span>,<span class="string">"ugly"</span>,x1)</div></pre></td></tr></table></figure></p>
<h4 id="子字符串的提取案例之一："><a href="#子字符串的提取案例之一：" class="headerlink" title="子字符串的提取案例之一："></a>子字符串的提取案例之一：</h4><p>一个向量，包含3个文件名，分别为file_a.csv，file_b.csv，file_c.csv，现在要提取这3个文件名中的a、b和c，需要用两个步骤，分别为：</p>
<ol>
<li>将字符串“file_”替换为空格；</li>
<li>将“.csv”去掉，如下所示：</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="string">"file_a.csv"</span>,<span class="string">"file_b.csv"</span>,<span class="string">"file_c.csv"</span>)</div><div class="line">&gt; y &lt;- gsub(<span class="string">"file_"</span>,<span class="string">""</span>,x);y</div><div class="line">[<span class="number">1</span>] <span class="string">"a.csv"</span> <span class="string">"b.csv"</span> <span class="string">"c.csv"</span></div><div class="line">&gt; gsub(<span class="string">".csv"</span>,<span class="string">""</span>,y)</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span></div></pre></td></tr></table></figure>
<h2 id="日期格式的创建"><a href="#日期格式的创建" class="headerlink" title="日期格式的创建"></a>日期格式的创建</h2><p>日期通常以字符串的形式输入到R中，然后转化为数值形式存储的日期变量，函数as.Date()用于执行这种转化，其语法为<code>as.Date(x, &quot;input_format&quot;)</code>，其中x是<br>字符型数据，input_format则是读入日期的适当格式。</p>
<p>其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">%d 数字表示的日期（<span class="number">0</span>~<span class="number">31</span>） 例如<span class="number">01</span>~<span class="number">31</span></div><div class="line">%a 缩写的星期名 例如Mon</div><div class="line">%A 非缩写的星期名 例如Monday</div><div class="line">%m 月份（<span class="number">00</span>~<span class="number">12</span>） 例如<span class="number">00</span>~<span class="number">12</span></div><div class="line">%b 缩写的月份 例如Jan</div><div class="line">%B 非缩写的月份 例如January</div><div class="line">%y 两位数的年份 例如<span class="number">07</span></div><div class="line">%Y 四位数的年份  例如<span class="number">2007</span></div></pre></td></tr></table></figure>
<p>默认的日期格式为yyyy-mm-dd，语句为：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mydates &lt;- as.Date(c(<span class="string">"2007-06-22"</span>,<span class="string">"2004-02-13"</span>))</div><div class="line">mydates</div><div class="line">str(mydates)</div></pre></td></tr></table></figure></p>
<p>结果如下：</p>
<blockquote>
<p>mydates &lt;- as.Date(c(“2007-06-22”,”2004-02-13”))<br>mydates<br>[1] “2007-06-22” “2004-02-13”<br>str(mydates)<br>Date[1:2], format: “2007-06-22” “2004-02-13”</p>
</blockquote>
<h3 id="weekdays-函数"><a href="#weekdays-函数" class="headerlink" title="weekdays()函数"></a>weekdays()函数</h3><p>返回某个日期是星期几如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 格式转化</span></div><div class="line">​```r</div><div class="line">&gt; strDates &lt;- c("01/05/1965", "08/16/1975")</div><div class="line">&gt; dates &lt;- as.Date(strDates, "%m/%d/%Y")</div><div class="line">#输入的日期转化为对应日期，其中%m对应为月份，%d对应为日期，%Y对应为年</div><div class="line">&gt; dates</div><div class="line">[1] "1965-01-05" "1975-08-16"</div><div class="line">&gt; str(dates)</div><div class="line"> Date[1:2], format: "1965-01-05" "1975-08-16"</div></pre></td></tr></table></figure></p>
<h3 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h3><p>在leadership数据集中，日期是以mm/dd/yy的格式来表示的，现在将其转化为默认的yyyy-mm-dd格式，代码为：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; myformat &lt;- <span class="string">"%m/%d/%y"</span></div><div class="line">&gt; leadership$testDate &lt;- as.Date(leadership$testDate, myformat)</div><div class="line">&gt; leadership</div><div class="line">  managerID   testDate country gender age item1 item2 item3 item4 item5 stringsAsFactor</div><div class="line"><span class="number">1</span>         <span class="number">1</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">24</span>      US      M  <span class="number">32</span>     <span class="number">5</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">5</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">2</span>         <span class="number">2</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">28</span>      US      <span class="literal">F</span>  <span class="number">45</span>     <span class="number">3</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">5</span>     <span class="number">5</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">3</span>         <span class="number">3</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">01</span>      UK      <span class="literal">F</span>  <span class="number">25</span>     <span class="number">3</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">4</span>         <span class="number">4</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">12</span>      UK      M  <span class="number">39</span>     <span class="number">3</span>     <span class="number">3</span>     <span class="number">4</span>    <span class="literal">NA</span>    <span class="literal">NA</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">5</span>         <span class="number">5</span> <span class="number">2009</span>-<span class="number">05</span>-<span class="number">01</span>      UK      <span class="literal">F</span>  <span class="literal">NA</span>     <span class="number">2</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>           <span class="literal">FALSE</span></div><div class="line">  agecat</div><div class="line"><span class="number">1</span>  Young</div><div class="line"><span class="number">2</span>  Young</div><div class="line"><span class="number">3</span>  Young</div><div class="line"><span class="number">4</span>  Young</div><div class="line"><span class="number">5</span>   &lt;<span class="literal">NA</span>&gt;</div></pre></td></tr></table></figure></p>
<h3 id="当前日期"><a href="#当前日期" class="headerlink" title="当前日期"></a>当前日期</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; Sys.Date() <span class="comment"># 给出当前日期</span></div><div class="line">[<span class="number">1</span>] <span class="string">"2014-01-18"</span></div><div class="line">&gt; date() <span class="comment">#返回当前的日期和时间</span></div><div class="line">[<span class="number">1</span>] <span class="string">"Sat Jan 18 14:22:07 2014"</span></div><div class="line">&gt; today&lt;-Sys.Date()</div><div class="line">&gt; format(today,format = <span class="string">"%B %d %Y"</span>) <span class="comment"># 格式化当前日期</span></div><div class="line">[<span class="number">1</span>] <span class="string">"一月 18 2014"</span></div><div class="line">&gt; format(today,fomat =<span class="string">"%A"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"2014-01-18"</span></div></pre></td></tr></table></figure>
<h3 id="两个日期的相减"><a href="#两个日期的相减" class="headerlink" title="两个日期的相减"></a>两个日期的相减</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; startdate &lt;- as.Date(<span class="string">"2004-02-12"</span>)</div><div class="line">&gt; enddate &lt;- as.Date(<span class="string">"2011-01-22"</span>)</div><div class="line">&gt; days &lt;-enddate - startdate;days <span class="comment"># 两个时间点之差</span></div><div class="line">Time difference of <span class="number">2536</span> days</div></pre></td></tr></table></figure>
<p>用difftime()来计算时间间隔，并以星期，天，时，分，秒来表示。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; today &lt;- Sys.Date()</div><div class="line">&gt; dob &lt;- as.Date(<span class="string">"1956-10-12"</span>)</div><div class="line">&gt; difftime(today, dob, units=<span class="string">"weeks"</span>)</div><div class="line">Time difference of <span class="number">2988.143</span> weeks</div></pre></td></tr></table></figure></p>
<p>as.character(dates)用于将日期转化为字符型变量，其它与日期有关的函数可以查看help(as.Date),help(strftime)，与日期有关的包为lubridate，复杂日期计算有关<br>的包为fCalendar。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/03/R/R笔记（3）-包的操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/03/R/R笔记（3）-包的操作/" itemprop="url">R笔记（3）——包的操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-03T12:00:00+08:00">
                2017-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,044
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装包-install-packages"><a href="#安装包-install-packages" class="headerlink" title="安装包:install.packages()"></a>安装包:install.packages()</h2><p>括号里面包的名称要加英文引号，在列出的CRAN镜像站点列表中选择一个进行下载，例如<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(“ggplot2”)</div></pre></td></tr></table></figure></p>
<p>安装包的时候可以切换安装源，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">install.packages(pkgs, lib, repos = getOption(&quot;repos&quot;),</div><div class="line">    contriburl = contrib.url(repos, type),</div><div class="line">    method, available = NULL, destdir = NULL,</div><div class="line">    dependencies = NA, type = getOption(&quot;pkgType&quot;),</div><div class="line">    configure.args = getOption(&quot;configure.args&quot;),</div><div class="line">    configure.vars = getOption(&quot;configure.vars&quot;),</div><div class="line">    clean = FALSE, Ncpus = getOption(&quot;Ncpus&quot;, 1L),</div><div class="line">    verbose = getOption(&quot;verbose&quot;),</div><div class="line">    libs_only = FALSE, INSTALL_opts, quiet = FALSE,</div><div class="line">    keep_outputs = FALSE, ...)</div></pre></td></tr></table></figure>
<p>使用格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;ABC&quot;,repos=&quot;http://mirror.bjtu.edu.cn/ &quot;)</div></pre></td></tr></table></figure></p>
<p>如果是要从GitHub上安装包，需要先安装<code>devtools</code>，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"devtools"</span>)</div><div class="line">install_github(<span class="string">"genomicsclass/dagdata"</span>)</div></pre></td></tr></table></figure></p>
<p>其它的包安装命令，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"installr"</span>)   <span class="comment"># 下载并安装 installr 包</span></div><div class="line"><span class="keyword">library</span>(installr)              <span class="comment"># 装载 installr 包</span></div><div class="line">install.RStudio()              <span class="comment"># 下载并安装 RStudio IDE</span></div><div class="line">install.Rtools()               <span class="comment"># 你需要 Rtools 来构建自己的包</span></div><div class="line">install.git()                  <span class="comment">#git 提供了代码的版本控制功能</span></div></pre></td></tr></table></figure>
<h3 id="BiocLite包安装"><a href="#BiocLite包安装" class="headerlink" title="BiocLite包安装"></a>BiocLite包安装</h3><p>生信很多工在bioconductor上，因此需要<code>biocLite</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span>(<span class="string">"https://bioconductor.org/biocLite.R"</span>)</div><div class="line">options(BioC_mirror=<span class="string">"http://mirrors.ustc.edu.cn/bioc/"</span>)</div><div class="line"><span class="comment"># 使用相应的镜像</span></div><div class="line">biocLite(c(<span class="string">"ALL"</span>,<span class="string">"CLL"</span>, <span class="string">"pasilla"</span>, <span class="string">"airway"</span>)) <span class="comment">#数据包</span></div><div class="line">biocLite(c(<span class="string">"limma"</span>,<span class="string">"DESeq2"</span>, <span class="string">"clusterProfiler"</span>)) <span class="comment">#软件包</span></div></pre></td></tr></table></figure>
<h2 id="批量下载并且加载R包"><a href="#批量下载并且加载R包" class="headerlink" title="批量下载并且加载R包"></a>批量下载并且加载R包</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">list.of.packages &lt;- c(<span class="string">"xx"</span>, <span class="string">"yy"</span>) <span class="comment"># replace xx and yy with package names</span></div><div class="line">new.packages &lt;- list.of.packages[!(list.of.packages %<span class="keyword">in</span>% installed.packages()[,<span class="string">"Package"</span>])]</div><div class="line"><span class="keyword">if</span>(length(new.packages)) install.packages(new.packages)</div><div class="line">lapply(new.packages, <span class="keyword">require</span>, character.only=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<h2 id="使用if语句加载包"><a href="#使用if语句加载包" class="headerlink" title="使用if语句加载包"></a>使用if语句加载包</h2><p>通过if语句，可以判断某个包是否存在，如果不存在，就先下载，后加载，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#另外可以检测某个包是否存在，只有不存在时才会安装</span></div><div class="line"><span class="keyword">if</span> (! <span class="keyword">require</span> (<span class="string">'reshape2'</span>))&#123;</div><div class="line">    install.package(<span class="string">"reshape2"</span>)</div><div class="line">    <span class="keyword">library</span>(reshape2)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果是bioconductor上的包，也可以按以下方式进行安装：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (! <span class="keyword">require</span> (<span class="string">'CLL'</span>))&#123;</div><div class="line">    options(BioC_mirror=<span class="string">"http://mirrors.ustc.edu.cn/bioc/"</span>)</div><div class="line">    BiocInstaller::biocLite(<span class="string">'CLL'</span>,ask = <span class="literal">F</span>, suppressUpdates = <span class="literal">T</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="包的加载"><a href="#包的加载" class="headerlink" title="包的加载"></a>包的加载</h2><p>包的载入library()或require()，安装完包后，需要加载才能使用其中的函数，此时括号中不使用引号。两者的不同之处在于library()载入之后不返回任何信息，而require()载入后则会返回TRUE，因此require()适合用于程序的书写。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">require</span>(foreign)</div><div class="line">Loading required package: foreign</div></pre></td></tr></table></figure></p>
<h2 id="查看一个包的帮助"><a href="#查看一个包的帮助" class="headerlink" title="查看一个包的帮助"></a>查看一个包的帮助</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">help(package=<span class="string">"base"</span>)</div></pre></td></tr></table></figure>
<h2 id="卸载包"><a href="#卸载包" class="headerlink" title="卸载包"></a>卸载包</h2><p>detach()，这是library()的反向操作，此操作主要是为了避免某些包中的函数名称相同，造成冲突，注意与library()的参数不同，detach()参数为detach(package:包的名称),library(包的名称)，例如：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2) <span class="comment">#加载包</span></div><div class="line">(.packages()) <span class="comment">#列出当前已经加载的包</span></div><div class="line"> [<span class="number">1</span>] <span class="string">"foreign"</span>   <span class="string">"ggplot2"</span>   <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>    </div><div class="line"> [<span class="number">7</span>] <span class="string">"datasets"</span>  <span class="string">"methods"</span>   <span class="string">"base"</span></div><div class="line"><span class="keyword">detach</span>(package:ggplot2)  <span class="comment">#卸载ggplot2包</span></div><div class="line">(.packages()) <span class="comment">#列出当前已经加载的包</span></div><div class="line"> [<span class="number">1</span>] <span class="string">"foreign"</span>   <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>     <span class="string">"datasets"</span> </div><div class="line"> [<span class="number">7</span>] <span class="string">"methods"</span>   <span class="string">"base"</span></div></pre></td></tr></table></figure></p>
<h3 id="删除包"><a href="#删除包" class="headerlink" title="删除包"></a>删除包</h3><p>remove.packages()<br>使用条件：R语言自带的install.packages函数来安装一个包时，都是默认安装最新版的。 但是有些R包的开发者他会引用其它的一些R包，但是它用的是旧版本的功能，自己来不及更新或者疏忽了。 而我们又不得不用他的包，这时候就不得不卸载最新版包，转而安装旧版本包。</p>
<h2 id="查询加载的包"><a href="#查询加载的包" class="headerlink" title="查询加载的包"></a>查询加载的包</h2><p>search()<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">search()</div><div class="line"> [<span class="number">1</span>] <span class="string">".GlobalEnv"</span>        <span class="string">"package:stats"</span>     <span class="string">"package:graphics"</span> </div><div class="line"> [<span class="number">4</span>] <span class="string">"package:grDevices"</span> <span class="string">"package:utils"</span>     <span class="string">"package:datasets"</span> </div><div class="line"> [<span class="number">7</span>] <span class="string">"package:methods"</span>   <span class="string">"Autoloads"</span>         <span class="string">"package:base"</span></div></pre></td></tr></table></figure></p>
<h2 id="libPaths-能够显示库所在的位置"><a href="#libPaths-能够显示库所在的位置" class="headerlink" title=".libPaths()能够显示库所在的位置"></a>.libPaths()能够显示库所在的位置</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.libPaths()</div><div class="line"> [<span class="number">1</span>] <span class="string">"C:/Users/Cloud/Documents/R/win-library/3.1"</span></div><div class="line"> [<span class="number">2</span>] <span class="string">"C:/Program Files/R/R-3.1.3/library"</span></div></pre></td></tr></table></figure>
<h2 id="library-显示库中有哪些包"><a href="#library-显示库中有哪些包" class="headerlink" title="library()显示库中有哪些包"></a>library()显示库中有哪些包</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>()</div><div class="line">backports               Reimplementations of Functions Introduced Since</div><div class="line">                        R-<span class="number">3.0</span><span class="number">.0</span></div><div class="line">base64enc               Tools <span class="keyword">for</span> base64 encoding</div><div class="line">bitops                  Bitwise Operations</div><div class="line">bookdown                Authoring Books and Technical Documents with R</div><div class="line">                        Markdown</div><div class="line">caTools                 Tools: moving window statistics, GIF, Base64,</div><div class="line">                        ROC AUC, etc.</div><div class="line">cellranger              Translate Spreadsheet Cell Ranges to Rows and</div><div class="line">                        Columns</div><div class="line">digest                  Create Compact Hash Digests of R Objects</div><div class="line">evaluate                Parsing and Evaluation Tools that Provide More</div><div class="line">                        Details than the Default</div><div class="line"><span class="keyword">...</span></div><div class="line"><span class="keyword">...</span></div></pre></td></tr></table></figure>
<h3 id="查看已经安装的包"><a href="#查看已经安装的包" class="headerlink" title="查看已经安装的包"></a>查看已经安装的包</h3><p>函数installed.packages()</p>
<p>如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/fid4l75ccL.png?imageslim" alt="mark"></p>
<h2 id="包的更新"><a href="#包的更新" class="headerlink" title="包的更新"></a>包的更新</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update.packages()</div></pre></td></tr></table></figure>
<h2 id="查看本地的包"><a href="#查看本地的包" class="headerlink" title="查看本地的包"></a>查看本地的包</h2><h3 id="查看默认加载的包，忽略基本的包"><a href="#查看默认加载的包，忽略基本的包" class="headerlink" title="查看默认加载的包，忽略基本的包"></a>查看默认加载的包，忽略基本的包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; getOption(<span class="string">"defaultPackages"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"datasets"</span>  <span class="string">"utils"</span>     <span class="string">"grDevices"</span> <span class="string">"graphics"</span>  <span class="string">"stats"</span>     <span class="string">"methods"</span></div></pre></td></tr></table></figure>
<h3 id="查看当前已经加载过的包"><a href="#查看当前已经加载过的包" class="headerlink" title="查看当前已经加载过的包"></a>查看当前已经加载过的包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; (.packages())</div><div class="line">[<span class="number">1</span>] <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>     <span class="string">"datasets"</span>  <span class="string">"methods"</span></div><div class="line">[<span class="number">7</span>] <span class="string">"base"</span></div></pre></td></tr></table></figure>
<h2 id="显示所有可用的包"><a href="#显示所有可用的包" class="headerlink" title="显示所有可用的包"></a>显示所有可用的包</h2><p>(.packages(all.available=TRUE))<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">(.packages(all.available=<span class="literal">TRUE</span>))</div><div class="line">  [<span class="number">1</span>] <span class="string">"bitops"</span>       <span class="string">"car"</span>          <span class="string">"caTools"</span>      <span class="string">"coin"</span>        </div><div class="line">  [<span class="number">5</span>] <span class="string">"colorspace"</span>   <span class="string">"crayon"</span>       <span class="string">"curl"</span>         <span class="string">"dichromat"</span>   </div><div class="line">  [<span class="number">9</span>] <span class="string">"digest"</span>       <span class="string">"evaluate"</span>     <span class="string">"formatR"</span>      <span class="string">"fun"</span>         </div><div class="line"> [<span class="number">13</span>] <span class="string">"ggplot2"</span>      <span class="string">"gtable"</span>       <span class="string">"highr"</span>        <span class="string">"htmltools"</span>   </div><div class="line"> [<span class="number">17</span>] <span class="string">"httr"</span>         <span class="string">"ISwR"</span>         <span class="string">"jsonlite"</span>     <span class="string">"KMsurv"</span>      </div><div class="line"> [<span class="number">21</span>] <span class="string">"knitr"</span>        <span class="string">"labeling"</span>     <span class="string">"lme4"</span>         <span class="string">"magrittr"</span>    </div><div class="line"> [<span class="number">25</span>] <span class="string">"maps"</span>         <span class="string">"maptools"</span>     <span class="string">"markdown"</span>     <span class="string">"MatrixModels"</span></div><div class="line"> [<span class="number">29</span>] <span class="string">"memoise"</span>      <span class="string">"mime"</span>         <span class="string">"minqa"</span>        <span class="string">"mnormt"</span>      </div><div class="line"> [<span class="number">33</span>] <span class="string">"modeltools"</span>   <span class="string">"multcomp"</span>     <span class="string">"munsell"</span>      <span class="string">"mvtnorm"</span>     </div><div class="line"> [<span class="number">37</span>] <span class="string">"nloptr"</span>       <span class="string">"openssl"</span>      <span class="string">"pbkrtest"</span>     <span class="string">"plyr"</span>        </div><div class="line"> [<span class="number">41</span>] <span class="string">"praise"</span>       <span class="string">"psych"</span>        <span class="string">"quantreg"</span>     <span class="string">"R6"</span>          </div><div class="line"> [<span class="number">45</span>] <span class="string">"RColorBrewer"</span> <span class="string">"Rcpp"</span>         <span class="string">"RcppEigen"</span>    <span class="string">"RCurl"</span>       </div><div class="line"> [<span class="number">49</span>] <span class="string">"reshape2"</span>     <span class="string">"rmarkdown"</span>    <span class="string">"sandwich"</span>     <span class="string">"scales"</span>      </div><div class="line"> [<span class="number">53</span>] <span class="string">"sp"</span>           <span class="string">"SparseM"</span>      <span class="string">"stringi"</span>      <span class="string">"stringr"</span>     </div><div class="line"> [<span class="number">57</span>] <span class="string">"swirl"</span>        <span class="string">"testthat"</span>     <span class="string">"TH.data"</span>      <span class="string">"yaml"</span>        </div><div class="line"> [<span class="number">61</span>] <span class="string">"zoo"</span>          <span class="string">"base"</span>         <span class="string">"boot"</span>         <span class="string">"class"</span>       </div><div class="line"> [<span class="number">65</span>] <span class="string">"cluster"</span>      <span class="string">"codetools"</span>    <span class="string">"compiler"</span>     <span class="string">"datasets"</span>    </div><div class="line"> [<span class="number">69</span>] <span class="string">"foreign"</span>      <span class="string">"graphics"</span>     <span class="string">"grDevices"</span>    <span class="string">"grid"</span>        </div><div class="line"> [<span class="number">73</span>] <span class="string">"KernSmooth"</span>   <span class="string">"lattice"</span>      <span class="string">"MASS"</span>         <span class="string">"Matrix"</span>      </div><div class="line"> [<span class="number">77</span>] <span class="string">"methods"</span>      <span class="string">"mgcv"</span>         <span class="string">"nlme"</span>         <span class="string">"nnet"</span>        </div><div class="line"> [<span class="number">81</span>] <span class="string">"parallel"</span>     <span class="string">"rpart"</span>        <span class="string">"spatial"</span>      <span class="string">"splines"</span>     </div><div class="line"> [<span class="number">85</span>] <span class="string">"stats"</span>        <span class="string">"stats4"</span>       <span class="string">"survival"</span>     <span class="string">"tcltk"</span>       </div><div class="line"> [<span class="number">89</span>] <span class="string">"tools"</span>        <span class="string">"utils"</span></div></pre></td></tr></table></figure></p>
<h2 id="自定义启动时候的加载包"><a href="#自定义启动时候的加载包" class="headerlink" title="自定义启动时候的加载包"></a>自定义启动时候的加载包</h2><p>如果需要长期使用某个包的话，每次开启都需要输入library()，比较麻烦，因此可以让R启动时自动加载某些包。在R的安装目录/etc/Rprofile.site加入下载语句：</p>
<p>例如让R启动时自动加载ggplot2包<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">local(&#123;old &lt;- getOption(“defaultPackages”)</div><div class="line">options(defaultPackages = c(old, “ggplot2”))&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="安装包，并加载包"><a href="#安装包，并加载包" class="headerlink" title="安装包，并加载包"></a>安装包，并加载包</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span>(!<span class="keyword">require</span>(<span class="string">"multcomp"</span>))&#123;</div><div class="line"></div><div class="line">  install.packages(<span class="string">"multcomp"</span>)</div><div class="line"></div><div class="line">  <span class="keyword">library</span>(multcomp)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="常用R包的搜集"><a href="#常用R包的搜集" class="headerlink" title="常用R包的搜集"></a>常用R包的搜集</h2><h3 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h3><p>以下R包主要用于数据导入和保存数据</p>
<ul>
<li><p>feather：一种快速，轻量级的文件格式。在R和python上都可使用</p>
</li>
<li><p>readr：实现表格数据的快速导入。中文介绍可参考这里</p>
</li>
<li><p>readxl：读取Microsoft Excel电子表格数据</p>
</li>
<li><p>openxlsx：读取Microsoft Excel电子表格数据</p>
</li>
<li><p>googlesheets：读取google电子表格数据</p>
</li>
<li><p>haven：读取SAS，SPSS和Stata统计软件格式的数据</p>
</li>
<li><p>httr：从网站开放的API中读取数据</p>
</li>
<li><p>rvest：网页数据抓取包</p>
</li>
<li><p>xml2：读取HTML和XML格式数据</p>
</li>
<li><p>webreadr：读取常见的Web日志格式数据</p>
</li>
<li><p>DBI：数据库管理系统通用接口包</p>
</li>
<li><ul>
<li>RMySQL：用于连接MySQL数据库的R包</li>
<li>RPostgres：用于连接PostgreSQL数据库的R包</li>
<li>bigrquery用于连接Google BigQuery的R包</li>
</ul>
</li>
<li><p>PivotalR：用于读取Pivitol（Greenplum）和HAWQ数据库中的数据</p>
</li>
<li><p>dplyr：提供了一个访问常见数据库的接口</p>
</li>
<li><p>data.table：data.table包的<code>fread()</code>函数可以快速读取大数据集</p>
</li>
<li><p>git2r：用于访问git仓库</p>
</li>
</ul>
<h3 id="数据整理"><a href="#数据整理" class="headerlink" title="数据整理"></a>数据整理</h3><p>以下R包主要用于数据整理，以便于你后续建模分析：</p>
<ul>
<li>tidyr：用于整理表格数据的布局</li>
<li>dplyr：用于将多个数据表连接成一个整齐的数据集</li>
<li>purrr：函数式编程工具，在做数据整理时非常有用。</li>
<li>broom：用于将统计模型的结果整理成数据框形式</li>
<li>zoo：定义了一个名zoo的S3类型对象，用于描述规则的和不规则的有序的时间序列数据。</li>
</ul>
<h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><p>以下R包用于数据可视化：</p>
<ul>
<li><p>ggplot2及其扩展：ggplot2包提供了一个强大的绘图系统，并实现了以下扩展</p>
</li>
<li><ul>
<li>ggthemes：提供扩展的图形风格主题</li>
<li>ggmap：提供Google Maps，Open Street Maps等流行的在线地图服务模块</li>
<li>ggiraph：绘制交互式的ggplot图形</li>
<li>ggstance：实现常见图形的横向版本</li>
<li>GGally：绘制散点图矩阵</li>
<li>ggalt：添加额外的坐标轴，geoms等</li>
<li>ggforce：添加额外geoms等</li>
<li>ggrepel：用于避免图形标签重叠</li>
<li>ggraph：用于绘制网络状、树状等特定形状的图形</li>
<li>ggpmisc：光生物学相关扩展</li>
<li>geomnet：绘制网络状图形</li>
<li>ggExtra：绘制图形的边界直方图</li>
<li>gganimate：绘制动画图</li>
<li>plotROC：绘制交互式ROC曲线图</li>
<li>ggspectra：绘制光谱图</li>
<li>ggnetwork：网络状图形的geoms</li>
<li>ggradar：绘制雷达图</li>
<li>ggTimeSeries：时间序列数据可视化</li>
<li>ggtree：树图可视化</li>
<li>ggseas：季节调整工具</li>
</ul>
</li>
<li><p>lattice：生成栅栏图</p>
</li>
<li><p>rgl：交互式3D绘图</p>
</li>
<li><p>ggvis：交互式图表多功能系统</p>
</li>
<li><p>htmlwidgets：一个专为R语言打造的可视化JS库</p>
</li>
<li><ul>
<li>leaflet：绘制交互式地图</li>
<li>dygraphs：绘制交互式时间序列图</li>
<li>plotly：交互式绘图包，中文介绍详见这里</li>
<li>rbokeh：用于创建交互式图表和地图，中文介绍</li>
<li>Highcharter：绘制交互式Highcharts图</li>
<li>visNetwork：绘制交互式网状图</li>
<li>networkD3：绘制交互式网状图</li>
<li>d3heatmap：绘制交互式热力图，中文介绍</li>
<li>DT：用于创建交互式表格</li>
<li>threejs：绘制交互式3d图形和地球仪 -rglwidget：绘制交互式3d图形</li>
<li>DiagrammeR：绘制交互式图表</li>
<li>MetricsGraphics：绘制交互式MetricsGraphics图</li>
</ul>
</li>
<li><p>rCharts：提供了对多个javascript数据可视化库（highcharts/nvd3/polychart）的R封装。</p>
</li>
<li><p>coefplot：可视化统计模型结果</p>
</li>
<li><p>quantmod：可视化金融图表</p>
</li>
<li><p>colorspace：基于HSL的调色板</p>
</li>
<li><p>viridis：Matplotlib viridis调色板</p>
</li>
<li><p>munsell：Munsell调色板</p>
</li>
<li><p>RColorBrewer：图形调色板</p>
</li>
<li><p>igraph：用于网络分析和可视化</p>
</li>
<li><p>latticeExtra：lattice绘图系统扩展包</p>
</li>
<li><p>sp：空间数据工具</p>
</li>
</ul>
<h3 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h3><p>以下R包用于将数据转换为新的数据类型</p>
<ul>
<li>dplyr：一个用于高效数据清理的R包。视频学习课程</li>
<li>magrittr：一个高效的管道操作工具包。</li>
<li>tibble：高效的显示表格数据的结构</li>
<li>stringr：一个字符串处理工具集</li>
<li>lubridate：用于处理日期时间数据</li>
<li>xts：xts是对时间序列数据(zoo)的一种扩展实现，提供了时间序列的操作接口。</li>
<li>data.table：用于快速处理大数据集</li>
<li>vtreat：一个对预测模型进行变量预处理的工具</li>
<li>stringi：一个快速字符串处理工具</li>
<li>Matrix：著名的稀疏矩阵包</li>
</ul>
<h3 id="统计建模与推断"><a href="#统计建模与推断" class="headerlink" title="统计建模与推断"></a>统计建模与推断</h3><p>下述R包是统计建模最常用的几个R包，其中的一些R包适用于多个主题。</p>
<ul>
<li>car：提供了大量的增强版的拟合和评价回归模型的函数。</li>
<li>Hmisc：提供各种用于数据分析的函数</li>
<li>multcomp：参数模型中的常见线性假设的同时检验和置信区间计算，包括线性、广义线性、线性混合效应和生存模型。</li>
<li>pbkrtest用于线性混合效应模型的参数Bootstrap检验</li>
<li>MatrixModels：用于稠密矩阵和稀疏矩阵建模</li>
<li>mvtnorm：用于计算多元正态分布和t分布的概率，分位数，随机偏差等</li>
<li>SparseM：用于稀疏矩阵的基本线性代数运算</li>
<li>lme4：利用C++矩阵库 Eigen进行线性混合效应模型的计算。</li>
<li>broom：将统计模型结果整理成数据框形式</li>
<li>caret：一个用于解决分类和回归问题的数据训练综合工具包</li>
<li>glmnet：通过极大惩罚似然来拟合广义线性模型</li>
<li>gbm：用于实现随机梯度提升算法</li>
<li>xgboost：全称是eXtreme Gradient Boosting。是Gradient Boosting Machine的一个c++实现。目前已制作了xgboost工具的R语言接口。详见统计之都的一篇介绍</li>
<li>randomForest：提供了用随机森林做回归和分类的函数</li>
<li>ranger：用于随机森林算法的快速实现</li>
<li>h2o：H2O是0xdata的旗舰产品，是一款核心数据分析平台。它的一部分是由R语言编写的，另一部分是由Java和Python语言编写的。用户可以部署H2O的R程序安装包，之后就可以在R语言环境下运行了。</li>
<li>ROCR：通过绘图来可视化分类器的综合性能。</li>
<li>pROC：用于可视化，平滑和对比ROC曲线</li>
</ul>
<h3 id="沟通交流"><a href="#沟通交流" class="headerlink" title="沟通交流"></a>沟通交流</h3><p>以下R包用于实现数据科学结果的自动化报告，以便于你跟人们进行沟通交流。</p>
<ul>
<li>rmarkdown ：用于创建可重复性报告和动态文档</li>
<li>knitr：用于在PDF和HTML文档中嵌入R代码块</li>
<li>flexdashboard：基于rmarkdown，可以轻松的创建仪表盘</li>
<li>bookdown：以R Markdown为基础，用于创作书籍和长篇文档</li>
<li>rticles：提供了一套R Markdown模板</li>
<li>tufte：用于实现Tufte讲义风格的R Markdown模板</li>
<li>DT：用于创建交互式的数据表</li>
<li>pixiedust：用于自定义数据表的输出</li>
<li>xtable：用于自定义数据表的输出</li>
<li>highr：用于实现R代码的LaTeX或HTML格式输出</li>
<li>formatR：通过<code>tidy_source</code>函数格式化R代码的输出</li>
<li>yaml：用于实现R数据与YAML格式数据之间的通信。</li>
</ul>
<h3 id="自动化分析"><a href="#自动化分析" class="headerlink" title="自动化分析"></a>自动化分析</h3><p>以下R包用于创建自动化分析结果的数据科学产品：</p>
<ul>
<li><p>shiny：一个使用R语言开发交互式web应用程序的工具。中文教程</p>
</li>
<li><ul>
<li>shinydashboard：用于创建交互式仪表盘</li>
<li>shinythemes：给出了Shiny应用程序的常用风格主题</li>
<li>shinyAce：为Shiny应用程序开发者提供Ace代码编辑器。</li>
<li>shinyjs：用于在Shiny应用程序中执行常见的JavaScript操作</li>
<li>miniUI：提供了一个UI小部件，用于在R命令行中集成交互式应用程序</li>
<li>shinyapps.io：为创建的Shiny应用程序提供托管服务</li>
<li>Shiny Server Open Source：为Shiny应用程序提供开源免费的服务器</li>
<li>Shiny Server Pro：为企业级用户提供一个Shiny应用程序服务器</li>
</ul>
</li>
<li><p>rsconnect：用于将Shiny应用程序部署到shinyapps.io</p>
</li>
<li><p>plumber：用于将R代码转化为一个web API</p>
</li>
<li><p>rmarkdown：用于创建可重复性报告和动态文档</p>
</li>
<li><p>rstudioapi：用于安全地访问RStudio IDE的API</p>
</li>
</ul>
<h3 id="程序开发"><a href="#程序开发" class="headerlink" title="程序开发"></a>程序开发</h3><p>以下这些包主要用于开发自定义的R包：</p>
<ul>
<li>RStudio Desktop IDE：R的IDE。大家都懂，不用解释。</li>
<li>RStudio Server Open Source：开源免费的RStudio服务器</li>
<li>RStudio Server Professional：商业版RStudio服务器</li>
<li>devtools：一个让开发R包变得简单的工具集</li>
<li>packrat：创建项目的特定库，用于处理包的版本问题，增强代码重现能力。</li>
<li>drat：一个用于创建和使用备选R包库的工具</li>
<li>testthat：单元测试，让R包稳定、健壮，减少升级的痛苦。</li>
<li>roxygen2：通过注释的方式，生成文档，远离Latex的烦恼。</li>
<li>purrr：一个用于 提供函数式编程方法的工具</li>
<li>profvis：用于可视化R代码的性能分析数据</li>
<li>Rcpp：用于实现R与C++的无缝整合。详见统计之都文章</li>
<li>R6：R6是R语言的一个面向对象的R包，可以更加高效的构建面向对象系统。</li>
<li>htmltools：用于生成HTML格式输出</li>
<li>nloptr：提供了一个NLopt非线性优化库的接口</li>
<li>minqa：一个二次近似的优化算法包</li>
<li>rngtools：一个用于处理随机数生成器的实用工具</li>
<li>NMF：提供了一个执行非负矩阵分解的算法和框架</li>
<li>crayon：用于在输出终端添加颜色</li>
<li>RJSONIO：rjson是一个R语言与json进行转的包，是一个非常简单的包，支持用 C类库转型和R语言本身转型两种方式。</li>
<li>jsonlite：用于实现R语言与json数据格式之间的转化</li>
<li>RcppArmadillo：提供了一个Armadillo C++ Library（一种C++的线性代数库）的接口</li>
</ul>
<hr>
<h3 id="实验数据"><a href="#实验数据" class="headerlink" title="实验数据"></a>实验数据</h3><p>以下R包给出了案例实战过程中可用的训练数据集：</p>
<ul>
<li>babynames：包含由美国社会保障局提供的三个数据集</li>
<li>neiss：2009-2014年期间提供给美国急诊室的所有事故报告样本数据</li>
<li>yrbss：美国疾病控制中心2009-2013年期间青年危险行为监测系统数据</li>
<li>hflights：</li>
<li>USAboundaries：2011年全年休斯顿机场的所有航班数据</li>
<li>rworldmap：国家边界数据</li>
<li>usdanutrients：美国农业部营养数据库</li>
<li>fueleconomy：美国环保署1984-2015年期间的燃油经济数据</li>
<li>nasaweather：包含了一个覆盖中美洲的非常粗糙的24*24格地理位置和大气测量数据。</li>
<li>mexico-mortality：墨西哥死亡人数数据</li>
<li>data-movies和ggplotmovies：来自互联网电影数据库imdb.com的数据</li>
<li>pop-flows：2008年全美人口流动数据</li>
<li>data-housing-crisis：经过清洗后的2008美国房地产危机数据</li>
<li>gun-sales：纽约时报提供的有关枪支购买的每月背景调查统计分析数据</li>
<li>stationaRy：从成千上万个全球站点收集到的每小时气象数据</li>
<li>gapminder：摘自Gapminder的数据</li>
<li>janeaustenr：简·奥斯丁小说全集数据</li>
</ul>
<h2 id="查看R的版本"><a href="#查看R的版本" class="headerlink" title="查看R的版本"></a>查看R的版本</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo() <span class="comment"># 要加括号</span></div></pre></td></tr></table></figure>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; sessionInfo() <span class="comment"># 要加括号</span></div><div class="line">R version <span class="number">3.4</span><span class="number">.0</span> (<span class="number">2017</span>-<span class="number">04</span>-<span class="number">21</span>)</div><div class="line">Platform: x86_64-w64-mingw32/x64 (<span class="number">64</span>-bit)</div><div class="line">Running under: Windows &gt;= <span class="number">8</span> x64 (build <span class="number">9200</span>)</div><div class="line"></div><div class="line">Matrix products: default</div><div class="line"></div><div class="line">locale:</div><div class="line">[<span class="number">1</span>] LC_COLLATE=Chinese (Simplified)_China.936  LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">[<span class="number">3</span>] LC_MONETARY=Chinese (Simplified)_China.936 LC_NUMERIC=C                              </div><div class="line">[<span class="number">5</span>] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line"></div><div class="line">attached base packages:</div><div class="line">[<span class="number">1</span>] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line"></div><div class="line">other attached packages:</div><div class="line">[<span class="number">1</span>] downloader_0.4 rafalib_1.0.0 </div><div class="line"></div><div class="line">loaded via a namespace (and not attached):</div><div class="line">[<span class="number">1</span>] compiler_3.4.0     tools_3.4.0        RColorBrewer_1.1-<span class="number">2</span> digest_0.6.15</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="http://www.xueqing.tv/cms/article/198" target="_blank" rel="external">http://www.xueqing.tv/cms/article/198</a> </li>
<li><a href="http://blog.fens.me/" target="_blank" rel="external">http://blog.fens.me/</a> </li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/02/R/R笔记（2）-数据类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/02/R/R笔记（2）-数据类型/" itemprop="url">R笔记（2）——数据类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-02T12:00:00+08:00">
                2017-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  12,517
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  63
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="常见数据类型"><a href="#常见数据类型" class="headerlink" title="常见数据类型"></a>常见数据类型</h1><p>R拥有许多用于存储数据的对象类型，包括标量、向量、矩阵、数组、数据框和列表。它们在存储数据的类型、创建方式、结构复杂度，以及用于定位和访问其中个别元素的标记等方面均有所不同。下图给出了这些数据结构的一个示意图：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/K1f9i05mDc.png?imageslim" alt="mark"></p>
<h1 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h1><h2 id="常见向量类型"><a href="#常见向量类型" class="headerlink" title="常见向量类型"></a>常见向量类型</h2><p>向量可以是数值，字符，逻辑等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; a&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,-<span class="number">3</span>,-<span class="number">4</span>);a <span class="comment">#数值型向量</span></div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span> -<span class="number">3</span> -<span class="number">4</span></div><div class="line">&gt; b&lt;-c(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>);b <span class="comment">#字符型向量</span></div><div class="line">[<span class="number">1</span>] <span class="string">"one"</span>   <span class="string">"two"</span>   <span class="string">"three"</span></div><div class="line">&gt; c&lt;-c(<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">FALSE</span>);c <span class="comment">#逻辑型向量</span></div><div class="line">[<span class="number">1</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div><div class="line">&gt; x&lt;-c(<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>);x</div><div class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">4</span> <span class="number">2</span></div><div class="line">&gt; x[<span class="number">9</span>]&lt;-<span class="number">9</span>;x <span class="comment"># 当向量x不够长时，指定第9个元素为9,#自动将中间的元素补为NA</span></div><div class="line">[<span class="number">1</span>]  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span> <span class="literal">NA</span> <span class="literal">NA</span> <span class="literal">NA</span> <span class="literal">NA</span> <span class="literal">NA</span>  <span class="number">9</span></div></pre></td></tr></table></figure>
<h2 id="向量的下标"><a href="#向量的下标" class="headerlink" title="向量的下标"></a>向量的下标</h2><p>向量的元素下标取值是以1开始，例如：要前例中取x向量中值为1,则为x[2]，如果一个向量中有一个字符，则该向量的类型会变成字符，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; demo_1&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="string">'a'</span>)</div><div class="line">&gt; demo_1</div><div class="line">[<span class="number">1</span>] <span class="string">"1"</span> <span class="string">"2"</span> <span class="string">"a"</span></div><div class="line">&gt; mode(demo_1)</div><div class="line">[<span class="number">1</span>] <span class="string">"character"</span></div></pre></td></tr></table></figure>
<h2 id="向量的名称"><a href="#向量的名称" class="headerlink" title="向量的名称"></a>向量的名称</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; years &lt;- c(<span class="number">1960</span>,<span class="number">1964</span>,<span class="number">1976</span>,<span class="number">1994</span>)</div><div class="line">&gt; years</div><div class="line">[<span class="number">1</span>] <span class="number">1960</span> <span class="number">1964</span> <span class="number">1976</span> <span class="number">1994</span></div><div class="line">&gt; names(years)&lt;-c(<span class="string">"Kennedy"</span>, <span class="string">"Johnson"</span>, <span class="string">"Carter"</span>,<span class="string">"Clinton"</span>);years</div><div class="line">Kennedy Johnson  Carter Clinton </div><div class="line">   <span class="number">1960</span>    <span class="number">1964</span>    <span class="number">1976</span>    <span class="number">1994</span></div></pre></td></tr></table></figure>
<h2 id="向量元素的添加及合并"><a href="#向量元素的添加及合并" class="headerlink" title="向量元素的添加及合并"></a>向量元素的添加及合并</h2><p>常用函数为<code>c()</code>，<code>append()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">v1&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);v1</div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line">v2&lt;-c(v1,<span class="number">55</span>);v2 </div><div class="line"><span class="comment">#格式为新向量&lt;-(原向量，新元素)</span></div><div class="line"><span class="comment">## [1]  12  3 55</span></div><div class="line">c(v2,v1) <span class="comment"># 向量的合并</span></div><div class="line"><span class="comment">## [1]  12  3 55  12  3</span></div><div class="line">append(v1,<span class="number">10</span>,after=<span class="number">3</span>) <span class="comment">#在第3个向量后面加入10</span></div><div class="line"><span class="comment">## [1]  12  3 10</span></div></pre></td></tr></table></figure>
<p>如果逻辑变量与数值在一起，则为转换成数值。TRUE转变成1 and FALSE 转变成 0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; demo_2&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="literal">TRUE</span>);demo_2</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; mode(demo_2)</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div></pre></td></tr></table></figure>
<p>在R语言中没有单一的整数、单一字符的概念，例如：<code>X&lt;-2</code>；<code>X&lt;-&#39;a&#39;</code>；R都是当作向量来处理，只是这个向量只包括单一值。</p>
<h2 id="向量批量序列的生成"><a href="#向量批量序列的生成" class="headerlink" title="向量批量序列的生成"></a>向量批量序列的生成</h2><h3 id="seq"><a href="#seq" class="headerlink" title="seq()"></a>seq()</h3><p>用法：<code>seq(length=, from=, to=)</code></p>
<p>length:指定生成个数；from:是指开始生成的点；to:截止点。如果不指定，则默认条件下：seq(N1,N2,BY=)，其中，n1：开始位置；n2：截止位置；by=指定间隔，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">seq(length=<span class="number">10</span>,from=<span class="number">10</span>,to=<span class="number">100</span>) <span class="comment"># 生成从10到100的向量，一共10个</span></div><div class="line"><span class="comment">##  [1]10  20  3040  50  6070  80  90 100</span></div><div class="line"></div><div class="line"><span class="comment"># 此命令等价于：</span></div><div class="line">seq(<span class="number">10</span>,<span class="number">100</span>,<span class="number">10</span>)</div><div class="line"><span class="comment">##  [1]10  20  3040  50  6070  80  90 100</span></div><div class="line">seq(<span class="number">1</span>,<span class="number">10</span>,by=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1] 1 3 5 7 9</span></div><div class="line">seq(<span class="number">1</span>,<span class="number">10</span>,length=<span class="number">6</span>)</div><div class="line"><span class="comment">## [1]  1.02.8  4.6  6.48.2 10.0</span></div><div class="line">sequence(<span class="number">2</span>:<span class="number">3</span>) <span class="comment">#产生以 2 和 3 结尾的序列数据</span></div><div class="line"><span class="comment">## [1] 1 2 1 2 3</span></div></pre></td></tr></table></figure>
<h3 id="rep"><a href="#rep" class="headerlink" title="rep()"></a>rep()</h3><p>用法：1. rep(P，N) 重复生成P值N次；2.rep(a1:a2,a1:a2) #重复a1到a2，按a1产生a1次，按a2产生a2次，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">rep(<span class="number">1</span>,<span class="number">10</span>)</div><div class="line"><span class="comment">##  [1] 1 1 1 1 1 1 1 1 1 1</span></div><div class="line">rep(<span class="number">1</span>:<span class="number">5</span>,each=<span class="number">2</span>, times=<span class="number">2</span>) <span class="comment">#重复1到5，每个元素重复二次，整个数列重复两次</span></div><div class="line"><span class="comment">##  [1] 1 1 2 2 3 3 4 4 5 5 1 1 2 2 3 3 4 4 5 5</span></div><div class="line">rep(<span class="number">1</span>:<span class="number">3</span>,<span class="number">1</span>:<span class="number">3</span>) <span class="comment"># 1重复1次，2重复2次，3重复3次</span></div><div class="line"><span class="comment">## [1] 1 2 2 3 3 3</span></div></pre></td></tr></table></figure>
<h2 id="向量索引"><a href="#向量索引" class="headerlink" title="向量索引"></a>向量索引</h2><p>取子向量：通过下标实现</p>
<p>取某个元素：x[2];(如果X包括名称，注意:x[2]与x[[2]]的区别；</p>
<p>取某中几个：x[c(1,2,0)]</p>
<p>取某个/几个元素，利用-：x[-n]</p>
<h2 id="向量排序"><a href="#向量排序" class="headerlink" title="向量排序"></a>向量排序</h2><p>sort(); 输出排序后的结果；order()；输出排序后的各个向量位置，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a&lt;-c(<span class="number">3</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">19</span>)</div><div class="line">sort(a)</div><div class="line"><span class="comment">## [1]  03  9 12 19</span></div><div class="line">order(a)</div><div class="line"><span class="comment">## [1] 3 1 2 4 5</span></div><div class="line">a&lt;-c(<span class="number">3</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">19</span>)</div></pre></td></tr></table></figure>
<h2 id="向量运算"><a href="#向量运算" class="headerlink" title="向量运算"></a>向量运算</h2><h3 id="相加"><a href="#相加" class="headerlink" title="相加"></a>相加</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; Demo_5 &lt;- <span class="number">1</span>:<span class="number">3</span>;Demo_5</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></div><div class="line">&gt; Demo_6 &lt;- <span class="number">2</span>:<span class="number">5</span>;Demo_6</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div><div class="line">&gt; Demo_7 &lt;- Demo_6+ Demo_5;Demo_7</div><div class="line">Warning message:</div><div class="line">In Demo_6 + Demo_5 :</div><div class="line">  longer object length is not a multiple of shorter object length</div><div class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span></div></pre></td></tr></table></figure>
<h2 id="向量：提取满足某一条件的向量"><a href="#向量：提取满足某一条件的向量" class="headerlink" title="向量：提取满足某一条件的向量"></a>向量：提取满足某一条件的向量</h2><p>常见用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">x[n] 第n个元素</div><div class="line">x[-n] 除了第n个元素的x</div><div class="line">x[<span class="number">1</span>:n] 前n个元素</div><div class="line">x[-(<span class="number">1</span>:n)] 第n+<span class="number">1</span>至最后的元素</div><div class="line">x[c(<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>) ] 指定元素</div><div class="line">x[<span class="string">"name"</span>] 名为<span class="string">"name"</span>的元素</div><div class="line">x[x &gt; <span class="number">3</span>] 所有大于<span class="number">3</span>的元素</div><div class="line">x[x &gt; <span class="number">3</span> &amp; x &lt; <span class="number">5</span>] 区间(<span class="number">3</span>,<span class="number">5</span>)的元素</div><div class="line">x[x %<span class="keyword">in</span>% c (<span class="string">"a"</span>,<span class="string">"and"</span>,<span class="string">"the"</span>)] 给定组中的元素</div></pre></td></tr></table></figure>
<p>具体案例使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">x&lt;-c(<span class="number">10</span>:<span class="number">1</span>);x</div><div class="line"><span class="comment">##  [1] 109  8  76  5  43  2  1</span></div><div class="line">x[x==<span class="number">3</span>]&lt;-<span class="number">25</span>;x <span class="comment">#将x中等于3的元素变为25</span></div><div class="line"><span class="comment">##  [1] 109  8  76  5  4 252  1</span></div><div class="line">x[x=<span class="number">1</span>]&lt;-<span class="number">12</span>;x <span class="comment">#将x的第1个元素数值变为12</span></div><div class="line"><span class="comment">##  [1] 129  8  76  5  4 252  1</span></div><div class="line">letters[<span class="number">1</span>:<span class="number">30</span>] <span class="comment"># 产生字母序列</span></div><div class="line"><span class="comment">##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q"</span></div><div class="line"><span class="comment">## [18] "r" "s" "t" "u" "v" "w" "x" "y" "z" NA  NA  NA  NA</span></div><div class="line">a &lt;- c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">3</span>);a</div><div class="line"><span class="comment">##  [1] 2 3 4 2 5 1 6 3 2 5 8 5 7 3</span></div><div class="line">which.max(a) <span class="comment"># 找出最大元素的下标</span></div><div class="line"><span class="comment">## [1] 11</span></div><div class="line">which.min(a) <span class="comment"># 找出大小的元素下标</span></div><div class="line"><span class="comment">## [1] 6</span></div><div class="line">a[which.max(a)] <span class="comment"># 找出最大的元素</span></div><div class="line"><span class="comment">## [1] 8</span></div><div class="line">which(a==<span class="number">2</span>) <span class="comment"># 等于2的元素的下标</span></div><div class="line"><span class="comment">## [1] 1 4 9</span></div><div class="line">a[which(a==<span class="number">2</span>)] <span class="comment"># 等于2的元素</span></div><div class="line"><span class="comment">## [1] 2 2 2</span></div><div class="line">which(a&gt;<span class="number">5</span>) <span class="comment"># 大于5的元素的下标</span></div><div class="line"><span class="comment">## [1]  7 11 13</span></div><div class="line">a[which(a&gt;<span class="number">5</span>)] <span class="comment"># 大于5的元素</span></div><div class="line"><span class="comment">## [1] 6 8 7</span></div></pre></td></tr></table></figure>
<p>再看一案例</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; data &lt;- <span class="number">1</span>:<span class="number">100</span></div><div class="line">&gt; data[data &gt; <span class="number">20</span>]</div><div class="line"><span class="comment"># 取data 中大于20 的对象出来</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">21</span>  <span class="number">22</span>  <span class="number">23</span>  <span class="number">24</span>  <span class="number">25</span>  <span class="number">26</span>  <span class="number">27</span>  <span class="number">28</span>  <span class="number">29</span>  <span class="number">30</span>  <span class="number">31</span>  <span class="number">32</span>  <span class="number">33</span>  <span class="number">34</span>  <span class="number">35</span>  <span class="number">36</span>  <span class="number">37</span>  <span class="number">38</span>  <span class="number">39</span>  <span class="number">40</span>  <span class="number">41</span>  <span class="number">42</span>  <span class="number">43</span>  <span class="number">44</span></div><div class="line">[<span class="number">25</span>]  <span class="number">45</span>  <span class="number">46</span>  <span class="number">47</span>  <span class="number">48</span>  <span class="number">49</span>  <span class="number">50</span>  <span class="number">51</span>  <span class="number">52</span>  <span class="number">53</span>  <span class="number">54</span>  <span class="number">55</span>  <span class="number">56</span>  <span class="number">57</span>  <span class="number">58</span>  <span class="number">59</span>  <span class="number">60</span>  <span class="number">61</span>  <span class="number">62</span>  <span class="number">63</span>  <span class="number">64</span>  <span class="number">65</span>  <span class="number">66</span>  <span class="number">67</span>  <span class="number">68</span></div><div class="line">[<span class="number">49</span>]  <span class="number">69</span>  <span class="number">70</span>  <span class="number">71</span>  <span class="number">72</span>  <span class="number">73</span>  <span class="number">74</span>  <span class="number">75</span>  <span class="number">76</span>  <span class="number">77</span>  <span class="number">78</span>  <span class="number">79</span>  <span class="number">80</span>  <span class="number">81</span>  <span class="number">82</span>  <span class="number">83</span>  <span class="number">84</span>  <span class="number">85</span>  <span class="number">86</span>  <span class="number">87</span>  <span class="number">88</span>  <span class="number">89</span>  <span class="number">90</span>  <span class="number">91</span>  <span class="number">92</span></div><div class="line">[<span class="number">73</span>]  <span class="number">93</span>  <span class="number">94</span>  <span class="number">95</span>  <span class="number">96</span>  <span class="number">97</span>  <span class="number">98</span>  <span class="number">99</span> <span class="number">100</span></div></pre></td></tr></table></figure>
<p>通过方括号中的data &gt; 20 ，实现了我们想要的效果，具体是如何实现的呢？ </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; data &gt; <span class="number">20</span></div><div class="line">  [<span class="number">1</span>] <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span></div><div class="line"> [<span class="number">17</span>] <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line"> [<span class="number">33</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line"> [<span class="number">49</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line"> [<span class="number">65</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line"> [<span class="number">81</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line"> [<span class="number">97</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p>data &gt; 20 是一个表示式，它的返回值是一个有TRUE和FALSE 构成的逻辑向量，最终只选取了TRUE对应的元素，所以data 中大于20的元素被选了出来。通过下标和逻辑值两种方式，可以满足我们绝大部分的需求，但是有时候，我们只是想知道符合条件的值对应的下标，这个时候which 函数就派上了用场，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; which(letters == <span class="string">"a"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div></pre></td></tr></table></figure>
<p><code>==</code>操作符用来判断字符串相等，which 函数返回对应的下标，letters 这个向量中，第一个元素就是字母a, 所以返回值为1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; letters</div><div class="line"> [<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span> <span class="string">"f"</span> <span class="string">"g"</span> <span class="string">"h"</span> <span class="string">"i"</span> <span class="string">"j"</span> <span class="string">"k"</span> <span class="string">"l"</span> <span class="string">"m"</span> <span class="string">"n"</span> <span class="string">"o"</span> <span class="string">"p"</span> <span class="string">"q"</span> <span class="string">"r"</span> <span class="string">"s"</span> <span class="string">"t"</span> <span class="string">"u"</span> <span class="string">"v"</span> <span class="string">"w"</span> <span class="string">"x"</span></div><div class="line">[<span class="number">25</span>] <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; which(letters %<span class="keyword">in</span>% c(<span class="string">"a"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p><code>%in%</code>操作符用来判断操作符左边的向量中的元素是否位于操作符右边的向量中，通过这种集合操作，可以方便的一次返回多个下标，使用subset函数也可以提取满足某一条件的向量元素，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">20</span>)</div><div class="line">&gt; x</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">20</span></div><div class="line">&gt; subset(x,x&gt;<span class="number">5</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">8</span> <span class="number">20</span></div></pre></td></tr></table></figure>
<h3 id="ifelse"><a href="#ifelse" class="headerlink" title="ifelse"></a>ifelse</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>);x</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></div><div class="line">&gt; ifelse(x != <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) <span class="comment">#若果x的值不等于1，输出1，否则输出0</span></div><div class="line">[<span class="number">1</span>] <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></div></pre></td></tr></table></figure>
<p>ifelse和<code>%in%</code>的联合使用，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(x %<span class="keyword">in</span>% <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) <span class="comment">#若x的值包含在1里面，输出1，否者输出0</span></div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></div><div class="line">&gt; ifelse(x %<span class="keyword">in</span>% <span class="number">1</span>, <span class="string">'yes'</span>, <span class="string">'no'</span>) <span class="comment">#若x的值包含在1里面，输出yes，否者输出no</span></div><div class="line">[<span class="number">1</span>] <span class="string">"yes"</span> <span class="string">"yes"</span> <span class="string">"yes"</span> <span class="string">"no"</span>  <span class="string">"no"</span>  <span class="string">"yes"</span> <span class="string">"yes"</span></div><div class="line">&gt; which(x %<span class="keyword">in</span>% <span class="number">1</span>) <span class="comment"># 输出x包含在1中值的位置</span></div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">6</span> <span class="number">7</span></div><div class="line">&gt; y &lt;- c(<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>)</div><div class="line">&gt; z &lt;- c(<span class="number">1</span>, <span class="number">4</span>)</div><div class="line">&gt; ifelse(y %<span class="keyword">in</span>% z, which(y==z), <span class="number">0</span> ) <span class="comment">##若y的值包含在z里面，输出y==z的位置，否者输出0</span></div><div class="line">[<span class="number">1</span>] <span class="number">0</span> <span class="number">4</span> <span class="number">0</span> <span class="number">4</span></div><div class="line">&gt; ifelse(y %<span class="keyword">in</span>% z, which(y==z), <span class="number">0</span> ) <span class="comment">##若y的值包含在z里面，输出y==z的位置，否者输出0，</span></div><div class="line">[<span class="number">1</span>] <span class="number">0</span> <span class="number">4</span> <span class="number">0</span> <span class="number">4</span></div><div class="line">&gt; <span class="comment">#此例中没有找到y==z的值， 输出为NA。</span></div><div class="line">&gt; ifelse(y %<span class="keyword">in</span>% z, <span class="number">1</span>, <span class="number">0</span> )</div><div class="line">[<span class="number">1</span>] <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="向量的比较"><a href="#向量的比较" class="headerlink" title="向量的比较"></a>向量的比较</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">x&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">y&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">z&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>);</div><div class="line">x;y;z</div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"><span class="comment">## [1] 1 2 4</span></div><div class="line">x==y;x==z;y==z <span class="comment">#分别比较x,y,z的各个元素</span></div><div class="line"><span class="comment">## [1] TRUE TRUE TRUE</span></div><div class="line"><span class="comment">## [1]  TRUETRUE FALSE</span></div><div class="line"><span class="comment">## [1]  TRUETRUE FALSE</span></div><div class="line">identical(x,y);identical(x,z);identical(z,y) <span class="comment">#比较x,y,z的整体</span></div><div class="line"><span class="comment">## [1] TRUE</span></div><div class="line"><span class="comment">## [1] FALSE</span></div><div class="line"><span class="comment">## [1] FALSE</span></div><div class="line">all.equal(x,y) <span class="comment">#比较数值型变量是否“近似相等”</span></div><div class="line"><span class="comment">## [1] TRUE</span></div></pre></td></tr></table></figure>
<h2 id="两组数据的集合运算"><a href="#两组数据的集合运算" class="headerlink" title="两组数据的集合运算"></a>两组数据的集合运算</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="comment">#首先对集合A,B,C赋值</span></div><div class="line">&gt; A&lt;-<span class="number">1</span>:<span class="number">10</span></div><div class="line">&gt; B&lt;-seq(<span class="number">5</span>,<span class="number">15</span>,<span class="number">2</span>)</div><div class="line">&gt; C&lt;-<span class="number">1</span>:<span class="number">5</span></div><div class="line">&gt; union(A,B)<span class="comment">#求A和B的并集</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">13</span> <span class="number">15</span></div><div class="line">&gt; intersect(A,B)  <span class="comment">#求A和B的交集</span></div><div class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">7</span> <span class="number">9</span></div><div class="line">&gt; setdiff(A,B) <span class="comment">#求A-B</span></div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">6</span>  <span class="number">8</span> <span class="number">10</span></div><div class="line">&gt; setdiff(B,A) <span class="comment">#求B-A</span></div><div class="line">[<span class="number">1</span>] <span class="number">11</span> <span class="number">13</span> <span class="number">15</span></div><div class="line">&gt; setequal(A,B) <span class="comment"># 检验集合A,B是否相同</span></div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; is.element(<span class="number">12</span>,C) <span class="comment">#检验元素12是否属于集合C</span></div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(C%<span class="keyword">in</span>%A) <span class="comment">#检验集合A是否包含C</span></div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; all(C%<span class="keyword">in</span>%B)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; match(C,B)</div><div class="line">[<span class="number">1</span>] <span class="literal">NA</span> <span class="literal">NA</span> <span class="literal">NA</span> <span class="literal">NA</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>从上面可以看到<code>%in%</code>这个操作符只返回逻辑向量TRUE 或者FALSE，而且返回值应该与<code>%in%</code>这个操作符前面的向量程度相等。也就是说它相当于遍历了C里面的一个个元素，判断它们是否在B中出现过，然后返回是或者否即可。而<code>match(C,B)</code>的结果就很不一样了，它的返回结果同样与前面的向量等长，但是它并非返回逻辑向量，而是遍历了C里面的一个个元素，判断它们是否在B中出现过，如果出现就返回在B中的索引号，如果没有出现，就返回NA。</p>
<h1 id="数据框"><a href="#数据框" class="headerlink" title="数据框"></a>数据框</h1><h2 id="数据框定义"><a href="#数据框定义" class="headerlink" title="数据框定义"></a>数据框定义</h2><p>一种矩阵形式的数据，但数据框中各列可以是不同类型的数据。数据框每列是一个变量，每行是一个观测。数据框可以看成是矩阵的推广，也可看作一种特殊的列表对象。</p>
<h2 id="数据框的创建"><a href="#数据框的创建" class="headerlink" title="数据框的创建"></a>数据框的创建</h2><h3 id="data-frame"><a href="#data-frame" class="headerlink" title="data.frame()"></a>data.frame()</h3><p>通过data.frame函数来创建数据框，该函数包含的主要参数为: data.frame(…, row.names = NULL, check.rows = FALSE, check.names = TRUE, stringsAsFactors = default.stringsAsFactors()) 如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rats &lt;- c(<span class="number">1</span>:<span class="number">6</span>)</div><div class="line">group &lt;- c(<span class="string">"postive"</span>,<span class="string">"postive"</span>,<span class="string">"model"</span>,<span class="string">"model"</span>,<span class="string">"control"</span>,<span class="string">"control"</span>)</div><div class="line">sex &lt;- c(<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>)</div><div class="line">glu.d1 &lt;- c(<span class="number">11.97</span>,<span class="number">12.97</span>,<span class="number">27.34</span>,<span class="number">23.97</span>,<span class="number">6.79</span>,<span class="number">5.19</span>)</div><div class="line">glu.d7 &lt;- c(<span class="number">12.97</span>,<span class="number">13.97</span>,<span class="number">25.56</span>,<span class="number">23.97</span>,<span class="number">5.79</span>,<span class="number">6.19</span>)</div><div class="line">rat.data &lt;- data.frame(rats,group,sex,glu.d1,glu.d7)</div><div class="line">rat.data</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data<br>  rats   group sex glu.d1 glu.d7<br>1    1 postive   F  11.97  12.97<br>2    2 postive   M  12.97  13.97<br>3    3   model   F  27.34  25.56<br>4    4   model   M  23.97  23.97<br>5    5 control   F   6.79   5.79<br>6    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="expand-grid"><a href="#expand-grid" class="headerlink" title="expand.grid()"></a>expand.grid()</h3><p>通过expand.grid()创建一个数据框，此函数可以创建元素所有可能的组合：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x&lt;-expand.grid(h=c(<span class="number">60</span>,<span class="number">80</span>),w=c(<span class="number">100</span>,<span class="number">300</span>),sex=c(<span class="string">"M"</span>,<span class="string">"F"</span>))</div><div class="line">x</div></pre></td></tr></table></figure>
<blockquote>
<p> x<br>   h   w sex<br>1 60 100   M<br>2 80 100   M<br>3 60 300   M<br>4 80 300   M<br>5 60 100   F<br>6 80 100   F<br>7 60 300   F<br>8 80 300   F</p>
</blockquote>
<h3 id="查看数据框信息"><a href="#查看数据框信息" class="headerlink" title="查看数据框信息"></a>查看数据框信息</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class(rat.data) <span class="comment"># 查看类型</span></div></pre></td></tr></table></figure>
<blockquote>
<p> class(rat.data) # 查看类型<br>[1] “data.frame”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class(rat.data$sex) # 查看某列的类型</div></pre></td></tr></table></figure>
<blockquote>
<p> class(rat.data$sex) # 查看某列的类型<br>[1] “factor”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">length(rat.data) # 查看数据框长度</div></pre></td></tr></table></figure>
<blockquote>
<p> length(rat.data) # 查看数据框长度<br>[1] 5</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names(rat.data) <span class="comment"># 数据框各项名称</span></div></pre></td></tr></table></figure>
<blockquote>
<p> names(rat.data) # 数据框各项名称<br>[1] “rats”   “group”  “sex”    “glu.d1” “glu.d7”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">summary(rat.data) </div><div class="line"># 数据框信息总结,对字符类/因子类数据，给出相应的频数统计；给数值型数据给出5个主要的指标</div></pre></td></tr></table></figure>
<blockquote>
<p> summary(rat.data)<br>      rats          group   sex       glu.d1           glu.d7<br> Min.   :1.00   control:2   F:3   Min.   : 5.190   Min.   : 5.790<br> 1st Qu.:2.25   model  :2   M:3   1st Qu.: 8.085   1st Qu.: 7.885<br> Median :3.50   postive:2         Median :12.470   Median :13.470<br> Mean   :3.50                     Mean   :14.705   Mean   :14.742<br> 3rd Qu.:4.75                     3rd Qu.:21.220   3rd Qu.:21.470<br> Max.   :6.00                     Max.   :27.340   Max.   :25.560 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">table(rat.data$group,rat.data$sex) </div><div class="line"><span class="comment"># 将数据框中的group与sex关联为一个表</span></div></pre></td></tr></table></figure>
<blockquote>
<p> table(rat.data$group,rat.data$sex)<br>   F M<br>  control 1 1<br>  model   1 1<br>  postive 1 1</p>
</blockquote>
<h2 id="数据框的去重"><a href="#数据框的去重" class="headerlink" title="数据框的去重"></a>数据框的去重</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data2 &lt;- rbind(rat.data,rat.data) <span class="comment"># 创建一个新数据框rat.data2，内容是rat.data的2倍</span></div><div class="line">unique(rat.data2) <span class="comment"># 对数据框进行去重，即提取不重复的元素</span></div></pre></td></tr></table></figure>
<blockquote>
<p> unique(rat.data2) # 对数据框进行去重，即提取不重复的元素<br>  rats   group sex glu.d1 glu.d7<br>1    1 postive   F  11.97  12.97<br>2    2 postive   M  12.97  13.97<br>3    3   model   F  27.34  25.56<br>4    4   model   M  23.97  23.97<br>5    5 control   F   6.79   5.79<br>6    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="去重函数unique"><a href="#去重函数unique" class="headerlink" title="去重函数unique()"></a>去重函数unique()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unique(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)) <span class="comment"># 对向量c(1,1,2,2,3,4)提取不重复的元素</span></div></pre></td></tr></table></figure>
<blockquote>
<p> unique(c(1,1,2,2,3,4)) # 对向量c(1,1,2,2,3,4)提取不重复的元素<br>[1] 1 2 3 4</p>
</blockquote>
<h3 id="取重复的行"><a href="#取重复的行" class="headerlink" title="取重复的行"></a>取重复的行</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data2[duplicated(rat.data2),]<span class="comment"># 取数据框中重复的行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data2[duplicated(rat.data2),]# 取数据框中重复的行<br>   rats   group sex glu.d1 glu.d7<br>7     1 postive   F  11.97  12.97<br>8     2 postive   M  12.97  13.97<br>9     3   model   F  27.34  25.56<br>10    4   model   M  23.97  23.97<br>11    5 control   F   6.79   5.79<br>12    6 control   M   5.19   6.19</p>
</blockquote>
<h2 id="提取取数据框元素"><a href="#提取取数据框元素" class="headerlink" title="提取取数据框元素"></a>提取取数据框元素</h2><h3 id="提取某个元素"><a href="#提取某个元素" class="headerlink" title="提取某个元素"></a>提取某个元素</h3><p>rat.data[i,j]指第i行第j列的数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[<span class="number">1</span>,<span class="number">2</span>] <span class="comment">#取第1行第2列</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1,2] #取第1行第2列<br>[1] postive<br>Levels: control model postive</p>
</blockquote>
<h3 id="提取某行"><a href="#提取某行" class="headerlink" title="提取某行"></a>提取某行</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data[<span class="number">2</span>,] <span class="comment">#取第2行</span></div><div class="line">rat.data[c(<span class="number">1</span>,<span class="number">4</span>),] <span class="comment">#取1，4行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[2,] #取第2行<br>  rats   group sex glu.d1 glu.d7<br>2    2 postive   M  12.97  13.97</p>
<p> rat.data[c(1,4),] #取1，4行<br>  rats   group sex glu.d1 glu.d7<br>1    1 postive   F  11.97  12.97<br>4    4   model   M  23.97  23.97</p>
</blockquote>
<h3 id="提取某列——用列号提取"><a href="#提取某列——用列号提取" class="headerlink" title="提取某列——用列号提取"></a>提取某列——用列号提取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[,3] #取第3列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[,3] #取第3列<br>[1] F M F M F M<br>Levels: F M</p>
</blockquote>
<h3 id="提取某列——用列名称提取"><a href="#提取某列——用列名称提取" class="headerlink" title="提取某列——用列名称提取"></a>提取某列——用列名称提取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data$rats #取rat.data数据框中的rats列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data$rats #取rat.data数据框中的rats列<br>[1] 1 2 3 4 5 6</p>
</blockquote>
<h3 id="提取除掉某列的其余列"><a href="#提取除掉某列的其余列" class="headerlink" title="提取除掉某列的其余列"></a>提取除掉某列的其余列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[,-3] #取除了第3列外的其余列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[,-3] #取除了第3列外的其余列<br>  rats   group glu.d1 glu.d7<br>1    1 postive  11.97  12.97<br>2    2 postive  12.97  13.97<br>3    3   model  27.34  25.56<br>4    4   model  23.97  23.97<br>5    5 control   6.79   5.79<br>6    6 control   5.19   6.19</p>
</blockquote>
<h3 id="取1到4行中的第4列"><a href="#取1到4行中的第4列" class="headerlink" title="取1到4行中的第4列"></a>取1到4行中的第4列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1:4,4]</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1:4,4]<br>[1] 11.97 12.97 27.34 23.97</p>
</blockquote>
<h3 id="取1到4行中的第3列"><a href="#取1到4行中的第3列" class="headerlink" title="取1到4行中的第3列"></a>取1到4行中的第3列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1:4,3]</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1:4,3]<br>[1] F M F M<br>Levels: F M</p>
</blockquote>
<h3 id="取第1行，2到4列"><a href="#取第1行，2到4列" class="headerlink" title="取第1行，2到4列"></a>取第1行，2到4列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1,2:4] #取第1行，2到4列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1,2:4] #取第1行，2到4列<br>    group sex glu.d1<br>1 postive   F  11.97</p>
</blockquote>
<h3 id="提取满足某一条件的列"><a href="#提取满足某一条件的列" class="headerlink" title="提取满足某一条件的列"></a>提取满足某一条件的列</h3><p>提取rat.data中所有control级别的观察值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Sel &lt;- rat.data$group == &quot;control&quot;</div><div class="line">rat.data.control &lt;- rat.data[Sel,]</div><div class="line">rat.data.control</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data.control<br>  rats   group sex glu.d1 glu.d7<br>5    5 control   F   6.79   5.79<br>6    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="提取子集案例二"><a href="#提取子集案例二" class="headerlink" title="提取子集案例二"></a>提取子集案例二</h3><p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&gt; manager&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; date&lt;-c(<span class="string">"10/24/08"</span>,<span class="string">"10/28/08"</span>,<span class="string">"10/01/08"</span>,<span class="string">"10/12/08"</span>,<span class="string">"05/01/09"</span>)</div><div class="line">&gt; country&lt;-c(<span class="string">"US"</span>,<span class="string">"US"</span>,<span class="string">"UK"</span>,<span class="string">"China"</span>,<span class="string">"UK"</span>)</div><div class="line">&gt; gender&lt;-c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; age&lt;-c(<span class="number">32</span>,<span class="number">45</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">99</span>)</div><div class="line">&gt; q1&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">&gt; q2&lt;-c(<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; q3&lt;-c(<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>)</div><div class="line">&gt; q4&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>,<span class="number">2</span>)</div><div class="line">&gt; q5&lt;-c(<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>)</div><div class="line">&gt; leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactors=<span class="literal">FALSE</span>)</div><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div><div class="line">&gt; newdata &lt;- leadership[, c(<span class="number">6</span>:<span class="number">10</span>)] <span class="comment">#从leadership数据框中取第6行到第10行的变量，并且将其保存在newdata中，将行下标留空(,），表示取所有行</span></div><div class="line">&gt; newdata</div><div class="line">  q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>再看一案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div><div class="line">&gt; newdata&lt;- leadership[which(leadership$gender == <span class="string">"M"</span> &amp; leadership$age&gt;<span class="number">30</span>),] <span class="comment"># 将leaderhip中30岁以上的男性选入newdata中</span></div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="将某一数值转换为某一类别变量"><a href="#将某一数值转换为某一类别变量" class="headerlink" title="将某一数值转换为某一类别变量"></a>将某一数值转换为某一类别变量</h3><h4 id="创建数据框"><a href="#创建数据框" class="headerlink" title="创建数据框"></a>创建数据框</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">manager&lt;-c(1,2,3,4,5)</div><div class="line">date&lt;-c(&quot;10/24/08&quot;,&quot;10/28/08&quot;,&quot;10/1/08&quot;,&quot;10/12/08&quot;,&quot;5/1/09&quot;)</div><div class="line">country&lt;-c(&quot;US&quot;,&quot;US&quot;,&quot;UK&quot;,&quot;UK&quot;,&quot;UK&quot;)</div><div class="line">gender&lt;-c(&quot;M&quot;,&quot;F&quot;,&quot;F&quot;,&quot;M&quot;,&quot;F&quot;)</div><div class="line">age&lt;-c(32,45,25,39,99)</div><div class="line">q1&lt;-c(5,3,3,3,2)</div><div class="line">q2&lt;-c(4,5,5,3,2)</div><div class="line">q3&lt;-c(5,2,5,4,1)</div><div class="line">q4&lt;-c(5,5,5,NA,2)</div><div class="line">q5&lt;-c(5,5,2,NA,1)</div><div class="line">leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactor=FALSE)</div><div class="line">#把字符转化为因子</div><div class="line">leadership</div></pre></td></tr></table></figure>
<blockquote>
<p> leadership<br>  manager     date country gender age q1 q2 q3 q4 q5 stringsAsFactor<br>1       1 10/24/08      US      M  32  5  4  5  5  5           FALSE<br>2       2 10/28/08      US      F  45  3  5  2  5  5           FALSE<br>3       3  10/1/08      UK      F  25  3  5  5  5  2           FALSE<br>4       4 10/12/08      UK      M  39  3  3  4 NA NA           FALSE<br>5       5   5/1/09      UK      F  99  2  2  1  2  1           FALSE</p>
</blockquote>
<h4 id="转变变量-可转化为因子型变量"><a href="#转变变量-可转化为因子型变量" class="headerlink" title="转变变量(可转化为因子型变量)"></a>转变变量(可转化为因子型变量)</h4><p>要求：将大于99的转换为缺失，age大于75的为Elder，55到75之间的为Middle，55以下的为Young：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">leadership$age[leadership$age == <span class="number">99</span>] &lt;-<span class="literal">NA</span> <span class="comment"># 年龄为99时，表示缺失</span></div><div class="line">leadership$agecat[leadership$age &gt;<span class="number">75</span>] &lt;- <span class="string">"Elder"</span> <span class="comment"># 当age大于75时，agecat为Elder</span></div><div class="line">leadership$agecat[leadership$age &gt;= <span class="number">55</span> &amp; leadership$age&lt;= <span class="number">75</span>] &lt;- <span class="string">"Middle"</span> <span class="comment"># 当55&lt;= age &lt;=75时，agecat为Middle</span></div><div class="line">leadership$agecat[leadership$age &lt; <span class="number">55</span>] &lt;-<span class="string">"Young"</span> <span class="comment">#age&lt;55时，agecat为Young</span></div><div class="line">leadership</div></pre></td></tr></table></figure>
<blockquote>
<p> leadership<br>  manager     date country gender age q1 q2 q3 q4 q5 stringsAsFactor agecat<br>1       1 10/24/08      US      M  32  5  4  5  5  5           FALSE  Young<br>2       2 10/28/08      US      F  45  3  5  2  5  5           FALSE  Young<br>3       3  10/1/08      UK      F  25  3  5  5  5  2           FALSE  Young<br>4       4 10/12/08      UK      M  39  3  3  4 NA NA           FALSE  Young<br>5       5   5/1/09      UK      F  NA  2  2  1  2  1           FALSE   <na></na></p>
</blockquote>
<h2 id="判断数据框各行是否完整"><a href="#判断数据框各行是否完整" class="headerlink" title="判断数据框各行是否完整"></a>判断数据框各行是否完整</h2><p>所用函数为complete.cases</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rat.data</div><div class="line">rat.data1$group[<span class="number">2</span>]&lt;-<span class="literal">NA</span></div><div class="line">complete.cases(rat.data1) <span class="comment">#判断数据框是否完整</span></div></pre></td></tr></table></figure>
<blockquote>
<p> complete.cases(rat.data1) #判断数据框是否完整<br>[1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE</p>
</blockquote>
<h2 id="提取非缺失值"><a href="#提取非缺失值" class="headerlink" title="提取非缺失值"></a>提取非缺失值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data1[complete.cases(rat.data1),] #选择非缺失值的数据</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1[complete.cases(rat.data1),] #选择非缺失值的数据<br>  rats   group sex glu.d1 glu.d7<br>1    1 postive   F  11.97  12.97<br>3    3   model   F  27.34  25.56<br>4    4   model   M  23.97  23.97<br>5    5 control   F   6.79   5.79<br>6    6 control   M   5.19   6.19</p>
</blockquote>
<h2 id="增加列"><a href="#增加列" class="headerlink" title="增加列"></a>增加列</h2><h3 id="直接添加"><a href="#直接添加" class="headerlink" title="直接添加"></a>直接添加</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data$result&lt;-c(rat.data$glu.d1-rat.data$glu.d7)</div><div class="line">rat.data</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data<br>  rats   group sex glu.d1 glu.d7 result<br>1    1 postive   F  11.97  12.97  -1.00<br>2    2 postive   M  12.97  13.97  -1.00<br>3    3   model   F  27.34  25.56   1.78<br>4    4   model   M  23.97  23.97   0.00<br>5    5 control   F   6.79   5.79   1.00<br>6    6 control   M   5.19   6.19  -1.00</p>
</blockquote>
<h3 id="cbind添加"><a href="#cbind添加" class="headerlink" title="cbind添加"></a>cbind添加</h3><p>格式为data.frame1 &lt;- cbind(data.fram1,新的变量（可以由公式得到）)，例如下面的例子就是在rat.data1添加一个result变量，result的变量是由rat.data1中的glu.d1减去glu.d7得到的。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-cbind(rat.data1, result=c(rat.data1$glu.d1-rat.data1$glu.d7))</div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-cbind(rat.data1, result=c(rat.data1$glu.d1-rat.data1$glu.d7))<br> rat.data1<br>  rats   group sex glu.d1 glu.d7 result<br>1    1 postive   F  11.97  12.97  -1.00<br>2    2    <na>   M  12.97  13.97  -1.00<br>3    3   model   F  27.34  25.56   1.78<br>4    4   model   M  23.97  23.97   0.00<br>5    5 control   F   6.79   5.79   1.00<br>6    6 control   M   5.19   6.19  -1.00</na></p>
</blockquote>
<p>另外的方法为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1$result &lt;- rat.data1$glu.d1-rat.data1$glu.d7</div><div class="line"><span class="comment"># 或</span></div><div class="line">rat.data1 &lt;- transform(rat.data1,result=glu.d1-glu.d7)</div></pre></td></tr></table></figure>
<h3 id="merge-添加"><a href="#merge-添加" class="headerlink" title="merge()添加"></a>merge()添加</h3><p>用法为<code>total &lt;- merge(dataframeA, dataframeB, by = &quot;ID&quot;)</code>，它表示，将dataframeA与dataframeB按照ID进行合并，这种联结通常是横向的，即向数据框中添加变量。 </p>
<h2 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h2><h3 id="使用NULL"><a href="#使用NULL" class="headerlink" title="使用NULL"></a>使用NULL</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1</div><div class="line">rat.data1$result&lt;-<span class="literal">NULL</span> <span class="comment"># 删除result这一列，原数列有2列result</span></div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1<br>  rats   group sex glu.d1 glu.d7 result<br>1    1 postive   F  11.97  12.97  -1.00<br>2    2    <na>   M  12.97  13.97  -1.00<br>3    3   model   F  27.34  25.56   1.78<br>4    4   model   M  23.97  23.97   0.00<br>5    5 control   F   6.79   5.79   1.00<br>6    6 control   M   5.19   6.19  -1.00</na></p>
<p> rat.data1$result&lt;-NULL # 删除result这一列</p>
<p> rat.data1<br>  rats   group sex glu.d1 glu.d7<br>1    1 postive   F  11.97  12.97<br>2    2    <na>   M  12.97  13.97<br>3    3   model   F  27.34  25.56<br>4    4   model   M  23.97  23.97<br>5    5 control   F   6.79   5.79<br>6    6 control   M   5.19   6.19</na></p>
</blockquote>
<h3 id="用subset"><a href="#用subset" class="headerlink" title="用subset()"></a>用subset()</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-subset(rat.data1,select=c(-sex,-group)) <span class="comment">#删除sex,group列</span></div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-subset(rat.data1,select=c(-sex,-group)) #删除sex,group列<br> rat.data1<br>  rats glu.d1 glu.d7<br>1    1  11.97  12.97<br>2    2  12.97  13.97<br>3    3  27.34  25.56<br>4    4  23.97  23.97<br>5    5   6.79   5.79<br>6    6   5.19   6.19</p>
</blockquote>
<p>使用<code>%in%</code>，如下所示：</p>
<p>先生成一个数据框，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; manager&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; date&lt;-c(<span class="string">"10/24/08"</span>,<span class="string">"10/28/08"</span>,<span class="string">"10/01/08"</span>,<span class="string">"10/12/08"</span>,<span class="string">"05/01/09"</span>)</div><div class="line">&gt; country&lt;-c(<span class="string">"US"</span>,<span class="string">"US"</span>,<span class="string">"UK"</span>,<span class="string">"China"</span>,<span class="string">"UK"</span>)</div><div class="line">&gt; gender&lt;-c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; age&lt;-c(<span class="number">32</span>,<span class="number">45</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">99</span>)</div><div class="line">&gt; q1&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">&gt; q2&lt;-c(<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; q3&lt;-c(<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>)</div><div class="line">&gt; q4&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>,<span class="number">2</span>)</div><div class="line">&gt; q5&lt;-c(<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>)</div><div class="line">&gt; leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactors=<span class="literal">FALSE</span>)</div><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>现在删除q3与q4，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; myvars &lt;-names(leadership)%<span class="keyword">in</span>%c(<span class="string">"q3"</span>,<span class="string">"q4"</span>)</div><div class="line">&gt; newdata&lt;-leadership[!myvars]</div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>names(leadership)生成了一个包含所有变量名的字符型微量，即<code>c(&quot;manager&quot;,&quot;date&quot;,&quot;country&quot;，&quot;gender&quot;，&quot;age&quot;，&quot;q1&quot;，&quot;q2&quot;，&quot;q3&quot;,&quot;q4&quot;,&quot;q5&quot;,&quot;stringsAsFactor&quot;)</code>，<code>names(leadership)%in%c(&quot;item3&quot;,&quot;item4&quot;)</code>返回了一个逻辑型向量，<code>names(leadership)``中每个匹配item3或item4的元素值为TRUE，反之为</code>FALSE，c(FALSE, FALSE, FALSE, FALSE,FALSE, FALSE, FALSE, TRUE, TRUE, FALSE)<code>，运算符非（!）将逻辑值反转：</code>c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE,FALSE, TRUE)<code>,</code>leadership[c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE,TRUE)]`选择了逻辑值为TRUE的列，于是q3和q4被剔除了。</p>
<p>或者直接使用<code>-</code>号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; newdata &lt;- leadership[c(-<span class="number">8</span>,-<span class="number">9</span>) ] <span class="comment">#直接在变量前加减号</span></div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<h2 id="增加行"><a href="#增加行" class="headerlink" title="增加行"></a>增加行</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rbind(rat.data1,rat.data1)</div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-rbind(rat.data1,rat.data1)<br> rat.data1<br>   rats glu.d1 glu.d7<br>1     1  11.97  12.97<br>2     2  12.97  13.97<br>3     3  27.34  25.56<br>4     4  23.97  23.97<br>5     5   6.79   5.79<br>6     6   5.19   6.19<br>7     1  11.97  12.97<br>8     2  12.97  13.97<br>9     3  27.34  25.56<br>10    4  23.97  23.97<br>11    5   6.79   5.79<br>12    6   5.19   6.19</p>
</blockquote>
<h2 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rat.data1[-<span class="number">8</span>,] <span class="comment">#删除第8行</span></div><div class="line">rat.data1[-c(<span class="number">1</span>,<span class="number">2</span>),] <span class="comment">#删除1，2行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-rat.data1[-8,] #删除第8行<br> rat.data1[-c(1,2),] #删除1，2行<br>   rats glu.d1 glu.d7<br>3     3  27.34  25.56<br>4     4  23.97  23.97<br>5     5   6.79   5.79<br>6     6   5.19   6.19<br>7     1  11.97  12.97<br>9     3  27.34  25.56<br>10    4  23.97  23.97<br>11    5   6.79   5.79<br>12    6   5.19   6.19</p>
</blockquote>
<h2 id="数据框的排序"><a href="#数据框的排序" class="headerlink" title="数据框的排序"></a>数据框的排序</h2><h3 id="基于单列进行排序"><a href="#基于单列进行排序" class="headerlink" title="基于单列进行排序"></a>基于单列进行排序</h3><p>排序所用的函数为sort()和order(),sort()是对元素直接进行排序，而order()则是反回排序后的元素在原来列中的位置，现在以内置的CO2数据为例说明，只取CO2的前10行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- CO2[<span class="number">1</span>:<span class="number">10</span>,]</div><div class="line">raw_data</div><div class="line">sort(raw_data$uptake) <span class="comment">#对uptake进行排序，默认为升序</span></div><div class="line">sort(raw_data$uptake,decreasing = <span class="literal">TRUE</span>) <span class="comment"># decreasing为T时，为降序</span></div><div class="line">order.raw_data &lt;- order(raw_data$uptake);order.raw_data</div><div class="line"><span class="comment"># order的结果是说，在排序后的数据中，第1个元素位于原来的第8个位置</span></div><div class="line"><span class="comment"># 排序后的第1个数据是13.6，而13.6在原来uptake中位于第8</span></div><div class="line">raw_data$uptake[order.raw_data] <span class="comment">#这个结果与sort(raw_data$uptake)是一样的</span></div><div class="line">raw_data[order.raw_data,] <span class="comment">#按照uptake的升序对数据框进行排序</span></div></pre></td></tr></table></figure>
<blockquote>
<p> raw_data &lt;- CO2[1:10,]<br> raw_data<br>   Plant   Type  Treatment conc uptake<br>1    Qn1 Quebec nonchilled   95   16.0<br>2    Qn1 Quebec nonchilled  175   30.4<br>3    Qn1 Quebec nonchilled  250   34.8<br>4    Qn1 Quebec nonchilled  350   37.2<br>5    Qn1 Quebec nonchilled  500   35.3<br>6    Qn1 Quebec nonchilled  675   39.2<br>7    Qn1 Quebec nonchilled 1000   39.7<br>8    Qn2 Quebec nonchilled   95   13.6<br>9    Qn2 Quebec nonchilled  175   27.3<br>10   Qn2 Quebec nonchilled  250   37.1<br> sort(raw_data$uptake) #对uptake进行排序，默认为升序<br> [1] 13.6 16.0 27.3 30.4 34.8 35.3 37.1 37.2 39.2 39.7<br> sort(raw_data$uptake,decreasing = TRUE) # decreasing为T时，为降序<br> [1] 39.7 39.2 37.2 37.1 35.3 34.8 30.4 27.3 16.0 13.6<br> order.raw_data &lt;- order(raw_data$uptake);order.raw_data<br> [1]  8  1  9  2  3  5 10  4  6  7</p>
<p>   order的结果是说，在排序后的数据中，第1个元素位于原来的第8个位置</p>
<p>   排序后的第1个数据是13.6，而13.6在原来uptake中位于第8</p>
<p> raw_data$uptake[order.raw_data] #这个结果与sort(raw_data$uptake)是一样的<br> [1] 13.6 16.0 27.3 30.4 34.8 35.3 37.1 37.2 39.2 39.7<br> raw_data[order.raw_data,] #按照uptake的升序对数据框进行排序<br>   Plant   Type  Treatment conc uptake<br>8    Qn2 Quebec nonchilled   95   13.6<br>1    Qn1 Quebec nonchilled   95   16.0<br>9    Qn2 Quebec nonchilled  175   27.3<br>2    Qn1 Quebec nonchilled  175   30.4<br>3    Qn1 Quebec nonchilled  250   34.8<br>5    Qn1 Quebec nonchilled  500   35.3<br>10   Qn2 Quebec nonchilled  250   37.1<br>4    Qn1 Quebec nonchilled  350   37.2<br>6    Qn1 Quebec nonchilled  675   39.2<br>7    Qn1 Quebec nonchilled 1000   39.7</p>
</blockquote>
<h3 id="基于多列的排序"><a href="#基于多列的排序" class="headerlink" title="基于多列的排序"></a>基于多列的排序</h3><p>还以前述的数据为例说明：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">order.raw_data2 &lt;- with(raw_data,order(conc,uptake))</div><div class="line">raw_data[order.raw_data2,]</div><div class="line"></div><div class="line">order.raw_data3 &lt;- with(raw_data,order(uptake,conc))</div><div class="line">raw_data[order.raw_data3,]</div></pre></td></tr></table></figure>
<blockquote>
<p> order.raw_data2 &lt;- with(raw_data,order(conc,uptake))<br> raw_data[order.raw_data2,]<br>   Plant   Type  Treatment conc uptake<br>8    Qn2 Quebec nonchilled   95   13.6<br>1    Qn1 Quebec nonchilled   95   16.0<br>9    Qn2 Quebec nonchilled  175   27.3<br>2    Qn1 Quebec nonchilled  175   30.4<br>3    Qn1 Quebec nonchilled  250   34.8<br>10   Qn2 Quebec nonchilled  250   37.1<br>4    Qn1 Quebec nonchilled  350   37.2<br>5    Qn1 Quebec nonchilled  500   35.3<br>6    Qn1 Quebec nonchilled  675   39.2<br>7    Qn1 Quebec nonchilled 1000   39.7</p>
<p> order.raw_data3 &lt;- with(raw_data,order(uptake,conc))<br> raw_data[order.raw_data3,]<br>   Plant   Type  Treatment conc uptake<br>8    Qn2 Quebec nonchilled   95   13.6<br>1    Qn1 Quebec nonchilled   95   16.0<br>9    Qn2 Quebec nonchilled  175   27.3<br>2    Qn1 Quebec nonchilled  175   30.4<br>3    Qn1 Quebec nonchilled  250   34.8<br>5    Qn1 Quebec nonchilled  500   35.3<br>10   Qn2 Quebec nonchilled  250   37.1<br>4    Qn1 Quebec nonchilled  350   37.2<br>6    Qn1 Quebec nonchilled  675   39.2<br>7    Qn1 Quebec nonchilled 1000   39.7</p>
</blockquote>
<p>可以看出来，在第1种排序中， with(raw_data,order(conc,uptake))，先以order进行排序，如果order相同，则按照uptake进行排序；在第2种排序中，with(raw_data,order(uptake,conc))，先以uptake进行排序，如果uptake相同，则按conc进行排序。</p>
<h3 id="混合排序"><a href="#混合排序" class="headerlink" title="混合排序"></a>混合排序</h3><p>混合排序是指某一列是升序，某一列为降序，所用到的函数是xtfrm()，其中在需要降序的列前加上铅，在升序的列前加正号，现在以raw_data数据为例说明，以conc的降序，uptake的升序进行排序，用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">order.raw_data4 &lt;- order(-xtfrm(raw_data$conc),+raw_data$uptake)</div><div class="line">raw_data[order.raw_data4,]</div></pre></td></tr></table></figure>
<blockquote>
<p> order.raw_data4 &lt;- order(-xtfrm(raw_data$conc),+raw_data$uptake)<br> raw_data[order.raw_data4,]<br>   Plant   Type  Treatment conc uptake<br>7    Qn1 Quebec nonchilled 1000   39.7<br>6    Qn1 Quebec nonchilled  675   39.2<br>5    Qn1 Quebec nonchilled  500   35.3<br>4    Qn1 Quebec nonchilled  350   37.2<br>3    Qn1 Quebec nonchilled  250   34.8<br>10   Qn2 Quebec nonchilled  250   37.1<br>9    Qn2 Quebec nonchilled  175   27.3<br>2    Qn1 Quebec nonchilled  175   30.4<br>8    Qn2 Quebec nonchilled   95   13.6<br>1    Qn1 Quebec nonchilled   95   16.0</p>
</blockquote>
<h1 id="因子"><a href="#因子" class="headerlink" title="因子"></a>因子</h1><h2 id="因子定义"><a href="#因子定义" class="headerlink" title="因子定义"></a>因子定义</h2><p>因子(factor)：是名义型变量或有序型变量，比较特殊。一个因子不仅包括分类变量本身还包括变量不同的可能水平（即使它们在数据中不出现）。 </p>
<h2 id="factor-用法"><a href="#factor-用法" class="headerlink" title="factor()用法"></a>factor()用法</h2><p><code>factor (x,levels=sort(unique(x),na.last=TRUE), labels=lebels, exclude=NA, ordered=is.order (x))</code></p>
<p>其中，levels用于指定因子的可能水平，labels用于定义水平的名字；exclude指从向量x中剔除的水平值，ordered指因子的水平是否要排序，例如: </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a &lt;- factor(<span class="number">1</span>:<span class="number">3</span>)</div><div class="line">a</div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"><span class="comment">## Levels: 1 2 3</span></div></pre></td></tr></table></figure>
<p>从上面的结果可以看出，这组数据中有3个数据，3个水平，分别为1，2，3。还有一种情况是，水平数大于实际的数据数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">b&lt;-factor(<span class="number">1</span>:<span class="number">3</span>,levels=<span class="number">1</span>:<span class="number">5</span>);b</div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"><span class="comment">## Levels: 1 2 3 4 5</span></div></pre></td></tr></table></figure>
<p>这组数据中有3个数据，有5个水平（其中两个水平没出现）。</p>
<h2 id="factor数据的名称"><a href="#factor数据的名称" class="headerlink" title="factor数据的名称"></a>factor数据的名称</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">c&lt;-factor(<span class="number">1</span>:<span class="number">3</span>,labels=c(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>))</div><div class="line">c</div><div class="line"><span class="comment">## [1] a b c</span></div><div class="line"><span class="comment">## Levels: a b </span></div><div class="line">&gt; str(c)</div><div class="line"> Factor w/ <span class="number">3</span> levels <span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>: <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></div></pre></td></tr></table></figure>
<p>c有三个水平，名字分别为a,b,c </p>
<h2 id="将factor转化为其它类型"><a href="#将factor转化为其它类型" class="headerlink" title="将factor转化为其它类型"></a>将factor转化为其它类型</h2><h3 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">d&lt;-c(<span class="number">1</span>,<span class="number">10</span>) <span class="comment">#建立向量a,值为1,10</span></div><div class="line">d</div><div class="line"><span class="comment">## [1]  1 10</span></div><div class="line">fac&lt;-factor(d)</div><div class="line">fac <span class="comment">#提取向量a的因子数，并赋给fac</span></div><div class="line"><span class="comment">## [1] 1  10</span></div><div class="line"><span class="comment">## Levels: 1 10</span></div><div class="line">fac_value&lt;-as.numeric(fac) <span class="comment">#将fac转化为数值</span></div><div class="line">fac</div><div class="line"><span class="comment">## [1] 1  10</span></div><div class="line"><span class="comment">## Levels: 1 10</span></div></pre></td></tr></table></figure>
<h3 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">e&lt;-c(<span class="string">"Male"</span>,<span class="string">"Female"</span>)</div><div class="line">e  <span class="comment">#建立向量e，为字符型</span></div><div class="line"><span class="comment">## [1] "Male"   "Female"</span></div><div class="line">fac_e&lt;-factor(e);fac_e <span class="comment">#提取向量b的因子，并且赋给fac2</span></div><div class="line"><span class="comment">## [1] Male   Female</span></div><div class="line"><span class="comment">## Levels: Female Male</span></div><div class="line">fac_e_value&lt;-as.numeric(fac_e)<span class="comment">#将fac_e转化为数值型</span></div><div class="line">fac_e_value</div><div class="line"><span class="comment">## [1] 2 1</span></div></pre></td></tr></table></figure>
<h3 id="将factor转换为数值"><a href="#将factor转换为数值" class="headerlink" title="将factor转换为数值"></a>将factor转换为数值</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">as.numeric(as.character(fac))</div><div class="line"><span class="comment">## [1]  1 10</span></div></pre></td></tr></table></figure>
<p>上述命令将fac(1,10)先转化为字符型，接着将字符型转化为数值型，如果直接将factor转换为numeric，容易出错，一般情况下就是先看factor转换为character，再转换为numeric。</p>
<h2 id="将其它数据转换为factor"><a href="#将其它数据转换为factor" class="headerlink" title="将其它数据转换为factor"></a>将其它数据转换为factor</h2><h3 id="将字符转换为因子"><a href="#将字符转换为因子" class="headerlink" title="将字符转换为因子"></a>将字符转换为因子</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a &lt;- c(<span class="string">"green"</span>,<span class="string">"blue"</span>,<span class="string">"green"</span>,<span class="string">"yellow"</span>)</div><div class="line">a &lt;- factor(a)</div><div class="line">levels(a) &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">ff &lt;- factor(c(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,labels=c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)))</div><div class="line">ff</div><div class="line"></div><div class="line"><span class="comment">##                         labels1 labels2 labels3 </span></div><div class="line"><span class="comment">##       A       BC       1       23 </span></div><div class="line"><span class="comment">## Levels: 1 2 3 A B C</span></div></pre></td></tr></table></figure>
<h3 id="将数值转换为因子"><a href="#将数值转换为因子" class="headerlink" title="将数值转换为因子"></a>将数值转换为因子</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">b &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>)</div><div class="line">b &lt;- factor(b)</div><div class="line">b</div><div class="line"></div><div class="line"><span class="comment">## [1] 1 2 3 1</span></div><div class="line"><span class="comment">## Levels: 1 2 3</span></div></pre></td></tr></table></figure>
<h3 id="提取可能的factor"><a href="#提取可能的factor" class="headerlink" title="提取可能的factor"></a>提取可能的factor</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ff &lt;- factor(c(<span class="number">2</span>,<span class="number">4</span>),levels=<span class="number">2</span>:<span class="number">5</span>)</div><div class="line">ff</div><div class="line"></div><div class="line"><span class="comment">## [1] 2 4</span></div><div class="line"><span class="comment">## Levels: 2 3 4 5</span></div><div class="line"></div><div class="line">levels(ff)</div><div class="line"></div><div class="line"><span class="comment">## [1] "2" "3" "4" "5"</span></div></pre></td></tr></table></figure>
<h3 id="将连续型数据转换factor"><a href="#将连续型数据转换factor" class="headerlink" title="将连续型数据转换factor"></a>将连续型数据转换factor</h3><p>以<code>PlantGrowth</code>数据集为例说明，先看一下这个数据集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pg &lt;- PlantGrowth[c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">21</span>,<span class="number">22</span>),]</div><div class="line">pg</div><div class="line"><span class="comment"># weight group</span></div><div class="line"><span class="comment"># 1    4.17  ctrl</span></div><div class="line"><span class="comment"># 2    5.58  ctrl</span></div><div class="line"><span class="comment"># 11   4.81  trt1</span></div><div class="line"><span class="comment"># 21   6.31  trt2</span></div><div class="line"><span class="comment"># 22   5.12  trt2</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们使用<code>cut()</code>函数把一个连续型变量<code>weight</code>转化为分类变量<code>wtclass</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pg$wtclass &lt;- cut(pg$weight,breaks=c(<span class="number">0</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="literal">Inf</span>))</div><div class="line">pg</div><div class="line"><span class="comment"># weight group wtclass</span></div><div class="line"><span class="comment"># 1    4.17  ctrl   (0,5]</span></div><div class="line"><span class="comment"># 2    5.58  ctrl   (5,6]</span></div><div class="line"><span class="comment"># 11   4.81  trt1   (0,5]</span></div><div class="line"><span class="comment"># 21   6.31  trt2 (6,Inf]</span></div><div class="line"><span class="comment"># 22   5.12  trt2   (5,6]</span></div></pre></td></tr></table></figure>
<p>我们为三个类设定了四个边界值，边界值可以包括正无穷(Inf)和负无穷(-Inf)，如果一个值落在我们规定的区间外，它的类别将被设定为NA（缺失值），<code>cut()</code>函数的结果是一个因素，并且因子水平的名称是以生成的区间命名的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; str(pg)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">5</span> obs. of  <span class="number">3</span> variables:</div><div class="line"> $ weight : num  <span class="number">4.17</span> <span class="number">5.58</span> <span class="number">4.81</span> <span class="number">6.31</span> <span class="number">5.12</span></div><div class="line"> $ group  : Factor w/ <span class="number">3</span> levels <span class="string">"ctrl"</span>,<span class="string">"trt1"</span>,..: <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">3</span></div><div class="line"> $ wtclass: Factor w/ <span class="number">3</span> levels <span class="string">"(0,5]"</span>,<span class="string">"(5,6]"</span>,..: <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">3</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>但是这个区间名称明显不太方便，我们可以更改一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">pg$wtclass &lt;-cut(pg$weight,breaks=c(<span class="number">0</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="literal">Inf</span>),</div><div class="line">                labels=c(<span class="string">"Small"</span>,<span class="string">"Medium"</span>,<span class="string">"Large"</span>))</div><div class="line"><span class="comment"># &gt; pg</span></div><div class="line"><span class="comment"># weight group wtclass</span></div><div class="line"><span class="comment"># 1    4.17  ctrl   Small</span></div><div class="line"><span class="comment"># 2    5.58  ctrl  Medium</span></div><div class="line"><span class="comment"># 11   4.81  trt1   Small</span></div><div class="line"><span class="comment"># 21   6.31  trt2   Large</span></div><div class="line"><span class="comment"># 22   5.12  trt2  Medium</span></div></pre></td></tr></table></figure>
<p><code>cut()</code>函数生成的区间是左开右闭的，换句话说，它们不会包含最小值，但是它们包含了最大值，对于值最小的一类，可以通常设置参数<code>include.lowest=TRUE</code>来实现，这样它们就能同时包含最小值和最大值了，如果要让生成的区间是左闭右开的，需要设定参数<code>right=FALSE</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pg$wtclass &lt;- cut(pg$weight,breaks=c(<span class="number">0</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="literal">Inf</span>),right=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>如果要更改不同因子的名称，例如将Small改为A，Medium改为B，Large改为C，那么就需要car中的recode函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">head(pg)</div><div class="line"><span class="comment"># weight group wtclass</span></div><div class="line"><span class="comment"># 1    4.17  ctrl   Small</span></div><div class="line"><span class="comment"># 2    5.58  ctrl  Medium</span></div><div class="line"><span class="comment"># 11   4.81  trt1   Small</span></div><div class="line"><span class="comment"># 21   6.31  trt2   Large</span></div><div class="line"><span class="comment"># 22   5.12  trt2  Medium</span></div><div class="line"><span class="keyword">library</span>(car)</div><div class="line">pg$wtclass &lt;- recode(pg$wtclass,<span class="string">"'Small'='A';'Medium'='B';'Large'='C'"</span>)</div><div class="line">head(pg)</div><div class="line"><span class="comment"># weight group wtclass</span></div><div class="line"><span class="comment"># 1    4.17  ctrl       A</span></div><div class="line"><span class="comment"># 2    5.58  ctrl       B</span></div><div class="line"><span class="comment"># 11   4.81  trt1       A</span></div><div class="line"><span class="comment"># 21   6.31  trt2       C</span></div><div class="line"><span class="comment"># 22   5.12  trt2       B</span></div></pre></td></tr></table></figure>
<h3 id="生成指定的factor"><a href="#生成指定的factor" class="headerlink" title="生成指定的factor"></a>生成指定的factor</h3><h4 id="seq-1"><a href="#seq-1" class="headerlink" title="seq()"></a>seq()</h4><p>在R的向量笔记中，提到了seq()函数用来生成某一条件的向量，这个函数在生成特定因子方面也有很重要的作用，用法为<code>seq(length=, from=, to=)</code>，其中，length:指定生成个数，from:是指开始生成的点，to:截止点。如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">seq(length=<span class="number">10</span>,from=<span class="number">10</span>,to=<span class="number">100</span>) <span class="comment"># 生成从10到100的向量，一共10个</span></div><div class="line"><span class="comment">##  [1]10  20  3040  50  6070  80  90 100</span></div><div class="line"><span class="comment"># 上述命令等价于</span></div><div class="line"></div><div class="line">seq(<span class="number">10</span>,<span class="number">100</span>,<span class="number">10</span>)</div><div class="line"><span class="comment">##  [1]10  20  3040  50  6070  80  90 100</span></div><div class="line"></div><div class="line">seq(<span class="number">1</span>,<span class="number">10</span>,by=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1] 1 3 5 7 9</span></div><div class="line"></div><div class="line">seq(<span class="number">1</span>,<span class="number">10</span>,length=<span class="number">6</span>)</div><div class="line"><span class="comment">## [1]  1.02.8  4.6  6.48.2 10.0</span></div><div class="line"></div><div class="line">sequence(<span class="number">2</span>:<span class="number">3</span>) <span class="comment">#产生以 2 和 3 结尾的序列数据</span></div><div class="line"><span class="comment">## [1] 1 2 1 2 3</span></div></pre></td></tr></table></figure>
<h4 id="rep-1"><a href="#rep-1" class="headerlink" title="rep()"></a>rep()</h4><p>用法：<code>rep(P，N)</code>，表示重复生成P值N次，例如rep(a1:a2,a1:a2) #重复a1到a2，按a1产生a1次，按a2产生a2次，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">rep(<span class="number">1</span>,<span class="number">10</span>)</div><div class="line"><span class="comment">##  [1] 1 1 1 1 1 1 1 1 1 1</span></div><div class="line"></div><div class="line">rep(<span class="number">1</span>:<span class="number">5</span>,each=<span class="number">2</span>, times=<span class="number">2</span>) <span class="comment">#重复1到5，每个元素重复二次，整个数列重复两次</span></div><div class="line"><span class="comment">##  [1] 1 1 2 2 3 3 4 4 5 5 1 1 2 2 3 3 4 4 5 5</span></div><div class="line"></div><div class="line">rep(<span class="number">1</span>:<span class="number">3</span>,<span class="number">1</span>:<span class="number">3</span>) <span class="comment"># 1重复1次，2重复2次，3重复3次</span></div><div class="line"><span class="comment">## [1] 1 2 2 3 3 3</span></div></pre></td></tr></table></figure>
<h4 id="gl函数"><a href="#gl函数" class="headerlink" title="gl函数"></a>gl函数</h4><p>生成规则的因子序列，gl(k,n)：k为水平数据，n是每个水平重复的次数。如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">gl(<span class="number">3</span>,<span class="number">5</span>) <span class="comment">#生成5个1，5个2，5个3，</span></div><div class="line"></div><div class="line"><span class="comment">##  [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3</span></div><div class="line"><span class="comment">## Levels: 1 2 3</span></div><div class="line"></div><div class="line">gl(<span class="number">3</span>,<span class="number">5</span>,length=<span class="number">30</span>) <span class="comment">#生成5个1，5个2，5个3，循环到30个，即：</span></div><div class="line"></div><div class="line"><span class="comment">##  [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3</span></div><div class="line"><span class="comment">## Levels: 1 2 3</span></div><div class="line"></div><div class="line">gl(<span class="number">2</span>,<span class="number">6</span>,label=c(<span class="string">"Male"</span>,<span class="string">"Female"</span>)) <span class="comment">#生成Male与Female两个因子，各6个，共12个数据：</span></div><div class="line"></div><div class="line"><span class="comment">##  [1] MaleMale   Male   MaleMale   Male   Female Female Female Female</span></div><div class="line"><span class="comment">## [11] Female Female</span></div><div class="line"><span class="comment">## Levels: Male Female</span></div></pre></td></tr></table></figure>
<h2 id="有序因子"><a href="#有序因子" class="headerlink" title="有序因子"></a>有序因子</h2><p>因子没有顺序，但也可以人为指定顺序。例如糖尿病类型Diabetes(Type1,Type2)，就是2种类型没有顺序，但病人状态status(Poor,Imporved,Excellent)是有顺序的。案例如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">patientID&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">age&lt;-c(<span class="number">25</span>,<span class="number">34</span>,<span class="number">28</span>,<span class="number">52</span>)</div><div class="line">diabetes&lt;-c(<span class="string">"Type1"</span>,<span class="string">"Type2"</span>,<span class="string">"Type1"</span>,<span class="string">"Type1"</span>)</div><div class="line">status&lt;-c(<span class="string">"Poor"</span>,<span class="string">"Improved"</span>,<span class="string">"Excellent"</span>,<span class="string">"Poor"</span>)</div><div class="line">diabetes&lt;-factor(diabetes) <span class="comment">#提取不同糖尿病类型的因子</span></div><div class="line">status&lt;-factor(status,order=<span class="literal">TRUE</span>) <span class="comment"># 提取因子，并且有序</span></div><div class="line">patientdata&lt;-data.frame(patientID,age,diabetes,status)</div><div class="line">patientdata</div><div class="line"></div><div class="line"><span class="comment">##   patientID age diabetes    status</span></div><div class="line"><span class="comment">## 11  25    Type1Poor</span></div><div class="line"><span class="comment">## 22  34    Type2Improved</span></div><div class="line"><span class="comment">## 33  28    Type1 Excellent</span></div><div class="line"><span class="comment">## 44  52    Type1Poor</span></div></pre></td></tr></table></figure>
<p> 注：字符型向量的因子水平默认依字母顺序创建。但在实际情况中并不常用，而是通过levels选项来指定因子顺序，使用factor(status, order = TRUE, levels = c(“Poor”, “Improved”, “Excellent”))，各个水平的赋值就为1 = Poor, 2 = Improved, 3 = Excellent。或者是通过下面代码实现：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">factor(status, ordered = <span class="literal">TRUE</span>, levels = c(<span class="string">"Poor"</span>, <span class="string">"Improved"</span>, <span class="string">"Excellent"</span>))</div><div class="line"></div><div class="line"><span class="comment">## [1] Poor      ImprovedExcellent Poor     </span></div><div class="line"><span class="comment">## Levels: Poor &lt; Improved &lt; Excellent</span></div><div class="line"></div><div class="line">str(patientdata)<span class="comment">#显示数据框的结构</span></div><div class="line"></div><div class="line"><span class="comment">## 'data.frame':    4 obs. of  4 variables:</span></div><div class="line"><span class="comment">##  $ patientID: num  1 2 3 4</span></div><div class="line"><span class="comment">##  $ age      : num25 34 28 52</span></div><div class="line"><span class="comment">##  $ diabetes : Factor w/ 2 levels "Type1","Type2": 1 2 1 1</span></div><div class="line"><span class="comment">##  $ status   : Ord.factor w/ 3 levels "Excellent"&lt;"Improved"&lt;..: 3 2 1 3</span></div><div class="line"></div><div class="line">summary(patientdata)</div><div class="line"></div><div class="line"><span class="comment">##    patientID         age         diabetes       status </span></div><div class="line"><span class="comment">##  Min.   :1.00Min.   :25.00   Type1:3Excellent:1  </span></div><div class="line"><span class="comment">##  1st Qu.:1.75   1st Qu.:27.25   Type2:1Improved :1  </span></div><div class="line"><span class="comment">##  Median :2.50   Median :31.00             Poor     :2  </span></div><div class="line"><span class="comment">##  Mean   :2.50Mean   :34.75                          </span></div><div class="line"><span class="comment">##  3rd Qu.:3.25   3rd Qu.:38.50                          </span></div><div class="line"><span class="comment">##  Max.   :4.00Max.   :52.00</span></div></pre></td></tr></table></figure>
<h2 id="factor的统计"><a href="#factor的统计" class="headerlink" title="factor的统计"></a>factor的统计</h2><p>如果一组数据有多个重复值，例如美国的每一个州都位于4个区域的中某一个，分别为东北，南、中北和西，则我们看一下内置的state数据集： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">head(state.region)</div><div class="line"></div><div class="line"><span class="comment">## [1] South West  West  South WestWest </span></div><div class="line"><span class="comment">## Levels: Northeast South North Central West</span></div><div class="line"></div><div class="line">table(state.region)</div><div class="line"></div><div class="line"><span class="comment">## state.region</span></div><div class="line"><span class="comment">##Northeast         South North Central          West </span></div><div class="line"><span class="comment">##9            16            12            13</span></div></pre></td></tr></table></figure>
<h1 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h1><h2 id="什么是列表"><a href="#什么是列表" class="headerlink" title="什么是列表"></a>什么是列表</h2><p>列表(list)为最复杂的数据类型，是一些对象或成分的有序集合，例如可以是向量，矩阵，数据框，或其他列表的组合。用<code>list()</code>创建：<code>mylist&lt;-list(object1,object2,...)</code>， 或命名列表：<code>mylist&lt;-list(name1=object1,name2=object2,...)</code>。</p>
<h2 id="创建列表"><a href="#创建列表" class="headerlink" title="创建列表"></a>创建列表</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"> g&lt;-<span class="string">"My First List"</span></div><div class="line">h&lt;-c(<span class="number">25</span>,<span class="number">26</span>,<span class="number">18</span>,<span class="number">39</span>)</div><div class="line">j&lt;-matrix(<span class="number">1</span>:<span class="number">10</span>,nrow=<span class="number">5</span>)</div><div class="line">k&lt;-c(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>)</div><div class="line">mylist&lt;-list(title=g,ages=h,j,k)</div><div class="line">mylist <span class="comment">#输出列表</span></div><div class="line"></div><div class="line"><span class="comment">## $title</span></div><div class="line"><span class="comment">## [1] "My First List"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[3]]</span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    6</span></div><div class="line"><span class="comment">## [2,]2    7</span></div><div class="line"><span class="comment">## [3,]3    8</span></div><div class="line"><span class="comment">## [4,]4    9</span></div><div class="line"><span class="comment">## [5,]5   10</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[4]]</span></div><div class="line"><span class="comment">## [1] "one"   "two"   "three"</span></div></pre></td></tr></table></figure>
<h3 id="显示列表数据"><a href="#显示列表数据" class="headerlink" title="显示列表数据"></a>显示列表数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mylist[<span class="number">1</span>]</div><div class="line"><span class="comment">## $title</span></div><div class="line"><span class="comment">## [1] "My First List"</span></div><div class="line"></div><div class="line">mylist[<span class="number">2</span>]</div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"></div><div class="line">mylist[[<span class="number">2</span>]]</div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"></div><div class="line">mylist[<span class="string">"ages"</span>]</div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div></pre></td></tr></table></figure>
<h1 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h1><h2 id="矩阵定义"><a href="#矩阵定义" class="headerlink" title="矩阵定义"></a>矩阵定义</h2><p>矩阵是一个二维数组，只是每个元素都拥有相同的模式（数值型、字符型或逻辑型）。可通过函数<code>matrix()</code>创建矩阵。一般使用格式为： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">myymatrix &lt;- matrix(vector, nrow=number_of_rows, ncol=number_of_columns, </div><div class="line">                    byrow=logical_value, dimnames=list(  </div><div class="line">                      char_vector_rownames, char_vector_colnames))</div></pre></td></tr></table></figure>
<p>其中vector包含了矩阵的元素，nrow和ncol用以指定行和列的维数，dimnames包含了可选的、以字符型向量表示的行名和列名。选项 byrow 则表明矩阵应当按行填充（ byrow=TRUE ）还是按列填充（ byrow=FALSE ），默认情况下按列填充。</p>
<h2 id="创建矩阵"><a href="#创建矩阵" class="headerlink" title="创建矩阵"></a>创建矩阵</h2><h3 id="matrix"><a href="#matrix" class="headerlink" title="matrix()"></a>matrix()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; a&lt;-matrix(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>),nrow=<span class="number">2</span>,byrow=<span class="literal">T</span>)</div><div class="line">&gt; a</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">4</span>    <span class="number">5</span>    <span class="number">6</span></div></pre></td></tr></table></figure>
<h3 id="dim"><a href="#dim" class="headerlink" title="dim()"></a>dim()</h3><p>通过dim来创建，先生成向量x，接着给向量x适当的维数，此例子中给向量的维数为5行，3列： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">15</span></div><div class="line">&gt; x <span class="comment"># 建立x</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span></div><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">15</span></div><div class="line">&gt; x <span class="comment"># 建立x</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span></div><div class="line">&gt; dim(x) <span class="comment">#查看x的维度</span></div><div class="line"><span class="literal">NULL</span></div><div class="line">&gt; dim(x) &lt;- c(<span class="number">5</span>,<span class="number">3</span>) <span class="comment"># 将向量x转化为5行3列的矩阵</span></div><div class="line">&gt; x</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">6</span>   <span class="number">11</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">7</span>   <span class="number">12</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">8</span>   <span class="number">13</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">4</span>    <span class="number">9</span>   <span class="number">14</span></div><div class="line">[<span class="number">5</span>,]    <span class="number">5</span>   <span class="number">10</span>   <span class="number">15</span></div></pre></td></tr></table></figure>
<h3 id="矩阵命名"><a href="#矩阵命名" class="headerlink" title="矩阵命名"></a>矩阵命名</h3><p>用法：Dimnames(Row_name,Col_name)，给定行和列的名称,如果不需要给行或者列命名，则以NULL代替。例如：给下面的矩阵列命令：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>);a</div><div class="line"><span class="comment">## [1] 1 2 3 4 5 6</span></div><div class="line"></div><div class="line">a&lt;-matrix(a,nrow=<span class="number">2</span>,byrow=<span class="literal">T</span>,dimnames=list(c(<span class="string">'a'</span>,<span class="string">'b'</span>),c(<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>)));a</div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div></pre></td></tr></table></figure>
<p>用rownames与colnames实现</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">b&lt;-c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>) <span class="comment"># 建立向量b</span></div><div class="line">b</div><div class="line"><span class="comment">## [1] 2 3 4 5 6 7</span></div><div class="line"></div><div class="line">b&lt;-matrix(b,nrow=<span class="number">2</span>) <span class="comment"># 将向量b转化为矩阵</span></div><div class="line">b</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    4    6</span></div><div class="line"><span class="comment">## [2,]3    5    7</span></div><div class="line"></div><div class="line">rownames(b)&lt;-c(<span class="string">"row_1"</span>,<span class="string">"row_2"</span>) <span class="comment"># 将矩阵行命名</span></div><div class="line">colnames(b)&lt;-c(<span class="string">"col_1"</span>,<span class="string">"col_2"</span>,<span class="string">"col_3"</span>) <span class="comment"># 将矩阵的列命名</span></div><div class="line">b</div><div class="line"><span class="comment">##       col_1 col_2 col_3</span></div><div class="line"><span class="comment">## row_12     4     6</span></div><div class="line"><span class="comment">## row_23     5     7</span></div></pre></td></tr></table></figure>
<h2 id="查看矩阵"><a href="#查看矩阵" class="headerlink" title="查看矩阵"></a>查看矩阵</h2><h3 id="查看矩阵的列-行相关信息"><a href="#查看矩阵的列-行相关信息" class="headerlink" title="查看矩阵的列/行相关信息"></a>查看矩阵的列/行相关信息</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">colnames(a) <span class="comment"># 查看矩阵列名</span></div><div class="line"><span class="comment">## [1] "A" "B" "C"</span></div><div class="line"></div><div class="line">rownames(a) <span class="comment"># 查看矩阵行名</span></div><div class="line"><span class="comment">## [1] "a" "b"</span></div></pre></td></tr></table></figure>
<h3 id="查看矩阵的维度"><a href="#查看矩阵的维度" class="headerlink" title="查看矩阵的维度"></a>查看矩阵的维度</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dim(a) <span class="comment"># 返回行与列数</span></div><div class="line"><span class="comment">## [1] 2 3</span></div><div class="line"></div><div class="line">nrow(a) <span class="comment"># 返回行数</span></div><div class="line"><span class="comment">## [1] 2</span></div><div class="line"></div><div class="line">ncol(a) <span class="comment"># 返回列数</span></div><div class="line"><span class="comment">## [1] 3</span></div></pre></td></tr></table></figure>
<h2 id="条件提取子矩阵"><a href="#条件提取子矩阵" class="headerlink" title="条件提取子矩阵"></a>条件提取子矩阵</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">a <span class="comment"># 查看矩阵a</span></div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">a[<span class="number">2</span>,<span class="number">3</span>] <span class="comment">#取矩阵a的第2列，第3个元素</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 6</span></div><div class="line"></div><div class="line"> a[,<span class="number">1</span>] <span class="comment">#取矩阵a的第1列</span></div><div class="line"></div><div class="line"><span class="comment">## a b </span></div><div class="line"><span class="comment">## 1 4</span></div><div class="line"></div><div class="line">a[<span class="number">1</span>,] <span class="comment"># 取矩阵a的第1行</span></div><div class="line"></div><div class="line"><span class="comment">## A B C </span></div><div class="line"><span class="comment">## 1 2 3</span></div><div class="line"></div><div class="line">c&lt;-a[a[,<span class="number">2</span>]&gt;<span class="number">4</span>] <span class="comment"># 取矩阵a第2行并且大于4的元素，并将其赋值给c</span></div><div class="line">c</div><div class="line"></div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line"></div><div class="line">x&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>)</div><div class="line">x&lt;-matrix(x,nrow=<span class="number">3</span>)</div><div class="line">x</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    4    7</span></div><div class="line"><span class="comment">## [2,]2    5    8</span></div><div class="line"><span class="comment">## [3,]3    6    8</span></div><div class="line"></div><div class="line">x[,<span class="number">3</span>] <span class="comment"># 选取矩阵的第3列</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 7 8 8</span></div><div class="line"></div><div class="line">x[<span class="number">3</span>,] <span class="comment"># 选取矩阵的第3行</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3 6 8</span></div><div class="line"></div><div class="line">y&lt;-x[,<span class="number">3</span>,drop=<span class="literal">FALSE</span>] <span class="comment"># 选取x矩阵的第3列，并返回一个矩阵给y</span></div><div class="line">y</div><div class="line"></div><div class="line"><span class="comment">##      [,1]</span></div><div class="line"><span class="comment">## [1,]    7</span></div><div class="line"><span class="comment">## [2,]    8</span></div><div class="line"><span class="comment">## [3,]    8</span></div><div class="line"></div><div class="line">x[,-<span class="number">1</span>] <span class="comment"># 不显示矩阵的第1列</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]4    7</span></div><div class="line"><span class="comment">## [2,]5    8</span></div><div class="line"><span class="comment">## [3,]6    8</span></div><div class="line"></div><div class="line">x[-<span class="number">1</span>,] <span class="comment"># 不显示矩阵的第1行</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    5    8</span></div><div class="line"><span class="comment">## [2,]3    6    8</span></div><div class="line"></div><div class="line">x[,-(<span class="number">1</span>:<span class="number">2</span>)] <span class="comment"># 不显示矩阵的第1，2列</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 7 8 8</span></div><div class="line"></div><div class="line">z&lt;-x[,-(<span class="number">1</span>:<span class="number">2</span>),drop=<span class="literal">FALSE</span>] <span class="comment">#不显示矩阵x的第1，2列，并且返回为一矩阵y</span></div><div class="line">z</div><div class="line"></div><div class="line"><span class="comment">##      [,1]</span></div><div class="line"><span class="comment">## [1,]    7</span></div><div class="line"><span class="comment">## [2,]    8</span></div><div class="line"><span class="comment">## [3,]    8</span></div></pre></td></tr></table></figure>
<h2 id="提取矩阵的行或列"><a href="#提取矩阵的行或列" class="headerlink" title="提取矩阵的行或列"></a>提取矩阵的行或列</h2><p><code>nrow</code>与<code>ncol</code>函数： nrow与ncol函数返回行或列的某一个数字。NCOL与NROW用于向量，即把向量作为单行的矩阵处理。 用法： nrow(x) ncol(x) NCOL(x) NROW(x) 参数： x：向量，或数据框； 值：长度为1或无的整数： 类似的有dim函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">ma &lt;- matrix(<span class="number">1</span>:<span class="number">12</span>, <span class="number">3</span>, <span class="number">4</span>);ma <span class="comment"># 建矩阵3行4列的矩阵</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1    4    710</span></div><div class="line"><span class="comment">## [2,]2    5    811</span></div><div class="line"><span class="comment">## [3,]3    6    912</span></div><div class="line"></div><div class="line">nrow(ma)   <span class="comment"># 行数为3</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3</span></div><div class="line"></div><div class="line">ncol(ma)   <span class="comment"># 列数为4</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 4</span></div><div class="line"></div><div class="line">y &lt;-array(<span class="number">1</span>:<span class="number">24</span>, dim = <span class="number">2</span>:<span class="number">4</span>);y <span class="comment"># 建2行4列的数组</span></div><div class="line"></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    3    5</span></div><div class="line"><span class="comment">## [2,]2    4    6</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]7    9   11</span></div><div class="line"><span class="comment">## [2,]8   10   12</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]13   15   17</span></div><div class="line"><span class="comment">## [2,]14   16   18</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]19   21   23</span></div><div class="line"><span class="comment">## [2,]20   22   24</span></div><div class="line"></div><div class="line">ncol(y)</div><div class="line"></div><div class="line"><span class="comment">## [1] 3</span></div><div class="line"></div><div class="line">NCOL(<span class="number">1</span>:<span class="number">12</span>) <span class="comment"># NCOL把数组作为单行的矩阵处理</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 1</span></div><div class="line"></div><div class="line">NROW(<span class="number">1</span>:<span class="number">12</span>) <span class="comment"># 12</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 12</span></div></pre></td></tr></table></figure>
<h2 id="矩阵的运算"><a href="#矩阵的运算" class="headerlink" title="矩阵的运算"></a>矩阵的运算</h2><h3 id="矩阵相乘"><a href="#矩阵相乘" class="headerlink" title="矩阵相乘%*%"></a>矩阵相乘%*%</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">d &lt;- c(<span class="number">1</span>:<span class="number">6</span>)</div><div class="line">d &lt;- matrix(d,nrow=<span class="number">3</span>)</div><div class="line">d</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    4</span></div><div class="line"><span class="comment">## [2,]2    5</span></div><div class="line"><span class="comment">## [3,]3    6</span></div><div class="line"></div><div class="line">e&lt;-a%*%d</div><div class="line">e</div><div class="line"></div><div class="line"><span class="comment">##   [,1] [,2]</span></div><div class="line"><span class="comment">## a   14   32</span></div><div class="line"><span class="comment">## b   32   77</span></div></pre></td></tr></table></figure>
<p>只有当矩阵a的列数与矩阵b的行数相等时a×b才有意义。一个m×n的矩阵a（m,n)左乘一个n×p的矩阵b（n,p)，会得到一个m×p的矩阵c（m,p)，满足矩阵乘法满足结合律，但不满足交换律。 运算的法则： 矩阵a的第1行的3个元素(1,2,3)分别与矩阵b第1列的3个元素(1,2,3)相乘，其和为结果为e[1,1]，即e[1,1]=1×1+2×2+3×3=14； 矩阵a的第1行的3个元素(1,2,3)分别与矩阵b第2列的3个元素(4,5,6)相乘1×4+2×5+3×6=32，得到e[1,2]； 矩阵a的第2行的3个元素(4,5,6)分别与矩阵b第1列的3个元素(1,2,3)相乘4×1+5×2+6×3=32，得到e[2,1]； 矩阵a的第2行的3个元素(4,5,6)分别与矩阵b第2列的3个元素(4,5,6)相乘4×4+5×5+6×6=77，得到e[2,2]. </p>
<h3 id="矩阵合并"><a href="#矩阵合并" class="headerlink" title="矩阵合并"></a>矩阵合并</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">m1&lt;-matrix(<span class="number">1</span>,nrow=<span class="number">2</span>,ncol=<span class="number">2</span>)</div><div class="line">m1 <span class="comment"># 建立矩阵m1,2行2列，值为1</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    1</span></div><div class="line"><span class="comment">## [2,]1    1</span></div><div class="line"></div><div class="line">m2&lt;-matrix(<span class="number">2</span>,nrow=<span class="number">2</span>,ncol=<span class="number">2</span>)</div><div class="line">m2 <span class="comment"># 建立矩阵m2,2行2列，值为2</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]2    2</span></div><div class="line"><span class="comment">## [2,]2    2</span></div><div class="line"></div><div class="line">m_rbind&lt;-rbind(m1,m2);m_rbind <span class="comment"># 对两个矩阵m1,m2进行行合并，即上下合并</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    1</span></div><div class="line"><span class="comment">## [2,]1    1</span></div><div class="line"><span class="comment">## [3,]2    2</span></div><div class="line"><span class="comment">## [4,]2    2</span></div><div class="line"></div><div class="line">m_cbind&lt;-cbind(m1,m2);m_cbind <span class="comment">#对两个矩阵m1,m2进行列合并，即左右合并</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1    1    22</span></div><div class="line"><span class="comment">## [2,]1    1    22</span></div></pre></td></tr></table></figure>
<h3 id="星号"><a href="#星号" class="headerlink" title="星号"></a>星号</h3><p>把两个矩阵中每个对应的元素相乘，例子中a与b拥有相同的维度 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">b</div><div class="line"></div><div class="line"><span class="comment">##       col_1 col_2 col_3</span></div><div class="line"><span class="comment">## row_12     4     6</span></div><div class="line"><span class="comment">## row_23     5     7</span></div><div class="line"></div><div class="line">result&lt;-a*b <span class="comment">#将矩阵a与矩阵b相乘，并将其结果给result</span></div><div class="line">result</div><div class="line"></div><div class="line"><span class="comment">##    AB  C</span></div><div class="line"><span class="comment">## a  2  8 18</span></div><div class="line"><span class="comment">## b 12 25 42</span></div></pre></td></tr></table></figure>
<p>如果维度不同，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line">c</div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line">a*c <span class="comment"># a矩阵中的每一列与c的每一行相乘，循环c</span></div><div class="line"><span class="comment">##    AB  C</span></div><div class="line"><span class="comment">## a  4 12 15</span></div><div class="line"><span class="comment">## b 20 20 36</span></div></pre></td></tr></table></figure>
<h3 id="增加行与列"><a href="#增加行与列" class="headerlink" title="增加行与列"></a>增加行与列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">f&lt;-matrix(,<span class="number">4</span>,<span class="number">2</span>) <span class="comment"># 建立4行2列的空矩阵f</span></div><div class="line">f</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]NA   NA</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]NA   NA</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">f[c(<span class="number">1</span>,<span class="number">3</span>),]&lt;-matrix(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)) <span class="comment">#取f的1行与3行，将向量(1,2,3,4)填充进去，默认按列填充</span></div><div class="line">f</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">g&lt;-matrix(,<span class="number">4</span>,<span class="number">2</span>)</div><div class="line">g</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]NA   NA</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]NA   NA</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">g[c(<span class="number">1</span>,<span class="number">3</span>),]&lt;-matrix(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>),byrow=<span class="literal">FALSE</span>) <span class="comment"># byrow=FALSE则按行填充</span></div><div class="line">g</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div></pre></td></tr></table></figure>
<h3 id="矩阵转置"><a href="#矩阵转置" class="headerlink" title="矩阵转置"></a>矩阵转置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">f</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">h&lt;-t(f)</div><div class="line">h</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1   NA    2NA</span></div><div class="line"><span class="comment">## [2,]3   NA    4NA</span></div></pre></td></tr></table></figure>
<h3 id="取对角元素"><a href="#取对角元素" class="headerlink" title="取对角元素"></a>取对角元素</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">j&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)</div><div class="line">j <span class="comment"># 建立向量j</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 1 2 3 4 5 6 7 8 9</span></div><div class="line"></div><div class="line">j&lt;-matrix(j,nrow=<span class="number">3</span>)</div><div class="line">j <span class="comment">#建立3行3列矩阵</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    4    7</span></div><div class="line"><span class="comment">## [2,]2    5    8</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">j_diag&lt;-diag(j) <span class="comment">#取对角</span></div><div class="line">j_diag</div><div class="line"></div><div class="line"><span class="comment">## [1] 1 5 9</span></div></pre></td></tr></table></figure>
<h3 id="求各行与列的总和与均值"><a href="#求各行与列的总和与均值" class="headerlink" title="求各行与列的总和与均值"></a>求各行与列的总和与均值</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">j</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    4    7</span></div><div class="line"><span class="comment">## [2,]2    5    8</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">rowSums(j) <span class="comment"># 求各行的总和</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 12 15 18</span></div><div class="line"></div><div class="line">rowMeans(j) <span class="comment"># 求行的均值</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line"></div><div class="line">colSums(j) <span class="comment">#求各列的总和</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  6 15 24</span></div><div class="line"></div><div class="line">colMeans(j) <span class="comment">#求各列的均值</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 2 5 8</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的特征值与特征向量"><a href="#矩阵的特征值与特征向量" class="headerlink" title="矩阵的特征值与特征向量"></a>矩阵的特征值与特征向量</h3><p>矩阵A的谱分解为<code>A=UΛU</code>，其中Λ是由A的特征值组成的对角矩阵，U的列为A的特征值对应的特征向量，在R中可以使用eigen()得到U和A，<code>eigen(x,symmertic, only.values=FALSE,EISPACK=FALSE)</code>，其中参数symmetric项是逻辑值，是F或T，它用于指定矩阵x是否为对称矩阵，如果不指定，系统将自动检验x是否为对称矩阵，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; eigen(j)</div><div class="line">eigen() decomposition</div><div class="line">$values</div><div class="line">[<span class="number">1</span>]  <span class="number">1.611684e+01</span> -<span class="number">1.116844e+00</span> -<span class="number">5.700691e-16</span></div><div class="line"></div><div class="line">$vectors</div><div class="line">           [,<span class="number">1</span>]       [,<span class="number">2</span>]       [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">0.4645473</span> -<span class="number">0.8829060</span>  <span class="number">0.4082483</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.5707955</span> -<span class="number">0.2395204</span> -<span class="number">0.8164966</span></div><div class="line">[<span class="number">3</span>,] -<span class="number">0.6770438</span>  <span class="number">0.4038651</span>  <span class="number">0.4082483</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的求逆"><a href="#矩阵的求逆" class="headerlink" title="矩阵的求逆"></a>矩阵的求逆</h3><p>矩阵求逆可用函数solve()，应用sovle(A,b)运算结果可以解线性方程组Ax=b，缺b缺少，则系统默认为单位矩阵，因此可以用其进行矩阵求逆，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; e</div><div class="line">  [,<span class="number">1</span>] [,<span class="number">2</span>]</div><div class="line">a   <span class="number">15</span>   <span class="number">36</span></div><div class="line">b   <span class="number">29</span>   <span class="number">71</span></div><div class="line">&gt; solve(e)</div><div class="line">             a          b</div><div class="line">[<span class="number">1</span>,]  <span class="number">3.380952</span> -<span class="number">1.7142857</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">1.380952</span>  <span class="number">0.7142857</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的Choleskey分解"><a href="#矩阵的Choleskey分解" class="headerlink" title="矩阵的Choleskey分解"></a>矩阵的Choleskey分解</h3><p>对于正定矩阵A，可对其进行Choleskey分解，即A=P’P，其中P为上三角矩阵，在R中可以用函数chol()进行Choleskey分解，如下所示： </p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/kjC1c7m9Be.png?imageslim" alt="mark"></p>
<h3 id="矩阵奇异值分解"><a href="#矩阵奇异值分解" class="headerlink" title="矩阵奇异值分解"></a>矩阵奇异值分解</h3><p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/4hdBIkGai3.png?imageslim" alt="mark"></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/DcEdkH03aH.png?imageslim" alt="mark"></p>
<h3 id="矩阵QR分解"><a href="#矩阵QR分解" class="headerlink" title="矩阵QR分解"></a>矩阵QR分解</h3><p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/9AhgfEi19J.png?imageslim" alt="mark"></p>
<h3 id="矩阵kronecker积"><a href="#矩阵kronecker积" class="headerlink" title="矩阵kronecker积"></a>矩阵kronecker积</h3><p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/Klf85Am6cE.png?imageslim" alt="mark"></p>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><h2 id="什么是数组"><a href="#什么是数组" class="headerlink" title="什么是数组"></a>什么是数组</h2><p>数组：一维数据是向量，二维数据是矩阵，数组是向量和矩阵的直接推广，是由三维或三维以上的数据构成的。 </p>
<h2 id="构建数组"><a href="#构建数组" class="headerlink" title="构建数组"></a>构建数组</h2><p>数组函数是<code>array(),</code>语法是：<code>array(dadta, dim)</code>，其中<code>data</code>必须是同一类型的数据，<code>dim</code>是各维的长度组成的向量。函数<code>rowSums</code>, <code>colSums</code>, <code>rowMeans</code>, <code>colMeans</code>分别可以计算行总和，行均值，列总和，列均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">a&lt;-array(rep(<span class="number">1</span>:<span class="number">3</span>,each=<span class="number">3</span>),dim=c(<span class="number">3</span>,<span class="number">3</span>))</div><div class="line">a</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    2    3</span></div><div class="line"><span class="comment">## [2,]1    2    3</span></div><div class="line"><span class="comment">## [3,]1    2    3</span></div><div class="line"></div><div class="line">rowSums(a)</div><div class="line"><span class="comment">## [1] 6 6 6</span></div><div class="line"></div><div class="line">colSums(a)</div><div class="line"><span class="comment">## [1] 3 6 9</span></div><div class="line"></div><div class="line">table(a)</div><div class="line"><span class="comment">## a</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 3 3 3</span></div></pre></td></tr></table></figure>
<h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">colSums (x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) rowSums (x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) colMeans(x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) rowMeans(x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>其中dims为整数，表示哪个或哪些维数被看做行或列，对于row统计函数，dims+1及以后的维度被看做行，对于col函数，dims及以前的维度（1:dims）被看做列： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">b &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">9</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>));b</div><div class="line"></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    1    1</span></div><div class="line"><span class="comment">## [2,]1    1    1</span></div><div class="line"><span class="comment">## [3,]1    1    1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    2    2</span></div><div class="line"><span class="comment">## [2,]2    2    2</span></div><div class="line"><span class="comment">## [3,]2    2    2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    3    3</span></div><div class="line"><span class="comment">## [2,]3    3    3</span></div><div class="line"><span class="comment">## [3,]3    3    3</span></div><div class="line"></div><div class="line">rowSums(b)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">1</span>)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]6    6    6</span></div><div class="line"><span class="comment">## [2,]6    6    6</span></div><div class="line"><span class="comment">## [3,]6    6    6</span></div><div class="line"></div><div class="line">colSums(b)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    6    9</span></div><div class="line"><span class="comment">## [2,]3    6    9</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">colSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1]  9 18 27</span></div><div class="line"></div><div class="line">table(b)</div><div class="line"><span class="comment">## b</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 9 9 9</span></div></pre></td></tr></table></figure>
<h2 id="数组命名"><a href="#数组命名" class="headerlink" title="数组命名"></a>数组命名</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">x&lt;-<span class="number">1</span>:<span class="number">3</span> <span class="comment">#建立向量x</span></div><div class="line">names(x) <span class="comment">#提取向量x的名称</span></div><div class="line"><span class="comment">## NULL</span></div><div class="line"></div><div class="line">names(x)&lt;-c(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>);x<span class="comment">#将a,b,c作为x的名称</span></div><div class="line"><span class="comment">## a b c </span></div><div class="line"><span class="comment">## 1 2 3</span></div><div class="line"></div><div class="line">names(x)<span class="comment">#显示向量x的名称</span></div><div class="line"><span class="comment">## [1] "a" "b" "c"</span></div><div class="line"></div><div class="line">names(x)&lt;-<span class="literal">NULL</span>;x <span class="comment">#删除向量x的名称</span></div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"></div><div class="line">x&lt;-matrix(<span class="number">1</span>:<span class="number">4</span>,<span class="number">2</span>)</div><div class="line">rownames(x)&lt;-c(<span class="string">"a"</span>,<span class="string">"b"</span>) <span class="comment"># 将行命名为a,b</span></div><div class="line">colnames(x)&lt;-c(<span class="string">"c"</span>,<span class="string">"d"</span>);x <span class="comment"># 将列命名为c,d</span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 1 3</span></div><div class="line"><span class="comment">## b 2 4</span></div><div class="line"></div><div class="line">dimnames(x)<span class="comment">#返回包含两个向量的列表</span></div><div class="line"><span class="comment">## [[1]]</span></div><div class="line"><span class="comment">## [1] "a" "b"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[2]]</span></div><div class="line"><span class="comment">## [1] "c" "d"</span></div><div class="line"></div><div class="line">a&lt;-array(<span class="number">1</span>:<span class="number">8</span>,dim=c(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>));a<span class="comment">#建立数组a,维度为2，2，2</span></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]2    4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]5    7</span></div><div class="line"><span class="comment">## [2,]6    8</span></div><div class="line"></div><div class="line">dimnames(a)&lt;-list(c(<span class="string">"a"</span>,<span class="string">"b"</span>),c(<span class="string">"c"</span>,<span class="string">"d"</span>),c(<span class="string">"e"</span>,<span class="string">"f"</span>));a <span class="comment"># 将数组a的各组命名</span></div><div class="line"><span class="comment">## , , e</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 1 3</span></div><div class="line"><span class="comment">## b 2 4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , f</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 5 7</span></div><div class="line"><span class="comment">## b 6 8</span></div></pre></td></tr></table></figure>
<h2 id="行列求和，平均值和频数"><a href="#行列求和，平均值和频数" class="headerlink" title="行列求和，平均值和频数"></a>行列求和，平均值和频数</h2><h3 id="简单数组"><a href="#简单数组" class="headerlink" title="简单数组"></a>简单数组</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">3</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>));a</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    2    3</span></div><div class="line"><span class="comment">## [2,]1    2    3</span></div><div class="line"><span class="comment">## [3,]1    2    3</span></div><div class="line"></div><div class="line">rowSums(a) <span class="comment"># 求行的和</span></div><div class="line"><span class="comment">## [1] 6 6 6</span></div><div class="line"></div><div class="line">colSums(a) <span class="comment"># 求列的和　</span></div><div class="line"><span class="comment">## [1] 3 6 9</span></div><div class="line"></div><div class="line">table(a) <span class="comment"># 频数表</span></div><div class="line"><span class="comment">## a</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 3 3 3</span></div></pre></td></tr></table></figure>
<h3 id="多维数组-1"><a href="#多维数组-1" class="headerlink" title="多维数组"></a>多维数组</h3><p>对于多维数组，rowSums, colSums, rowMeans, colMeans的使用稍为复杂点。它们的参数为: </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">b &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">9</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>));b</div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    1    1</span></div><div class="line"><span class="comment">## [2,]1    1    1</span></div><div class="line"><span class="comment">## [3,]1    1    1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    2    2</span></div><div class="line"><span class="comment">## [2,]2    2    2</span></div><div class="line"><span class="comment">## [3,]2    2    2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    3    3</span></div><div class="line"><span class="comment">## [2,]3    3    3</span></div><div class="line"><span class="comment">## [3,]3    3    3</span></div><div class="line"></div><div class="line">rowSums(b)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">1</span>)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]6    6    6</span></div><div class="line"><span class="comment">## [2,]6    6    6</span></div><div class="line"><span class="comment">## [3,]6    6    6</span></div><div class="line"></div><div class="line">colSums(b)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    6    9</span></div><div class="line"><span class="comment">## [2,]3    6    9</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">colSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1]  9 18 27</span></div><div class="line"></div><div class="line">table(b)</div><div class="line"><span class="comment">## b</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 9 9 9</span></div><div class="line"></div><div class="line">c &lt;- sample(letters[<span class="number">1</span>:<span class="number">5</span>], <span class="number">10</span>, replace=<span class="literal">TRUE</span>)</div><div class="line">table(c)</div><div class="line"><span class="comment">## c</span></div><div class="line"><span class="comment">## a b d e </span></div><div class="line"><span class="comment">## 1 3 2 4</span></div></pre></td></tr></table></figure>
<h1 id="查看数据类型"><a href="#查看数据类型" class="headerlink" title="查看数据类型"></a>查看数据类型</h1><h2 id="class"><a href="#class" class="headerlink" title="class()"></a>class()</h2><p>使用class函数可以查看数据的类型，如下所示： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; x=c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">&gt; class(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"numeric"</span></div><div class="line">&gt; x1&lt;-as.character(x)</div><div class="line">&gt; class(x1)</div><div class="line">[<span class="number">1</span>] <span class="string">"character"</span></div></pre></td></tr></table></figure>
<h1 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h1><p>常用函数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">判断转换 类型转换函数 </div><div class="line">is.numeric() as.numeric() </div><div class="line">is.character() as.character() </div><div class="line">is.vector() as.vector() </div><div class="line">is.matrix() as.matrix() </div><div class="line">is.data.frame() as.data.frame() </div><div class="line">is.factor() as.factor() </div><div class="line">is.logical() as.logical()</div></pre></td></tr></table></figure>
<p>使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; a &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);a</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></div><div class="line">&gt; is.numeric(a)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; is.vector(a)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; a &lt;- as.character(a)</div><div class="line">&gt; a <span class="comment">#将a转化为字符串类型</span></div><div class="line">[<span class="number">1</span>] <span class="string">"1"</span> <span class="string">"2"</span> <span class="string">"3"</span></div><div class="line">&gt; is.numeric(a)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; is.vector(a)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; is.character(a)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; as.numeric(<span class="literal">FALSE</span>) <span class="comment">#逻辑型数据转化为0与1</span></div><div class="line">[<span class="number">1</span>] <span class="number">0</span></div><div class="line">&gt; as.numeric(<span class="literal">TRUE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">131</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共488.8k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
