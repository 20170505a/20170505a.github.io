<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/2/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/2/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/04/24/生信-KEGG学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/生信-KEGG学习笔记/" itemprop="url">KEGG学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-24T12:00:00+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,225
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>1. 什么是通路分析？</strong> 答：一个生物学过程的实现会涉及到许多蛋白质，这些蛋白质合在一起就是一个通路。通路分析能够帮助我们更好地了解某个或某一些蛋白质在一个生物学过程中所扮演的角色。通路分析和GO都是对基因进行注释，那么为什么要对基因进行注释呢？因为基因说穿了其实是一串RNA，那么它的功能和结构虽然都是客观存在的，但是要如何描述这些客观的东西是基因注释所要解决的问题。 最常用的通路分析数据库是京都基因与基因组百科全书 (Kyoto Encyclopedia of Genes and Genomes, KEGG)。1995年，KEGG数据库项目由京都大学化学研究所教授Minoru Kanehisa领头启动。KEGG数据库是手工绘制的KEGG途径图的集合，每个途径图包含分子相互作用和反应的网络，将基因组中的基因与通路中的基因产物（主要是蛋白质）连接。KEGG pathway analysis即为将目的基因定位到KEGG途径图中的过程。下图为small cell lung cancer的KEGG途径图。</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/5e1AC87cD0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>2. 什么是KEGG？</strong> 答：KEGG，Kyoto Encyclopedia of Genes and Genomes，京都基因和基因组百科全书，是系统分析基因功能，联系基因组信息和功能信息的知识库。其中包含有大量的通路图，如下图所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/cDH8eG65Fi.png?imageslim" alt="mark"></p>
<p><strong>3. KEGG中的各种符号表示什么意思？</strong> 答：如下图所示，这种绿色方框里面的是酶； <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/IhKbhEe588.png?imageslim" alt="mark"></p>
<p>圆圈代表代谢物，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/1e02LEaa7B.png?imageslim" alt="mark"> 点一个圆圈，如cAMP进去，有这个代谢物的各种信息，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/e1IG9ciEcK.png?imageslim" alt="mark"> 其中C00575的信息为，C代表人物，即compound，00575是这种化合物在KEGG中的编号。</p>
<p>此外，还有一些白框，它们的信息如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/FKc3Flfl3I.jpg?imageslim" alt="mark"></p>
<p><strong>4. KEGG中的不同颜色表示什么意思？</strong> 答：一般KEGG存在两种代谢图： ①reference pathway，这是根据已有的知识绘制的、概括的、详尽的具有一般参考意义的代谢图，为白色小框，在KEGG中名字以map开头，比如map00010，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/HHGK5jf20m.png?imageslim" alt="mark"></p>
<p>②species-specific pathway，绿色小框为该物种特有的基因或酶，只有这些绿色的框有更详细的信息。KEGG中名字为特定物种种属英文缩写，比如酵母的糖酵解通路图，sce00010，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/bJLf2ck2i8.png?imageslim" alt="mark"></p>
<p><strong>5. KEGG在生物信息学方面分析的原理是什么？ </strong> 答：人类的七千多个基因组都是有已知功能的，KEGG把这七千多个基因分成了300个类，就是我们通常说的kegg通路；比如，我现在做了个实验，发现某细胞系里面的两万个基因里面有300个基因变化了，那这300个基因会涉及到KEGG数据库的哪几个通路？这时候就需要用到我的工具啦~将这300个基因加入工具里面，得出结果：有30个Cell cycle通路。</p>
<p><strong>6. 富集分析怎么分析？</strong> 答：事实上，Cell Cycle KEGG 通路 hsa04110只有124个基因；而我处理了细胞系之后，在只有300个基因发生统计学显著变化的情况下，就有30个是Cell Cycle通路？高达10%的概率，那到底这个Cell Cycle通路是不是被显著改变了呢？ 首先，我会把用户的300个基因，都用KEGG数据库的300个通路注释，然后一个个通路循环做超几何分布检验，给出P值；比如刚才的Cell Cycle 通路就很显著，因为124/7000就2%的概率，结果我 30/300有10%的概率~太可怕了，所以我的这个处理显著的改变了细胞系的Cell Cycle 通路。</p>
<p><strong>7. KEGG分析后的结果是什么样子，怎么解读？</strong> 答：这是某个工具的KEGG分析后的结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180409/d5KH0eKjb8.jpg?imageslim" alt="mark"> 黄色是高表达（有的工具会是红色），绿色是低表达，灰色是表达不变。</p>
<p><strong>8. KEGG中的代码是什么意思？</strong> 答：1. K+num（基因ID号，表示在所有同源物种中具有相似结构或功能的一类同源蛋白），如K04456=&gt;丝氨酸/苏氨酸蛋白激酶（备注：K建议大写）。 2. ko + num（代谢通路名称，表示一个特定的生物路径），如：k04151=&gt;PIK-Akt信号通路（备注：ko小写）。 3. M+num（模块名称），M00676=&gt;PI3K-Akt信号模块。 4. C+num（代合物名），如C00533表示NO。 5. E-.-.-.-（酶名），例如EC2.7.1.11.1=&gt;丝氨酶/苏氨酸激酶（即K04456，AKT）。 6. R+num（反应名） 7. RC+num(反应类型）RP + RP+num（反应物质对）</p>
<p>参考资料 1. <a href="https://mp.weixin.qq.com/s?src=3&amp;timestamp=1523265048&amp;ver=1&amp;signature=SlU3Ctn3S1ucuf07HpdA5BO7jftw2xUN1IpV84vyrd2zq-RdrZhJihCJ1WKkxk0DkrPc--l-Gz-rqX4274h94eqWPiZ2Zsx6*tz0buy1Zxg54pZ-6D6smfhmLAUtCAbBE52Q8qgh5SrjjuJcVBZH91psMGXAb8oqFWTmlxB-EIg=" target="_blank" rel="external">手把手教你看KEGG通路图！</a> 2. <a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1523265396&amp;ver=806&amp;signature=5oh1CmbL0GLyXQ62PnvxR7ZafrvmFU-09TV0vuGJ4TNVw7vVVaEw**EjPiKXQBiYJG6LmwtjT2YRNiBOBYu3matCTy3cvVG9SICTWYkPAln7ivUte0n*KsIXY*yVauf-&amp;new=1" target="_blank" rel="external">KEGG富集分析从未如此简单</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/04/21/生信-Linux环境变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/21/生信-Linux环境变量/" itemprop="url">Linux环境变量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-21T12:10:54+08:00">
                2018-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,588
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是shell">1. 什么是shell？</h3>
<p>答：在计算机科学中，Shell俗称壳（用来区别于核，核是指“内核”），Shell是指“提供使用者使用界面”的软件（命令解析器）。它类似于DOS下的command.com和后来的cmd.exe。它接收用户命令，然后调用相应的应用程序。</p>
<p>在很多并不正式的场合，这两个名词表达的意思相同，即命令解释器。但从严格的意义上讲，命令行是指供用户输入命令的界面，其本身只是接受输入，然后把命令传递给命令解释器，后者就是Shell，从本质上讲，Shell是一个程序，它在用户和操作系统之间提供了一个面向行的可交互接口，用户在命令行中输入命令，运行在后台的Shell把命令转换成指令代码发送给操作系统。Shell并非只有命令行这一种形式，例如GNOME、KDE等图形界面也是Shell，不过它们是GUI Shell，都是为了解决人机交互的问题。</p>
<p>目前在Linux环境下有几种不同类型的Shell，常用的有Bourne Again Shell（BASH）、TCSH Shell、Z-Shell。不同的Shell提供不同的语法和特性。</p>
<p>例如在Ubuntu中，可以在<code>etc/passwd</code>文件中查看到自己的默认shell程序，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ cat /etc/passwd |grep biotest</div><div class="line">biotest:x:1000:1000:UBUNTU,,,:/home/biotest:/bin/bash</div></pre></td></tr></table></figure>
<p>由上述结果可知，biotest用户所用到shell是bash。bash shell程序位于/bin目录内，从长列表中可以看出<code>/bin/bash</code>是一个可执行程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ ls -lF /bin/bash</div><div class="line">-rwxr-xr-x 1 root root 1037528 May 16  2017 /bin/bash*</div></pre></td></tr></table></figure>
<p>注：在Linux系统中，当使用ls，添加了-F参数时，会在每个输出项后追加文件的类型标识符，具体含义为：“*”表示具有可执行权限的普通文件，“/”表示目录，“@”表示符号链接，“|”表示命令管道FIFO，“=”表示sockets套接字。当文件为普通文件时，不输出任何标识符；</p>
<h3 id="什么是bash">2. 什么是bash？</h3>
<p>答：bash相当于shell中的某个，shell的范围更广。bash的全称是Bourne again / born again。</p>
<h3 id="什么是环境变量">3. 什么是环境变量？</h3>
<p>答：shell 在 shell 会话中保存着大量信息。这些信息被称为 (shell 的) 环境。 程序获取环境中的数据（即环境变量）来了解本机的配置。虽然大多数程序用配置文件来存储程序设置， 一些程序会根据环境变量来调整他们的行为。Linux是一个多用户的操作系统。每个用户登录系统后，都会有一个专用的运行环境。 通常每个用户默认的环境都是相同的，这个默认环境实际上就是一组环境变量的定义。 环境变量是全局的，设置好的环境变量可以被所有当前用户所运行的程序所使用。 用户可以对自己的运行环境进行定制，其方法就是修改相应的系统环境变量。在bash shell中，环境变量分为两类，分别为全局变量，局部变量。</p>
<p>shell 在环境中存储了两种基本类型的数据，虽然 bash 几乎无法分辨这些数据的类型。 它们是环境变量和 shell 变量。Shell 变量是 bash 存放的少量数据。剩下的都是 环境变量。除了变量，shell 也存储了一些可编程的数据，即别名和 shell 函数。</p>
<h3 id="如何查看环境变量">4. 如何查看环境变量？</h3>
<p>答：<code>printenv</code>可以显示全局变量，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/f429H66haH.png?imageslim" alt="mark"> 上述的内容是环境变量及其数值列表，环境变量通常是大写字母，这主要是为了与用户的变量进行区分，例如我们可以看到USER=biotest这行代码，就表示当前的用户是biotest，用<code>printenv</code>命令也可以查看当前用户，如下所示：</p>
<blockquote>
<p>biotest@ubuntu:~$ printenv USER biotest</p>
</blockquote>
<h4 id="通过echo来查看变量的值如下所示">通过echo来查看变量的值，如下所示：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ echo $HOME</div><div class="line">/home/biotest</div><div class="line">biotest@ubuntu:~/miniconda2/opt$ echo $PWD # PWD是显示当前目录</div><div class="line">/home/biotest/miniconda2/opt</div></pre></td></tr></table></figure>
<h4 id="的作用">$的作用</h4>
<p>在echo命令中，在变量名前加上<code>$</code>就能显示当前变量的值，它也能让变量作为命令行参数，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/miniconda2/opt$ ls $HOME</div><div class="line">biosoft    Downloads         Miniconda2-latest-Linux-x86_64.sh  Public     Videos</div><div class="line">Desktop    examples.desktop  Music                              Templates</div><div class="line">Documents  miniconda2        Pictures                           test</div></pre></td></tr></table></figure>
<h4 id="设置局部用户定义变量">设置局部用户定义变量</h4>
<p>一旦启动了bash shell（或者执行一个shell脚本），就能创建在这个shell进程内可见的局部变量了。可以通过等号给环境变量赋值，值可以是数值或字符串，需要注意的是，在shell中，变量名，等号和值之间没有空格，否则会出错，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/miniconda2/opt$ echo $mywords</div><div class="line"></div><div class="line">biotest@ubuntu:~/miniconda2/opt$ mywords=hello</div><div class="line">biotest@ubuntu:~/miniconda2/opt$ echo $mywords</div><div class="line">hello</div></pre></td></tr></table></figure>
<p>如果要给变量赋值一个含有空格的字符串，必须要加上单绰号来界定字符串的首和尾，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/miniconda2/opt$ mywords=Hello linux</div><div class="line">linux: command not found</div><div class="line">biotest@ubuntu:~/miniconda2/opt$ mywords="Hello linux"</div><div class="line">biotest@ubuntu:~/miniconda2/opt$ echo $mywords</div><div class="line">Hello linux</div></pre></td></tr></table></figure>
<p>设置了局部变量后，就能在shell进程的任何地方使用它了，但是，如果生成了另外一个shell，在它的子shell中就无法使用。类似地，如果在子进程中设置了一个局部变量，一旦退出了子进程，那个局部环境变量就无法使用。</p>
<h4 id="设置全局环境变量">设置全局环境变量</h4>
<p>在设定全局环境变量的进程所创建的子进程中，该变量都是可见的。创建全局环境变量的方法是先创建一个局部环境变量，然后再把它导出到全局环境中。，这个过程是通过<code>export</code>命令实现的，变量名前面不加<code>$</code>，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ my_words="I love Linux"</div><div class="line">biotest@ubuntu:~$ export my_words</div><div class="line">biotest@ubuntu:~$ echo $mywords</div><div class="line">Hello linux</div><div class="line">biotest@ubuntu:~$ bash</div><div class="line">bbiotest@ubuntu:~$ echo $my_words</div><div class="line">I love Linux</div></pre></td></tr></table></figure>
<p>在定义了my_words变量后，用bash命令启动了一个子shell，在空上子shell中能够显示变量my_words的值，这是因为export命令将其设为了全局变量。</p>
<p>修改子shell中全局环境变量的值并不会影响你shell中该变量的值，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line">I love Linux</div><div class="line">biotest@ubuntu:~$ bash</div><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line">I love Linux</div><div class="line">biotest@ubuntu:~$ my_words="I love Ubuntu"</div><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line">I love Ubuntu</div><div class="line">biotest@ubuntu:~$ exit</div><div class="line">exit</div><div class="line">biotest@ubuntu:~$ exit</div><div class="line">exit</div><div class="line">biotest@ubuntu:~$ ps</div><div class="line">   PID TTY          TIME CMD</div><div class="line"> 20142 pts/4    00:00:00 bash</div><div class="line"> 20318 pts/4    00:00:00 ps</div><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line">I love Linux</div></pre></td></tr></table></figure>
<p>子shell也无法通export命令改变父shell中全局变量的值。</p>
<h4 id="删除环境变量">删除环境变量</h4>
<p>删除环境变量使用<code>unset</code>命令，前面不加<code>$</code>符号，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line">I love Linux</div><div class="line">biotest@ubuntu:~$ unset my_words</div><div class="line">biotest@ubuntu:~$ echo $my_words</div><div class="line"></div><div class="line">biotest@ubuntu:~$</div></pre></td></tr></table></figure>
<p>在涉及变量名时，什么时候使用<code>$</code>，什么时候不使用<code>$</code>，只需要这样记忆：要具体地查看变量的值时，就需要<code>$</code>符号，如果不需要查看变量的值，只针对变量本身操作，就不使用<code>$</code>符号。</p>
<h3 id="setprintenv都可以查看系统变量它们有什么区别">5. setprintenv都可以查看系统变量，它们有什么区别？</h3>
<p>答：（1）通过<code>set</code>可以设置shell选项，如果只输入set而不加任何参数，它就会显示shell 变量，环境变量，和定义的 shell 函数，此时与printenv命令类似，与 printenv 命令不同的是，set 命令的输出很友好地按照首字母顺序排列，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/Hc4BKfI9eL.png?imageslim" alt="mark"> 如上图所示，当使用没有带选项和参数的 set 命令时，shell 变量，环境变量，和定义的 shell 函数都会被显示。不同于 printenv 命令，set 命令的输出很友好地按照首字母顺序排列。 （2）set命令显示当前shell的变量，包括当前用户的变量；printenv（输入env也可以）命令只显示当前用户的变量。每个shell有自己特有的变量（set）显示的变量，这个和用户变量是不同的，当前用户变量和你用什么shell无关，不管你用什么shell都在，比如HOME,SHELL等这些变量，但shell自己的变量不同shell是不同的，比如BASH_ARGC， BASH等，这些变量只有set才会显示，是bash特有的。</p>
<h3 id="环境变量存放在哪个地方">6. 环境变量存放在哪个地方？</h3>
<p>答：当你进入系统的时候，linux 就会为你读入系统的环境变量，这些环境变量存放在什么地方，那就是环境变量的文件中。Linux 中有很多记载环境变量的文件，它们被系统读入是按照一定的顺序的，这些文件包括以下部分：</p>
<h4 id="etcprofile">6.1 <code>/etc/profile</code>：</h4>
<p>此文件是bash shell默认的主启动文件，只要登录了Linux，bash就会执行/etc/profile启动文件中的命令，该文件存储的是整个系统的环境变量，它为每个用户设置环境信息，这个文件只有root才能修改。当用户第一次登录时，该文件被执行。并从/etc/profile.d目录的配置文件中搜集shell 的设置。这个文件，是任何用户登陆操作系统以后都会读取的文件（如果用户的shell 是csh 、tcsh 、zsh ，则不会读取此文件），用于获取系统的环境变量，只在登陆的时候读取一次。</p>
<h4 id="etcbashrc">6.2<code>/etc/bashrc</code>：</h4>
<p>在执行完/etc/profile 内容之后，如果用户的Shell运行的是bash ，那么接着就会执行此文件。另外，当每次一个新的bash shell 被打开时, 该文件被读取。每个使用bash的用户在登陆以后执行完/etc/profile 中内容以后都会执行此文件，在新开一个bash 的时候也会执行此文件。因此，如果你想让每个使用bash 的用户每新开一个bash 和每次登陆都执行某些操作，或者给他们定义一些新的环境变量，就可以在这个里面设置。 注：<code>/etc/profile</code>，<code>/etc/bashrc</code> 是系统全局环境变量设定</p>
<h4 id="home.bashrc">6.3<code>$HOME/.bashrc</code>：</h4>
<p>该文件包含专用于单个人的bash shell 的bash 信息，当登录时以及每次打开一个新的shell 时, 该该文件被读取。 单个用户此文件的修改会影响到他以后的每一次登陆系统和每一次新开一个bash 。因此，可以在这里设置单个用户的特殊的环境变量或者特殊的操作，那么每次它新登陆系统或者新开一个bash ，都会去获取相应的特殊的环境变量和特殊操作。</p>
<h4 id="home.bash_profile">6.4<code>$HOME/.bash_profile</code>：</h4>
<p>每个用户都可使用该文件输入专用于自己使用的shell 信息。当用户登录时，该文件仅仅执行一次，默认情况下，它设置一些环境变量，执行用户的.bashrc 文件。单个用户此文件的修改只会影响到他以后的每一次登陆系统。因此，可以在这里设置单个用户的特殊的环境变量或者特殊的操作，那么它在每次登陆的时候都会去获取这些新的环境变量或者做某些特殊的操作，但是仅仅在登陆时。 <code>~/.bashrc</code>和<code>~/.bash_profile</code>都只对当前的用户永久生效，也就是说假如用户A设置了些类环境变量，这个环境变量只有A才能使用，而对于其他的B，C，D等用户来说，这个变量是不存在的。在根目录下，通过<code>ls -a</code>可以查看这两个文件，正常情况下，这两个文件是隐藏的。</p>
<h4 id="home.bash_logout">6.5<code>$HOME/.bash_logout</code>：</h4>
<p>当每次退出系统( 退出bash shell) 时, 执行该文件。</p>
<h3 id="bashrc和.bash_profile的区别是什么">7. <code>~/.bashrc</code>和<code>~/.bash_profile</code>的区别是什么？</h3>
<p>答：原则上来说，设置自己的环境变量时，在这两个文件中任意选一个即可，它们的区别在于：<code>~/.bash_profile</code>是交互式login方式进入bash shell运行而<code>~/ .bashrc</code>是交互式non-login方式进入bash shell运行。二者设置大致相同。通俗点说，就是<code>.bash_profile</code>文件只会在用户登录的时候读取一次，而<code>.bashrc</code>在每次打开终端进行一次新的会话时都会读取。</p>
<h4 id="登录-shell-会读取一个或多个启动文件的总结">登录 shell 会读取一个或多个启动文件的总结:</h4>
<table style="width:85%;">
<colgroup>
<col width="27%">
<col width="56%">
</colgroup>
<thead>
<tr class="header">
<th>文件</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>/etc/profile</td>
<td>应用于所有用户的全局配置脚本。</td>
</tr>
<tr class="even">
<td>$HOME/.bash_profile</td>
<td>用户个人的启动文件。可以用来扩展或重写全局配置脚本中的设置。</td>
</tr>
<tr class="odd">
<td>$HOME/.bash_login</td>
<td>如果文件 ~/.bash_profile 没有找到，bash 会尝试读取这个脚本。</td>
</tr>
<tr class="even">
<td>$HOME/.profile</td>
<td>如果文件 ~/.bash_profile 或文件 ~/.bash_login 都没有找到，bash 会试图读取这个文件。 这是基于 Debian 发行版的默认设置，比方说 Ubuntu。</td>
</tr>
</tbody>
</table>
<p>非登录 shell 会话会读取以下启动文件：</p>
<table>
<thead>
<tr class="header">
<th>文件</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>/etc/bash.bashrc</td>
<td>应用于所有用户的全局配置文件。</td>
</tr>
<tr class="even">
<td>~/.bashrc</td>
<td>用户个人的启动文件。可以用来扩展或重写全局配置脚本中的设置。</td>
</tr>
</tbody>
</table>
<p>在普通用户看来，文件 ~/.bashrc 可能是最重要的启动文件，因为它几乎总是被读取。非登录 shell 默认 会读取它，并且大多数登录 shell 的启动文件会以能读取 ~/.bashrc 文件的方式来书写。</p>
<h3 id="如何查看某个变量的内容">8. 如何查看某个变量的内容？</h3>
<p>答：如果只查看某个变量的内容，用echo，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/EEDi017BBh.png?imageslim" alt="mark"></p>
<h3 id="什么是临时有效的环境变量">9. 什么是临时有效的环境变量？</h3>
<p>答：临时有效的环境变量就是只对当前的shell有效，当我们退出登录或者关闭终端再打开时，这个环境变量就会消失，它是临时的，设置方法是直接使用<code>export</code>命令来添加，如下所示：</p>
<blockquote>
<p>biotest@ubuntu:~$ export Words=“Hello, world!” biotest@ubuntu:~$ echo $Words Hello, world! biotest@ubuntu:~</p>
</blockquote>
<h3 id="如何查看地自定义的别名">10. 如何查看地自定义的别名？</h3>
<p>答：通过set或printenv无法查看通过alias命名的别名，此时需要通过alias来查看，如下所示：</p>
<blockquote>
<p>alias egrep=‘egrep –color=auto’ alias fgrep=‘fgrep –color=auto’ alias grep=‘grep –color=auto’ alias l=‘ls -CF’ alias la=‘ls -A’ alias ll=‘ls -alF’ alias ls=‘ls –color=auto’</p>
</blockquote>
<h3 id="shell中的一些大写字母是什么意思">11. Shell中的一些大写字母是什么意思？</h3>
<p>答：这些大写字母表示一些特殊的环境变量，如下所示：</p>
<table style="width:68%;">
<colgroup>
<col width="11%">
<col width="56%">
</colgroup>
<thead>
<tr class="header">
<th>变量</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DISPLAY</td>
<td>如果你正在运行图形界面环境，那么这个变量就是你显示器的名字。通常，它是 “:0”， 意思是由 X 产生的第一个显示器。</td>
</tr>
<tr class="even">
<td>EDITOR</td>
<td>文本编辑器的名字。</td>
</tr>
<tr class="odd">
<td>SHELL</td>
<td>shell 程序的名字。</td>
</tr>
<tr class="even">
<td>HOME</td>
<td>用户家目录。</td>
</tr>
<tr class="odd">
<td>LANG</td>
<td>定义了字符集以及语言编码方式。</td>
</tr>
<tr class="even">
<td>OLD_PWD</td>
<td>先前的工作目录。</td>
</tr>
<tr class="odd">
<td>PAGER</td>
<td>页输出程序的名字。这经常设置为/usr/bin/less。</td>
</tr>
<tr class="even">
<td>PATH</td>
<td>由冒号分开的目录列表，当你输入可执行程序名后，会搜索这个目录列表。</td>
</tr>
<tr class="odd">
<td>PS1</td>
<td>Prompt String 1. 这个定义了你的 shell 提示符的内容。随后我们可以看到，这个变量 内容可以全面地定制。</td>
</tr>
<tr class="even">
<td>PWD</td>
<td>当前工作目录。</td>
</tr>
<tr class="odd">
<td>TERM</td>
<td>终端类型名。类 Unix 的系统支持许多终端协议；这个变量设置你的终端仿真器所用的协议。</td>
</tr>
<tr class="even">
<td>TZ</td>
<td>指定你所在的时区。大多数类 Unix 的系统按照协调时间时 (UTC) 来维护计算机内部的时钟 ，然后应用一个由这个变量指定的偏差来显示本地时间。</td>
</tr>
<tr class="odd">
<td>USER</td>
<td>你的用户名</td>
</tr>
</tbody>
</table>
<h3 id="设置环境变量常用的指令有哪些">12. 设置环境变量常用的指令有哪些?</h3>
<p>答:常用的命令有<code>echo</code>,<code>export</code>,<code>env</code>,<code>set</code>,<code>unset</code>，<code>readonly</code>等，如下所示：</p>
<h4 id="echo">(1)<code>echo</code></h4>
<p>查看某个环境变量．</p>
<h4 id="env">(２)<code>env</code></h4>
<p>查看所有环境变量</p>
<h4 id="set">(３)<code>set</code></h4>
<p>查看本地定义的所有shell变量．</p>
<h4 id="unset">(４)<code>unset</code></h4>
<p>删除一个环境变量，例如：</p>
<blockquote>
<p>biotest@ubuntu:~$ export Words=“Hello, world!” biotest@ubuntu:~$ echo $Words Hello, world! biotest@ubuntu:~$ unset Words biotest@ubuntu:~$ echo $Words biotest@ubuntu:~$</p>
</blockquote>
<h4 id="readonly">(5)<code>readonly</code></h4>
<p>设置只读环境变量．</p>
<h3 id="如何将某程序的目录添加到环境变量">13. 如何将某程序的目录添加到环境变量？</h3>
<p>答：当在shell中输入一个外部命令时,shell就会搜索系统来找到相应的程序,<code>PATH</code>这个环境变量就是定义用于命令和程序查找的目录,通过<code>echo $PATH</code>可以查看环境变量，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/H7kICbk6jf.png?imageslim" alt="mark"></p>
<p>在<code>PATH</code>变量中，可以看到许多由冒号（黄色方框标出的部分）分开的路径。每个冒号就是一个路径，这些搜索路径都是一些可以找到可执行程序的目录列表。当我们输入一个指令时，shell会先检查命令是否是内部命令，不是的话会再检查这个命令是否是一个应用程序。然后shell会试着从这些搜索路径，即PATH（上图中路径）中寻找这些应用程序。如果shell在这些路径目录里没有找到可执行文件。则会报错。若找到，shell内部命令或应用程序将被分解为系统调用并传给Linux内核。在某些时候,我们在Linux中安装了软件,如果没有把软件的可执行文件路径添加到PATH中去的话，要执行某个程序，就需要输入全路径，非常不方便，因此我们需要把软件的安装目录添加到PATH变量中。</p>
<h4 id="path环境变量的一个案例"><code>PATH</code>环境变量的一个案例</h4>
<ol style="list-style-type: decimal">
<li>创建一个可执行文件 在<code>/mnt/hgfs/biotest</code>这个目录下建立一个<code>test.py</code>文件，输入以下内容：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"></div><div class="line">print(<span class="string">"hello, world"</span>)</div></pre></td></tr></table></figure>
<p>保存，退出。 然后将这个文件权限修改为可执行，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod +x test.py</div></pre></td></tr></table></figure>
<ol start="2" style="list-style-type: decimal">
<li><p>测试相对路径与绝对路径调用 在当前目录下打开客户端，如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;biotest@ubuntu:/mnt/hgfs/biotest$ ./test.py # 相对路径调用</div><div class="line">&gt;hello, world</div><div class="line">&gt;biotest@ubuntu:/mnt/hgfs/biotest$ </div><div class="line">&gt;biotest@ubuntu:/mnt/hgfs/biotest$ cd</div><div class="line">&gt;biotest@ubuntu:/mnt/hgfs/biotest/test.py # 绝对路径调用</div><div class="line">&gt;hello, world</div></pre></td></tr></table></figure></p></li>
<li><p>未添加到环境变量PATH时的情况 此时，<code>test.py</code>文件并没添加到<code>PATH</code>的环境变量中，因此直接输入<code>test.py</code>会出错，如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;biotest@ubuntu:$ test.py</div><div class="line">&gt;test.py: command not found</div></pre></td></tr></table></figure></p></li>
<li><p>将文件的路径添加到环境变量PATH 通过设置PATH环境变量，直接用文件名调用：</p></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;biotest@ubuntu:$export PATH=$PATH:/mnt/hgfs/biotest</div><div class="line">&gt;biotest@ubuntu:$ test.py</div><div class="line">&gt;hello, world</div><div class="line">&gt;biotest@ubuntu:$</div></pre></td></tr></table></figure>
<p>注：在添加路径到环境变量时，用到了<code>export</code>，它的用法是<code>export PATH=$PATH:路径</code>，或<code>export $PATH=&quot;路径”</code></p>
<ol start="5" style="list-style-type: decimal">
<li>永久将文件路径添加到环境变量 此时，将这个客户端关闭，再打开，试着输入<code>test.py</code>，发现出错了，如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;biotest@ubuntu:$ test.py</div><div class="line">&gt;test.py: command not found</div></pre></td></tr></table></figure></li>
</ol>
<p>因为在第4步中，<code>export PATH=$PATH:/mnt/hgfs/biotest</code>只是一种临时添加到环境变量的方法，如果要每次打开客户端时，都能直接执行<code>test.py</code>，则需要将目录添加到.bashrc文件中，步骤如下： 第一，输入<code>biotest@ubuntu:/$ vi ~/.bashrc</code>打开bashrc文件； 第二，移到bashrc文件的最末端，按<code>I</code>，切换到编辑模式，输入<code>export PATH=/mnt/hgfs/biotest:$PATH</code>，再按<code>Esc</code>键，输入<code>wq</code>，回车，退出； 第三，输入<code>source ~/.bashrc</code>，刷新文件，此时，再输入<code>test.py</code>，如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;biotest@ubuntu:$ test.py</div><div class="line">&gt;hello, world</div></pre></td></tr></table></figure></p>
<p>把客户端关闭或者是重启电脑，再次输入<code>test.py</code>也能够执行，用<code>export</code>查看一下环境变量，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/lfJc52FL4H.png?imageslim" alt="mark"> 可以发现，test.py所在的目录在环境变量中。</p>
<p>如果觉得打开<code>~/.bashrc</code>文件，添加环境变量太麻烦了，可以直接在命令行模式下面进行添加，现在将原来的那个test.py文件拷到另外一个目录（<code>~/Downloads</code>）下面，并把文件名字进行修改，改为<code>test2.py</code>，此时输入以下命令即可： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &apos;export PATH=$PATH:~/Downloads&apos;&gt;&gt;~/.bashrc &amp;&amp; source ~/.bashrc</div></pre></td></tr></table></figure></p>
<p>运行过程如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~/Downloads$ ./test2.py #相对路径运行</div><div class="line">hello, world</div><div class="line">biotest@ubuntu:~/Downloads$ echo &apos;export PATH=$PATH:~/Downloads&apos;&gt;&gt;~/.bashrc &amp;&amp; source ~/.bashrc #将路径添加到环境变量，直接运行；；</div><div class="line">biotest@ubuntu:~/Downloads$ test2.py</div><div class="line">hello, world</div></pre></td></tr></table></figure>
<p>通过echo还可以添加alias，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;alias lh=&apos;ls -lh&apos;&quot; &gt;&gt; ~/.bashrc &amp;&amp; source ~/.bashrc</div></pre></td></tr></table></figure>
<p>运行过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180421/0fJGD9KkA1.png?imageslim" alt="mark"></p>
<h3 id="什么是非交互式shell">什么是非交互式shell？</h3>
<p>答：在命令行中输入bash命令，这就是交互式shell，系统执行shell脚本时则是非交互式shell，不同的地方就在于非交互式shell没有命令行提示答。bash shell有一个环境变量即，<code>BASH_ENV</code>环境变量，当shell启动一个非交互式shell进程时，它会检查这个环境变量来查提要执行的启动文件，如果有指定的文件，shell会执行该文件里的命令，这通常包括shell脚本变量设置。这个环境㸄在默认情况下并没有设置，输入<code>printenv BASH_ENV</code>不会返回任何信息。如果BASH_ENV没有设置，shell脚本获取环境变量的过程是这样的：shell脚本是通过启动一个子shell来执行的，子shell可以继承父shell导出过的变量，举例来说，如果父shell是登录shell，在<code>etc/profile</code>、<code>/etc/profile.d/*.sh</code>和<code>$HOME/.bashrc</code>文件中设置并导出了变量，用于执行脚本的子shell就能够继池在这些变量。需要注意的是，父shell设置但并未导出的变量都是局部变量，子shell无法继承局部变量。</p>
<h3 id="什么是数组变量">什么是数组变量？</h3>
<p>答：环境变量有一个很有用的特性就是它们可以作为数组使用，数组是能够储存多个值的变量，这些值可以单独引用，也可以作为整个数组来引物，要给某个环境变量设置多个值，可以把值放在括号里，值与值之间用空格分隔，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">biotest@ubuntu:~$ mytest=(one two three four five)</div><div class="line">biotest@ubuntu:~$ echo $mytest</div><div class="line">one</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[2]&#125;</div><div class="line">three</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[0]&#125;</div><div class="line">one</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[*]&#125;</div><div class="line">one two three four five</div><div class="line">biotest@ubuntu:~$ unset mytest[2]</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[*]&#125;</div><div class="line">one two four five</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[3]&#125;</div><div class="line">four</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[*]&#125;</div><div class="line">one two four five</div><div class="line">biotest@ubuntu:~$ unset mytest</div><div class="line">biotest@ubuntu:~$ echo $&#123;mytest[*]&#125;</div></pre></td></tr></table></figure>
<p>从上面结果可以知道，数组变量有这样的特点：①如果只输入变量的名称，只返回第1个元素的值；②如果要显其余的变量的值，格式为<code>echo ${mytest[n]}</code>，其中n是元素的索引，它是从0开始的，如果要显示全部的内容，需要输入星号（*）；③如果要删除数组变量中间的某个元素，删除后，原变量的索引不变；④</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/04/20/生信-拟南芥转录组项目的实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/20/生信-拟南芥转录组项目的实战/" itemprop="url">拟南芥转录组项目的实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-20T12:00:00+08:00">
                2018-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生信实战项目/" itemprop="url" rel="index">
                    <span itemprop="name">生信实战项目</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,004
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>这是曾健明生物信息教程的第二部分，原始数据位于<code>/public/study/mRNAseq/tair/</code>中，为方便起见，可以添加到系统变量，`alias rnaseq=“cd /public/study/mRNAseq/tair/”``这是一个拟南芥转录组数据，整个流程的操作可看博客：<a href="http://www.bio-info-trainee.com/2809.html" class="uri" target="_blank" rel="external">http://www.bio-info-trainee.com/2809.html</a>。</p>
<h2 id="练习所用数据介绍">练习所用数据介绍</h2>
<p>数据来自于发表在Nature commmunication 上的一篇文章 “<a href="https://www.nature.com/articles/ncomms15120" target="_blank" rel="external">Temporal dynamics of gene expression and histone marks at the Arabidopsis shoot meristem during flowerin</a>”。原文用RNA-Seq的方式研究在开花阶段,芽分生组织在不同时期的基因表达变化。</p>
<p>原文的流程是： TopHat -&gt; SummarizeOverlaps -&gt; Deseq2 -&gt; AmiGO 其中比对的参考基因组为TAIR10 ver.24 ，并且屏蔽了ribosomal RNA regions。 Deseq2只计算至少在一个时间段的FPKM的count &gt; 1 的基因。 数据存放在<a href="http://www.ebi.ac.uk/arrayexpress" class="uri" target="_blank" rel="external">http://www.ebi.ac.uk/arrayexpress</a>/, ID为E-MTAB-5130。</p>
<p>实验设计： 4个时间段（0,1,2,3），分别有4个生物学重复，一共有16个样品。</p>
<h2 id="相关概念">相关概念</h2>
<blockquote>
<p>转录组测序的研究对象为特定细胞在某一功能状态下所能转录出来的所有 RNA 的总和，包括 mRNA 和非编码 RNA 。通过转录组测序，能够全面获得物种特定组织或器官的转录本信息，从而进行转录本结构研究、变异研究、基因表达水平研究以及全新转录本发现等研究。</p>
</blockquote>
<blockquote>
<p>其中，基因表达水平的探究是转录组领域最热门的方向，利用转录组数据来识别转录本和表达定量，是转录组数据的核心作用。由于这个作用，他可以不依赖其他组学信息，单独成为一个产品项目RNA-seq测序。所以很多时候转录组测序会与RNA-seq混为一谈。</p>
</blockquote>
<blockquote>
<p>现在RNA-seq数据使用广泛，但是没有一套流程可以解决所有的问题。比较值得关注的RNA-seq分析中的重要的步骤包括：实验设计，质控，read比对，表达定量，可视化，差异表达，识别可变剪切，功能注释，融合基因检测，eQTL定位等。</p>
</blockquote>
<h3 id="流程如下图所示">流程如下图所示：</h3>
<div class="figure">
<img src="http://www.bio-info-trainee.com/wp-content/uploads/2017/10/overview-of-RNA-seq-technology.png">

</div>
<h2 id="分析流程">分析流程</h2>
<h3 id="第1步下载数据">第1步：下载数据</h3>
<p>由于数据已经放在了服务器，如下所示，不用下载，直接在服务器里面分析，这一步略过。 <img src="http://ortxpw68f.bkt.clouddn.com/01.png"> 这几个数据是： 1. 转录本：Arabidopsis_thaliana.TAIR10.28.cdna.all.fa.gz 2. 基因组：Arabidopsis_thaliana.TAIR10.28.dna.genome.fa.gz 3. 注释文件：Arabidopsis_thaliana.TAIR10.28.dna.genome.fa.gz 4. 注释文件：Arabidopsis_thaliana.TAIR10.28.gtf.gz 5. sample_fastq：测序的原始数据 6. sample_sra：呈交给SRA数据库的数据（解压后就是sample_fastq）</p>
<h3 id="第2步基因定量">第2步：基因定量</h3>
<h4 id="第1种方法salmon方法">第1种方法：salmon方法</h4>
<p><a href="https://combine-lab.github.io/salmon/" target="_blank" rel="external">Salmon软件</a>：对RNA-seq数据进行转录本定量的工具，Salmon使用了一种新的算法（主要是specifically, coupling the concept of quasi-mapping with a two-phase inference procedure），该工具能够快速地进行转录本的定量，并且所耗内存极小。此工具进行运算的过程使用了一种可靠的模型，此模式考虑了实验特性以及RNA-seq中常见的偏倚。</p>
<h5 id="安装并添加环境变量">安装并添加环境变量</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/COMBINE-lab/salmon/releases/download/v0.9.1/Salmon-0.9.1_linux_x86_64.tar.gz</div><div class="line"></div><div class="line">export PATH=$PATH:/trainee/home/jlzhang/download/Salmon-latest_linux_x86_64/bin</div></pre></td></tr></table></figure>
<h5 id="第1步建立索引如下所示">第1步：建立索引，如下所示：</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">salmon index -t Arabidopsis_thaliana.TAIR10.28.cdna.all.fa.gz -i /trainee/home/jlzhang/arab/</div></pre></td></tr></table></figure>
<p>建立索引的过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/0F6d3ae0Ab.png?imageslim" alt="mark"></p>
<p>切换到生成索引的目录<code>/trainee/home/jlzhang/arab/</code>，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/4i9FDihi44.png?imageslim" alt="mark"></p>
<p>注：输出目录要写要自己名下，如果是公共目录，则无权限写入，会出错</p>
<h5 id="第2步数据定量">第2步：数据定量</h5>
<p>salmon不进行比对，直接进行定量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">index = /trainee/home/jlzhang/arab</div><div class="line"># 索引文件夹</div><div class="line">for fn in ERR1698&#123;194..209&#125;;</div><div class="line">do</div><div class="line">    sample=`basename $&#123;fn&#125;`</div><div class="line">    echo &quot;Proicessin sample $&#123;sample&#125;&quot;</div><div class="line">salmon quant -i $index -l A -1 /public/study/mRNAseq/tair/sample_fastq/$&#123;sample&#125;_1.fastq.gz -2 /public/study/mRNAseq/tair/sample_fastq/$&#123;sample&#125;_2.fastq.gz  -p 5 -o quants/$&#123;sample&#125;_quant</div><div class="line">done</div></pre></td></tr></table></figure>
<p>注：上述命名-l A 后面没有“”符号。</p>
<p>运行上述命令，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/4AaHhB7D73.png?imageslim" alt="mark"> 整个过程大概有7分钟，计算结束后，会在quants目录（<code>/trainee/home/jlzhang/quants/ERR1698194_quant</code>）下生成各个样本的目录，以及相应的数据，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/j215KeB9bD.png?imageslim" alt="mark"> 其中<code>quant.sf</code>文件是基因的定量数据，打开，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/7gb25H9cfe.png?imageslim" alt="mark"></p>
<p>为方便查看，用表格表示，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Length</th>
<th>EffectiveLength</th>
<th>TPM</th>
<th>NumReads</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ATMG00010.1</td>
<td>462</td>
<td>299.317</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>ATMG00030.1</td>
<td>324</td>
<td>165.898</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>ATMG00040.1</td>
<td>948</td>
<td>784.352</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>ATMG00050.1</td>
<td>396</td>
<td>234.567</td>
<td>10.33454</td>
<td>13</td>
</tr>
<tr class="odd">
<td>ATMG00060.1</td>
<td>542</td>
<td>378.761</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>ATMG00070.1</td>
<td>573</td>
<td>409.668</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>ATMG00080.1</td>
<td>540</td>
<td>376.77</td>
<td>68.35285</td>
<td>138.1076</td>
</tr>
<tr class="even">
<td>ATMG00090.1</td>
<td>1671</td>
<td>1507.288</td>
<td>0.785473</td>
<td>6.349101</td>
</tr>
<tr class="odd">
<td>ATMG00100.1</td>
<td>73</td>
<td>15.492</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>这于<code>quant.sf</code>文件的说明，在salmon的官网上已经有详细介绍，如下所示：</p>
<ul>
<li>Name — This is the name of the target transcript provided in the input transcript database (FASTA file).</li>
<li>Length — This is the length of the target transcript in nucleotides.</li>
<li>EffectiveLength — This is the computed effective length of the target transcript. It takes into account all factors being modeled that will effect the probability of sampling fragments from this transcript, including the fragment length distribution and sequence-specific and gc-fragment bias (if they are being modeled).</li>
<li>TPM — This is salmon’s estimate of the relative abundance of this transcript in units of Transcripts Per Million (TPM). TPM is the recommended relative abundance measure to use for downstream analysis.</li>
<li>NumReads — This is salmon’s estimate of the number of reads mapping to each transcript that was quantified. It is an “estimate” insofar as it is the expected number of reads that have originated from each transcript given the structure of the uniquely mapping and multi-mapping reads and the relative abundance estimates for each transcript.S</li>
</ul>
<p>翻译成中文就是：</p>
<ul>
<li>Name：这个目标转录组的名称（源于转录组数据库的fasta文件）；</li>
<li>Length：目标转录组的碱基长度；</li>
<li>EffectiveLenght：这是目标转录组的有效长度。它考虑了所有会影响该转录本采样片段概率的因素，其中包括长度分页，序列特异性和GC片段偏好。</li>
<li>TPM：这是salmon对转录本相对丰度的估计，其单位是百分率（TPM，Transcripts Per Million）。TPM可以用于下游的定量分析。</li>
<li>NumReads：salmon对回贴（mapping）到每个转录本的reads数的估计。</li>
</ul>
<p>到这里，用salmon进行定量的过程已经结束，此处并没有进行不同的样本间的差异基因分析。接着看第2种方法进行定量，即用subread进行定量。</p>
<h4 id="第2种方法subread方法">第2种方法：subread方法</h4>
<p>subread是一个reads比对工具。官网是：<a href="http://subread.sourceforge.net/" class="uri" target="_blank" rel="external">http://subread.sourceforge.net/</a></p>
<h5 id="第1步建立索引">第1步：建立索引</h5>
<p>subread构建索引时需要解压fa文件，因此先将服务器中的参考基因组复制到自己的目录下，然后建立索引，如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir index_file</div><div class="line">cp /public/study/mRNAseq/tair/Arabidopsis_thaliana.TAIR10.28.dna.genome.fa.gz  ~/index_file/</div><div class="line">cd index_file</div><div class="line">gunzip Arabidopsis_thaliana.TAIR10.28.dna.genome.fa.gz</div><div class="line">/public/biosoft/subread/subread-1.5.3-Linux-x86_64/bin/subread-buildindex  -o athal_index Arabidopsis_thaliana.TAIR10.28.dna.genome.fa</div></pre></td></tr></table></figure></p>
<p>建立后的文件如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180401/DC3BJcA0II.png?imageslim" alt="mark"></p>
<h5 id="第2步比对">第2步：比对</h5>
<p>建立一个脚本<code>subjunc.sh</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#! /bin/bash</div><div class="line">subjunc=&quot;/public/biosoft/subread/subread-1.5.3-Linux-x86_64/bin/subjunc&quot;; </div><div class="line">index=&apos;/trainee/home/jlzhang/index_file&apos;;</div><div class="line">for fn in ERR1698&#123;194..209&#125;;</div><div class="line">do</div><div class="line">    sample=`basename $&#123;fn&#125;`</div><div class="line">    echo &quot;Processin sample $&#123;sampe&#125;&quot; </div><div class="line">    $subjunc -i $index -r  /public/study/mRNAseq/tair/sample_fastq/$&#123;sample&#125;_1.fastq.gz -R /public/study/mRNAseq/tair/sample_fastq/$&#123;sample&#125;_2.fastq.gz -T 5 -o /trainee/home/jlzhang/quant2/$&#123;sample&#125;_subjunc.bam</div><div class="line">done</div></pre></td></tr></table></figure>
<p>运行，即<code>bash subjunc.sh</code>，这个过程大概需要一段时间，运行结果如下所示：</p>
<h5 id="第3步定量与表达矩阵">第3步：定量与表达矩阵</h5>
<p>用featureCount进行定量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/public/biosoft/subread/subread-1.5.3-Linux-x86_64/bin/featureCounts -T 5 -p -t exon -g gene_name -a /trainee/home/jlzhang/download/Arabidopsis_thaliana.TAIR10.28.gtf -o  counts.txt   *.bam</div></pre></td></tr></table></figure>
<p>注：服务器中的Arabidopsis_thaliana.TAIR10.28.gtf.gz是压缩文件，需要解压后才能使用。</p>
<p>featureCounts的参数：</p>
<ul>
<li>T 多线程，5表示5个线程</li>
<li>p 双端测序</li>
<li>t 默认将Exon作为一个feature</li>
<li>g 从注释文件中提取Meta-features信息用于read coutn，默认是gene_id</li>
<li>a 输入GTF/GFF基因组注释文件</li>
<li>o 输出文件</li>
</ul>
<p>比对后的结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180402/I8cg2DHA9c.png?imageslim" alt="mark"></p>
<h5 id="第4步分组矩阵">第4步：分组矩阵</h5>
<p>构建分组矩阵：</p>
<p><code>/trainee/home/huanggy/RNAseq/data/fastq/E-MTAB-5130.sdrf.txt</code>这个文件如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180403/3Ab775ecI6.png?imageslim" alt="mark"> 其中第1列和第32列都是样本名称，第32列是测序的样本名称，这个有用，第36列则是分组的信息，因此提取分组信息，代码如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail -n +2 /trainee/home/huanggy/RNAseq/data/fastq/E-MTAB-5130.sdrf.txt | cut -f 32,36 |sort -u</div></pre></td></tr></table></figure>
<p><code>sort -u</code>则是表示排序，并去重（这个是双端测序，因此在提取分组信息方面，需要去重），运行完上述代码后，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180403/gI545KkDa7.png?imageslim" alt="mark"></p>
<p>tail -n +2表示是从文件的第2行开始显示文件的内容</p>
<h3 id="第4步其他比对方法">第4步：其他比对方法</h3>
<h1 id="第5步表达矩阵的normalization方法">第5步：表达矩阵的normalization方法</h1>
<blockquote>
<p>总reads数矫正(TC)：基因计数除以与其land相关的回贴的reads数（mapped reads或文库大小），再乘以数据集所有样本的平均总计数。</p>
</blockquote>
<blockquote>
<p>上四分位数(UQ)：与TC在原理上非常相似，在计算归一化因子时，总reads数被不同于0的计数的上四分位数所取代。</p>
</blockquote>
<blockquote>
<p>中位数(MED)：类似于TC，在计算标准化因子时，总reads数由与0不同的中位数计数代替。也就是说，中位数被计算为所有运行的基因计数的中值。</p>
</blockquote>
<blockquote>
<p>DESeq：这种标准化方法包含在DESeq Bioconducter包中，并基于大多数基因不是DE的假设。该方法基于一个负二项分布模型，通过局部回归将方差和均值联系起来，并给出了一个给出标度因子的实现方法。在DESeq包中，使用EstimatateSizeFactorsForMatrixfunction，可以为每次运行计算标度因子。将基因计数除以每个比例因子后，计算DESeq值作为所有运行的重标度基因计数的总和。</p>
</blockquote>
<blockquote>
<p>加权截断均值：TMM（edgeR）：与Deseq类似，在去除高表达基因和差异最大的基因后，TMM也是要找到一个加权系数，使剩余的基因在被矫正后差异倍数可能小。TMM的加权系数是基于两两样本比较后推算获得的（也就是两组样本的比较，将产生与这次比较相关的加权系数）。然后将所有基因除以这个加权系数，从而保证大部分表达量居中的基因表达量最相似。</p>
</blockquote>
<blockquote>
<p>分位数（Q）：首先在微阵列数据的背景下提出，这种标准化方法包括匹配泳道间基因计数的分布。</p>
</blockquote>
<blockquote>
<p>每千碱基每百万映射读取(RPKM)：这种方法最初是为了促进样本中基因之间的比较，并结合样本之间和样本内的标准化。该方法通过归一化总转录物长度和测序读数的数量来量化来自RNA-Seq数据的基因表达。</p>
</blockquote>
<h3 id="第6步差异分析">第6步：差异分析</h3>
<p>在这一步中，作者原博客中直接给出了差异分析的脚本，直接下载即可，脚本文件一共有3个，分别为<code>run_DEG.R</code>,<code>exprSet.txt</code>,<code>group_info.txt</code>，其中<code>run_DEG.R</code>是最主要的脚本文件，它是用R语言写成的,<code>exprSet.txt</code>是所有样本的表达矩阵，这是原始的数据，并没有经过Normalization，<code>group_info.txt</code>是分组信息，直接输入下面的命令即可：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rscript ../run_DEG.R -e exprSet.txt -g group_info.txt -c <span class="string">'Day1-Day0'</span> -s counts  -m DESeq2</div></pre></td></tr></table></figure>
<p>如果是转录组的raw counts数据，就选择 -s counts（这个案例中就是这个选项），如果是芯片等normalization好的表达矩阵数据，用默认参数即可，对于转录组的raw counts数据，有DEseq2包和edgeR包可供选择。对于芯片等normalization好的表达矩阵数据，有limma和t.test供选择，下面是举例说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Rscript run_DEG.R -e airway.expression.txt -g airway.group.txt -c &apos;trt-untrt&apos; -s counts -m DESeq2</div><div class="line"># Rscript run_DEG.R -e airway.expression.txt -g airway.group.txt -c &apos;trt-untrt&apos; -s counts -m edgeR</div><div class="line"># Rscript run_DEG.R -e sCLLex.expression.txt -g sCLLex.group.txt -c &apos;progres.-stable&apos;</div><div class="line"># Rscript run_DEG.R -e sCLLex.expression.txt -g sCLLex.group.txt -c &apos;progres.-stable&apos; -m t.test</div></pre></td></tr></table></figure>
<h3 id="第7步富集分析">第7步：富集分析</h3>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="https://github.com/twbattaglia/RNAseq-workflow" target="_blank" rel="external">Differential Gene Expression using RNA-Seq (Workflow)</a></li>
<li><a href="http://www.bio-info-trainee.com/2809.html" target="_blank" rel="external">一个植物转录组项目的实战</a></li>
<li><a href="http://biocluster.ucr.edu/~rkaundal/workshops/R_mar2016/RNAseq.html" target="_blank" rel="external">NGS sequence analysis with R / Bioconductor: RNA-Seq workflow</a></li>
<li><a href="https://www.jianshu.com/p/7564eca62354" target="_blank" rel="external">基因表达分析（前传）-准备count矩阵</a></li>
<li>http://www.360doc.com/content/17/0921/09/2856980_688849117.shtml</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/31/生信-Jupyter nook主题设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/31/生信-Jupyter nook主题设置/" itemprop="url">Jupyter notebook主题的设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-31T12:00:00+08:00">
                2018-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  422
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近学了一点Python，而Jupyter notebook是一个交互式笔记本，很多Python的命令可以在其中运行，但jupyter的默认主题与字体不好看，网上搜索了一下，发现可以对其进行更改，GitHub上有相应的教程（https://github.com/dunovank/jupyter-themes），现在把怎么修改Jupyter notebook的主题与字体简单地介绍一下。</p>
<h2 id="第一步安装主题">第一步：安装主题</h2>
<p>切换到python的安装目录，即<code>C:\Anaconda3\Scripts</code>下，用pip安装，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># install jupyterthemes</div><div class="line">pip install jupyterthemes</div><div class="line"></div><div class="line"># upgrade to latest version</div><div class="line">pip install --upgrade jupyterthemes</div></pre></td></tr></table></figure>
<h2 id="第二步调整juypter-notebook的参数">第二步：调整juypter notebook的参数</h2>
<p><strong>1. 查看主题</strong></p>
<p>直接在cmd命令行下输入<code>jt -l</code>来相看主题，有这些主题： &gt;chesterish grade3 gruvboxd gruvboxl monokai oceans16 onedork solarizedd solarizedl</p>
<p><strong>2. 选择主题</strong></p>
<p>输入<code>jt -t chesterish</code>选择主题，这里我们选择一个chesterish，新建一个文件，输入<code>print (&quot;hello, python!&quot;)</code>，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/9bDE5f470A.png?imageslim" alt="mark">如果不满意这个主题，想要恢复默认设置，输入<code>jt -r</code>即可。</p>
<p><strong>3. 工具栏设置</strong> 输入<code>jt -t chesterish -T -N</code>可以打开工具窗与文件名称，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/7kfgkm89BF.png?imageslim" alt="mark"></p>
<p><strong>4. 字体设置</strong> 设置主题为Roboto Mono为12pt大小，在cmd下输入<code>jt -t chesterish -f roboto -fs 12</code>，再输入<code>jupyter notebook</code>，查看，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/0D7eJlfaEm.png?imageslim" alt="mark"> 我觉得比原来默认的字体好看了。</p>
<p>后来都试了一遍，觉得主题，字体比较好，如下所示： jt -t chesterish -f roboto -fs 12 jupyter notebook</p>
<h2 id="注可用的字体与主题参数列表">注：可用的字体与主题参数列表</h2>
<table>
<thead>
<tr class="header">
<th>-f 参数</th>
<th>字体名称</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>anka</td>
<td>Anka/Coder</td>
</tr>
<tr class="even">
<td>anonymous</td>
<td>Anonymous Pro</td>
</tr>
<tr class="odd">
<td>aurulent</td>
<td>Aurulent Sans Mono</td>
</tr>
<tr class="even">
<td>bitstream</td>
<td>Bitstream Vera Sans Mono</td>
</tr>
<tr class="odd">
<td>bpmono</td>
<td>BPmono</td>
</tr>
<tr class="even">
<td>code</td>
<td>Code New Roman</td>
</tr>
<tr class="odd">
<td>consolamono</td>
<td>Consolamono</td>
</tr>
<tr class="even">
<td>cousine</td>
<td>Cousine</td>
</tr>
<tr class="odd">
<td>dejavu</td>
<td>DejaVu Sans Mono</td>
</tr>
<tr class="even">
<td>droidmono</td>
<td>Droid Sans Mono</td>
</tr>
<tr class="odd">
<td>fira</td>
<td>Fira Mono</td>
</tr>
<tr class="even">
<td>firacode</td>
<td>Fira Code</td>
</tr>
<tr class="odd">
<td>generic</td>
<td>Generic Mono</td>
</tr>
<tr class="even">
<td>hack</td>
<td>Hack</td>
</tr>
<tr class="odd">
<td>hasklig</td>
<td>Hasklig</td>
</tr>
<tr class="even">
<td>inconsolata</td>
<td>Inconsolata-g</td>
</tr>
<tr class="odd">
<td>inputmono</td>
<td>Input Mono</td>
</tr>
<tr class="even">
<td>iosevka</td>
<td>Iosevka</td>
</tr>
<tr class="odd">
<td>liberation</td>
<td>Liberation Mono</td>
</tr>
<tr class="even">
<td>meslo</td>
<td>Meslo</td>
</tr>
<tr class="odd">
<td>office</td>
<td>Office Code Pro</td>
</tr>
<tr class="even">
<td>oxygen</td>
<td>Oxygen Mono</td>
</tr>
<tr class="odd">
<td>roboto</td>
<td>Roboto Mono</td>
</tr>
<tr class="even">
<td>saxmono</td>
<td>saxMono</td>
</tr>
<tr class="odd">
<td>source</td>
<td>Source Code Pro</td>
</tr>
<tr class="even">
<td>sourcemed</td>
<td>Source Code Pro Medium</td>
</tr>
<tr class="odd">
<td>ptmono</td>
<td>PT Mono</td>
</tr>
<tr class="even">
<td>ubuntu</td>
<td>Ubuntu Mono</td>
</tr>
</tbody>
</table>
<p>主题</p>
<table>
<thead>
<tr class="header">
<th>主题名称</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chesterish</td>
</tr>
<tr class="even">
<td>grade3</td>
</tr>
<tr class="odd">
<td>gruvboxd</td>
</tr>
<tr class="even">
<td>gruvboxl</td>
</tr>
<tr class="odd">
<td>monokai</td>
</tr>
<tr class="even">
<td>oceans16</td>
</tr>
<tr class="odd">
<td>onedork</td>
</tr>
<tr class="even">
<td>solarizedd</td>
</tr>
<tr class="odd">
<td>solarizedl</td>
</tr>
</tbody>
</table>
<h2 id="参考资料">参考资料</h2>
<p>https://github.com/dunovank/jupyter-themes</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/31/生信-生物信息学编程实战-01生信编程思维讲解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/31/生信-生物信息学编程实战-01生信编程思维讲解/" itemprop="url">生物信息学编程实战-01生信编程思维讲解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-31T12:00:00+08:00">
                2018-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  335
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<h2 id="第1题perl提取fastq第1行">第1题：perl提取fastq第1行</h2>
<p>所需要数据：Bowtie2软件中自带的数据，先安装 <a href="https://sourceforge.net/projects/bowtie-bio/files/latest/download?source=files" target="_blank" rel="external">Bowtie</a>，解压此软件，里面有个文件夹/example/reads，含有几个数据，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/35c9A6dkfJ.png?imageslim" alt="mark"></p>
<p>查看一下longreads.fq文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/db5lCJi7Dd.png?imageslim" alt="mark"> longread.fq文件是一个fastq文件，在fastq文件中，序列一般都包含4行。</p>
<h3 id="什么是fastq格式">什么是fastq格式</h3>
<p>FastQ格式是序列格式中常见的一种，fastq文件的第一行由’@‘开始，后面跟着序列的描述信息，这点跟FASTA格式是一样的。第二行是序列。第三行由’+’开始，后面也可以跟着序列的描述信息。第四行是第二行序列的质量评价（quality values，注：应该是测序的质量评价），字符数跟第二行的序列是相等的，在这个案例中，即使在linux的命令行中第二行显示为多行，它也是一行（只是为了方便查看，这一行太长，进行了换行，其它还是一行），一个标准的fastq格式文件如下所示：</p>
<blockquote>
<p><span class="citation">@EAS54_6_R1_2_1_413_324</span> CCCTTCTTGTCTTCAGCGTTTCTCC + ;;3;;;;;;;;;;;;7;;;;;;;88 <span class="citation">@EAS54_6_R1_2_1_540_792</span> TTGGCAGGCCAAGGCCGATGGATCA + ;;;;;;;;;;;7;;;;;-;;;3;83 <span class="citation">@EAS54_6_R1_2_1_443_348</span> GTTGCTTCTGGCGTGGGTGGGGGGG +EAS54_6_R1_2_1_443_348 ;;;;;;;;;;;9;7;;.7;393333</p>
</blockquote>
<p>现在提取longreads.fq文件中第个序列的第一行，即@符号所在的那一行，代码为<code>perl -alne '{print if $.%4==1}' longreads.fq |head</code>，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180331/IG0IL9eLad.png?imageslim" alt="mark"></p>
<h2 id="参考资料">参考资料：</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/30/生信-有关测序的数据储存问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/30/生信-有关测序的数据储存问题/" itemprop="url">有关测序的数据储存问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-30T12:02:00+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,858
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>现在的高通量测序仪产生的数据量很大，在看相关的文章的时候，经常弄不清楚测序的数据量与碱基之间的关系，有的表示为碱基数目，有的表示为计算机的储存单位，现在总结一下。</p>
<h2 id="计算机的储存单位">计算机的储存单位</h2>
<p>计算机最底层是用0和1来储存的，计算机中的数据就是0和1的集合，我们看下面的一个二进制文件。<img src="http://ortxpw68f.bkt.clouddn.com/professional/180425/hlhI4bLjfd.jpg?imageslim" alt="mark"></p>
<p>对于计算机数据来说，在它们的储存器中，最小的存储单元只能是2种状态，要么是0，要么是1，我们就把这个最基本的储存单元叫做bit，bit也就是计算机中储存数据最小的单位。但bit太小了，一个bit最多只能储存2个信号，即0或1。我们把8个bit称为1个字节（Byte），1个字节可以储存2的8次方，即256种信息，用于储存英文字母来说足够了，其实就是ASCII码的基础。由于汉字比较多，1个汉字通常占用2个字节，多数情况下，我们所说的基本储存单位，都是以字节（B，大写的B常指字节，小写的b指bit），为了方便描述储存空间，还有更大的储存单位，那就是1KB=1024B（1KB通常就叫1千字节），1MB=1024KB（MB通常叫兆字节，也就是100万），1GB=1024MB，1TB=1024GB，等等。</p>
<h2 id="文本文件与二进制文件的存储">文本文件与二进制文件的存储</h2>
<p>文本文件其实在本质也是二进制文件，计算机中储存的所有信息，最终都是转换为以0或1为基础的二进制储存方式。以碱基序列为例说明一下，先看一个文本文件，新建一个名叫<code>base.txt</code>的文本文件，输入ATGC这四个字母，保存，右键属性，可以发现这个文本文件所占的储存空间为4KB，也就是4个字节，但ATGC在计算机中并不是直接储存为ATGC的，而是最终以01这形式进行储存的。</p>
<h2 id="以人类基因组为例说明文本文件">以人类基因组为例说明文本文件</h2>
<p>知乎上有这个样问题，即<a href="https://www.zhihu.com/question/21672220/answer/19590442" target="_blank" rel="external">!人体30亿个碱基对的基因组，容量有多少兆？</a>，下面的回答很好，这里汇总如下：</p>
<p>人类有30亿个碱基对，而碱基只有4种形式，即ATGC，虽然一个碱基对是2个碱基，但是由于DNA的结构特征，在整个碱基对中，G与C配对，A与T配对，在储存测序文件时，只需储存一条链，另外一条链就能互补出来。如果以文本文件储存这30亿个碱基对的话，就需要3000000000个字节，即3GB，注意，这里的GB是指计算机的储存空间，但是这样储存起来比较耗费计算机空间，因为在序列信息方面，只有ATGC这个信息，在文本文件储存时，一个字母就是1个字节，1个字节是8个bit，1个bit可以表示2种信息，即0或1，而2个bit可以表示4种信息，即00，01，10，11，因此仅储存ATGC的话，只需要2个bit就可以了，因此算法学家开发出了压缩碱基信息的算法，可以将文本文件形式的碱基进行压缩，这样的话，用2个bit就能表示1个碱基，30亿个碱基就可以被压缩为3000000000×2 bit/8=750000000个字节了，此时这个0与1还是以文本形式进行储存的，所占空间为750M，这样压缩的目的就在于节约储存空间。现在的话，如果我们测了一批人类基因组的信息，需要与标准基因组进行比对，而压缩的人类参考基因组是750M的0，1字符的文件，肯定不能直接比对，这就需要解压缩，将750M的参考基因组再解压为ATGC的形式，就行了，解压后的文件就成了3GB。</p>
<p>如果不太好理解，可以再举个例子，如果我们有一幅高清的图片，10M，要发给某个人看，如果采用压缩的方式，例如采用WinRAR这个工具来压缩，压缩成了6M，通过邮件发给某人，某人拿到后，用看图软件肯定无法直接打开，他就可以解压缩，将这个6M的文件再解压为10M，就能查看了，这个过程经历了：压缩-解压的过程。而人类基因组的参考序列的压缩原理也是如此，只是它的压缩工具不是WinRAR，是另外的压缩工具，这样做的目的在于节约储存空间。</p>
<h2 id="常见的序列储存单位汇总">常见的序列储存单位汇总</h2>
<p>现在还有一种情况，我们在测序时，生成的信息不可能只有ATGC这样的碱基序列，还有其他的信息，例如reads的位置，质量值等等，现在看一个例子。</p>
<blockquote>
<p>Aggarwal P, Turner A, Matter A, et al. RNA Expression Profiling of Human iPSC-Derived Cardiomyocytes in a Cardiac Hypertrophy Model[J]. Plos One, 2014, 9(9):e108051.</p>
</blockquote>
<p>这篇文献测了一批miRNA-seq，找到其中的一个实验，编号为SRR1542716，在SRA中的信息如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180425/jIcFkfA531.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>从这个表中可以知道，实验的编号为SRR1542716，Spots是read数目，Bases是碱基的数目（后缀是bp是通常是指碱基数目，如果只是M，则通常表示储存空间），Size是压缩后的储存空间，后面的信息就省略了。read数目是2.8M，最下面的绿色长条是reads的统计数据，reads的长度是20bp，2.8M × 20 = 56M个碱基，理论上，这56个碱基所占的储存空间为：56M × 1B = 56M。而SRA数据库中的文件是测序后的数据fastq文件的压缩文件，现在把SRR1542716这个文件下载后，需要解压才能得到最初始的测序文件，即fastq格式的文件，解压后的文件为SRR1542716.fastq，所占空间 为366M，现在查看一下这个文件，用<code>head -5 SRR1542716.fastq</code>命令即可，只查看前5行，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@SRR1542716.1 FFVW0:02077:02655 length=24</div><div class="line">TGGGATGTAGTAGGTTGTATAGTT</div><div class="line">+SRR1542716.1 FFVW0:02077:02655 length=24</div><div class="line">+566&gt;==99;7&lt;7&lt;BCBCCC&lt;</div><div class="line">@SRR1542716.2 FFVW0:01819:00311 length=16</div></pre></td></tr></table></figure>
<p>这是fastq文件的格式，它的具体含义如下所示：</p>
<p>第1行：序列标识以及相关的描述信息，以‘@’开头。这里的第1行是<code>@SRR1542716.1 FFVW0:02077:02655 length=24</code>，握住的信息为reads编号，FFVW0:02077:02655这个可能是位置信息，read长度，即length=24;</p>
<p>第2行：序列，这个容易理解。</p>
<p>第3行，以+形状，与第1行一样，是序列标示符，描述信息，不过有的测序仪生成的fastq文件此行信息。</p>
<p>第4行，质量信息，这第2行的序列信息相对应，每个碱基都有一个质量评分，根据评分体系的不同，每个字符的含义表示的数字也不同。</p>
<p>第5行，这是另外的一条read。</p>
<p>从fastq的这个文件中我们可以得出以下信息：</p>
<ol style="list-style-type: decimal">
<li>测序文件的文本中，含有的信息量不仅仅是测序的碱基信息，还有其他的信息；</li>
<li>测序文件所占的空间要大于只有碱基的文本文件所占的空间。</li>
</ol>
<p>这里，我们复制前4行到一个文本文件里，命名为<code>seq_file.txt</code>，右键查看一下，发现空间为133字节（即133B）。再把序列信息，即只有第2行的信息复制到一个文本文件里，命名为<code>seq_base.txt</code>，右键查看一下属性，发现空间为24B，测序文件的信息是碱基信息的133/24=5.5倍，这也就不难理解，为什么SRR1542716中碱基数目的信息大概是56M，而实际的测序fastq文件是366M了（后者大概是前者的6.5倍），因为fastq文件中储存的信息要高于仅储存碱基序列的信息。</p>
<h2 id="测序深度与reads的计算">测序深度与reads的计算</h2>
<p>对于测序深度，reads的计算，以及相关的数据量不太清楚，找了一个篇文章，源于公众号“嘉因”，后方有链接。</p>
<blockquote>
<p>Sequencing depth. The amount of sequencing needed for a given sample is determined by the goals of the experiment and the nature of the RNA sample. Experiments whose purpose is to evaluate the similarity between the transcriptional profiles of two polyA+ samples may require only modest depths of sequencing (e.g. 30M pair-end reads of length &gt; 30NT, of which 20-25M are mappable to the genome or known transcriptome, Experiments whose purpose is discovery of novel transcribed elements and strong quantification of known transcript isoforms requires more extensive sequencing. The ability to detect reliably low copy number transcripts/isoforms depends upon the depth of sequencing and on a sufficiently complex library. For experiments from a typical mammalian tissue or in which sensitivity of detection is important, a minimum depth of 100-200 M 2 x 76 bp or longer reads is currently recommended. [Specialized studies in which the prevalence of different RNAs has been intentionally altered (e.g. “normalizing” using DSN) as part of sample preparation need more than the read amounts (&gt;30M paired end reads) used for simple comparison (see above). Reasons for this include: (1) overamplification of inserts as a result of an additional round of PCR after DSN and (2) much more broad coverage given the nature of A(-) and low abundance transcripts.</p>
</blockquote>
<p>上述文字翻译如下： <strong>根据研究目的决定测序深度：</strong> 目的1：通过抓取polyA尾建库（只测那些带有polyA尾巴的基因，大多是蛋白编码基因），寻找样品间基因转录谱的相似性，只需要30M reads，长度大于30nt即可，双端测序，其中20-25M能够回帖(map)到已知转录组上。 目的2：要发现新的转录本，对已知isoform（同一基因由于不同的可变剪接方式形成多种isoform，勉强译为亚型）进行定量分析，兼顾低表达量的转录本或isoform，就需要100-200M read，长度大于76bp，双端测序。 注：ENCODE测的是人和小鼠，其他物种不包括在此推荐范围内。</p>
<h2 id="reads数的相关计算">reads数的相关计算</h2>
<p>测序深度或者覆盖度（coverage or depth）是指参考序列一个碱基上比对的reads的数目。</p>
<p>计算公式为：测序深度 = reads长度 × 比对的reads数目 / 参考序列长度</p>
<h3 id="mirna测序">miRNA测序</h3>
<p>miRNA测序只需要10M read，每条read长50bp，单端测序，下面是一些测序公司的数据量：</p>
<table>
<colgroup>
<col width="26%">
<col width="16%">
<col width="47%">
<col width="9%">
</colgroup>
<thead>
<tr class="header">
<th>Sequencer</th>
<th>Strategy</th>
<th>Sequencing deep</th>
<th>Company</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Illumina HiSeqTM 2500</td>
<td>SE50</td>
<td>General deep:8Mclean reads High deep:15M clean Reads</td>
<td>南京迪康金诺</td>
</tr>
<tr class="even">
<td>Illumina HiSeq™ 2500</td>
<td>SE36</td>
<td>18.9~28.2M</td>
<td>百迈客</td>
</tr>
<tr class="odd">
<td>Illumina</td>
<td>SE50bp</td>
<td>10M reads/sample</td>
<td>美吉生物</td>
</tr>
<tr class="even">
<td>HiSeq 2500</td>
<td>SE50</td>
<td>General deep:6~10M clean reads High deep:15～20M clean Reads read/sample</td>
<td>诺禾致源</td>
</tr>
<tr class="odd">
<td></td>
<td>SE36 OR SE50</td>
<td>General deep:10M reads High deep：20M reads</td>
<td>阅微基因</td>
</tr>
</tbody>
</table>
<h3 id="reads的转换都是碱基数目不是储存空间">reads的转换（都是碱基数目，不是储存空间）</h3>
<p><strong>1. 双端测序换算</strong> PE150或2×150，即双端测序，每条read长度150bp。 150bp×2端 × read数 = 数据量 例如，测50M read，150bp X 2端 X 50M read = 15000M = 15G（这个G表示的是碱基长度bp，而不是计算机的储存单位GB）。</p>
<p><strong>2. 单端测序换算</strong> SE50或1×50，即单端测序，每条read长度50bp。 50bp ×1端 × read数 = 数据量 例如，测20M read，50bp ×1端 × 20M read = 1000M = 1G</p>
<p><strong>3. 测序仪的数据量换算</strong> 有空补充，现在还没弄明白。</p>
<h3 id="一个问题计算多少条reads">一个问题：计算多少条reads？</h3>
<p><strong>问题描述：RNA-Seq数据，101bp大小。测序公司给我1.5G数据，大约有多少reads？</strong> 答：按照PE测序101和1.5Gbp计算，就是1.5<em>10^9/100=1.5</em>10^7（条reads）=15M条</p>
<p>参考资料 <a href="https://mp.weixin.qq.com/s?src=3&amp;timestamp=1522379641&amp;ver=1&amp;signature=lQd0Tcylwm7fYuKVfGOA8Sl5fp00Y81iT1ao23U6PMfPxIUMWq054KP9EwYtYz9BbVpCEhLQ7kGm7-lQgi5JQd0SxNVa0b*kr7GZ2o2TRzBp2v7sPAu79z3VVkKZHF4xj8nWsM73Nx*ZeJLAx6vI*9GnmYrztfU8FwVXLxlGAaE=" target="_blank" rel="external">测多少数据量？几个G？多少reads？如何换算？</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/28/生信-Linux学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/28/生信-Linux学习笔记/" itemprop="url">Linux学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T12:00:00+08:00">
                2018-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,647
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>这个教程源于曾健明，<a href="http://www.bio-info-trainee.com/2900.html" target="_blank" rel="external">题库地址为其博客</a>。所使用的Linux系统是曾健明的服务器，服务器信息如下： 1. <code>/usr/local/bin/miniconda3/bin</code>路径下面安装了生物信息学软件，可以使用全路径调用它们，或者添加该目录到环境变量。 2. 两个练手数据： 2.1 转录组数据：<code>/public/study/mRNAseq/tair/</code>的转录组的测试数据，具体教程可以看其博客：<a href="http://www.bio-info-trainee.com/2809.html" class="uri" target="_blank" rel="external">http://www.bio-info-trainee.com/2809.html</a>，可以用<code>ls -lh  --color=auto /public/study/mRNAseq/tair/</code> 命令查看，然后所有的处理，在自己的目录处理，不需要拷贝那些数据. 2.2 找变异：<code>/public/study/variant-calling/tair</code>。 可以参见教程：<a href="http://www.biotrainee.com/thread-696-1-1.html" class="uri" target="_blank" rel="external">http://www.biotrainee.com/thread-696-1-1.html</a></p>
<p>其他的NGS流程，参见Github：<a href="https://github.com/jmzeng1314/NGS-pipeline" class="uri" target="_blank" rel="external">https://github.com/jmzeng1314/NGS-pipeline</a>。</p>
<h2 id="基础知识">基础知识</h2>
<h3 id="基础知识-1">基础知识</h3>
<h3 id="文件目录操作">文件目录操作</h3>
<ol style="list-style-type: decimal">
<li>查看当前目录<code>pwd</code> <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/AKEdmBFIIH.png?imageslim" alt="mark"></li>
</ol>
<h3 id="系统管理">系统管理</h3>
<p>1.查看当前登录用户<code>w</code> <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/7fA66bCmEk.png?imageslim" alt="mark"></p>
<p>2.查看命令历史<code>l~/.bash_history</code> Bash shell在“~/.bash_history”（“~/”表示用户目录）文件中保存了500条使用过的命令，这样可以使你输入使用过的长命令变得容易。每个在系统中拥有账号的用户在他的目录下都有一个“.bash_history”文件。</p>
<h3 id="用户权限">用户权限</h3>
<h3 id="文本操作">文本操作</h3>
<h2 id="题库测试">题库测试</h2>
<p><strong>1. 在任意文件夹下面创建形如 1/2/3/4/5/6/7/8/9 格式的文件夹系列。</strong></p>
<p><code>mkdir -p 1/2/3/4/5/6/7/8/9</code> mkdir是建立文件夹命名，添加<code>-p</code>参数可以直接创建多级文件夹，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/8ki0H89cfC.png?imageslim" alt="mark"></p>
<p><strong>2.在创建好的文件夹下面，比如我的是 /Users/jimmy/</strong>tmp/1/2/3/4/5/6/7/8/9 ，里面创建文本文件 me.txt</p>
<p>先切换到/1/2/3/4/5/6/7/8/9，直接输入<code>cd</code>，然后不停地按<code>Tab</code>键，就会进入下一层文件夹。 <code>touch me.txt</code>创建txt文件。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/AAeBcaD17A.png?imageslim" alt="mark"></p>
<p><strong>3.在文本文件 me.txt 里面输入内容:</strong> Go to: http://www.biotrainee.com/ I love bioinfomatics. And you ?</p>
<p>输入<code>vim me.txt</code>，输入上述文字，然后按<code>Esc</code>键，输入<code>wp</code>退出。</p>
<p><strong>4. 删除上面创建的文件夹 1/2/3/4/5/6/7/8/9 及文本文件 me.txt</strong></p>
<p><code>rm -rf *</code></p>
<p><strong>5. 在任意文件夹下面创建 folder1~5这5个文件夹，然后每个文件夹下面继续创建 folder1~5这5个文件夹，效果如下：</strong></p>
<p><code>mkdir -p folder_{1..5}/folder_{1..5}</code> 如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/b9EHafGmmE.png?imageslim" alt="mark"></p>
<p><strong>6. 在第五题创建的每一个文件夹下面都 创建第二题文本文件 me.txt ，内容也要一样。</strong></p>
<p>先创建一个tmp3目录，其目录下有5个文件夹，5个文件夹下面又有5个文件夹，然后将me.txt拷贝到这25个文件夹中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p tmp3/folder_&#123;1..5&#125;/folder_&#123;1..5&#125;</div><div class="line">echo tmp3/folder_&#123;1..5&#125;/folder_&#123;1..5&#125; | xargs -n 1 cp -v me.txt</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/jggF50km1I.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>7. 再次删除掉前面几个步骤建立的文件夹及文件。</strong> <code>rm -rf *</code></p>
<p><strong>8. 下载 http://www.biotrainee.com/jmzeng/igv/test.bed 文件，后在里面选择含有 H3K4me3 的那一行是第几行，该文件总共有几行。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://www.biotrainee.com/jmzeng/igv/test.bed</div><div class="line">grep -n &quot;H3K4me3&quot; test.bed</div><div class="line">wc test.bed</div></pre></td></tr></table></figure>
<p>结果如下： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/6J951D225C.png?imageslim" alt="mark"> 可知，H3K4me3在第8行，用Notepad++打开的话，核对一下，确实如此。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/CmBJ842fB1.png?imageslim" alt="mark"> 用<code>wc</code>命令查看有多少行，一共10行。</p>
<p><strong>9. 下载 http://www.biotrainee.com/jmzeng/rmDuplicate.zip 文件，并且解压，查看里面的文件夹结构</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://www.biotrainee.com/jmzeng/rmDuplicate.zip</div><div class="line">unzip rmDuplicate.zip</div><div class="line">cd rmDuplicate.zip</div></pre></td></tr></table></figure>
<p>查看文件： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/d87Hd2LjLm.png?imageslim" alt="mark"></p>
<p><strong>10. 打开第九题解压的文件，进入 rmDuplicate/samtools/single 文件夹里面，查看后缀为 .sam 的文件，搞清楚 生物信息学里面的SAM/BAM 定义是什么。</strong> <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/2EhCCfda4e.png?imageslim" alt="mark"></p>
<p><strong>SAM文件与BAM文件</strong> &gt; SAM是一种序列比对格式标准， 由sanger制定，是以TAB为分割符的文本格式。主要应用于测序序列mapping到基因组上的结果表示，当然也可以表示任意的多重比对结果。</p>
<blockquote>
<p>SAM要处理好的问题：</p>
</blockquote>
<blockquote>
<p>非常多序列（read)，mapping到多个参考基因组（reference）上； 同一条序列，分多段（segment）比对到参考基因组上； 无限量的，结构化信息表示，包括错配、删除、插入等比对信息； SAM分为两部分，注释信息（header section）和比对结果部分（alignment section），注释信息可有可无，都是以@开头，用不同的tag表示不同的信息，主要有@HD，说明符合标准的版本、对比序列的排列顺序；<span class="citation">@SQ</span>，参考序列说明；<span class="citation">@RG</span>，比对上的序列（read）说明；<span class="citation">@PG</span>，使用的程序说明；<span class="citation">@CO</span>，任意的说明信息。</p>
</blockquote>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/h0kI4HLFg8.jpg?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<blockquote>
<p>比对结果部分（alignment section），每一行表示一个片段（segment）的比对信息，包括11个必须的字段（mandatory fields）和一个可选的字段，字段之间用tag分割。必须的字段有11个，顺序固定，不可用时，根据字段定义，可以为’0‘或者’*‘，这是11个字段包括：</p>
</blockquote>
<blockquote>
<p>QNAME，比对片段的（template）的编号； FLAG，位标识，template mapping情况的数字表示，每一个数字代表一种比对情况，这里的值是符合情况的数字相加总和； RNAME，参考序列的编号，如果注释中对SQ-SN进行了定义，这里必须和其保持一致，另外对于没有mapping上的序列，这里是’<em>‘； POS，比对上的位置，注意是从1开始计数，没有比对上，此处为0； MAPQ，mappint的质量； CIGAR，简要比对信息表达式（Compact Idiosyncratic Gapped Alignment Report），其以参考序列为基础，使用数字加字母表示比对结果，比如3S6M1P1I4M，前三个碱基被剪切去除了，然后6个比对上了，然后打开了一个缺口，有一个碱基插入，最后是4个比对上了，是按照顺序的； RNEXT，下一个片段比对上的参考序列的编号，没有另外的片段，这里是’</em>‘，同一个片段，用’=‘； PNEXT，下一个片段比对上的位置，如果不可用，此处为0； TLEN，Template的长度，最左边得为正，最右边的为负，中间的不用定义正负，不分区段（single-segment)的比对上，或者不可用时，此处为0； SEQ，序列片段的序列信息，如果不存储此类信息，此处为’*‘，注意CIGAR中M/I/S/=/X对应数字的和要等于序列长度； QUAL，序列的质量信息，格式同FASTQ一样。 可选字段（optional fields)，格式如：TAG:TYPE:VALUE，其中TAG有两个大写字母组成，每个TAG代表一类信息，每一行一个TAG只能出现一次，TYPE表示TAG对应值的类型，可以是字符串、整数、字节、数组等。</p>
</blockquote>
<p><strong>11. 安装 samtools 软件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mkdir soft</div><div class="line">cd soft</div><div class="line">wget https://github.com/samtools/samtools/releases/download/1.7/samtools-1.7.tar.bz2</div><div class="line">tar jxvf samtools-1.7.tar.bz2</div><div class="line">cd samtools-1.7/</div><div class="line">./configure --prefix=/trainee/home/jlzhang/biosoft</div><div class="line">make</div><div class="line">make install</div><div class="line">export PATH=$PATH:/trainee/home/jlzhang/biosoft/bin:$PATH &gt;&gt;~/.bashrc</div><div class="line">source ~/.bashrc</div></pre></td></tr></table></figure>
<p>可以通过<code>echo $PATH</code>来查看用户变量。</p>
<p><strong>12. 打开 后缀为BAM 的文件，找到产生该文件的命令。</strong></p>
<p>用samtools view打开BAM文件，过程如下：</p>
<p>进入相应文件夹，即<code>samtools view tmp.rmdup.bam | head</code> 输入命令：<code>samtools view tmp.rmdup.bam | head</code> 打开后的BAM文件如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180328/I2gIbJihKE.png?imageslim" alt="mark"></p>
<p><strong>13. 根据上面的命令，找到我使用的参考基因组 /home/jianmingzeng/reference/index/bowtie/hg38 具体有多少条染色体。</strong> 从网上找到的信息，hg38含有24条染色体，统计代码如下所示：</p>
<p>先找到hg38.fa文件，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">locate hg38.fa</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/cf45ebk16a.png?imageslim" alt="mark"> 随便挑一个进行统计，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grep &quot;chr[1-9,X,Y]&quot; /umac/reference/genome/hg38/hg38.fa| cut -d_ -f1 &gt; statistic.chrom</div><div class="line">sort statistic.chrom | uniq | wc</div></pre></td></tr></table></figure>
<p>可以发现，hg38有24条染色体，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/HGHLBKhlEK.png?imageslim" alt="mark"></p>
<p>其中,sort是对文本文件中的字符进行排序，uniq是去掉重复的行，但是uniq只能去掉相邻的重复行，因此之前要进行sort。</p>
<p><strong>14. 上面的后缀为BAM 的文件的第二列，只有 0 和 16 两个数字，用 cut/sort/uniq等命令统计它们的个数。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">samtools view tmp.rmdup.bam &gt; bamfile</div><div class="line">awk &apos;&#123;print $2&#125;&apos; bamfile &gt; zero_one</div><div class="line">grep -o &quot;0&quot; zero_one |wc -l</div><div class="line">grep -o &quot;16&quot; zero_one |wc -l</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/cbj6hmgGGB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>15. 重新打开 rmDuplicate/samtools/paired 文件夹下面的后缀为BAM 的文件，再次查看第二列，并且统计</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">samtools view tmp.rmdup.bam &gt; pairbam</div><div class="line">awk &apos;&#123;print $2&#125;&apos; pairbam &gt; number </div><div class="line">awk &apos;&#123;print $2&#125;&apos; pairbam |sort|uniq -c</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/KDd1bmlk0F.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>16. 下载 http://www.biotrainee.com/jmzeng/sickle/sickle-results.zip 文件，并且解压，查看里面的文件夹结构， 这个文件有2.3M，注意留心下载时间及下载速度。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://www.biotrainee.com/jmzeng/sickle/sickle-results.zip</div><div class="line">ls -lh</div><div class="line">unzip sickle-results.zip</div><div class="line">cd sickle-results</div><div class="line">ls -lh</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/096904lAFg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>17. 解压 sickle-results/single_tmp_fastqc.zip 文件，并且进入解压后的文件夹，找到 fastqc_data.txt 文件，并且搜索该文本文件以 &gt;&gt;开头的有多少行？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd sickle-results</div><div class="line">unzip single_tmp_fastqc.zip</div><div class="line">cd single_tmp_fastqc</div><div class="line">grep &quot;&gt;&gt;&quot;  fastqc_data.txt |wc -l</div></pre></td></tr></table></figure>
<p>一共是24行 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/2hChiFB4FK.png?imageslim" alt="mark"></p>
<p><strong>18. 下载 http://www.biotrainee.com/jmzeng/tmp/hg38.tss 文件，去NCBI找到TP53/BRCA1等自己感兴趣的基因对应的 refseq数据库 ID，然后找到它们的hg38.tss 文件的哪一行。 https://www.ncbi.nlm.nih.gov/gene/7157</strong></p>
<ol style="list-style-type: decimal">
<li>打开PUBMED，选GENE，输入“TP53”，点击Search，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/hE93c3HKlH.png?imageslim" alt="mark"></li>
</ol>
<p>Pubmed中有很多TP53的信息，但是hg38是人类基因组，因此选择第一行的TP53就行，进入即可，找到Go to reference sequence details，点进去即可，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/f5K40hH9mh.png?imageslim" alt="mark"></p>
<p>找到Go to reference sequence details，进去，其中有NM开头的编号，NM表示mRNA的RefSeq，TP53的就是NM_00054635（小数点部分是版本号，不用管），在hg38.tss中查询即可，BRCA1按照同样操作，查询结果如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://www.biotrainee.com/jmzeng/tmp/hg38.tss</div><div class="line">grep &quot;NM_000546&quot; hg38.tss </div><div class="line">grep &quot;NM_005905&quot; hg38.tss</div></pre></td></tr></table></figure></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/Ih5GL0fIAb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>19. 解析hg38.tss 文件，统计每条染色体的基因个数。</strong></p>
<p>hg38.tss文件是基因的坐标，查看了一下文件，文件内容如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/20jK2DK3Kl.png?imageslim" alt="mark"></p>
<p>第1列是基因名称，第2列是染色体名称，第3列到第4列是转录起止坐标，第5列不清楚。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">awk &apos;$5 &gt; 0&apos; hg38.tss &gt; gene2</div><div class="line">awk &apos;&#123;print $2&#125;&apos; gene2 &gt; gene</div><div class="line">cut -d_ -f1 gene |sort |uniq -c</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180329/gHHAJ0II9A.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><strong>20. 解析hg38.tss 文件，统计NM和NR开头的序列，了解NM和NR开头的含义。</strong></p>
<p>没在hg38.tss文件里找到相应的序列，只找到了名称，提取NM和NR开头的名称命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grep &quot;NM&quot; hg38.tss</div><div class="line">grep &quot;NR&quot; hg38.tss</div></pre></td></tr></table></figure>
<p>NM，mRNA mixed，转录组产物序列；成熟mRNA转录本序列。 NR，RNA mixed，非编码的转录子序列，包括结构RNAs，假基因转子等。</p>
<p>参考资料： 1. <a href="http://boyun.sh.cn/bio/?p=1890" target="_blank" rel="external">博耘生物</a> 2. <a href="http://blog.sina.com.cn/s/blog_72512a1d0102xp6f.html" target="_blank" rel="external">NCBI中编号/编码说明</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/20/生信-转录组数据分析入门实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/生信-转录组数据分析入门实战/" itemprop="url">生信技能树转录组数据分析入门实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T12:00:00+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,460
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>这是根据“思考问题的熊“的课程《生信技能树转录组数据分析入门实战》进行整理的，课程信息如下所示： ### 课程题目： 生信技能树转录组数据分析入门实战</p>
<h3 id="课程时间">课程时间：</h3>
<h3 id="课程内容">课程内容：</h3>
<ol style="list-style-type: decimal">
<li>课程介绍</li>
<li>Linux操作技巧</li>
<li>生物信息软件安装</li>
<li>转录组分析整体思路</li>
<li>转录组数据预处理</li>
<li>转录组数据序列比对</li>
<li>转录组数据表达定量</li>
<li>转录组数据差异分析</li>
</ol>
<h3 id="所用数据如下所示">所用数据，如下所示：</h3>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/aJC86iIddm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="二inux操作技巧">（二）inux操作技巧</h3>
<h4 id="linux常用客户端">Linux常用客户端</h4>
<p>Xshell：用于登录远程服务器。 Putty：用于登录远程服务器。 WInSCP：用于下载服务器文件。</p>
<h4 id="linux命名">Linux命名</h4>
<p>这个比较基础，略过，只讲一个alias alias用于缩简一些命令，例如这次的练习数据我放在了<code>/mnt/hgfs/biotest/rnaseq/</code>这个目录下，每次都输入都太麻烦了，因此可以使用alias命名进行添加，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd #进行主目录</div><div class="line">vim .bashrc # 进入bashrc文件</div></pre></td></tr></table></figure>
<p>在.bashrc文件中添加如下字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias wp=&apos;cd /mnt/hgfs/biotest/rnaseq/&apos;</div></pre></td></tr></table></figure>
<p>保存并退出，其中需要注意的是等号两边不要有空格，否则会出错。 此时直接输入wp就可以直接进行目录。</p>
<h3 id="三生物信息软件安装">（三）生物信息软件安装</h3>
<p>主要是利用conda进行安装，比较简单，详细的教程可以参照<a href="https://zhuanlan.zhihu.com/p/25085567" target="_blank" rel="external">青山屋主的教程</a>，这个是我看到的比较好的教程。</p>
<h3 id="四转录组分析整体思路">（四）转录组分析整体思路</h3>
<p>作者回顾了一下以前的思路，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/21cLF9i3Jl.png?imageslim" alt="mark"></p>
<p>大图如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/hkA5ea79cL.png?imageslim" alt="mark"></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/01gdAhELCi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/j2mj3L2d84.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="五转录组数据预处理">（五）转录组数据预处理</h3>
<h4 id="数据介绍">数据介绍</h4>
<p>按照作者教程中的文件夹整理了所要分析的数据，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/0jIb80EBL8.png?imageslim" alt="mark"></p>
<p>现在解释一下这几个文件夹，其中： 1. <code>00ref</code>存放的是参考基因组文件（fasta格式）和注释信息（gtf/gff格式）文件；参考序列以及注释信息的下载地方通有<a href="www.ensembl.org">Ensembl</a>，<a href="https://genome.jgi.doe.gov/portal/" target="_blank" rel="external">JGI</a>，此外，还有一些针对某些模式生物的专门数据库，例如araport是拟南芥的数据库，本文所用的数据就是拟南芥的测序数据（已经下载好，过程略）。</p>
<ol start="2" style="list-style-type: decimal">
<li><p><code>01_raw_data</code>中的是原始数据（测序公司给你的数据），其中，sample1_R1.fastq.gz和sample1_R2.fastq.gz表示的是双端测序（PE），一个是左边的数据，一个是右边的数据。</p></li>
<li><p><code>02clean_data</code>用于存放清洗了原始数据后的数据；</p></li>
<li><p><code>03align_data</code>用于存放比对后的数据（例如BAM或SAM），以及分析的数据；</p></li>
<li><p><code>others</code>文件夹中的数据不清楚，这一部分的数据是从教程的主页上下载下来的，估计是分析后的数据，先不管。</p></li>
</ol>
<h4 id="解压缩参考序列文件">解压缩参考序列文件</h4>
<p>刚下载的参考序列文件与注释文件是以gz结尾的压缩文件，因此先进行解压，<code>gunzip *gz</code>的作用就是将压缩文件解压到当前文件夹，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ILg2fcd82I.png?imageslim" alt="mark"> 两个文件已经解压好了，一个是gtf文件，一个是fasta文件，可以用<code>head</code>命令查看一下序列： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/LkJfeJ6C7e.png?imageslim" alt="mark"></p>
<p>此外，还能通过<code>cat，less，more，head，tail</code>这几个命令来查看序列，现在查看一下注释文件： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/Ke5K118mlE.png?imageslim" alt="mark"></p>
<h5 id="md5值的计算">MD5值的计算</h5>
<p>MD5主要用于检验数据传输后，前后两个数据是否完整，简单来说就是，测序文件很大，通过MD5我就能知道上传或下载后的数据跟我原来的数据是不是一样。检测过程如下所示： 生成4个原始数据的MD5值： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ../01raw_data </div><div class="line">md5sum *gz &gt; md5.txt</div></pre></td></tr></table></figure></p>
<p>上述两个命令是切换到原始数据的文件夹，通过<code>md5sum</code>命令是生成该文件夹下的所有gz格式文件的MD5值，并将这些MD5值给md5.txt文件，现在查看一下md5.txt文件<code>less md5.txt</code>： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/1g1mJja9be.png?imageslim" alt="mark"></p>
<h5 id="检验md5值">检验MD5值</h5>
<p>用md5sum命令来检验一下MD5的值： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/k61halaEID.png?imageslim" alt="mark"> 如果文件完整，后面会显示OK。</p>
<h4 id="测序文件的质控">测序文件的质控</h4>
<p>质控软件是<code>fastqc</code>，如果没有安装可以利用ocnda进行安装，<code>conda install fastqc</code>，安装后，查看一下版本<code>fastqc -v</code>，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/K9A04G9a84.png?imageslim" alt="mark"></p>
<h5 id="第一种方法质控常规方法">第一种方法质控：常规方法</h5>
<p>现在用fastqc进行质控，如下所示： <code>fastqc sample*gz</code>， <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/be16cK2fHI.png?imageslim" alt="mark"> 运行过程与测序文件的大小以及计算机的性能有关，我们这个数据量不大，比较快，结束后，用<code>tree</code>来查看一下结果： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/Ba6aFcGKg4.png?imageslim" alt="mark"> 其中以html结尾的数据就是测序的结果，关于测序结果的解读，以前参考过<a href="https://zhuanlan.zhihu.com/p/20731723" target="_blank" rel="external">青山屋主的《使用 FastQC 做质控》</a>，可以看一下。</p>
<h5 id="第二种方法质控用for循环">第二种方法质控：用for循环</h5>
<p>此外，还可以用<code>for</code>循环来做，先把原来的zip和html文件删除掉<code>rm -f *zip</code>和<code>rm -f *html</code>，用于<code>for i in</code>ls *gz<code>;do fastqc $i;done</code>来进行循环，同样能达到相同的目的。</p>
<h5 id="第三种方法质控利用管道命令">第三种方法质控：利用管道命令</h5>
<p>先把原来的zip和html文件删除掉<code>rm -f *zip</code>和<code>rm -f *html</code>，然后输入命名<code>ls *gz |xargs -I [] echo 'nohup fastqc [] &amp;'</code>，这个命名是的运行过程就是列出raw_data文件夹下的所有测序文件（就是4个原始数据文件），然后导入到xargs命名中，利用xargs命令调用nohup命名。关于这个命名的解释： 2. <code>ls *gz</code>是列出当前目录下的所有gz文件。 3. <code>|</code>表示将上面列出的文件导入到下一步（xargs命名），这叫管道命令，很形象，就是将上面的结果像管道一下，输入到下一步。 4. xargs命令是给其他命令传递参数的一个过滤器，也是组合多个命令的一个工具，使用-I指定一个替换字符串[]，这个字符串在xargs扩展时会被替换掉，当-I与xargs结合使用，每一个参数命令都会被执行一次，我们使用上述的这段命名时，它表示，用<code>ls *gz</code>列出的几个文件名字替换掉<code>nuhup fastqc []</code>的中括号。 4. <code>echo</code>用于输出字符串； 5. nohup是将操作置于后台，它要与<code>&amp;</code>配合使用。 6. 有关管道与<code>xargs</code>的用法，这个<a href="https://www.cnblogs.com/wangqiguo/p/6464234.html" target="_blank" rel="external">文章介绍得不错《xargs命令详解，xargs与管道的区别》</a>。</p>
<p>再看一下流程： ls *gz |xargs -I [] echo ‘fastqc []’ 就是将第一个[]里的内容替换掉第二个[]，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5E68hCkHfl.png?imageslim" alt="mark"></p>
<p>将上述命令保存到<code>fastqc.sh</code>文件中，并运行fastqc.sh文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ijb79De8FI.png?imageslim" alt="mark"></p>
<p>结果如下： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/JIlKCL0KG7.png?imageslim" alt="mark"></p>
<h5 id="第四种方法质控multiqc">第四种方法质控：multiqc</h5>
<p>这种方法严格来说并不是做质控，而是把fastqc的质控结果给合并起来，直接在fastqc分析后的结果的目录中输入<code>multiqc .</code>就可以，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/D3H3dHGl0j.png?imageslim" alt="mark"> 打开multiqc_report文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/LdFfCdAECc.png?imageslim" alt="mark"></p>
<h4 id="数据的过滤去接头">数据的过滤（去接头）</h4>
<p>数据过程主要使用的是Trimmomatic软件，此软件的功能是用于去掉原始数据的接头序列，先看一下测序的质量文件中的Adaptor Concent，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5jDEd42Kl8.png?imageslim" alt="mark"> 这张图衡量的是序列中两端adapter的情况，从图中我们可以看出这些测序文件的接头序列并没有去掉，因此我们要去掉这些软件，Trimmomatic就是实现这个功能的，它的一些介绍如下所示：</p>
<p><strong>软件特点：</strong> 1. 支持多线程，处理数据速度快； 2. 主要用于去除Illumina平台接头； 3. 根据碱基质量对fastq进行筛选； 4. 支持SE和PE测序数据，支持gzip和bzip2压缩文件。</p>
<p><strong>质量过滤的依据：</strong> 1. ILLUMINACLIP：过滤reads中的Illumina接头； 2. LEADING：从reads开头切除质量值低于阈值的碱基； 3. TRAILING：从reads末尾切除质量值低于阈值的碱基； 4. SLIDINGWINDOW：从reads的5’端开始，进行滑窗过滤，切掉碱基质量平均值低于阈值的滑窗； 5. MINLEN：丢弃经过剪切后长度低于阈值的这条reads； 6. TOPHRED33：将reads的碱基质量值体系转换为phred-33（一般都选择phred-33）； 7. TOPHRED66:将reads的碱基质量值体系转换为phred-64。</p>
<p><strong>软件使用</strong> <strong>1. 接头序列的选择：</strong></p>
<ul>
<li><p>软件默认提供了几个接头文件，在FastQC的结果中会提示是哪种接头，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5b3K76jg9L.png?imageslim" alt="mark"> 文件显示的是TruSeq Adapter，因此要选择“TrueSeq3-SE.fa” and “TruSeq3-PE.fa”进行过滤（我们前面知道，本次案例中的是双端测序，因此用到的是TruSeq3-PE.fa）。</p></li>
<li><p>但是如果显示的是Illumina Single End”/“Illumina Paired End”就要选择“TruSeq2-SE.fa”和“TruSeq2-PE.fa”，</p></li>
</ul>
<p><strong>2. 去接头参数的选择</strong> 选择true或false，随后会介绍。</p>
<h5 id="trimmomatic使用案例">trimmomatic使用案例</h5>
<p>双端测序会输入2个文件，分别是正向测序序列和反向测序序列，过滤完数据后，会输出4个文件，双端测序都保留的是paired，如果其中一端序列过滤后被丢弃了，另一端序列被保留了，则为unpaired。</p>
<p>现在使用trimmomatic去掉adapter，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">trimmomatic PE -threads 4 \</div><div class="line">sample1_R1.fastq.gz sample1_R2.fastq.gz \</div><div class="line">../02clean_data/sample1_paired_clean_R1.fastq.gz \</div><div class="line">../02clean_data/sample1_unpair_clean_R1.fastq.gz \</div><div class="line">../02clean_data/sample1_paired_clean_R2.fastq.gz \</div><div class="line">../02clean_data/sample1_unpair_clean_R2.fastq.gz \</div><div class="line">ILLUMINACLIP:/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa:2:30:10:1:true \</div><div class="line">LEADING:3 TRAILING:3 \</div><div class="line">SLIDINGWINDOW:4:20 MINLEN:50 TOPHRED33</div></pre></td></tr></table></figure>
<p>代码的解释： 1. -threads:后面的数据表示是线程数，可不设置，程序会自行检测并选择核心数。 2. ILLUMINACLIP:过滤 reads 中的 Illumina 测序接头和引物序列，并决定是否去除反向互补的 R1/R2 中的 R2。在此命令中输入的是/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa，它是接头序列文件，可以在trimmomatic的安装目录中找到，这一步要使用绝对路径； 4. LEADING:3 TRAILING:3 5. SLIDINGWINDOW:从 reads 的 5’ 端开始，进行滑窗质量过滤，切掉碱基质量平均值低于阈值的滑窗。 6. LEADING: 从 reads 的开头切除质量值低于阈值的碱基。 7. TRAILING: 从 reads 的末尾开始切除质量值低于阈值的碱基。 8. MINLEN: 如果经过剪切后 reads 的长度低于阈值则丢弃这条 reads，被丢弃的 reads 数会被统计在 Trimmomatic 日志的 dropped reads 中。 9. AVGQUAL: 如果 reads 的平均碱基质量值低于阈值则丢弃这条 reads。 10. TOPHRED33: 将 reads 的碱基质量值体系转为 phred-33。 11. TOPHRED64: 将 reads 的碱基质量值体系转为 phred-64。 运行过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ga5L1ijFJh.png?imageslim" alt="mark"> 这个过程根据序列的长度与计算机的性能有所不同，我在虚拟机中跑了大概5分钟，运行完后，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/bdi1eGGK59.png?imageslim" alt="mark"></p>
<p>这个结果显示，输入了250000个序列，其中196007个序列（78.40%）的序列留下，14.26%留在了一端，2.39%留在了另一端，另外，扔掉了4.94%的序列。如果将ILLUMINACLIP:/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa:2:30:10:1:true 中的true改为false，则结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/kFF2KIFa04.png?imageslim" alt="mark"></p>
<p>这个结果显示，输入了250000个序列，其中90442个序列（36.02%）的序列留下，56.64%留在了一端，1.23%留在了另一端，另外，扔掉了6.11%的序列。 另外一个sample2样本也按照同样的操作（选true），去掉接头的所有文件如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/cJJl8k258g.png?imageslim" alt="mark"></p>
<h3 id="六转录组数据序列比对">（六）转录组数据序列比对</h3>
<h4 id="软件介绍">软件介绍</h4>
<p>序列比对分为两种，一种是有参比对，另一种是无参比对。这个过程就是将公司测序得到的reads比对到参考基因组上，如果我们所研究的物种有参考基因组的话，就是将reads直接比对到参考基因组上就行，如果没有参考基因组，则先需要拼接出一个基因组，然后再进行比对。这两种方式的差别如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/AfjfcHCA1J.jpg?imageslim" alt="mark"> 这张图里面涉及三种比对，分别是基因组，有参转录组，无参转录组，可以参考一下（图片出处：Conesa A, Madrigal P, Tarazona S, et al. A survey of best practices for RNA-seq data analysis. Genome Biology. 2016;17:13. doi:10.1186/s13059-016-0881-8.）</p>
<p>转录组测序的比对通常分为基因组比对和转录组比对两种，顾名思义，基因组比对就是把reads比对到完整的基因组序列上，而转录组比对则是把reads比对到所有已知的转录本序列上。无参转录组所用到的工具是trinity，有参转录本所用到的工具是STAR。</p>
<p>如果是基于基因组比对，所用的工具是STAR和Hisat2。如果是基于转录组进行比对，则可以使用RSEM（可以结合bowtie2和STAR进行比对和定量分析）。关于转录组所使用的一些工具2017年，<a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1521872470&amp;ver=773&amp;signature=QyvVfMDkq46O3CxqFprV5ni3hSooBgOg2PVu*rGT4sfNaLH4Z7fsj8DvJepECqczTPF71CfQfTbQXaW7c7rn*ZWcLJqyC4YZzuVKqTDIP1fC9-cs0NuRk94DGQED1HmN&amp;new=1" target="_blank" rel="external">Nature Com去年发一篇文章，讲的39个工具，可以看一下。</a></p>
<p>本案例所用工具是STAR。过程包括①建立索引；②进行比对（分为两种操作，分为简单版与复杂版）；③查看比对文件。</p>
<h4 id="建立索引">建立索引</h4>
<p>先建立一个目录，用于存放索引文物，即在<code>rnaseq</code>目录下，输入<code>mkdir arab_STAR_genome</code>，建立一个名叫arab_STAR_genome的目录。接着安装STAR软件，命令为<code>conda install star</code>，记得是小写。</p>
<p>现在切换到biotest/rnaseq目录下（这个目录就是00ref，arab_STAR_genome的上层目录，一定要在这个目录下，否则运行会出错），运行软件，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">STAR --runThreadN 6 --runMode genomeGenerate \ </div><div class="line">--genomeDir arab_STAR_genome \ </div><div class="line">--genomeFastaFiles 00ref/TAIR10_Chr.all.fasta \ --sjdbGTFfile 00ref/Araport11_GFF3_genes_transposons.201606.gtf \ --sjdbOverhang 149</div></pre></td></tr></table></figure>
<p>运行过程中出现了错误，STAR的进程被杀死了，因为我用的是虚拟机，虚拟机的内存是1G，而STAR这个软件很耗内存，因此把虚拟机的内存上调到8G，再次运行，出现finished successfully即表示运行结束，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/ECdg9cIjfg.png?imageslim" alt="mark"></p>
<p>进程还是被杀死，因此最后切换到笔记本的Ubuntu中进去，STAR能顺利运行，运行结束后，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/l3cIFhf85K.png?imageslim" alt="mark"></p>
<p>可以查看一下arab_STAR_genome文件夹，下图就是运算的结果 ： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/88gJg41d18.png?imageslim" alt="mark"></p>
<p>接着进行第二步，先进行简单版的比对，简单版的比对输入的参数比较少，以比对sample1为例 说明，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">STAR  --runThreadN 5 --genomeDir arab_STAR_genome \</div><div class="line">--readFilesCommand zcat \</div><div class="line">--readFilesIn 02clean_data/sample1_paired_clean_R1.fastq.gz \</div><div class="line">02clean_data/sample1_paired_clean_R2.fastq.gz \</div><div class="line">--outFileNamePrefix 03align_out/sample1_</div></pre></td></tr></table></figure>
<p>在03align_out文件 中可以看到这些文件 ：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/fmaKecG1Fa.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>SJ文件包括了一些可变剪接的信息，还有3个Log文件，它们包括了一些处理过程的信，sample1_Log.final.out含有了一些统计信息，如下所示 ： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/5m7eJ32f21.png?imageslim" alt="mark"></p>
<p>sample1_align.out.sam文件则是比对的结果，例如是否有错配，哪些reads比对上了。接着用复杂版进行比对 ， 这次用sample2进行复杂比对，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">STAR  --runThreadN 5 --genomeDir arab_STAR_genome \</div><div class="line">--readFilesCommand zcat \</div><div class="line">--readFilesIn 02clean_data/sample2_paired_clean_R1.fastq.gz \</div><div class="line">02clean_data/sample2_paired_clean_R2.fastq.gz \</div><div class="line">--outFileNamePrefix 03align_out/sample2_ \</div><div class="line">--outSAMtype BAM SortedByCoordinate \</div><div class="line">--outBAMsortingThreadN 5 \</div><div class="line">--quantMode TranscriptomeSAM GeneCounts</div></pre></td></tr></table></figure>
<p>出现successfully表示比对结束，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/1dE3E67FGC.png?imageslim" alt="mark"></p>
<p>比对后的结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/E4LFmFGj3h.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>与sample1的简单比对相比，sample2的复杂比对结果中，少了一个sam文件，而多了2个bam文件，其中一个是经过坐标转换的，形成的转录本文件（sample2_Aligned.toTranscriptome.out.bam），另外一个是排过序的bam文件（sample2_Aligned.sortedByCoord.out.bam）。此外，还有一个文件，叫sample2_ReadsPerGene.out.tab，这个文件所含的信息是，一个基因上含有多少个reads。可以查看一下这个文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/l4AA7k8k0g.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第一列是基因名称，后面3列是基因的reads数。</p>
<p>现在查看一下sample2排序后的数据，所用命令为samtools view 文件名，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">samtools view sample2_Aligned.sortedByCoord.out.bam | head</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/j4fLffJ2f1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>转录组数据表达定量： 处理原始比对文件 picard/samtools 将sam格式转换为bam格式 对bam文件进行排序 去除比对得分比较低的序列 如果需要（当质量不好时）可以去除重复reads</p>
<p>定量表达的流程： STAR+RSEM：输出结果选择转录本定量或者基因定量；定量单位包括feature count,FPKM，TPM；操作相对复杂；先比对再定量</p>
<p>STAR+HTSeq：输出结果为原始read count；结果可用于差异表达分析;操作相对 简单；先比对再定量</p>
<p>Kallisto（free-alignment）：速度快省内存；基于转录本定量；不产生Bam文件，不方便基它后续分析（不进行比对，直接定量）。</p>
<p>新建一个文件夹，arab_RSEM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-prepare-reference --gtf 00ref/Araport11_GFF3_genes_transposons.201606.gtf \ 00ref/TAIR10_Chr.all.fasta \ arab_RSEM/arab_rsem</div></pre></td></tr></table></figure>
<p>开始 运行，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/ACjEAGCmlF.png?imageslim" alt="mark"></p>
<p>生成了7个文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/4jlbJjB9EF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中比较重要的是<code>arab_rsem.transcripts.fa</code>，这个文件提供了转录本的信息;接着，再新建一个目录 ，命名为04rsem_out，然后输入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-calculate-expression --paired-end --no-bam-output --alignments -p 5 -q 03align_out/sample2_Aligned.toTranscriptome.out.bam arab_RSEM/arab_rsem 04rsem_out/sample2_rsem</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/e3fE7aebbI.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>运行结束，一共生成 了3个文件 ，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Aj3adElBd3.png?imageslim" alt="mark"></p>
<p>在这三个文件中，sample2_rsem.stat含有统计信息，这些信息可以用于进一步的分析，例如可视化。而sample2_rsem.genes.results则是基因的结果，可以查看一下，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/GL2EkgLILb.png?imageslim" alt="mark"> 其中，第1列是基因id，第2列是一个基因对应的转录本.</p>
<p>接着看一下基于转录本的信息，即文件sample2_rsem.isoforms.results的信息，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/kbGCEf9jk5.png?imageslim" alt="mark"></p>
<p>第1列就变成了转录本的id，第2列就成了基因的id。 以上是STAR+RSEM的定量流程。</p>
<p>接着用kallisto进行定量。 如果没有安装kallisto，则用conda进行安装，安装后，新建一个目录，arab_kallisto，进入该目录，随后建立 索引 ，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir arab_kallisto</div><div class="line">cd arab_kallisto</div><div class="line">kallisto index -i arab_kallisto ../arab_RSEM/arab_rsem.transcripts.fa</div></pre></td></tr></table></figure>
<p>开始运行，运行过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/896Eea4903.png?imageslim" alt="mark"></p>
<p>整个过程可能需要几分钟，最终会生成一个叫arab_kallisto的文件，这个文件就是后面进行定量的索引文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/JdeHk1K93d.png?imageslim" alt="mark"></p>
<p>现在再新建一个目录，用于存放定量的结果，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir 05kallisto_out</div><div class="line">kallisto quant -i arab_kallisto/arab_kallisto -o 05kallisto_out/sample2 02clean_data/sample2_paired_clean_R1.fastq.gz 02clean_data/sample2_paired_clean_R2.fastq.gz</div></pre></td></tr></table></figure>
<p>这个过程很快，结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Gc0AdjBKhD.png?imageslim" alt="mark"></p>
<p>然后进入05kallisto_out目录，里面还有一个称为sample2的目录，进入，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/72kIIj67A7.png?imageslim" alt="mark"></p>
<p>sample2目录里有3个文件，其中tsv文件是可读的，可以查看一下，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Hdm8C2lB86.png?imageslim" alt="mark"></p>
<p>数据差异分析：</p>
<p>STAR+featureCounts是STAR+HTSeq的升级版，在这一部分中，利用STAR的结果，通过featureCounts来计算。</p>
<p>表达宣结果转换为表达矩阵。</p>
<p>为了方便进行差异分析，我们需要根据前文提到的内容，用STAR的复杂分析，将所有的样本都转化为相应的BAM格式，原始数据有sample1和sample2，2个样本又有2个生物学重复，因此是4个数据，分别为sample1，sample1_2，sample2和sample2_2，转换后的数据如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/H35403DkI4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>安装subread工具，<code>conda install subread</code> 随后进行分析，计算结果非常快，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">featureCounts -p -a ../00ref/Araport11_GFF3_genes_transposons.201606.gtf -o out_counts.txt -T 6 -t exon -g gene_id sample*Aligned.sortedByCoord.out.bam</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/0Ce7ej5EEi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>03align_out中会出现2个文件，分别为out_count.txt与out_counts.txt.summary。可以查看一下out_counts.txt文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/IB9Fd53mj6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>这个文件就是定量的结果。</p>
<p>将定量的结果转换为表达矩阵。 根据前文的案例，将所有的样本都转化为表达矩阵，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/CfbkHFK2C5.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-generate-data-matrix *_rsem.genes.results &gt; output.matrix</div></pre></td></tr></table></figure>
<p>第1列是基因名称，第2到第5列是样本的整合，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/gA34B244lE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>有的基因表达量是0,随后可以将基因表达量为0的基因去掉，并且将表头进行更改，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;BEGIN&#123;print &quot;geneid\ta1\ta2\tb2\tb2\n&quot;&#125;&#123;if($2+$3+$4+$5&gt;0)print $0&#125;&apos; output.matrix &gt; deseq2_input.txt</div></pre></td></tr></table></figure>
<p>运行后，查看一下原来的行数 wc -l output.matrix与wc -l deseq2_input.txt，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/7aAEcgKDja.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图中，去掉基因表达量为0的基因前，矩阵是37337行，去掉后为17971行，后续用deseq2_input.txt进行分析 。现在 建立一个06deseq_out的文件夹，进行差异分析，并将deseq2_input.txt复制过去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir 06deseq_out</div><div class="line">mv deseq2_input.txt ../06deseq_out/</div></pre></td></tr></table></figure>
<p>接着用R语言进行分析，代码如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">getwd()</div><div class="line"># 获取当前目录</div><div class="line"></div><div class="line">setwd(&quot;D:\\netdisk\\biotest\\rnaseq&quot;)</div><div class="line"># 将工作目录定位到测序结果的目录</div><div class="line"></div><div class="line">source(&quot;http://bioconductor.org/biocLite.R&quot;)</div><div class="line"># 调用biocLite</div><div class="line"></div><div class="line">biocLite(&quot;DESeq2&quot;)</div><div class="line">biocLite(&quot;edgeR&quot;)</div><div class="line"># 安装分析数据所用的包</div><div class="line">install.packages(&quot;ggrepel&quot;)</div><div class="line"></div><div class="line">library(DESeq2)</div><div class="line">library(edgeR)</div><div class="line">library(ggrepel)</div><div class="line">library(ggplot2)</div><div class="line"></div><div class="line">input_data &lt;- read.table(</div><div class="line">  &quot;D:\\netdisk\\biotest\\rnaseq\\06deseq_out\\deseq2_input.txt&quot;,</div><div class="line">  header = TRUE, </div><div class="line">  row.names=1)</div><div class="line"># 导入数据，其中添加row.names=1是将第1列设为矩阵的名称</div><div class="line">input_data &lt;- round(input_data,digits = 0)</div><div class="line"># reads数都是整数，因此要保留整数部分，否则后面会出错</div><div class="line"></div><div class="line"></div><div class="line">input_data &lt;- as.matrix(input_data)</div><div class="line">condition &lt;- factor(c(rep(&quot;ctl&quot;,2),rep(&quot;exp&quot;,2)))</div><div class="line">coldata &lt;- data.frame(row.names = colnames(input_data),condition)</div><div class="line">dds &lt;- DESeqDataSetFromMatrix(countData = input_data,            </div><div class="line">                              colData = coldata,</div><div class="line">                              design = ~condition)</div><div class="line"># dds是分析矩阵</div><div class="line"></div><div class="line"></div><div class="line">dds &lt;- DESeq(dds)</div><div class="line">res &lt;- results(dds,alpha = 0.05)</div><div class="line"># 提取分析结果</div><div class="line"></div><div class="line">summary(res)</div><div class="line"># 查看分析结果</div><div class="line"></div><div class="line">names(resdata)[1] &lt;- &quot;Gene&quot;</div><div class="line"></div><div class="line">res &lt;- res[order(res$padj),]</div><div class="line">resdata &lt;- merge(as.data.frame(res),</div><div class="line">                 as.data.frame(counts(dds,normalized = TRUE)),</div><div class="line">                 by = &quot;row.names&quot;,sort = FALSE)</div><div class="line"></div><div class="line">write.table(resdata,file=&quot;diffexpr_results.txt&quot;,</div><div class="line">            sep=&quot;\t&quot;,</div><div class="line">            quote = F,</div><div class="line">            row.names = F)</div><div class="line"></div><div class="line">plotMA(res)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/30ADKLgKb4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">maplot &lt;- function(res,thresh = 0.05, labelsig = TRUE, ...)&#123;</div><div class="line">  with(res, plot(baseMean, log2FoldChange, pch=20, cex=.5, log=&quot;x&quot;,...))</div><div class="line">  with(subset(res,padj&lt;thresh),points(baseMean, log2FoldChange, col=&quot;red&quot;,pch=20, cex = 1.5))</div><div class="line">&#125;</div><div class="line"></div><div class="line">maplot(resdata,main=&quot;MA plot&quot;)</div></pre></td></tr></table></figure>
<p>构建的maplot函数的绘图：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/eHcm7EhggC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">resdata$significant &lt;- as.factor(resdata$padj&lt;0.05 &amp; abs(resdata$log2FoldChange) &gt;1)</div><div class="line"></div><div class="line">ggplot(data=resdata, aes(x=log2FoldChange, y = -log10(padj),color = significant)) +</div><div class="line">  geom_point()+</div><div class="line">  ylim(0, 8)+</div><div class="line">  scale_color_manual(values = c(&quot;black&quot;,&quot;red&quot;))+</div><div class="line">  geom_hline(yintercept = -log10(0.05),lty=4, lwd=0.6,alpha=0.8)+</div><div class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.border = element_blank(),</div><div class="line">        panel.grid.major = element_blank(),</div><div class="line">        axis.line = element_line(colour = &quot;black&quot;))+</div><div class="line">  labs(title=&quot;Volcanoplot_biotest(by RVDSD)&quot;, x=&quot;log2(fold change)&quot;,</div><div class="line">       y=&quot;-log10(padj&quot;)+</div><div class="line">  theme(plot.title = element_text(hjust = 0.5))+</div><div class="line">  geom_text_repel(data=subset(resdata, -log10(padj) &gt; 6),</div><div class="line">                  aes(label = Gene),col=&quot;black&quot;,</div><div class="line">                  alpha = 0.8)</div></pre></td></tr></table></figure>
<p>ggplot2绘制的火山图： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Hc3193k2c9.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/20/生信-实战-生信技能树转录组数据分析入门实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/生信-实战-生信技能树转录组数据分析入门实战/" itemprop="url">转录组数据分析入门实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T12:00:00+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生信实战项目/" itemprop="url" rel="index">
                    <span itemprop="name">生信实战项目</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,482
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>这是根据“思考问题的熊“的课程《生信技能树转录组数据分析入门实战》进行整理的，这是一个标准的转录组分析流程，所用模式生物是拟南芥，整个课程信息如下所示：</p>
<h3 id="课程题目">课程题目：</h3>
<p>生信技能树转录组数据分析入门实战</p>
<h3 id="课程内容">课程内容：</h3>
<ol style="list-style-type: decimal">
<li>课程介绍</li>
<li>Linux操作技巧</li>
<li>生物信息软件安装</li>
<li>转录组分析整体思路</li>
<li>转录组数据预处理</li>
<li>转录组数据序列比对</li>
<li>转录组数据表达定量</li>
<li>转录组数据差异分析</li>
</ol>
<h3 id="所用数据如下所示">所用数据，如下所示：</h3>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/aJC86iIddm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="二inux操作技巧">（二）inux操作技巧</h3>
<h4 id="linux常用客户端">Linux常用客户端</h4>
<p>Xshell：用于登录远程服务器。 Putty：用于登录远程服务器。 WInSCP：用于下载服务器文件。</p>
<h4 id="linux命名">Linux命名</h4>
<p>这个比较基础，略过，只讲一个alias alias用于缩简一些命令，例如这次的练习数据我放在了<code>/mnt/hgfs/biotest/rnaseq/</code>这个目录下，每次都输入都太麻烦了，因此可以使用alias命名进行添加，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd #进行主目录</div><div class="line">vim .bashrc # 进入bashrc文件</div></pre></td></tr></table></figure>
<p>在.bashrc文件中添加如下字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias wp=&apos;cd /mnt/hgfs/biotest/rnaseq/&apos;</div></pre></td></tr></table></figure>
<p>保存并退出，其中需要注意的是等号两边不要有空格，否则会出错。 此时直接输入wp就可以直接进行目录。</p>
<h3 id="三生物信息软件安装">（三）生物信息软件安装</h3>
<p>主要是利用conda进行安装，比较简单，详细的教程可以参照<a href="https://zhuanlan.zhihu.com/p/25085567" target="_blank" rel="external">青山屋主的教程</a>，这个是我看到的比较好的教程。</p>
<h3 id="四转录组分析整体思路">（四）转录组分析整体思路</h3>
<p>作者回顾了一下以前的思路，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/21cLF9i3Jl.png?imageslim" alt="mark"></p>
<p>大图如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/hkA5ea79cL.png?imageslim" alt="mark"></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/01gdAhELCi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/j2mj3L2d84.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="五转录组数据预处理">（五）转录组数据预处理</h3>
<h4 id="数据介绍">数据介绍</h4>
<p>按照作者教程中的文件夹整理了所要分析的数据，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/0jIb80EBL8.png?imageslim" alt="mark"></p>
<p>现在解释一下这几个文件夹，其中： 1. <code>00ref</code>存放的是参考基因组文件（fasta格式）和注释信息（gtf/gff格式）文件；参考序列以及注释信息的下载地方通有<a href="www.ensembl.org">Ensembl</a>，<a href="https://genome.jgi.doe.gov/portal/" target="_blank" rel="external">JGI</a>，此外，还有一些针对某些模式生物的专门数据库，例如araport是拟南芥的数据库，本文所用的数据就是拟南芥的测序数据（已经下载好，过程略）。</p>
<ol start="2" style="list-style-type: decimal">
<li><p><code>01_raw_data</code>中的是原始数据（测序公司给你的数据），其中，sample1_R1.fastq.gz和sample1_R2.fastq.gz表示的是双端测序（PE），一个是左边的数据，一个是右边的数据。</p></li>
<li><p><code>02clean_data</code>用于存放清洗了原始数据后的数据；</p></li>
<li><p><code>03align_data</code>用于存放比对后的数据（例如BAM或SAM），以及分析的数据；</p></li>
<li><p><code>others</code>文件夹中的数据不清楚，这一部分的数据是从教程的主页上下载下来的，估计是分析后的数据，先不管。</p></li>
</ol>
<h4 id="解压缩参考序列文件">解压缩参考序列文件</h4>
<p>刚下载的参考序列文件与注释文件是以gz结尾的压缩文件，因此先进行解压，<code>gunzip *gz</code>的作用就是将压缩文件解压到当前文件夹，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ILg2fcd82I.png?imageslim" alt="mark"> 两个文件已经解压好了，一个是gtf文件，一个是fasta文件，可以用<code>head</code>命令查看一下序列： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/LkJfeJ6C7e.png?imageslim" alt="mark"></p>
<p>此外，还能通过<code>cat，less，more，head，tail</code>这几个命令来查看序列，现在查看一下注释文件： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/Ke5K118mlE.png?imageslim" alt="mark"></p>
<h5 id="md5值的计算">MD5值的计算</h5>
<p>MD5主要用于检验数据传输后，前后两个数据是否完整，简单来说就是，测序文件很大，通过MD5我就能知道上传或下载后的数据跟我原来的数据是不是一样。检测过程如下所示： 生成4个原始数据的MD5值： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ../01raw_data </div><div class="line">md5sum *gz &gt; md5.txt</div></pre></td></tr></table></figure></p>
<p>上述两个命令是切换到原始数据的文件夹，通过<code>md5sum</code>命令是生成该文件夹下的所有gz格式文件的MD5值，并将这些MD5值给md5.txt文件，现在查看一下md5.txt文件<code>less md5.txt</code>： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/1g1mJja9be.png?imageslim" alt="mark"></p>
<h5 id="检验md5值">检验MD5值</h5>
<p>用md5sum命令来检验一下MD5的值： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/k61halaEID.png?imageslim" alt="mark"> 如果文件完整，后面会显示OK。</p>
<h4 id="测序文件的质控">测序文件的质控</h4>
<p>质控软件是<code>fastqc</code>，如果没有安装可以利用ocnda进行安装，<code>conda install fastqc</code>，安装后，查看一下版本<code>fastqc -v</code>，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/K9A04G9a84.png?imageslim" alt="mark"></p>
<h5 id="第一种方法质控常规方法">第一种方法质控：常规方法</h5>
<p>现在用fastqc进行质控，如下所示： <code>fastqc sample*gz</code>， <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/be16cK2fHI.png?imageslim" alt="mark"> 运行过程与测序文件的大小以及计算机的性能有关，我们这个数据量不大，比较快，结束后，用<code>tree</code>来查看一下结果： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/Ba6aFcGKg4.png?imageslim" alt="mark"> 其中以html结尾的数据就是测序的结果，关于测序结果的解读，以前参考过<a href="https://zhuanlan.zhihu.com/p/20731723" target="_blank" rel="external">青山屋主的《使用 FastQC 做质控》</a>，可以看一下。</p>
<h5 id="第二种方法质控用for循环">第二种方法质控：用for循环</h5>
<p>此外，还可以用<code>for</code>循环来做，先把原来的zip和html文件删除掉<code>rm -f *zip</code>和<code>rm -f *html</code>，用于<code>for i in</code>ls *gz<code>;do fastqc $i;done</code>来进行循环，同样能达到相同的目的。</p>
<h5 id="第三种方法质控利用管道命令">第三种方法质控：利用管道命令</h5>
<p>先把原来的zip和html文件删除掉<code>rm -f *zip</code>和<code>rm -f *html</code>，然后输入命名<code>ls *gz |xargs -I [] echo 'nohup fastqc [] &amp;'</code>，这个命名是的运行过程就是列出raw_data文件夹下的所有测序文件（就是4个原始数据文件），然后导入到xargs命名中，利用xargs命令调用nohup命名。关于这个命名的解释： 2. <code>ls *gz</code>是列出当前目录下的所有gz文件。 3. <code>|</code>表示将上面列出的文件导入到下一步（xargs命名），这叫管道命令，很形象，就是将上面的结果像管道一下，输入到下一步。 4. xargs命令是给其他命令传递参数的一个过滤器，也是组合多个命令的一个工具，使用-I指定一个替换字符串[]，这个字符串在xargs扩展时会被替换掉，当-I与xargs结合使用，每一个参数命令都会被执行一次，我们使用上述的这段命名时，它表示，用<code>ls *gz</code>列出的几个文件名字替换掉<code>nuhup fastqc []</code>的中括号。 4. <code>echo</code>用于输出字符串； 5. nohup是将操作置于后台，它要与<code>&amp;</code>配合使用。 6. 有关管道与<code>xargs</code>的用法，这个<a href="https://www.cnblogs.com/wangqiguo/p/6464234.html" target="_blank" rel="external">文章介绍得不错《xargs命令详解，xargs与管道的区别》</a>。</p>
<p>再看一下流程： ls *gz |xargs -I [] echo ‘fastqc []’ 就是将第一个[]里的内容替换掉第二个[]，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5E68hCkHfl.png?imageslim" alt="mark"></p>
<p>将上述命令保存到<code>fastqc.sh</code>文件中，并运行fastqc.sh文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ijb79De8FI.png?imageslim" alt="mark"></p>
<p>结果如下： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/JIlKCL0KG7.png?imageslim" alt="mark"></p>
<h5 id="第四种方法质控multiqc">第四种方法质控：multiqc</h5>
<p>这种方法严格来说并不是做质控，而是把fastqc的质控结果给合并起来，直接在fastqc分析后的结果的目录中输入<code>multiqc .</code>就可以，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/D3H3dHGl0j.png?imageslim" alt="mark"> 打开multiqc_report文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/LdFfCdAECc.png?imageslim" alt="mark"></p>
<h4 id="数据的过滤去接头">数据的过滤（去接头）</h4>
<p>数据过程主要使用的是Trimmomatic软件，此软件的功能是用于去掉原始数据的接头序列，先看一下测序的质量文件中的Adaptor Concent，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5jDEd42Kl8.png?imageslim" alt="mark"> 这张图衡量的是序列中两端adapter的情况，从图中我们可以看出这些测序文件的接头序列并没有去掉，因此我们要去掉这些软件，Trimmomatic就是实现这个功能的，它的一些介绍如下所示：</p>
<p><strong>软件特点：</strong> 1. 支持多线程，处理数据速度快； 2. 主要用于去除Illumina平台接头； 3. 根据碱基质量对fastq进行筛选； 4. 支持SE和PE测序数据，支持gzip和bzip2压缩文件。</p>
<p><strong>质量过滤的依据：</strong> 1. ILLUMINACLIP：过滤reads中的Illumina接头； 2. LEADING：从reads开头切除质量值低于阈值的碱基； 3. TRAILING：从reads末尾切除质量值低于阈值的碱基； 4. SLIDINGWINDOW：从reads的5’端开始，进行滑窗过滤，切掉碱基质量平均值低于阈值的滑窗； 5. MINLEN：丢弃经过剪切后长度低于阈值的这条reads； 6. TOPHRED33：将reads的碱基质量值体系转换为phred-33（一般都选择phred-33）； 7. TOPHRED66:将reads的碱基质量值体系转换为phred-64。</p>
<p><strong>软件使用</strong> <strong>1. 接头序列的选择：</strong></p>
<ul>
<li><p>软件默认提供了几个接头文件，在FastQC的结果中会提示是哪种接头，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/5b3K76jg9L.png?imageslim" alt="mark"> 文件显示的是TruSeq Adapter，因此要选择“TrueSeq3-SE.fa” and “TruSeq3-PE.fa”进行过滤（我们前面知道，本次案例中的是双端测序，因此用到的是TruSeq3-PE.fa）。</p></li>
<li><p>但是如果显示的是Illumina Single End”/“Illumina Paired End”就要选择“TruSeq2-SE.fa”和“TruSeq2-PE.fa”，</p></li>
</ul>
<p><strong>2. 去接头参数的选择</strong> 选择true或false，随后会介绍。</p>
<h5 id="trimmomatic使用案例">trimmomatic使用案例</h5>
<p>双端测序会输入2个文件，分别是正向测序序列和反向测序序列，过滤完数据后，会输出4个文件，双端测序都保留的是paired，如果其中一端序列过滤后被丢弃了，另一端序列被保留了，则为unpaired。</p>
<p>现在使用trimmomatic去掉adapter，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">trimmomatic PE -threads 4 \</div><div class="line">sample1_R1.fastq.gz sample1_R2.fastq.gz \</div><div class="line">../02clean_data/sample1_paired_clean_R1.fastq.gz \</div><div class="line">../02clean_data/sample1_unpair_clean_R1.fastq.gz \</div><div class="line">../02clean_data/sample1_paired_clean_R2.fastq.gz \</div><div class="line">../02clean_data/sample1_unpair_clean_R2.fastq.gz \</div><div class="line">ILLUMINACLIP:/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa:2:30:10:1:true \</div><div class="line">LEADING:3 TRAILING:3 \</div><div class="line">SLIDINGWINDOW:4:20 MINLEN:50 TOPHRED33</div></pre></td></tr></table></figure>
<p>代码的解释： 1. -threads:后面的数据表示是线程数，可不设置，程序会自行检测并选择核心数。 2. ILLUMINACLIP:过滤 reads 中的 Illumina 测序接头和引物序列，并决定是否去除反向互补的 R1/R2 中的 R2。在此命令中输入的是/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa，它是接头序列文件，可以在trimmomatic的安装目录中找到，这一步要使用绝对路径； 4. LEADING:3 TRAILING:3 5. SLIDINGWINDOW:从 reads 的 5’ 端开始，进行滑窗质量过滤，切掉碱基质量平均值低于阈值的滑窗。 6. LEADING: 从 reads 的开头切除质量值低于阈值的碱基。 7. TRAILING: 从 reads 的末尾开始切除质量值低于阈值的碱基。 8. MINLEN: 如果经过剪切后 reads 的长度低于阈值则丢弃这条 reads，被丢弃的 reads 数会被统计在 Trimmomatic 日志的 dropped reads 中。 9. AVGQUAL: 如果 reads 的平均碱基质量值低于阈值则丢弃这条 reads。 10. TOPHRED33: 将 reads 的碱基质量值体系转为 phred-33。 11. TOPHRED64: 将 reads 的碱基质量值体系转为 phred-64。 运行过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/ga5L1ijFJh.png?imageslim" alt="mark"> 这个过程根据序列的长度与计算机的性能有所不同，我在虚拟机中跑了大概5分钟，运行完后，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180323/bdi1eGGK59.png?imageslim" alt="mark"></p>
<p>这个结果显示，输入了250000个序列，其中196007个序列（78.40%）的序列留下，14.26%留在了一端，2.39%留在了另一端，另外，扔掉了4.94%的序列。如果将ILLUMINACLIP:/home/biotest/ENTER/share/trimmomatic-0.36-5/adapters/TruSeq3-PE-2.fa:2:30:10:1:true 中的true改为false，则结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/kFF2KIFa04.png?imageslim" alt="mark"></p>
<p>这个结果显示，输入了250000个序列，其中90442个序列（36.02%）的序列留下，56.64%留在了一端，1.23%留在了另一端，另外，扔掉了6.11%的序列。 另外一个sample2样本也按照同样的操作（选true），去掉接头的所有文件如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/cJJl8k258g.png?imageslim" alt="mark"></p>
<h3 id="六转录组数据序列比对">（六）转录组数据序列比对</h3>
<h4 id="软件介绍">软件介绍</h4>
<p>序列比对分为两种，一种是有参比对，另一种是无参比对。这个过程就是将公司测序得到的reads比对到参考基因组上，如果我们所研究的物种有参考基因组的话，就是将reads直接比对到参考基因组上就行，如果没有参考基因组，则先需要拼接出一个基因组，然后再进行比对。这两种方式的差别如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/AfjfcHCA1J.jpg?imageslim" alt="mark"> 这张图里面涉及三种比对，分别是基因组，有参转录组，无参转录组，可以参考一下（图片出处：Conesa A, Madrigal P, Tarazona S, et al. A survey of best practices for RNA-seq data analysis. Genome Biology. 2016;17:13. doi:10.1186/s13059-016-0881-8.）</p>
<p>转录组测序的比对通常分为基因组比对和转录组比对两种，顾名思义，基因组比对就是把reads比对到完整的基因组序列上，而转录组比对则是把reads比对到所有已知的转录本序列上。无参转录组所用到的工具是trinity，有参转录本所用到的工具是STAR。</p>
<p>如果是基于基因组比对，所用的工具是STAR和Hisat2。如果是基于转录组进行比对，则可以使用RSEM（可以结合bowtie2和STAR进行比对和定量分析）。关于转录组所使用的一些工具2017年，<a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1521872470&amp;ver=773&amp;signature=QyvVfMDkq46O3CxqFprV5ni3hSooBgOg2PVu*rGT4sfNaLH4Z7fsj8DvJepECqczTPF71CfQfTbQXaW7c7rn*ZWcLJqyC4YZzuVKqTDIP1fC9-cs0NuRk94DGQED1HmN&amp;new=1" target="_blank" rel="external">Nature Com去年发一篇文章，讲的39个工具，可以看一下。</a></p>
<p>本案例所用工具是STAR。过程包括①建立索引；②进行比对（分为两种操作，分为简单版与复杂版）；③查看比对文件。</p>
<h4 id="建立索引">建立索引</h4>
<p>先建立一个目录，用于存放索引文物，即在<code>rnaseq</code>目录下，输入<code>mkdir arab_STAR_genome</code>，建立一个名叫arab_STAR_genome的目录。接着安装STAR软件，命令为<code>conda install star</code>，记得是小写。</p>
<p>现在切换到biotest/rnaseq目录下（这个目录就是00ref，arab_STAR_genome的上层目录，一定要在这个目录下，否则运行会出错），运行软件，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">STAR --runThreadN 6 --runMode genomeGenerate \ </div><div class="line">--genomeDir arab_STAR_genome \ </div><div class="line">--genomeFastaFiles 00ref/TAIR10_Chr.all.fasta \ --sjdbGTFfile 00ref/Araport11_GFF3_genes_transposons.201606.gtf \ --sjdbOverhang 149</div></pre></td></tr></table></figure>
<p>运行过程中出现了错误，STAR的进程被杀死了，因为我用的是虚拟机，虚拟机的内存是1G，而STAR这个软件很耗内存，因此把虚拟机的内存上调到8G，再次运行，出现finished successfully即表示运行结束，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/ECdg9cIjfg.png?imageslim" alt="mark"></p>
<p>进程还是被杀死，因此最后切换到笔记本的Ubuntu中进去，STAR能顺利运行，运行结束后，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/l3cIFhf85K.png?imageslim" alt="mark"></p>
<p>可以查看一下arab_STAR_genome文件夹，下图就是运算的结果 ： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/88gJg41d18.png?imageslim" alt="mark"></p>
<p>接着进行第二步，先进行简单版的比对，简单版的比对输入的参数比较少，以比对sample1为例 说明，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">STAR  --runThreadN 5 --genomeDir arab_STAR_genome \</div><div class="line">--readFilesCommand zcat \</div><div class="line">--readFilesIn 02clean_data/sample1_paired_clean_R1.fastq.gz \</div><div class="line">02clean_data/sample1_paired_clean_R2.fastq.gz \</div><div class="line">--outFileNamePrefix 03align_out/sample1_</div></pre></td></tr></table></figure>
<p>在03align_out文件 中可以看到这些文件 ：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/fmaKecG1Fa.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>SJ文件包括了一些可变剪接的信息，还有3个Log文件，它们包括了一些处理过程的信，sample1_Log.final.out含有了一些统计信息，如下所示 ： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/5m7eJ32f21.png?imageslim" alt="mark"></p>
<p>sample1_align.out.sam文件则是比对的结果，例如是否有错配，哪些reads比对上了。接着用复杂版进行比对 ， 这次用sample2进行复杂比对，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">STAR  --runThreadN 5 --genomeDir arab_STAR_genome \</div><div class="line">--readFilesCommand zcat \</div><div class="line">--readFilesIn 02clean_data/sample2_paired_clean_R1.fastq.gz \</div><div class="line">02clean_data/sample2_paired_clean_R2.fastq.gz \</div><div class="line">--outFileNamePrefix 03align_out/sample2_ \</div><div class="line">--outSAMtype BAM SortedByCoordinate \</div><div class="line">--outBAMsortingThreadN 5 \</div><div class="line">--quantMode TranscriptomeSAM GeneCounts</div></pre></td></tr></table></figure>
<p>出现successfully表示比对结束，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/1dE3E67FGC.png?imageslim" alt="mark"></p>
<p>比对后的结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/E4LFmFGj3h.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>与sample1的简单比对相比，sample2的复杂比对结果中，少了一个sam文件，而多了2个bam文件，其中一个是经过坐标转换的，形成的转录本文件（sample2_Aligned.toTranscriptome.out.bam），另外一个是排过序的bam文件（sample2_Aligned.sortedByCoord.out.bam）。此外，还有一个文件，叫sample2_ReadsPerGene.out.tab，这个文件所含的信息是，一个基因上含有多少个reads。可以查看一下这个文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/l4AA7k8k0g.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第一列是基因名称，后面3列是基因的reads数。</p>
<p>现在查看一下sample2排序后的数据，所用命令为samtools view 文件名，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">samtools view sample2_Aligned.sortedByCoord.out.bam | head</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/j4fLffJ2f1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>转录组数据表达定量： 处理原始比对文件 picard/samtools 将sam格式转换为bam格式 对bam文件进行排序 去除比对得分比较低的序列 如果需要（当质量不好时）可以去除重复reads</p>
<p>定量表达的流程： STAR+RSEM：输出结果选择转录本定量或者基因定量；定量单位包括feature count,FPKM，TPM；操作相对复杂；先比对再定量</p>
<p>STAR+HTSeq：输出结果为原始read count；结果可用于差异表达分析;操作相对 简单；先比对再定量</p>
<p>Kallisto（free-alignment）：速度快省内存；基于转录本定量；不产生Bam文件，不方便基它后续分析（不进行比对，直接定量）。</p>
<p>新建一个文件夹，arab_RSEM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-prepare-reference --gtf 00ref/Araport11_GFF3_genes_transposons.201606.gtf \ 00ref/TAIR10_Chr.all.fasta \ arab_RSEM/arab_rsem</div></pre></td></tr></table></figure>
<p>开始 运行，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/ACjEAGCmlF.png?imageslim" alt="mark"></p>
<p>生成了7个文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/4jlbJjB9EF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中比较重要的是<code>arab_rsem.transcripts.fa</code>，这个文件提供了转录本的信息;接着，再新建一个目录 ，命名为04rsem_out，然后输入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-calculate-expression --paired-end --no-bam-output --alignments -p 5 -q 03align_out/sample2_Aligned.toTranscriptome.out.bam arab_RSEM/arab_rsem 04rsem_out/sample2_rsem</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/e3fE7aebbI.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>运行结束，一共生成 了3个文件 ，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Aj3adElBd3.png?imageslim" alt="mark"></p>
<p>在这三个文件中，sample2_rsem.stat含有统计信息，这些信息可以用于进一步的分析，例如可视化。而sample2_rsem.genes.results则是基因的结果，可以查看一下，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/GL2EkgLILb.png?imageslim" alt="mark"> 其中，第1列是基因id，第2列是一个基因对应的转录本.</p>
<p>接着看一下基于转录本的信息，即文件sample2_rsem.isoforms.results的信息，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/kbGCEf9jk5.png?imageslim" alt="mark"></p>
<p>第1列就变成了转录本的id，第2列就成了基因的id。 以上是STAR+RSEM的定量流程。</p>
<p>接着用kallisto进行定量。 如果没有安装kallisto，则用conda进行安装，安装后，新建一个目录，arab_kallisto，进入该目录，随后建立 索引 ，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir arab_kallisto</div><div class="line">cd arab_kallisto</div><div class="line">kallisto index -i arab_kallisto ../arab_RSEM/arab_rsem.transcripts.fa</div></pre></td></tr></table></figure>
<p>开始运行，运行过程如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/896Eea4903.png?imageslim" alt="mark"></p>
<p>整个过程可能需要几分钟，最终会生成一个叫arab_kallisto的文件，这个文件就是后面进行定量的索引文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/JdeHk1K93d.png?imageslim" alt="mark"></p>
<p>现在再新建一个目录，用于存放定量的结果，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir 05kallisto_out</div><div class="line">kallisto quant -i arab_kallisto/arab_kallisto -o 05kallisto_out/sample2 02clean_data/sample2_paired_clean_R1.fastq.gz 02clean_data/sample2_paired_clean_R2.fastq.gz</div></pre></td></tr></table></figure>
<p>这个过程很快，结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Gc0AdjBKhD.png?imageslim" alt="mark"></p>
<p>然后进入05kallisto_out目录，里面还有一个称为sample2的目录，进入，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/72kIIj67A7.png?imageslim" alt="mark"></p>
<p>sample2目录里有3个文件，其中tsv文件是可读的，可以查看一下，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Hdm8C2lB86.png?imageslim" alt="mark"></p>
<p>数据差异分析：</p>
<p>STAR+featureCounts是STAR+HTSeq的升级版，在这一部分中，利用STAR的结果，通过featureCounts来计算。</p>
<p>表达宣结果转换为表达矩阵。</p>
<p>为了方便进行差异分析，我们需要根据前文提到的内容，用STAR的复杂分析，将所有的样本都转化为相应的BAM格式，原始数据有sample1和sample2，2个样本又有2个生物学重复，因此是4个数据，分别为sample1，sample1_2，sample2和sample2_2，转换后的数据如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/H35403DkI4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>安装subread工具，<code>conda install subread</code> 随后进行分析，计算结果非常快，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">featureCounts -p -a ../00ref/Araport11_GFF3_genes_transposons.201606.gtf -o out_counts.txt -T 6 -t exon -g gene_id sample*Aligned.sortedByCoord.out.bam</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/0Ce7ej5EEi.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>03align_out中会出现2个文件，分别为out_count.txt与out_counts.txt.summary。可以查看一下out_counts.txt文件，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/IB9Fd53mj6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>这个文件就是定量的结果。</p>
<p>将定量的结果转换为表达矩阵。 根据前文的案例，将所有的样本都转化为表达矩阵，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/CfbkHFK2C5.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsem-generate-data-matrix *_rsem.genes.results &gt; output.matrix</div></pre></td></tr></table></figure>
<p>第1列是基因名称，第2到第5列是样本的整合，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/gA34B244lE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>有的基因表达量是0,随后可以将基因表达量为0的基因去掉，并且将表头进行更改，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;BEGIN&#123;print &quot;geneid\ta1\ta2\tb2\tb2\n&quot;&#125;&#123;if($2+$3+$4+$5&gt;0)print $0&#125;&apos; output.matrix &gt; deseq2_input.txt</div></pre></td></tr></table></figure>
<p>运行后，查看一下原来的行数 wc -l output.matrix与wc -l deseq2_input.txt，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/7aAEcgKDja.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上图中，去掉基因表达量为0的基因前，矩阵是37337行，去掉后为17971行，后续用deseq2_input.txt进行分析 。现在 建立一个06deseq_out的文件夹，进行差异分析，并将deseq2_input.txt复制过去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir 06deseq_out</div><div class="line">mv deseq2_input.txt ../06deseq_out/</div></pre></td></tr></table></figure>
<p>接着用R语言进行分析，代码如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">getwd()</div><div class="line"># 获取当前目录</div><div class="line"></div><div class="line">setwd(&quot;D:\\netdisk\\biotest\\rnaseq&quot;)</div><div class="line"># 将工作目录定位到测序结果的目录</div><div class="line"></div><div class="line">source(&quot;http://bioconductor.org/biocLite.R&quot;)</div><div class="line"># 调用biocLite</div><div class="line"></div><div class="line">biocLite(&quot;DESeq2&quot;)</div><div class="line">biocLite(&quot;edgeR&quot;)</div><div class="line"># 安装分析数据所用的包</div><div class="line">install.packages(&quot;ggrepel&quot;)</div><div class="line"></div><div class="line">library(DESeq2)</div><div class="line">library(edgeR)</div><div class="line">library(ggrepel)</div><div class="line">library(ggplot2)</div><div class="line"></div><div class="line">input_data &lt;- read.table(</div><div class="line">  &quot;D:\\netdisk\\biotest\\rnaseq\\06deseq_out\\deseq2_input.txt&quot;,</div><div class="line">  header = TRUE, </div><div class="line">  row.names=1)</div><div class="line"># 导入数据，其中添加row.names=1是将第1列设为矩阵的名称</div><div class="line">input_data &lt;- round(input_data,digits = 0)</div><div class="line"># reads数都是整数，因此要保留整数部分，否则后面会出错</div><div class="line"></div><div class="line"></div><div class="line">input_data &lt;- as.matrix(input_data)</div><div class="line">condition &lt;- factor(c(rep(&quot;ctl&quot;,2),rep(&quot;exp&quot;,2)))</div><div class="line">coldata &lt;- data.frame(row.names = colnames(input_data),condition)</div><div class="line">dds &lt;- DESeqDataSetFromMatrix(countData = input_data,            </div><div class="line">                              colData = coldata,</div><div class="line">                              design = ~condition)</div><div class="line"># dds是分析矩阵</div><div class="line"></div><div class="line"></div><div class="line">dds &lt;- DESeq(dds)</div><div class="line">res &lt;- results(dds,alpha = 0.05)</div><div class="line"># 提取分析结果</div><div class="line"></div><div class="line">summary(res)</div><div class="line"># 查看分析结果</div><div class="line"></div><div class="line">names(resdata)[1] &lt;- &quot;Gene&quot;</div><div class="line"></div><div class="line">res &lt;- res[order(res$padj),]</div><div class="line">resdata &lt;- merge(as.data.frame(res),</div><div class="line">                 as.data.frame(counts(dds,normalized = TRUE)),</div><div class="line">                 by = &quot;row.names&quot;,sort = FALSE)</div><div class="line"></div><div class="line">write.table(resdata,file=&quot;diffexpr_results.txt&quot;,</div><div class="line">            sep=&quot;\t&quot;,</div><div class="line">            quote = F,</div><div class="line">            row.names = F)</div><div class="line"></div><div class="line">plotMA(res)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/30ADKLgKb4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">maplot &lt;- function(res,thresh = 0.05, labelsig = TRUE, ...)&#123;</div><div class="line">  with(res, plot(baseMean, log2FoldChange, pch=20, cex=.5, log=&quot;x&quot;,...))</div><div class="line">  with(subset(res,padj&lt;thresh),points(baseMean, log2FoldChange, col=&quot;red&quot;,pch=20, cex = 1.5))</div><div class="line">&#125;</div><div class="line"></div><div class="line">maplot(resdata,main=&quot;MA plot&quot;)</div></pre></td></tr></table></figure>
<p>构建的maplot函数的绘图：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/eHcm7EhggC.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">resdata$significant &lt;- as.factor(resdata$padj&lt;0.05 &amp; abs(resdata$log2FoldChange) &gt;1)</div><div class="line"></div><div class="line">ggplot(data=resdata, aes(x=log2FoldChange, y = -log10(padj),color = significant)) +</div><div class="line">  geom_point()+</div><div class="line">  ylim(0, 8)+</div><div class="line">  scale_color_manual(values = c(&quot;black&quot;,&quot;red&quot;))+</div><div class="line">  geom_hline(yintercept = -log10(0.05),lty=4, lwd=0.6,alpha=0.8)+</div><div class="line">  geom_vline(xintercept = c(1,-1),lty=4,lwd=0.6,alpha=0.8)+</div><div class="line">  theme_bw()+</div><div class="line">  theme(panel.border = element_blank(),</div><div class="line">        panel.grid.major = element_blank(),</div><div class="line">        axis.line = element_line(colour = &quot;black&quot;))+</div><div class="line">  labs(title=&quot;Volcanoplot_biotest(by RVDSD)&quot;, x=&quot;log2(fold change)&quot;,</div><div class="line">       y=&quot;-log10(padj&quot;)+</div><div class="line">  theme(plot.title = element_text(hjust = 0.5))+</div><div class="line">  geom_text_repel(data=subset(resdata, -log10(padj) &gt; 6),</div><div class="line">                  aes(label = Gene),col=&quot;black&quot;,</div><div class="line">                  alpha = 0.8)</div></pre></td></tr></table></figure>
<p>ggplot2绘制的火山图： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180330/Hc3193k2c9.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2018/03/19/Linux-虚拟机Ubuntu与windows的文件夹共享/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/Linux-虚拟机Ubuntu与windows的文件夹共享/" itemprop="url">虚拟机Ubuntu与windows的文件夹共享</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T12:02:00+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物信息学/" itemprop="url" rel="index">
                    <span itemprop="name">生物信息学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  190
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol style="list-style-type: decimal">
<li><p>在虚拟机Vmware的菜单栏上，单击“安装VMware Tools”，随后在虚拟机中出现VMware-tools-distrib的文件，将其解压到Documnts文件夹，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/b3el81mc1k.png?imageslim" alt="mark"></p></li>
<li><p>打开解压后的文件夹，文件夹中有这些文件，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/AFjJDIh5bB.png?imageslim" alt="mark"></p></li>
</ol>
<p>３. 右键打开Terminal，输入<code>sudo ./vmware-install.pl</code>进行安装，一路回车就行。</p>
<ol start="4" style="list-style-type: decimal">
<li>重启电脑，若不重启电脑，虚拟机的设置选项中的共享文件夹是灰色的，无法进行选择。现在切换到这个选项卡，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/K94gGA2BGB.png?imageslim" alt="mark"></li>
</ol>
<p>选择“总是启用“，并添加相应的文件夹（我的文件夹是bitest），如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/hF1Dic9f1I.png?imageslim" alt="mark"></p>
<ol start="5" style="list-style-type: decimal">
<li>打开Ubuntu中的以下目录 <code>/mnt/hgfs</code>就可以看到了共享的文件夹了。 <img src="http://ortxpw68f.bkt.clouddn.com/professional/180324/JGAeIDCKKB.png?imageslim" alt="mark"></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">54</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共161.4k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
