<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/19/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/19/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/03/BioStatistics/生物统计-06T分布与检验/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/BioStatistics/生物统计-06T分布与检验/" itemprop="url">t分布与t检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T12:00:00+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,088
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="t分布"><a href="#t分布" class="headerlink" title="t分布"></a>t分布</h2><p>具有正态分布$N(\mu,\sigma)$观测值的样本量为n的样本均值也是正态分布变量，在统计推断中往往希望利用它减去总体的均值再除以均值的总体标准差来得到标准正态变量，如下所示：</p>
<p>$Z=\frac{\bar{X}-\mu}{\sigma\sqrt{n}}$</p>
<p>在这个变换中，如果用均值的样本标准差来代替其未知的总体标准差时（因为总体的标准差往往未知），即用$(\bar{x}-\mu)/(s/\sqrt{n})$代替$(\bar{x}-\mu)/(\delta/\sqrt{n})$，如下所示：</p>
<p>$t=\frac{\bar{X}-\mu}{s\sqrt{n}}$</p>
<p>得到的分布就不再是标准正态分布了，它的密度曲线有点像正态分布，不过中间瘦，尾巴长，这种分布称为<strong>t分布</strong>（t-distribution，或称为学生分布，Student’s t），这个分布是戈塞特（Gosset）发现的，他当时用t来表示这个变量，当时戈塞特在发表论文中，他使用的笔名是Student，因此也叫学生分布，不同的样本量通过标准化所产生的t分布也不同，这样就形成了一族分布，t分布族中的成员是以自由度来区分的，这里的自由度等于样本量减去1，即n-1，t分布通常用于研究小样本的均值，如果自由度趋于无穷，那么t分布就是标准正态分布了，一个有k个自由度的t分布用t(k)表示，下图就展示了标准正态分布N(0,1)和自由度等于1的t(1)以及自由度等于2的t(2)分布的密度函数曲线，我们可以看出，t分布两边尾巴比较长，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">xt&lt;-seq(-<span class="number">4</span>,<span class="number">4</span>,length=<span class="number">300</span>)</div><div class="line">yt1&lt;-data.frame(x=xt,y=dnorm(xt),group=rep(<span class="string">"N(0,1)"</span>,<span class="number">300</span>))</div><div class="line">yt2&lt;-data.frame(x=xt,y=dt(xt,<span class="number">2</span>),group=rep(<span class="string">"t(2)"</span>,<span class="number">300</span>))</div><div class="line">yt3&lt;-data.frame(x=xt,y=dt(xt,<span class="number">1</span>),group=rep(<span class="string">"t(3)"</span>,<span class="number">300</span>))</div><div class="line">y_t &lt;- rbind(yt1,yt2,yt3)</div><div class="line">ggplot(y_t,aes(x=x,y=y,color=group))+geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180818/IjiL215LF9.png?imageslim" alt="mark"></p>
<p>通常使用$t_{\alpha}$表示t分布相应于右侧尾概率$\alpha$的t变量的$\alpha$上侧分位数，即对t分布变量T，有$P(T&gt;t_{\alpha})=\alpha$，下图就表示了自由度为2的t(2)分布右边的尾概率（$\alpha=0.05$），如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180716/4CDKF3aHd4.png?imageslim" alt="mark"></p>
<h3 id="t分布的密度分布图"><a href="#t分布的密度分布图" class="headerlink" title="t分布的密度分布图"></a>t分布的密度分布图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x &lt;- seq(-<span class="number">5</span>,<span class="number">5</span>,length.out=<span class="number">1000</span>)</div><div class="line">y &lt;- dt(x,<span class="number">1</span>,<span class="number">0</span>)</div><div class="line">plot(x,y,col=<span class="string">"red"</span>,xlim=c(-<span class="number">5</span>,<span class="number">5</span>),ylim=c(<span class="number">0</span>,<span class="number">0.5</span>),type=<span class="string">"l"</span>,</div><div class="line">xaxs=<span class="string">"i"</span>,yaxs=<span class="string">"i"</span>,ylab=<span class="string">"density"</span>,xlab=<span class="string">""</span>,</div><div class="line">main=<span class="string">"The T density distribution"</span>)</div><div class="line">lines(x,dt(x,<span class="number">5</span>,<span class="number">0</span>),col=<span class="string">"green"</span>)</div><div class="line">lines(x,dt(x,<span class="number">5</span>,<span class="number">2</span>),col=<span class="string">"blue"</span>)</div><div class="line">lines(x,dt(x,<span class="number">50</span>,<span class="number">4</span>),col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"topleft"</span>,legend=paste(<span class="string">"df="</span>,c(<span class="number">1</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">50</span>),<span class="string">"ncp="</span>,c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>)),lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"green"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/t%20density%20distribution.png" alt=""></p>
<h3 id="t分布的累积分布图"><a href="#t分布的累积分布图" class="headerlink" title="t分布的累积分布图"></a>t分布的累积分布图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">set.seed(1)</div><div class="line">x&lt;-seq(-5,5,length.out=1000)</div><div class="line">y&lt;-pt(x,1,0)</div><div class="line">plot(x,y,col=&quot;red&quot;,xlim=c(-5,5),ylim=c(0,0.5),type=&apos;l&apos;,</div><div class="line">xaxs=&quot;i&quot;, yaxs=&quot;i&quot;,ylab=&apos;density&apos;,xlab=&apos;&apos;,</div><div class="line">main=&quot;The T Cumulative Distribution Function&quot;)</div><div class="line">lines(x,pt(x,5,0),col=&quot;green&quot;)</div><div class="line">lines(x,pt(x,5,2),col=&quot;blue&quot;)</div><div class="line">lines(x,pt(x,50,4),col=&quot;orange&quot;)</div><div class="line">legend(&quot;topleft&quot;,legend=paste(&quot;df=&quot;,c(1,5,5,50),&quot; ncp=&quot;, c(0,0,2,4)), lwd=1, col=c(&quot;red&quot;, &quot;green&quot;,&quot;blue&quot;,&quot;orange&quot;))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180716/gDJ786KC9E.png?imageslim" alt="mark"></p>
<h2 id="某一数据是否符合t分布"><a href="#某一数据是否符合t分布" class="headerlink" title="某一数据是否符合t分布"></a>某一数据是否符合t分布</h2><p>Kolmogorov-Smirnov连续分布检验: 检验单一样本是不是服从某一预先假设的特定分布的方法。以样本数据的累计频数分布与特定理论分布比较，若两者间的差距很小，则推论该样本取自某特定分布族。<br>该检验原假设为H0:数据集符合T分布，H1:样本所来自的总体分布不符合T分布。令F0(x)表示预先假设的理论分布，Fn(x)表示随机样本的累计概率(频率)函数.<br>统计量D为: D=max|F0(x) - Fn(x)|<br>D值越小，越接近0，表示样本数据越接近T分布<br>p值，如果p-value小于显著性水平α(0.05)，则拒绝H0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set.seed(1)</div><div class="line">S&lt;-rt(1000, 1,2)</div><div class="line">ks.test(S, &quot;pt&quot;, 1, 2)</div></pre></td></tr></table></figure>
<p>其中p-value = 0.5461，说明数据集S符合df1=1, ncp=2的T分布</p>
<h2 id="方差齐性检验"><a href="#方差齐性检验" class="headerlink" title="方差齐性检验"></a>方差齐性检验</h2><p>t检验过程，是对两样本均数(mean)差别的显著性进行检验。惟t检验须知道两个总体的方差(Variances)是否相等；t检验值的计算会因方差是否相等而有所不同。也就是说，t检验须视乎方差齐性(Equality of Variances)结果。但现在多数统计软件中已经有了方差不齐情况下的检验。另外，在ANOVA检验中，也要进行方差齐性检验。</p>
<h2 id="t检验"><a href="#t检验" class="headerlink" title="t检验"></a>t检验</h2><p>T检验，亦称student t检验（Student’s t test），主要用于样本含量较小（例如n&lt;30），<strong>总体标准差σ未知</strong>的正态分布资料。</p>
<p>在此要提一下Z检验。<br>Z检验是一般用于<strong>大样本（即样本容量大于30）</strong>平均值差异性检验的方法。它是用<strong>标准正态分布</strong>的理论来推断差异发生的概率，从而比较两个平均数&gt;平均数的差异是否显著。当<strong>已知标准差</strong>时，验证一组数的均值是否与某一期望值相等时，用Z检验。</p>
<p>R中t检验的函数为t.test()，参数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">t.test(x, <span class="keyword">...</span>)</div><div class="line"></div><div class="line">t.test(x, y = <span class="literal">NULL</span>,alternative = c(<span class="string">"two.sided"</span>, <span class="string">"less"</span>, <span class="string">"greater"</span>),mu = <span class="number">0</span>, paired = <span class="literal">FALSE</span>, var.equal = <span class="literal">FALSE</span>,      conf.level = <span class="number">0.95</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>参数说明<br>其中x, y是我们样本数据构成的向量，alternative表示备择假设的形式，“two.sided”表示双边检验（H1: 1不等于μ2）， “less”表示单边检验（H1:μ1小于μ2），“greater”表示单边检验（H1:μ1大于μ2），paired表示样本是否是配对的，var.equal表示两总体方差是否相等。</p>
<h3 id="案例运用"><a href="#案例运用" class="headerlink" title="案例运用"></a>案例运用</h3><h4 id="配对t检验"><a href="#配对t检验" class="headerlink" title="配对t检验"></a>配对t检验</h4><p>例3-6为比较两种方法对乳酸饮料中脂肪含量测定结果是否不同，随机抽取了10份乳酸饮料制品，分别用脂肪酸水解法和哥特里－罗紫法测定其结果如表3-5第(1)~(3)栏。问两法测定结果是否不同？（《医学统计学》（第四版，孙振球）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_306.csv&quot;,sep=&quot;\t&quot;)</div><div class="line"># read raw data</div><div class="line"></div><div class="line">t.test(raw_data$result[1:10]-raw_data$result[11:20],mu=0)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; t.test(raw_data$result[<span class="number">1</span>:<span class="number">10</span>]-raw_data$result[<span class="number">11</span>:<span class="number">20</span>],mu=<span class="number">0</span>)</div><div class="line"></div><div class="line">	One Sample t-test</div><div class="line"></div><div class="line">data:  raw_data$result[<span class="number">1</span>:<span class="number">10</span>] - raw_data$result[<span class="number">11</span>:<span class="number">20</span>]</div><div class="line">t = <span class="number">7.926</span>, df = <span class="number">9</span>, p-value = <span class="number">2.384e-05</span></div><div class="line">alternative hypothesis: true mean is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.1946542</span> <span class="number">0.3501458</span></div><div class="line">sample estimates:</div><div class="line">mean of x </div><div class="line">   <span class="number">0.2724</span></div></pre></td></tr></table></figure>
<p>结果与书中相同，p值小于0.01，但我觉得这个方法不一定要用配对t检验，普通的t检验也能胜任。</p>
<h4 id="双样本t检验"><a href="#双样本t检验" class="headerlink" title="双样本t检验"></a>双样本t检验</h4><p>例3-7  为研究国产四类新药阿卡波糖胶囊的降血糖效果，某医院用40名II型糖尿病病人进行同期随机对照试验。研究者将这些病人随机等分到试验组(用阿卡波糖胶囊)和对照组(用拜唐苹胶囊)，分别测得试验开始前和8周时的空腹血糖，算得空腹血糖下降值见表3-6，能否认为该国产四类新药阿卡波糖胶囊与拜唐苹胶囊对空腹血糖的降糖效果不同？（《医学统计学》（第四版，孙振球）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_307.csv&quot;,,header=T,sep=&quot;,&quot;)</div><div class="line"></div><div class="line">a &lt;- as.numeric(raw_data[,1])</div><div class="line">b &lt;- as.numeric(raw_data[,2])</div><div class="line">t.test(a,b)</div></pre></td></tr></table></figure>
<p>运算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	Welch Two Sample t-test</div><div class="line"></div><div class="line">data:  a and b</div><div class="line">t = -<span class="number">0.64187</span>, df = <span class="number">36.086</span>, p-value = <span class="number">0.525</span></div><div class="line">alternative hypothesis: true difference <span class="keyword">in</span> means is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> -<span class="number">2.32926</span>  <span class="number">1.20926</span></div><div class="line">sample estimates:</div><div class="line">mean of x mean of y </div><div class="line">    <span class="number">2.065</span>     <span class="number">2.625</span></div></pre></td></tr></table></figure>
<p>结果p值为0.525。因此尚不能认为阿卡波糖胶囊与拜唐苹胶囊对空腹血糖的降糖效果不同。</p>
<h2 id="t检验的局限"><a href="#t检验的局限" class="headerlink" title="t检验的局限"></a>t检验的局限</h2><p>虽然t检验使用起来很方便，但是如果不加以注意，很容易误用，经常误用的情况包括：</p>
<ol>
<li>不考虑数据的正态性，只要是两组比较就直接使用t检验（如果不符合正态性，就要采用Wilcoxon检验）。</li>
<li>将t检验用于多组实验设计中的两两比较，增加假阳性错误（此时应该使用ANOVA）；</li>
<li>不考虑资料是否独立，采用独立资料的t检验分析。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/03/BioStatistics/生物统计-03假设检验笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/BioStatistics/生物统计-03假设检验笔记/" itemprop="url">假设检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T12:00:00+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,158
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="用小概率事件进行判断"><a href="#用小概率事件进行判断" class="headerlink" title="用小概率事件进行判断"></a>用小概率事件进行判断</h2><p>我们有时候会听到“意外发生了”这样的说法，这句话意味着我们相信某个事件发生的概率很小，也就是说它预期不会发生，但是它发生了，例如，没有人会对一个大城市某一天发生交通事故感到意外，因为这要瓣城市每天都发生大量的交通事故，但如果某一天没有发生交通事故，就真是意外了，即小概率事件发生了，另外，人们会觉得一个从来没有出过事故的老司机出事故的概率很小，如果这个司机发生事故了，人们会由于小概率事件发生了而觉得意外。</p>
<p>在统计中，我们常用小概率事件对某项论述进行判断，假如我们对于某个说法表示怀疑，并且试图否定这个说法，那么，我们就要表示，这个说法成立的情况下，我们所观测的数据出现的概率很小。我们用下面的例子说明，人们如何计算用来否定某种说法的这种概率。比如，某大型百货商场说它的抽奖活动有10%的可能抽到奖，而有人注意到有70人抽奖，结果都未中奖，这样人们就会怀疑这个商场作假，在奖券很多的情况下，我们可以假定抽奖70次中成功的次数应该服从二项分布Bin(70,p)，按照商场的说法，每次中奖概率p=0.10，因此我们可以诈出70次抽奖没有人中奖的概率是0.0006265787</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dbinom(<span class="number">0</span>,<span class="number">70</span>,<span class="number">0.1</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.0006265787</span></div></pre></td></tr></table></figure>
<p>也就是说，按照商场的差距中奖概率的说法，70次抽奖都没有抽中的概率只有约万分之六，由此70交抽奖没有人中奖就是发生了小概率事件，这里的“小概率”事件是根据商场提供的参数p=0.1计算出来的，因此我们有理由怀疑商场中关于p=0.1说法的合理性。这里我们所做的就是按照某个假定（这里的商场的说法）来计算随机试验发生某结果的概率，如果小概率事件发生，那么我们有理由质疑那个假定。</p>
<p>假设检验的原理也是如此。</p>
<h2 id="假设检验的基本原理"><a href="#假设检验的基本原理" class="headerlink" title="假设检验的基本原理"></a>假设检验的基本原理</h2><p>在实际中我们会遇到这样的问题：某一样本均数是否来自于某已知均数的总体？两个不同样本均数是否来自均数不相等的总体等？要回答这类问题，经常使用统计推断的一个方法，即假设检验（hypothesis test）来解决。<br>假设检验过去称为显著性检验（significance test），它是利用小概率反证法的思想，从问题的对立面（$H_{0}$）出发，间接判断要解决的问题（$H_{0}$）是否成立。即在假设$H_{1}$成立的条件下计算检验统计是不是，然后根据获得的P值来判断。其原理和步骤用以下实例说明。</p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>例3-5 某医生测量了36名人事铅作用男性工人的血红蛋白含量，算得其均数为130.83g/L，标准差为25.74g/L，问：人事铅作用男性工人的血红蛋白含量均数($\mu$)是否不等于正常成年男性的无数140g/L（$\mu_{0}$）？（医学统计学第四版，孙振球）</p>
<p>本题的目的是判断是否$\mu \neq \mu_{0}$，从所给的条件来看，样本均数$\bar{X}$与已知总体均数$\mu_{0}$不等，造成两者不等的原因有二：①从事铅作用工人的血红蛋白含量确实高于正常成年男性，即非同一总体（$\mu \neq \mu_{0}$）；②因抽样误差导致两者不等，即为同一总体（$\mu = \mu_{0}$）。<br>要直接证明是否$\mu \neq \mu_{0}$很难，但可以利用反证法的思想，从$\mu \neq \mu_{0}$的对立面$\mu = \mu_{0}$出发，间接判断是否$\mu \neq \mu_{0}$。<br>假设：$\mu = \mu_{0}$，判断由于抽样误差造成不相等的可能性有多大？</p>
<p>如果$\bar{X}$与$\mu_{0}$接近，其差别可用抽样误差解释，可认为$\bar{X}$来自$\mu_{0}$总体；如果$\bar{X}$与$\mu_{0}$相关甚远，不宜用抽样误差解释，则怀疑$\bar{X}$不是来自$\mu_{0}$总体，那么$\bar{X}$与$\mu_{0}$相关多大算是由抽样误差造成的呢？若假设$\mu = \mu_{0}$成立，则可用公式$\frac{\bar{X}-\mu}{S/\sqrt{n}} =t$或$\frac{\bar{X}-\mu}{\delta/ \sqrt{n}} =\mu$计算t值或$\mu$值，然后由t值或$\mu$值求得P值来判断。如果$\bar{X}$与$\mu_{0}$相差较过错，t或$\mu$值就大，P值就小，当P小于或等于预先规定的概率值$\alpha$，如0.05时，则为小概率事件。小概率事件在一次抽样中发生的可能性很小，如果它发生了，则有理由怀疑原假设$\mu = \mu_{0}$可能不成立，认为其对立面$\mu \neq \mu_{0}$成立，该结婚的正确性冒着5%的错误风险。</p>
<p>从上面分析可以看出，假设检验可归纳为三大基本步骤。</p>
<ol>
<li>建立检验假设，确定检验水准，假设有两种：<br>(1) $\mu = \mu _{0}$，常称为无效假设或零假设，用$H_{0}$表示。<br>(2) $\mu \neq \mu _{0}$，常称为备选假设，用$H_{1}$表示。</li>
</ol>
<p>对于假设检验，需要注意的是：</p>
<ol>
<li>检验假设针对的是总体，而不是样本；</li>
<li>$H_{0}$和$H_{1}$是相互关系、对立的假设，后面统计推断的结论是根据$H_{0}$和$H_{1}$作出的，两者缺一不可；</li>
<li>$H_{0}$为无效假设，其假定通常是：某两个（或多个）总体参数相等，或某两个总体参数之差为0，或某资料服从某一特定分布；</li>
<li><p>$H_{1}$的内容直接反映了检验的单双侧，若$H_{1}$为$\mu &gt; \mu_{0}$或$H_{1}$为$\mu &lt; \mu_{0}$，则此检验为单侧检验，它不仅考虑是否有差异，而且还考虑差异的方向，假如上述例3-5中医生只关心铅作业男性工人的血红蛋白含量均数是否低于正常男性的均数；若$H_{1}$为$\mu \neq \mu_{0}$，则此检验为双侧检验，例如上述例题中的问题，从事铅作业男性工人的血红蛋白含量均数是否不等于男性的均数140g/L，此时高于和低于正常男性这两种可能性都存在。单侧检验的确定，首先要根据专业知识，其次是根据所要解决的问题来确定。若从专业上看一种方法的结果不可能低于或高于另一种方法，尽量提问为：两种方法的测定结果是否相同？此时仍用单侧检验。一般认为，双侧检验比较保守和稳妥，探索性研究多用双侧检验；而证实性研究多用单侧检验。现在以单样本和两样本均数比较的t检验为例，用下面两张表说明单双侧检验的确定。<br><img src="http://ortxpw68f.bkt.clouddn.com/hypothesis%20test2.png" alt=""></p>
<p>(3)$\alpha$：即检验水准，也称显著性水准，它属于I型错误的范畴，$\alpha$是预先规定的概率值，它确定了小概率事件的标准，在实际工作中，常取$\alpha=0.05$。除了I型错误外，还有II型错误。后面会详细说明第1类错误和第2类错误。</p>
</li>
</ol>
<h2 id="第一类错误和第二类错误"><a href="#第一类错误和第二类错误" class="headerlink" title="第一类错误和第二类错误"></a>第一类错误和第二类错误</h2><h3 id="第一类错误"><a href="#第一类错误" class="headerlink" title="第一类错误"></a>第一类错误</h3><p>第一类错误又称Ⅰ型错误、拒真错误，是指拒绝了实际上成立的、正确的假设，为“弃真”的错误，其概率通常用α表示。即“原假设是正确的，却拒绝了原假设”。我们平时遇到的文献里，基本上都是与第一类错误有关的假设检验，这就是我们常说的“假阳性”，即无中生有，本来实验结果是阳性，非常高兴，后来才发现这是假阳性，把本来不存在的事情，当作了存在。</p>
<h3 id="第二类错误"><a href="#第二类错误" class="headerlink" title="第二类错误"></a>第二类错误</h3><p>第二类错误又称Ⅱ型错误，接受了实际上不成立的H0 ，也就是错误地判为无差别，这类取伪的错误称为第二类错误，其概率用β表示。即“原假设是错误的，却没有拒绝原假设”，这可以理解为“假阴性“，下面的一幅图可以很清楚地说明第一类错误与第二类错误：</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703212334.png" alt=""></p>
<h3 id="第一类错误和第二类错误的关系"><a href="#第一类错误和第二类错误的关系" class="headerlink" title="第一类错误和第二类错误的关系"></a>第一类错误和第二类错误的关系</h3><p>当样本例数固定时，α愈小，β愈大；反之，α愈大，β愈小。因而可通过选定α控制β大小。要同时减小α和β，唯有增加样本例数。统计上将1-β称为检验效能或把握度(power of a test)，即两个总体确有差别存在，而以α为检验水准，假设检验能发现它们有差别的能力。实际工作中应权衡两类错误中哪一个重要以选择检验水准的大小。</p>
<h3 id="对第一类错误和第二类错误的简单理解"><a href="#对第一类错误和第二类错误的简单理解" class="headerlink" title="对第一类错误和第二类错误的简单理解"></a>对第一类错误和第二类错误的简单理解</h3><p>我们常把假设检验比作法庭判案，我们想知道被告是好人还是坏人。原假设是“被告是好人”，备择假设是“被告是坏人”。法庭判案会犯两种错误：如果被告真是好人，而你判他有罪，这是第一类错误(错杀好人)；如果被告真是坏人，而你判他无罪，这是第二类错误(放走坏人)。</p>
<p>记忆方法：我们可以把第一类错误记为“以真为假”，把第二类错误记为“以假为真”。当然我们也可以将第一类错误记为“错杀好人”，把第二类错误记为“放走坏人”。</p>
<p>在其他条件不变的情况下，如果要求犯第一类错误概率越小，那么犯第二类错误的概率就会越大。这个结论比较容易理解，当我们要求“错杀好人”的概率降低时，那么往往就会“放走坏人”。</p>
<p>同样的，在其他条件不变的情况下，如果要求犯第二类错误概率越小，那么犯第一类错误的概率就会越大。当我们要求“放走坏人”的概率降低时，那么往往就会“错杀好人”。同样的，在其他条件不变的情况下，如果要求犯第二类错误概率越小，那么犯第一类错误的概率就会越大。当我们要求“放走坏人”的概率降低时，那么往往就会“错杀好人”。</p>
<h2 id="p值的理解"><a href="#p值的理解" class="headerlink" title="p值的理解"></a>p值的理解</h2><p>在假设检验中，拒绝零假设时所允许的最大的犯第一类错误的概率称为显著性水平(level of significance或significance level)，通常用α表示。显著性水平通常是由进行检验的根据实际目标确定的。最常用的显著性水平为0.05，0.01，0.005，0.001等。</p>
<p>在假设检验中，我们通常使用样本的一个统计量作为证据来称量零假设的真伪，该统计量称为检验统计量(test statistic)，和检验统计量关联的一个概念是p值(p-value)，它是在零假设下，出现检验统计量的实现值以及（向备选假设方向）更极端的值的概率，有关p值的更好理解，可以参见这一篇文章<a href="https://mp.weixin.qq.com/s/4LmVdoQdxDlZ6xOgSfXRaA" target="_blank" rel="external">《p值详解》</a>。</p>
<p>p值度量从样本数据得到的信息对零假设的支持程度。因此，p值越小，越有理由说明样本数据不支持零假设。如果p值小于显著性水平α，那么能够拒绝零假设，否则就不能拒绝零假设。因此p值常常被称为该检验的<strong>观测显著性水平(observed level of significance)</strong>。在统计软件的输出中，通常只输出p值，而由用户自己决定p值是多少时拒绝零假设。p值是由数据决定的，而显著性水平是由用户决定的。计算软件仅仅给出p值，而不给出α，例如我们计算得到的p值是0.0005，这时如果以α=0.05为显著性水平，那么此时就拒绝零假设，如果以α=0.001为显著性水平，那么就无法拒绝零假设。α=0.05表明，拒绝零假设时犯错误的概率是百分之五，α=0.001表明，拒绝零假设时犯错误的概率是千分之一。在统计软件的输出结果中，有的使用“p-value”，有的使用significance的缩写，即“Sig”来标明。</p>
<p>根据数据产生的p值来减少α的值以展示结果的精确性总是没有害处的。这就好比一个身高180cm的男生，可能愿意被认为高于或等于180cm，而不愿意被说成高于或等于155cm，虽然第二种说法在数学上没有丝毫错误。</p>
<h3 id="在实际情况中，如何把握α与β错误"><a href="#在实际情况中，如何把握α与β错误" class="headerlink" title="在实际情况中，如何把握α与β错误"></a>在实际情况中，如何把握α与β错误</h3><p>举个例子，某研究者研究一个化合物A，原假设（H0）：化合物A对于改善糖尿病没有作用。而化合物A可能对改善糖尿病有作用，也可能没有作用。</p>
<p>如果化合物A真的没有作用，而研究的数据支持A有作用，则是犯了第一类错误（即无中生有）。</p>
<p>如果化合物A真的有作用，而数据支持A没有作用，则是犯了第二类错误（即有中生无）。<br>对于研究者来说，如何把握呢？如果把第一类错误标准定得过于宽松，很容易得到化合物A有作用的结论，把没有效果的东西当作是有效果的，他会把自己的研究结果报告，或者发布到学术界中。其他研究者便会去尝试重复实验，投入大量的人力和物力，去搞一个原本就不存在东西上，这就是极大的浪费，就像某医药公司看到了化合物A能够降改善糖尿病的论文，就投入大量资源去研究（事实上化合物A根本没有作用），这样就会造成浪费。因此宁可把第一类错误的标准定得高一些，这样即使犯了第二类错误，也不至于在本不存在的事情上浪费资源。</p>
<h2 id="假设检验中的一些注意事项"><a href="#假设检验中的一些注意事项" class="headerlink" title="假设检验中的一些注意事项"></a>假设检验中的一些注意事项</h2><p>某些书中会提到，不能拒绝零假设就接受零假设的说法，而且没有给出犯第二类错误的概率，这是不恰当的。首选，你说“接受零假设”，那么就应该负责任地提供接受零假设时可能犯第二类错误的概率，这就要算出在备选假设正确的情况下，错误地接近零假设的概率。但是，这只有在备选假设仅仅是一个与零假设不同的确定值（而不是范围）时才有可能，多数初等统计教科书中的备选假设是一个范围，例如前面提到例题，在这个例题中，H0:μ=50，H1:μ&lt;50，在这种情况下，根本无法确定犯第二类错误的概率。</p>
<p>在很多应用回归分析的方法中，也有不少书中往往把一系列不能拒绝零假设的检验当成接受这些假设的通行证。比如不能拒绝某样本的正态性就变成了证明该样本是正态的等。其实，不能拒绝这些零假设，仅仅说明，根据当前所使用的检验方法和当前的数据，没有足够证据拒绝这些假设而已。因此，在不能拒绝零假设时，只能够说，按照目前的证据和检验方法，不足以拒绝零假设。</p>
<h2 id="效应"><a href="#效应" class="headerlink" title="效应"></a>效应</h2><h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><p><a href="https://www.zhihu.com/question/20993864/answer/81244176" target="_blank" rel="external">第一类错误和第二类错误的关系是什么？马志阳的回答</a><br><a href="https://zhuanlan.zhihu.com/p/25734905" target="_blank" rel="external">假设检验之五：α风险 vs. β风险</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/02/BioStatistics/生物统计-02点估计与区间估计笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/02/BioStatistics/生物统计-02点估计与区间估计笔记/" itemprop="url">点估计与区间估计笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-02T12:00:00+08:00">
                2017-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,047
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  24
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="点估计"><a href="#点估计" class="headerlink" title="点估计"></a>点估计</h2><p>用于估计总体参数的统计量叫做估计量(estimator)。统计量是随机变量，估计量也是，对于不同的样本，估计量的聚会也不同，对于任意取定的一个样本，把样本数据代谢估计量的公式，就得到了估计量的一个值，称为估计值(estimate)或者估计量的一个实现(realization)。</p>
<p>衡量估计量的一个标准是相合性(consistency)，这个标准表明，样本量越大，相合估计量(consistent estimator)对总体参数的估计就越精确。另一个标准就是无偏性(unbiasedness)。这意味着，虽然从一个样本得到的估计量的实现并不一定等于总体参数的值，但无穷个估计量的平均观测值（期望值）等于相应的总体参数。满足这样条件的估计量称为无偏估计量(unbiased estimator)。第三个标准就是所有相合、无偏估计量中取方差最小的估计量，也称为最有效或者最好的估计量。</p>
<p>下面看一个简单的例子来介绍一下无偏性和最小方差性。假定$X_{1},X_{2},X_{3},X_{4}$均服从某均值为$\mu$的分布的独立观测值。如果我们需要从下面四个关于$\mu$的估计量中选择一个，那么根据随机变量线性组合的总体均值和方差的性质，这四个估计量的均值都是$\mu$，因此这个统计量都是$\mu$的无偏估计量，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180806/AJG1HJEH2J.png?imageslim" alt="mark"></p>
<p>它们的方差分别为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180806/Lb3A5FcH4D.png?imageslim" alt="mark"></p>
<p>因此，在这四个估计量中，第1个样本均值，即$\bar{X}=\frac{1}{4} \sum\limits_{i=1}^4X_{i}$的方差最小，这个样本的估计量要优于其他三个。</p>
<p>最常用的估计量就是样本均值($\bar{x}$)、样本标准差(s)和(Bernoulli试验的)成功比例(x/n)，常用这几个统计量来分别估计总体均值($\mu$)、总体标准差($\delta$)和成功概率（或总体中具有某种特征元素的比值）p。</p>
<h2 id="区间估计"><a href="#区间估计" class="headerlink" title="区间估计"></a>区间估计</h2><p>在讲区间估计之前，先看一个简单的例子。</p>
<p>当一个人谈论他高三时班上男生的平均身高时，他不太可能会说班长男生的平均身高是“171.25厘米”，而更可能会说“在170厘米左右”或者说“在1.65米到1.75米之间”。后者就是区间估计。</p>
<p>区间估计给出了估计者认为比较可能的一个范围，例如在民间调查中，如果调查是关于对某个看法的支持率时，也可能会说“对于该看法的支持率为45%加减3%的误差，其置信度为95%”，这种描述，既给出了点估计45%，这是样本中的支持率，也给出了一个区间，即45%±3%，或置信区间(confidence interval)(42%,48%).而这里的置信度(confidence level)则是对产生这样一个区间估计的一种信心，并不涉及从样本数据得到的某一个特定的区间。</p>
<p>一般来说，我们不知道总体参数（例如总体的均值或比例）是多少，需要通过样本来估计这个总体参数，其中点估计和区间估计都是从样本中得到的，而点估计中的估计量和区间估计的两个端都是统计量，因而也是随机变量。</p>
<p>“某总体参数ξ的置信度为100(1-α)%的置信区间”这句话表明：如果我们抽取（相同样本量）的大量样本，那么，从这些样本中得到的以同样方法（或公式）计算的大量区间中会有大约1-α比例的区间包含未知的总体参数ξ，而有约α比例的区间不包含该总体参数。例如从具体的一个样本中计算出来的一个数值区间，比如前面的(42%,48%)，这个区间可能包含真实的比例，也有可能不包含真实的比例。由于真实的比例和这个区间(42%,48%)都是确定的数，不包括随机性，也没有概率可言。因此如果用这样的话来描述“95%置信区间(42%,48%)以概率0.95包括真实比例”，这样的话是错误的。如果用概率语言来描述，应该说构造95%置信区间两个端的统计量以0.95的概率包含真实的参数（我觉得可以这么理解，我们在(42%,48%)这个区间内取机抽取一些样本，这些样本有0.95的概率包含真实值）。</p>
<p>通常来说，我们希望区间越窄越好，而另一方面，我们又希望置信度越大越好，对于一定的样本量，如果要增加置信度，通常要加宽区间，而如果要使区间变窄，就要牺牲置信度。但是，如果可以变化样本量，那么在固定了区间的宽度时，置信度会随着样本量的增加而增加，而在固定置信度时，区间宽度会随着样本量的增加而变窄。这主要是因为样本量大，对总体的信息也大，区间估计就会更理想。</p>
<h2 id="正态分布总体均值-mu-的区间估计"><a href="#正态分布总体均值-mu-的区间估计" class="headerlink" title="正态分布总体均值$\mu$的区间估计"></a>正态分布总体均值$\mu$的区间估计</h2><p>假定X1,X2,..Xn是一个来自于正态分布的样本，我们可以根据这个样本求出关于这个正态总体均值的置信区间，我们知道，总体均值的一个点估计量为样本均值$\bar{X}$，我们这里所要建立的对均值的区间估计就是以$\bar{X}$为中心的一个区间，而区间的上下界是根据样本、事先选择的置信度以及正态分布的性质来确定的两个统计量。这样的置信度为1-α的随机区间由下式表示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180807/96ccl8HJeb.png?imageslim" alt="mark"></p>
<p>这里s为样本标准差，n为样本量，$t_{\alpha/2}$为自由度为n-1的t分布的上侧$\alpha/2$分位数，这里的上侧$\alpha/2$分位数是指对于t(n-1)随机变量T，$P(T&gt;t_{\alpha/2})=\alpha/2$。</p>
<p>这个区间的上下界是统计量，因此该区间是随机区间，置信度是是该随机区间覆盖真实均值的概率，如果根据一个样本的数据算出上下界的真实值，就不是随机区间了，而是一个固定的数值区间，这个区间的宽度为$t\alpha/2s\ \sqrt{n}$。因此，可以看出，当其他因素固定时，区间宽度和样本量的平方根成反比，此外，由于当置信度1-α增加时，$t_{\alpha/2}$也增加，因此当其他因素固定时，置信度增加会导致区间变宽，如果其他因素不变时，样本标准差s的减少也会导致置信区间变窄。</p>
<p>现在看一个案例。下面是某厂家标有“净重50克”的30包味精的实际重量，如下所示：</p>
<p>51.5,48.0,47.0,46.3,46.7,47.8,51.6,49.4,48.2,52.3,48.5,45.7,52.1,51.0,48.7,46.6,50.1,48.5,50.9,46.8,51.6,49.2,46.9,52.5,46.2,45.8,51.0,48.1,49.9,49.3</p>
<p>如果我们想要对这个厂家的这各味精重量的总体均值做出区间值估计，置信度取95%。</p>
<p>假定该总体服从正态分布，根据数据，计算出置信区间如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; data&lt;-c(<span class="number">51.5</span>,<span class="number">48.0</span>,<span class="number">47.0</span>,<span class="number">46.3</span>,<span class="number">46.7</span>,<span class="number">47.8</span>,<span class="number">51.6</span>,<span class="number">49.4</span>,<span class="number">48.2</span>,<span class="number">52.3</span>,<span class="number">48.5</span>,<span class="number">45.7</span>,<span class="number">52.1</span>,<span class="number">51.0</span>,<span class="number">48.7</span>,<span class="number">46.6</span>,<span class="number">50.1</span>,<span class="number">48.5</span>,<span class="number">50.9</span>,<span class="number">46.8</span>,<span class="number">51.6</span>,<span class="number">49.2</span>,<span class="number">46.9</span>,<span class="number">52.5</span>,<span class="number">46.2</span>,<span class="number">45.8</span>,<span class="number">51.0</span>,<span class="number">48.1</span>,<span class="number">49.9</span>,<span class="number">49.3</span>)</div><div class="line">&gt; data</div><div class="line"> [<span class="number">1</span>] <span class="number">51.5</span> <span class="number">48.0</span> <span class="number">47.0</span> <span class="number">46.3</span> <span class="number">46.7</span> <span class="number">47.8</span> <span class="number">51.6</span> <span class="number">49.4</span> <span class="number">48.2</span> <span class="number">52.3</span> <span class="number">48.5</span> <span class="number">45.7</span> <span class="number">52.1</span> <span class="number">51.0</span> <span class="number">48.7</span> <span class="number">46.6</span> <span class="number">50.1</span> <span class="number">48.5</span> <span class="number">50.9</span> <span class="number">46.8</span> <span class="number">51.6</span> <span class="number">49.2</span> <span class="number">46.9</span> <span class="number">52.5</span> <span class="number">46.2</span> <span class="number">45.8</span> <span class="number">51.0</span> <span class="number">48.1</span> <span class="number">49.9</span> <span class="number">49.3</span></div><div class="line">&gt; t.test(data,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">        One Sample t-test</div><div class="line"></div><div class="line">data:  data</div><div class="line">t = <span class="number">125.94</span>, df = <span class="number">29</span>, p-value &lt; <span class="number">2.2e-16</span></div><div class="line">alternative hypothesis: true mean is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">48.14524</span> <span class="number">49.73476</span></div><div class="line">sample estimates:</div><div class="line">mean of x </div><div class="line">    <span class="number">48.94</span></div></pre></td></tr></table></figure>
<p>从上面结果可以看出来，这批数据的95%置信区间为(48.14524,49.73476)。</p>
<p>或者直接通过公式进行计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; mean(data)+qt(<span class="number">0.025</span>,<span class="number">29</span>,low=<span class="literal">F</span>)*sd(data)/sqrt(<span class="number">30</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">49.73476</span></div><div class="line">&gt; mean(data)-qt(<span class="number">0.025</span>,<span class="number">29</span>,low=<span class="literal">F</span>)*sd(data)/sqrt(<span class="number">30</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">48.14524</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180807/gA6FDi3lJ0.png?imageslim" alt="mark"></p>
<p>为了说明不同置信度和不同的样本量对置信区间的影响，下图显示了n=50和n=20，以及置信度为0.95和0.60的四种排列组合情况的各自基于80个正态样本的置信区间，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180809/BBHA0c4a6j.png?imageslim" alt="mark"></p>
<p>在下图中，置信区间为两边有短的竖直线段，线段中间的点为样本均值，图中水平虚线为真实的总体均值，从图中可以看到，对于固定的样本量，置信度越大，包含总体均值的区间就越多（上下图比较）。</p>
<p>而对于相同的置信度，样本量n越大，区间狭窄（左右图比较）。在每个图内部的各个置信区间的长短也不一样，这是因为样本标准差因样本而异，这也影响置信区间的长度，从图中可以看出，每个根据样本得到的置信区间，有的覆盖真实的总体均值，有的不覆盖真实的总体均值，但众多的置信区间中覆盖总体均值的区间数量的比例则反映了置信度的大小，这些区间都是随机区间的实现，而置信度只是随机区间覆盖总体均值的概率。</p>
<p>两个独立正态分布总体均值差$\mu_{1}-\mu_{2}$的区间估计</p>
<p>假定样本量为m和n的独立样本$X_{1},\cdots,X_{m}$和$Y_{1},\cdots,Y_{n}$分别来自均值为$\mu_{1}$和$\mu_{2}$的两个独立正态总体，现在求出这两个正态总体均值之差$\mu_{1}-\mu_{2}$的置信区间。总体均值差的一个点估计量为样本均值$\bar{X}-\bar{Y}$，此时要求的均值差的区间估计就是以$\bar{X}-\bar{Y}$为中心的一个区间，而区间的上下界为根据样本、选择的置信度以及正态分布的性质来确定的两个统计量。这个计算过程由统计软件完成，但在计算的时候，要注意两点，第一，当两个总体的方差一样时，统计软件会用一种方法来计算置信区间；第二，当两个总体的方差不同时，需要用另外一种方法来计算置信区间。</p>
<p>现在看一案例。</p>
<p>下面的这组数据描述了两个生产线生产每一个零件的耗时（单位：s）记录。其中第一个生产线记录了27个时间，第二个记录了25个时间，现在我们计算一下第一个和第二个生产线生产一个零件所花的时间均值差别为95%的置信区间。我们假定两个记录均来自独立正态分布的总体，下面是这两个记录，如下所示：</p>
<p>生产线1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">25.8,30.1,26.8,33.3,26.9,33.7,34.5,24.6,31.7,39.1,29.5,25.6,28.2,29.5,32.4,23.7,</div><div class="line">26.2,28.0,30.1,31.0,29.5,37.7,28.6,27.0,29.8,27.6,29.0</div></pre></td></tr></table></figure>
<p>生产线2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">28.7,31.1,27.9,28.7,30.2,30.5,23.3,27.5,29.5,28.6,26.6,26.8,26.6,29.6,30.4,24.8,</div><div class="line">24.4,25.3,30.6,27.3,27.2,32.0,27.6,29.6,25.8</div></pre></td></tr></table></figure>
<p>在比较这两组数据之前，需要比较两个正态总体相等或不相等时，关于均值差的置信区间计算有所不同，现在我们用x和y分别表示两个样本。</p>
<p>检验方差是不相等时，使用<code>var.test(x,y)$p.value</code>，此时会得到一个数值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt; x&lt;-c(<span class="number">25.8</span>,<span class="number">30.1</span>,<span class="number">26.8</span>,<span class="number">33.3</span>,<span class="number">26.9</span>,<span class="number">33.7</span>,<span class="number">34.5</span>,<span class="number">24.6</span>,<span class="number">31.7</span>,<span class="number">39.1</span>,<span class="number">29.5</span>,</div><div class="line">+      <span class="number">25.6</span>,<span class="number">28.2</span>,<span class="number">29.5</span>,<span class="number">32.4</span>,<span class="number">23.7</span>,<span class="number">26.2</span>,<span class="number">28.0</span>,<span class="number">30.1</span>,<span class="number">31.0</span>,<span class="number">29.5</span>,<span class="number">37.7</span>,</div><div class="line">+      <span class="number">28.6</span>,<span class="number">27.0</span>,<span class="number">29.8</span>,<span class="number">27.6</span>,<span class="number">29.0</span>)</div><div class="line">&gt; y&lt;-c(<span class="number">28.7</span>,<span class="number">31.1</span>,<span class="number">27.9</span>,<span class="number">28.7</span>,<span class="number">30.2</span>,<span class="number">30.5</span>,<span class="number">23.3</span>,<span class="number">27.5</span>,<span class="number">29.5</span>,<span class="number">28.6</span>,<span class="number">26.6</span>,</div><div class="line">+      <span class="number">26.8</span>,<span class="number">26.6</span>,<span class="number">29.6</span>,<span class="number">30.4</span>,<span class="number">24.8</span>,<span class="number">24.4</span>,<span class="number">25.3</span>,<span class="number">30.6</span>,<span class="number">27.3</span>,<span class="number">27.2</span>,<span class="number">32.0</span>,</div><div class="line">+      <span class="number">27.6</span>,<span class="number">29.6</span>,<span class="number">25.8</span>)</div><div class="line">&gt; var.test(x,y)</div><div class="line"></div><div class="line">	<span class="literal">F</span> test to compare two variances</div><div class="line"></div><div class="line">data:  x and y</div><div class="line"><span class="literal">F</span> = <span class="number">2.7086</span>, num df = <span class="number">26</span>, denom df = <span class="number">24</span>, p-value = <span class="number">0.01657</span></div><div class="line">alternative hypothesis: true ratio of variances is not equal to <span class="number">1</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">1.205780</span> <span class="number">6.006175</span></div><div class="line">sample estimates:</div><div class="line">ratio of variances </div><div class="line">          <span class="number">2.708634</span> </div><div class="line"></div><div class="line">&gt; var.test(x,y)$p.value</div><div class="line">[<span class="number">1</span>] <span class="number">0.01656675</span></div></pre></td></tr></table></figure>
<p>在这个案例中，此时的p值为0.01656675，这就说明，如果说方差不相等，那么出错的概率约为0.0166，它是小于0.05的（通常以这个显著性水平来判断），因此可认为方差不等。</p>
<p>此时我们使用<code>t.test(x,y,con=0.95)$con</code>就可以得到方差不等时的95%置信区间，因为在R中，<code>t.test()</code>这个函数默认的参数中，<code>var=F</code>，如果方差相等，那么就使用<code>t.test(x,y,con=0.95,var=T)$con</code>来计算置信区间，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; t.test(x,y,con=<span class="number">0.95</span>)$con</div><div class="line">[<span class="number">1</span>] -<span class="number">0.1025709</span>  <span class="number">3.3064227</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>
<p>注：求两个样本差值的置信区间公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180809/H33EfhL97l.png?imageslim" alt="mark"></p>
<h2 id="配对正态分布总体均值差-mu-D-mu-1-mu-2-的区间估计"><a href="#配对正态分布总体均值差-mu-D-mu-1-mu-2-的区间估计" class="headerlink" title="配对正态分布总体均值差$\mu_{D}=\mu_{1}-\mu_{2}$的区间估计"></a>配对正态分布总体均值差$\mu_{D}=\mu_{1}-\mu_{2}$的区间估计</h2><p>看完了独立正态总体的均值差的区间估计。再看一下两个总体是配对的情况(paired)，这种情况下，它们的样本称为配对样本，常见的情况有减肥前后的重量比较，治疗前后的症状比较，同样情况下对两种材料某种性能的比较，看下面一个案例。</p>
<p>一个有13人畚听减肥计算实话前后所称体重列在下表中，这里的X和Y分别是减肥前后的重量，而D为其差值，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>X</th>
<th>88.9</th>
<th style="text-align:center">107.3</th>
<th>106.2</th>
<th>121.8</th>
<th>103.7</th>
<th>133.8</th>
<th>65.5</th>
<th>77.7</th>
<th>50.8</th>
<th>81.5</th>
<th>95.6</th>
<th>74.4</th>
<th>96.7</th>
</tr>
</thead>
<tbody>
<tr>
<td>Y</td>
<td>58.5</td>
<td style="text-align:center">119.6</td>
<td>80.8</td>
<td>97.5</td>
<td>106.3</td>
<td>106.5</td>
<td>43</td>
<td>66.4</td>
<td>55</td>
<td>61.1</td>
<td>95.2</td>
<td>59.1</td>
<td>103.8</td>
</tr>
<tr>
<td>D</td>
<td>30.4</td>
<td style="text-align:center">-12.3</td>
<td>25.4</td>
<td>24.3</td>
<td>-2.6</td>
<td>27.3</td>
<td>22.5</td>
<td>11.3</td>
<td>-4.2</td>
<td>20.4</td>
<td>0.4</td>
<td>15.3</td>
<td>-7.1</td>
</tr>
</tbody>
</table>
</div>
<p>现在我们计算一下减肥前后体重差值的均值$\mu_{D}(=\mu_{1}-\mu_{2})$的估计，这里假定重量区间为正态分布。</p>
<p>在这个案例中，减肥前后的体重并不是独立的，不是独立的是指，减肥前的体重与减肥后的体重只是与同一个人比较才有意义，因此这个问题不能用前面对待两个独立样本的方法来求估计值。不过，可以把每个人减肥前后的重量相减，用得到的差值来进行估计，我们用(X,Y)代表配对样本，样本量为n，均值分别为$\mu_{1}$和$\mu_{2}$，并令D=X-Y为这两个样本相应元素之间的差，即对于$i=1,\cdots,n,D_{i}=X_{i}-Y_{i}$，假定D服从均值为$\mu_{D}(=\mu_{1}-\mu_{2})$的正态分布，在这种情况下，问题就转化成了求单样本均值估计的问题了，现在过计算一下$\mu_{D}$的95%置信区间就是(2.627,20.619)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; x&lt;-c(<span class="number">88.9</span>,<span class="number">107.3</span>,<span class="number">106.2</span>,<span class="number">121.8</span>,<span class="number">103.7</span>,<span class="number">133.8</span>,<span class="number">65.5</span>,<span class="number">77.7</span>,<span class="number">50.8</span>,<span class="number">81.5</span>,<span class="number">95.6</span>,<span class="number">74.4</span>,<span class="number">96.7</span>)</div><div class="line">&gt; y&lt;-c(<span class="number">58.5</span>,<span class="number">119.6</span>,<span class="number">80.8</span>,<span class="number">97.5</span>,<span class="number">106.3</span>,<span class="number">106.5</span>,<span class="number">43</span>,<span class="number">66.4</span>,<span class="number">55</span>,<span class="number">61.1</span>,<span class="number">95.2</span>,<span class="number">59.1</span>,<span class="number">103.8</span>)</div><div class="line">&gt; t.test(x,y,paired=<span class="literal">T</span>)$conf</div><div class="line">[<span class="number">1</span>]  <span class="number">2.627241</span> <span class="number">20.618913</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div><div class="line">&gt; t.test(x-y)$conf</div><div class="line">[<span class="number">1</span>]  <span class="number">2.627241</span> <span class="number">20.618913</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>
<h2 id="总体比例-Bernoulli试验成功概率-p的区间估计"><a href="#总体比例-Bernoulli试验成功概率-p的区间估计" class="headerlink" title="总体比例(Bernoulli试验成功概率)p的区间估计"></a>总体比例(Bernoulli试验成功概率)p的区间估计</h2><p>在抽样调查中，计算某特征的总体比例是最基本的目的之一，任何一个调查报告，都应给出样本比例，以及所描述的总体比例的具有某置信度的置信区间，下面就是一个案例。</p>
<p>某地对1050人的随机调查结果显示，有1048人支持减少公车数量，另外，有人调查了政府机关中盺30人，有2人支持减少官员公车数量，我们希望分别找根据这两个调查数据找出总体中支持减少公车的人的比例的点估计以及其置信度为95%的置信区间，并且比较这两个调查。</p>
<p>我们知道，严格说来，抽样调查应该是不施加抽样，而样本中具有某种特征的元素数目应该属于超几何分布，但在大总体时，可以看成为放回抽样，因此可以看成近似于二项分布。如果总体量大，且样本量充分大时，那么根据中心极限定量，可以用视为近似正态分布。</p>
<p>假定样本量为n，样本中具有某种特征的元素数目(Bernoulli试验成功次数)为x，而样本比例为$\hat{p}=x/n​$，在这种符号，用正态近似计算总体比例的置信度为$(1-\alpha)​$的置信区间的公式如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/professional/180810/DGcgh6hD75.png?imageslim" alt="mark"></p>
<p>这里的$z_{\alpha/2}$是标准正态分布的上$\alpha/2$分位点。但是，一般来说，很难确定需要多大样本才能使用用正态分布。如果使用这个公式计算出来的区间包含了0或者1，则说明样本不够大，这是因为总体比例不可能小于0，也不可能大于1，是否为大样本，不仅依赖于n，而且依赖于$\hat{p}$的大小，当$\hat{p}$越接近于0或1时，为了正态近似所需要样本量就越大。</p>
<p>现在看前面的这个案例的计算结果。</p>
<p>第一个调查，n=1050，x=1048，那么$\hat{p}=x/n=0.9980952$<br>p的精确95%置信区间计算如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; n=<span class="number">1050</span></div><div class="line">&gt; x=<span class="number">1048</span></div><div class="line">&gt; binom.test(x,n,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">	Exact binomial test</div><div class="line"></div><div class="line">data:  x and n</div><div class="line">number of successes = <span class="number">1048</span>, number of trials = <span class="number">1050</span>, p-value &lt; <span class="number">2.2e-16</span></div><div class="line">alternative hypothesis: true probability of success is not equal to <span class="number">0.5</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.9931364</span> <span class="number">0.9997692</span></div><div class="line">sample estimates:</div><div class="line">probability of success </div><div class="line">             <span class="number">0.9980952</span></div></pre></td></tr></table></figure>
<p>也就是( 0.9931364,0.9997692)，置信区间宽度为0.0066328。</p>
<p>也可以使用<code>Hmisc</code>包中的<code>binconf</code>函数来计算，binconf函数的用法为binconf(x,n,alpha=c,method=”all”)，它计算的是三种置信区间：</p>
<p>(1)精确置信区间；</p>
<p>(2)一种Wilson近似区间；</p>
<p>(3)正态近似区间，其中置信度为1-c（我们计算的是95%置信区间，因此这里的c就是0.05）。</p>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; binconf(x,n,alpha=<span class="number">0.95</span>,method=<span class="string">"all"</span>)</div><div class="line">            PointEst     Lower     Upper</div><div class="line">Exact      <span class="number">0.9980952</span> <span class="number">0.9973564</span> <span class="number">0.9984768</span></div><div class="line">Wilson     <span class="number">0.9980952</span> <span class="number">0.9980090</span> <span class="number">0.9981778</span></div><div class="line">Asymptotic <span class="number">0.9980952</span> <span class="number">0.9980109</span> <span class="number">0.9981796</span></div></pre></td></tr></table></figure>
<p>第三行就是近拟正态分布的95%置信区间。</p>
<p>再看第二个调查，n=30，x=2，那么$\hat{p}=x/n=0.0666667$<br>p的精确95%置信区间计算如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; n=<span class="number">30</span></div><div class="line">&gt; x=<span class="number">2</span></div><div class="line">&gt; binom.test(x,n,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">	Exact binomial test</div><div class="line"></div><div class="line">data:  x and n</div><div class="line">number of successes = <span class="number">2</span>, number of trials = <span class="number">30</span>, p-value = <span class="number">8.68e-07</span></div><div class="line">alternative hypothesis: true probability of success is not equal to <span class="number">0.5</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.008178134</span> <span class="number">0.220735402</span></div><div class="line">sample estimates:</div><div class="line">probability of success </div><div class="line">            <span class="number">0.06666667</span></div></pre></td></tr></table></figure>
<p>也就是(  0.008178134,,0.220735402)，置信区间宽度为0.2125573。</p>
<p>也可以使用<code>Hmisc</code>包中的<code>binconf</code>函数来计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; binconf(x,n,alpha=<span class="number">0.95</span>,method=<span class="string">"all"</span>)</div><div class="line">            PointEst     Lower     Upper</div><div class="line">Exact      <span class="number">0.9980952</span> <span class="number">0.9973564</span> <span class="number">0.9984768</span></div><div class="line">Wilson     <span class="number">0.9980952</span> <span class="number">0.9980090</span> <span class="number">0.9981778</span></div><div class="line">Asymptotic <span class="number">0.9980952</span> <span class="number">0.9980109</span> <span class="number">0.9981796</span></div></pre></td></tr></table></figure>
<p>从上面的两个计算结果可以看出，第一个正态近似所得到的区间包含了1，因此应该采用精确方法计算的区间，精确的区间宽度只有约0.0066328，非常精确，按照抽样调查通常的说法是“误差约为±0.332%”，因此可以说“该地公众中约有99.8%的人支持减少官员公车的数量，误差为0.332%”。对于第二个调查来说，正态近似公式区间和精确区间有些出入，第二个调查得到的精确区间宽度约为0.2125573，是第一个区间的32.05倍，很不精确，可以说“该地政府机关工作者中有约6.7%的人支持减少公车的数量，误差为±10.628%。</p>
<p>第一个调查代表了群众的观点，第二个调查只代表了政府机关工作人员的观点，从这个例子可以看出，只给出比例是不行的，必须给出样本量或者具有某置信度的置信区间，还应该告知抽样的对象和范围。很多调查报告只给出比例是不合适的 ，假定关于某药品疗效的调查的样本量是2，有效率是1/2，那么有效率的95%置信区间为(0.01257912,0.9874209)，区间宽度为0.9748418，几乎和所有可能取值范围(0,1)相同，这样结果没有任何意义，但如果不给出分母或给出具有某置信度的置信区间，而只说50%有效，必然会误导大众。</p>
<h2 id="如何概算调查所需的样本量"><a href="#如何概算调查所需的样本量" class="headerlink" title="如何概算调查所需的样本量"></a>如何概算调查所需的样本量</h2><p>在美国总统选举的各种民意测序人中，关于支持率的一个常用标准是置信度为95%，而误差在3%以内（置信区间宽度为6%）。那么要达到这样的标准需要调查多少人，就需要概算一下样本量了，我们可以根据前面关于总体比例置信区间的正态近似公式，由$\hat{p}$、$z_{\alpha/2}$来推算样本量，通过查表或者统计软件，容易得出$z_{0.025}\approx1.96$，如果取$\hat{p}=0.5$，那么由下面的公式可以计算：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180811/54Dfh0cg4a.png?imageslim" alt="mark"></p>
<p>求得n=1067.11，取大于它的最小整数，得n=1068，这就是说，至少要问1068个人，人们可能会问，为什么取$\hat{p}=0.5$呢，这是因为人们在抽样前并不知道$\hat{p}$是多少，而在$\hat{p}=0.5$时，需要的n最大，因此保险的作用是在计算样本量时取$\hat{p}=0.5$，比方说，假如取了$\hat{p}=0.1$，会得到n=385，这时，如果真实的$\hat{p}=0.5$，那么误差就约等于0.0499，大于要求的0.03了。</p>
<h2 id="总体比例之差-p-1-p-2-的区间估计"><a href="#总体比例之差-p-1-p-2-的区间估计" class="headerlink" title="总体比例之差$p_{1}-p_{2}$的区间估计"></a>总体比例之差$p_{1}-p_{2}$的区间估计</h2><p>现在通过以下案例来说明两个比例之差的区间估计<br>两个商场某天对某品牌的洗衣粉的销售表明，在商场A的1217名顾客中，购买这种洗衣粉的有53名，而在商场B的1750个顾客中，购买这种洗衣粉的有20人，假定两个商场的交易分别代表两个总体，求这两个总体中购买该品牌洗衣粉的比例之间的区间估计。</p>
<p>这里有两个总体比例，分别是商场A和B所有交易中购买该品牌洗衣粉的比例，现在的数据表明$n_{1}=1217,x_{1}=53,n_{2}=1750,x_{2}=20$，假定两个总体比例分别是$p_{1}$和$p_{2}$，我们希望求这两个总体比例之差$p_{1}-p_{2}$的95%点估计和区间估计，令$\hat{p_{1}}=x_{1}/n_{1}$，$\hat{p_{2}}=x_{2}/n_{2}$。</p>
<p>点估计很好计算，$\hat{p_{1}}-\hat{p_{2}}$即可，区间估计一般都使用正态分布近似或者$\chi^2$分布近似区间。常用的正态近似公式有几种，常用的是下面的这一种：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180811/DmmH22ibgc.png?imageslim" alt="mark"></p>
<p>而且都可以为了适应连续分布而做连续性修正，在这个案例中，这两个总体比例之差$p_{1}-p_{2}$的95%置信区间为(0.01892344,0.04531884)，计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; prop.test(c(<span class="number">53</span>,<span class="number">20</span>),c(<span class="number">1217</span>,<span class="number">1750</span>),con=<span class="number">0.95</span>)$con</div><div class="line">[<span class="number">1</span>] <span class="number">0.01892344</span> <span class="number">0.04531884</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/01/BioStatistics/生物统计-01统计学基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/01/BioStatistics/生物统计-01统计学基础/" itemprop="url">统计学基础汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-01T12:00:00+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  10,593
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  41
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="统计学术语"><a href="#统计学术语" class="headerlink" title="统计学术语"></a>统计学术语</h2><p>下面是一些常见的医学或生物学统计学术语。</p>
<h2 id="数据和变量"><a href="#数据和变量" class="headerlink" title="数据和变量"></a>数据和变量</h2><p>在了解这两个术语之前，先看一组数据，从这组数据出发，说明这几个术语。</p>
<p>这组数据是R中自带的数据集，即<code>iris</code>这个数据集，iris数据集的中文名是安德森鸢尾花卉数据集，英文全称是Anderson’s Iris data set。iris包含150个样本，对应数据集的每行数据。每行数据包含每个样本的四个特征和样本的类别信息，所以iris数据集是一个150行5列的二维表，我们先看一下这个数据集的结构，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; str(iris)</div><div class="line"><span class="string">'data.frame'</span>:   <span class="number">150</span> obs. of  <span class="number">5</span> variables:</div><div class="line"> $ Sepal.Length: num  <span class="number">5.1</span> <span class="number">4.9</span> <span class="number">4.7</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">5.4</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">4.4</span> <span class="number">4.9</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Width : num  <span class="number">3.5</span> <span class="number">3</span> <span class="number">3.2</span> <span class="number">3.1</span> <span class="number">3.6</span> <span class="number">3.9</span> <span class="number">3.4</span> <span class="number">3.4</span> <span class="number">2.9</span> <span class="number">3.1</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Length: num  <span class="number">1.4</span> <span class="number">1.4</span> <span class="number">1.3</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.7</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Width : num  <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.4</span> <span class="number">0.3</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.1</span> <span class="keyword">...</span></div><div class="line"> $ Species     : Factor w/ <span class="number">3</span> levels <span class="string">"setosa"</span>,<span class="string">"versicolor"</span>,..: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>再看一下前几条信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(iris)</div><div class="line">  Sepal.Length Sepal.Width Petal.Length Petal.Width Species</div><div class="line"><span class="number">1</span>          <span class="number">5.1</span>         <span class="number">3.5</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">2</span>          <span class="number">4.9</span>         <span class="number">3.0</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">3</span>          <span class="number">4.7</span>         <span class="number">3.2</span>          <span class="number">1.3</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">4</span>          <span class="number">4.6</span>         <span class="number">3.1</span>          <span class="number">1.5</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">5</span>          <span class="number">5.0</span>         <span class="number">3.6</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">6</span>          <span class="number">5.4</span>         <span class="number">3.9</span>          <span class="number">1.7</span>         <span class="number">0.4</span>  setosa</div></pre></td></tr></table></figure>
<p>从上面的这两个结果，我们可以得到这些信息：</p>
<p>第一，这个数据集一共有150行，5列。</p>
<p>第二，每1列的名称分别为<code>Sepal.Length</code>、<code>Sepal.Width</code>、<code>Petal.Length</code>、<code>Petal.Width</code>和<code>Species</code>，它们分别表示鸢尾花的花萼长度，花萼宽度、花瓣长度，花瓣宽度，种属，也就是说第1行中一共有这5个信息，我们把这5个信息称为<code>变量(variable)</code>。这里需要说明一下的是，变量(variable)在计算机/数据库等领域也叫属性(attribute)、特征(feature)、特性(characteristic)、字段(field)等等。</p>
<p>再回到<code>iris</code>这个数据集中。</p>
<p>其中，我们把种属(Species)这个信息称为<code>定性变量（qualitative variable）</code>，定性变量取的值称为<code>水平(level)</code>或<code>类(class)</code>。定性变量有其它的教材中也会称为分类变量(categorical variable)、属性变量(attributives variable)、名义变量/标称变量(nominal variable)或维度(dimension)。</p>
<p>再看其它的4个变量，它们是用具体的数字表示，这些变量称为<code>定量变量(quantitative variable)</code>，有也领域也称为指标。</p>
<p>定性变量的例子除了种属外，还有其他的例子，例如我们常见的性别，颜色等，在有些情况下，定量变量也会按照定性变量去处理，例如，为了调查方便，我们在问卷中可以只问高收入、中收入还是低收入，而不是问具体多少钱，这种定性变量还能进行排序，它们也常常称为定序变量（ordinal variable）。</p>
<p>定量变量还能分为<code>连续型变量(continuous variable)</code>和<code>离散型变量(discrete variable)</code>。</p>
<p>连续型变量的例子有身高、体重、热量、速度、长度等，它们的取值 是实数轴的某一个区间或者是某些区间集合中的所有可能点的变量。</p>
<p>离散型变量的例子有，某种事件发生的次数，例如抛5次硬币，在描述有几次正面朝上的时候，只可能是0次，1次，2次，3次，4次，5次，而不可能是1.5次这种小数，离散型变量只能取正整数或0。</p>
<p>还看上面的案例，整个<code>iris</code>这个数据集中，除了第1行的变量名称外，剩下的内容则是与这些变量对应的数据(data)，可以把数据看成变量的观测值，或者是试验结果，例如，身高是一个变量，测量一个人的身高，就好比一次试验，可观测到一次试验结果，就是<code>观测值(observation)</code>。这里还要提一下，观测值(observation)在计算机/数据库领域也叫记录(record)、对象(object)、向量(vector)、模式(pattern)、事件(event)、例(case,instance)、样本(sample)、或项、实体(entity)等等。</p>
<p>我们一般所说的数据是一个集合名词，每一个数字包含很多观测值，每个观测值也称为一个数据点(data point, point)或例(case)。就以这个<code>iris</code>的数据集为例，它的每1列代表一个变量，而每1行则为一个对象关于各个变量的观测值，簇也把这种数据方阵的每一行叫做一个观测（值），就像下面的样子，它就是一个观测：</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101801.png" alt=""></p>
<p>这也是一个观测值，如下所示：</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101825.png" alt=""></p>
<h2 id="横断面研究和纵贯研究"><a href="#横断面研究和纵贯研究" class="headerlink" title="横断面研究和纵贯研究"></a>横断面研究和纵贯研究</h2><p><code>横断面研究(cross-sectional  study)</code>是指，它的数据是一群人在某个时间点的情况。</p>
<p><code>纵贯研究(longitudinal study)</code>是指，在一段时间内手里观察同一群人。</p>
<h2 id="概率和随机变量"><a href="#概率和随机变量" class="headerlink" title="概率和随机变量"></a>概率和随机变量</h2><p>在统计学研究中，有很多对象都被认为具有随机性(randomness)，随机的事情也有规律的，例如我们抛一个硬币，在硬币落在地面之前，硬币朝哪面我们是不知道的，它是随机的，事先无法准确地预测。但是，只要这个硬币是正常的，没问题的，那么我们就知道，硬币朝上与朝下的概率基本上是相等的。</p>
<p>在这里，硬币的朝上与朝下的这个变量，它就是随机变量(random variable)。而一个随机变量的性质则完全被与其相关的概率或概率分布决定。那什么是概率？</p>
<p>一个事件(event)的概率(probability)是该事件发生可能性的一个数量度量，它的聚会范围是0到1，也可能是0或1.当一个事件的概率接近1时，则说明这个事件很可能发生；如果概率接近0，则说明不太可能发生，如果概率为0.5，那么说明该事件发生和不发生的可能性一样。</p>
<p>简单来说，概率称量某个事件出现的机会，有些概率在某种假定条件下可以算出来，例如抛硬币，得到正面朝上与反面朝上的概率都是0.5，这种可能计算概率的事件称为等可能事件（equally likely event)，这种可能是假定的，对于硬币来说，就是假定正面与反面朝上的㜅一样，如果我们抛了一千次，其中得到正面与反面朝上的频率或相对频数(relative frequency)都接近0.5，那么就说明这个硬币是公平的，是正常的，这些事件理论上可能通过重复试验中出现的频率来计算其发生的概率。</p>
<p>不过有些概率是无法用重复计算来估计的，例如有人认为，最近3个月内中东地区发生大规模军事冲突的概率是80%，这显著无法用重复试剂来估计，这只是他们基于过去的经合和掌握的信息形成的信息，这种概率称为主观概率(subjective probability)。</p>
<h2 id="利用R产生随机数"><a href="#利用R产生随机数" class="headerlink" title="利用R产生随机数"></a>利用R产生随机数</h2><p>在进行抽样时，或者是模拟某个分布时，我们常常要用到随机数，现在都是用软件来生成随机数，虽然这种随机数不晃真正的随机数，但是已经足够使用了，使用软件生成的这种随机数称为伪随机数(pseudo-random number)，现在介绍一下用R来如何生成随机数。</p>
<p>现在生成10个2到3之间的，服从均匀分布的伪随机数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; set.seed(<span class="number">1000</span>)</div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"> [<span class="number">1</span>] <span class="number">2.327879</span> <span class="number">2.758846</span> <span class="number">2.113936</span> <span class="number">2.690755</span> <span class="number">2.516402</span> <span class="number">2.067738</span> <span class="number">2.738715</span> <span class="number">2.583535</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.215771</span> <span class="number">2.256122</span></div></pre></td></tr></table></figure>
<p>现在解释一下，先看<code>runif()</code>这个函数，在R中，这个函数前面的<code>r</code>表示随机，<code>unif</code>表示服从均匀分布，类似的还有<code>rnorm()</code>，它的功能类似，只是它生成的是服从正态分布的随机数，其中<code>norm</code>就是正态分布的意思。</p>
<p>现在，再看<code>set.seed(1000)</code>的作用是保证你随机生成的数字前后一致，如果它的参数就是一个数字，这个数字可以随意指定，括号里的数字只要一致，那么每次生成的随机数就一致，如果不使用这个函数，那么我们每次运行<code>runif(10,2,3)</code>，它生成的随机数就不一样，现在看一下下面的代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 不指定set.seed()</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.567518</span> <span class="number">2.049710</span> <span class="number">2.561620</span> <span class="number">2.966179</span> <span class="number">2.509945</span> <span class="number">2.700937</span> <span class="number">2.020349</span> <span class="number">2.783569</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.584397</span> <span class="number">2.317293</span></div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 再次运行runif(10,2,3),生成的结果就不一样</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.996208</span> <span class="number">2.531047</span> <span class="number">2.109908</span> <span class="number">2.633212</span> <span class="number">2.797929</span> <span class="number">2.712990</span> <span class="number">2.702835</span> <span class="number">2.562833</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.258873</span> <span class="number">2.506937</span></div><div class="line">&gt; set.seed(<span class="number">1000</span>) <span class="comment"># 指定set.seed(1000)</span></div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 生成的结果就与前面的一样</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.327879</span> <span class="number">2.758846</span> <span class="number">2.113936</span> <span class="number">2.690755</span> <span class="number">2.516402</span> <span class="number">2.067738</span> <span class="number">2.738715</span> <span class="number">2.583535</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.215771</span> <span class="number">2.256122</span></div></pre></td></tr></table></figure>
<h2 id="个体、总体、样本和抽样"><a href="#个体、总体、样本和抽样" class="headerlink" title="个体、总体、样本和抽样"></a>个体、总体、样本和抽样</h2><p>为了说明这几个术语，我们还要看一个案例。</p>
<p>我们要调查一下外地游客在重庆认路的情况进行调查，那么我们可以这么设计问题，“请问，你在重庆旅游时，是否很容易找到目的地？”可能的回答有这些：“很容易”，“不容易“，”不知道“。调查的目的是希望知道在重庆的游客中，对这个问题的三种回答所占的比例，显然不可能调查所有的游客，但我们可以调查其中的一部分，进而估计出在重庆的所有游客的回答。</p>
<p>在这个例子中，单个游客称为调查的对象(object)，他们的回答称为个体(element,或individual, unit)，而所有在重庆的游客对这个问题的回答称为一个总体(population)，总体是包含所有要研究的个体的集合，而调查时，问到那些游客则称为该总体的一个样本(sample)，是总体中挑选出来的一部分。</p>
<p>在抽取样本时，如果总体中的每一个体都有同等机会被选到样本中，这种抽样称为简单随机抽样(sample random sampling)，这样得到的样本称为随机样本(random sample)。不过即使是随机抽样，也不可能保证样本与总体的对应特征完全一样，会出现与总体的误差，这种误差无法避免，这样的误差称为抽样误差(sampling error)。</p>
<h3 id="观察单位（observed-unit）"><a href="#观察单位（observed-unit）" class="headerlink" title="观察单位（observed unit）"></a>观察单位（observed unit）</h3><p>观察单位也叫个体（individual），是统计研究中的基本单位，它可以是一个人，一头动物，也可能是特指一群人（例如一个家庭、一个幼儿园，一个自然村）。</p>
<h3 id="总体（population）"><a href="#总体（population）" class="headerlink" title="总体（population）"></a>总体（population）</h3><p>根据研究目的而确定的同质观察单位的全体，更确切地说，它是同质的所有观察单位某种观察值的集合，例如调查某地2008年7岁正常女童的身高，而其中的观察单位（个体）则是每个女童。由于这里的总体明确规定了空间、时间、人群范围内有限个观察单位，因此称为<strong>有限总体（finite populaton）</strong>。而在一些情况下，总体的概念则是设想的或抽象的，例如研究某治疗慢性前列腺增生的药物的疗效，这里的总体的同质基础是慢性前列腺增生患者，该总体应包括用该药治疗的所有前列腺增生症患者的治疗结果，没有时间和空间的限制，其观察单位的全体数只是理论上存在的，因此可以视为“无限”，称为<strong>无限总体（infinite populaton）</strong>。</p>
<p>虽然我们要研究某个问题是关于整个总体的，但是研究者通常不可能考察总体中的所有个体，为了降低成本，因此在医学研究中通常彩从总体中抽取样本（sample）的方法，根据样本信息来推断总体特征，这种方法叫<strong>抽样研究（sampling research）</strong>，从总体中抽取部分观察单位的过程称为<strong>抽样（sampling）</strong>。</p>
<p>为了保证样本的代表性，抽样必须遵循<strong>随机化（randomization）</strong>原则。从总体中随机抽得的部分观察单位，其实际测量的集合就是样本，该样本中包含的观察单位数称为该样本的<strong>样本含量（sample size）</strong>。例中从某地2008年7岁正常女童中，随机抽取了110名女童，测量身高，得到了110名女童的身高测量值，组成了样本；也可能从就诊的前列腺增生症患者中随机抽取了100名患者，并观察药物的治疗效果，就组成了治疗效果的样本。</p>
<h3 id="变量（variable）"><a href="#变量（variable）" class="headerlink" title="变量（variable）"></a>变量（variable）</h3><p>确定总体后，研究者对每个观察单位的某项特征进行观察或测量，这种特征能表现观察单位的变量异，就是变量。例如某地7岁女童的身高，体重都可以视为变量。</p>
<h3 id="统计推断"><a href="#统计推断" class="headerlink" title="统计推断"></a>统计推断</h3><p>在实际研究工作中，受条件所限，在研究中很难得到整个总体，往往堡垒有得到总体中的一个子集，即实际工作中往往按随机的方式从总体中抽取若干有代表性的同质个体所构成的一个样本（sample）进行研究，这就需要通过样本有限的、不确定的信息来歓有关总体的特征，这就是统计推断（statistical inference），简言之，统计推断是指由样本所提供的信息对总体数量规律做出推断。</p>
<h3 id="强度相对数"><a href="#强度相对数" class="headerlink" title="强度相对数"></a>强度相对数</h3><p>说明某现象发生的频率或强度，称为率。常以百分率(%)、千分率(‰)、万分率(1/万)、十万分率（1/10万）等表示。<br> 例5-1：2839名职工，发生高血压5人，高血压发病率为5/2839=1.76‰。</p>
<h3 id="结构相对数"><a href="#结构相对数" class="headerlink" title="结构相对数"></a>结构相对数</h3><p>表示事物内部某一部分的个体数与该事物部分个体数的总和之比，用来说明各构成部分在总体中所占的比重或分布，称为构成比，通常以100%为比例基数。<br>例5-2  某医院1990年因五种疾病死亡的人数共190人，其中死于恶性肿瘤者58人，恶性肿瘤死亡人数占五种疾病死亡人数的构成比为58/190=30.53% 。</p>
<h3 id="相对比"><a href="#相对比" class="headerlink" title="相对比"></a>相对比</h3><p>相对比简称比(ratio)，是两个有关指标之比，说明两指标间的比例关系，通常以倍数或百分数（%）表示。例如某年医院出生婴儿中，男性为370，女性为358，则婴儿性别比为370/358*100=103</p>
<h3 id="同比"><a href="#同比" class="headerlink" title="同比"></a>同比</h3><p>发展速度主要是为了消除季节变动的影响，用以说明本期发展水平与去年同期发展水平对比而达到的相对发展速度。如，本期2月比去年2月，本期6月比去年6月等。其计算公式为：同比发展速度=本期发展水平/去年同期发展水平×100%。</p>
<h3 id="环比"><a href="#环比" class="headerlink" title="环比"></a>环比</h3><p>当前水平与前一时期水平之比，表明现象逐期的发展速度。如计算一年内各月与前一个月对比，即2月比1月，3月比2月，4月比3月 ……12月比11月，说明逐月的发展程度。</p>
<h2 id="数据的描述"><a href="#数据的描述" class="headerlink" title="数据的描述"></a>数据的描述</h2><p>我们拿到一批数据，可能会考虑这些问题，这些数据是什么，这些数据如何表示，如何从整体上来描述这批数据。</p>
<h3 id="如何查看数据"><a href="#如何查看数据" class="headerlink" title="如何查看数据"></a>如何查看数据</h3><h2 id="计量资料（measurement-data）"><a href="#计量资料（measurement-data）" class="headerlink" title="计量资料（measurement data）"></a>计量资料（measurement data）</h2><p>计量资料又叫定量资料（quantitative data）或数值变量资料(numerical variable)，表现为数值大小，一般有计量单位，例如身高多少厘米，体重多少公斤。根据测量值是否连续，又可分为连续型（continuous）和离散型（discrete），连续理革可在褛范围内聚任意值，例如身高，体重，而离散型只能取整数值，例如死亡人数。</p>
<h3 id="离散型数据-discrete-data"><a href="#离散型数据-discrete-data" class="headerlink" title="离散型数据(discrete data)"></a>离散型数据(discrete data)</h3><p>离散型数据本质上是一种分类。最典型的例子，就是性别、种族、职业、教育程度等。在多数情况下，离散型数据并没有具体的数值（比如性别中的男和女），或者虽然形式上由数值表示，但数值本身并没有明确的意义（比如用邮政编码来记录受试者居住的地域）。有些离散变量是有某种顺序关系的，比如说教育程度可以从低到高排列，而有些离散变量并没有这种顺序，比如说某个基因的基因型。这两种情况分别称为有序变量(ordinal variable)和名义变量(nominal variable)。</p>
<h3 id="连续型数据-continuous-data"><a href="#连续型数据-continuous-data" class="headerlink" title="连续型数据(continuous data)"></a>连续型数据(continuous data)</h3><p>连续型数据的数值有具体的科学意义，并且可以在数轴上的某个范围连续取值比如身高、体重、血糖浓度、肾小球滤过率等。</p>
<h2 id="计数资料（enumeration-data）"><a href="#计数资料（enumeration-data）" class="headerlink" title="计数资料（enumeration data）"></a>计数资料（enumeration data）</h2><p>计数资料又称定性资料(qualitative data )或无序分类（unordered categorical variable）变量资料，亦称为名义变量资料，它的变量值是定性的，表现为互不相容的特性，例如结果的阴阳，家族史的有无等，分为两种：一种是二分类，例如治愈与未治愈，另一种是多分类，例如血型，A型，B型，AB型和O型。</p>
<h2 id="等级资料（ranked-data）"><a href="#等级资料（ranked-data）" class="headerlink" title="等级资料（ranked data）"></a>等级资料（ranked data）</h2><p>又称半定量资料（semi-quantitative data）或有序分类变量（ordinal categorical variable）资料：它将观察单位按某种程度分为等级，例如某药物治疗的效果为治愈、显效、好转、无效。</p>
<h2 id="数据整体的一般描述"><a href="#数据整体的一般描述" class="headerlink" title="数据整体的一般描述"></a>数据整体的一般描述</h2><h3 id="极差"><a href="#极差" class="headerlink" title="极差"></a>极差</h3><p>又叫全距(Range)，是用来表示统计资料中的变异量数(measures of variation)，其最大值与最小值之间的差距；即最大值减最小值后所得之数据。</p>
<h3 id="均值"><a href="#均值" class="headerlink" title="均值"></a>均值</h3><p>通常情况下，我们所说的均值都是所有的数据之和除以数据的数目，但是，在一些特殊的情况下，会指明均值的类型，例如是算术均值，还是几何均值。</p>
<h3 id="算术均值-arithmetic-mean"><a href="#算术均值-arithmetic-mean" class="headerlink" title="算术均值(arithmetic mean)"></a>算术均值(arithmetic mean)</h3><p>算术平均数是对集中趋势的最常用的描述。我们对某个量进行了n次观测，把测量到的数值分别记为X1, X2,…, Xn，那么要得到算术平均数，只需把X1到Xn加起来，再除以数据的个数n。数学公式为：</p>
<script type="math/tex; mode=display">\bar{X}=\frac{\sum_{i=1}^nX{_i}}{n}</script><h3 id="几何均值（geometric-mean）"><a href="#几何均值（geometric-mean）" class="headerlink" title="几何均值（geometric mean）"></a>几何均值（geometric mean）</h3><p>几何平均数是指n个观察值连乘积的n次方根。</p>
<h3 id="中位数-median"><a href="#中位数-median" class="headerlink" title="中位数(median)"></a>中位数(median)</h3><p>中位数是把该变量所有取值从小到大（或从大到小）排序，取最中间的一个（例如总共有21个数，则取排行第11的）。如果样本量是偶数，则取中间两个数的平均。</p>
<h3 id="众数-mode"><a href="#众数-mode" class="headerlink" title="众数(mode)"></a>众数(mode)</h3><p>一组数据中出现次数最多的数值，叫众数，有时众数在一组数中有好几个。用M表示。 理性理解：简单的说，就是一组数据中占比例最多的那个数。</p>
<p>例如：2，3，3，3，4，5的众数是3。 但是，如果有两个或两个以上个数出现次数都是最多的，那么这几个数都是这组数据的众数。 例如：2，2，3，3，4，5的众数是2和3。 其次，如果所有数据出现的次数都一样，那么这组数据没有众数。 例如：2，3，4，5没有众数。</p>
<h3 id="百分位数-percentile"><a href="#百分位数-percentile" class="headerlink" title="百分位数(percentile)"></a>百分位数(percentile)</h3><p>如果将一组数据从小到大排序，并计算相应的累计百分位，则某一百分位所对应数据的值就称为这一百分位的百分位数。可表示为：一组n个观测值按数值大小排列。如，处于p%位置的值称第p百分位数。</p>
<h3 id="百分位数的计算"><a href="#百分位数的计算" class="headerlink" title="百分位数的计算"></a>百分位数的计算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">w&lt;-c(75.0,64.0,47.4,66.9,62.2,62.2,58.7,63.5,66.6,64.0,57.0,69.0,56.9,50.0,72.0) # 建立向量w</div><div class="line">quantile(w) # 给出w的四分位数</div><div class="line">quantile(w,probs=seq(0,1,0.2),na.rm=FALSE) # 给出向量w的20%，40%分位数</div><div class="line">quantile(w,0.80) # 求w的80%分位数</div><div class="line">quantile(w,0.75)- quantile(w,0.25) #半极差计算</div></pre></td></tr></table></figure>
<p>结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; quantile(w) # 给出w的四分位数</div><div class="line">   0%   25%   50%   75%  100% </div><div class="line">47.40 57.85 63.50 66.75 75.00 </div><div class="line">&gt; quantile(w,probs=seq(0,1,0.2),na.rm=FALSE) # 给出向量w的20%，40%分位数</div><div class="line">   0%   20%   40%   60%   80%  100% </div><div class="line">47.40 56.98 62.20 64.00 67.32 75.00 </div><div class="line">&gt; quantile(w,0.80) # 求w的80%分位数</div><div class="line">  80% </div><div class="line">67.32 </div><div class="line">&gt; quantile(w,0.75)- quantile(w,0.25) #半极差计算</div><div class="line">75% </div><div class="line">8.9</div></pre></td></tr></table></figure></p>
<p>另外一种方法是用<code>cumsum()</code>函数来计算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cumsum(round(table(w)/length(w)*100,2)) # cumsum表示的是累积之和</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; cumsum(round(table(w)/length(w)*100,2)) # cumsum表示的是累积之和</div><div class="line">  47.4     50   56.9     57   58.7   62.2   63.5     64   66.6   66.9     69     72     75 </div><div class="line">  6.67  13.34  20.01  26.68  33.35  46.68  53.35  66.68  73.35  80.02  86.69  93.36 100.03</div></pre></td></tr></table></figure>
<h3 id="四分位数（Quartile"><a href="#四分位数（Quartile" class="headerlink" title="四分位数（Quartile)"></a>四分位数（Quartile)</h3><p>统计学中，把所有数值由小到大排列并分成四等份，处于三个分割点位置的数值就是四分位数。第一，四分位数 (Q1)，又称“较小四分位数”，等于该样本中所有数值由小到大排列后第25%的数字。第二，四分位数 (Q2)，又称“中位数”，等于该样本中所有数值由小到大排列后第50%的数字。第三，四分位数 (Q3)，又称“较大四分位数”，等于该样本中所有数值由小到大排列后第75%的数字。第三，四分位数与第一四分位数的差距又称四分位距（InterQuartile Range,IQR）。四分位距的优点在于，与全距（极差）相比，较少受异常值的影响。 R中用来显示四分位数的函数是quantile，另外用boxplot可以绘制出某个数据集的箱线图。</p>
<p>箱线图结果<code>boxplot(w)</code>如下所示：</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703182218.png" alt=""></p>
<p>条睛线图的解读：最下面是下界，最上面的圆圈是上界，上界的圆圈是异常值，中间矩形的底边是下分位数，上边是上四分位数，中间的粗线是中位数，箱体的高是四分位距。</p>
<h2 id="数据离散程度的描述"><a href="#数据离散程度的描述" class="headerlink" title="数据离散程度的描述"></a>数据离散程度的描述</h2><p>对于一批数据来说，我们有时候需要看一下这批数据的波动分散程度如何，这就需要一些指标。</p>
<h3 id="变异"><a href="#变异" class="headerlink" title="变异"></a>变异</h3><p>医学研究的对象虽功能复杂的有机作整体。不同的个体在相同的条件下，对外因环境因素可以发生不同的反应，这种同质基础上个体特征值之间的差异，称为变异（variation）（医学统计学及SAS应用，王炳顺）。</p>
<h3 id="离均差-deviation-from-the-mean"><a href="#离均差-deviation-from-the-mean" class="headerlink" title="离均差(deviation from the mean)"></a>离均差(deviation from the mean)</h3><p>每一个变量值X与均数$\mu$的差值，即离均差(X-$\mu$)。</p>
<h3 id="离均差平方和"><a href="#离均差平方和" class="headerlink" title="离均差平方和"></a>离均差平方和</h3><p>由于离均差有正有负，最终所有离均差的和即$(X-\mu)$为0，因此离均差的和无法描述一组数据的变异大小。因此将离均差平方后相加得到平方和$Var(X)=E(X-\mu)^2$，这就是离均差平方和（sum of squares of deviations from mean）。</p>
<h3 id="总体方差"><a href="#总体方差" class="headerlink" title="总体方差"></a>总体方差</h3><p>虽然离均差平方和消除了正负的影响，但是如果变量值N越大，则离均差平方和也越大，为此，将离均离平方和除以N就得到了方差，方差用$\delta^2$表示，计算公式为：</p>
<script type="math/tex; mode=display">\delta^2={\frac{\sum(X-\mu)^2}{N}}</script><p>另外，方差（variance）也称均方差（mean square deviation）。</p>
<p>在R中求方差的函数是<code>var()</code>。</p>
<h3 id="样本方差"><a href="#样本方差" class="headerlink" title="样本方差"></a>样本方差</h3><p>上面的是总体方差，如果是样本方差，那么总体均值$\mu$是未知的，因此，这个时候就要用样本的均值来替代总体的均值，这个时候也不能用$\delta^2$来表示样本方差，需要用$s^2$来表示方差，此外，N值也要减去1，公式就如下所示：</p>
<script type="math/tex; mode=display">s^2={\frac{\sum(X-\bar{X})^2}{N-1}}</script><h3 id="标准差"><a href="#标准差" class="headerlink" title="标准差"></a>标准差</h3><p>标准差（standard deviation）是方差的正平方根，其单位与原变量值的单位相同，总体标准差用$\delta$表示，计算公式为：</p>
<script type="math/tex; mode=display">\delta=\sqrt{\frac{\sum(X-\mu)^2}{N}}</script><p>R中求标准差的函数是<code>sd()</code>。</p>
<h3 id="为什么是N-1？"><a href="#为什么是N-1？" class="headerlink" title="为什么是N-1？"></a>为什么是N-1？</h3><p>前面我们看到了总体方差与样本方差的分母不太一样，总体方差的分母是N，而样本方差则是N-1，为什么不一样呢？</p>
<p>在了解这个问题之前，我们先要了解一个统计学中的概念，自由度（degree of freedom）。</p>
<h3 id="自由度的理解"><a href="#自由度的理解" class="headerlink" title="自由度的理解"></a>自由度的理解</h3><p>这里的N严格意义上来讲，就是自由度，在统计学中，几乎所有的方法、所有指标都会涉及自由度，因为自由度跟样本的数目有关，任何统计学方法都离不开样本数目这个变量。自由度的字面意思是，计算样本统计量时能够自由取值的个数，一般用df来表示，来看一个简单的例子，如果有一个方程为x+y+z=100，一旦y和z的值固定，那么x的值也就固定了，因此x=100-y-z，因此，x，y，z这三个变量是不可能同时自由取值的，能够自由取值的个数只有2个，而不是3个，这就是说，自由度为2。</p>
<p>现在再来看一下样本的自由度为什么是N-1，因为我们在用样本统计量来估计总体参数时，我们有一个暗含的假定，即假定统计量是参数的无偏估计，也就是说样本的参数与总体的参数是相等的，这就相当于我们默认了一个限定（就像x+y+z=100一样），因此，样本的自由度就不是N，而是n-1。在不同的统计方法中，自由度都不一样，但基本原则都是每估计1个参数，就要降低一个自由度，现在看一下其他的统计学方法。</p>
<ol>
<li>在单样本t检验中，自由度是t-1，因为只需要估计1个参数（均数），所以只需要消耗1个自由度，所以自由度是t-1.</li>
<li>在两组比较的t检验中，自由度是n1+n2-2，这是因为需要估计的参数有2个，也就是两组的均值，对于每一组而言，一旦均值固定，能够自由取值的个数就只有n1-1个（n1是第一组的例数），即自由度为n1-1。同样的道理，对于第二组而言，其自由度为n2-2，所以，总体自由度就是n1+n2-2。</li>
<li>在多组比较的方差分析中，当有k个组的时候，需要估计k值组的均数，所以总的自由度是(n1+n2+…nk)-k。而对于组间变异所用到的自由度，因为总均数是固定的，所以需要减去1个自由度，即k-1。</li>
<li>在回归分析中，如果有m个自变量，就有m个参数需要估计，而且还需要估计截距项，因此待估计的参数有m+a个（m个自变量加1个截矩项），所以模型的F检验用到的自由度为n-(m+1)。它意味着只剩下n-(m+1)个可以自由取值的数值来估计模型误差，当自变量数m固定时，如果样本n比较小，就会导致有效估计例数不足，从而导致结果不可靠。</li>
</ol>
<p>因此，样本方差的分母使用n-1才更接近于总体的参数，这是无偏估计（unbiased estimator），如果直接使用n，那就是有偏估计（biased estimator ），不过当样本数量大到一定程度时，分母是n-1和n差别不大。</p>
<p>自由度这个角度是一种比较粗糙的理解方式，不过知乎上有人列出了证明过程，如下所示：</p>
<p>本来，按照定义，方差的估计值应时是这个：</p>
<p>$S_{1}^{2}=\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}$，$S_{1}^{2}=\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}$</p>
<p>但是这个估计是有编的，因为：</p>
<script type="math/tex; mode=display">
\begin{aligned} E\left(S_{1}^{2}\right) &=\frac{1}{n} \sum_{i=1}^{n} E\left(\left(X_{i}-\overline{X}\right)^{2}\right)=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu+\mu-\overline{X}\right)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(\left(X_{i}-\mu\right)^{2}-2\left(X_{i}-\mu\right)(\overline{X}-\mu)+(\overline{X}-\mu)^{2}\right)\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-2 \sum_{i=1}^{n}\left(X_{i}-\mu\right)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n(\overline{X}-\mu)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n E\left((\overline{X}-\mu)^{2}\right)\right) \\ &=\frac{1}{n}(\operatorname{nVar}(X)-n \operatorname{Var}(\overline{X}))\\&=\operatorname{Var}(X)-\operatorname{Var}(\overline{X})\\&=\sigma^{2}-\frac{\sigma^{2}}{n}\\&=\frac{n-1}{n} \sigma^{2} \end{aligned}</script><p>接着，</p>
<script type="math/tex; mode=display">
\begin{aligned} E\left(S_{1}^{2}\right) &=\frac{1}{n} \sum_{i=1}^{n} E\left(\left(X_{i}-\overline{X}\right)^{2}\right)=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu+\mu-\overline{X}\right)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(\left(X_{i}-\mu\right)^{2}-2\left(X_{i}-\mu\right)(\overline{X}-\mu)+(\overline{X}-\mu)^{2}\right)\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-2 \sum_{i=1}^{n}\left(X_{i}-\mu\right)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n(\overline{X}-\mu)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &=\frac{1}{n} E\left(\sum_{i=1}^{n} E\left(\left(X_{i}-\mu\right)^{2}-n E(\overline{X}-\mu)^{2}\right)\right) \\ &=\frac{1}{n}(\operatorname{nVar}(X)-n \operatorname{Var}(\overline{X}))\\&=\operatorname{Var}(X)-\operatorname{Var}(\overline{X})\\&=\sigma^{2}-\frac{\sigma^{2}}{n}=\frac{n-1}{n} \sigma^{2}\end{aligned}</script><p>而$(\mathrm{n}-1) / \mathrm{n} \times \sigma^{2} \neq \sigma^{2}$。所以，为了避免使用有偏的估计值，我们通常使用它的修正值$S^2$，如下所示：$S^{2}=\frac{1}{n-1} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}$，$S^{2}=\frac{1}{n-1} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}$</p>
<h3 id="样本标准差"><a href="#样本标准差" class="headerlink" title="样本标准差"></a>样本标准差</h3><p>样本标准差的公式如下所示：</p>
<script type="math/tex; mode=display">s=\sqrt{\frac{\sum(X-\bar{X})^2}{n-1}}</script><h3 id="标准差计算函数"><a href="#标准差计算函数" class="headerlink" title="标准差计算函数"></a>标准差计算函数</h3><p>在Excel中计算方差的公式为<code>STDEV.P</code>和<code>STDEV.S</code>其中，STDEV.P计算时，认为你给出的数据是总体（即P表示population），因此它的分母为N，而STDEV.S计算时，认为你给出的数据是样本（即S表示Sample），因此它的分母为N-1。在R中，用到的函数为<code>sd</code>，默认的就是样本，因此分母为N-1</p>
<h3 id="标准误与标准差的区别"><a href="#标准误与标准差的区别" class="headerlink" title="标准误与标准差的区别"></a>标准误与标准差的区别</h3><p>在医学统计中，还经常遇到标准差与标准误。例如我们要调查地区A中10岁男孩的身高。如果全部都统计下来，直接测是最准确的数据。但是成本高，不现实。因此需要进行采样，一次测量100个男孩的身高，求这一次的均值M1与标准差S1，如果采样10次，每次都取100人，我们会得到10个均值，分别记为M1，M2，M3…M10，对这10个均值再求一个均值M以及标准差S，其中这个标准差S就是<code>标准误(standard error)</code>，即<code>均值的标准误差(standard error of mean)</code>。</p>
<p>从上面的描述我们就知道了，标准差与标准误的区别在于：</p>
<p>第一，标准差是对一次抽样的原始数据进行计算的，而标准误则是对多次抽样的样本统计量进行计算的（这个统计量可以是均值，可以是率）；</p>
<p>第二，标准差只是一个描述性指标，只是描述原始数据的波动情况，而标准误是跟统计推断有关的指标，大多数的统计量计算都需要用到标准误。</p>
<p>很多统计量都跟标准误有关，以简单的<em>t</em>检验为例，可能以前有的人都没有注意过。仔细观察一下就可以发现，<em>t</em>检验统计量的分子是两组样本数据的均值差值，反映了样本数据的差异；分母是标准误，反映了抽样误差。所以<em>t</em>检验反映了什么呢？其实就是看到底是抽样误差大还是真实差异大。如果分母的抽样误差大，那就说明结果可能不可靠，所以P值就会比较大；如果分子的差异大，说明抽样误差造成这种差异的可能性不大，所以P值就会比较小。</p>
<h3 id="标准误与标准差的联系"><a href="#标准误与标准差的联系" class="headerlink" title="标准误与标准差的联系"></a>标准误与标准差的联系</h3><p>SEM表示每次抽样获得的均数的标准差，因此如果要获取SEM，就必须做很多次抽样，这样也非常麻烦，但是标准误与标准差虽然不是一个概念，但在数学上有一定的联系，其公式如下所示（参考资料：补充）：</p>
<script type="math/tex; mode=display">SEM=SD/\sqrt{N}</script><h3 id="变异系数-coefficient-of-variation"><a href="#变异系数-coefficient-of-variation" class="headerlink" title="变异系数(coefficient of variation)"></a>变异系数(coefficient of variation)</h3><p>简称为CV，标准差与均值的比值。公式为：</p>
<script type="math/tex; mode=display">CV=\frac{S}{\bar{X}}\times100\%</script><h3 id="MSE"><a href="#MSE" class="headerlink" title="MSE"></a>MSE</h3><p>MSE的全称为mean square error，即均方误差，公式为：</p>
<script type="math/tex; mode=display">
M S E=\frac{1}{n} \sum_{i=1}^{n}\left(\hat{y}_{i}-y_{i}\right)^{2}</script><p>其范围是$[0,+ \infty)$，当预测值与真实值完全吻合时等于0，即完美模型；误差越大，该值越大。</p>
<h3 id="RMSE"><a href="#RMSE" class="headerlink" title="RMSE"></a>RMSE</h3><p>RMSE的全称为Root Mean Squared Error，即均方根误差，它研究的是预测值与真实值的误差平方根的均值，其实就是MSE加了个根号，这个数量级上比较直观，与检测值的单位一样，例如RMSE=10，可以认为回归效果相比真实值平均相差10，公式如下所示：</p>
<script type="math/tex; mode=display">
R M S E=\sqrt{\frac{1}{n} \sum_{i=1}^{n}\left(\hat{y}_{i}-y_{i}\right)^{2}}</script><p>其范围是$[0,+ \infty)$，当预测值与真实值完全吻合时等于0，即完美模型；误差越大，该值越大。</p>
<h2 id="数据整体的呈现方式"><a href="#数据整体的呈现方式" class="headerlink" title="数据整体的呈现方式"></a>数据整体的呈现方式</h2><h3 id="箱线图和频率直方图"><a href="#箱线图和频率直方图" class="headerlink" title="箱线图和频率直方图"></a>箱线图和频率直方图</h3><p>箱线图(boxplot)汇集了中位数、四分位差以及一些其他信息，能够使我们对样本的分布有一个直观的了解，也可以让我们快速发现数据中可能存在的错误（例如因为数据录入或单位错误导致的异常值）。它之所以被称为箱线图，是因为它用一个“箱子”来表示我们的数据中最靠中间的一半（即Q1和Q3之间的所有数据点），而用箱子上下的两根“胡须”来表示数据的上下限范围。箱线图的画法以及含义见下图。</p>
<h2 id="正态分布"><a href="#正态分布" class="headerlink" title="正态分布"></a>正态分布</h2><p>若随机变量X服从一个数学期望为$\mu$、方差为${\sigma}^2$的正态分布，记为$N(\mu,{\sigma}^2)$。其概率密度函数为正态分布的期望值$\mu$决定了其位置，其标准差$\sigma$决定了分布的幅度。因其曲线呈钟形，因此人们又经常称之为钟形曲线。我们通常所说的标准正态分布，即$\mu$ = 0,$\sigma$ = 1的正态分布，其公式为：</p>
<script type="math/tex; mode=display">p(x|\mu,\sigma)=\mathcal{N}(x|\mu,\sigma)=\frac{1}{\sigma\sqrt{2\pi}}\exp(-\frac{(x-\mu)^2}{2\sigma^2})</script><h2 id="医学参考值"><a href="#医学参考值" class="headerlink" title="医学参考值"></a>医学参考值</h2><p>医学参考值（reference value）是指包括约大多数正常人的人体形态、功能和代谢产物等各种生理及生化指标常数，也称正常值。由于存在个体差异，生物医学数据并非常数而是在一定范围内波动，帮采用学参考值范围（medical reference range）作为判定正常和异常的参考标准。<br>医学参考值范围涉及采用单侧界值还是双侧界值的问题，这通常是依据医学专业知识而定，例如课本（医学统计学，孙振球，第四版）中的例2-1的红细胞数无论过低或过高均属异常，就采用双侧参考值范围制定下侧和上侧界值；血清转氨酶仅过高异常，应采用单侧参考值范围制定上侧界值；肺活量仅过低异常，就采用单侧参考值范围制定下侧界值。医学上常用的参考值范围有90%，95%，99%等，其中95%最常用。</p>
<p>其中确定参考值的方法通常有两种，分别为正态分布法和百分位数法。</p>
<h3 id="正态分布法"><a href="#正态分布法" class="headerlink" title="正态分布法"></a>正态分布法</h3><p>对于服从正态分布的医学数据，可采用正态分布法计算参考值的范围，其计和公式为：<br>双侧1-$1-\alpha$参考值范围为：$\bar{X}\pm\mu_{\alpha/2}S$<br>单侧1-$\alpha$的参考值范围为：$&gt;\bar{X}-\mu_{\alpha/2}S$。<br>其中$bar{X}$为无数，S为标准差，$\mu$值可以查表得到。</p>
<p>案例：现在我们计算课本<sup><a href="#fn_１" id="reffn_１">１</a></sup>例2-1的资料估计正常成年女子的红细胞数的95%的参考值范围。计算结果如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_201.csv&quot;) #导入数据</div><div class="line">extract_data &lt;- raw_data[,1] # 提取第一列数据</div><div class="line">sd1 &lt;- sd(extract_data)</div><div class="line">mean1 &lt;- mean(extract_data)</div><div class="line">mean1 - 1.96*sd1 # 参考值的下限</div><div class="line">mean1 + 1.96*sd1 # 参考值的上限</div></pre></td></tr></table></figure></p>
<p>因此参考值的范围为3.353299，5.104657。</p>
<h3 id="百分位数法"><a href="#百分位数法" class="headerlink" title="百分位数法"></a>百分位数法</h3><p>偏态分布资料医学参考值范围的制定通常采用百分位数法，所要求的样本含量比正态分布法要多（不低于100），其计算公式为：<br>双侧$1-\alpha$参透值范围为：$P_{100\alpha/2}{\sim}P_{100-100\alpha/2}$</p>
<p>单侧$1-\alpha$参透值范围为：$&gt;P_{100\alpha}$或$&gt;P_{100-100\alpha}$<br>案例：课本无原始数据，此题略过。</p>
<h2 id="数据描述的练习"><a href="#数据描述的练习" class="headerlink" title="数据描述的练习"></a>数据描述的练习</h2><h3 id="例题2-1的描述性统计"><a href="#例题2-1的描述性统计" class="headerlink" title="例题2-1的描述性统计"></a>例题2-1的描述性统计</h3><p>（医学统计学.第四版.孙振球）</p>
<p>某医院用随机抽样方法检查了138名正常成年女子的红细胞数 ，其测量结果如下，试编制频数分布表。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_201.csv"</span>) </div><div class="line"><span class="comment">#导入数据</span></div><div class="line"></div><div class="line">extract_data &lt;- raw_data[,<span class="number">1</span>] </div><div class="line"><span class="comment"># 提取第一列数据</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(reshape2)</div><div class="line">breaks&lt;-seq(from = <span class="number">3.07</span>, to = <span class="number">5.47</span>, by = <span class="number">0.2</span>) </div><div class="line"><span class="comment"># 产生各个组距</span></div><div class="line"></div><div class="line">data_table&lt;-cut(extract_data,breaks=breaks,right=<span class="literal">FALSE</span>) </div><div class="line"><span class="comment">#分组,right=FALSE表示左闭右开</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(reshape2) </div><div class="line"><span class="comment">#载入reshape2包，使用其中的melt函数</span></div><div class="line"></div><div class="line">melt(table(data_table)) </div><div class="line"><span class="comment">#查看频数分布</span></div><div class="line"></div><div class="line">middle_data&lt;-c() </div><div class="line"><span class="comment">#求组中值，组中值从表中可以看出来就是区间两边的数的平均数</span></div><div class="line"></div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> seq(<span class="number">1</span>,<span class="number">12</span>))&#123;</div><div class="line">  middle &lt;- (breaks[i]+breaks[i+<span class="number">1</span>])*<span class="number">0.5</span></div><div class="line">  middle_data&lt;-append(middle_data,middle)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># 绘图表</span></div><div class="line">hist(extract_data,breaks,</div><div class="line">     right=<span class="literal">FALSE</span>,main=<span class="string">""</span>,</div><div class="line">     xlab=<span class="string">""</span>,ylab=<span class="string">"频数"</span>,</div><div class="line">     axes=<span class="literal">FALSE</span>,</div><div class="line">     border=<span class="string">"grey"</span>,</div><div class="line">     col=<span class="string">"red"</span>,freq=<span class="literal">F</span>)</div><div class="line"><span class="comment">#data为数据集，breaks则是分组依据，right=FALSE则是左开右闭,xlab，ylab控制坐标</span></div><div class="line"></div><div class="line">lines(density(extract_data)) </div><div class="line"><span class="comment">#加入概率密度曲线</span></div><div class="line"></div><div class="line">title(xlab=<span class="string">"红细胞数(×10e-12/L)"</span>,line=<span class="number">0.8</span>)</div><div class="line"><span class="comment">#加x轴的标题，往下超过x轴垂直距离为0.8个行距</span></div><div class="line"></div><div class="line">text(<span class="number">4.5</span>,-<span class="number">2.8</span>,<span class="string">"-12"</span>,cex=<span class="number">0.5</span>)</div><div class="line">mtext(<span class="string">"138名正常成年女性红细胞数的频数分布"</span>,<span class="number">1</span>,line=<span class="number">2.5</span>,cex=<span class="number">1.2</span>,font=<span class="number">2</span>)</div><div class="line"><span class="comment">#加主标题,1表示为下方</span></div><div class="line"><span class="comment"># line=2.5表示超过x轴垂直距离为2.5个行距</span></div><div class="line"><span class="comment"># cex为字体扩大倍数</span></div><div class="line"><span class="comment"># font=2表示加粗</span></div><div class="line"></div><div class="line">abline(h=<span class="number">0</span>)</div><div class="line"><span class="comment">#绘制y=0的线段，用此线表示x轴</span></div><div class="line"></div><div class="line">axis(<span class="number">1</span>,at=middle_data,tick=<span class="literal">FALSE</span>,pos=<span class="number">0.03</span>)</div><div class="line"><span class="comment"># 绘制x轴，坐标为middle_data</span></div><div class="line"><span class="comment"># tick=FALSE表示坐标刻度不绘出,pos=1表示坐标轴在y=1处</span></div><div class="line"></div><div class="line">axis(<span class="number">2</span>)</div><div class="line"><span class="comment">#绘制y轴</span></div></pre></td></tr></table></figure>
<p>频数分布如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; melt(table(data_table)) <span class="comment">#查看频数分布</span></div><div class="line">    data_table value</div><div class="line"><span class="number">1</span>  [<span class="number">3.07</span>,<span class="number">3.27</span>)     <span class="number">2</span></div><div class="line"><span class="number">2</span>  [<span class="number">3.27</span>,<span class="number">3.47</span>)     <span class="number">3</span></div><div class="line"><span class="number">3</span>  [<span class="number">3.47</span>,<span class="number">3.67</span>)     <span class="number">9</span></div><div class="line"><span class="number">4</span>  [<span class="number">3.67</span>,<span class="number">3.87</span>)    <span class="number">14</span></div><div class="line"><span class="number">5</span>  [<span class="number">3.87</span>,<span class="number">4.07</span>)    <span class="number">22</span></div><div class="line"><span class="number">6</span>  [<span class="number">4.07</span>,<span class="number">4.27</span>)    <span class="number">30</span></div><div class="line"><span class="number">7</span>  [<span class="number">4.27</span>,<span class="number">4.47</span>)    <span class="number">21</span></div><div class="line"><span class="number">8</span>  [<span class="number">4.47</span>,<span class="number">4.67</span>)    <span class="number">15</span></div><div class="line"><span class="number">9</span>  [<span class="number">4.67</span>,<span class="number">4.87</span>)    <span class="number">10</span></div><div class="line"><span class="number">10</span> [<span class="number">4.87</span>,<span class="number">5.07</span>)     <span class="number">6</span></div><div class="line"><span class="number">11</span> [<span class="number">5.07</span>,<span class="number">5.27</span>)     <span class="number">4</span></div><div class="line"><span class="number">12</span> [<span class="number">5.27</span>,<span class="number">5.47</span>)     <span class="number">2</span></div></pre></td></tr></table></figure>
<p>图表如下所示</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101705.png" alt=""></p>
<p>对例2-1，例2-2和例2-14已计算出某医院随机抽查的138名成年女子的红细胞数均数 ，标准差 。试估计该医院所抽查成年女子的红细胞数：①在4.0 以下者占成年女子总人数的百分比；②在4.00~5.00 之间者占成年女子总人数的百分比；③在5.00 以上者占成年女子总人数的百分比。<br>计算过程如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mean.data &lt;- mean(extract_data)</div><div class="line">sd.data &lt;- sd(extract_data)</div><div class="line">pnorm((4-mean.data)/sd.data) # 4.0以下的百分比</div><div class="line">pnorm((5-mean.data)/sd.data) #5.0以下的百分比</div><div class="line">1-pnorm((5-mean.data)/sd.data) #5.0以上的百分比</div><div class="line">pnorm((5-mean.data)/sd.data)-pnorm((4-mean.data)/sd.data) #在4.00~5.00 之间的百分比</div><div class="line"></div><div class="line">#或者是：</div><div class="line">pnorm(5,mean(data),sd(data))-pnorm(4,mean(data),sd(data))</div><div class="line"></div><div class="line"># 绘制数据集的正态分布图</div><div class="line">x &lt;- seq(min(extract_data)-0.52,max(extract_data)+0.52,length=1000)</div><div class="line">y &lt;- dnorm(x,mean(extract_data),sd(extract_data))</div><div class="line">r1 &lt;- 4</div><div class="line">r2 &lt;- 5</div><div class="line">x2 &lt;- c(r1,r1,x[x&lt;r2&amp;x&gt;r1],r2,r2)</div><div class="line">y2=c(0,dnorm(c(r1,x[x&lt;r2&amp;x&gt;r1],r2),mean(data),sd(data)),0)</div><div class="line">plot(x,y,type=&quot;l&quot;,xlab=&quot;&quot;,ylab=&quot;&quot;,lty=1)</div><div class="line">abline(0,0)</div><div class="line">polygon(x2,y2,col=&quot;grey&quot;)</div></pre></td></tr></table></figure></p>
<p><strong>结果如下所示：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[1] 0.3041459</div><div class="line">&gt; pnorm((5-mean.data)/sd.data) #5.0以下的百分比</div><div class="line">[1] 0.9578038</div><div class="line">&gt; 1-pnorm((5-mean.data)/sd.data) #5.0以上的百分比</div><div class="line">[1] 0.04219616</div><div class="line">&gt; pnorm((5-mean.data)/sd.data)-pnorm((4-mean.data)/sd.data) #在4.00~5.00 之间的百分比</div><div class="line">[1] 0.653658</div><div class="line">&gt; pnorm(5,mean(data),sd(data))-pnorm(4,mean(data),sd(data))</div><div class="line">[1] 0.6532998</div><div class="line">结果与书中的不太一样，但结果接近，我估计是因为书中是查表，用的是近似值，R中的比较精确</div></pre></td></tr></table></figure></p>
<p>数据的正态分布图如下所示：</p>
<p><img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101726.png" alt=""></p>
<h3 id="例2-4：几何均数"><a href="#例2-4：几何均数" class="headerlink" title="例2-4：几何均数"></a>例2-4：几何均数</h3><p>某地5例微丝蚴血症患者治疗7年后用间接荧光抗体试验没得某抗体满意度例数分别为10，20，40，40，160，求几何均数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data24&lt;-c(10,20,40,40,160)</div><div class="line">exp(mean(log(data24)))</div></pre></td></tr></table></figure>
<p>结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; data24</div><div class="line">[1]  10  20  40  40 160</div><div class="line">&gt; exp(mean(log(data24)))</div><div class="line">[1] 34.82202</div></pre></td></tr></table></figure></p>
<h3 id="例2-5-平均抗体滴度"><a href="#例2-5-平均抗体滴度" class="headerlink" title="例2-5 平均抗体滴度"></a>例2-5 平均抗体滴度</h3><p>69例风湿关节炎(RA)患者血清EBV-VCA-IgG抗体满意度的分布，求其平均抗体滴度。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data25&lt;-c(<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,</div><div class="line"><span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,</div><div class="line"><span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">1280</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">1280</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,</div><div class="line"><span class="number">320</span>,<span class="number">640</span>,<span class="number">40</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>)</div><div class="line">x &lt;- table(data25)</div><div class="line">x &lt;- data.frame(x)</div><div class="line">x$countdown &lt;- as.numeric(levels(x$data25))</div><div class="line">x$lgX &lt;- round(log10(x$countdown),<span class="number">4</span>)</div><div class="line">x$flgX &lt;- round(x$Freq*x$lgX,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line">  data25 Freq countdown    lgX    flgX</div><div class="line"><span class="number">1</span>     <span class="number">10</span>    <span class="number">4</span>        <span class="number">10</span> <span class="number">1.0000</span>  <span class="number">4.0000</span></div><div class="line"><span class="number">2</span>     <span class="number">20</span>    <span class="number">3</span>        <span class="number">20</span> <span class="number">1.3010</span>  <span class="number">3.9030</span></div><div class="line"><span class="number">3</span>     <span class="number">40</span>   <span class="number">10</span>        <span class="number">40</span> <span class="number">1.6021</span> <span class="number">16.0210</span></div><div class="line"><span class="number">4</span>     <span class="number">80</span>   <span class="number">10</span>        <span class="number">80</span> <span class="number">1.9031</span> <span class="number">19.0310</span></div><div class="line"><span class="number">5</span>    <span class="number">160</span>   <span class="number">11</span>       <span class="number">160</span> <span class="number">2.2041</span> <span class="number">24.2451</span></div><div class="line"><span class="number">6</span>    <span class="number">320</span>   <span class="number">15</span>       <span class="number">320</span> <span class="number">2.5051</span> <span class="number">37.5765</span></div><div class="line"><span class="number">7</span>    <span class="number">640</span>   <span class="number">14</span>       <span class="number">640</span> <span class="number">2.8062</span> <span class="number">39.2868</span></div><div class="line"><span class="number">8</span>   <span class="number">1280</span>    <span class="number">2</span>      <span class="number">1280</span> <span class="number">3.1072</span>  <span class="number">6.2144</span></div><div class="line"></div><div class="line">上述结果是书中的频数表，与R的计算关系不大，在R中可以直接计算，如下</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; exp(mean(log(data25)))</div><div class="line">[1] 150.6411</div></pre></td></tr></table></figure>
<h3 id="例2-6-中位数"><a href="#例2-6-中位数" class="headerlink" title="例2-6  中位数"></a>例2-6  中位数</h3><p>7名病人患某病的潜伏期分别为2，3，4，5，6，9，16天，求其中位数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; data26&lt;-c(2,3,4,5,6,9,16)</div><div class="line">&gt; median(data26)</div><div class="line">[1] 5</div></pre></td></tr></table></figure>
<h3 id="例2-11：均数和极差"><a href="#例2-11：均数和极差" class="headerlink" title="例2-11：均数和极差"></a>例2-11：均数和极差</h3><p>试计算下面三组同龄男孩的身高 均数和极差。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">range.f &lt;- function (x) (max(x)-min(x))</div><div class="line">甲组 &lt;- c(90,95,100,105,110)</div><div class="line">乙组 &lt;- c(96,98,100,102,104)</div><div class="line">丙组 &lt;- c(96,99,100,101,104)</div><div class="line">range.f(甲组)</div><div class="line">mean(甲组)</div><div class="line">range.f(乙组)</div><div class="line">mean(乙组)</div><div class="line">range.f(丙组)</div><div class="line">mean(丙组)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; range.f(甲组)</div><div class="line">[<span class="number">1</span>] <span class="number">20</span></div><div class="line">&gt; mean(甲组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line">&gt; range.f(乙组)</div><div class="line">[<span class="number">1</span>] <span class="number">8</span></div><div class="line">&gt; mean(乙组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line">&gt; range.f(丙组)</div><div class="line">[<span class="number">1</span>] <span class="number">8</span></div><div class="line">&gt; mean(丙组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>医学统计学.第四版.孙振球</li>
<li>小白统计.冯国双</li>
<li><a href="https://www.zhihu.com/question/20099757?rf=21126585" target="_blank" rel="external">为什么样本方差（sample variance）的分母是 n-1？</a></li>
<li>统计思维：程序员数学之概率统计.作者: Allen B.Downey，译者: 张建锋 / 陈钢 出版社: 人民邮电出版社</li>
<li><a href="https://blog.csdn.net/guolindonggld/article/details/87856780" target="_blank" rel="external">预测评价指标RMSE、MSE、MAE、MAPE、SMAPE</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/24/ggplot2/ggplot2(14)-练习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/24/ggplot2/ggplot2(14)-练习/" itemprop="url">ggplot2(14)-ggplot2练习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-24T12:00:00+08:00">
                2017-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,891
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  20
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这一篇笔记主要是翻译国外的一个网站的教程，它对<code>ggplot2</code>的绘图做了很好的汇总，原文地址：<a href="http://egret.psychol.cam.ac.uk/statistics/R/graphs2.html" target="_blank" rel="external">R: basic graphs 2 (with ggplot2)</a>，原始数据在原文上有。 </p>
<h2 id="第一部分：导入数据"><a href="#第一部分：导入数据" class="headerlink" title="第一部分：导入数据"></a>第一部分：导入数据</h2><p>原始数据文件有7个，我已经下载到本地硬盘，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/0gHKJDKL6c.png?imageslim" alt="mark"></p>
<p>直接导入即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"></div><div class="line">phdfig21a &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\PhD_fig21A.csv"</span>,header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line"><span class="comment"># header=TRUE表示要读取标题</span></div><div class="line"><span class="comment"># sep=","表示数据文件PhD_fig21A.csv中的数据是以逗号分割的，csv文件默认都是以逗号分割的，如果是以空格分割的，则用sep=" "（中间空一格）。</span></div><div class="line"><span class="comment"># na.strings="NA"是将空白的数据用NA替代</span></div><div class="line"><span class="comment"># dec="."用来表示小数点</span></div><div class="line"><span class="comment"># strip.white=TRUE 表示当指定了sep时，则将字符元素前后的空格去掉（而数值元素则默认是去掉前后的空格）</span></div><div class="line"></div><div class="line"></div><div class="line">phdfig37b &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\PhD_fig37B.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line"></div><div class="line">phdfig22d &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\PhD_fig22D.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line">phdfig23 &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\PhD_fig23.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line">phdfig28c &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\PhD_fig28C.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line">mdfig30a &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\MD_fig30A.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div><div class="line">mdfig30b &lt;- read.table(<span class="string">"D:\\Personal\\R_code\\data\\ggplot2\\MD_fig30B.csv"</span>, header=<span class="literal">TRUE</span>, sep=<span class="string">","</span>, na.strings=<span class="string">"NA"</span>, dec=<span class="string">"."</span>, strip.white=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p>查看一下其中的某个数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; head(phdfig37b) <span class="comment"># 先查看一下phdfig37b的数据集</span></div><div class="line">  session       sham ACCX  SEM_sham  SEM_accx</div><div class="line"><span class="number">1</span>       <span class="number">1</span>  <span class="number">0.0000000</span> -<span class="number">0.2</span> <span class="number">0.7881701</span> <span class="number">0.4163332</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span>  <span class="number">0.6666667</span> -<span class="number">0.3</span> <span class="number">0.4819992</span> <span class="number">0.3666667</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> -<span class="number">0.3333333</span> -<span class="number">0.2</span> <span class="number">0.7212503</span> <span class="number">0.5333333</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span>  <span class="number">1.5833333</span>  <span class="number">1.0</span> <span class="number">0.5833333</span> <span class="number">0.4714045</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> -<span class="number">0.2500000</span> -<span class="number">0.3</span> <span class="number">0.7699370</span> <span class="number">0.5174725</span></div><div class="line"><span class="number">6</span>       <span class="number">6</span>  <span class="number">1.7500000</span> -<span class="number">0.8</span> <span class="number">0.6410810</span> <span class="number">0.4898979</span></div><div class="line">&gt; tail(phdfig37b)</div><div class="line">   session     sham ACCX  SEM_sham  SEM_accx</div><div class="line"><span class="number">7</span>        <span class="number">7</span> <span class="number">1.000000</span> -<span class="number">1.1</span> <span class="number">0.8438727</span> <span class="number">0.7951240</span></div><div class="line"><span class="number">8</span>        <span class="number">8</span> <span class="number">4.083333</span>  <span class="number">0.2</span> <span class="number">1.0405297</span> <span class="number">0.6463573</span></div><div class="line"><span class="number">9</span>        <span class="number">9</span> <span class="number">4.666667</span>  <span class="number">1.6</span> <span class="number">0.6999278</span> <span class="number">0.5617433</span></div><div class="line"><span class="number">10</span>      <span class="number">10</span> <span class="number">3.333333</span>  <span class="number">3.3</span> <span class="number">1.0249415</span> <span class="number">1.0005554</span></div><div class="line"><span class="number">11</span>      <span class="number">11</span> <span class="number">4.500000</span>  <span class="number">5.3</span> <span class="number">0.7229988</span> <span class="number">1.0857665</span></div><div class="line"><span class="number">12</span>      <span class="number">12</span> <span class="number">4.416667</span>  <span class="number">3.9</span> <span class="number">0.6331539</span> <span class="number">0.7063207</span></div></pre></td></tr></table></figure>
<p>现在构建ggplot2能够识别的数据框，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">phdfig37b_long = with(phdfig37b,</div><div class="line">                      rbind( data.frame( lesion = <span class="string">"sham"</span>, session = session, diffscore = sham, sem = SEM_sham ),</div><div class="line">                             data.frame( lesion = <span class="string">"ACCX"</span>, session = session, diffscore = ACCX, sem = SEM_accx ) )</div><div class="line">)</div><div class="line"><span class="comment"># 建立一个数据框，第1列为lesion，并且为"sham"</span></div><div class="line"><span class="comment"># 第2列为session，值等于phdfig37b中的session</span></div><div class="line"><span class="comment"># 第3列为diffscore，值等于sham,第4列为sem，值等于SEM_sham</span></div></pre></td></tr></table></figure>
<p>查看一下数据框，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(phdfig37b_long)</div><div class="line">  lesion session  diffscore       sem</div><div class="line">1   sham       1  0.0000000 0.7881701</div><div class="line">2   sham       2  0.6666667 0.4819992</div><div class="line">3   sham       3 -0.3333333 0.7212503</div><div class="line">4   sham       4  1.5833333 0.5833333</div><div class="line">5   sham       5 -0.2500000 0.7699370</div><div class="line">6   sham       6  1.7500000 0.6410810</div></pre></td></tr></table></figure>
<h2 id="第二部分-qplot快速制图"><a href="#第二部分-qplot快速制图" class="headerlink" title="第二部分 qplot快速制图"></a>第二部分 qplot快速制图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p&lt;-qplot(session, diffscore, colour=lesion, data=phdfig37b_long) </div><div class="line">p&lt;-p+ geom_line() </div><div class="line">p&lt;-p+ geom_errorbar(aes(ymin = diffscore - sem, ymax = diffscore + sem))</div><div class="line">p</div><div class="line"><span class="comment"># 绘制数据集phdfig37b_long的图形，使x轴=session,y轴=diffscore,颜色属性=lesion</span></div><div class="line"><span class="comment"># geom_line() 添加折线图</span></div><div class="line"><span class="comment"># geom_errorbar 添加误差线</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/JiFGiGi39i.png?imageslim" alt="mark"></p>
<h2 id="第三部分：ggplot制图"><a href="#第三部分：ggplot制图" class="headerlink" title="第三部分：ggplot制图"></a>第三部分：ggplot制图</h2><p>目标：</p>
<ol>
<li>绘制折线图；</li>
<li>添加误差线；</li>
<li>分类；</li>
<li>添加参考线。</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(grid) <span class="comment"># 后面要用到unit函数</span></div><div class="line"></div><div class="line">f1 &lt;- ggplot(data = phdfig37b_long, aes(x = session, y = diffscore, group = lesion) ) + <span class="comment"># 绘图phdfig37b_long数据集的图形，使x轴=session,y轴=diffscore,group在这里的意思是，desion中的数据不属于一组</span></div><div class="line">  geom_errorbar(aes(ymin = diffscore - sem, ymax = diffscore + sem), width=<span class="number">0.3</span>) +</div><div class="line">  <span class="comment"># 添加误差线，指定宽度为0.4</span></div><div class="line">  geom_line() + <span class="comment"># 添加折线</span></div><div class="line">  geom_point(aes(shape=lesion, fill=lesion), size=<span class="number">5</span>) + <span class="comment"># 添加数据点，将lesion映射到形状属性上，将将lesion映射到填充属性上（即数据点内部的颜色，非轮廓）</span></div><div class="line">  scale_x_continuous(<span class="string">"Session"</span>, breaks=<span class="number">1</span>:<span class="number">12</span>) + <span class="comment"># 对x轴上的sesssion指定刻度，从1到12</span></div><div class="line">  scale_y_continuous(<span class="string">"Difference score"</span>, limits = c(-<span class="number">4</span>, <span class="number">8</span>), breaks=seq(-<span class="number">4</span>, <span class="number">8</span>, by = <span class="number">2</span>)) + <span class="comment"># 指定y轴的刻度</span></div><div class="line">  scale_shape_manual(values=c(<span class="number">24</span>,<span class="number">21</span>)) + <span class="comment"># 设置数据点的形状，一个是24,一个是21,24表示正三角，21表示圆形</span></div><div class="line">  scale_fill_manual(values=c(<span class="string">"white"</span>,<span class="string">"black"</span>)) + <span class="comment"># 指定数据点的颜色，一个是白色，一个是黑色</span></div><div class="line">  geom_abline(intercept=<span class="number">0</span>, slope=<span class="number">0</span>, linetype=<span class="string">"dotted"</span>) + <span class="comment"># 添加参考线，截距是0，斜率是0，点的类型是点状</span></div><div class="line">  annotate(<span class="string">"text"</span>, x=<span class="number">11</span>, y=-<span class="number">0.25</span>, label=<span class="string">"chance"</span>) + <span class="comment"># 添加注释，坐标为(11,-0.25)，文字为"chance"</span></div><div class="line">  theme_bw() + <span class="comment"># 将绘图的主题改为白色</span></div><div class="line">  ggtitle(<span class="string">"Two-stimulus discriminated approach task"</span>)+ <span class="comment"># 添加图形的标题</span></div><div class="line">  theme(</div><div class="line">    plot.title = element_text(face=<span class="string">"bold"</span>, size=<span class="number">14</span>), <span class="comment"># 修改标题文本的属性</span></div><div class="line">    axis.title.x = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>), <span class="comment"># 修改x轴标签文本的属性</span></div><div class="line">    axis.title.y = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>, angle=<span class="number">90</span>),<span class="comment"># 修改y轴标签文本的属性</span></div><div class="line">    axis.text.x=element_text(size=<span class="number">15</span>), <span class="comment"># 修改x轴坐标轴刻度的大小</span></div><div class="line">    panel.grid.major = element_blank(), <span class="comment"># 移除绘图区域的主要网格线</span></div><div class="line">    panel.grid.minor = element_blank(), <span class="comment"># 移除绘图区域的次要网格线</span></div><div class="line">    legend.position = c(<span class="number">0.2</span>,<span class="number">0.8</span>), <span class="comment"># 图例的位置坐标</span></div><div class="line">    legend.title = element_blank(), <span class="comment"># 图例标题为空</span></div><div class="line">    legend.text = element_text(size=<span class="number">12</span>), <span class="comment"># 图例中项目文本的大小</span></div><div class="line">    legend.key.size = unit(<span class="number">1.5</span>, <span class="string">"lines"</span>), <span class="comment"># 图例中项目的间隔，需要grid包</span></div><div class="line">    legend.key = element_blank() <span class="comment"># 移除图例中项目的边框</span></div><div class="line">  )</div><div class="line">print(f1)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/GI0gJc50De.png?imageslim" alt="mark"></p>
<h2 id="第四部分：输出图形"><a href="#第四部分：输出图形" class="headerlink" title="第四部分：输出图形"></a>第四部分：输出图形</h2><p>保存图形命令如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ggsave(filename=<span class="string">"d:\\我的图形.pdf"</span>,plot=f1)形为f1</div><div class="line"><span class="comment">## Saving 5 x 4 in image</span></div><div class="line"><span class="comment"># 另外一些保存图形的方法，如下所示：</span></div><div class="line">ggsave(<span class="string">"d:\\f1.pdf"</span>)</div><div class="line"><span class="comment">## Saving 5 x 4 in image</span></div><div class="line">ggsave(<span class="string">"d:\\f1.png"</span>,dpi=<span class="number">300</span>) <span class="comment"># 保存f1，分辨率为300dpi</span></div><div class="line"><span class="comment">## Saving 5 x 4 in image</span></div></pre></td></tr></table></figure>
<h2 id="第五部分：自由浮动的SED"><a href="#第五部分：自由浮动的SED" class="headerlink" title="第五部分：自由浮动的SED"></a>第五部分：自由浮动的SED</h2><h3 id="A-构建数据框"><a href="#A-构建数据框" class="headerlink" title="A.构建数据框"></a>A.构建数据框</h3><p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">phdfig21a_long &lt;- with(phdfig21a,</div><div class="line">                       rbind( data.frame( lesion = <span class="string">"sham"</span>, lever = <span class="string">"CRf"</span>, dose = dose, sqrtpresses = shamCR, sem = SEMshamCR, halfSED = halfSED[<span class="number">1</span>] ),</div><div class="line">                              data.frame( lesion = <span class="string">"sham"</span>, lever = <span class="string">"NCRf"</span>, dose = dose, sqrtpresses = shamNCR, sem = SEMshamNCR, halfSED = halfSED[<span class="number">1</span>] ),</div><div class="line">                              data.frame( lesion = <span class="string">"ACCX"</span>, lever = <span class="string">"CRf"</span>, dose = dose, sqrtpresses = ACCXCR, sem = SEMACCXCR, halfSED = halfSED[<span class="number">1</span>] ),</div><div class="line">                              data.frame( lesion = <span class="string">"ACCX"</span>, lever = <span class="string">"NCRf"</span>, dose = dose, sqrtpresses = ACCXNCR, sem = SEMACCXNCR, halfSED = halfSED[<span class="number">1</span>] ) )</div><div class="line">)</div><div class="line">head(phdfig21a_long)</div></pre></td></tr></table></figure>
<p>数据如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(phdfig21a_long)</div><div class="line">  lesion lever dose sqrtpresses       sem halfSED</div><div class="line">1   sham   CRf    0    5.112528 0.5539816  0.9396</div><div class="line">2   sham   CRf    3    6.829842 1.0673567  0.9396</div><div class="line">3   sham   CRf   10    9.230089 0.9947341  0.9396</div><div class="line">4   sham   CRf   20    8.563017 0.8215663  0.9396</div><div class="line">5   sham  NCRf    0    3.685772 0.4961057  0.9396</div><div class="line">6   sham  NCRf    3    4.024871 0.6831637  0.9396</div></pre></td></tr></table></figure>
<h3 id="B-再添加一个新的变量，并查看数据，如下所示："><a href="#B-再添加一个新的变量，并查看数据，如下所示：" class="headerlink" title="B. 再添加一个新的变量，并查看数据，如下所示："></a>B. 再添加一个新的变量，并查看数据，如下所示：</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">phdfig21a_long &lt;- within(phdfig21a_long, &#123;</div><div class="line">  <span class="comment"># 加入一列新的变量 </span></div><div class="line">  lesion_lever &lt;- do.call(paste, c(phdfig21a_long[c(<span class="string">"lesion"</span>, <span class="string">"lever"</span>)], sep = <span class="string">" "</span>))</div><div class="line">  <span class="comment"># do.call表示，运行函数paste,将phdfig21a_long中的lession与lever用空格连接起来，并生成一列新的变量 </span></div><div class="line">  lesion_lever &lt;- factor(lesion_lever, levels=unique(lesion_lever))</div><div class="line">  <span class="comment"># unique(lesion_lever)返回phdfig21a_long数据集中的lesion_lever中的重复元素，即提取出互不相同的元素（如果有相同的几个则取一个，只有一个的，也取一个）</span></div><div class="line">  dose &lt;- factor(dose)</div><div class="line">&#125;)</div><div class="line">head(phdfig21a_long)</div></pre></td></tr></table></figure>
<p>修改后的数据框如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(phdfig21a_long)</div><div class="line">  lesion lever dose sqrtpresses       sem halfSED lesion_lever</div><div class="line"><span class="number">1</span>   sham   CRf    <span class="number">0</span>    <span class="number">5.112528</span> <span class="number">0.5539816</span>  <span class="number">0.9396</span>     sham CRf</div><div class="line"><span class="number">2</span>   sham   CRf    <span class="number">3</span>    <span class="number">6.829842</span> <span class="number">1.0673567</span>  <span class="number">0.9396</span>     sham CRf</div><div class="line"><span class="number">3</span>   sham   CRf   <span class="number">10</span>    <span class="number">9.230089</span> <span class="number">0.9947341</span>  <span class="number">0.9396</span>     sham CRf</div><div class="line"><span class="number">4</span>   sham   CRf   <span class="number">20</span>    <span class="number">8.563017</span> <span class="number">0.8215663</span>  <span class="number">0.9396</span>     sham CRf</div><div class="line"><span class="number">5</span>   sham  NCRf    <span class="number">0</span>    <span class="number">3.685772</span> <span class="number">0.4961057</span>  <span class="number">0.9396</span>    sham NCRf</div><div class="line"><span class="number">6</span>   sham  NCRf    <span class="number">3</span>    <span class="number">4.024871</span> <span class="number">0.6831637</span>  <span class="number">0.9396</span>    sham NCRf</div></pre></td></tr></table></figure>
<h3 id="C-绘图"><a href="#C-绘图" class="headerlink" title="C.绘图"></a>C.绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">f2 &lt;- ggplot(data = phdfig21a_long, aes(x = dose, y = sqrtpresses, group = lesion_lever ) ) +</div><div class="line">  geom_line() +</div><div class="line">  geom_point(aes(shape=lesion_lever, fill=lesion_lever), size=<span class="number">5</span>) + <span class="comment"># 将变量lesion_lever映射到shape上，将lesion_lever映射到填充色上</span></div><div class="line">  geom_errorbar(aes(x=<span class="number">1</span>, ymin=<span class="number">10</span> - phdfig21a$halfSED[<span class="number">1</span>], ymax=<span class="number">10</span> + phdfig21a$halfSED[<span class="number">1</span>], width = <span class="number">0.2</span>)) + <span class="comment"># 绘制一个误差棒，位置是x=1，宽度为0.2</span></div><div class="line">  scale_shape_manual(values=c(<span class="number">21</span>,<span class="number">24</span>,<span class="number">21</span>,<span class="number">24</span>)) + <span class="comment"># 指定shamCR, shamNCR, ACCXCR, ACCXNCR这四种类型的形状，分别为圆、三角、圆、三角</span></div><div class="line">  scale_fill_manual(values=c(<span class="string">"white"</span>,<span class="string">"white"</span>,<span class="string">"black"</span>,<span class="string">"black"</span>)) + <span class="comment"># 指定shamCR, shamNCR, ACCXCR, ACCXNCR这四种类型的颜色，分别为白、白、黑、黑</span></div><div class="line">  xlab(substitute(paste(<span class="string">"Intra-Acb amphetamine ("</span>,mu,<span class="string">"g)"</span>))) + <span class="comment">#添加x轴标签，substitute用来显示公式，</span></div><div class="line">  scale_y_continuous(expression(sqrt(<span class="string">"lever presses"</span>)), expand=c(<span class="number">0</span>,<span class="number">0</span>), limits = c(<span class="number">0</span>, <span class="number">14</span>), breaks=seq(<span class="number">0</span>, <span class="number">14</span>, by = <span class="number">2</span>)) + <span class="comment"># the "expand" bit prevents ggplot2 from expanding the axis a little beyond what you specify</span></div><div class="line">  annotate(<span class="string">"text"</span>, x=<span class="number">1.4</span>, y=<span class="number">10</span>, label=<span class="string">"SED"</span>) +</div><div class="line">  theme_bw() +</div><div class="line">  ggtitle(<span class="string">"Conditioned reinforcement"</span>)+ <span class="comment"># 添加图形的标题</span></div><div class="line">  theme(plot.title = element_text(face=<span class="string">"bold"</span>, size=<span class="number">14</span>),</div><div class="line">        axis.title.x = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>),</div><div class="line">        axis.title.y = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>, angle=<span class="number">90</span>),</div><div class="line">        panel.grid.major = element_blank(),</div><div class="line">        panel.grid.minor = element_blank(),</div><div class="line">        panel.border=element_blank(), <span class="comment"># 取消绘图区域四周的边框</span></div><div class="line">        axis.line=element_line(colour=<span class="string">"black"</span>), <span class="comment"># 添加坐标轴（即x轴与y轴）的直线</span></div><div class="line">        legend.position = c(<span class="number">0.8</span>,<span class="number">0.2</span>),</div><div class="line">        legend.title = element_blank(),</div><div class="line">        legend.text = element_text(size=<span class="number">10</span>),</div><div class="line">        legend.key.size = unit(<span class="number">1</span>, <span class="string">"lines"</span>),</div><div class="line">        legend.key = element_blank()</div><div class="line">  )</div><div class="line">print(f2)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/55FLjcD9LL.png?imageslim" alt="mark"></p>
<h2 id="第六部分-绘制双变量的条形图及误差棒"><a href="#第六部分-绘制双变量的条形图及误差棒" class="headerlink" title="第六部分 绘制双变量的条形图及误差棒"></a>第六部分 绘制双变量的条形图及误差棒</h2><h3 id="A-整理数据"><a href="#A-整理数据" class="headerlink" title="A.整理数据"></a>A.整理数据</h3><p>查看数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; phdfig22d</div><div class="line">  group CSpluslatency CSminuslatency CSplusSEM CSminusSEM</div><div class="line"><span class="number">1</span>  sham      <span class="number">3.884335</span>       <span class="number">4.212531</span> <span class="number">0.2248404</span>  <span class="number">0.2593122</span></div><div class="line"><span class="number">2</span>  ACCX      <span class="number">4.672486</span>       <span class="number">3.619434</span> <span class="number">0.3476289</span>  <span class="number">0.4902273</span></div></pre></td></tr></table></figure>
<p>整理数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">phdfig22d_long = with(phdfig22d,</div><div class="line">                      rbind( data.frame( lesion=group, stimulus=<span class="string">"CS+"</span>, latency=CSpluslatency, sem=CSplusSEM ),</div><div class="line">                             data.frame( lesion=group, stimulus=<span class="string">"CS-"</span>, latency=CSminuslatency, sem=CSminusSEM ) )</div><div class="line">)</div><div class="line">phdfig22d_long$lesion = factor(phdfig22d_long$lesion, levels=unique(phdfig22d_long$lesion))</div></pre></td></tr></table></figure>
<p>上述代码是生成phdfig22d_long数据框，这个数据框有四列变量，分别为lesion,stimulus,lantency，sem，查看数据，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; phdfig22d_long</div><div class="line">  lesion stimulus  latency       sem</div><div class="line">1   sham      CS+ 3.884335 0.2248404</div><div class="line">2   ACCX      CS+ 4.672486 0.3476289</div><div class="line">3   sham      CS- 4.212531 0.2593122</div><div class="line">4   ACCX      CS- 3.619434 0.4902273</div></pre></td></tr></table></figure>
<h3 id="B-绘图"><a href="#B-绘图" class="headerlink" title="B.绘图"></a>B.绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">f3 &lt;- ggplot(data = phdfig22d_long, aes(x=lesion, y=latency, fill=stimulus) ) +</div><div class="line">  geom_errorbar(aes(ymin=latency, ymax=latency+sem, width = <span class="number">0.2</span>),position=position_dodge(width=<span class="number">0.90</span>)) + <span class="comment"># 误差棒只添加上部分，因此误差棒的最低部是latency，最上部是lantency + sem，宽度是0.2，最低部与最上部进行堆叠(position_dodge)</span></div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>, position=<span class="string">"dodge"</span>) +</div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>, position=<span class="string">"dodge"</span>, colour=<span class="string">"black"</span>) +</div><div class="line">  scale_fill_manual(values=c(<span class="string">"grey80"</span>, <span class="string">"white"</span>)) + <span class="comment"># 对两个变量进行颜色填充，分别为灰度80与白色</span></div><div class="line">  xlab(<span class="string">""</span>) + <span class="comment"># x轴不添加标签</span></div><div class="line">  scale_y_continuous(<span class="string">"Latency to approach (s)"</span>, expand=c(<span class="number">0</span>,<span class="number">0</span>), limits = c(<span class="number">0</span>, <span class="number">5.5</span>)) + <span class="comment"># expand=c(0,0) 表示将y轴从0开始</span></div><div class="line">  theme_bw() +</div><div class="line">  ggtitle(<span class="string">"Autoshaping approach latencies"</span>)+</div><div class="line">  theme(</div><div class="line">    panel.grid.major = element_blank(),</div><div class="line">    panel.grid.minor = element_blank(),</div><div class="line">    panel.border = element_blank(),</div><div class="line">    axis.line=element_line(colour=<span class="string">"black"</span>),</div><div class="line">    axis.text.y=element_text(angle=<span class="number">90</span>, hjust=<span class="number">0.5</span>),</div><div class="line">    legend.position = c(<span class="number">0.25</span>,<span class="number">0.85</span>),</div><div class="line">    legend.key = element_rect()</div><div class="line">  )</div><div class="line">print(f3)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/2ak0mja935.png?imageslim" alt="mark"></p>
<h2 id="第七部分：带有注释线的误差棒"><a href="#第七部分：带有注释线的误差棒" class="headerlink" title="第七部分：带有注释线的误差棒"></a>第七部分：带有注释线的误差棒</h2><h3 id="A-查看数据"><a href="#A-查看数据" class="headerlink" title="A.查看数据"></a>A.查看数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h3 id="B-整理数据"><a href="#B-整理数据" class="headerlink" title="B.整理数据"></a>B.整理数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">phdfig23_long = with(phdfig23,</div><div class="line">rbind( data.frame( lesion=group, stimulus=<span class="string">"CS+"</span>, approaches=CSplus, sem=SEMCSplus ),</div><div class="line">data.frame( lesion=group, stimulus=<span class="string">"CS-"</span>, approaches=CSminus, sem=SEMCSminus ) )</div><div class="line">)</div></pre></td></tr></table></figure>
<p>查看数据，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; phdfig23_long</div><div class="line">  lesion stimulus approaches       sem</div><div class="line">1   sham      CS+  14.000000 0.9309493</div><div class="line">2   ACCX      CS+   9.857143 1.0785478</div><div class="line">3   sham      CS-   4.500000 0.8595865</div><div class="line">4   ACCX      CS-   6.428571 1.0658585</div></pre></td></tr></table></figure>
<h3 id="C-绘图-1"><a href="#C-绘图-1" class="headerlink" title="C.绘图"></a>C.绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">f4 &lt;- ggplot(data = phdfig23_long, aes(x=lesion, y=approaches, fill=stimulus, width=<span class="number">0.5</span>) ) +</div><div class="line">geom_errorbar(aes(ymin=approaches, ymax=approaches+sem, width = <span class="number">0.2</span>), position=position_dodge(width=<span class="number">0.8</span>)) +</div><div class="line">geom_bar(stat=<span class="string">"identity"</span>, position=position_dodge(width=<span class="number">0.8</span>)) +</div><div class="line">geom_bar(stat=<span class="string">"identity"</span>, position=position_dodge(width=<span class="number">0.8</span>), colour=<span class="string">"black"</span>) +</div><div class="line">scale_fill_manual(values=c(<span class="string">"grey80"</span>, <span class="string">"white"</span>)) +</div><div class="line">scale_x_discrete(<span class="string">"Group"</span>, limits=c(<span class="string">"sham"</span>, <span class="string">"ACCX"</span>)) + <span class="comment"># 设置x轴上的分类变量，顺序为sham,ACCX</span></div><div class="line">scale_y_continuous(<span class="string">"Number of approaches"</span>, expand=c(<span class="number">0</span>,<span class="number">0</span>), limits = c(<span class="number">0</span>, <span class="number">17</span>), breaks=seq(<span class="number">0</span>, <span class="number">16</span>, by=<span class="number">2</span>)) +</div><div class="line">geom_segment(aes(x=<span class="number">0.8</span>, y=<span class="number">15.3</span>, xend=<span class="number">0.8</span>, yend=<span class="number">16</span>)) +</div><div class="line">geom_segment(aes(x=<span class="number">0.8</span>, y=<span class="number">16</span>, xend=<span class="number">1.2</span>, yend=<span class="number">16</span>)) +</div><div class="line">geom_segment(aes(x=<span class="number">1.2</span>, y=<span class="number">6</span>, xend=<span class="number">1.2</span>, yend=<span class="number">16</span>)) + <span class="comment"># 添加注释线，注意坐标</span></div><div class="line">annotate(<span class="string">"text"</span>, x=<span class="number">1</span>, y=<span class="number">15.5</span>, label=<span class="string">"***"</span>) +</div><div class="line">theme_bw() +</div><div class="line">ggtitle(<span class="string">"Autoshaping probe test"</span>)+</div><div class="line">theme( plot.title = element_text(face=<span class="string">"bold"</span>, size=<span class="number">14</span>),</div><div class="line">axis.title.x = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>),</div><div class="line">axis.title.y = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>, angle=<span class="number">90</span>),</div><div class="line">panel.grid.major = element_blank(),</div><div class="line">panel.grid.minor = element_blank(),</div><div class="line">panel.border = element_blank(),</div><div class="line">axis.line=element_line(colour=<span class="string">"black"</span>),</div><div class="line">axis.text.y=element_text(angle=<span class="number">90</span>, hjust=<span class="number">0.5</span>),</div><div class="line">legend.title = element_blank(),</div><div class="line">legend.position = c(<span class="number">0.85</span>,<span class="number">0.85</span>),</div><div class="line">legend.key.size = unit(<span class="number">1.5</span>, <span class="string">"lines"</span>),</div><div class="line">legend.key = element_rect()</div><div class="line">)</div><div class="line">print(f4)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/2i7D593k3E.png?imageslim" alt="mark"></p>
<p>代码解释：</p>
<p>上述代码中有一部分是添加注释线的，就是与三个星号在一起的一段线。代码为： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">geom_segment(aes(x=<span class="number">0.8</span>, y=<span class="number">15.3</span>, xend=<span class="number">0.8</span>, yend=<span class="number">16</span>)) +</div><div class="line">geom_segment(aes(x=<span class="number">0.8</span>, y=<span class="number">16</span>, xend=<span class="number">1.2</span>, yend=<span class="number">16</span>)) +</div><div class="line">geom_segment(aes(x=<span class="number">1.2</span>, y=<span class="number">6</span>, xend=<span class="number">1.2</span>, yend=<span class="number">16</span>)) + <span class="comment"># 添加注释线，注意坐标</span></div><div class="line">annotate(<span class="string">"text"</span>, x=<span class="number">1</span>, y=<span class="number">15.5</span>, label=<span class="string">"***"</span>) +</div></pre></td></tr></table></figure>
<p>在添加注释线的时候，如果要精确地绘制，需要知道x轴上条形图中心的坐标，可以用str(print(f4))查看，str(print(f4))，前5行的数字为： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">List of 3</div><div class="line">$ data :List of 7</div><div class="line">..$ :&apos;data.frame&apos;: 4 obs. of 9 variables:</div><div class="line">.. ..$ fill : chr [1:4] &quot;grey80&quot; &quot;white&quot; &quot;grey80&quot; &quot;white&quot;</div><div class="line">.. ..$ x : num [1:4] 0.8 1.2 1.8 2.2</div></pre></td></tr></table></figure>
<p>其中第5行是： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.. ..$ x : num [1:4] 0.8 1.2 1.8 2.2</div></pre></td></tr></table></figure>
<p>可以发现，条形图第一个条带的中心处，对应的x轴坐标为0.8，因此在绘制注释线的时候，x的起点为是0.8。 </p>
<h2 id="第八部分：含有双向x轴的绘图"><a href="#第八部分：含有双向x轴的绘图" class="headerlink" title="第八部分：含有双向x轴的绘图"></a>第八部分：含有双向x轴的绘图</h2><h3 id="A-查看原始数据"><a href="#A-查看原始数据" class="headerlink" title="A.查看原始数据"></a>A.查看原始数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; phdfig28c</div><div class="line">  block      sham      ACCX    SEMsham    SEMACCX</div><div class="line">1    -3 0.8905724 0.8648725 0.04328269 0.05561053</div><div class="line">2    -2 0.9212121 0.8789751 0.03030303 0.03002131</div><div class="line">3    -1 0.9237374 0.9204775 0.02654952 0.02897810</div><div class="line">4     0        NA        NA         NA         NA</div><div class="line">5     1 0.7755162 0.6273393 0.04621826 0.05090232</div><div class="line">6     2 0.8674289 0.6453398 0.05521676 0.05800651</div><div class="line">7     3 0.8327228 0.6989440 0.07589090 0.06084011</div><div class="line">8     4 0.9145688 0.8424770 0.03463735 0.03901640</div><div class="line">9     5 0.8874644 0.8592287 0.03880296 0.04260364</div></pre></td></tr></table></figure>
<h3 id="B-整理数据-1"><a href="#B-整理数据-1" class="headerlink" title="B.整理数据"></a>B.整理数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">phdfig28c_long &lt;- with(phdfig28c,</div><div class="line">rbind( data.frame( block=block, lesion=<span class="string">"sham"</span>, diffscore=sham, sem=SEMsham ),</div><div class="line">data.frame( block=block, lesion=<span class="string">"ACCX"</span>, diffscore=ACCX, sem=SEMACCX ) ) )</div><div class="line">phdfig28c_long <span class="comment"># 查看整理后的数据</span></div></pre></td></tr></table></figure>
<p>整理后的数据如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; phdfig28c_long # 查看整理后的数据</div><div class="line">   block lesion diffscore        sem</div><div class="line">1     -3   sham 0.8905724 0.04328269</div><div class="line">2     -2   sham 0.9212121 0.03030303</div><div class="line">3     -1   sham 0.9237374 0.02654952</div><div class="line">4      0   sham        NA         NA</div><div class="line">5      1   sham 0.7755162 0.04621826</div><div class="line">6      2   sham 0.8674289 0.05521676</div><div class="line">7      3   sham 0.8327228 0.07589090</div><div class="line">8      4   sham 0.9145688 0.03463735</div><div class="line">9      5   sham 0.8874644 0.03880296</div><div class="line">10    -3   ACCX 0.8648725 0.05561053</div><div class="line">11    -2   ACCX 0.8789751 0.03002131</div><div class="line">12    -1   ACCX 0.9204775 0.02897810</div><div class="line">13     0   ACCX        NA         NA</div><div class="line">14     1   ACCX 0.6273393 0.05090232</div><div class="line">15     2   ACCX 0.6453398 0.05800651</div><div class="line">16     3   ACCX 0.6989440 0.06084011</div><div class="line">17     4   ACCX 0.8424770 0.03901640</div><div class="line">18     5   ACCX 0.8592287 0.04260364</div></pre></td></tr></table></figure>
<h3 id="C-绘图-2"><a href="#C-绘图-2" class="headerlink" title="C.绘图"></a>C.绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">f5 &lt;- ggplot(data = phdfig28c_long, aes(x = block, y = diffscore, group = lesion) ) +</div><div class="line">geom_errorbar(aes(ymin = diffscore - sem, ymax = diffscore + sem), width=<span class="number">0.3</span>) +</div><div class="line">geom_line() +</div><div class="line">geom_point(aes(shape=lesion, fill=lesion), size=<span class="number">5</span>) +</div><div class="line">scale_x_continuous(<span class="string">"Trial block"</span>, expand=c(<span class="number">0</span>,<span class="number">0</span>), limits=c(-<span class="number">3.5</span>,<span class="number">5.5</span>), breaks=-<span class="number">3</span>:<span class="number">5</span>, labels=c(<span class="string">"-3"</span>,<span class="string">"-2"</span>,<span class="string">"-1"</span>,<span class="string">"surgery"</span>,<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>,<span class="string">"5"</span>)) +</div><div class="line">scale_y_continuous(<span class="string">"Difference score"</span>, expand=c(<span class="number">0</span>,<span class="number">0</span>), limits = c(<span class="number">0.4</span>, <span class="number">1</span>), breaks=seq(<span class="number">0.4</span>, <span class="number">1</span>, by = <span class="number">0.1</span>)) +</div><div class="line">scale_shape_manual(values=c(<span class="number">24</span>,<span class="number">21</span>)) +</div><div class="line">scale_fill_manual(values=c(<span class="string">"white"</span>,<span class="string">"black"</span>)) +</div><div class="line">geom_abline(intercept=<span class="number">0.5</span>, slope=<span class="number">0</span>, linetype=<span class="string">"dotted"</span>) + <span class="comment"># 截距为0.5，斜率为0的虚线</span></div><div class="line">annotate(<span class="string">"text"</span>, x=-<span class="number">2</span>, y=<span class="number">0.48</span>, label=<span class="string">"chance"</span>) +</div><div class="line">theme_bw() +</div><div class="line">theme(plot.margin=unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1.5</span>,<span class="number">1.5</span>), <span class="string">"lines"</span>), <span class="comment"># 分别指的是整个绘图区域（包括x轴与y轴的标签）距离顶边，右边，底边，左边的距离（默认是1，1，0.5，0.5）</span></div><div class="line">axis.ticks.margin=unit(<span class="number">0.25</span>,<span class="string">"lines"</span>), <span class="comment"># 坐标轴刻度的值距离刻度线的距离</span></div><div class="line">axis.title.x = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>, vjust=-<span class="number">1</span>), <span class="comment"># use vjust to move text away from the axis</span></div><div class="line">axis.title.y = element_text(face=<span class="string">"bold"</span>, size=<span class="number">12</span>, angle=<span class="number">90</span>, vjust=<span class="number">0</span>), <span class="comment"># likewise</span></div><div class="line">panel.grid.major = element_blank(),</div><div class="line">panel.grid.minor = element_blank(),</div><div class="line">legend.position = c(<span class="number">0.2</span>,<span class="number">0.4</span>),</div><div class="line">legend.title = element_blank(),</div><div class="line">legend.text = element_text(size=<span class="number">12</span>),</div><div class="line">legend.key.size = unit(<span class="number">1.5</span>, <span class="string">"lines"</span>),</div><div class="line">legend.key = element_blank() <span class="comment"># switch off the rectangle around symbols in the legend</span></div><div class="line">)</div><div class="line">print(f5)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/H5I1Ckim3m.png?imageslim" alt="mark"></p>
<h2 id="第九部分：分面、折线、星号"><a href="#第九部分：分面、折线、星号" class="headerlink" title="第九部分：分面、折线、星号"></a>第九部分：分面、折线、星号</h2><h3 id="A-查看原始数据-1"><a href="#A-查看原始数据-1" class="headerlink" title="A.查看原始数据"></a>A.查看原始数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; mdfig30a</div><div class="line">  delay     sham    SEMsham     AcbC    SEMAcbC</div><div class="line"><span class="number">1</span>     <span class="number">0</span> <span class="number">2.640708</span> <span class="number">0.09574035</span> <span class="number">3.015727</span> <span class="number">0.07431359</span></div><div class="line"><span class="number">2</span>    <span class="number">10</span> <span class="number">2.276907</span> <span class="number">0.07223806</span> <span class="number">1.977225</span> <span class="number">0.12287066</span></div><div class="line"><span class="number">3</span>    <span class="number">20</span> <span class="number">1.956931</span> <span class="number">0.07676898</span> <span class="number">1.400463</span> <span class="number">0.11313513</span></div></pre></td></tr></table></figure>
<h3 id="B-整理数据-2"><a href="#B-整理数据-2" class="headerlink" title="B.整理数据"></a>B.整理数据</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mdfig30_long &lt;- rbind( data.frame( type=<span class="string">"programmed"</span>, delay=mdfig30a$delay, lesion=<span class="string">"sham"</span>, sqrtpresses = mdfig30a$sham, ysem = mdfig30a$SEMsham, xsem = <span class="number">0</span> ),</div><div class="line">data.frame( type=<span class="string">"programmed"</span>, delay=mdfig30a$delay, lesion=<span class="string">"AcbC"</span>, sqrtpresses = mdfig30a$AcbC, ysem = mdfig30a$SEMAcbC, xsem = <span class="number">0</span> ),</div><div class="line">data.frame( type=<span class="string">"experienced"</span>, delay=mdfig30b$shamdelay, lesion=<span class="string">"sham"</span>, sqrtpresses = mdfig30b$shamresponses, ysem = mdfig30b$SEMshamresponses, xsem = mdfig30b$SEMshamdelay ),</div><div class="line">data.frame( type=<span class="string">"experienced"</span>, delay=mdfig30b$AcbCdelay, lesion=<span class="string">"AcbC"</span>, sqrtpresses = mdfig30b$AcbCresponses, ysem = mdfig30b$SEMAcbCresponses, xsem = mdfig30b$SEMAcbCdelay ) )</div><div class="line"></div><div class="line">mdfig30_annotations &lt;- data.frame(</div><div class="line">x = c(<span class="number">0</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">10</span>),</div><div class="line">y = c(<span class="number">3.2</span>,<span class="number">1.7</span>,<span class="number">1.2</span>,<span class="number">1.4</span>),</div><div class="line">type = c(<span class="string">"programmed"</span>, <span class="string">"programmed"</span>, <span class="string">"programmed"</span>, <span class="string">"experienced"</span>),</div><div class="line">label = c(<span class="string">"*"</span>, <span class="string">"*"</span>, <span class="string">"***"</span>, <span class="string">"###"</span>),</div><div class="line">lesion = c(<span class="string">"sham"</span>, <span class="string">"sham"</span>, <span class="string">"sham"</span>, <span class="string">"sham"</span>) )</div></pre></td></tr></table></figure>
<p>查看整整后的数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt; mdfig30_long</div><div class="line">          type     delay lesion sqrtpresses       ysem      xsem</div><div class="line"><span class="number">1</span>   programmed  <span class="number">0.000000</span>   sham    <span class="number">2.640708</span> <span class="number">0.09574035</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">2</span>   programmed <span class="number">10.000000</span>   sham    <span class="number">2.276907</span> <span class="number">0.07223806</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">3</span>   programmed <span class="number">20.000000</span>   sham    <span class="number">1.956931</span> <span class="number">0.07676898</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">4</span>   programmed  <span class="number">0.000000</span>   AcbC    <span class="number">3.015727</span> <span class="number">0.07431359</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">5</span>   programmed <span class="number">10.000000</span>   AcbC    <span class="number">1.977225</span> <span class="number">0.12287066</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">6</span>   programmed <span class="number">20.000000</span>   AcbC    <span class="number">1.400463</span> <span class="number">0.11313513</span> <span class="number">0.0000000</span></div><div class="line"><span class="number">7</span>  experienced  <span class="number">2.127342</span>   sham    <span class="number">2.640708</span> <span class="number">0.09574035</span> <span class="number">0.3954407</span></div><div class="line"><span class="number">8</span>  experienced  <span class="number">9.483373</span>   sham    <span class="number">2.276907</span> <span class="number">0.07223806</span> <span class="number">0.4826215</span></div><div class="line"><span class="number">9</span>  experienced <span class="number">15.812267</span>   sham    <span class="number">1.956931</span> <span class="number">0.07676898</span> <span class="number">1.0514280</span></div><div class="line"><span class="number">10</span> experienced  <span class="number">2.307076</span>   AcbC    <span class="number">3.015727</span> <span class="number">0.07431359</span> <span class="number">0.3887686</span></div><div class="line"><span class="number">11</span> experienced <span class="number">11.680260</span>   AcbC    <span class="number">1.977225</span> <span class="number">0.12287066</span> <span class="number">0.5989249</span></div><div class="line"><span class="number">12</span> experienced <span class="number">20.936766</span>   AcbC    <span class="number">1.400463</span> <span class="number">0.11313513</span> <span class="number">1.8152600</span></div><div class="line"></div><div class="line">&gt; mdfig30_annotations</div><div class="line">   x   y        type label lesion</div><div class="line"><span class="number">1</span>  <span class="number">0</span> <span class="number">3.2</span>  programmed     *   sham</div><div class="line"><span class="number">2</span> <span class="number">10</span> <span class="number">1.7</span>  programmed     *   sham</div><div class="line"><span class="number">3</span> <span class="number">20</span> <span class="number">1.2</span>  programmed   ***   sham</div><div class="line"><span class="number">4</span> <span class="number">10</span> <span class="number">1.4</span> experienced   <span class="comment">###   sham</span></div></pre></td></tr></table></figure>
<h3 id="C-绘图-3"><a href="#C-绘图-3" class="headerlink" title="C.绘图"></a>C.绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">f6 &lt;- ggplot(data = mdfig30_long, aes(x = delay, y = sqrtpresses, fill = lesion) ) +</div><div class="line">facet_grid(. ~ type) +</div><div class="line">geom_line() +</div><div class="line">geom_errorbar(aes(ymin=sqrtpresses - ysem, ymax=sqrtpresses + ysem), width=<span class="number">0.8</span>) +</div><div class="line">geom_errorbarh(aes(xmin=delay - xsem, xmax=delay + xsem), height=<span class="number">0.05</span>) +</div><div class="line">geom_point(shape=<span class="number">21</span>, colour=<span class="string">"black"</span>, size=<span class="number">5</span>) +</div><div class="line">scale_fill_manual(values=c(<span class="string">"white"</span>,<span class="string">"black"</span>)) +</div><div class="line">scale_x_continuous(<span class="string">"Delay from response to reinforcer (s)"</span>) +</div><div class="line">scale_y_continuous(expression(sqrt(<span class="string">"active lever presses per minute in session 10"</span>)), expand=c(<span class="number">0</span>,<span class="number">0</span>), limits = c(<span class="number">0</span>, <span class="number">3.5</span>), breaks=<span class="number">0</span>:<span class="number">3</span>) +</div><div class="line">geom_text(data = mdfig30_annotations, aes(x = x, y = y, label = label) ) +</div><div class="line">theme_bw() +</div><div class="line">theme(plot.margin=unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1.5</span>,<span class="number">2</span>), <span class="string">"lines"</span>),</div><div class="line">axis.title.x = element_text(size=<span class="number">12</span>, vjust=-<span class="number">1</span>),</div><div class="line">axis.title.y = element_text(size=<span class="number">12</span>, angle=<span class="number">90</span>, vjust=<span class="number">0</span>), <span class="comment"># likewise</span></div><div class="line">legend.title = element_blank(),</div><div class="line">legend.key.size = unit(<span class="number">1.5</span>, <span class="string">"lines"</span>),</div><div class="line">legend.key = element_blank()</div><div class="line">)</div><div class="line">print(f6)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180820/b8dBaFd5lh.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://egret.psychol.cam.ac.uk/statistics/R/graphs2.html" target="_blank" rel="external">http://egret.psychol.cam.ac.uk/statistics/R/graphs2.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/24/ggplot2/ggplot2_图片保存/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/24/ggplot2/ggplot2_图片保存/" itemprop="url">ggplot2-图片保存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-24T12:00:00+08:00">
                2017-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  0
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/23/ggplot2/ggplot2(13) - 其它图形/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/23/ggplot2/ggplot2(13) - 其它图形/" itemprop="url">ggplot2(13)-其它图形</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-23T12:00:00+08:00">
                2017-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,299
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="绘制矩阵图"><a href="#绘制矩阵图" class="headerlink" title="绘制矩阵图"></a>绘制矩阵图</h2><h3 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(mtcars)</div><div class="line">                   mpg cyl disp  hp drat    wt  qsec vs am gear carb</div><div class="line">Mazda RX4         <span class="number">21.0</span>   <span class="number">6</span>  <span class="number">160</span> <span class="number">110</span> <span class="number">3.90</span> <span class="number">2.620</span> <span class="number">16.46</span>  <span class="number">0</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">4</span></div><div class="line">Mazda RX4 Wag     <span class="number">21.0</span>   <span class="number">6</span>  <span class="number">160</span> <span class="number">110</span> <span class="number">3.90</span> <span class="number">2.875</span> <span class="number">17.02</span>  <span class="number">0</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">4</span></div><div class="line">Datsun <span class="number">710</span>        <span class="number">22.8</span>   <span class="number">4</span>  <span class="number">108</span>  <span class="number">93</span> <span class="number">3.85</span> <span class="number">2.320</span> <span class="number">18.61</span>  <span class="number">1</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">1</span></div><div class="line">Hornet <span class="number">4</span> Drive    <span class="number">21.4</span>   <span class="number">6</span>  <span class="number">258</span> <span class="number">110</span> <span class="number">3.08</span> <span class="number">3.215</span> <span class="number">19.44</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">1</span></div><div class="line">Hornet Sportabout <span class="number">18.7</span>   <span class="number">8</span>  <span class="number">360</span> <span class="number">175</span> <span class="number">3.15</span> <span class="number">3.440</span> <span class="number">17.02</span>  <span class="number">0</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">2</span></div><div class="line">Valiant           <span class="number">18.1</span>   <span class="number">6</span>  <span class="number">225</span> <span class="number">105</span> <span class="number">2.76</span> <span class="number">3.460</span> <span class="number">20.22</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="计算相关矩阵"><a href="#计算相关矩阵" class="headerlink" title="计算相关矩阵"></a>计算相关矩阵</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mcor &lt;- cor(mtcars)</div><div class="line">round(mcor,digits=2)</div></pre></td></tr></table></figure>
<h3 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(corrplot)</div><div class="line">corrplot(mcor)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/DkDeahhajH.png?imageslim" alt="mark"></p>
<p>绘制相关矩阵，例如颜色广场和黑色文本标签，并且上边的文本标签呈现45度，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">corrplot(mcor,method=<span class="string">"shade"</span>,shade.col=<span class="literal">NA</span>,tl.col = <span class="string">"black"</span>,tl.srt=<span class="number">45</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/cDKIbh2bci.png?imageslim" alt="mark"></p>
<h3 id="更改颜色"><a href="#更改颜色" class="headerlink" title="更改颜色"></a>更改颜色</h3><p>现在更改一下相关矩阵的颜色，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">col &lt;- colorRampPalette(c(<span class="string">"#BB4444"</span>,<span class="string">"#EE9988"</span>,<span class="string">"#FFFFFF"</span>,<span class="string">"#77AADD"</span>,<span class="string">"#4477AA"</span>))</div><div class="line">corrplot(mcor,method=<span class="string">"shade"</span>,shade.col=<span class="literal">NA</span>,tl.col = <span class="string">"black"</span>,tl.srt=<span class="number">45</span>,</div><div class="line">         col=col(<span class="number">200</span>),addCoef.col = <span class="string">"black"</span>,order=<span class="string">"AOE"</span>,cl.pos = <span class="string">"r"</span>)</div><div class="line"><span class="comment"># method="shade"表示是否添加阴影，如果不写，则矩阵的小方格中是圆形</span></div><div class="line"><span class="comment"># order="AOE"表示前两个特征向量的角排序，选项有AOE,FPC,hclust，矩阵排序的依据，分别为特征值、第一主成分，层次聚类</span></div><div class="line"><span class="comment"># cl.pos=r表示，右侧是颜色的标度示意图</span></div><div class="line"><span class="comment"># addCoef.col = "black"表示添加上相关系数，并且为黑色</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/Jia6k0F6DL.png?imageslim" alt="mark"></p>
<h2 id="绘制函数曲线"><a href="#绘制函数曲线" class="headerlink" title="绘制函数曲线"></a>绘制函数曲线</h2><h3 id="绘制正态分布曲线"><a href="#绘制正态分布曲线" class="headerlink" title="绘制正态分布曲线"></a>绘制正态分布曲线</h3><p>使用<code>stat_function()</code>函数，为了得到合适的x的范围，必须给ggplot()函数传递一个“哑”数据库，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(data.frame(x=c(-<span class="number">3</span>,<span class="number">3</span>)),aes(x=x))</div><div class="line">p + stat_function(fun=dnorm)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/I2kdhJhfHg.png?imageslim" alt="mark"></p>
<h3 id="绘制t分布曲线"><a href="#绘制t分布曲线" class="headerlink" title="绘制t分布曲线"></a>绘制t分布曲线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(data.frame(x=c(-<span class="number">3</span>,<span class="number">3</span>)),aes(x=x))</div><div class="line">p + stat_function(fun=dt, args=list(df=<span class="number">2</span>))</div></pre></td></tr></table></figure>
<p>额外的参数使用list()进行传递，传递给args。</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/cffb2bEKH9.png?imageslim" alt="mark"></p>
<h3 id="绘制自定义的函数"><a href="#绘制自定义的函数" class="headerlink" title="绘制自定义的函数"></a>绘制自定义的函数</h3><p>第一个参数必须是x轴的值，并且必须返回y值，在这个案例中，我们绘制一个S型函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">myfun &lt;- <span class="keyword">function</span>(xvar)&#123;</div><div class="line">  <span class="number">1</span>/(<span class="number">1</span>+exp(-xvar+<span class="number">10</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">ggplot(data.frame(x=c(<span class="number">0</span>,<span class="number">20</span>)),aes(x=x)) + stat_function(fun=myfun)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/GKl2BiJaiH.png?imageslim" alt="mark"></p>
<p>计算函数值是使用给出的x范围内的101个点，如果函数跳跃很大，画出来的图可能有一些支离破碎的线段，为了让曲线更加光滑，可以给<code>stat_function()</code>传递一个更大的n，例如<code>stat_function(fun=myfun,n=200)</code>。</p>
<h2 id="在函数曲线下添加阴影"><a href="#在函数曲线下添加阴影" class="headerlink" title="在函数曲线下添加阴影"></a>在函数曲线下添加阴影</h2><p>根据你的曲线函数定义了一个新的函数，把x范围外对应的值替换为NA，操作如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义一个函数，在0&lt;x&lt;2时返回dnorm(x)，其它的时候返回NA</span></div><div class="line">dnorm_limit &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  y &lt;- dnorm(x)</div><div class="line">  y[x &lt; <span class="number">0</span> | x&gt;<span class="number">2</span>] &lt;- <span class="literal">NA</span></div><div class="line">  <span class="keyword">return</span>(y)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#ggplot()使用“哑”数据</span></div><div class="line">p &lt;- ggplot(data.frame(x=c(-<span class="number">3</span>,<span class="number">3</span>)),aes(x=x))</div><div class="line"></div><div class="line">p+stat_function(fun=dnorm_limit,geom=<span class="string">"area"</span>,fill=<span class="string">"blue"</span>,alpha=<span class="number">0.2</span>)+</div><div class="line">  stat_function(fun=dnorm)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9mC4kjG5If.png?imageslim" alt="mark"></p>
<p>需要注意的是，给这个函数传入的是一个向量，而不是一个单独的值，如果这个函数每次只操作一个元素，那么使用一个if/else语句来根据x值确定返回值是更合理，但是那样做在这里却行不通，因为x是一个含有许多值的向量。</p>
<p>R中有第一类函数，我们可以写一个函数来返回一个闭包，也就是说， 我们可以编写一个能够编写函数的函数，这个函数允许你传递一个函数、一个最小值，一个最大值，定义域外对应的值域返回NA，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">limitRange &lt;- <span class="keyword">function</span>(fun, min, max)&#123;</div><div class="line">  <span class="keyword">function</span>(x)&#123;</div><div class="line">    y &lt;- fun()</div><div class="line">    y[x &lt; min | x &gt; max] &lt;- <span class="literal">NA</span></div><div class="line">    <span class="keyword">return</span>(y)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们可以调用这个函数来生成另外一个函数，这和之前使用的<code>dnorm_list()</code>函数的效果是一样，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 返回一个函数</span></div><div class="line">dlimit &lt;- limitRange(dnorm,<span class="number">0</span>,<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># 对0-2之间的数字返回相应的计算结果</span></div><div class="line">dlimit(-<span class="number">2</span>:<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dlimit(-<span class="number">2</span>:<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>]         <span class="literal">NA</span>         <span class="literal">NA</span> <span class="number">0.39894228</span> <span class="number">0.24197072</span> <span class="number">0.05399097</span>         <span class="literal">NA</span>         <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>现在使用<code>limitRange()</code>来生成函数，并传递给<code>stat_function()</code>，</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + stat_function(fun=dnorm)+</div><div class="line">  stat_function(fun=limitRange(dnorm,<span class="number">0</span>,<span class="number">2</span>),</div><div class="line">                geom=<span class="string">"area"</span>,fill=<span class="string">"blue"</span>,alpha=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/229I5G5518.png?imageslim" alt="mark"></p>
<p><code>limitRange()</code>函数可以用来生成任何函数的“区间限制式”函数，不局限于<code>dnorm()</code>。从上图中，我们哦可以知道，阴影区域并没有和我们给出的边界值范围完全齐，这是因为ggplot2在固定区间上计算函数值时做了个数值近似，并且这些区间没有完全落在指定的范围上，但我们可以通过设置<code>stat_function(n=200)</code>以增加插点数量的方式来提升近似的效果。</p>
<h2 id="绘制网络图"><a href="#绘制网络图" class="headerlink" title="绘制网络图"></a>绘制网络图</h2><p>网络图要使用<code>igrpha</code>包，如下所示:</p>
<p>绘制一个有向图的边：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(igraph)</div><div class="line">gd &lt;- graph(c(<span class="number">1</span>,<span class="number">2</span>, <span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>))</div><div class="line">plot(gd)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/j9F233AG3J.png?imageslim" alt="mark"></p>
<p>绘制一个无向图，没有标签，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gu &lt;- graph(c(<span class="number">1</span>,<span class="number">2</span>, <span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>),directed=<span class="literal">FALSE</span>)</div><div class="line"><span class="comment"># do not draw label</span></div><div class="line">plot(gu, vertex.label=<span class="literal">NA</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/ihJ5AgCJDJ.png?imageslim" alt="mark"></p>
<p>在网络图中，节点的位置并不是由所给数据确定的，它们是随机放置的，如果要让得到的图更可读，可以在绘图之前设置随机数种子，比如，可以浓度不同的随机数种子，直到得到一个比较满意的结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">100</span>)</div><div class="line">plot(gu)</div></pre></td></tr></table></figure>
<p>我们还可以采用Fruchterman-Reingold布局算法，该算法的主要思想是所有节点之间都有电磁斥力，但是连接节点的边像弹簧一样，会把相应的节点拉在一起。</p>
<p>也哦可以从数据框中直接生图，使用数据框的前两列，并且每一列确定两个节点相连，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">head(madmen2)</div><div class="line"><span class="comment"># Name1        Name2</span></div><div class="line"><span class="comment"># 1          Abe Drexler  Peggy Olson</span></div><div class="line"><span class="comment"># 2              Allison   Don Draper</span></div><div class="line"><span class="comment"># 3          Arthur Case Betty Draper</span></div><div class="line"><span class="comment"># 4 Bellhop in Baltimore   Sal Romano</span></div><div class="line"><span class="comment"># 5     Bethany Van Nuys   Don Draper</span></div><div class="line"><span class="comment"># 6         Betty Draper   Don Draper</span></div><div class="line">g &lt;- graph.data.frame(madmen2,directed = <span class="literal">TRUE</span>)<span class="comment">#</span></div><div class="line"><span class="comment">#从数据集中生成图像</span></div><div class="line">par(mar=c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</div><div class="line"><span class="comment">#移除多余的空白边</span></div><div class="line">plot(g,layout=layout.fruchterman.reingold,</div><div class="line">     vertex.size=<span class="number">8</span>,</div><div class="line">     edge.arrow.size=<span class="number">0.5</span>,</div><div class="line">     vertex.label=<span class="literal">NA</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9j01B5Hm4D.png?imageslim" alt="mark"></p>
<p>也可以从数据框生成无向图，madmen数据集中一行就可以表示一条边，因为对于无向图来说，方向是没有意义的，现在我们使用圆圈布局，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">head(madmen)</div><div class="line"><span class="comment"># Name1            Name2</span></div><div class="line"><span class="comment"># 1 Betty Draper    Henry Francis</span></div><div class="line"><span class="comment"># 2 Betty Draper       Random guy</span></div><div class="line"><span class="comment"># 3   Don Draper          Allison</span></div><div class="line"><span class="comment"># 4   Don Draper Bethany Van Nuys</span></div><div class="line"><span class="comment"># 5   Don Draper     Betty Draper</span></div><div class="line"><span class="comment"># 6   Don Draper   Bobbie Barrett</span></div><div class="line">g &lt;- graph.data.frame(madmen,directed = <span class="literal">TRUE</span>)</div><div class="line">par(mar=c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</div><div class="line">plot(g, layout=layout.circle,vertex.size=<span class="number">8</span>,vertex.label=<span class="literal">NA</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/A8icmIeLga.png?imageslim" alt="mark"></p>
<p>igraph的一个替代选择是<code>Rgraphviz</code>，该包是<code>Graphviz</code>的前端，它的优点是能更方便地处理标签，而且也更容易控布局，由Bioconductor系统库维护，常用于绘制KEGG图。</p>
<h2 id="在网络图中使用文本标签"><a href="#在网络图中使用文本标签" class="headerlink" title="在网络图中使用文本标签"></a>在网络图中使用文本标签</h2><p>边和节点可能都有名字，但默认时这些名字可能没有被当作标签，为了设置标签，可以给<code>vertex.label</code>参数传递一个命名向量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(igraph)</div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line"></div><div class="line">m &lt;- madmen[<span class="number">1</span>:nrow(madmen) %% <span class="number">2</span>==<span class="number">1</span>,]</div><div class="line"><span class="comment"># copy madem and delete ever number row</span></div><div class="line"></div><div class="line">g&lt;- graph.data.frame(m,directed = <span class="literal">FALSE</span>)</div><div class="line"></div><div class="line">V(g)$name</div><div class="line"><span class="comment"># output name of nodes</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/G0eFdmjfje.png?imageslim" alt="mark"></p>
<p>绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">plot(g,layout=layout.fruchterman.reingold,</div><div class="line">     vertex.size = <span class="number">4</span>, <span class="comment"># shrink node</span></div><div class="line">     vertex.label = V(g)$name,</div><div class="line">     vertex.label.cex=<span class="number">0.8</span>,</div><div class="line">     vertex.label.dist=<span class="number">0.4</span>,<span class="comment"># separate lable and nodes</span></div><div class="line">     vertex.label.color=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/Aj9AHgGD6L.png?imageslim" alt="mark"></p>
<p>另一种能得到相同效果的方法是修改绘图对象，这样就不用给<code>plot()</code>函数传递对数了，此时，可以使用<code>V()$xxx &lt;-</code>来代替<code>vertex.xxx</code>参数传递值，例如下面的代码可以得到和前面一样的输出：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">V(g)$size &lt;- <span class="number">4</span></div><div class="line">V(g)$label &lt;- V(g)$name</div><div class="line">V(g)$label.cex &lt;- <span class="number">0.8</span></div><div class="line">V(g)$label.dist &lt;- <span class="number">0.4</span></div><div class="line">V(g)$label.color &lt;- <span class="string">"black"</span></div><div class="line"></div><div class="line">g$layout &lt;- layout.fruchterman.reingold</div><div class="line">plot(g)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/iik4A0LaIC.png?imageslim" alt="mark"></p>
<h3 id="设置边的属性"><a href="#设置边的属性" class="headerlink" title="设置边的属性"></a>设置边的属性</h3><p>使用<code>E()</code>函数或者给<code>edge.xxx</code>参数传递相应值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># check edge</span></div><div class="line">E(g)</div><div class="line"></div><div class="line"><span class="comment"># Name edge "M"</span></div><div class="line">E(g)[c(<span class="number">2</span>,<span class="number">11</span>,<span class="number">19</span>)]$label &lt;- <span class="string">"M"</span></div><div class="line"></div><div class="line"><span class="comment"># Set all color of edges is grey, others are red</span></div><div class="line">E(g)$color &lt;- <span class="string">"grey70"</span></div><div class="line">E(g)[c(<span class="number">2</span>,<span class="number">11</span>,<span class="number">19</span>)]$color &lt;- <span class="string">"red"</span></div><div class="line">plot(g)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9DhdfDCG6k.png?imageslim" alt="mark"></p>
<h2 id="热图"><a href="#热图" class="headerlink" title="热图"></a>热图</h2><p>使用<code>geom_tile()</code>或者<code>geom_raster()</code>，并将一个连续变量映射到<code>fill</code>上，使用<code>Presidents</code>数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; presidents</div><div class="line">     Qtr1 Qtr2 Qtr3 Qtr4</div><div class="line"><span class="number">1945</span>   <span class="literal">NA</span>   <span class="number">87</span>   <span class="number">82</span>   <span class="number">75</span></div><div class="line"><span class="number">1946</span>   <span class="number">63</span>   <span class="number">50</span>   <span class="number">43</span>   <span class="number">32</span></div><div class="line"><span class="number">1947</span>   <span class="number">35</span>   <span class="number">60</span>   <span class="number">54</span>   <span class="number">55</span></div><div class="line"><span class="number">1948</span>   <span class="number">36</span>   <span class="number">39</span>   <span class="literal">NA</span>   <span class="literal">NA</span></div><div class="line"><span class="number">1949</span>   <span class="number">69</span>   <span class="number">57</span>   <span class="number">57</span>   <span class="number">51</span></div><div class="line"><span class="number">1950</span>   <span class="number">45</span>   <span class="number">37</span>   <span class="number">46</span>   <span class="number">39</span></div><div class="line"><span class="number">1951</span>   <span class="number">36</span>   <span class="number">24</span>   <span class="number">32</span>   <span class="number">23</span></div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>这是一个时间序列格式，首选将它转换为<code>ggplot()</code>可用的数据框格式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">pres_rating &lt;- data.frame(</div><div class="line">  rating = as.numeric(presidents),</div><div class="line">  year = as.numeric(floor(time(presidents))),</div><div class="line">  quarter =as.numeric(cycle(presidents))</div><div class="line">)</div><div class="line">head(pres_rating)</div><div class="line"><span class="comment"># rating year quarter</span></div><div class="line"><span class="comment"># 1     NA 1945       1</span></div><div class="line"><span class="comment"># 2     87 1945       2</span></div><div class="line"><span class="comment"># 3     82 1945       3</span></div><div class="line"><span class="comment"># 4     75 1945       4</span></div><div class="line"><span class="comment"># 5     63 1946       1</span></div><div class="line"><span class="comment"># 6     50 1946       2</span></div></pre></td></tr></table></figure>
<p>现在使用<code>geom_tile()</code>或<code>geom_raster()</code>来绘制，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(pres_rating,aes(x=year,y=quarter,fill=rating))</div><div class="line">p+geom_tile()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/BhF1m0l5lB.png?imageslim" alt="mark"></p>
<p>或者使用<code>geom_raster()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p+geom_raster()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/42Jglkkkm6.png?imageslim" alt="mark"></p>
<p>上图中的灰色区域是缺失值。</p>
<p>为了更有效地表达信息，可以自定义热图的外观，现在我们倒转y轴，这样顺序就是从上到下了，并且在x轴上每隔4年添加一个坐标刻度值来表示一个总统任期，此外，再更换颜色标度，使用<code>scale_fill_gradient2()</code>调色板，该调色板可以设置一个中点和两个端点的色彩值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p + geom_tile() +</div><div class="line">  scale_x_continuous(breaks=seq(<span class="number">1940</span>,<span class="number">1976</span>,by=<span class="number">4</span>)) + </div><div class="line">  scale_y_reverse() +</div><div class="line">  scale_fill_gradient2(midpoint=<span class="number">50</span>, mid=<span class="string">"grey70"</span>, limits=c(<span class="number">0</span>,<span class="number">100</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/HKH35IC80k.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/22/ggplot2/ggplot2(12) - 配色/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/22/ggplot2/ggplot2(12) - 配色/" itemprop="url">ggplot2(12)-配色</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-22T12:00:00+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  996
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="设置对象颜色"><a href="#设置对象颜色" class="headerlink" title="设置对象颜色"></a>设置对象颜色</h2><h3 id="将点设为红色"><a href="#将点设为红色" class="headerlink" title="将点设为红色"></a>将点设为红色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">ggplot(mtcars,aes(x=wt,y=mpg)) + geom_point(colour=<span class="string">"red"</span>) <span class="comment"># 将点改为红色</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/8mmj1LlJ1f.png?imageslim" alt="mark"></p>
<h3 id="条形图的填充与轮廓色"><a href="#条形图的填充与轮廓色" class="headerlink" title="条形图的填充与轮廓色"></a>条形图的填充与轮廓色</h3><p>用红色填充(fill=“red”)，轮廓为黑色(colour=“black”)’</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line">ggplot(birthwt,aes(x=bwt)) + geom_histogram(fill=<span class="string">"red"</span>,colour=<span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/6k9i342Dl5.png?imageslim" alt="mark"></p>
<h2 id="将变量映射到颜色上"><a href="#将变量映射到颜色上" class="headerlink" title="将变量映射到颜色上"></a>将变量映射到颜色上</h2><p>下面的代码是将Cultivar变量映射到图形属性fill上。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line"></div><div class="line"><span class="comment">## Warning: package 'gcookbook' was built under R version 3.4.4</span></div><div class="line"></div><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight,fill=Cultivar))+</div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,colour=<span class="string">"black"</span>,position=<span class="string">"dodge"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/k6FJkKFk08.png?imageslim" alt="mark"></p>
<p>下面的代码与上述代码相同：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp,aes(x=Date,y=Weight)) +</div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,aes(fill=Cultivar),colour=<span class="string">"black"</span>,position=<span class="string">"dodge"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/el6J7b1a3h.png?imageslim" alt="mark"></p>
<p>将cyl映射到颜色属性上，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars,aes(x=wt,y=mpg,colour=cyl)) + geom_point()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/lK743aLD5I.png?imageslim" alt="mark"></p>
<p>下面的代码等同于上述代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars,aes(x=wt,y=mpg)) + geom_point(aes(colour=cyl))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/ahKKJA7fg8.png?imageslim" alt="mark"></p>
<p>注：mtcars数据集中的cyl是连续型变量，因此图例中的颜色是渐变的，如果是因子型变量，则颜色是离散的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mtcars1 &lt;- mtcars</div><div class="line">mtcars1$cyl &lt;- factor(mtcars1$cyl) <span class="comment"># 将cyl变量转化为因子型变量 </span></div><div class="line">ggplot(mtcars1,aes(x=wt,y=mpg)) + geom_point(aes(colour=cyl))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/i8A22K5GAA.png?imageslim" alt="mark"></p>
<h2 id="对离散型变量使用不同的调节板"><a href="#对离散型变量使用不同的调节板" class="headerlink" title="对离散型变量使用不同的调节板"></a>对离散型变量使用不同的调节板</h2><h3 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup)) + geom_area()</div><div class="line">p</div><div class="line"><span class="comment"># 或等同于</span></div><div class="line"><span class="comment"># p + scale_fill_discrete()</span></div><div class="line"><span class="comment"># p + scale_fill_hue()</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/bHGj0aaBKb.png?imageslim" alt="mark"></p>
<h3 id="调节颜色深度"><a href="#调节颜色深度" class="headerlink" title="调节颜色深度"></a>调节颜色深度</h3><h3 id="基础绘图-1"><a href="#基础绘图-1" class="headerlink" title="基础绘图"></a>基础绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/IbheEeHah4.png?imageslim" alt="mark"></p>
<h3 id="加深颜色"><a href="#加深颜色" class="headerlink" title="加深颜色"></a>加深颜色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h + scale_colour_hue(l=<span class="number">45</span>)</div><div class="line"><span class="comment"># l表示亮度，越高颜色越浅</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9AghfDDddl.png?imageslim" alt="mark"></p>
<h3 id="调色板"><a href="#调色板" class="headerlink" title="调色板"></a>调色板</h3><p>可以用RColorBrewer来进行颜色设置，如下所示：</p>
<h4 id="橘黄色颜色"><a href="#橘黄色颜色" class="headerlink" title="橘黄色颜色"></a>橘黄色颜色</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_brewer(palette=<span class="string">"Oranges"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/13j80lLe1j.png?imageslim" alt="mark"></p>
<h4 id="灰色颜色"><a href="#灰色颜色" class="headerlink" title="灰色颜色"></a>灰色颜色</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_grey()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/cD9igcI6HJ.png?imageslim" alt="mark"></p>
<p>上述代码的绘图区域与图例不匹配，现在进行反转：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_grey(start=<span class="number">0.7</span>,end=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/FEK8g59ce4.png?imageslim" alt="mark"></p>
<h3 id="使用颜色名称调色"><a href="#使用颜色名称调色" class="headerlink" title="使用颜色名称调色"></a>使用颜色名称调色</h3><p>scale_colour_manual()可以对颜色进行精确地设置，可以用颜色的名称，也可以用RGB值，下面是用颜色的名称来表示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">h &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex)) + geom_point()</div><div class="line">h + scale_colour_manual(values=c(<span class="string">"red"</span>,<span class="string">"blue"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/jclil9L103.png?imageslim" alt="mark"></p>
<h3 id="用颜色的RGB值调色"><a href="#用颜色的RGB值调色" class="headerlink" title="用颜色的RGB值调色"></a>用颜色的RGB值调色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">h + scale_colour_manual(values=c(<span class="string">"#CC6666"</span>,<span class="string">"#7777DD"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/iHfm84Bc1e.png?imageslim" alt="mark"></p>
<h3 id="直接用变量来设置颜色"><a href="#直接用变量来设置颜色" class="headerlink" title="直接用变量来设置颜色"></a>直接用变量来设置颜色</h3><p>可以直接指定m的颜色是蓝色(blue),f的颜色是红色(red)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">h + scale_colour_manual(values=c(m=<span class="string">"blue"</span>,f=<span class="string">"red"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/aH6ljb2jm5.png?imageslim" alt="mark"></p>
<h3 id="使用色盲友好式的调色板"><a href="#使用色盲友好式的调色板" class="headerlink" title="使用色盲友好式的调色板"></a>使用色盲友好式的调色板</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(uspopage,aes(x=Year,y=Thousands,fill=AgeGroup)) + geom_area()</div><div class="line">cb_palette &lt;- c(<span class="string">"#999999"</span>,<span class="string">"#E69F00"</span>,<span class="string">"#56B4E9"</span>,<span class="string">"#009E73"</span>,<span class="string">"#E0E442"</span>,<span class="string">"#0072B2"</span>,<span class="string">"#D55E00"</span>,<span class="string">"#CC79A7"</span>)</div><div class="line">p + scale_fill_manual(values=cb_palette)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/5E7C3d9bJi.png?imageslim" alt="mark"></p>
<h2 id="对连续型变量使用自定义调色板"><a href="#对连续型变量使用自定义调色板" class="headerlink" title="对连续型变量使用自定义调色板"></a>对连续型变量使用自定义调色板</h2><h3 id="基础绘图-2"><a href="#基础绘图-2" class="headerlink" title="基础绘图"></a>基础绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=weightLb)) +</div><div class="line">  geom_point(size=<span class="number">3</span>)</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9eI3KE6kk6.png?imageslim" alt="mark"></p>
<h3 id="使用两种颜色的渐变"><a href="#使用两种颜色的渐变" class="headerlink" title="使用两种颜色的渐变"></a>使用两种颜色的渐变</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_colour_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/BJgHa659Gg.png?imageslim" alt="mark"></p>
<h3 id="渐变色中用白色划分"><a href="#渐变色中用白色划分" class="headerlink" title="渐变色中用白色划分"></a>渐变色中用白色划分</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(scales)</div><div class="line"><span class="comment">## Warning: package 'scales' was built under R version 3.4.1</span></div><div class="line">p + scale_colour_gradient2(low=muted(<span class="string">"red"</span>),mid=<span class="string">"white"</span>,high=muted(<span class="string">"blue"</span>),midpoint=<span class="number">110</span>)</div><div class="line"><span class="comment"># muted()表示降低标准颜色</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/8DIj9IK0CL.png?imageslim" alt="mark"></p>
<h3 id="n个颜色的渐变色"><a href="#n个颜色的渐变色" class="headerlink" title="n个颜色的渐变色"></a>n个颜色的渐变色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_colour_gradientn(colours=c(<span class="string">"darkred"</span>,<span class="string">"orange"</span>,<span class="string">"yellow"</span>,<span class="string">"white"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/46g06fl1B9.png?imageslim" alt="mark"></p>
<h2 id="根据数值设定阴影颜色"><a href="#根据数值设定阴影颜色" class="headerlink" title="根据数值设定阴影颜色"></a>根据数值设定阴影颜色</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">cb &lt;- subset(climate,Source == <span class="string">"Berkeley"</span>) <span class="comment"># 提取climate数据集中的Source为Berkeley的数据，将这些数据复制到cb中</span></div><div class="line">cb$valence[cb$Anomaly10y &gt;= <span class="number">0</span>] &lt;- <span class="string">"pos"</span> <span class="comment"># 将Anomaly10y大于等于0的数据的valence改为pos</span></div><div class="line">cb$valence[cb$Anomaly10y &lt; <span class="number">0</span>] &lt;- <span class="string">"neg"</span> <span class="comment"># 将Anomaly10y小于0的数据的valence改为neg</span></div><div class="line">head(cb)</div><div class="line"></div><div class="line"><span class="comment">##     Source Year Anomaly1y Anomaly5y Anomaly10y Unc10y valence</span></div><div class="line"><span class="comment">## 1 Berkeley 1800        NA        NA     -0.435  0.505     neg</span></div><div class="line"><span class="comment">## 2 Berkeley 1801        NA        NA     -0.453  0.493     neg</span></div><div class="line"><span class="comment">## 3 Berkeley 1802        NA        NA     -0.460  0.486     neg</span></div><div class="line"><span class="comment">## 4 Berkeley 1803        NA        NA     -0.493  0.489     neg</span></div><div class="line"><span class="comment">## 5 Berkeley 1804        NA        NA     -0.536  0.483     neg</span></div><div class="line"><span class="comment">## 6 Berkeley 1805        NA        NA     -0.541  0.475     neg</span></div><div class="line"></div><div class="line">ggplot(cb,aes(x=Year,y=Anomaly10y))+</div><div class="line">  geom_area(aes(fill=valence))+</div><div class="line">  geom_line()+</div><div class="line">  geom_hline(yintercept=<span class="number">0</span>) <span class="comment"># 加入一条水平线，水平线的截距为0</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/l1iF1glm82.png?imageslim" alt="mark"></p>
<p>从上图的绘图区域可以看出，在数据波动比较小的地方有重合，数据点并不在0上，可以用approx()将数据插值到1000个点左右，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">interp &lt;- approx(cb$Year,cb$Anomaly10y,n=<span class="number">1000</span>)</div><div class="line">cbi &lt;- data.frame(Year=interp$x,Anomaly10y=interp$y)</div><div class="line">cbi$valence[cbi$Anomaly10y &gt;=<span class="number">0</span>] &lt;- <span class="string">"pos"</span></div><div class="line">cbi$valence[cbi$Anomaly10y &lt; <span class="number">0</span>] &lt;- <span class="string">"neg"</span></div><div class="line"></div><div class="line">ggplot(cbi,aes(x=Year,y=Anomaly10y)) +</div><div class="line">  geom_area(aes(fill=valence),alpha=<span class="number">0.4</span>)+</div><div class="line">  geom_line()+</div><div class="line">  scale_fill_manual(values=c(<span class="string">"#CCEEFF"</span>,<span class="string">"#FFDDDD"</span>),guide=<span class="literal">FALSE</span>) +</div><div class="line">  scale_x_continuous(expand=c(<span class="number">0</span>,<span class="number">0</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/8I94k8J6A9.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/21/ggplot2/ggplot2(11) - 分面/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/ggplot2/ggplot2(11) - 分面/" itemprop="url">ggplot2(11)-分面</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T12:00:00+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  539
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="纵向分面"><a href="#纵向分面" class="headerlink" title="纵向分面"></a>纵向分面</h2><p>分面可以将数据分割绘制到子图中，分布的时候，可以横向分面，也可以纵向分面，如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">p &lt;- ggplot(mpg,aes(x=displ,y=hwy)) + geom_point()</div><div class="line">p + facet_grid(drv~.) <span class="comment"># 按照drv进行分面，纵向</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/2J9lgJILJE.png?imageslim" alt="mark"></p>
<h2 id="横向分面"><a href="#横向分面" class="headerlink" title="横向分面"></a>横向分面</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_grid(.~cyl) <span class="comment"># 根据cyl进行分面，横向</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/E20B9aCm4C.png?imageslim" alt="mark"></p>
<h2 id="矩阵分面"><a href="#矩阵分面" class="headerlink" title="矩阵分面"></a>矩阵分面</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_grid(drv~cyl) <span class="comment"># 根据drv与cyl进行分面</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/eLi8k7l43h.png?imageslim" alt="mark"></p>
<h2 id="从左到右分面"><a href="#从左到右分面" class="headerlink" title="从左到右分面"></a>从左到右分面</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_wrap(~class) <span class="comment"># 依次从左到右进行分面</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/74lh22GJjd.png?imageslim" alt="mark"></p>
<h2 id="指定分面行数"><a href="#指定分面行数" class="headerlink" title="指定分面行数"></a>指定分面行数</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_wrap(~class,nrow=<span class="number">2</span>) <span class="comment"># 分为两行</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/gBLgJ8882b.png?imageslim" alt="mark"></p>
<h2 id="指定分面列数"><a href="#指定分面列数" class="headerlink" title="指定分面列数"></a>指定分面列数</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_wrap(~class,ncol=<span class="number">4</span>) <span class="comment"># 分为四列</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/2leb2iD40g.png?imageslim" alt="mark"></p>
<h2 id="在不同的坐标轴下使用分面"><a href="#在不同的坐标轴下使用分面" class="headerlink" title="在不同的坐标轴下使用分面"></a>在不同的坐标轴下使用分面</h2><h3 id="使用y轴"><a href="#使用y轴" class="headerlink" title="使用y轴"></a>使用y轴</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg,aes(x=displ,y=hwy)) + geom_point()</div><div class="line">p + facet_grid(drv~cyl,scales=<span class="string">"free_y"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/C3C9Fm5Glf.png?imageslim" alt="mark"></p>
<h3 id="使用x轴标度"><a href="#使用x轴标度" class="headerlink" title="使用x轴标度"></a>使用x轴标度</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_grid(drv~cyl,scales=<span class="string">"free"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/i1HG8376kf.png?imageslim" alt="mark"></p>
<p>当坐标轴的标度为free时，则每行的子图都有自己的y值域，前面的例子中，未设置free，则所有的分面使用的相同的y值域。</p>
<h2 id="修改分面的文本标签"><a href="#修改分面的文本标签" class="headerlink" title="修改分面的文本标签"></a>修改分面的文本标签</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mpg2 &lt;- mpg</div><div class="line"></div><div class="line">levels(mpg2$drv)[levels(mpg2$drv)==<span class="string">"4"</span>] &lt;- <span class="string">"4wd"</span></div><div class="line">levels(mpg2$drv)[levels(mpg2$drv)==<span class="string">"f"</span>] &lt;- <span class="string">"Front"</span></div><div class="line">levels(mpg2$drv)[levels(mpg2$drv)==<span class="string">"r"</span>] &lt;- <span class="string">"Rear"</span></div><div class="line"></div><div class="line">ggplot(mpg2,aes(x=displ,y=hwy)) + geom_point()+facet_grid(drv~.)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/kf8a0JDDL3.png?imageslim" alt="mark"></p>
<p>进行分面时，可以同时将分面变量的名称与值输出，用到的函数是labelle=label_both，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(mpg2,aes(x=displ,y=hwy)) + geom_point() + </div><div class="line">  facet_grid(drv~.,labeller = label_both)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/kAl4hE0JI4.png?imageslim" alt="mark"></p>
<p>用labeller = label_parsed可以读入字符串：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mpg3 &lt;- mpg</div><div class="line">levels(mpg3$drv)[levels(mpg3$drv)==<span class="string">"4"</span>] &lt;- <span class="string">"4^&#123;wd&#125;"</span></div><div class="line">levels(mpg3$drv)[levels(mpg3$drv)==<span class="string">"f"</span>] &lt;- <span class="string">"-Front %.%e^&#123;pi*i&#125;"</span></div><div class="line">levels(mpg3$drv)[levels(mpg3$drv)==<span class="string">"r"</span>] &lt;- <span class="string">"4^&#123;wd&#125;-Front"</span></div><div class="line"></div><div class="line">ggplot(mpg3,aes(x=displ,y=hwy)) + geom_point()+</div><div class="line">  facet_grid(drv ~.,labeller=label_parsed)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/D67habG965.png?imageslim" alt="mark"></p>
<h2 id="修改分面标签和标题的外观"><a href="#修改分面标签和标题的外观" class="headerlink" title="修改分面标签和标题的外观"></a>修改分面标签和标题的外观</h2><p>下面的代码对日期(.~Date)进行分面，将分面标签的字体加粗(face=“bold”)，字体为基本字体的1.5倍(rel(1.5))，将分面标签的背景改为浅蓝色(fill=“lightblue”)，边框改为黑色(colour=“black”)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line"></div><div class="line"><span class="comment">## Warning: package 'gcookbook' was built under R version 3.4.4</span></div><div class="line"></div><div class="line">ggplot(cabbage_exp,aes(x=Cultivar,y=Weight)) + geom_bar(stat=<span class="string">"identity"</span>) +</div><div class="line">  facet_grid(.~Date) + </div><div class="line">  theme(strip.text = element_text(face=<span class="string">"bold"</span>,size=rel(<span class="number">1.5</span>)),</div><div class="line">        strip.background = element_rect(fill=<span class="string">"lightblue"</span>,colour=<span class="string">"black"</span>,</div><div class="line">                                        size=<span class="number">1</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/keBK6gDlCL.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/20/ggplot2/ggplot2(10) - 图例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/20/ggplot2/ggplot2(10) - 图例/" itemprop="url">ggplot2(10)-图例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T12:00:00+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ggplot2/" itemprop="url" rel="index">
                    <span itemprop="name">ggplot2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,531
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础绘图"><a href="#基础绘图" class="headerlink" title="基础绘图"></a>基础绘图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/kfDhfh3m9I.png?imageslim" alt="mark"></p>
<h2 id="移除图例"><a href="#移除图例" class="headerlink" title="移除图例"></a>移除图例</h2><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><p>通过guides(fill=FALSE)可以移除图例</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + guides(fill=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/gFA04JHBLB.png?imageslim" alt="mark"></p>
<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>通过设计scale_fill_discrete(guide=FALSE)来移除图例</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_discrete(guide=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/c46iih37Kh.png?imageslim" alt="mark"></p>
<h3 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h3><p>通过主题来移除图例</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(legend.position=<span class="string">"none"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/ahgH1em2iJ.png?imageslim" alt="mark"></p>
<h2 id="修改图例的位置"><a href="#修改图例的位置" class="headerlink" title="修改图例的位置"></a>修改图例的位置</h2><p>图例的位置由theme(legend.position=…)决定，参数有top、left、right或bottom</p>
<h3 id="置顶"><a href="#置顶" class="headerlink" title="置顶"></a>置顶</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) +</div><div class="line">  geom_boxplot()+</div><div class="line">  scale_fill_brewer(palette=<span class="string">"Paste12"</span>)</div><div class="line"></div><div class="line"><span class="comment">## Warning in pal_name(palette, type): Unknown palette Paste12</span></div><div class="line"></div><div class="line">p + theme(legend.position=<span class="string">"top"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/0mm9HbbBBe.png?imageslim" alt="mark"></p>
<h3 id="图例的精确位置"><a href="#图例的精确位置" class="headerlink" title="图例的精确位置"></a>图例的精确位置</h3><p>图例的精确位置可以通过legend.justification来调节，下面的代码表示将图例的右下角(1,0)置于绘图区域的右下角(1,0) 注：图例的是个矩形，原点是(0,0)，右上角是(1,1)。绘图区域也是个矩形，原点是(0,0)，右上角是(1,1)。这两个坐标体系表示的只是相对位置，并不是实际位置。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(legend.position=c(<span class="number">1</span>,<span class="number">0</span>),legend.justification=c(<span class="number">1</span>,<span class="number">0</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/aKIj6DBBBE.png?imageslim" alt="mark"></p>
<p>下面的代码表示将图例的右上角(1,1)置于绘图区域的右上角(1,1)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + theme(legend.position=c(<span class="number">1</span>,<span class="number">1</span>),legend.justification=c(<span class="number">1</span>,<span class="number">1</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/GG0Lm5le2l.png?imageslim" alt="mark"></p>
<h2 id="对图例进行修改"><a href="#对图例进行修改" class="headerlink" title="对图例进行修改"></a>对图例进行修改</h2><h3 id="修改图例的边框"><a href="#修改图例的边框" class="headerlink" title="修改图例的边框"></a>修改图例的边框</h3><p>下面的代码表示，将图例放到绘图区域的(0.85,0.2)这个位置（图例的中心与这个点对齐），然后用白色填充图例(fill=“white”)，边框为黑色(colour=“black”)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + theme(legend.position=c(<span class="number">0.85</span>,<span class="number">0.2</span>)) + </div><div class="line">  theme(legend.background=element_rect(fill=<span class="string">"white"</span>,colour=<span class="string">"black"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/iLL52gdG58.png?imageslim" alt="mark"></p>
<h3 id="去除图例的边框"><a href="#去除图例的边框" class="headerlink" title="去除图例的边框"></a>去除图例的边框</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + theme(legend.position=c(<span class="number">0.85</span>,<span class="number">0.2</span>))+ <span class="comment"># 图例的位置</span></div><div class="line">  theme(legend.background=element_blank())+ <span class="comment"># 去掉图例的背景色</span></div><div class="line">  theme(legend.key=element_blank()) <span class="comment"># 去掉每个图例项目周围的边框</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/j4FB9IjCe8.png?imageslim" alt="mark"></p>
<h2 id="修改图例项目的顺序"><a href="#修改图例项目的顺序" class="headerlink" title="修改图例项目的顺序"></a>修改图例项目的顺序</h2><p>初始绘图，图例中的顺序是ctrl,trt1,trt2。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/7gA3AgB0Ib.png?imageslim" alt="mark"></p>
<h3 id="修改项目顺序"><a href="#修改项目顺序" class="headerlink" title="修改项目顺序"></a>修改项目顺序</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/7m6iHLj7Ka.png?imageslim" alt="mark"></p>
<p>修改的方式与修改x轴上的顺序一样:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + </div><div class="line">  scale_fill_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))+</div><div class="line">  scale_x_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/mkdHElhjjC.png?imageslim" alt="mark"></p>
<h2 id="更改颜色"><a href="#更改颜色" class="headerlink" title="更改颜色"></a>更改颜色</h2><p>可以对变量group进行颜色映射，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_grey(start=<span class="number">0.5</span>,end=<span class="number">1</span>,limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/dC2lGKig08.png?imageslim" alt="mark"></p>
<p>也可以调用scale_fill_brewer()来进行颜色映射：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RColorBrewer)</div><div class="line">p + scale_fill_brewer(palette=<span class="string">"Set1"</span>,limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/mJ9I606j1L.png?imageslim" alt="mark"></p>
<h2 id="反转图例项目的顺序"><a href="#反转图例项目的顺序" class="headerlink" title="反转图例项目的顺序"></a>反转图例项目的顺序</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group))+geom_boxplot()</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/EbHDHl7lF9.png?imageslim" alt="mark"></p>
<h3 id="反转图例"><a href="#反转图例" class="headerlink" title="反转图例"></a>反转图例</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + guides(fill=guide_legend(reverse=<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/AH7mcj7akc.png?imageslim" alt="mark"></p>
<h3 id="反转图例的补充方法"><a href="#反转图例的补充方法" class="headerlink" title="反转图例的补充方法"></a>反转图例的补充方法</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_hue(guide=guide_legend(reverse=<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/dhklf1lbFE.png?imageslim" alt="mark"></p>
<h2 id="修改图例标题"><a href="#修改图例标题" class="headerlink" title="修改图例标题"></a>修改图例标题</h2><h3 id="方法1-1"><a href="#方法1-1" class="headerlink" title="方法1"></a>方法1</h3><p>labs(fill=“图例标题”)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line">p + labs(fill=<span class="string">"Condition"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/GecCAijkd5.png?imageslim" alt="mark"></p>
<h3 id="方法2-1"><a href="#方法2-1" class="headerlink" title="方法2"></a>方法2</h3><p>用scale_fill_discrete(name=“Condition”)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_discrete(name=<span class="string">"Condition"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/g7lC4EDF37.png?imageslim" alt="mark"></p>
<h2 id="修改图例标题的外观"><a href="#修改图例标题的外观" class="headerlink" title="修改图例标题的外观"></a>修改图例标题的外观</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group))+geom_boxplot()</div><div class="line"></div><div class="line">p + theme(legend.title=element_text(face=<span class="string">"italic"</span>,family=<span class="string">"Times"</span>,colour=<span class="string">"red"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/aedJeA6Jm2.png?imageslim" alt="mark"></p>
<p>上述代码运行后有警告：Windows字体数据库里没有这样的字体系列。R语言不能直接调用windows的字体，需要一个函数进行转换,例如我要使用Verdana这个字体，需要用到函数windowsFont，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">windowsFonts(Ver1=windowsFont(<span class="string">"Verdana"</span>))</div><div class="line">p + theme(legend.title=element_text(face=<span class="string">"italic"</span>,family=<span class="string">"Ver1"</span>,colour=<span class="string">"red"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/HEiHj9IDj0.png?imageslim" alt="mark"></p>
<h2 id="移除图例标题"><a href="#移除图例标题" class="headerlink" title="移除图例标题"></a>移除图例标题</h2><p>原始图形</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight,fill=group))+geom_boxplot()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/2LJcm2F8GJ.png?imageslim" alt="mark"></p>
<p>现在移除图例上面的标题“group”，guides(fill=guide_legend(title=NULL)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(PlantGrowth,aes(x=group,y=weight,fill=group))+geom_boxplot()+</div><div class="line">  guides(fill=guide_legend(title=<span class="literal">NULL</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/fH8cDHCdij.png?imageslim" alt="mark"></p>
<h2 id="修改图例标签"><a href="#修改图例标签" class="headerlink" title="修改图例标签"></a>修改图例标签</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/Jcg9bKE0jK.png?imageslim" alt="mark"></p>
<p>上述图形中的图例标签进行了更改，由原来的Ctrl,trt1,trt2更改为了Control,Treatment1,Treatment2，但x轴上的类型数据标签还未更改，仍旧为Ctrl,trt1,trt2。现在对x轴的标签进行更改。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p + </div><div class="line">  scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>))+</div><div class="line">  scale_x_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/9lDa9LhkB8.png?imageslim" alt="mark"></p>
<h2 id="将数据类型映射到不同的灰度上："><a href="#将数据类型映射到不同的灰度上：" class="headerlink" title="将数据类型映射到不同的灰度上："></a>将数据类型映射到不同的灰度上：</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_grey(start=<span class="number">0.5</span>,end=<span class="number">1</span>,labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/F4eKi0DJDL.png?imageslim" alt="mark"></p>
<p>如果修改了图例的顺序，则标签也会与之匹配：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>),</div><div class="line">                        labels=c(<span class="string">"Treatment1"</span>,<span class="string">"Treatment2"</span>,<span class="string">"Control"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/iAKLEIafdh.png?imageslim" alt="mark"></p>
<h2 id="多个变量的图例"><a href="#多个变量的图例" class="headerlink" title="多个变量的图例"></a>多个变量的图例</h2><p>下面的例子中包含两个图例，即性别(sex)用颜色来表示，体重用点的大小来表示(weightLb)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line"></div><div class="line"><span class="comment">## Warning: package 'gcookbook' was built under R version 3.4.4</span></div><div class="line"></div><div class="line">hw &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+</div><div class="line">  geom_point(aes(size=weightLb))+</div><div class="line">  scale_size_continuous(range=c(<span class="number">1</span>,<span class="number">4</span>))</div><div class="line">hw</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/16GE0f91AE.png?imageslim" alt="mark"></p>
<p>添加图例的标题： 上面的例子中，有两个图例，因此可以对这两个图例分别设置标题：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hw + labs(colour=<span class="string">"Male/Female"</span>,size=<span class="string">"Weight\n(pounds)"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/aiB4kb2GD1.png?imageslim" alt="mark"></p>
<p>如果一个变量被分别映射到两个图形属性上，则会默认生成一个组合了两种情况的图例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hw1 &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex))+</div><div class="line">  geom_point()</div><div class="line">hw1</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/836IJ2Hfg5.png?imageslim" alt="mark"></p>
<p>修改上述绘图的标题，如果只修改一个，就会得到两个分离的图例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hw1 + labs(shape=<span class="string">"Male/Female"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/IHd6d2cBIA.png?imageslim" alt="mark"></p>
<p>对颜色进行修改，得到的图例相同：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hw1 + labs(colour=<span class="string">"Male/Female"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/mg3FG71g06.png?imageslim" alt="mark"></p>
<p>同时修改shape与colour的标题：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hw1 + labs(shape=<span class="string">"Male/Female"</span>,colour=<span class="string">"Male/Female"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/kG2Hi9aKEf.png?imageslim" alt="mark"></p>
<h2 id="有两个图形属性的标签"><a href="#有两个图形属性的标签" class="headerlink" title="有两个图形属性的标签"></a>有两个图形属性的标签</h2><p>原始图形</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex)) + </div><div class="line">  geom_point()</div><div class="line">p</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/FLAFFHI04k.png?imageslim" alt="mark"></p>
<p>现在对上述图形进行修改，修改其中一个标度的标签：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_shape_discrete(labels=c(<span class="string">"Female"</span>,<span class="string">"Male"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/d2m8kjCDhg.png?imageslim" alt="mark"></p>
<p>同时修改两个标度：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + scale_shape_discrete(labels=c(<span class="string">"Female"</span>,<span class="string">"Male"</span>))+</div><div class="line">  scale_colour_discrete(labels=c(<span class="string">"Female"</span>,<span class="string">"Male"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/LBEf8mgHF7.png?imageslim" alt="mark"></p>
<h2 id="修改图例标签外观"><a href="#修改图例标签外观" class="headerlink" title="修改图例标签外观"></a>修改图例标签外观</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line"></div><div class="line">p + theme(legend.text=element_text(face=<span class="string">"italic"</span>,family=<span class="string">"Ver1"</span>,colour=<span class="string">"red"</span>,size=<span class="number">14</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/hh5Hj9mA2h.png?imageslim" alt="mark"></p>
<p>通过guides来修改</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + guides(fill=guide_legend(label.theme=element_text(face=<span class="string">"italic"</span>,family=<span class="string">"Ver1"</span>,colour=<span class="string">"red"</span>,size=<span class="number">14</span>,angle=<span class="number">0.01</span>)))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/47hJJGC7h7.png?imageslim" alt="mark"></p>
<h2 id="使用多行文本的标签"><a href="#使用多行文本的标签" class="headerlink" title="使用多行文本的标签"></a>使用多行文本的标签</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth,aes(x=group,y=weight,fill=group)) + geom_boxplot()</div><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Type 1\ntreatment"</span>,<span class="string">"Type 2\ntreatment"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/6A5Jcgl85L.png?imageslim" alt="mark"></p>
<p>上面的图形的图例中文字间隔比较近，可以进行微调，其中，legend.text是图例中项目文字的调试，而legend.key.height则是项目符号的高度，调节效果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(grid)</div><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Type 1\ntreatment"</span>,<span class="string">"Type 2\ntreatment"</span>))+</div><div class="line">  theme(legend.text=element_text(lineheight=<span class="number">0.9</span>),</div><div class="line">        legend.key.height=unit(<span class="number">1</span>,<span class="string">"cm"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180901/DLGBh3177B.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>常肖楠, 邓一硕, 魏太云. R数据可视化手册[M]. 人民邮电出版社, 2014.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/18/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/20/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">212</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">104</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:0px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共839.2k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
