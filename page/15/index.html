<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/15/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/15/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/08/BioStatistics/生物统计-10相关分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/BioStatistics/生物统计-10相关分析/" itemprop="url">相关分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T12:02:00+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7,878
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  31
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="直线相关linear-correlation">直线相关（Linear correlation）</h2>
<h2 id="变量之间的关系">变量之间的关系</h2>
<p>变量之间的关系有两种，一种是变量间存在着完全确定的有关系，这类变量间的关系称为函数关系；另一类是变量间关系不存在完全的确定性，不能用精确的数学公式来表示，这些变量间都存在着十分密切的关系，但不能由一个或几个变量的值精确地求出求出另一个变量的值，这些变量间的关系称为相关关系，存在相关关系的变量是相关变量。</p>
<h3 id="直线相关的概念">直线相关的概念</h3>
<p>对于两变量关系的研究，有时并不需要由X估计Y，也就是说我们有时候并不需要考虑直线回归的问题，而是考虑两个变量之间是否有明确的直线相关关系，例如为了研究向量元素锰在胆固醇合成中的作用，探讨大刀肝脏中胆固醇含量和锰含量之间是否存在直线关系？这种关系表现为随着锰含量的增加，胆固醇的是增加还是减少呢？像这类判断两个数值变量之间有元直线相关关系，并回答相关的方向和相关程度如何时，可以采用相关分析。</p>
<h2 id="回归与相关的区别与联系">回归与相关的区别与联系</h2>
<h3 id="两者的区别">两者的区别</h3>
<p>回归和相关都是研究两个变量相互关系的分析方法。相关分析研究两个变量之间相关的方向和相关的密切程度。但是相关分析不能指出两变量相互关系的具体形式，也无法从一个变量的变化来推测另一个变量的变化关系。</p>
<p>回归方程则是通过一定的数学方程来反映变量之间相互关系的具体形式，以便从一个已知量来推测另一个未知量。为估算预测提供一个重要的方法。具体区别有：</p>
<ol style="list-style-type: decimal">
<li><p>相关分析中变量之间处于平等的地位；回归分析中，因变量处在被解释的地位，自变量用于预测因变量的变化；</p></li>
<li><p>相关分析中不必确定自变量和因变量，所涉及的变量可以都是随机变量；而回归分析则必须事先确定具有相关关系的变量中，哪个是因变量，哪个是因变量。一般来说，回归分析中因变量是随机变量，而把自变量作为研究时给定的非随机变量；</p></li>
<li><p>相关分析研究变量之间相关的方向和相关的程度，但相关分析不能根据一个变量的变化来推测另一个变量的变化情况；回归分析是研究变量之间相互关系的具体表现形式，根据变量之间的联系确定一个相关的数学表达式，从而可以从已知量来推测未知量。</p></li>
<li><p>对两个变量来说，相关分析中只能计算出一个相关系数；而回归分析中有时可以根据研究目的的不同建立两个不同的回归方程。</p></li>
</ol>
<h3 id="两者的联系">两者的联系</h3>
<p>相关分析与回归分析是广义相关分析的两个阶段,两者有着密切的联系 ：</p>
<ol style="list-style-type: decimal">
<li>相关分析是回归分析的基础和前提，回归分析则是相关分析的深入和继续。相关分析需要依靠回归分析来表现变量之间数量相关的具体形式，而回归分析则需要依靠相关分析来表现变量之间数量变化的相关程度。只有当变量之间存在高度相关时，进行回归分析寻求其相关的具体形式才有意义。如果在没有对变量之间是否相关以及相关方向和程度做出正确判断之前，就进行回归分析，很容易造成“虚假回归”。</li>
<li>由于相关分析只研究变量之间相关的方向和程度，不能推断变量之间相互关系的具体形式，也无法从一个变量的变化来推测另一个变量的变化情况，因此，在具体应用过程中，只有把相关分析和回归分析结合起来，才能达到研究和分析的目的。</li>
</ol>
<p>相关分析与回归分析都是研究变量相互关系的分析方法，相关分析是回归分析的基础，而回归分析则是认识变量之间相关程度的具体形式。</p>
<h2 id="直线相关的类别">直线相关的类别</h2>
<p>直线相关（linear correlation）又称简单相关（simple correlation），用于双变量正态分布（bivariate normal distribution）资料，直线在养的性质可由散点图直观的说明，看下图：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/K48HE5gGC4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第1张图和第2张图的散点呈椭圆形分布，若两变量X、Y同时增大或减小，变化趋势是同向的，称为正相关（positive correlation），反之，X、Y间呈反向变化，则是负相关（negative correlation），第5和第6张图中，散点基本上在一条直线上，若X、Y是同向变化，称为完全正相关（perfect positive correlation），反之，X、Y呈反向变化，称为完全负相关（perfect negative correlation），再看第第3、4、7、8这四张图，散点分布为圆形等一些形状，两变量之间没有直线相关关系，称为零相关（zero correlation）。正相关或负相关并不一定表示一个变量的改变是另一个变量变化的原因，有可能同受另一个因素的影响，因此，相关关系并不一定是因果关系，打个比方吧，某个地区每年七八月份溺水死亡的人数与雪糕的销量呈现正相关的关系，我们不能推断出来，是雪糕的销售与溺水死亡之间存在着因果关系，因为它们都受同一个因素的影响，就是天气，天气热，雪糕的销量自然高，下水游泳的人也多。</p>
<h2 id="pearson相关系数">Pearson相关系数</h2>
<p><strong>相关系数（coefficient of correlation）</strong>又称<strong>Pearson积差相关系数（coefficient of product-moment correlation）</strong>，以符号r表示样本相关系数，符号<span class="math inline">\(\rho​\)</span>表示其总体相关系数，它用来说明直线关系的两个变量间相关的密切程度与相关方向。</p>
<p>如果<span class="math inline">\((x_{1},y_{1}),\cdots,(x_{n},y_{n})\)</span>为相应于这两个变量x和y的n个观侧值对子，那么Pearson相关系数的总体和样本形式分别如下所示：</p>
<p>总体相关系数<span class="math inline">\(\rho\)</span>的计算公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/el118fDdkL.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>样本相关系数r的计算公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/c8EjkLii84.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>相关系数没有单位，其值为<span class="math inline">\(-1\leq r \leq 1\)</span>，r值为正，表示正相关，r值为负表示负相关，r的绝对值等于1为完全相关，r=0为零相关，在生物界，由于影响因素众多，因此很少完全相关，注意：这里的r实际上是就总体相关系数<span class="math inline">\(\rho\)</span>来说的，r是<span class="math inline">\(\rho\)</span>的估计值。</p>
<p>上面的这两个公式反应了两个变量之间的关系。</p>
<ol style="list-style-type: decimal">
<li>两个变量正线性相关。这时当x（相对于其样本均值）较大时，多数的y（相对于其样本均值）也应该较大；而当x相对于均值较小时，多数的y也应该相对于均值较小，无论在哪种情况下，分子中的<span class="math inline">\((X-\bar{X})\)</span>的符号和<span class="math inline">\((Y-\bar{Y})\)</span>的符号相同的就多，这样就得到一个较大的正值（但不会超过1）。通常来说，当r的值在0.75以上表示很强的相关，介于0.3到0.7之间为适中的相关性，而在0.25以下为很弱的相关性。</li>
<li>两个变量负线性相关。这时当x（相对于其样本均值）较大时，多数的y相对于其样本均较小；而当x相对于均值较小时，多数的y也应该相对于均值较大，而分子中的<span class="math inline">\((X-\bar{X})\)</span>的符号和<span class="math inline">\((X-\bar{X})\)</span>的符号相反的就多，这样就得到一个较大的负值（但不会小于-1）。</li>
<li>两个变量不线性相关。这时分子中的大于零的项和小于零的项的个数差不多，大小也不会差很多，这样公式的结果就是一个接近于0的数目。</li>
</ol>
<h2 id="pearson相关系数的计算">Pearson相关系数的计算</h2>
<p>现在看一个案例，这个案例来源于《医学统计学》（第四版，孙振球）的第九章，具体内容如下所示：</p>
<p>某医师测量了15名正常成年人的体重（kg）与CT双肾总体积（ml）的大小，数据如下表所示，据引回答，两变量是否有关联？其方向与密切程度如何？</p>
<table>
<thead>
<tr class="header">
<th>编号</th>
<th>体重（kg）</th>
<th>双肾总体积（ml）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>43</td>
<td>217</td>
</tr>
<tr class="even">
<td>2</td>
<td>74</td>
<td>316.18</td>
</tr>
<tr class="odd">
<td>3</td>
<td>51</td>
<td>231.11</td>
</tr>
<tr class="even">
<td>4</td>
<td>58</td>
<td>220.96</td>
</tr>
<tr class="odd">
<td>5</td>
<td>50</td>
<td>254.7</td>
</tr>
<tr class="even">
<td>6</td>
<td>65</td>
<td>293.84</td>
</tr>
<tr class="odd">
<td>7</td>
<td>54</td>
<td>263.28</td>
</tr>
<tr class="even">
<td>8</td>
<td>57</td>
<td>271.73</td>
</tr>
<tr class="odd">
<td>9</td>
<td>67</td>
<td>263.46</td>
</tr>
<tr class="even">
<td>10</td>
<td>69</td>
<td>276.53</td>
</tr>
<tr class="odd">
<td>11</td>
<td>80</td>
<td>341.15</td>
</tr>
<tr class="even">
<td>12</td>
<td>48</td>
<td>261</td>
</tr>
<tr class="odd">
<td>13</td>
<td>38</td>
<td>213.2</td>
</tr>
<tr class="even">
<td>14</td>
<td>85</td>
<td>315.12</td>
</tr>
<tr class="odd">
<td>15</td>
<td>54</td>
<td>252.08</td>
</tr>
</tbody>
</table>
<p>计算过程如下所示：</p>
<p>先绘制出散点图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">weight &lt;-c(<span class="number">43</span>,<span class="number">74</span>,<span class="number">51</span>,<span class="number">58</span>,<span class="number">50</span>,<span class="number">65</span>,<span class="number">54</span>,<span class="number">57</span>,<span class="number">67</span>,<span class="number">69</span>,<span class="number">80</span>,<span class="number">48</span>,<span class="number">38</span>,<span class="number">85</span>,<span class="number">54</span>)</div><div class="line">area &lt;-c(<span class="number">217</span>,<span class="number">316.18</span>,<span class="number">231.11</span>,<span class="number">220.96</span>,<span class="number">254.7</span>,<span class="number">293.84</span>,<span class="number">263.28</span>,<span class="number">271.73</span>,<span class="number">263.46</span>,<span class="number">276.53</span>,<span class="number">341.15</span>,<span class="number">261</span>,<span class="number">213.2</span>,<span class="number">315.12</span>,<span class="number">252.08</span>)</div><div class="line">plot(weight,area)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/L2gaj7AA3c.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="cor函数">cor()函数</h3>
<p>现在计算一下相关系数，用<code>cor()</code>函数即可，<code>cor()</code>函数的用法为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cor(x,use=, mehtod= )</div><div class="line">其中，x是数据集，它可以是矩阵，可以是数据框</div><div class="line">use指定缺失数据的处理方式，可选的方式为all.obs（假设不存在缺失数据），everything（遇到缺失数据时，相关系数的计算结果将被设为missing),complete.obs（行删除）以及pairwise.complete.obs（成对删除，pairwise deletion）</div><div class="line">method：指定的相关系数的类型，可选类型为pearson、spearman或kendall</div></pre></td></tr></table></figure>
<p>现在我们计算的是线性相关，使用的method参数为pearson（默认参数应时pearso，因此method参数可加不加），如果是直接计算两个变量的相关关系，也可以不使用数据框形式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; cor(weight,area)</div><div class="line">[<span class="number">1</span>] <span class="number">0.8754715</span></div></pre></td></tr></table></figure>
<h3 id="相关系数的统计推断">相关系数的统计推断</h3>
<h4 id="相关系数的假设检验">相关系数的假设检验</h4>
<p>从同一总体中抽出的不同样本会得到不同的样本相关系数，所以要判断X、Y之间是否确有直线相关关系，就要检验r是否来自于<span class="math inline">\(rho\neq 0\)</span>的总体，因为即使从<span class="math inline">\(\rho=0\)</span>的总体作随机抽样，由于抽样误差的影响，所得的r值也常不等于零。因此，当计算出r值后，接着要做<span class="math inline">\(\rho=0\)</span>的假设检验，常用t检验，检验统计量t值的计算公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/3KF6Jc3GCE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，分母为相关系数的标准误，求得t值后，查t值表就可以得到p值，这个过程现在用软件就可以计算，现在我们计算以下前面的那个案例，也就浊对于所得到的r值，检验CT双肾总体积与体重是否有直线相关关系？</p>
<p>它的假设检验如下所示：</p>
<p><span class="math inline">\(H_{0}:\rho=0\)</span>，即CT双肾减少呢体积与体重之间无直线相关关系</p>
<p><span class="math inline">\(H_{1}:\rho\neq 0\)</span>，即CT双肾减少呢体积与体重之间有直线相关关系</p>
<p><span class="math inline">\(\alpha=0.05\)</span>，在本例中，n=15，r=0.8754，根据公式（二），可得</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/de0a8CKeCF.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>按<span class="math inline">\(\nu=13\)</span>，查t值表可知，p&lt;0.001，按<span class="math inline">\(\alpha=0.05\)</span>的检验水准，拒绝<span class="math inline">\(H_{0}\)</span>，接受<span class="math inline">\(H_{1}\)</span>，可以认为CT双肾总体积与体重之间存在正相关，现在用R来计算一下，此时使用<code>cor.test</code>函数，<code>cor.test()</code>函数的使用为<code>cor.test(x,y,alternative=,method=)</code>，参数如下所示：</p>
<ul>
<li><p>alternative用来指定进行双侧检验或单侧检验（取值为“two.side”、“less”,“greater”）；</p></li>
<li><p>method用于指定要计算的类型（“pearson”、“kendall”或“spearman”），</p></li>
</ul>
<p>当研究的假设为总体的相关系数小于0时，使用alternative=“less”参数，当研究的假设为总体的相关系数大于0时，使用alternative=“greater”参数，默认性下是使用alternative=“two.side”，表示总体相关系数不等于零，这个案例的计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(weight,area)</div><div class="line"></div><div class="line">	Pearson<span class="string">'s product-moment correlation</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  weight and area</span></div><div class="line"><span class="string">t = 6.5317, df = 13, p-value = 1.907e-05</span></div><div class="line"><span class="string">alternative hypothesis: true correlation is not equal to 0</span></div><div class="line"><span class="string">95 percent confidence interval:</span></div><div class="line"><span class="string"> 0.6585492 0.9580681</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      cor </span></div><div class="line"><span class="string">0.8754715</span></div></pre></td></tr></table></figure>
<p>现在我们看一下这个结果，在这个结果中，我们可以得到这些信息：</p>
<ol style="list-style-type: decimal">
<li>对总体相关系数进行t检验，发现t值为6.5317，p值远远小于0.001，因此拒绝原假设，接受备选假设，也就是说，可以认为CT双肾总体积与体重之间存在正相关；</li>
<li>总体相关系数的95%置信区间为(0.6585492, 0.9580681)。</li>
</ol>
<h3 id="决定系数">决定系数</h3>
<p>直线回归与相关分析中，还有一个非常重要的统计量，称为决定系数（coefficient of determination），定义为回归平方与总平方和之比（这里可以看一下<a href="http://rvdsd.top/2017/06/07/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-08%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/">《线性回归笔记》</a>），计算公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/jib3eBE2I6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>为了方便描述，在双变量分析和多变量分析中，决定系数都用<span class="math inline">\(R^2\)</span>表示，但是对于双变量分析矾，<span class="math inline">\(R^2\)</span>就等于<span class="math inline">\(r^2\)</span>，具体公式就是公式（一）。</p>
<p><span class="math inline">\(R^2\)</span>的聚会在0到1之间且无单位，其数值大小反映了回归贡献的相对程度，也就是在Y的总变异中，回归关系所能解释的百分比，公式三也说明了，当<span class="math inline">\(SS_{总}\)</span>固定不变时，回归平方和的大小决定了相关系数r绝对值的大小，回归平方和越接近于总平方和，则r的绝对值越接近于1，说明相关的实际效果越好，在前面的案例中，15名成年人CT双肾总体积与体重之间的直线相关系数r=0.875，那么<span class="math inline">\(R^2\)</span>=0.7656，表示在这批数据中，体重可解释双肾体积变异性的76.56%，另外约23%的变异不能用体重来解释，决定系数除了作为相关或回归拟合效果的概括统计量外，还可以利用它对回归或相关作假设检验，其中对直线回归的拟合优度检验就等价于对总体回归系数的假设检验，检验统计量为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/dLEAe6Lkbj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>将此F统计量开平方根，就等于相对公式（二）中的相关系数做假设检验的t统计量，这又验证了相关与回归的假设检验是等价的。</p>
<h2 id="多元线性相关分析">多元线性相关分析</h2>
<p>在相关分析中，研究较多的是两个变量之间的关系，称为简单相关，当涉及的变量为三个或三个以上时，称为偏相关或复相关，实际上偏相关（复相关）是对简单相关的一种推广。在有些情况下，我们只想了解两变量之间有元线性相关关系，并不需要建立它们之间的回归模型，也不需要区分自变量和因变量，这时候就可以使用较为方便的相关分析方法。</p>
<h3 id="矩阵相关分析">矩阵相关分析</h3>
<p>设<span class="math inline">\(x_{1},x_{2},\cdots,x_{n}\)</span>来自正态总体<span class="math inline">\(N_{p}(\mu,\sum)\)</span>容量为n的样本，样本资料矩阵为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/H36IHG218a.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>此时，任意两个变量间的相关系数构成的矩阵为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/JAIFDed7eG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，<span class="math inline">\(r_ij\)</span>为任意两个变量之间的简单相关系数，即：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/I6jmgkE985.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="多元相关分析案例">多元相关分析案例</h3>
<p>现在看一个案例，这个案例的数据来源于《医学统计学》第四版.孙振球，案例描述如下：</p>
<p>27名糖尿病患者的血清总胆固醇、甘油三酯、空腹胰岛素、糖化血红蛋白、空腹血糖的测量值位于下表中，试计算这几个变量两两之间的相关系数。</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/aG3BEk29fH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/abbIG27Ajm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第一步：计算两两变量之间的相关系数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mlr &lt;- read.table(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_1501.csv"</span>,header=<span class="literal">T</span>,sep=<span class="string">","</span>) <span class="comment"># 原始数据集</span></div><div class="line">cor(mlr[<span class="number">2</span>:<span class="number">6</span>])</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; cor(mlr[<span class="number">2</span>:<span class="number">6</span>])</div><div class="line">           X1          X2          X3         X4          Y</div><div class="line">X1  <span class="number">1.0000000</span>  <span class="number">0.63150583</span> -<span class="number">0.35479471</span>  <span class="number">0.4152708</span>  <span class="number">0.5585251</span></div><div class="line">X2  <span class="number">0.6315058</span>  <span class="number">1.00000000</span> -<span class="number">0.03863221</span>  <span class="number">0.2189743</span>  <span class="number">0.4585096</span></div><div class="line">X3 -<span class="number">0.3547947</span> -<span class="number">0.03863221</span>  <span class="number">1.00000000</span> -<span class="number">0.3297787</span> -<span class="number">0.5101213</span></div><div class="line">X4  <span class="number">0.4152708</span>  <span class="number">0.21897432</span> -<span class="number">0.32977870</span>  <span class="number">1.0000000</span>  <span class="number">0.6096420</span></div><div class="line">Y   <span class="number">0.5585251</span>  <span class="number">0.45850963</span> -<span class="number">0.51012130</span>  <span class="number">0.6096420</span>  <span class="number">1.0000000</span></div></pre></td></tr></table></figure>
<p>从上面的结果可以看出来，X4与血糖的高低最为密切，它的r值为0.609，接着是X1，它的r值是0.558。</p>
<p>第二步：绘制出两两间的矩阵散点图，使用<code>pairs()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pairs(mlr[<span class="number">2</span>:<span class="number">6</span>])</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/a1cca88Jf2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在看一下相关系数的假设检验，这里用到的包是<code>mvstats</code>，但是这个包不在CRAN上，可能是《多元统计分析及R语言建模》（王斌会 ）自己写的，网上有，下载后安装即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(mvstats)</div><div class="line">&gt; corr.test(mlr[<span class="number">2</span>:<span class="number">6</span>])</div><div class="line">corr test: </div><div class="line">       X1      X2      X3     X4      Y</div><div class="line">X1  <span class="number">0.000</span>  <span class="number">0.0004</span>  <span class="number">0.0694</span> <span class="number">0.0312</span> <span class="number">0.0025</span></div><div class="line">X2  <span class="number">4.072</span>  <span class="number">0.0000</span>  <span class="number">0.8483</span> <span class="number">0.2725</span> <span class="number">0.0162</span></div><div class="line">X3 -<span class="number">1.897</span> -<span class="number">0.1933</span>  <span class="number">0.0000</span> <span class="number">0.0930</span> <span class="number">0.0066</span></div><div class="line">X4  <span class="number">2.283</span>  <span class="number">1.1221</span> -<span class="number">1.7466</span> <span class="number">0.0000</span> <span class="number">0.0007</span></div><div class="line">Y   <span class="number">3.367</span>  <span class="number">2.5797</span> -<span class="number">2.9655</span> <span class="number">3.8455</span> <span class="number">0.0000</span></div><div class="line">lower is t value，upper is p value</div></pre></td></tr></table></figure>
<p>左下角为t值，右上角为p值，现在把这个表格拆分一下就可以看清楚了，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/2Ea6fkmf9B.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>左下角是相关系数的t值，右上三解是p值，至于如何查看，还不清楚，略过，有空补上。</p>
<h2 id="spearman秩相关">Spearman秩相关</h2>
<h3 id="秩相关的使用范围">秩相关的使用范围</h3>
<p>秩相关(rank correlation)又称等级相关，是用双变量等级数据作直线相关分析，这类方法对原变量分布不作要求，属于非参数统计法，这种方法适用于下列资料：</p>
<ol style="list-style-type: decimal">
<li>不服从双变量正态分布而不宜作积差相关分析，这一点从原始数据的基本统计描述中或直观的散点图中就可以看出来；</li>
<li>总体分布型未知，例如限于仪器测量精度，个别样本的具体数值无法读取而出现“超限值”时；</li>
<li>原始数据是等级资料（例如某些药物治疗疾病的结果用恶化，没改善，好转来表示）。</li>
</ol>
<h3 id="秩相关的基本思想">秩相关的基本思想</h3>
<p>在秩相关中，使用等级相关系数<span class="math inline">\(r_{s}\)</span>来说明两个变量之间直线相关关系的密切程度与相关方向，其基本思想是将n对观察值<span class="math inline">\(X_{i},Y_{i}(i=1,2,\cdots,n)\)</span>分别由小到大偏秩（秩就编号的意思，最小的是1，第2小的是2，最后1个是n），用<span class="math inline">\(P_{i}\)</span>表示<span class="math inline">\(X_{i}\)</span>的秩，用<span class="math inline">\(Q_{i}\)</span>表示<span class="math inline">\(Y_{i}\)</span>的秩，其中，每对<span class="math inline">\(P_{i},Q_{i}\)</span>可能相等，也可能不等，这里考虑用<span class="math inline">\(P_{i}\)</span>与<span class="math inline">\(Q_{i}\)</span>之差来反映X、Y两变量秩排列一致性的情况，令<span class="math inline">\(d_{i}=P_{i}-Q_{i}\)</span>，由于<span class="math inline">\(d_{i}\)</span>可正可负，那么<span class="math inline">\(\sum d_{i}\)</span>就无法准确地反映<span class="math inline">\(P_{i}\)</span>与<span class="math inline">\(Q_{i}\)</span>差值的大小，因此取<span class="math inline">\(\sum {d_{i}}^2=\sum(P_{i}-Q_{i})^2\)</span>。在n为一定值时，当每对<span class="math inline">\(X_{i},Y_{i}\)</span>的秩完全相等时，此为完全正相关，此时，<span class="math inline">\(\sum {d_{i}}^2\)</span>有最小值，为0。当每对<span class="math inline">\(X_{i},Y_{i}\)</span>的秩完全相反时，此为完全负相关，此时，<span class="math inline">\(\sum {d_{i}}^2\)</span>有最大值，最大值如下所示：</p>
<p><span class="math inline">\(\sum {d_{i}}^2=\sum(P_{i}-Q_{i})^2=\sum[(n+1-i)-i]^2=n(n^2-1)/3\)</span>（公式五）</p>
<p><span class="math inline">\(\sum {d_{i}}^2\)</span>从0到其最大值的范围的变化，反映了X、Y两变量的相关程度，为了与积差相关系数r（这个r就是直线相关的相关系数）表示相关程度与方向的形式一致，那么过计算Spearman等级相关的系数<span class="math inline">\(r_{s}\)</span>就如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/f66BKgJ424.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><span class="math inline">\(r_{s}\)</span>的值介于-1到1之间，当为正值时，表示正相关，为负表示负相关，等于0表示零相关，样本等级相关系数<span class="math inline">\(r_{s}\)</span>是总体等级相关系数<span class="math inline">\(\rho_{s}\)</span>的估计值，检验<span class="math inline">\(\rho_{s}\)</span>是否不为零可以查表，当n&gt;50时，可以按下面的这个公式计算 检验统计量u，查u表确定p值，公式如下：</p>
<p><span class="math inline">\(\mu=r_{s} \sqrt{n-1}\)</span>（公式七）</p>
<h2 id="秩相关计算案例">秩相关计算案例</h2>
<p>这个案例来源于《医学统计学》（第四版，孙振球），案例描述如下所示：</p>
<p>某省调查了1995年到1999年当地居民18类死因的构成以及每种死因导致的潜在工作损失年数WYPLL的构成，结果见下表，以死因构成为X，WYPLL构成为Y，作等级相关分析。</p>
<table>
<thead>
<tr class="header">
<th>死因类别</th>
<th>死因构成（%）</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>X</td>
<td>P</td>
<td>Y</td>
<td>Q</td>
<td>d</td>
<td><span class="math inline">\(d^2\)</span></td>
</tr>
<tr class="even">
<td>(1)</td>
<td>(2)</td>
<td>(3)</td>
<td>(4)</td>
<td>(5)</td>
<td>(6)=(3)-(5)</td>
<td>(7)=(6)^2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0.03</td>
<td>1</td>
<td>0.05</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.14</td>
<td>2</td>
<td>0.34</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.2</td>
<td>3</td>
<td>0.93</td>
<td>6</td>
<td>-3</td>
<td>9</td>
</tr>
<tr class="even">
<td>4</td>
<td>0.43</td>
<td>4</td>
<td>0.69</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0.44</td>
<td>5</td>
<td>0.38</td>
<td>3</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td>6</td>
<td>0.45</td>
<td>6</td>
<td>0.79</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>0.47</td>
<td>7</td>
<td>1.19</td>
<td>8</td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="even">
<td>8</td>
<td>0.65</td>
<td>8</td>
<td>4.74</td>
<td>12</td>
<td>-4</td>
<td>16</td>
</tr>
<tr class="odd">
<td>9</td>
<td>0.95</td>
<td>9</td>
<td>2.31</td>
<td>9</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>10</td>
<td>0.96</td>
<td>10</td>
<td>5.95</td>
<td>14</td>
<td>-4</td>
<td>16</td>
</tr>
<tr class="odd">
<td>11</td>
<td>2.44</td>
<td>11</td>
<td>1.11</td>
<td>7</td>
<td>4</td>
<td>16</td>
</tr>
<tr class="even">
<td>12</td>
<td>2.69</td>
<td>12</td>
<td>3.53</td>
<td>11</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>13</td>
<td>3.207</td>
<td>13</td>
<td>3.48</td>
<td>10</td>
<td>3</td>
<td>9</td>
</tr>
<tr class="even">
<td>14</td>
<td>7.78</td>
<td>14</td>
<td>5.65</td>
<td>13</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>15</td>
<td>9.82</td>
<td>15</td>
<td>33.95</td>
<td>18</td>
<td>-3</td>
<td>9</td>
</tr>
<tr class="even">
<td>16</td>
<td>18.93</td>
<td>16</td>
<td>17.16</td>
<td>17</td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>17</td>
<td>22.59</td>
<td>17</td>
<td>8.42</td>
<td>15</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td>18</td>
<td>27.96</td>
<td>18</td>
<td>9.33</td>
<td>16</td>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>假设检验：</p>
<p><span class="math inline">\(H_{0}:\rho_{s}=0\)</span>，即死因构成和WYPLL构成之间无直线相关关系</p>
<p><span class="math inline">\(H_{1}:\rho_{s} \neq0\)</span>，即死因构成和WYPLL构成之间有直线相关关系</p>
<p><span class="math inline">\(\alpha=0.05\)</span></p>
<p>将两变量X、Y的实测值分别从小到大编秩，用<span class="math inline">\(P_{i}\)</span>和<span class="math inline">\({Q_{i}}\)</span>表示，见上表的(3)、(5)列，每个变量中若有观察值相同的秩，则取平均秩。求每天的秩的差值d、<span class="math inline">\(d^2\)</span>，<span class="math inline">\(\sum d^2\)</span>，也就是上表的第(6)、(7)栏，按前面的公式（六）计算<span class="math inline">\(r_{s}\)</span>，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/C8GKLGAa77.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在本例中，n=18，查<span class="math inline">\(r_{s}\)</span>的界值表可知，p&lt;0.001，按<span class="math inline">\(\alpha=0.05\)</span>的检验水准，拒绝<span class="math inline">\(H_{0}\)</span>，接受<span class="math inline">\(H_{1}\)</span>，可认为当地居民死因的构成和和各种死因导致的潜在工作损失年数WYPLL的构成存在正相关关系。</p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">death_reason &lt;- c(<span class="number">0.03</span>,<span class="number">0.14</span>,<span class="number">0.2</span>,<span class="number">0.43</span>,<span class="number">0.44</span>,<span class="number">0.45</span>,<span class="number">0.47</span>,<span class="number">0.65</span>,<span class="number">0.95</span>,<span class="number">0.96</span>,<span class="number">2.44</span>,<span class="number">2.69</span>,<span class="number">3.207</span>,<span class="number">7.78</span>,<span class="number">9.82</span>,<span class="number">18.93</span>,<span class="number">22.59</span>,<span class="number">27.96</span>)</div><div class="line">wyypll &lt;-c(<span class="number">0.05</span>,<span class="number">0.34</span>,<span class="number">0.93</span>,<span class="number">0.69</span>,<span class="number">0.38</span>,<span class="number">0.79</span>,<span class="number">1.19</span>,<span class="number">4.74</span>,<span class="number">2.31</span>,<span class="number">5.95</span>,<span class="number">1.11</span>,<span class="number">3.53</span>,<span class="number">3.48</span>,<span class="number">5.65</span>,<span class="number">33.95</span>,<span class="number">17.16</span>,<span class="number">8.42</span>,<span class="number">9.33</span>)</div><div class="line">cor.test(death_reason,wyypll,method=<span class="string">"spearman"</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(death_reason,wyypll,method=<span class="string">"spearman"</span>)</div><div class="line"></div><div class="line">	Spearman<span class="string">'s rank correlation rho</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  death_reason and wyypll</span></div><div class="line"><span class="string">S = 92, p-value &lt; 2.2e-16</span></div><div class="line"><span class="string">alternative hypothesis: true rho is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      rho </span></div><div class="line"><span class="string">0.9050568</span></div></pre></td></tr></table></figure>
<p>其中，可以发现p值远小于0.01，因此，可认为当地居民死因的构成和和各种死因导致的潜在工作损失年数WYPLL的构成存在正相关关系。</p>
<h2 id="spearman与pearson相关分析的区别">Spearman与Pearson相关分析的区别</h2>
<p><strong>Pearson相关系数主要用于正态分布资料，Spearman相关系数主要用于非正态分布资料或等级资料</strong>，看一个案例：</p>
<p>例6.1 某疾控中心调查了辖区内公务员的体重指数、血压、总胆固醇、空腹血糖等指标，以了解他们的健康状况。现从中随机抽取20人的体重指数、总胆固醇(mmol/L)、空腹血糖(mmol/L)三个指标，分析这三个指标的相关性(《医学案例统计分析与SAS应用》冯国双，第六章 相关分析及SAS实现，例6-2，P103)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">bmi &lt;- c(19.49,21.1,20.56,22.15,22.49,19.56,26.64,22.98,25.8,21.88,21.08,25.25,25.59,23.23,24.17,27.44,27.18,27.46,28.93,24.49)</div><div class="line">tc &lt;- c(4.21,4.25,4.34,4.51,4.72,4.79,4.8,4.84,4.97,5.04,5.14,5.23,5.25,5.28,5.83,5.89,6.05,6.07,6.17,6.68)</div><div class="line">fbg &lt;- c(5.1,5.1,5.1,5.7,5.3,5.6,5.4,5.1,5.6,5.7,5.4,5.9,5,5.8,5.9,5.08,5.7,5.9,6.2,5.9)</div><div class="line"></div><div class="line"># 进行正态检验</div><div class="line"></div><div class="line">normality_test &lt;- function(x)&#123;</div><div class="line">  if(!require(nortest))&#123;</div><div class="line">    install.packages(&quot;nortest&quot;)</div><div class="line">  &#125;</div><div class="line">    SW &lt;- c(shapiro.test(x)$statistic,shapiro.test(x)$p.value)</div><div class="line">    KS &lt;- c(lillie.test(x)$statistic,lillie.test(x)$p.value)</div><div class="line">    CM &lt;- c(cvm.test(x)$statistic,cvm.test(x)$p.value)</div><div class="line">    AD &lt;- c(ad.test(x)$statistic,ad.test(x)$p.value)</div><div class="line">    result &lt;- rbind(SW,KS,CM,AD)</div><div class="line">    colnames(result) &lt;- c(&quot;参数&quot;,&quot;P值&quot;)</div><div class="line">    rownames(result) &lt;- c(&quot;Shapiro-Wilk&quot;,&quot;Kolmogorov-Smirnov&quot;,&quot;Cramer-von Mises&quot;,&quot;Anderson-Darling&quot;)</div><div class="line">    return(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">normality_test(bmi)</div><div class="line">normality_test(tc)</div><div class="line">normality_test(fbg)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; normality_test(bmi)</div><div class="line">Loading required package: nortest</div><div class="line">                         参数       P值</div><div class="line">Shapiro-Wilk       <span class="number">0.95943187</span> <span class="number">0.5325625</span></div><div class="line">Kolmogorov-Smirnov <span class="number">0.08966131</span> <span class="number">0.9429037</span></div><div class="line">Cramer-von Mises   <span class="number">0.03912813</span> <span class="number">0.6800017</span></div><div class="line">Anderson-Darling   <span class="number">0.26621338</span> <span class="number">0.6521088</span></div><div class="line">&gt; normality_test(tc)</div><div class="line">                         参数       P值</div><div class="line">Shapiro-Wilk       <span class="number">0.94642760</span> <span class="number">0.3160935</span></div><div class="line">Kolmogorov-Smirnov <span class="number">0.15632558</span> <span class="number">0.2254919</span></div><div class="line">Cramer-von Mises   <span class="number">0.07256231</span> <span class="number">0.2452443</span></div><div class="line">Anderson-Darling   <span class="number">0.41984856</span> <span class="number">0.2949359</span></div><div class="line">&gt; normality_test(fbg)</div><div class="line">                         参数        P值</div><div class="line">Shapiro-Wilk       <span class="number">0.91658692</span> <span class="number">0.08519076</span></div><div class="line">Kolmogorov-Smirnov <span class="number">0.17996352</span> <span class="number">0.08886482</span></div><div class="line">Cramer-von Mises   <span class="number">0.09973686</span> <span class="number">0.10482513</span></div><div class="line">Anderson-Darling   <span class="number">0.67392089</span> <span class="number">0.06650739</span></div></pre></td></tr></table></figure>
<p>正态检验的结果表明，三个指标采用Shapiro-WIlk、Kolmogorov-Smirnov法，bmi与tc的P值均远远大于0.05，fbg的P值仅略大于0.05，为稳妥起见，下面分别按正态分布与非正态分布进行线性相关分析，即分别采用Pearson与Spearman相关分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cor.test(bmi,tc)</div><div class="line"># </div><div class="line"># Pearson&apos;s product-moment correlation</div><div class="line"># </div><div class="line"># data:  bmi and tc</div><div class="line"># t = 4.3734, df = 18, p-value = 0.0003664</div><div class="line"># alternative hypothesis: true correlation is not equal to 0</div><div class="line"># 95 percent confidence interval:</div><div class="line"># 0.4033506 0.8805849</div><div class="line"># sample estimates:</div><div class="line"># cor </div><div class="line"># 0.717758</div></pre></td></tr></table></figure>
<p>Pearson相关分析结果：bmi与tc间的相关系数是0.718,有统计学意义(P=0.0003664)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cor.test(bmi,fbg)</div><div class="line"># Pearson&apos;s product-moment correlation</div><div class="line"># </div><div class="line"># data:  bmi and fbg</div><div class="line"># t = 1.8681, df = 18, p-value = 0.07811</div><div class="line"># alternative hypothesis: true correlation is not equal to 0</div><div class="line"># 95 percent confidence interval:</div><div class="line"># -0.04811789  0.71754554</div><div class="line"># sample estimates:</div><div class="line"># cor </div><div class="line"># 0.4029837</div></pre></td></tr></table></figure>
<p>Pearson相关分析结果：bmi与fbg间的相关系数是0.403,无统计学意义(P=0.07811)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cor.test(tc,fbg)</div><div class="line"># Pearson&apos;s product-moment correlation</div><div class="line"># </div><div class="line"># data:  tc and fbg</div><div class="line"># t = 3.2599, df = 18, p-value = 0.004349</div><div class="line"># alternative hypothesis: true correlation is not equal to 0</div><div class="line"># 95 percent confidence interval:</div><div class="line"># 0.2283232 0.8284398</div><div class="line"># sample estimates:</div><div class="line"># cor </div><div class="line"># 0.6092833</div></pre></td></tr></table></figure>
<p>Pearson相关分析结果：bmi与tc间的相关系数是0.609,有统计学意义(P=0.004349)</p>
<p><strong>接着进行Spearman分析</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cor.test(bmi,tc,method=c(&quot;spearman&quot;)) # Spearman检验</div><div class="line"># Spearman&apos;s rank correlation rho</div><div class="line"># </div><div class="line"># data:  bmi and tc</div><div class="line"># S = 330, p-value = 0.0002006</div><div class="line"># alternative hypothesis: true rho is not equal to 0</div><div class="line"># sample estimates:</div><div class="line">#       rho </div><div class="line"># 0.7518797</div></pre></td></tr></table></figure>
<p>Spearman相关分析结果：bmi与tc间的相关系数是0.752,有统计学意义(P=0.0002006)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cor.test(bmi,fbg,method=c(<span class="string">"spearman"</span>)) <span class="comment"># Spearman检验</span></div><div class="line"><span class="comment"># Spearman's rank correlation rho</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># data:  bmi and fbg</span></div><div class="line"><span class="comment"># S = 859.38, p-value = 0.1259</span></div><div class="line"><span class="comment"># alternative hypothesis: true rho is not equal to 0</span></div><div class="line"><span class="comment"># sample estimates:</span></div><div class="line"><span class="comment"># rho </span></div><div class="line"><span class="comment"># 0.3538517</span></div></pre></td></tr></table></figure>
<p>Spearman相关分析结果：bmi与fbg间的相关系数是0.354,无统计学意义(P=0.1259)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cor.test(tc,fbg,method=c(&quot;spearman&quot;)) # Spearman检验</div><div class="line"># Spearman&apos;s rank correlation rho</div><div class="line"># </div><div class="line"># data:  tc and fbg</div><div class="line"># S = 564.48, p-value = 0.007919</div><div class="line"># alternative hypothesis: true rho is not equal to 0</div><div class="line"># sample estimates:</div><div class="line"># rho </div><div class="line"># 0.5755785</div></pre></td></tr></table></figure>
<p>Spearman相关分析结果：fbg与tc间的相关系数是0.576,有统计学意义(P=0.007919)</p>
<h2 id="kendall-τ相关系数">Kendall τ相关系数</h2>
<p>Kendall τ相关系数也是一种关于两个变量相关的度量，它的原理是把所有的样本点配对，如果<span class="math inline">\((x_{1},y_{1}),\cdots,(x_{n},y_{n})\)</span>是这两个变量的n个观测值对子。</p>
<p>如果每一个点由x和y组成的坐标(x,y)代表，一对点，就是诸如<span class="math inline">\((x_{i},y_{i})\)</span>和<span class="math inline">\((x_{j},y_{j})\)</span>的点对（这里的i和j不同）；然后看每一对中的x和y的观测值是否同时增加（或减少），比如由点对<span class="math inline">\((x_{1},y_{1})\)</span>和<span class="math inline">\((x_{2},y_{2})\)</span>可以算出乘积<span class="math inline">\((x_{2}-x_{1})(y_{2}-y_{1})\)</span>是否大于0。如果<span class="math inline">\((x_{2}-x_{1})(y_{2}-y_{1})\)</span>大于0，则说明这点中的x和y同时增长或下降。我们就说这两点<strong>协同(concordant)</strong>，如果这个乘积小于0，那么说明这两个点中的x和y并非同时增长或同时下降，我们称这两点<strong>不协同(discordant)</strong>。如果样本中协同的点数目多，两个变量就更加正相关一些；如果样本中不协同的点数目多，两个变量就更加负相关一些；如果既不正相关，也不负相关，则为不相关。</p>
<p>Kendall系统的公式为</p>
<div class="figure">
<img src="http://a4.att.hudong.com/21/34/01200000123509134436340797162_s.jpg">

</div>
<p>其中n是项目的数量，和P的总和，对所有的项目，项目的数量排名后，给予这两个项目的排名。 P也可以被解释为是一致的对数。分母可以解释为总对数。因此，一个高价值的P，大多数是一致的，表明这两个序列是一致的。请注意，并列一双不被视为一致或不一致。如果有大量的关系，总人数的双（分母中的表达τ ）应作相应调整。</p>
<p>该肯德尔系数（τ,或tau）具有下列属性</p>
<p>如果排列双方的排名是完美的（即两个排名是相同的）的系数的价值1。如果两排列之间的分歧排名是完美的（即一个排名是扭转其他）的系数价值-1 。对于所有其他的值在于介于-1和1之间的排列，增加值意味着增加之间的排列的排名。如果排名是完全独立的，该系数已值为0的平均水平。</p>
<p>这种方法用不差对总体做任何假定也可以检验，因此这是一个非参数的检验（所谓非参数方法，就是它不依赖于变量背后的总体分布）。Kendall τ也是在-1和1之间的娄和，也是越接近1或-1就越相关，越接近于0就不相关。 和Kendall τ相联系也有零假设是“两个变量独立”的假设检验，即使在正态假定成立时，相对于和Pearson相关系数有关检验，这个检验的效率也很高，在正态假定不那么确定时，与Kendall τ有关的检验对查看两个变量的独立性是非常有用的。</p>
<p>现在我们看一下秩相关分析案例使用Kenall进行计算的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">death_reason &lt;- c(<span class="number">0.03</span>,<span class="number">0.14</span>,<span class="number">0.2</span>,<span class="number">0.43</span>,<span class="number">0.44</span>,<span class="number">0.45</span>,<span class="number">0.47</span>,<span class="number">0.65</span>,<span class="number">0.95</span>,<span class="number">0.96</span>,<span class="number">2.44</span>,<span class="number">2.69</span>,<span class="number">3.207</span>,<span class="number">7.78</span>,<span class="number">9.82</span>,<span class="number">18.93</span>,<span class="number">22.59</span>,<span class="number">27.96</span>)</div><div class="line">wyypll &lt;-c(<span class="number">0.05</span>,<span class="number">0.34</span>,<span class="number">0.93</span>,<span class="number">0.69</span>,<span class="number">0.38</span>,<span class="number">0.79</span>,<span class="number">1.19</span>,<span class="number">4.74</span>,<span class="number">2.31</span>,<span class="number">5.95</span>,<span class="number">1.11</span>,<span class="number">3.53</span>,<span class="number">3.48</span>,<span class="number">5.65</span>,<span class="number">33.95</span>,<span class="number">17.16</span>,<span class="number">8.42</span>,<span class="number">9.33</span>)</div><div class="line">cor.test(death_reason,wyypll,method=<span class="string">"kendall"</span>)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(death_reason,wyypll,method=<span class="string">"kendall"</span>)</div><div class="line"></div><div class="line">	Kendall<span class="string">'s rank correlation tau</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  death_reason and wyypll</span></div><div class="line"><span class="string">T = 133, p-value = 2.522e-06</span></div><div class="line"><span class="string">alternative hypothesis: true tau is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      tau </span></div><div class="line"><span class="string">0.7385621</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看到，p值几乎为0，τ的相关系数为0.7385621。</p>
<h2 id="关于这三个相关系数的区别">关于这三个相关系数的区别</h2>
<p>Pearson相关系数描述的是两个变量的线性关系，而Spearman和Kendall τ这两个非参数度量更为一般的关于单调关系的度量，这是因为一个变量的秩不会被任何对该变量的单调的严格递增的变换所改变，因此，把这两个非参数度量称为关联(association)的度量可能更为合适。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>孙振球. 医学统计学.第3版[M]. 人民卫生出版社, 2010.</li>
<li>DawnGriffiths. 深入浅出统计学[M]. 电子工业出版社, 2012.</li>
<li>王斌会. 多元统计分析及R语言建模[M]. 暨南大学出版社, 2010.</li>
<li>吴喜之. 统计学:从数据到结论(第四版)[J]. 中国统计, 2013(6):2.</li>
<li>冯国双, 罗凤基. 医学案例统计分析与SAS应用[M]. 北京大学医学出版社, 2011.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/07/BioStatistics/生物统计-09线性回归/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/07/BioStatistics/生物统计-09线性回归/" itemprop="url">线性回归笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-07T12:02:00+08:00">
                2017-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13,316
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  54
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>直线回归可以用以下<strong>直线回归方程（linear regression equation）</strong>来表示，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180830/g2B6l464K6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>公式（一）称为经验回归方程或样本回归方程，其中b表示这条方程的斜率，a表示这个方程在y轴上的截矩，有的教材上把a与b写作是<span class="math inline">\(\hat{a}\)</span>和<span class="math inline">\(\hat{b}\)</span>，这两个字母上面的符号读作hat，称为“帽子”，它们表示利用样本的数据估计得得来的截矩和斜率。我们可以通过一系列的计算求出这个方程的a和b，这个方程是对两变量总体间线性关系的一个估计，根据散点图可以假设，对于X的各个取值，相应Y的总体均数<span class="math inline">\(\mu_{Y|X}\)</span>在一条直线上，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/fFlH2dh41C.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>总体均数表示为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180830/B2jJ6jlIb6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>除了图中所示两变量呈直线关系外，一般还假定每个X对应Y的总体为正态分布，各个正态分布的总体方差相等且各次观测相互独立，这样公式（一）中的<span class="math inline">\(\hat{Y}\)</span>实际上是x所对应Y的总体均数<span class="math inline">\(\mu_{Y|X}\)</span>的一个样本估计值，称为回归方程的预测值（predicted value），而a、 b分别为<span class="math inline">\(\alpha\)</span>和<span class="math inline">\(\beta\)</span>的样本估计，其中a称为常数项，b称为回归系数（coefficient of regression），b是直线的斜率（slope），其统计意义是，当X变化一个单位时，Y的平均改变的估计值，b&gt;0时，直线从左下方走到右上方，Y随X的增大而增大，当b&lt;0时，直线从左上方走向右下方，Y随X的增大而减小；当b=0时，直线与X轴平行，Y与X没有关系。</p>
<h2 id="直线回归方程的计算思路">直线回归方程的计算思路</h2>
<p>如果能够从样本数据中求得a和b的数值，那么回归方程即可唯一确定，从散点图上来看，求解a和b实际上就是怎么找到一条最能代表数据点分布趋势的直线，将实测值Y与假定回归线上估计值<span class="math inline">\(\hat{Y}\)</span>（这个Y的上面有一个帽子结构的符号表示这是Y值的估计值）的纵向距离<span class="math inline">\(Y-\hat{Y}\)</span>称为<strong>残差（residual）</strong>，残差通常用<span class="math inline">\(e_{i}\)</span>表示，如果把残差进行了均一化，即进行了z转换，那它就是标准化残差，其中对于要找到的这条最佳的直线，它的<strong>残差平方和（sum of squared residuals, sum of squared errors或residual sum of squares，简称为SSE或RSS等）</strong>是最小的，这就是最小二乘法（Least sum of squares，LS）的思想（因为古中国的数学家在描述平方时，使用的术语是“二乘”，因此这里叫最小二乘法），如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/Jlg9aK0JG7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在一定假设条件下，如此得到的回归系数最为理解，按照这一原则，数学上可以很容易得到a和b的计算公式，如下所示：</p>
<p><span class="math inline">\(b=\frac{l_{XY}}{l_{XX}}=\frac{\sum(X-\bar{X})(Y-\bar{Y}))}{\sum(X-\bar{X})^2}\)</span> 公式（三）</p>
<p><span class="math inline">\(a=\bar{Y}-b \bar{X}\)</span> 公式（四）</p>
<p>其中，<span class="math inline">\(l_{XY}\)</span>是X与Y的均离均差平交叉乘积和，简称离均差积和，公式为：</p>
<p><span class="math inline">\(l_{XY}=\sum(X-\bar{X})(Y-\bar{Y})=\sum XY-\frac{\sum(X)(\sum(Y)}{n}\)</span> 公式（五）</p>
<p>除了用公式（一）来表示两变量线性回归关系，还可以在散点图上绘制出样本回归直线作为一种直</p>
<p>观的统计描述补充形式，此直线必然通过点<span class="math inline">\((\bar{X},\bar{Y})\)</span>，且与纵坐标轴相关于截矩a，如果散点图没有从坐标系原点开始，可以在自变量实测范围内远端取易于读取的X值代入回归方程得到一个点的坐标，连接此点与点<span class="math inline">\((\bar{X},\bar{Y})\)</span>也能绘制出回归直线。</p>
<p>现在再看一下原始数据：</p>
<table>
<thead>
<tr class="header">
<th>编号</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>年龄X</td>
<td>13</td>
<td>11</td>
<td>9</td>
<td>6</td>
<td>8</td>
<td>10</td>
<td>12</td>
<td>7</td>
</tr>
<tr class="even">
<td>尿肌酐含量Y</td>
<td>3.54</td>
<td>3.01</td>
<td>3.09</td>
<td>2.48</td>
<td>2.56</td>
<td>3.36</td>
<td>3.18</td>
<td>2.65</td>
</tr>
</tbody>
</table>
<p>由原始数据与散点图可知，两变量之间呈直线趋势，因此可以计算出相应的参数：</p>
<h2 id="线性回归方程的计算过程">线性回归方程的计算过程</h2>
<p>第一步：计算出X、Y的均值<span class="math inline">\(\bar{X}\)</span>、<span class="math inline">\(\bar{Y}\)</span>，离均差平方和<span class="math inline">\(l_{XX}\)</span>、<span class="math inline">\(l_{YY}\)</span>与离均差积和<span class="math inline">\(l_{XY}\)</span>，如下所示：</p>
<p><span class="math inline">\(\bar{X}=\frac{\sum X}{n}=\frac{76}{8}=9.5,\bar{Y}=\frac{\sum X}{n}=\frac{23.87}{8}=9.5\)</span></p>
<p><span class="math inline">\(l_{XX}=\sum X^2-\frac{(\sum X)^2}{n}=764-\frac{(76)^2}{8}=42\)</span></p>
<p><span class="math inline">\(l_{YY}=\sum X^2-\frac{(\sum Y)^2}{n}=72.2683-\frac{(23.87)^2}{8}=1.0462\)</span></p>
<p><span class="math inline">\(l_{YY}=\sum XY-\frac{(\sum X)(\sum Y)}{n}=232.61-\frac{(76)(23.87)}{8}=5.8450\)</span></p>
<p>第二步：计算出回归系数b和截矩a</p>
<p>根据公式（三），b=5.8450/42=0.1392</p>
<p>根据公式（四），a=2.9838-(0.1392)(9.5)=1.667</p>
<p>列出直线回归方程，如下所示：</p>
<p><span class="math inline">\(\hat{Y}=0.1392X + 1.667\)</span></p>
<p>R计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; lm(cr~age)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = cr ~ age)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line">(Intercept)          age  </div><div class="line">     <span class="number">1.6617</span>       <span class="number">0.1392</span></div></pre></td></tr></table></figure>
<h2 id="直线回归中的统计推断">直线回归中的统计推断</h2>
<h3 id="回归方程的假设检验">回归方程的假设检验</h3>
<p>建立样本直线回归方程，只是完成了统计分析中两个变量关系的描述，研究者还必须要回答它所来自总体的直线回归关系是否确实存在，即是否对总体有<span class="math inline">\(\beta \neq 0\)</span>（<span class="math inline">\(\beta\)</span>就是自变量与因变量的相关系数），如下图所示，无论X如何取值，<span class="math inline">\(\mu_{Y|X}\)</span>总在一条水平线上，即<span class="math inline">\(\beta=0\)</span>，总体直线回归方程并不成立，也就是说Y与X无直接线性关系，此时<span class="math inline">\(\mu_{Y|X}=\mu_{Y}\)</span>，然而在一次随机抽样中，如果所得的样本为实心圆点所示，则会得到一个并不等于0的样本回归系数b，b与0相关多大可以认为具有统计学意义？这就需要方差分析或与其等价的t检验来说明问题。</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/1E4L2hJ510.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="方差分析">方差分析</h4>
<p>先看一张图，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/83E7EGFj70.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在上图中，任意一点P的纵坐标被回归直线<span class="math inline">\(\hat{Y}\)</span>与无数<span class="math inline">\(\bar{Y}\)</span>截成三个线段，其中：<span class="math inline">\(Y-\bar{Y}=(\hat{Y}-\bar{Y}=(Y-\hat{Y}))\)</span>。由于P点是散点图中任取的一点，将全部数据点都这样处理，并将等式两端平方后再求和，可以证明：</p>
<p><span class="math inline">\(\sum(\hat{Y}-\bar{Y})(Y-\hat{Y})=0\)</span></p>
<p>那么有以下的公式：</p>
<p><span class="math inline">\(\sum(Y-\hat{Y})^2=\sum(\hat{Y}-\bar{Y})^2+\sum(\bar{Y}-\hat{Y})^2\)</span></p>
<p>上面的公式用符号表示就是：<span class="math inline">\(SS_{总}=SS_{回}+SS_{残}\)</span>（公式六)</p>
<p>其中，<span class="math inline">\(SS_{总}\)</span>即<span class="math inline">\(\sum(Y-\bar{Y})^2\)</span>，这是Y的离均差平方和，表示未考虑Y与X的回归关系时，Y的总变异。</p>
<p><span class="math inline">\(SS_{回}\)</span>即<span class="math inline">\(\sum(\hat{Y}-\bar{Y})^2\)</span>，这是回归平方和，由于特定样本的均数<span class="math inline">\(\bar{Y}\)</span>是固定的，因此这部分变异由<span class="math inline">\(\hat{Y}_{i}\)</span>的大小不同引起，当X被引物回归以后，正是由于<span class="math inline">\(X_{i}\)</span>的不同导致了<span class="math inline">\(\hat{Y}=a+bX_{i}\)</span>的不同，所以，<span class="math inline">\(SS_{回}\)</span>就反映了在Y的总变异中可以用Y与X的直线关系解释的那部分变异，b离0越远，Y受X的影响越大，<span class="math inline">\(SS_{回}\)</span>就越大，说明回归效果就越好。</p>
<p><span class="math inline">\(SS_{残}\)</span>即<span class="math inline">\(\sum({Y-\hat{Y}})^2\)</span>，为残差平方和。它反映了除了X对Y的线性影响之外的一切因素对Y的变异的作用，也就是在总平方和中无法用X解释的部分，表示考虑回归之后Y真正的随机误差，在散点图中，各实测点离回归直线越近，<span class="math inline">\(SS_{残}\)</span>也就越小，说明直线回归的估计误差越小，回归的作用就越明显。</p>
<p>上述的三个平方和，各有其相应的自由度<span class="math inline">\(\nu\)</span>，并有如下的关系：</p>
<p><span class="math inline">\(\nu_{总}=\nu_{回}+\nu_{残}, \nu_{总}=n-1, \nu_{回}=1, \nu_{残}=n-2\)</span></p>
<p>从以上离均差平方和及其自由度的分解可知，不考虑回归时，随机误差是Y的总变异<span class="math inline">\(SS_{总}\)</span>，而考虑回归以后，由于回归的贡献，使原来的随机误差减小为<span class="math inline">\(SS_{残}\)</span>，如果两变量之间总体回归关系确实存在，回归的贡献就要大于随机误差，大到何种程度时可以认为具有统计学意义，可以计算如下F统计量（其实就是方差分析了），如下所示：</p>
<p><span class="math inline">\(F=\frac{SS_{回}/\nu_{回}}{SS_{残}/\nu_{残}}=\frac{MS_{回}}{MS_{残}}, \nu_{回}=1, \nu_{残}=n-2\)</span>（公式八）</p>
<p>在这个公式中，<span class="math inline">\(MS_{回}\)</span>、<span class="math inline">\(MS_{残}\)</span>分别称为回归均方与残差均方，统计量F服从自由度为<span class="math inline">\(\nu_{回}\)</span>，<span class="math inline">\(\nu_{残}\)</span>的F分布，求F值后，查F界值表，得到p值，按所取检验水准作为推断结论。实际计算时，可以先将<span class="math inline">\(X_{i}\)</span>依次代入回归方程，求得<span class="math inline">\({\hat{Y}}\)</span>，再求得<span class="math inline">\(SS_{残}\)</span>，<span class="math inline">\(SS_{回}\)</span>也可以利用下面的公式直接求出<span class="math inline">\(SS_{回}\)</span>，再得到<span class="math inline">\(SS_{残}\)</span>，如下所示：</p>
<p><span class="math inline">\(SS_{回}=bl_{XY}=l^2_{XY}/l_{XX}=b^2l_{XX}\)</span>（公式九）</p>
<h4 id="t检验">t检验</h4>
<p>对于<span class="math inline">\(\beta=0\)</span>这一假设是否成立还可以进行如下t检验，如下所示：</p>
<p><span class="math inline">\(t=\frac{b-0}{S_{b}},\nu=n-2\)</span>（公式十）</p>
<p><span class="math inline">\(S_{b}=\frac{S_{Y \cdot X}}{\sqrt{L_{XX}}}\)</span>（公式十一）</p>
<p><span class="math inline">\(S_{X \cdot Y}=\sqrt{\frac{SS_{残}}{n-2}}\)</span>（公式十二）</p>
<p>其中，<span class="math inline">\(SS_{Y\cdot X}\)</span>是回归的剩余标准差（standard deviation of residuals），<span class="math inline">\(S_{b}\)</span>是样本回归系数标准误，这些计算公式表明，扩大自变量的取值范围可以减小<span class="math inline">\(S_{b}\)</span>，使得回归系数的估计更稳定。</p>
<h2 id="第1案例简单线性回归">第1案例：简单线性回归</h2>
<p>现在我们看一下前面的数据得到的直线回归方程是否成立，前面得到的线性回归方程如下所示：</p>
<p><span class="math inline">\(\hat{Y}=0.1392X + 1.667\)</span></p>
<h3 id="方差分析-1">方差分析</h3>
<p><span class="math inline">\(H_{0}:\beta=0\)</span>，即尿肌酐含量与年龄之间无直线关系。</p>
<p><span class="math inline">\(H_{1}:\beta \neq 0\)</span>，即尿肌酐含量与年龄之间有直线关系。</p>
<p><span class="math inline">\(\alpha=0.05\)</span></p>
<p>根据公式（九），可知<span class="math inline">\(SS_{回}=l^2_{XY}/l_{XX}=5.845^2/42=0.8134\)</span></p>
<p>根据公式（六），可知<span class="math inline">\(SS_{残}=SS_{总}-SS_{回}=1.0462-0.8134=0.2328\)</span></p>
<p>下面是方差分析表，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>变异来源</th>
<th>自由度</th>
<th>SS</th>
<th>MS</th>
<th>F</th>
<th>P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>变异来源</td>
<td>7</td>
<td>10462</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>回归</td>
<td>1</td>
<td>0.8134</td>
<td>0.8134</td>
<td>20.963</td>
<td>&lt;0.01</td>
</tr>
<tr class="odd">
<td>残差</td>
<td>6</td>
<td>0.2328</td>
<td>0.0388</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\nu_{1}=1\)</span>、<span class="math inline">\(\nu_{2}=6\)</span>，查F界值表，得P&lt;0.01，按<span class="math inline">\(\alpha=0.05\)</span>的检验水准，拒绝<span class="math inline">\(H_{0}\)</span>，接受<span class="math inline">\(H_{1}\)</span>，可以认为尿肌酐含量与年龄宰有直线关系。</p>
<p>在Ｒ对这个案例进行方差检验，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; anova(lm(cr~age))</div><div class="line">Analysis of Variance Table</div><div class="line"></div><div class="line">Response: cr</div><div class="line">          Df  Sum Sq Mean Sq F value   Pr(&gt;F)   </div><div class="line">age        1 0.81343 0.81343  20.968 0.003774 **</div><div class="line">Residuals  6 0.23276 0.03879                    </div><div class="line">---</div><div class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div></pre></td></tr></table></figure>
<h3 id="t检验-1">t检验</h3>
<p>t检验的<span class="math inline">\(H_{0}\)</span>、<span class="math inline">\({H_{1}}\)</span>与<span class="math inline">\(\alpha\)</span>同上，在这个案例中，n=8，<span class="math inline">\(SS_{残}=0.2328\)</span>、<span class="math inline">\(L_{XX}=42\)</span>，b=0.1392，根据公式（十），公式（十一），公式（十二），可得：</p>
<p><span class="math inline">\(S_{Y\cdot X}=\sqrt{\frac{0.2328}{8-2}}=0.1970\)</span>, S_{b}==0.0304$$</p>
<p><span class="math inline">\(t=\frac{0.1392}{0.0304}=4.579\)</span></p>
<p>由于<span class="math inline">\(\nu=6\)</span>，查t界值表可知，0.002&lt;P&lt;0.005，按照<span class="math inline">\(\alpha=0.05\)</span>的检验水准，拒绝<span class="math inline">\(H_{0}\)</span>，接受<span class="math inline">\(H_{1}\)</span>，可以认为尿肌酐含量与年龄间有直线关系。注意，在本例中，<span class="math inline">\(\sqrt{F}=\sqrt{20.97}=4.579=t\)</span>，实际上直线回归中对回归系数的t检验与F检验等价，类似于两样本均数比较可以作为t检验，也可以做方差分析。</p>
<p>这里要说明一下，两个变量关系的密切程度或数量上的影响大小的统计量是相关系数或者是另归系数的绝对值r，而不是假设检验的p值，p值越小，只能说越有理由认为变量间的直线关系存在，而不能说关系越密切或越“显著”。另外，直线回归用于预测时，其适用范围一般不应超出样本中自变量的取值范围，此时求得的预测值称内插（interpolation），而超过自变量取值范围所得预测值称为外延（extrapolation），若无充分理由说明现有自变量范围以外的两变量间仍然是直线关系，应尽量避免不合理的外延，举个例子，我们在使用BCA测蛋白浓度时，标准品的浓度范围是0-0.5ug/uL，我们构建的线性回归方程是<code>蛋白浓度=a X OD562 + b</code>，如果我们的样本OD562的吸光度超过了标准品最高浓度的OD562的值（例如标准品0.5ug/uL的OD562值是0.4，我的蛋白样本的OD562的值是0.45），那么此时，我们使用求出来的线性回归方程来计算蛋白样本中的蛋白浓度是不太准的。</p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; result &lt;- lm(cr~age)</div><div class="line">&gt; summary(result)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = cr ~ age)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">     Min       1Q   Median       3Q      Max </div><div class="line">-<span class="number">0.21500</span> -<span class="number">0.15937</span> -<span class="number">0.00125</span>  <span class="number">0.09583</span>  <span class="number">0.30667</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)   </div><div class="line">(Intercept)  <span class="number">1.66167</span>    <span class="number">0.29700</span>   <span class="number">5.595</span>  <span class="number">0.00139</span> **</div><div class="line">age          <span class="number">0.13917</span>    <span class="number">0.03039</span>   <span class="number">4.579</span>  <span class="number">0.00377</span> **</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">0.197</span> on <span class="number">6</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.7775</span>,	Adjusted R-squared:  <span class="number">0.7404</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">20.97</span> on <span class="number">1</span> and <span class="number">6</span> DF,  p-value: <span class="number">0.003774</span></div></pre></td></tr></table></figure>
<p>结果解释：</p>
<ol style="list-style-type: decimal">
<li><p>其中0.4.579是对系数（斜率）是否为零t的检验，t=4.579,p&lt;0.00377，表示斜率不为零，它的零假设为<span class="math inline">\(H_{0}:\beta=0\)</span>，而备选假设为<span class="math inline">\(H_{1}:\beta \neq 0\)</span>。</p></li>
<li><p>Residual standard error: 0.197 on 6 degrees of freedom，这个是残差，自由度为6</p></li>
<li><p>Multiple R-squared: 0.7775, Adjusted R-squared: 0.7404，R平方，叫测定系数或可决系数，越接近于1表示两者的线性关系越好。</p></li>
<li><p>F-statistic: 20.97 on 1 and 6 DF, p-value: 0.003774，F检验，p值小于0.01，在只一个自变量的情况下，F检验的p值与t检验的p值在数值上相等，并且F的值等于t值的平方。</p></li>
</ol>
<h3 id="总体回归系数beta的可信区间">总体回归系数<span class="math inline">\(\beta\)</span>的可信区间</h3>
<p>利用上述对回归系数的t检验，我们可以得到<span class="math inline">\(\beta\)</span>的<span class="math inline">\(1-\alpha\)</span>的置信区间为</p>
<p><span class="math inline">\(b\pm t_{\alpha/2,\nu}S_{b}\)</span> （公式十三）</p>
<p>根据前面计算的结果，b=0.1392，<span class="math inline">\(S_{b}=0.0304\)</span>，按自由度为6，查t界值表，得到t值为2.447，那么根据公式（十三），我们可以计算出<span class="math inline">\(\beta\)</span>的95%置信区间，如下所示：</p>
<p><span class="math inline">\((0.1392-2.447 \times0.0304,0.1392+2.447 \times0.0304)\)</span></p>
<p>即<span class="math inline">\((0.0648,0.2136)\)</span>，需要注意的是，这个区间不包括0，可按<span class="math inline">\(\alpha=0.05\)</span>水准同样得到总体回归系数不为0的结论，即用区间估计回答相同<span class="math inline">\(\alpha\)</span>时的假设检验问题。</p>
<h3 id="利用回归方程进行估计和预测">利用回归方程进行估计和预测</h3>
<h4 id="总体均数mu_yx的可信区间">总体均数<span class="math inline">\(\mu_{Y|X}\)</span>的可信区间</h4>
<p>给定X的数值<span class="math inline">\(X_{0}\)</span>，由样本回归方程计算出的<span class="math inline">\(\hat{Y}\)</span>只是相应总体均数<span class="math inline">\(\mu_{Y|X}\)</span>的一个点估计，<span class="math inline">\(\hat{Y}_{0}\)</span>会因样本而异，存在抽样误差，反映其抽样误差的标准误按以下公式计算：</p>
<p><span class="math inline">\(S_{\hat{Y}_{0}}=S_{Y\cdot X}\sqrt{\frac{1}{n}-\frac{(X_{0}-\bar{X})^2}{\sum(X-\bar{X})^2}}\)</span>（公式十四）</p>
<p><span class="math inline">\(\hat{Y}\)</span>的标准误与回归的剩余标准差<span class="math inline">\(S_{Y\cdot X}\)</span>成正比，当<span class="math inline">\(X_{0}=\bar{X}\)</span>时，达到其最小值<span class="math inline">\(S_{Y\cdot X}/\sqrt{n}\)</span>，<span class="math inline">\(X_{0}\)</span>离<span class="math inline">\(\bar{X}\)</span>越远，其标准误<span class="math inline">\(S_{\hat{Y}_{0}}\)</span>越大，给定<span class="math inline">\(X=X_{0}\)</span>时，总体均数<span class="math inline">\(\nu_{Y|X_{0}}\)</span>的<span class="math inline">\(1-\alpha\)</span>的置信区间为</p>
<p><span class="math inline">\(\hat{Y}_{0}\pm t_{\alpha/2,\nu},S_{\hat{Y}_{0}}\)</span>（公式十五）</p>
<p>在直角坐标系占，（公式十五）表示一条中间窄，两端宽的带子，如下所示图中的两条实曲线所示，其中最窄处对应<span class="math inline">\(X_{0}=\bar{X}\)</span>，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/fk66iDA0I7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在R中，可以生成上述图形，由于没有用于预测的数据集，因此，只能生成一条回归直线与自变量的置信区间，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p&lt;-ggplot(data001,aes(x=age, y=cr))+geom_point()+geom_smooth(method=<span class="string">"lm"</span>)</div><div class="line">p+scale_x_continuous(breaks=seq(<span class="number">6</span>,<span class="number">14</span>,<span class="number">1</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180830/ke0JFHGJ60.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中划线是拟合的回归曲线，灰色的部分是自变量的置信区间。</p>
<h4 id="个体y值的预测区间">个体Y值的预测区间</h4>
<p>预测应时把自变量X代入到回归方程，对总体中的应变量量Y的个体值进行预测，给定X的数值<span class="math inline">\(X_{0}\)</span>，对应的个体Y值也存在一个波动范围，其标准差<span class="math inline">\(S_{Y_{0}}\)</span>按公式十六计算，如下所示：</p>
<p><span class="math inline">\(S_{Y_{0}}=S_{Y\cdot X} \sqrt{1+\frac{1}{n}+\frac{(X_{0}-\bar{X})^2}{\sum(X-\bar{X})^2}}\)</span>（公式十六）</p>
<p>于是给定<span class="math inline">\(X=X_{0}\)</span>时，个体Y值的<span class="math inline">\(1-\alpha\)</span>的预测区间为</p>
<p><span class="math display">\[\hat{Y_{0}}\pm t_{\alpha/2,\nu} S_{Y_{0}}\]</span>（公式十七）</p>
<p>在上图中，有两条虚曲线，这两条虚曲线比实曲线范围更宽，它也是中间窄，两头宽，同样在<span class="math inline">\(X_{0}=\bar{X}\)</span>处最窄。</p>
<p>需要注意的是，在给定<span class="math inline">\(X=X_{0}\)</span>处，相应Y的均数的置信区间与其个体Y值的预测区间的含义是不同的：前者表示在固定的<span class="math inline">\(X_{0}\)</span>处，如果反复抽样100次，可以算出100个相应Y的总体均数的置信区间，平均有100x(1-<span class="math inline">\(\alpha\)</span>)个置信区间包含总体均数；后者表示的是一个预测值的取值范围，即预测100个个体值中平均将有100x(1-<span class="math inline">\(\alpha\)</span>)个个体值在求出的范围内。</p>
<p>现在我们用这个案例中所求的直线回归方程，计算当<span class="math inline">\(X_{0}=12\)</span>时，<span class="math inline">\(\nu_{Y|X_{0}}\)</span>的95%置信区间和相应个体Y值的95%预测区间，前面我们知道，这个方程为<span class="math inline">\(\hat{Y}=0.1392X + 1.667\)</span>，另外还知道<span class="math inline">\(\bar{X}=9.5,l_{XX}=42\)</span>，面还计算出了<span class="math inline">\(S_{Y\cdot X}=0.1970\)</span>，当<span class="math inline">\(X_{0}=12\)</span>时，<span class="math inline">\(\hat{Y}=1.6617+0.1392\times 12=3.3321\)</span>，根据公式十四和公式十六可得：</p>
<p><span class="math inline">\(S_{\hat{Y_{0}}}=0.1970\sqrt{\frac{1}{8}+\frac{(12-9.5)^2}{42}}=0.1031\)</span></p>
<p><span class="math inline">\(S_{Y_{0}}=0.1970\sqrt{1+\frac{1}{8}+\frac{(12-9.5)^2}{42}}=0.2223\)</span></p>
<p>查表可知<span class="math inline">\(t_{0.05/2,6}=2.447\)</span>，因此按公式十五可知，当<span class="math inline">\(X_{0}=12\)</span>时，尿肌酐含量总体均数的95%置信区间为：</p>
<p><span class="math inline">\((3.3321-2.447\times 0.1031,3.3321+2.447\times 0.1031)=(3.080,3.584)\)</span></p>
<p>按公式十七，当<span class="math inline">\(X_{0}=12\)</span>时，尿肌酐含量个体值的95%预测区间为：</p>
<p><span class="math inline">\((3.3321-2.447\times 0.2223,3.3321+2.447\times 0.2223)=(2.788,3.876)\)</span></p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; data94 &lt;- data.frame(age=<span class="number">12</span>)</div><div class="line">&gt; predict(result,data94,interval=<span class="string">"prediction"</span>,level=<span class="number">0.95</span>) <span class="comment"># 预测区间</span></div><div class="line">       fit      lwr      upr</div><div class="line"><span class="number">1</span> <span class="number">3.331667</span> <span class="number">2.787731</span> <span class="number">3.875602</span></div><div class="line">&gt; predict(result,data94,interval=<span class="string">"confidence"</span>,level=<span class="number">0.95</span>) <span class="comment"># 均数的可信区间</span></div><div class="line">       fit      lwr      upr</div><div class="line"><span class="number">1</span> <span class="number">3.331667</span> <span class="number">3.079481</span> <span class="number">3.583852</span></div></pre></td></tr></table></figure>
<h2 id="第2个案例简单线性回归及诊断">第2个案例：简单线性回归及诊断</h2>
<p>在这个案例中，我们按照正常的直线加中归的流程计算一下，这个案例源于《医学统计学及SAS应用》（王炳顺）。</p>
<h3 id="案例描述">案例描述</h3>
<p>在研究某抗心律扮演药对电刺激狗右心室致颤阈的影响，实验测得狗静脉注射不同剂量心律扮演药与右心室致颤阈的数据如下表所示：</p>
<table>
<thead>
<tr class="header">
<th>药物剂量/(mg/kg)</th>
<th>1</th>
<th>3</th>
<th>5</th>
<th>7</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>阈值提高/V</td>
<td>8.03</td>
<td>14.97</td>
<td>19.23</td>
<td>27.83</td>
<td>36.23</td>
</tr>
</tbody>
</table>
<h3 id="第一步绘制散点图">第一步：绘制散点图</h3>
<p>线性回归的第一步通常是绘制两个变量的散点图，在绘制的散点图中，x值表示药的剂量，y轴表示的是阈值的提高值，最终计算出来的线性方程应该是y(阈值提高值)=bx(药物剂量)+a，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dose &lt;-c(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</div><div class="line">value&lt;-c(<span class="number">8.03</span>,<span class="number">14.97</span>,<span class="number">19.23</span>,<span class="number">27.83</span>,<span class="number">36.23</span>)</div><div class="line">drug_data &lt;- data.frame(dose,value)</div><div class="line">ggplot(drug_data,aes(x=dose,y=value))+ geom_point()</div></pre></td></tr></table></figure>
<p>散点图如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/C5JimCkfKc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="第二步估计回归系数">第二步：估计回归系数</h3>
<p>直接使用<code>lm()</code>函数即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lm.drug_data &lt;- lm(value~dose,data=drug_data)</div><div class="line">summary(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; lm.drug_data &lt;- lm(value~dose,data=drug_data)</div><div class="line">&gt; summary(lm.drug_data)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = value ~ dose, data = drug_data)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">     <span class="number">1</span>      <span class="number">2</span>      <span class="number">3</span>      <span class="number">4</span>      <span class="number">5</span> </div><div class="line"> <span class="number">0.624</span>  <span class="number">0.638</span> -<span class="number">2.028</span> -<span class="number">0.354</span>  <span class="number">1.120</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">(Intercept)   <span class="number">3.9430</span>     <span class="number">1.3151</span>   <span class="number">2.998</span> <span class="number">0.057748</span> .  </div><div class="line">dose          <span class="number">3.4630</span>     <span class="number">0.2289</span>  <span class="number">15.127</span> <span class="number">0.000627</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">1.448</span> on <span class="number">3</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.9871</span>,	Adjusted R-squared:  <span class="number">0.9827</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">228.8</span> on <span class="number">1</span> and <span class="number">3</span> DF,  p-value: <span class="number">0.0006272</span></div></pre></td></tr></table></figure>
<p>结果解释：</p>
<ol style="list-style-type: decimal">
<li>从结果中我们可以看出来，我们所求的方程y(阈值提高值)=bx(药物剂量)+a中，截矩a的值是3.9430，斜率b的值是3.4630。</li>
<li>R计算的结果中还有t检验的值，与相应的p值，我们可以发现，斜率b的t检验的值小于0.001，这个值是必须要小于0.01的，也就是说必须要显著性意义，而截矩的值，不用管它。</li>
<li>线性方程的自由度是3，残差的标准差为1.448。</li>
<li><span class="math inline">\(R^2\)</span>是0.9871，它表示药物的剂量可以解释98.71%的变异，后面的是调整R的平方值。</li>
<li>F统计量的值为228.8，它的两个自由度为1和3，p值为0.0006272。</li>
</ol>
<h3 id="第三步回归诊断">第三步：回归诊断</h3>
<p>回归诊断的内容主要有三个方面：</p>
<ol style="list-style-type: decimal">
<li>误差项是否满足独立性、等方差性和正态性，选择模型是否合适。</li>
<li>是否存在异常样本，回归分析的结果是否对某些样本依赖过重，即回归模型是否具备稳定性。</li>
<li>自变量之间是否存在高度相关，即是否有多重共线性问题存在。</li>
</ol>
<p>计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</div><div class="line">plot(lm.drug_data)</div></pre></td></tr></table></figure>
<p>图片结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/DI9h80a7Ba.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在解释一下这些图形：</p>
<p>第一张图（左上），残差图。在构建线性回归模型时，通常采用的是最小二乘法来估计回归系数，并在此基础上作进一步的推断，前文中对其应用条件已经有强调，例如应变量与自变量的关系为线性、误差服从均数为0的正态分布，且方差相等、各观测独立等。如果实际数据不满足这些假设而直接拿来做线性回归，那么就会得到专业上无法解释的导论，至少会影响回归估计的精度与假设检验的p值，对于这些条件的检查，较为简单有效的方法就是考虑回归的<strong>残差图（residual plot）</strong>。残差图一般是将现在有模型求出来的各点残差<span class="math inline">\(e_{i}=Y_{i}-\hat{Y_{i}}\)</span>作为纵坐标，相应的预测值<span class="math inline">\(\hat{Y}\)</span>或者自变量取值X作为横坐标来绘制的，如果数据符合模型的基本假设，那么残差与回归预测值的散点图基本上都是呈0的上下随机分布，而不是会表现出任何特殊的结构。在这张图形中，Residual vs fitted为拟合值y对残差的图形, 可以看出,数据点都基本均匀地分布在直线y=0的两侧, 无明显趋势，满足线性假设。</p>
<p>现在我们看一些比较异常的残差图，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/32JG4DCC2b.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中a图是正常的残差图，它的残差均匀地分布在0的上面侧，说明此数据用于拟合直线回归方程是恰当的。b图，是某农药厂工人全血胆碱酯酶活性Y与工龄X进行直线回归得到的残差图，其中可以发现有一个点的残差相对于其他的点大很多，这就是一个异常点，可以考虑删除或改用其他可减小离群点影响的回归分析方法。c图是锡克反应性率Y与1-3岁儿童年龄X之间经直线回归得到的残差图，图中的残差与回归预测值表现为曲线关系，提示在目前的直线回归模型中加入自变量的二次项可能改善拟合效果（原因书中没提到，我也不明白），d图为舒张压Y与女性儿童年龄X之间直线回归的残差图，图中的残差呈喇叭口形状，说明误差的方差不剂，应考虑某种对方差进行稳定化的处理，e图表示残差之间不独立，可以看到残差与各个观测的测量时间存在较强的相关。（医学统计学.第四版.孙振球）</p>
<p>第二张图（右上），当预测变量值固定时，因变量成正态分布，则残差图也应是一个均值为0的正态分布。正态Q-Q图是在正态颁对应的值上，标准化残差的概率图，若满足正态假设，则图上的点应该落在45度角的直线上，若不是，则违反了正态性假设。第二幅（右上），Normal QQ-plot图中数据点分布趋于一条直线, 说明残差是服从正态分布的，用于回归的自变量的标准化残差落在(-2，2)区间以外的概率要≤0.05，若某一自变量数值的标准化残差落在(-2，2)区间以外，可在95%置信度将其判为异常实验点，不参与回归直线拟合。</p>
<p>第三幅图位置尺度图（Scale-Location Graph）中，水平线周围的点应随机分布，Scale-Location 图显示了标准化残差(standardized residuals)的平方根的分布情况，最高点为残差最大值点。第三副图显示基本符合方差齐性的要求。</p>
<p>第四幅图（Residuals vs Leverage）提供了单个观测点的信息，从图中可以鉴别离群点、高高杆值点和强影响点，主要是通过Cook距离(Cook’s distance)显示各个点对回归的影响点</p>
<p>还可以使用<code>shapiro.test</code>函数对线性回归方程的残差正态性进行验证，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; shapiro.test(residuals(lm.drug_data))</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  residuals(lm.drug_data)</div><div class="line">W = <span class="number">0.86452</span>, p-value = <span class="number">0.2449</span></div></pre></td></tr></table></figure>
<p>正态性检验结果表明W值为0.86452，P值为0.2449，说明残差符合正态分布。</p>
<h4 id="有关残差图">有关残差图</h4>
<p>在构建线性回归模型时，通常采用的是最小二乘法来估计回归系数，并在此基础上作进一步的推断，前文中对其应用条件已经有强调，例如应变量与自变量的关系为线性、误差服从均数为0的正态分布，且方差相等、各观测独立等。如果实际数据不满足这些假设而直接拿来做线性回归，那么就会得到专业上无法解释的导论，至少会影响回归估计的精度与假设检验的p值，对于这些条件的检查，较为简单有效的方法就是考虑回归的残差图（residual plot）。</p>
<p>残差图一般是将现在有模型求出来的各点残差<span class="math inline">\(e_{i}=Y_{i}-\hat{Y_{i}}\)</span>作为纵坐标，相应的预测值<span class="math inline">\(\hat{Y}\)</span>或者自变量取值X作为横坐标来绘制的，如果数据符合模型的基本假设，那么残差与回归预测值的散点图基本上都是呈0的上下随机分布，而不是会表现出任何特殊的结构。</p>
<h4 id="独立性检验">独立性检验</h4>
<p>判断因变量（或残差）最好的方法时依据收集数据的方式的先验知识。lmtest包提供了dwtest检验函数，car包提供了Durbin-Watson检验的函数，都能够检验误差序列的相关性，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"lmtest"</span>)</div><div class="line"><span class="keyword">library</span>(lmtest)</div><div class="line">dwtest(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; dwtest(lm.drug_data)</div><div class="line"></div><div class="line">	Durbin-Watson test</div><div class="line"></div><div class="line">data:  lm.drug_data</div><div class="line">DW = <span class="number">1.9213</span>, p-value = <span class="number">0.1807</span></div><div class="line">alternative hypothesis: true autocorrelation is greater than <span class="number">0</span></div></pre></td></tr></table></figure>
<p>本例结果中DW值为1.9213，我不清楚这个p值的意义是什么，不过从网上的资料来看，DW值越接近于2，表示检验结果越理想。</p>
<p>另外一种独立性检验方法是使用car包中的<code>crPlots()</code>函数绘制<code>偏残差图(partial residual plot )</code>，也叫<code>成分残差图(component plus residual plot)</code>，来显示因变量与自变量之间是否呈非线性关系，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(car)</div><div class="line">crPlots(lm.drug_data)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/h09c1b02Bg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>car包中还有一个<code>linearHypothesis</code>函数用于线性假设检验，比图形更准，其中<code>dose=0</code>表示要检验自变量dose的系数是否为0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">linearHypothesis(lm.drug_data)</div></pre></td></tr></table></figure>
<p>P值小于0.05，可以认为x的系数不为0。</p>
<h4 id="方差齐性">方差齐性</h4>
<p>通过以因变量为x轴，学生化残差为y轴做残差图，进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(predict(lm.drug_data),rstudent(lm.drug_data))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/9BBLl8leIK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>所有的学生化残差均在<span class="math inline">\(\pm 2\)</span>的范围内波动，没有明显的上升或下降趋势，可以认为符合方差齐性。还通过自变量与残差绝对值的等级相关检验来判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"pspearman"</span>)</div><div class="line"><span class="keyword">library</span>(pspearman)</div><div class="line">spearman.test(dose,abs(residuals(lm.drug_data))) </div><div class="line"><span class="comment">#R中pspearman包中的spearman.</span></div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; spearman.test(dose,abs(residuals(lm.drug_data)))</div><div class="line"></div><div class="line">	Spearman<span class="string">'s rank correlation rho</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  dose and abs(residuals(lm.drug_data))</span></div><div class="line"><span class="string">S = 16, p-value = 0.7833</span></div><div class="line"><span class="string">alternative hypothesis: true rho is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">rho </span></div><div class="line"><span class="string">0.2</span></div></pre></td></tr></table></figure>
<p>自变量与残差绝对值的等级相关系数为0.2，P值大于0.05，无统计学意义，可以认为残差方差齐性。 car包提供了两个有用的函数，可判断误差方差是否恒定，<code>ncvTest()</code>函数生成一个计分检验，零假设为误差方差不变,备择假设为误差方差随着拟合值水平的变化而变化。若检验显著，择说明存在异方差性。<code>spreadLevelPlot()</code>函数创建一个添加了最佳拟合曲线的散点图，展示标准化残差绝对值与拟合值的关系，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; ncvTest(lm.drug_data)</div><div class="line">Non-constant Variance Score Test </div><div class="line">Variance formula: ~ fitted.values </div><div class="line">Chisquare = <span class="number">0.06629594</span>    Df = <span class="number">1</span>     p = <span class="number">0.7968083</span> </div><div class="line">&gt;spreadLevelPlot(lm.drug_data)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/FGkC4IJiE6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>计分检验结果不显著，说明满足方差齐性的假设。通过水平分布图，可以看到其中的点在水平的最佳拟合曲线周围呈水平随机分布。若违反了该假设，将会呈现一个非水平的曲线。</p>
<h4 id="线性模型假设的综合验证">线性模型假设的综合验证</h4>
<p>使用gvlma中的<code>gvlma()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"gvlma"</span>)</div><div class="line"><span class="keyword">library</span>(gvlma)</div><div class="line">gvlma(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; gvlma(lm.drug_data)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = value ~ dose, data = drug_data)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line">(Intercept)         dose  </div><div class="line">      <span class="number">3.943</span>        <span class="number">3.463</span>  </div><div class="line"></div><div class="line"></div><div class="line">ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS</div><div class="line">USING THE GLOBAL TEST ON <span class="number">4</span> DEGREES-OF-FREEDOM:</div><div class="line">Level of Significance =  <span class="number">0.05</span> </div><div class="line"></div><div class="line">Call:</div><div class="line"> gvlma(x = lm.drug_data) </div><div class="line"></div><div class="line">                     Value p-value                Decision</div><div class="line">Global Stat        <span class="number">3.84262</span> <span class="number">0.42772</span> Assumptions acceptable.</div><div class="line">Skewness           <span class="number">0.70287</span> <span class="number">0.40182</span> Assumptions acceptable.</div><div class="line">Kurtosis           <span class="number">0.08023</span> <span class="number">0.77698</span> Assumptions acceptable.</div><div class="line">Link Function      <span class="number">2.99322</span> <span class="number">0.08361</span> Assumptions acceptable.</div><div class="line">Heteroscedasticity <span class="number">0.06630</span> <span class="number">0.79681</span> Assumptions acceptable.</div></pre></td></tr></table></figure>
<p>Global Stat给模型假设提供了一个单独的综合检验（通过/不通过），本例中，可以看到数据满足线性回归模型所有的统计假设（P=0.7071）。同时还对偏度(Skewness)、峰度(Kurtosis)、连接函数(Link function)和异方差性(Heteroscedasticity)进行了评价。</p>
<h4 id="影响分析">影响分析</h4>
<p>是探查对估计有异常影响的数据，如果一个样本不服从某个模型，其余数据服从这个模型，则称该样本点为强影响点。影响分析就是区分这样的样本数据。</p>
<h4 id="离群点">离群点</h4>
<p>指那些模型预测效果不佳的观测点，通常有很大的、或正或负的残差，正残差说明模型低估了响应值，负残差说明高佑了响应值。 <code>outlierTest()</code>函数是根据单个最大（或正或负）残差值的显著性来判断是否有离群点，若不显著，则说明数据集中没有离群点，若显著，则必须删除该离群点，然后再检验是否还有其他离群点存在。qqPlot图中落在置信区间带外的点可被认为时离群点，本例中未发现有离群点。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">outlierTest(lm.drug_data) <span class="comment">#Bonferroni离群点检验</span></div><div class="line">No Studentized residuals with Bonferonni p &lt; <span class="number">0.05</span></div><div class="line">Largest |rstudent|:</div><div class="line">   rstudent unadjusted p-value Bonferonni p</div><div class="line"><span class="number">3</span> -<span class="number">2.992805</span>           <span class="number">0.095862</span>      <span class="number">0.47931</span></div></pre></td></tr></table></figure>
<p>绘制残差的QQ图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qqPlot(lm.drug_data,labels=row.names(df),id.method = <span class="string">"identify"</span>,simulate=<span class="literal">T</span>,main=<span class="string">"QQPlot"</span>) <span class="comment">#car包</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/GCCLfgcD53.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="高杠杆值点">高杠杆值点</h4>
<p>高杠杆值点是与其他预测变量有关的离群点，即它们是由许多异常的预测变量组合起来的，与响应变量值没有关系。 高杠杆值的观测点可通过帽子矩阵的值（hat statistic）判断。对于一个给定的数据集，帽子均值为p/n，其中p是模型估计的参数数目（包含截距项），n是样本量。一般来说，若观测点的帽子值大于帽子均值的2或3倍，则可认定为高杠杆值点。</p>
<h4 id="强影响点">强影响点</h4>
<p>强影响点，即对模型参数估计值影响有些比例失衡的点。例如，当移除 模型的一个观测点时模型会发生巨大的改变，那么需要检测一下数据中是否存在强影响点。Cook距离，或称为D统计量。Cook’s D值大于4/(n-k-1)，则表明它是强影响点，其中n为样本量大小，k是预测变量数目（有助于鉴别强影响点，但并不提供关于这些点如何影响模型的信息），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(lm.drug_data,which=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/m2Gf9D6Dd5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>car包中的influencePlot函数，可将离群点、杠杆点和强影响点的信息整合到一幅图形中，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">influencePlot(lm.drug_data)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/6FF70f4CIe.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>帽子统计量、DFFITS准测、Cook统计量和COVRATIO准则在R软件可分别通过hatvalues(),dffits(),cooks.distance()和covration()函数计算。influence.measures()可对一次获得这四个统计量的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; influence.measures(lm.drug_data)</div><div class="line">Influence measures of</div><div class="line">	 lm(formula = value ~ dose, data = drug_data) :</div><div class="line"></div><div class="line">   dfb.1_  dfb.dose  dffit  cov.r cook.d hat inf</div><div class="line"><span class="number">1</span>  <span class="number">0.7375</span> -<span class="number">6.05e-01</span>  <span class="number">0.741</span> <span class="number">4.0184</span> <span class="number">0.3483</span> <span class="number">0.6</span>   *</div><div class="line"><span class="number">2</span>  <span class="number">0.2673</span> -<span class="number">1.71e-01</span>  <span class="number">0.296</span> <span class="number">2.6474</span> <span class="number">0.0594</span> <span class="number">0.3</span>    </div><div class="line"><span class="number">3</span> -<span class="number">0.7368</span> -<span class="number">2.93e-16</span> -<span class="number">1.496</span> <span class="number">0.0937</span> <span class="number">0.3065</span> <span class="number">0.2</span>    </div><div class="line"><span class="number">4</span>  <span class="number">0.0159</span> -<span class="number">9.15e-02</span> -<span class="number">0.158</span> <span class="number">3.0339</span> <span class="number">0.0183</span> <span class="number">0.3</span>   *</div><div class="line"><span class="number">5</span> -<span class="number">0.7366</span>  <span class="number">1.41e+00</span>  <span class="number">1.727</span> <span class="number">1.4138</span> <span class="number">1.1220</span> <span class="number">0.6</span>   *</div></pre></td></tr></table></figure>
<p>纵坐标超过2或小于-2的值可被认为是离群点，水平轴超过0.2或0.3的值有高杠杆值（通常为预测值的组合）。圆圈大小与影响成比例，圆圈很大的点可能是对模型估计造成的不成比例影响的强影响点，influence.measures()的inf用星号标注异常值。</p>
<h2 id="多元线性回归">多元线性回归</h2>
<p>直线回归是研究一个应变量与单个自变量之间呈直线关系的一种统计方法。但是在医学研究中，许多疾病都有多种原因，而且预后也是多种因素决定的，如糖尿病患者的血糖变化可能受胰岛素、糖化血红蛋白、血清总胆固醇、甘油三酯等多种生化指标的影响，这个时候就需要研究多个因素对一个结果变量数量依存的线性关系以及多个因素之间的线性关系，这种关系就称为多元线性回归。例如如人体的体表现积随身高和体重而改变，则体表面积为应变量，身高和体重为自变量，设体表现为Y，身高和体重为X1和X2，则所建立的含有两个自变量二元回归方程为：</p>
<p><span class="math inline">\(\hat{y}=a+b_{1}x_{1}=b_{2}x_{2}\)</span></p>
<p>其中<span class="math inline">\(b_{1}\hat{y}\)</span>是y均数的估计值或预测值（predicted value，y hat），a为截距，表示各自变量取0时，y的估计值，<span class="math inline">\(b_{1}b_{2}\)</span>和<span class="math inline">\(b_{2}b_{1}\)</span>称为偏回归系数（partial regression coefficient），其中<span class="math inline">\(b_{1}\)</span>表示在体重的取值固定不变时，身高每增加一个单位，y估计值平均变化<span class="math inline">\(b_{1}\)</span>个单位；<span class="math inline">\(b{_2}\)</span>表示在身高的取值不变时，体重每增加一个单位，y估计值平均变化<span class="math inline">\(b_{2}\)</span>个单位。一般来讲，对于拟合一个应变量y和m个自变量<span class="math inline">\(x_{1},x_{2},\cdots,x_{m}\)</span>的多元回归方程，其形式为：</p>
<p><span class="math inline">\(\hat{y}=a+b_{1}x_{1}+b_{2}x_{2}+\cdots=b_{i}x_{i}+\cdots+b_{m}x_{m}\)</span></p>
<p>其中，a为截距，意义同上，<span class="math inline">\(b_{i}\)</span>为当其他自变量取值固定不变时，<span class="math inline">\(x_{i}\)</span>每增加一个单位，y的估计值平均变化<span class="math inline">\(b_{i}\)</span>个单位。</p>
<p>多元线性回归资料应满足以下条件：</p>
<ol style="list-style-type: decimal">
<li>自变量和应变量之间的关系是线性关系；</li>
<li>各观测单位相互独立；</li>
<li>残差服从正态分布；</li>
<li>残差满足方差齐性。</li>
</ol>
<h3 id="多元线性回归的原理">多元线性回归的原理</h3>
<p>对于多元回归方程的建立，也就是求出各常数项和各偏回归系数，原理还是使用最小二乘法来求各待估计系数，即根据观察到的n例数据，使残差平方和最小，即如下所示：</p>
<p><span class="math inline">\(Q=\sum_{k=1}^n(Y_{k}-\hat{Y_{k})^2}=\sum_{k=1}^n[Y_{k}-(b_{0}+b_{1}X_{1k}+b_{2}X_{2k}+\cdots=b_{m}X_{mk})]^2\)</span>（公式十八）</p>
<p>由此可以得到下面的方程组，求解得到<span class="math inline">\(b_{1},b_{2},\cdots,b_{m}\)</span>,并求出<span class="math inline">\(b_{0}\)</span>项，如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/j3B3I11b2c.png?imageslim" alt="mark"></p>
<p><span class="math inline">\(b_{0}\)</span>的计算如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/hm5EHFC0gI.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>这两个公式分别表示自变量的离均差平方和（i=j），两个自变量的离均差积和（<span class="math inline">\(i\neq j\)</span>）及自变量<span class="math inline">\(X_{j}\)</span>与应变量Y的离均差和和。</p>
<h3 id="多元线性回归的计算过程">多元线性回归的计算过程</h3>
<p>现在看一个案例：</p>
<p>27名糖尿病患者的血清总胆固醇、甘油三酯、空腹胰岛素、糖化血红蛋白、空腹血糖的测量值位于下表中，试建立血糖与其他几项指标的多元线性回归方程（《医学统计学》第四版.孙振球，第15章）。</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/aG3BEk29fH.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/abbIG27Ajm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第一步，由上表的数据，通过公式（二十一）和公式（二十二）计算出包括应变量在内的各变量离差矩阵，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180827/6JF868882m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>根据公式（十九）列出方程组求解后，可以得到：</p>
<p>b1=0.1424, b2=0.3515, b3=-0.2706, b4=0.6382</p>
<p>算得均数分别为：</p>
<p><span class="math inline">\(\bar{X_{1}}=5.8126,\quad \bar{X_{2}}=2.8407,\quad\bar{X_{3}}=6.1467,\quad\bar{X_{4}}=9.1185,\quad \bar{Y}=11.9259\)</span></p>
<p>根据公式（二十）可以计算出截矩，如下所示：</p>
<p><span class="math inline">\(b_{0}=11.9259-(0.1424 \times 5.8126+0.3515 \times 2.8407-0.2706 \times6.1467 +0.6382 \times9.1185)=5.9433\)</span></p>
<p>有了这几个系数与截矩，我们就可以得到线性回归方程，如下所示：</p>
<p><span class="math inline">\(\hat{Y}=5.9433+0.1424X_{1}+0.3515X_{2}+ -0.2706X_{3}+0.6382X_{4}\)</span></p>
<p>在R中计算多元线性回归方程与简单线性回归基本上类似，也是使用<code>lm()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mlr &lt;- read.table(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_1501.csv"</span>,header=<span class="literal">T</span>,sep=<span class="string">","</span>) <span class="comment"># 原始数据集</span></div><div class="line">mlr_result &lt;- lm(mlr$Y~mlr$X1+mlr$X2+mlr$X3+mlr$X4)</div><div class="line">summary(mlr_result)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; summary(mlr_result)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = mlr$Y ~ mlr$X1 + mlr$X2 + mlr$X3 + mlr$X4)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">    Min      1Q  Median      3Q     Max </div><div class="line">-<span class="number">3.6268</span> -<span class="number">1.2004</span> -<span class="number">0.2276</span>  <span class="number">1.5389</span>  <span class="number">4.4467</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)  </div><div class="line">(Intercept)   <span class="number">5.9433</span>     <span class="number">2.8286</span>   <span class="number">2.101</span>   <span class="number">0.0473</span> *</div><div class="line">mlr$X1        <span class="number">0.1424</span>     <span class="number">0.3657</span>   <span class="number">0.390</span>   <span class="number">0.7006</span>  </div><div class="line">mlr$X2        <span class="number">0.3515</span>     <span class="number">0.2042</span>   <span class="number">1.721</span>   <span class="number">0.0993</span> .</div><div class="line">mlr$X3       -<span class="number">0.2706</span>     <span class="number">0.1214</span>  -<span class="number">2.229</span>   <span class="number">0.0363</span> *</div><div class="line">mlr$X4        <span class="number">0.6382</span>     <span class="number">0.2433</span>   <span class="number">2.623</span>   <span class="number">0.0155</span> *</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">2.01</span> on <span class="number">22</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.6008</span>,	Adjusted R-squared:  <span class="number">0.5282</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">8.278</span> on <span class="number">4</span> and <span class="number">22</span> DF,  p-value: <span class="number">0.0003121</span></div></pre></td></tr></table></figure>
<p>从结果中可以看出来，截矩，X1，X2，X3，X4的偏回归系数分别为5.9433，0.1424，0.3515，-0.2706，0.6382，对回归的结果进行方差分析可以看出来，回归方程的系数的显著性不高, 有的没有通过检验，这说明如果选择全部变量构造方程, 效果并不好，这就涉及到变量选择的问题，以建立“最优”的回归方程。</p>
<p>如果先不考虑变量的筛选问题，那么我们计算得到的多元线性回归方程就是下面的这个样子：</p>
<p><span class="math inline">\(\hat{Y}=5.9433+0.1424X_{1}+0.3515X_{2}-0.2706X_{3}+0.6382X_{4}\)</span></p>
<h3 id="多元线性回归中变量的筛选">多元线性回归中变量的筛选</h3>
<p>在R中，进行“最优”回归方程的方法是“逐步回归法”的计算函数step( ),它是以Akaike信息统计量为准则(简称AIC准则), 通过选择最小的AIC信息统计量, 来达到删除或增加变量的目的。AIC的数值越小，就说明对变量的筛选效果越好，它的用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">step(object, scope, scale = <span class="number">0</span>,</div><div class="line">     direction = c(<span class="string">"both"</span>, <span class="string">"backward"</span>, <span class="string">"forward"</span>),</div><div class="line">     trace = <span class="number">1</span>, keep = <span class="literal">NULL</span>, steps = <span class="number">1000</span>, k = <span class="number">2</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中，object是线性模型或广义线性模型的结果，scope是确定逐步回归的搜索区域，direction确定逐步搜索的方向，both是一切子集回归法，backward是向后法，forward是向前法，默认值为both，现在使用<code>setp()</code>对上述的多元线性回归结果做逐步回归，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lm.step &lt;- step(mlr_result)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; lm.step &lt;- step(mlr_result)</div><div class="line">Start:  AIC=42.16</div><div class="line">mlr$Y ~ mlr$X1 + mlr$X2 + mlr$X3 + mlr$X4</div><div class="line"></div><div class="line">         Df Sum of Sq     RSS    AIC</div><div class="line">- mlr$X1  1    0.6129  89.454 40.343</div><div class="line">&lt;none&gt;                 88.841 42.157</div><div class="line">- mlr$X2  1   11.9627 100.804 43.568</div><div class="line">- mlr$X3  1   20.0635 108.905 45.655</div><div class="line">- mlr$X4  1   27.7939 116.635 47.507</div><div class="line"></div><div class="line">Step:  AIC=40.34</div><div class="line">mlr$Y ~ mlr$X2 + mlr$X3 + mlr$X4</div><div class="line"></div><div class="line">         Df Sum of Sq     RSS    AIC</div><div class="line">&lt;none&gt;                 89.454 40.343</div><div class="line">- mlr$X3  1    25.690 115.144 45.159</div><div class="line">- mlr$X2  1    26.530 115.984 45.356</div><div class="line">- mlr$X4  1    32.269 121.723 46.660</div></pre></td></tr></table></figure>
<p>结论: 用全部变量作回归方程时, AIC统计量的值为42.16,如果去掉变量X1，AIC统计量的值为40.34，如下去掉变量X2，AIC统计量的值为43.568，依次类推。由于去掉X1命名AIC统计量达到最小，因此R会自动掉变量X1，进入下一轮的计算，在下一轮中，无论去掉哪个变量，AIC的统计量的值均会升高，因此R会自动终止计算，得到“最优”回归方程，现在使用<code>summary()</code>提取相关回归信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">summary(lm.step)</div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Call:</span></div><div class="line"><span class="comment">#   lm(formula = mlr$Y ~ mlr$X2 + mlr$X3 + mlr$X4)</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Residuals:</span></div><div class="line"><span class="comment">#   Min      1Q  Median      3Q     Max </span></div><div class="line"><span class="comment"># -3.2692 -1.2305 -0.2023  1.4886  4.6570 </span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Coefficients:</span></div><div class="line"><span class="comment">#   Estimate Std. Error t value Pr(&gt;|t|)   </span></div><div class="line"><span class="comment"># (Intercept)   6.4996     2.3962   2.713  0.01242 * </span></div><div class="line"><span class="comment">#   mlr$X2        0.4023     0.1541   2.612  0.01559 * </span></div><div class="line"><span class="comment">#   mlr$X3       -0.2870     0.1117  -2.570  0.01712 * </span></div><div class="line"><span class="comment">#   mlr$X4        0.6632     0.2303   2.880  0.00845 **</span></div><div class="line"><span class="comment">#   ---</span></div><div class="line"><span class="comment">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Residual standard error: 1.972 on 23 degrees of freedom</span></div><div class="line"><span class="comment"># Multiple R-squared:  0.5981,	Adjusted R-squared:  0.5456 </span></div><div class="line"><span class="comment"># F-statistic: 11.41 on 3 and 23 DF,  p-value: 8.793e-05</span></div></pre></td></tr></table></figure>
<p>结论：从上面的结果我们可以看出来，回归系数的显著性水平有很大提高，每个自变量的检验均是显著的，𢅟得到了“最优”的回归方程，如下所示：</p>
<p><span class="math inline">\(\hat{Y}=6.4996+0.4023X_{2}-0.2870X_{3}+0.6632X_{4}\)</span></p>
<h3 id="回归诊断">回归诊断</h3>
<p>由样本数据得到回归方程后，为了确定回归方程及引入的自变量是否有统计学意义，必须进一步做假设检验。方差分析法可以将回归方程中所有自变量<span class="math inline">\(X_{1},X_{2},\cdots,X_{m}\)</span>作为一个整体来检验它们与应变量Y与之间是否具有线性关系，并对回归方程的预测或解释能力作出综合评价。在此基因上进一步对各变量的重要性作出评价。</p>
<h4 id="方差分析-2">方差分析</h4>
<h5 id="方差分析法原理">方差分析法原理</h5>
<p>在多元线性回归中，为什么要做方差分析呢，这是因为在线性回归中，把因变量的总变异，也就是因变量的所有观测值到其均值<span class="math inline">\(\bar{y}\)</span>的距离平方和（通常用SST）表示，分解成对应于各个自变量的若干平方和(SS,sum of squares)，每一个这样的平方和代表了一个自变量对总变异平方的贡献，剩下不能被自变量解释的，就是误差平方和或残差平方和(SSE,error sum of squares)，自变量及残差平方和所对应的平方和加起来等于因变量的总变异。</p>
<p>用简单的话来讲，就是方差分析表把由自变量所导致的因㸄的变化和误差所导致的因变量的变化找出来，并进行比较（通过F检验），如果这两个变化很不一样，那么则认为自变量在回归中的确显著影响了因变量，表示回归有道理，否则，没有理由认为因变量和误差有所不同。</p>
<p>具体来讲，如果我们有两个自变量，分别为A和B，则把SSt分解为对应于这两个自变量的两个平方和SSA，SSB以及残差平方和SSE，即SST=SSA+SSB+SSE。那么如果SSA与SSE相比较很显著，即变量A的贡献显著大于误差的贡献，则称变量A显著，否则，如果SSA和SSE的贡献差不多，那么变量A就不显著。这种显著需要正式的检验，如果前面关于误差的四个假定成立（回归模型的误差项独立，且服从正态分布），那么这些平方和（比如这里的SSA、SSB、SSE）都有<span class="math inline">\(\chi^2\)</span>分布（因为它们是正态分布变量的平方和），而除以各自的自由度之后，得到它们的平均（叫均方，mean square，记为MSA，MSB，MSE），根据F分布的定义，MSA/MSE和MSB/MSE都有F分布，如果MSA/MSE很大，那么A就是和残差相比显著，则相应的p值就小。</p>
<h5 id="方差分析法过程">方差分析法过程</h5>
<p>方程的假设检验如下所示：</p>
<p><span class="math inline">\(H_{0}:\beta_{1}=\beta_{2}=\cdots=\beta_{m}=0\)</span></p>
<p><span class="math inline">\(H_{1}\)</span>各<span class="math inline">\(\beta_{j}(j=1,2,\cdots,m)\)</span>不全为0</p>
<p>将应变量Y的总变异分解成两部分，即如下所示：</p>
<p><span class="math inline">\(\sum(Y-\bar{Y})^2=\sum(\hat{Y}-\bar{Y})+\sum(Y-\hat{Y})^2\)</span></p>
<p>其中<span class="math inline">\(\sum(Y-\bar{Y})^2\)</span> 是回归平方和，$(Y-)^2是残差平方和，上式可记作：</p>
<p><span class="math inline">\(SS_{总}=SS_{回}+SS_{残}\)</span></p>
<p>其中，回归平方和可用下式计算：</p>
<p><span class="math inline">\(SS_{回}=b_{1}l_{1Y}+b_{1}l_{2Y}+\cdots+b_{m}l_{mY}=\sum b_{j}l_{jY}\)</span></p>
<p>残差平方和为：<span class="math inline">\(SS_{残}=SS_{总}-SS_{回}\)</span></p>
<p>用统计量F检验假设<span class="math inline">\(H_{0}\)</span>是否成立，如下所示：</p>
<p><span class="math inline">\(F=\frac{SS_{回}/m}{SS_{残}/(n-m-1)}=\frac{MS_{回}}{MS_{残}}\)</span></p>
<p>方差分析见下表：</p>
<table>
<thead>
<tr class="header">
<th>变异来源</th>
<th>自由度</th>
<th>SS</th>
<th>MS</th>
<th>F</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>总变异</td>
<td>n-1</td>
<td>SS总</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>回归</td>
<td>m</td>
<td>SS回</td>
<td>SS回/m</td>
<td>MS回/MS残</td>
</tr>
<tr class="odd">
<td>残差</td>
<td>n-m-1</td>
<td>SS残</td>
<td>SS残/(n-m-1)</td>
<td></td>
</tr>
</tbody>
</table>
<p>如果<span class="math inline">\(F\geq F_{\alpha,(m,n-m-1)}\)</span>，则在α水准上拒绝H0，接受H1，认为应变量Y与m个自变量<span class="math inline">\(X_{1},X_{2},\cdots,X_{m}\)</span>之间存在线性回归关系。现在我们从刚才的多元线性回归方程中计算各部分的变异：</p>
<p>SS总=222.5519</p>
<p>SS回=0.1424×67.6962+0.3515×89.8025+0.2706×142.4337+0.6382×84.5570=133.7107</p>
<p>SS残=222.5519-133.7107</p>
<p>方差分析的结果如下表所示：</p>
<table>
<thead>
<tr class="header">
<th>变异来源</th>
<th>自由度</th>
<th>SS</th>
<th>MS</th>
<th>F</th>
<th>P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>总变异</td>
<td>26</td>
<td>222.5519</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>回归</td>
<td>3</td>
<td>133.0978</td>
<td>44.36593</td>
<td>11.4</td>
<td>&lt;0.01</td>
</tr>
<tr class="odd">
<td>残差</td>
<td>23</td>
<td>89.4541</td>
<td>3.89</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>查F界值表可知，<span class="math inline">\(F_{0.01,(3,23)}=4.76\)</span>，F&gt;4.76，P&lt;0.01，在α=0.05检验水准上，拒绝H0，接受H1，认为所拟合的回归方程具有统计学意义。</p>
<p>注，在R中查找相应F值的函数为<code>qf()</code>，用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qf(p, df1, df2, ncp, lower.tail = <span class="literal">TRUE</span>, log.p = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>使用我要查找在0.01水平上，两个自由度为3和23的F值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">qf(<span class="number">0.99</span>,<span class="number">3</span>,<span class="number">23</span>)</div><div class="line"><span class="comment"># [1] 4.764877</span></div></pre></td></tr></table></figure>
<p>在R中，可以通过<code>anova()</code>来查看多元线性回归的方差分析结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">mlr_result2 &lt;- lm(mlr$Y~mlr$X2+mlr$X3+mlr$X4)</div><div class="line"><span class="comment"># 使用x2,x3,x4变量做多元线性回归</span></div><div class="line"></div><div class="line">summary(mlr_result2)</div><div class="line"><span class="comment"># 查看计算结果</span></div><div class="line"><span class="comment"># Call:</span></div><div class="line"><span class="comment">#   lm(formula = mlr$Y ~ mlr$X2 + mlr$X3 + mlr$X4)</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Residuals:</span></div><div class="line"><span class="comment">#   Min      1Q  Median      3Q     Max </span></div><div class="line"><span class="comment"># -3.2692 -1.2305 -0.2023  1.4886  4.6570 </span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Coefficients:</span></div><div class="line"><span class="comment">#   Estimate Std. Error t value Pr(&gt;|t|)   </span></div><div class="line"><span class="comment"># (Intercept)   6.4996     2.3962   2.713  0.01242 * </span></div><div class="line"><span class="comment">#   mlr$X2        0.4023     0.1541   2.612  0.01559 * </span></div><div class="line"><span class="comment">#   mlr$X3       -0.2870     0.1117  -2.570  0.01712 * </span></div><div class="line"><span class="comment">#   mlr$X4        0.6632     0.2303   2.880  0.00845 **</span></div><div class="line"><span class="comment">#   ---</span></div><div class="line"><span class="comment">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Residual standard error: 1.972 on 23 degrees of freedom</span></div><div class="line"><span class="comment"># Multiple R-squared:  0.5981,	Adjusted R-squared:  0.5456 </span></div><div class="line"><span class="comment"># F-statistic: 11.41 on 3 and 23 DF,  p-value: 8.793e-05</span></div><div class="line"></div><div class="line">aov_result &lt;- anova(mlr_result2)</div><div class="line">aov_result</div><div class="line"><span class="comment"># Analysis of Variance Table</span></div><div class="line"><span class="comment"># </span></div><div class="line"><span class="comment"># Response: mlr$Y</span></div><div class="line"><span class="comment"># Df Sum Sq Mean Sq F value   Pr(&gt;F)   </span></div><div class="line"><span class="comment"># mlr$X2     1 46.787  46.787 12.0297 0.002082 **</span></div><div class="line"><span class="comment">#   mlr$X3     1 54.042  54.042 13.8950 0.001104 **</span></div><div class="line"><span class="comment">#   mlr$X4     1 32.269  32.269  8.2968 0.008447 **</span></div><div class="line"><span class="comment">#   Residuals 23 89.454   3.889                    </span></div><div class="line"><span class="comment"># ---</span></div><div class="line"><span class="comment">#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line">sum(aov_result$`Sum Sq`)</div><div class="line"><span class="comment"># SS总</span></div><div class="line"><span class="comment"># [1] 222.5519</span></div><div class="line">sum(aov_result$`Sum Sq`)-aov_result$`Sum Sq`[<span class="number">4</span>]</div><div class="line"><span class="comment"># SS回归</span></div><div class="line"><span class="comment"># [1] 133.0978</span></div><div class="line"><span class="number">222.5519</span>-<span class="number">133.0978</span></div><div class="line"><span class="comment"># SS残</span></div><div class="line"><span class="number">89.4541</span></div></pre></td></tr></table></figure>
<h5 id="决定系数r2">决定系数<span class="math inline">\(R^2\)</span></h5>
<p>根据方差分析的结果，还可以得到多元线性回归的决定系数<span class="math inline">\(R^2​\)</span>，它的计算公式如下所示：</p>
<p><span class="math inline">\(R^2=\frac{SS_{回}}{SS_{总}}=1-\frac{SS_{残}}{SS_{总}}\)</span></p>
<p>从上面的结果可以看出来<span class="math inline">\(R^2=0.5981\)</span>，这个数字从前面的方差分析结果中也能看出来，即<code>Multiple R-squared:  0.5981</code>。这个数字表明，血糖含量变量的58%可由甘油三脂(X2)、胰岛素(X3)、糖化血红蛋白(X4)的变化来解释。</p>
<h5 id="复相关系数">复相关系数</h5>
<p><span class="math inline">\(R=\sqrt{R^2}\)</span>称为复相关系数（multiple correlation coefficient），可用来度量应变量Y与多个自变量的线性相关程度，亦即观察值Y与估计值<span class="math inline">\(\hat{Y}\)</span>之间的相关程度，在这个案例中，复相关系数<span class="math inline">\(R=\sqrt{0.5981}=0.7734\)</span>，如果只有一个自变量时，<span class="math inline">\(R=|r|\)</span>，r为简单相关系数。</p>
<h4 id="t检验-2">t检验</h4>
<p>方差分析和决定系数是将所有自变量<span class="math inline">\(X_{1},X_{2},\cdots,X_{m}\)</span>作为一个整体来检验和说明它们与Y的相关程度及解释能力的，并未指明方程中的每一个自变量对Y的影响如何，但是在医学研究中，我们往往更加关心是对各自变量的解释。对每一自变量的作用进行检验和称量它们对Y的作用大小，可以采用偏回归平方和法，t检验法，标准化回归系数法。</p>
<p>而在R中的，通常采用的是t检验法，在前面的多元线性回归中，我们就可以看到这个t检验法的结果，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Coefficients:</div><div class="line">#   Estimate Std. Error t value Pr(&gt;|t|)   </div><div class="line"># (Intercept)   6.4996     2.3962   2.713  0.01242 * </div><div class="line">#   mlr$X2        0.4023     0.1541   2.612  0.01559 * </div><div class="line">#   mlr$X3       -0.2870     0.1117  -2.570  0.01712 * </div><div class="line">#   mlr$X4        0.6632     0.2303   2.880  0.00845 **</div></pre></td></tr></table></figure>
<p>根据t界值表，我们可以发现，剔除了X1变量后，剩下的变量的p值都小于0.05（在R中，一个星号表示大于0.01，小于0.05）,说明这些变量有统计学意义，对于同一资料而言，不同自变量的t值间可以相互比较，t的绝对值越大，说明该自变量对Y的回归所起的作用越大。</p>
<h4 id="残差分析">残差分析</h4>
<p>残差分析是检查资料是否符合模型条件的一个有用的工具。如果资料与模型的假设偏离较大，最小二乘估计、假设检验及区间估计则有可能出现问题。绘制多元线性回归的残差图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</div><div class="line">plot(mlr_result2)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180906/ciJ3K3BclA.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h4 id="共线性诊断">共线性诊断</h4>
<p>共线性问题是指拟合多元线性回归时，自变量之间存在线性关系或氛这线性关系，自变量之间的线性关系将会隐藏变量的显著性，增加参数估计的误差，还会产生一个很不稳定的模型，因此共线性诊断就是要找出哪些变量之间存在共线性关系，共线性诊断的方法主要有特征值法，条件指数法，方差膨胀因子法。具体的原理可以参考相应的统计学书籍，例如《R语言与统计分析》（汤银才），这里只说一种方法，即方差膨胀因子法，使用的函数为car包中的<code>vif()</code>，VIF的全称是Variance Inflation Factor，即方差膨胀因子，一般原则下，如果VIF值大于4就表明存在多重共线性问题，它的使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(car)</div><div class="line">vif(mlr_result2)</div><div class="line"><span class="comment"># mlr$X2   mlr$X3   mlr$X4 </span></div><div class="line"><span class="comment"># 1.051763 1.123518 1.178342</span></div></pre></td></tr></table></figure>
<p>从结果我们可以看出，这几个变量的VIF值都没有大于4，因此不存在多重共线性问题。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>孙振球. 医学统计学.第4版[M]. 人民卫生出版社, 2014.</li>
<li>DawnGriffiths. 深入浅出统计学[M]. 电子工业出版社, 2012.</li>
<li>王炳顺. 医学统计学及SAS应用[J]. 2007.</li>
<li>王斌会. 多元统计分析及R语言建模[M]. 暨南大学出版社, 2010.</li>
<li>汤银才. R语言与统计分析[M]. 高等教育出版社, 2008.</li>
<li>卡巴科弗. R语言实战[M]. 人民邮电出版社, 2016.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/06/BioStatistics/生物统计-08卡方分析与卡方分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/06/BioStatistics/生物统计-08卡方分析与卡方分布/" itemprop="url">卡方分布与卡方检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T12:02:00+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9,772
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  38
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是卡方分析">什么是卡方分析</h2>
<h3 id="第1个案例">第1个案例</h3>
<p>先看一个案例，这个案例会告诉我们什么是卡方分析，这个案例源于《深入浅出统计学》。</p>
<p>某个赌场遇到了一个问题，也就是赌场的老虎机总是出头奖，轮盘总是停在12位，这样赌客就很容易赢钱，如果再这么下赌下去，赌场撑不住，赌场的老板怀疑有人在老虎机上动了手脚，此时就来研究，老虎机是否被动了手脚。下面是某台老虎机的期望概率分布，其中X代表每一局游戏的净收益，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>x</th>
<th>-2</th>
<th>23</th>
<th>48</th>
<th>73</th>
<th>98</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>P(X=x)</td>
<td>0.977</td>
<td>0.008</td>
<td>0.008</td>
<td>0.006</td>
<td>0.001</td>
</tr>
</tbody>
</table>
<p>其中-2表示，每局的赌注是2美元，如果你没赢的话，你就损失2美元。现在赌场收集了一些统计数据，给出了人们获得某种收益的次数，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>x</th>
<th>-2</th>
<th>23</th>
<th>48</th>
<th>73</th>
<th>98</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>频数</td>
<td>965</td>
<td>10</td>
<td>9</td>
<td>9</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>现在我们要将每个x值的实际频数与根据概率分布得出的期望频数进行比较，此时时我们定义观察的频数为1000，现在用1000分别乘以概率分布，得到期望频数，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>x</th>
<th>观察频数</th>
<th>期望频数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-2</td>
<td>965</td>
<td>977</td>
</tr>
<tr class="even">
<td>23</td>
<td>10</td>
<td>8</td>
</tr>
<tr class="odd">
<td>48</td>
<td>9</td>
<td>8</td>
</tr>
<tr class="even">
<td>73</td>
<td>9</td>
<td>6</td>
</tr>
<tr class="odd">
<td>98</td>
<td>7</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>从这个表中我们可以知道，观察频数与期望频数有差别，但是这种差异有多，我们并不清楚。因此我们需要进行某种假设检验，以检验观察频数和期望频数之间的差别，这样我们就能够判定：老虎机被人动过手脚。现在的问题就是，我们使用哪种分布进行这项假设检验？</p>
<p>答案就是使用卡方检验来评估差异，卡方分布通过一个检验统计量来比较<strong>期望结果</strong>和<strong>实际结果</strong>之间的差别，然后得出观察频数极值的发生概率。</p>
<p>现在我们先来求一下检验统计量，为此，首先画出一张表，填入相应问题的观察频数和期望频数，然后，用观察频数和期望频数计算下列统计量，其中O代表观察频数，E代表期望频数，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/jJKlBFh99K.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>也就是说，对于概率分布中的每一个概率，取期望频数和实际频数的差，求差的平方数，再除以期望频数，最后将结果相加，现在我们求一下老虎机问题的检验统计量是多少。</p>
<p>计算过程如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/HF4mC0jL48.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>如果<span class="math inline">\(\chi^2\)</span>的值很小，说明观察频数和期望频数之间的差别不显著，卡方越大，差别越显著。</p>
<p>再回到卡方分析的统计量上，检验统计量<span class="math inline">\(\chi^2\)</span>提供了一种对观察频数和期望频数之间的差异进行量度的办法，<span class="math inline">\(\chi^2\)</span>的数值越小，观察频数和期望频数之间的总差值越小。除数E为期望频数，于是所得的结果与期望频数成反比，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/9JeiIj8Hjk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><span class="math inline">\(\chi^2\)</span>大到什么程度才算得上显著呢？此处先不做解答，现在先了解一下卡方分布。</p>
<h2 id="卡方分布简介">卡方分布简介</h2>
<p>卡方分布是由正态分布推导出来的分布，它的定义为，n个独立标准正态变量的平方和称为有n个自由度的<span class="math inline">\(\chi^2\)</span>分布，记为<span class="math inline">\(\chi^2(n)\)</span>，<span class="math inline">\(\chi^2(n)\)</span>的总体均值为n，总体方差为2n（不知道这是如何推导出来的）。</p>
<p>此外，若干个独立的卡方分布变量的和也能构成卡方方分布，其自由度等于那些卡方分布自由度之和，卡方分布也是一族分布，由该族成员的不同自由度来区分，由于上方分布是正态变量的平方和，因此，它不会取负值（《从数据到结论》吴喜之 ）。</p>
<p>现在再看一下卡方分析的简介。</p>
<h2 id="卡方分析简介">卡方分析简介</h2>
<p>两个样本率的比较通常是使用<span class="math inline">\(\chi^2\)</span>检验（Chi-square test）。<span class="math inline">\(\chi^2\)</span>检验是以<span class="math inline">\(\chi^2\)</span>分布为理论依据，用途广泛的假设检验方法，卡方分析用于比较不同组之间的构成比，它的零假设是假定各组之间的构成是相同的，计算出理论每组的理论构成比，再计算理论值与实际值的差别，如果差别大的话，就拒绝零假设。它用于推断两个总体率或构成比之间有无差别、多个总体率或构成比之间有无差别、多个样品率间的多重比较、两个分类变量之间有无关联性、多维列联表的分析和频数分页拟合优度的<span class="math inline">\(\chi^2\)</span>检验，它的扩展分析方法有Fisher精确分析，Ridit分析，CMH分析。</p>
<h2 id="卡方分布用途">卡方分布用途</h2>
<p>卡方分布的两个主要用途。卡方概率分布主要用于检查实际结果与期望结果之间何时存在显著差别，该概率分布使用前前面讲到的检验统计量<span class="math inline">\(\chi^2\)</span>进行检验。卡方分布主要有两个用途。</p>
<p>第一用于检验拟合优度，也就是可以检验一组给定的数据与指定分布的吻合程度。例如，可以用它检验老虎机收益的观察频率与我们所期望的分布的吻合程度。<span class="math inline">\(\chi^2\)</span>分布的另一个用途是检验两个变量的独立性，通过这个方法可以检查变量之间是否存在某种关联。<span class="math inline">\(\chi^2\)</span>分布用到一个参数，即希腊字母<span class="math inline">\(\nu\)</span>，读作“纽”，下面是可以看一下<span class="math inline">\(\nu\)</span>如何影响概率分布的形状。</p>
<h2 id="卡方分布的概率密度曲线">卡方分布的概率密度曲线</h2>
<p>卡方分布（Chi-square distribution）是一种连续型分布，<span class="math inline">\(\chi^2\)</span>分布只有一个参数，即自由度<span class="math inline">\(\nu\)</span>。按<span class="math inline">\(\chi^2\)</span>分布的密度函数<span class="math inline">\(f(\chi^2)\)</span>可以给出自由度<span class="math inline">\(\nu=1,2,3,\dots\)</span>的一簇<span class="math inline">\(\chi^2\)</span>分布曲线，由<span class="math inline">\(\chi^2\)</span>分布曲线可见，<span class="math inline">\(\chi^2\)</span>分布的形状依赖于自由度<span class="math inline">\(\nu\)</span>的大小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(seq(0,15,length = 1000)) </div><div class="line">#生成从0到10之间的1000个数字</div><div class="line"></div><div class="line">y1 &lt;- dchisq(x,1) </div><div class="line"># 生成对x的卡方密度值，自由度为1</div><div class="line"></div><div class="line">y2 &lt;- dchisq(x,2) </div><div class="line"># 生成对x的卡方密度值，自由度为1</div><div class="line"></div><div class="line">y6 &lt;- dchisq(x,6) </div><div class="line"># 生成对x的卡方密度值，自由度为6</div><div class="line"></div><div class="line">y10 &lt;- dchisq(x,10) </div><div class="line"># 生成对x的卡方密度值，自由度为10</div><div class="line"></div><div class="line">plot(x,y1,type = &quot;l&quot;, ylim = c(0,0.5),xlim=c(0,15),xlab=&quot;&quot;, ylab=&quot;&quot;, lty = 1, main = expression(paste(chi^2,&quot;Distribution&quot;)))</div><div class="line"># type =&quot;l&quot;表示绘制线，如果是n则不绘线；lty=1表示绘制实线</div><div class="line"></div><div class="line">lines(x,y2, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty =2) </div><div class="line"></div><div class="line">lines(x,y6, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty =2) </div><div class="line"># lty=2表示绘制虚线lines(x,y10, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty= 3) # lty=3表示绘制点线</div><div class="line"></div><div class="line">lines(x,y10, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty= 3) # lty=3表示绘制点线</div><div class="line"></div><div class="line">text(0.2,0.3, c(expression(chi^2*(1))))</div><div class="line">text(1.9,0.3, c(expression(chi^2*(2))))</div><div class="line">text(4,0.15, c(expression(chi^2*(6))))</div><div class="line">text(8,0.11, c(expression(chi^2*(10))))</div></pre></td></tr></table></figure>
<p>图片如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/E3EJ5Cc1lb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<ol style="list-style-type: decimal">
<li>当自由度<span class="math inline">\(\nu \leq 2\)</span>时，曲线呈L形，也就是一条先高后低的平滑曲线，检验统计量等于较小的数值的概率远远高于等于较大数值的概率，这就是说，观察频数有可能接近期望频数；</li>
<li>当<span class="math inline">\(\nu&gt;2\)</span>时，卡方分布的曲线就会表现出先低后高，再低的特征，其外形沿着正向扭曲，但是当，随着<span class="math inline">\(\nu\)</span>的增加，曲线逐渐趋于对称；</li>
<li>当自由度<span class="math inline">\(\nu \rightarrow \infty\)</span>时，<span class="math inline">\(\chi^2\)</span>分布趋于正态分布。</li>
</ol>
<p>卡方分布的一个基本性质是它的可加性；如果两个独立的随机变量<span class="math inline">\(X_{1}\)</span>和<span class="math inline">\(X_{2}\)</span>分别服从自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(\nu_{2}\)</span>的<span class="math inline">\(\chi^2\)</span>分布，则它们的和<span class="math inline">\(X_{1}+X_{2}\)</span>服从自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(nu_{2}\)</span>的<span class="math inline">\(\chi^2\)</span>分布，即<span class="math inline">\(X_{1}+X_{2}~\chi^2_{\nu1+\nu2}\)</span>.</p>
<p>如果使用具有特定参数<span class="math inline">\(\nu\)</span>的<span class="math inline">\(\chi^2\)</span>分布以及检验统计量<span class="math inline">\({X}^2\)</span>，可以简单记为如下形式：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/331G7A5ABh.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><span class="math inline">\(\chi^2\)</span>分布的界值：当自由度<span class="math inline">\(\nu\)</span>确定后，<span class="math inline">\(\chi^2\)</span>分布曲线下右侧尾部的面积为<span class="math inline">\(\alpha\)</span>时，横轴上相应的<span class="math inline">\(\chi^2\)</span>值记为<span class="math inline">\(\chi^2_{\alpha,\nu}\)</span>，即<span class="math inline">\(\chi^2\)</span>分布的界值。<span class="math inline">\(\chi^2\)</span>值越大，p值越小，反之，<span class="math inline">\(\chi^2\)</span>值越小，界值越大。</p>
<h2 id="卡方分析的显著性">卡方分析的显著性</h2>
<p>现在回答前面的那个问题，即检验统计量<span class="math inline">\(\chi^2\)</span>大到什么程度才算得上显著呢？</p>
<p>这要取决于显著性水平，用卡方分布进行的检验为单尾检验，右尾被称作拒绝域，于是，通过查看检验统计量是否位于右尾的拒绝域内，就可以判定根据期望分布得出目前结果的可能性，如果用显著性水平<span class="math inline">\(\alpha\)</span>进行检验，就写为<span class="math inline">\(\chi^2_{\alpha}(\nu)\)</span>，在以前没有计算机的时候，通常是使用卡方概率表来计算卡方分布的拒绝域，下面先讲一下如何使用卡方概率表，理解了这个，就方便理解软件的计算结果。</p>
<p>为了求出临界值，首选找出自由度<span class="math inline">\(\nu\)</span>以及显著性水平<span class="math inline">\(\alpha\)</span>，在第一列查找<span class="math inline">\(\nu\)</span>，第一行查找<span class="math inline">\(\alpha\)</span>，交点即x值，从<span class="math inline">\(P(\chi^2\alpha(\nu) \geq(x)=\alpha\)</span>中得出临界值。</p>
<p>以5%为显著性水平，8为自由度进行检验，若要得到临界值，那么在第一列查找8，第一行查找0.05，查出数值为15.51，因此只要统计量<span class="math inline">\(\chi^2\)</span>大于15.51，则在显著性水平为5%，自由度为8的情况下，检验统计量就位于拒绝域以内，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/5492jhlcga.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>我们在前面通过卡方分析计算过老虎机的理论期望频数与实际频数的卡方值是38.272，它的值大于15.51，也就是位于拒绝域内，因为我们可以判定，老虎机做了手脚，事实上，我们还在前面使用了R来计算这个卡方值，结论也是，p值远小于0.05，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- c(<span class="number">0.977</span>,<span class="number">0.008</span>,<span class="number">0.008</span>,<span class="number">0.006</span>,<span class="number">0.001</span>)  <span class="comment"># 期望概率</span></div><div class="line">x &lt;- c(<span class="number">965</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">7</span>) <span class="comment"># 实际的频数</span></div><div class="line">chisq.test(x,p=p)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- c(<span class="number">0.977</span>,<span class="number">0.008</span>,<span class="number">0.008</span>,<span class="number">0.006</span>,<span class="number">0.001</span>) </div><div class="line">&gt; x &lt;- c(<span class="number">965</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">7</span>) </div><div class="line">&gt; chisq.test(x,p=p)</div><div class="line"></div><div class="line">        Chi-squared test <span class="keyword">for</span> given probabilities</div><div class="line"></div><div class="line">data:  x</div><div class="line">X-squared = <span class="number">38.272</span>, df = <span class="number">4</span>, p-value = <span class="number">9.845e-08</span></div><div class="line"></div><div class="line">Warning message:</div><div class="line">In chisq.test(x, p = p) : Chi-squared近似算法有可能不准</div></pre></td></tr></table></figure>
<p>结果显示，卡方值为38.272，自由度为4，p值远小于0.01。</p>
<h2 id="卡方分析的假设检验步骤">卡方分析的假设检验步骤</h2>
<p>利用卡方分布进行假设检验的步骤与其他方法进行假设检验的步骤基本上一样，包括哪下步好：</p>
<ol style="list-style-type: decimal">
<li>确定进行检验的假设及其备选假设；</li>
<li>求出期望频数和自由度；</li>
<li>确定用于决策的拒绝域；</li>
<li>计算检验统计量<span class="math inline">\(\chi^2\)</span>；</li>
<li>查看检验统计量是否位于拒绝域以内；</li>
<li>作出决策。</li>
</ol>
<h3 id="第2个案例">第2个案例</h3>
<p>再看一个案例，这个案例还是来源于《深入浅出统计学》，案例是这个样子的：</p>
<p>赌场中的某个赌桌上的骰子有问题，赌场老板列出了这个股子的观察频数，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>数值</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>频数</td>
<td>107</td>
<td>198</td>
<td>192</td>
<td>125</td>
<td>132</td>
<td>248</td>
</tr>
</tbody>
</table>
<p>现在我们要计算一下，这个股子到底有没有问题，我们按照卡方检验的步骤来进行。</p>
<p>第一步：决定要进行检验的假设和备选假设。</p>
<p>H0（假设）：骰子没问题，每一面数值出现的概率都相同，也就是1/6。</p>
<p>H1（备选假设）：骰子有问题。</p>
<p>第二步：求出期望频数和自由度。</p>
<p>根据上面的数据，我们知道，所有的观察频数相加为1002，现在我们计算一下理论上每个面出现的频数，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>x</th>
<th>观察频数</th>
<th>期望频数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>107</td>
<td>167</td>
</tr>
<tr class="even">
<td>2</td>
<td>198</td>
<td>167</td>
</tr>
<tr class="odd">
<td>3</td>
<td>192</td>
<td>167</td>
</tr>
<tr class="even">
<td>4</td>
<td>125</td>
<td>167</td>
</tr>
<tr class="odd">
<td>5</td>
<td>132</td>
<td>167</td>
</tr>
<tr class="even">
<td>6</td>
<td>248</td>
<td>167</td>
</tr>
</tbody>
</table>
<p>自由度为5，这个很好理解，6个期望频数，总和为1002，即我们必须求出6个信息，同时受到1个限制，因此<span class="math inline">\(\nu\)</span>=6-1=5.</p>
<p>第三：确定用于做决策的拒绝域。</p>
<p>从概率表中可以查出<span class="math inline">\(\chi^2_{1\%}(5)=15.09\)</span>，那么拒绝域为<span class="math inline">\(\chi^2&gt;15.09\)</span>的范围。</p>
<p>第四：计算检验统计量<span class="math inline">\(\chi^2\)</span>，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/IGJ82gdH3b.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第五：查提检验统计量是否位于拒绝域以内</p>
<p>拒绝域由<span class="math inline">\(\chi^2&gt;15.09\)</span>决定，由于我们计算出来的<span class="math inline">\(\chi^2=88.24\)</span>，因此检验统计量位于拉拒绝域内。</p>
<p>第六：做出决策。</p>
<p>由于我们计算出来的检验统计量位于拒绝域内，因此说明在显著性水平为1%的情况下，有足够的证据拒绝原假设，于是我们接受备选假设，骰子有问题。</p>
<p>现在用R来过计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- c(<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>) </div><div class="line">&gt; x &lt;- c(<span class="number">107</span>,<span class="number">198</span>,<span class="number">192</span>,<span class="number">125</span>,<span class="number">132</span>,<span class="number">248</span>) </div><div class="line">&gt; chisq.test(x,p=p)</div><div class="line"></div><div class="line">        Chi-squared test <span class="keyword">for</span> given probabilities</div><div class="line"></div><div class="line">data:  x</div><div class="line">X-squared = <span class="number">88.24</span>, df = <span class="number">5</span>, p-value &lt; <span class="number">2.2e-16</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们可以发现，卡方分析不仅能够比较两个率的大小，还能计算出理论频数与实际频数的差异，实际上，这就是<code>拟合优度（Goodness of Fit）</code>的思想，即看实际值与理论值（预测值）的差异有多大，在不同的场合下，拟合优度有不同的用处，例如，在组间比较时，通过比较实际值与理论值的差异大小，做出是否有统计学差异的结论；在模型评价中，根据实际值与模型值的差异大小，判断模型是否很好地拟合了数据；在判断数据是否服从某一分布时，根据其理论分布与实际数据的差异做出判断，等等。</p>
<p>以下是其他的一些案例练习。</p>
<h2 id="四格表资料的chi2检验">四格表资料的<span class="math inline">\(\chi^2\)</span>检验</h2>
<h3 id="案例1">案例1</h3>
<p>某医院欲比较异梨醇口服液（试验组）和氢氯噻嗪+地塞米松（对照组）降低颅内压的疗效。将200例颅内压增高症患者随机分为两组，结果见表7-1。问两组降低颅内压的总体有效率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验 例7-1，P96）</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi02.png"> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data71&lt;-matrix(c(99,75,5,21),nr = 2,dimnames = list(c(&quot;试验组&quot;, &quot;对照组&quot;),c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">data71</div></pre></td></tr></table></figure></p>
<p>数据的四格表如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi03.png"></p>
<p>这张图里的四个数是该表的基本数据，其余的数据都是由这4个基本数据推算出来的，称为<code>四格表（fourfold table）</code>资料。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chi &lt;- chisq.test(data71)</div><div class="line">chi$expected #　显示理论数</div></pre></td></tr></table></figure>
<p>理论数如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi04.png"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data71,correct=<span class="literal">F</span>) </div><div class="line"><span class="comment"># correct = F表示不进行Yates连续性校正</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi05.png">

</div>
<p>结果：卡方值为12.8571，p值= 0.0003362小于0.01，按sig = 0.01的水准，拒绝原假设，接受备用假设，可以认为异山梨醇口服液降低颅内压的有效率高于氢氯噻嗪+地塞米松的有效率。这个结果与SAS计算的结果相同。R语言中默认的卡方检验是进行Yates连续性校正，因此上题中进行检验时，要加入correct=F。</p>
<h2 id="四格表资料的fisher确切概率法">四格表资料的Fisher确切概率法</h2>
<p>四格表中的计数资料的实际频数都是分类资料，是不连续的，因此计算出的卡方值都是离散型分布，而卡方界值表的依据是卡方分布，卡方分布是连续分布，因此在实际工作中，对于四格表资料，需要进行Yates校正，其规则如下： 1. 当<span class="math inline">\(n\geq 40\)</span>，且所有的<span class="math inline">\(T\geq 5\)</span>时，用卡方检验的基本公式。 2. 当<span class="math inline">\(n\geq 40\)</span>，但有<span class="math inline">\(1\leq T \geq 5\)</span>时，用校正公式，或改用四格表资料的Fisher确切概率法。 3. 当<span class="math inline">\(n\leq 40\)</span>，或<span class="math inline">\(T \leq 1\)</span>时，用四格表资料的Fisher确切概率法。</p>
<h3 id="案例2">案例2</h3>
<p>某医师欲比较胞磷胆碱与神经节苷酯治疗脑血管疾病的疗效，将78例脑血管疾病患者随机分为两组，结果见表7-2。问两种药物治疗脑血管疾病的有效率是否有差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-2）</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi06.png">

</div>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">data72&lt;-matrix(c(<span class="number">46</span>,<span class="number">18</span>,<span class="number">6</span>,<span class="number">8</span>),</div><div class="line">               nr = <span class="number">2</span>,</div><div class="line">               dimnames = list(c(<span class="string">"胞磷胆碱"</span>,<span class="string">"神经节苷脂"</span>),c(<span class="string">"有效"</span>,<span class="string">"无效"</span>)))</div><div class="line">chisq.test(data72,correct=<span class="literal">F</span>) <span class="comment"># 不进行Yates校正的结果</span></div><div class="line"></div><div class="line">chisq.test(data72,correct=<span class="literal">T</span>) <span class="comment"># 进行Yates校正的结果</span></div><div class="line"></div><div class="line"><span class="comment"># 这个结果与下面的结果一样</span></div><div class="line"><span class="comment"># 因为R中进行卡方检验时是默认进行Yates连续性校正的</span></div><div class="line">chisq.test(data72)</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi07.png"></p>
<p>不校正的情况下，卡方值为4.35，p值为0.03695小于0.05，进行卡方连续性校正的情况下，卡方值为3.1448,p=0.07617。校正与不校正得出的结果在0.05附近，因此下结论要谨慎。</p>
<h2 id="配对四格表卡方检验">配对四格表卡方检验</h2>
<h3 id="案例3">案例3</h3>
<p>某实验室分别用乳胶凝集法和免疫荧光法对58名可疑系统红斑狼疮患者血清中抗核抗体进行测定，结果见表7-3。问两种方法的检测结果有无差别？（《医学统计学》第三版，孙振球，第七章 卡方检验，例7-3）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">data73&lt;-matrix(c(11,2,12,33),</div><div class="line">               nr = 2,dimnames = list(c(&quot;+&quot;, &quot;-&quot;),c(&quot;+&quot;, &quot;-&quot;)))</div><div class="line"></div><div class="line">library(epiR) # 载入epiR包，使用其中的epi.kappa函数</div><div class="line"></div><div class="line">mcnemar.test(data73) # 配对检验</div><div class="line"></div><div class="line">chisq.test(data73)$expect</div><div class="line"></div><div class="line">epi.kappa(data73)$kappa </div><div class="line"># 一致性检验，即考察这两个方法在检验方面是否吻合</div><div class="line"></div><div class="line"># 或者使用vcd包中的Kappa</div><div class="line">library(vcd)</div><div class="line">Kappa(data73)</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi08.png"></p>
<p>结果分析：McNemar配对卡方检验的p值为0.01616,在0.05水平上，有显著性差异，免疫荧光法的总体阳性检出率要高于乳胶凝集法。</p>
<p>Kappa检验结果的p值小于0.01，估计值为0.455，说明两种方法的吻合度有统计学意义，但吻合度一般。</p>
<p>简单来说，McNemar检验是比较两种方法A与B对同一个对象的检验是否有差异，判断哪种方法比较好，比较容易检验出来结果。而Kappa检验就是比较A与B这两种方法检验出来的结果是不是一致的。在有些配对案例中可能会出现A的方法优于B，但A与B检验的结果不一致的情况。</p>
<h2 id="四格表精确fisher检验">四格表精确Fisher检验</h2>
<h3 id="案例4">案例4:</h3>
<p>某医师为研究乙肝免疫球蛋白预防胎儿宫内感染HBV的效果，将33例HBsAg阳性孕妇随机分为预防注射组和非预防组，结果见表7-4。问两组新生儿的HBV总体感染率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-4)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">data74&lt;-matrix(c(4,5,18,6),nr = 2,</div><div class="line">               dimnames = list(c(&quot;预防注射组&quot;, </div><div class="line">                                 &quot;非预防组&quot;),c(&quot;阳性&quot;, &quot;阴性&quot;)))</div><div class="line">chi&lt;-chisq.test(data74) </div><div class="line"># 理论频数小于5的情况，这里用Yates连续校正，</div><div class="line"># 默认的就是，不用添加correct = T</div><div class="line"></div><div class="line">chi$expected </div><div class="line"># 查看理论频数，有小于5的情况</div><div class="line"></div><div class="line">fisher.test(data74)</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi09.png"></p>
<h3 id="案例5">案例5:</h3>
<p>某单位研究胆囊腺癌、腺瘤的P53基因表达，对同期手术切除的胆囊腺癌、腺瘤标本各10份，用免疫组化法检测P53基因，资料见表7-6。问胆囊腺癌和胆囊腺瘤的P53基因表达阳性率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-5）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data75&lt;-matrix(c(6,1,4,9),nr = 2,</div><div class="line">               dimnames = list(c(&quot;胆囊腺癌&quot;, &quot;胆囊腺瘤&quot;),</div><div class="line">                               c(&quot;阳性&quot;, &quot;阴性&quot;)))</div><div class="line"></div><div class="line">fisher.test(data75)</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi10.png"></p>
<h2 id="无序rc列表">无序R×C列表</h2>
<h3 id="案例6列与行的数目都大于2">案例6:列与行的数目都大于2</h3>
<p>无序R×C列表这种情况是行、列都无序，并且行与列的数目都大于2，例如： 某医师研究物理疗法、药物治疗和外用膏药三种疗法治疗周围性面神经麻痹的疗效，资料见表7-8。问三种疗法的有效率有无差别（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-6）？ 如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi11.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data76&lt;-matrix(c(199,164,118,7,18,26),</div><div class="line">               nr = 3,dimnames = list(c(&quot;物理疗法组&quot;, &quot;药物治疗组&quot;,&quot;外用膏药组&quot;),</div><div class="line">                                      c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">chi.result &lt;- chisq.test(data76)</div><div class="line">chi.result # 查看卡方分析结果</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi12.png"></p>
<h2 id="双向无序rc列表的卡方检验">双向无序R×C列表的卡方检验</h2>
<h3 id="案例7">案例7:</h3>
<p>某医师在研究血管紧张素I转化酶(ACE)基因I/D多态与2型糖尿病肾病(DN)的关系时，将249例2型糖尿病患者按有无糖尿病肾病分为两组，资料见表7-9，问两组2型糖尿病患者的ACE基因型总体分布有无差别（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-7）？ <img src="http://ortxpw68f.bkt.clouddn.com/chi13.png"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">data77 &lt;- matrix(c(<span class="number">42</span>,<span class="number">30</span>,<span class="number">48</span>,<span class="number">72</span>,<span class="number">21</span>,<span class="number">36</span>),</div><div class="line">                 nrow=<span class="number">2</span>,dimnames=list(c(<span class="string">"DN组"</span>,<span class="string">"无DN组"</span>),</div><div class="line">                                      c(<span class="string">"DD"</span>,<span class="string">"ID"</span>,<span class="string">"II"</span>)))</div><div class="line">chi.result77 &lt;- chisq.test(data77)</div><div class="line">chi.result77$expected</div><div class="line">chi.result77</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi14.png"></p>
<h2 id="双向无序rc列表的关联性检验">双向无序R×C列表的关联性检验</h2>
<h3 id="案例8">案例8</h3>
<p>测得某地5801人的ABO血型和MN血型结果如表7-10，问两种血型系统之间是否有关联？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-8）</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi15.png">

</div>
<p>没有找到关于Pearson列联系数的函数，手工计算如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">data78 &lt;- matrix(c(431,388,495,137,490,410,587,179,902,800,950,32),nrow=4,dimnames=list(c(&quot;O&quot;,&quot;A&quot;,&quot;B&quot;,&quot;AB&quot;),</div><div class="line">                                                                                        c(&quot;M&quot;,&quot;N&quot;,&quot;MN&quot;)))</div><div class="line">chi.result &lt;- chisq.test(data78)</div><div class="line">chi.result</div><div class="line"></div><div class="line">sqrt(chi.result$statistic/(sum(data78)+chi.result$statistic)) # 列联系数</div><div class="line"></div><div class="line"># 根据手工计算结果，可以构建一个计算Pearson列联系数的自定义函数，如下所示：</div><div class="line"></div><div class="line">Pearson_Continuity &lt;- function(x)&#123;</div><div class="line">  chisq_result &lt;- chisq.test(x)$statistic </div><div class="line">  # 提取计算的卡方值</div><div class="line">  Pcoc &lt;- sqrt(chisq_result/(sum(x)+chisq_result))</div><div class="line">  print.noquote(&quot;Persaon列联系数&quot;) </div><div class="line"># print.noquote的作用是显示字符，不带引号，</div><div class="line"># 而print则是带引号</div><div class="line">  return(as.numeric(Pcoc))&#125;</div><div class="line"></div><div class="line">Pearson_Continuity(data78)</div></pre></td></tr></table></figure></p>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi16.png"></p>
<h2 id="两两比较所有组进行两两比较">两两比较——所有组进行两两比较</h2>
<p>当对所有组进行两两比较时，通常采用的方法是Bonferroni法，此方法对原有的检验水平进行调整，即原有的检验水平α除以比较次数得到调整后的检验水平。书本（《医学统计学》第三版，孙振球，P122）中的公式在分母中加了1，不清楚为什么，没有提出采用的是Bonferroni法。而另外两本参考书，即《医学统计学》第6版，马斌荣，P91与《医学统计学》第6版，颜虹，2010年，P155这两本书中所用到的两两比较的方法是Bonferroni法，在下面的题目中使用Bonferroni法。</p>
<h3 id="案例9">案例9</h3>
<p>对例7-6中的资料进行两两比较，以推断是否任两种疗法治疗周围性面神经麻痹的有效率均有差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-9）</p>
<p>例7-6中共有三组疗法，需要两两比较的次数是3次，因此检验水平是0.05/3=0.0167。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data76&lt;-matrix(c(199,164,118,7,18,26),</div><div class="line">               nr = 3,</div><div class="line">               dimnames = list(c(&quot;物理疗法组&quot;, &quot;药物治疗组&quot;,&quot;外用膏药组&quot;),</div><div class="line">                               c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">chisq.test(data76[1:2,],correct=F) </div><div class="line"># 比较物理疗法组与药物治疗组，</div><div class="line"># R中默认四格表进行了Yates校正，</div><div class="line"># 此处设为F，不进行校正，因为实际值与观测值都大于5</div></pre></td></tr></table></figure>
<p>结果如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/chi17.png"></p>
<p>从结果可以看出物理疗法组与药物治疗组有统计学差异。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[2:3,], correct=F)</div><div class="line">#比较药物治疗组与外用膏药组</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi18.png"> 从结果来看，药物治疗组与外用膏药组无统计学上的差异。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[-2,],correct=F)</div><div class="line"># 比较物理疗法组与外用膏药组</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi19.png">

</div>
<p>从结果来看，物理疗法组与外用膏药组有统计学上的差异。</p>
<h2 id="两两比较各个实验组与一个对照组进行比较">两两比较——各个实验组与一个对照组进行比较</h2>
<p>两两比较——各个实验组与一个对照组进行比较 当用各个实验组与一个对照组分别进行比较时，需要对检验水平α进行校正，即α/(k-1),其中k是组别。在此案例中，组别k=3,因此，调整后的检验水平=0.05/(3-2)=0.025。</p>
<h3 id="案例10">案例10:</h3>
<p>以表7-8资料中的药物治疗组为对照组，物理疗法组与外用膏药组为试验组，试分析两试验组与对照组的总体有效率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-10）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[1:2,],correct=F) </div><div class="line">#比较物理疗法组与药物治疗组</div><div class="line"></div><div class="line">chisq.test(data76[2:3,], correct=F) </div><div class="line">#比较药物治疗组与外用膏药组</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi20.png">

</div>
<p>第一个结果显示，P=0.009343小于0.025，表明物理疗法组与药物治疗组有统计学意义 第二个结果显示，P=0.03214大于0.025，表明药物治疗组与外用膏药组无统计学意义。</p>
<p>如果不使用校正p值的这种方法，可以使用其它的R包来进行两两比较，其中要用到的R包是<code>rcompanion</code>。现在使用这个包来进行两两比较，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"rcompanion"</span>)</div><div class="line"><span class="keyword">library</span>(rcompanion)</div><div class="line">data76&lt;-matrix(c(<span class="number">199</span>,<span class="number">164</span>,<span class="number">118</span>,<span class="number">7</span>,<span class="number">18</span>,<span class="number">26</span>),</div><div class="line">               nr = <span class="number">3</span>,</div><div class="line">               dimnames = list(c(<span class="string">"物理疗法组"</span>, <span class="string">"药物治疗组"</span>,<span class="string">"外用膏药组"</span>),</div><div class="line">                               c(<span class="string">"有效"</span>, <span class="string">"无效"</span>))</div><div class="line"></div><div class="line">pairwiseNominalIndependence(data76,</div><div class="line">                            fisher = <span class="literal">FALSE</span>,</div><div class="line">                            gtest  = <span class="literal">FALSE</span>,</div><div class="line">                            chisq  = <span class="literal">TRUE</span>,</div><div class="line">                            method = <span class="string">"fdr"</span>,)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">               Comparison  p.Chisq p.adj.Chisq</div><div class="line"><span class="number">1</span> 物理疗法组 : 药物治疗组 <span class="number">1.68e-02</span>    <span class="number">0.025200</span></div><div class="line"><span class="number">2</span> 物理疗法组 : 外用膏药组 <span class="number">9.34e-06</span>    <span class="number">0.000028</span></div><div class="line"><span class="number">3</span> 药物治疗组 : 外用膏药组 <span class="number">4.78e-02</span>    <span class="number">0.047800</span></div></pre></td></tr></table></figure>
<h2 id="单向rc列联表分析列有序">单向R×C列联表分析——列有序</h2>
<h3 id="案例11">案例11</h3>
<p>某公司研制一种治疗风湿性关节炎的中药，选择试验组和对照组各60例，试验组服用新药，对照组服用常规药物。以中医证侯疗效为主要疗效指标，分为无效、有效、显效、痊愈四个等级。治疗两个疗程后，两组的疗效情况如表5.4所示（略，见代码），欲分析两种药物的疗效是否有差异（《医学案例统计分析与SAS应用》第五章例5.4，冯国双，北京大学医学出版社，2010:93）。</p>
<h3 id="第一种方法ridit分析">第一种方法：Ridit分析</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data54 &lt;- c(33,18,24,31,1,9,2,2)</div><div class="line">data54m &lt;- matrix(data54,nrow=2,</div><div class="line">                  dimnames=list(c(&quot;对照组&quot;,&quot;实验组&quot;),</div><div class="line">                                c(&quot;无效&quot;,&quot;有效&quot;,&quot;显效&quot;,&quot;痊愈&quot;)))</div><div class="line">data54m</div><div class="line"></div><div class="line">#从数据来看，列变量，即无效、有效、显效、痊愈这四个等级是有序的，</div><div class="line"># 即越来越好，而行变量，对照组与实验组，这是无效的，适合采用Ridit分析：</div><div class="line"></div><div class="line">library(Ridit)</div><div class="line">ridit(data54m,1) </div><div class="line"># 函数ridit的参数中1表示分组信息是行，即行是无序的，列是有序的，</div><div class="line"># 如果是2，则表示分组信息在列，即列是无序的，行是有序的</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi21.png"> ### 第二种方法：CMH分析</p>
<p>用CMH也能进行RC列联表的单向有序分析，CMHtest函数在vcdExtra包中，需要载入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(vcdExtra)</div><div class="line">CMHtest(data54m)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi22.png">

</div>
<p>CMH的单向有序分析参见第3行，即cmeans，这一行表示列有序，行无序的分析结果。</p>
<h2 id="双向有序rc列联表分析-cmh检验">双向有序R×C列联表分析-CMH检验</h2>
<p>对于双向有序的RC列联表进行分析，常用于CMH检验，卡方检验常用于分类变量资料的一种假设检验，该法主要用于两个或多个样本率的比较，也可以用于两变量间的关联分析、频属分析的拟合优度检验等。CMH检验是在1959年提出的mh统计方法的基础上提出来的，1988年才发展完善，现在习惯上称之为扩展的MH卡方检验。他们的主要区别在于，如果用同样的方法做同样的实验，由于实验的地点不同，若将这些不同地点的实验数据简单合并后有卡方检验，会参杂很多混杂因素，这会使检验结果产生很大的偏差—主要是由不同实验的点的软、硬条件不同造成的。采用CMH检验可以解决这类问题，采用的是多中心或分层分析方法，多用R×C列联表的分层统计处理1。此外，CMH还应用于双向有序的RC列联表的分析。如下所示：</p>
<h3 id="案例12">案例12</h3>
<p>某研究者欲研究年龄与冠状动脉粥样硬化等级之间的关系，将278例尸解资料整理成表7-13，问年龄与冠状动脉粥样硬化等级之间是否存在线性变化趋势？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-9）</p>
<h4 id="第一种方法">第一种方法：</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">library(vcdExtra) </div><div class="line"># 载入vcdExtra包</div><div class="line">data711 &lt;- matrix(c(70,27,16,9,22,24,23,20,4,9,13,15,2,3,7,14),nrow=4)</div><div class="line">dimnames(data711) &lt;- list(age=c(&quot;20~&quot;,&quot;30~&quot;,&quot;40~&quot;,&quot;≥50&quot;),degree=c(&quot;-&quot;,&quot;+&quot;,&quot;++&quot;,&quot;+++&quot;))</div><div class="line">CMHtest(data711) # 分析数据</div><div class="line">chisq.test(data711)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi23.png">

</div>
<h4 id="第二种方法">第二种方法：</h4>
<p>通过coin包中的lbl_test函数也能进行CMH双向有序表的计算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(coin)</div><div class="line">data711t &lt;- as.table(data711)</div><div class="line">lbl_test(data711t,scores=list(age=c(1,2,3,4),degree=c(1,2,3,4)))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi24.png">

</div>
<p>其中，scores是各个有序变量的得分，与教材中相同。</p>
<h4 id="第三种方法">第三种方法：</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(reshape2)</div><div class="line">datax &lt;- melt(data711)</div><div class="line">datax$age &lt;- factor(datax$age,order=T)</div><div class="line">datax$degree &lt;- factor(datax$degree,order=T)</div><div class="line">CMHtest(xtabs(value~age+degree,data=datax))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi25.png">

</div>
<p>结果解读：(1)第1行的cor指的是行与列都为有序变量时的结果，即教材中的线性回归分量，为63.389，这个与教材的结果不一致，但R计算的结果与教材附带的SAS程序计算出来的结果一致，教材可能是印刷错误；(2)第2行的rmeans表示行是有序变量时的结果；(3)第3行的cmeans表示列是有序变量时的结果；(4)general表示列与行都是无序变量时的结果。</p>
<p>常规卡方计算的结果是71.4325。线性回归分量的结果是63.389，二者之差是教材中的偏离线性回归分量，即71.4325-63.389=8.0435，相应的P值为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1-pchisq(8.0435,8)</div></pre></td></tr></table></figure>
<p>p值结果为0.4292325，可以认为年龄与冠状动物粥样硬化之间不仅存在相关关系，并且为线性关系，从数据中可以看出来，冠状动脉粥样硬化的等级随着年龄的增加而增高。 注：pchisq(8.0435,8)表示，计算自由度为8，卡方值是8.0435的左侧卡方分布曲线下面积。</p>
<h4 id="第4种方法">第4种方法：</h4>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"multiCA"</span>)</div><div class="line"><span class="keyword">library</span>(multiCA)</div><div class="line">multiCA.test(data711)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; multiCA.test(data711)</div><div class="line">$overall</div><div class="line"></div><div class="line">	Multinomial Cochran-Armitage trend test</div><div class="line"></div><div class="line">data:  data711</div><div class="line">W = <span class="number">63.68</span>, df = <span class="number">3</span>, p-value = <span class="number">9.611e-14</span></div><div class="line">alternative hypothesis: true slope <span class="keyword">for</span> outcomes <span class="number">1</span>:nrow(x) is not equal to <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line">$individual</div><div class="line">[<span class="number">1</span>] <span class="number">1.020527e-10</span> <span class="number">4.248539e-01</span> <span class="number">1.963178e-02</span> <span class="number">2.613094e-09</span></div><div class="line">attr(,<span class="string">"method"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"Holm-Shaffer"</span></div></pre></td></tr></table></figure>
<h2 id="cmh检验对多层分类资料的分析">CMH检验对多层分类资料的分析</h2>
<h3 id="案例13">案例13</h3>
<p>某公司推出一种治疗颈椎病的治疗仪，为评价其疗效，进行多中心的随机对照试验。共选择两家医院，每家医院60例研究对象，试验组与对照组各30例。以颈痛疗效作为主要疗效指标，根据缓解程度分为有效和无效。治疗20天后，各中心每组的疗效情况如下所示（参见代码），欲分析两种治疗仪的疗效是否有差异（《医学案例统计分析与SAS应用》第五章例5.4，冯国双，北京大学医学出版社，2010:97）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data56 &lt;- c(8,4,22,26,11,9,19,21)</div><div class="line">data56a &lt;- array(data56,dim=c(2,2,2))</div><div class="line">data56a</div><div class="line">dimnames(data56a) &lt;- list(</div><div class="line">  c(&quot;对照组&quot;,&quot;试验组&quot;),</div><div class="line">  c(&quot;无效&quot;,&quot;有效&quot;),</div><div class="line">  c(&quot;中心1&quot;,&quot;中心2&quot;))</div><div class="line"></div><div class="line">CMHtest(data56a,overall=TRUE)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi26.png">

</div>
<p>结果由三部分构成，第一部分是中心1的结果，第二部分是中心2 的结果，第三部分是控制了中心的影响后，两组疗效差异无统计学意义。</p>
<h2 id="拟合优势的卡方检验">拟合优势的卡方检验</h2>
<h3 id="案例14判断数据是否服从泊松分布">案例14：判断数据是否服从泊松分布</h3>
<p>观察某克山病区克山病患者的空间分布情况，调查者将该地区划分为279个取样单位，统计各取样单位历年累计病例数，资料见表7-15的第（1）、（2）栏，问此资料是否服从Poisson分布？（《医学统计学》第三版，孙振球，第七章 卡方检验，例7-13）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">x&lt;-0:6</div><div class="line">y&lt;-c(26,51,75,63,38,17,9)</div><div class="line">mean&lt;-mean(rep(x,y))</div><div class="line">q&lt;-ppois(x,mean)</div><div class="line">n&lt;-length(y)</div><div class="line">p&lt;-c()</div><div class="line">p[1]&lt;-q[1]</div><div class="line">p[n]&lt;-1-q[n-1]</div><div class="line">for(i in 2:(n-1))</div><div class="line">  p[i]&lt;-q[i]-q[i-1]</div><div class="line"></div><div class="line">chisq.test(y, p=p,correct=F)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi27.png">

</div>
<h3 id="案例15-判断数据是否服从某一比例">案例15 ：判断数据是否服从某一比例</h3>
<p>假设H0：总体具有某分布F 备择假设H1：总体不具有该分布。 我们将数轴分成若干个区间，所抽取的样本会分布在这些区间中。在原假设成立的条件下，我们便知道每个区间包含样本的个数的期望值。用实际值Ni 与期望值Npi可以构造统计量K 。皮尔森证明，n趋向于无穷时，k收敛于m-1的塔防分布。m为我们分组的个数。有了这个分布，我们就可以做假设检验。</p>
<p>某消费者协会为了确定市场上消费者对5咎品牌啤酒的喜好情况，随机抽取了1000名啤酒爱好者作为样本进行如下试验：每个人得到5种品牌的啤酒各一瓶，但未标明牌子。这5种啤酒按分别写着A、B、C、D、E字母的5张纸片随机的顺序送给每一个人，下表是根据样本资料整理得的各种品牌啤酒爱好者的频数分页，试根据这些数据判断消费者对这5种品牌啤酒的爱好有无明显差异？ <img src="http://ortxpw68f.bkt.clouddn.com/chi28.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(210,312,170,85,223) </div><div class="line">n &lt;- sum(x); m &lt;- length(x) </div><div class="line">p &lt;- rep(1/m,m) </div><div class="line">K &lt;- sum((x-n*p)^2/(n*p)); K #计算出K值 </div><div class="line">p &lt;- 1-pchisq(K,m-1); p #计算出p值</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi29.png">

</div>
<p>在R语言中 chisq.test()，可以完成拟合优度检验。默认就是检验是否为均匀分布，如果是其他分布，需要自己分组，并在参数p中指出。上面题目的解法如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chisq(x)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi30.png">

</div>
<p>同样拒绝原假设。</p>
<h3 id="案例16-判断数据是否服从正态分布">案例16 ：判断数据是否服从正态分布</h3>
<p>抽取31名学生的成绩，检验是否为正态分布。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(25,45,50,54,55,61,64,68,72,75,75,78,79,81,83,84,84,84,85,86,86,86,87,89,89,89,90,91,91,92,100) </div><div class="line">A &lt;- table(cut(x,breaks=c(0,69,79,89,100))) ;A#对样本数据进行分组。 </div><div class="line">p &lt;- pnorm(c(70,80,90,100),mean(x),sd(x)) #获得理论分布的概率值 </div><div class="line">p &lt;- c(p[1],p[2]-p[1],p[3]-p[2],1-p[3]) </div><div class="line">chisq.test(A,p=p)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi31.png"> 结果显示，其p值小于0.05，成绩不属于正态分布。</p>
<p>再用shirpo.test()和qq图检验一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shapiro.test(x)</div><div class="line">qqnorm(x);qqline(x, col = 2)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi32.png"> <img src="http://ortxpw68f.bkt.clouddn.com/chi33.png"></p>
<p>结果显示，p值小于0.05，不是正态分页，并且QQ图明显表示出成绩不符合正态分布。</p>
<h3 id="案例17-判断数据是否符合原比例">案例17 ：判断数据是否符合原比例</h3>
<p>大麦杂交后关于芒性的比例应该是 无芒：长芒：短芒=9:3:4 。我们的实际观测值是335：125：160 。请问观测值是否符合预期？ <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- c(9/16,3/16,4/16) </div><div class="line">x &lt;- c(335,125,160) </div><div class="line">chisq.test(x,p=p)</div></pre></td></tr></table></figure></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi34.png">

</div>
<p>在分组的时候要注意，每组的频数要大于等于5.如果理论分布依赖于多个未知参数，只能先由样本得到参数的估计量。然后构造统计量K，此时K的自由度减少位置参数的数量个。</p>
<h2 id="ks检验">ks检验</h2>
<p>R语言中提供了ks.test()函数，理论上可以检验任何分布。他既能够做单样本检验，也能做双样本检验。</p>
<h3 id="案例18判断数据是否服从指数分布">案例18：判断数据是否服从指数分布</h3>
<p>记录一台设备无故障工作时常，并从小到大排序420 500 920 1380 1510 1650 1760 2100 2300 2350。问这些时间是否服从拉姆达=1/1500的指数分布？ <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(420,500,920,1380,1510,1650,1760,2100,2300,2350) </div><div class="line">ks.test(x,&quot;pexp&quot;,1/1500)</div></pre></td></tr></table></figure></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi35.png">

</div>
<h3 id="案例19判断两批数据是否服从相同分布">案例19：判断两批数据是否服从相同分布</h3>
<p>有两个分布，分别抽样了一些数据，问他们是否服从相同的分布。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">X&lt;-scan() </div><div class="line">0.61 0.29 0.06 0.59 -1.73 -0.74 0.51 -0.56 0.39 1.64 0.05 -0.06 0.64 -0.82 0.37 1.77 1.09 -1.28 2.36 1.31 1.05 -0.32 -0.40 1.06 -2.47</div><div class="line"></div><div class="line">Y&lt;-scan() </div><div class="line">2.20 1.66 1.38 0.20 0.36 0.00 0.96 1.56 0.44 1.50 -0.30 0.66 2.31 3.29 -0.27 -0.37 0.38 0.70 0.52 -0.71</div><div class="line"></div><div class="line">ks.test(X,Y)</div></pre></td></tr></table></figure></p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/chi36.png">

</div>
<h2 id="将频数表转换为原始数据">将频数表转换为原始数据</h2>
<p>在做卡方分析时，我们经常使用频数表，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; rc &lt;- matrix(c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>),nrow=<span class="number">4</span>,byrow=<span class="literal">T</span>)</div><div class="line">&gt; rc &lt;- matrix(c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>),nrow=<span class="number">2</span>,byrow=<span class="literal">T</span>)</div><div class="line">&gt; colnames(rc) &lt;- c(<span class="string">"somker"</span>,<span class="string">"nonsmoker"</span>)</div><div class="line">&gt; rownames(rc) &lt;- c(<span class="string">"g1"</span>,<span class="string">"g2"</span>)</div><div class="line">&gt; rc</div><div class="line">   somker nonsmoker</div><div class="line">g1      <span class="number">3</span>         <span class="number">3</span></div><div class="line">g2      <span class="number">4</span>         <span class="number">2</span></div></pre></td></tr></table></figure>
<p>但有时候我们需要把频数表转换为原始数据，此时可以使用<code>NCStats</code>这个包，这个包无法使用<code>install.packages</code>命令安装，但可以去它的官网进行安装，如下所示：</p>
<p>http://www.rforge.net/NCStats/files</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180821/CJI9ABCjga.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下载最新版的即可，安装，不过这个包还依赖于其它包的安装，根据R的提示安装即可，我在安装过程中，系统提示还要安装<code>FSA</code>和<code>plotrix</code>这两个包，安装后，加载此包，将<code>rc</code>这个数据还原于原始数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(NCStats)</div><div class="line">rc</div><div class="line">frc &lt;- expandTable(rc,c(<span class="string">"group"</span>,<span class="string">"somker status"</span>))</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt; rc</div><div class="line">   somker nonsmoker</div><div class="line">g1      <span class="number">3</span>         <span class="number">3</span></div><div class="line">g2      <span class="number">4</span>         <span class="number">2</span></div><div class="line">&gt; frc &lt;- expandTable(rc,c(<span class="string">"group"</span>,<span class="string">"somker status"</span>))</div><div class="line">&gt; frc</div><div class="line">   group somker status</div><div class="line"><span class="number">1</span>     g1        somker</div><div class="line"><span class="number">2</span>     g1        somker</div><div class="line"><span class="number">3</span>     g1        somker</div><div class="line"><span class="number">4</span>     g2        somker</div><div class="line"><span class="number">5</span>     g2        somker</div><div class="line"><span class="number">6</span>     g2        somker</div><div class="line"><span class="number">7</span>     g2        somker</div><div class="line"><span class="number">8</span>     g1     nonsmoker</div><div class="line"><span class="number">9</span>     g1     nonsmoker</div><div class="line"><span class="number">10</span>    g1     nonsmoker</div><div class="line"><span class="number">11</span>    g2     nonsmoker</div><div class="line"><span class="number">12</span>    g2     nonsmoker</div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>http://doctor.51daifu.com/2007/0305/1ADAD919C959T148648.shtml</li>
<li>http://blog.sina.com.cn/s/blog_686dcf990100z9q3.html</li>
<li>http://medstats.blog.163.com/blog/static/17974801620089108192736/</li>
<li>http://blog.sina.com.cn/s/blog_4b361fe00100y222.html</li>
<li>孙振球. 医学统计学[M]. 人民卫生出版社, 2010.</li>
<li>徐俊晓. 统计学与R读书笔记(第六版)</li>
<li>葛毅, 胡良平. 高维列联表资料的统计分析与 SAS 软件实现 (一)[J]. 中西医结合学报, 2009, 7(11): 1086-1089.</li>
<li>http://bbs.pinggu.org/thread-521307-1-1.html↩</li>
<li>白话统计.冯国双</li>
<li>医学统计学与R语言（公众号）</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07方差分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/BioStatistics/生物统计-07方差分析/" itemprop="url">方差分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T12:01:00+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13,298
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  53
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="方差分析的基本思想及应用条件">方差分析的基本思想及应用条件</h2>
<h3 id="方差分析的基本思想">方差分析的基本思想</h3>
<p>在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中<code>处理因素(treatment)</code>至少有两个<code>水平（level）</code>。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就<code>是方差分析（ANOVA，analysis of variance）</code>，这是由英国统计学家R.A.Fisher首创，以F命名，故方差分析又称为F检验。</p>
<p>设处理因素有<span class="math inline">\(g(g\geq 2)\)</span>个不同水平，实验对象随机分为<span class="math inline">\(g\)</span>组，分别接受不同水平的干预，第<span class="math inline">\(i(i=1,2,\dots,g)\)</span>组的样本含量为<span class="math inline">\(n_{i}\)</span>，第<span class="math inline">\(i\)</span>处理组的第<span class="math inline">\(j(j=1,2,...n_{i})\)</span>个观测值用<span class="math inline">\(X_{ij}\)</span>来表示，其计算结果可能可以整理成以下面的形式，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115156.png">

</div>
<p>方差分析的目的就是在<span class="math inline">\(H_{0}:\mu_{1}=\mu_{2}\dots=\mu_\)</span> 成立的条件下，通过分析各处理组均数之间的差别大小，推荐<span class="math inline">\(g\)</span>个总体均数<span class="math inline">\(\bar{X}_{i}\)</span>间有无差别，从面说明处理因素的效应是否存在。</p>
<p>记总均数为<span class="math inline">\(\bar{X}=\sum_{i=1}^g\sum_{j=1}^{n_{j}}X_{ij}/N\)</span>，各处理组均数为<span class="math inline">\(\bar{X}=\sum_{j=1}^{n_{i}}X_{ij}/n_{i}\)</span>,总例数为<span class="math inline">\(N=n_{1}+n_{2}+\dots+n_{g}\)</span>，g为处理组数。</p>
<p>实验数据有三个不同的变异： <strong>1. 总变异</strong>。全部观测值大小不同，这种变异称为总变异。总变异的大小可能用离均差平方和(sum of squares of deviations from eman,SS)来表示，即各观测值<span class="math inline">\(X_{ij}\)</span>与总均数<span class="math inline">\(\bar{X}\)</span>差值的平方和，记为<span class="math inline">\(SS_{总}\)</span>。公式略。</p>
<p><strong>2. 组间变异</strong>。各处理组由于接受处理的水平不同，各组的样本均数<span class="math inline">\(\bar{X}_{i}（i=1,2,\dots,g）\)</span>也大小不等，这种变异称为组间变异，其大小用各组均数<span class="math inline">\(\bar{X_{i}}\)</span>与总均数<span class="math inline">\(\bar{X}\)</span>的离均差平方和表示，记为<span class="math inline">\(SS_{组间}\)</span>，计算公式略。</p>
<p>各组均数之间相关越悬殊，它们与总均数的差值越在在，<span class="math inline">\(SS_{组间}\)</span>就越大，反之<span class="math inline">\(SS_{组间}\)</span>就越小。<span class="math inline">\(SS_{组间}\)</span>反应了各组均数的变异，存在这种变异的原因有：①随机误差；②处理的不同水平可能对实验结果的影响。</p>
<p><strong>3. 组内变异</strong>。在同一处理组中，虽然每个实验对象接受的处理相同，但观测值仍各不相同，这种变异称为组内变异（误差）。组内变异用组内各观测值<span class="math inline">\(X_{ij}\)</span>与其所在组的均数<span class="math inline">\(\bar{X_{i}}\)</span>的差值的平方和表示，记为<span class="math inline">\(SS_{组内}\)</span>，表示随机误差的影响。公式略。</p>
<p>总离均差平方和分解为组间离均差平方和与组内离均差平方和，就有了以下公式： <span class="math inline">\(SS_{总}=SS_{组间}+SS_{组内}\)</span></p>
<p>各离均差平方和的自由度为：</p>
<p><span class="math inline">\(\nu_{总}=N-1，\nu_{组间}=g-1,\nu_{组内}=N-g\)</span></p>
<p>变异程序除与离均差平方和的大小腾外，还与其自由度有关，由于各部分自由度不相等，因此积分离均差平方和不能直接比较，须将各部分离均差平方和除以相应的自由度，其比值称为均方差，简称为均方（mean square, MS)。公式为：</p>
<p><span class="math inline">\(MS_{组间}=\frac{SS_{组间}}{\nu_{组间}}\)</span> <span class="math inline">\(MS_{组内}=\frac{SS_{组内}}{\nu_{组内}}\)</span></p>
<p>如果各组样本的总体均数相等(<span class="math inline">\(H_{0}:\mu_{1}=\mu_{2}\dots=\mu_\)</span>)，即各处理组的样本来自相同的总体，无处理因素的作用，则组间变异同组内变异一样，只反映随机误差作用的大小，组间均方与组内无方的比值称为F统计量，如下所示：</p>
<p><span class="math inline">\(F=\frac{MS_{组间}}{MS_{组内}}\)</span></p>
<p>如果F值接近于1，就没有理由拒绝<span class="math inline">\(H_{0}\)</span>;反之，F值越大，拒绝<span class="math inline">\(H_{0}\)</span>的理由越充分，数理统计的理论证明，当<span class="math inline">\(H_{0}\)</span>成立时，F统计量服从F分布，方差分析是单侧F检验。</p>
<h2 id="变异是方差分析的基本思想">变异是方差分析的基本思想</h2>
<p>上面的话可能不太好理解。现在用大白话来理解一下，例如我们要研究某个化合物是否有改善肥胖的效果，我们最初肯定是要做动物实验，动物实验的话，例如采用C57的小鼠，分为5组，第1组，给生理盐水，第2组，给减肥药（相当于阳性对照），第3组，给高剂量的化合物，第4组，给中剂量的化合物，第5组，给低剂量的化合物。分别喂一段时间后，我们发现小鼠的体重有所变化，这个变化由两部分构成，第一个就是外界的刺激因素导致的，第二种就是小鼠自身导致的。这种变化我们可以称为<code>变异（variance）</code>，方差分析研究的本质就是这种变异（体重的变化，不是基因变异那种变异），方差分析的英语就是<code>Analysis of variance</code>，如果外界的刺激的因素导致的变异程度远远大于小鼠自身因素导致的变异，那么我们就可以认为，导致小鼠体重这种变异是由外界刺激引起的。</p>
<p>不过这样还有一个问题，因为数据越多，变异程度就越大，为了解决这个问题，就需要用变异除以自由度（例数-1），这样比较的就是平均的变异，因此方差分析中就出现了均方（MS）和组内均方的概念。组间均方/组内均方就是通常所说的F值，实际上代表了这样一个含义：如果组间变异远远大于组内变异，那么组间均方除以组内均方的值肯定很大，反之，这一值就会很小。但是，到底大到什么程度才认为有统计学意义呢，那就得根据F分布来判断。</p>
<h3 id="方差分析的应用条件">方差分析的应用条件</h3>
<p>多个样本均数比较的方差分析其应用条件为：</p>
<p>①各样本是相互独立的随机样本，均来自正态分布总体；</p>
<p>②相互比较的各样本的总体方差相等，即具有等方差齐性；</p>
<p>③每个样本之间都是独立的。</p>
<h2 id="r中的方差分析函数">R中的方差分析函数</h2>
<p>所用的函数为aov()： 语法为：<code>aov（formula,data=dataframe）</code> 其中formula可使用的特殊符号如下，其中y为因变量，A、B、C为自变量：</p>
<table>
<thead>
<tr class="header">
<th>符号</th>
<th>用法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>～</td>
<td>分隔符，左边为因变量，右边为自变量。例y～A+B+C</td>
</tr>
<tr class="even">
<td>+</td>
<td>分隔自变量</td>
</tr>
<tr class="odd">
<td>：</td>
<td>表示交互项，如y～A+B+A:B</td>
</tr>
<tr class="even">
<td>*</td>
<td>表示所有可能的交互项，如y～A * B *C等价于y～A+B+C+A:B+A:C+B:C+A:B:C</td>
</tr>
<tr class="odd">
<td>^</td>
<td>表示交互项达到的某个次数，如y～(A+B+C)^2等价于y～A+B+C+A:B+A:C+B:C</td>
</tr>
<tr class="even">
<td>.</td>
<td>表示包含除因变量以外的所有变量。如y～.</td>
</tr>
</tbody>
</table>
<h2 id="单因素方差分析">单因素方差分析</h2>
<p>单因素方差分析（one-way ANOVA）是指对单因素试验结果进行分析，检验因素对试验结果有无显著性影响的方法。单因素方差分析是用来检验多个平均数之间的差异，从而确定因素对试验结果有无显著性影响的一种统计方法。对于完全随机设计试验且处理数大于2时可以用单因素方差分析（等于2 时用t检验）。离差平方和的分解公式为：SST(总和)=SSR(组间)+SSE(组内)，F统计量为MSR/MSE，MSR=SSR/k-1,MSE=SSE/n-k。其中SST为总离差、SSR为组间平方和、SSE为组内平方和或残差平方和、MSR为组间均方差、MSE为组内均方差。</p>
<h4 id="anova-案例a">ANOVA-案例A</h4>
<p>单因素方差分析例4-2：某医生为了研究一种降血脂新药的临床疗效，按统一纳入标准选择120名高血脂患者，采用完全随机设计方法将患者等分为4组（具体分组方法见例4-1），进行双盲试验。6周后测得低密度脂蛋白作为试验结果，见表4-3。问4个处理组患者的低密度脂蛋白含量总体均数有无差别? 数据如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115215.png">

</div>
<p><strong>计算过程如下所示：</strong></p>
<h5 id="导入数据">1. 导入数据</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">anova1 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_402.csv&quot;,sep=&quot;,&quot;)</div><div class="line">library(reshape2)</div><div class="line">anova1 &lt;- melt(anova1)</div></pre></td></tr></table></figure>
<h5 id="正态检验">2.正态检验</h5>
<p>方差分析需要一定的假设，即数据集应该符合正态和各组的方差相等，可以分别用<code>shapiro.test</code>和<code>bartlett.test</code>检验从P值观察到这两个假设是符合的。对于不符合假设的情况，我们就要用到非参数方法，例如Kruskal-Wallis秩和检验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">group &lt;- c(&quot;control&quot;,&quot;high&quot;,&quot;middle&quot;,&quot;control&quot;)</div><div class="line"></div><div class="line">for(i in group)&#123;</div><div class="line">  print(shapiro.test(anova1[anova1$variable==i,]$value))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95229</span>, p-value = <span class="number">0.1947</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95833</span>, p-value = <span class="number">0.2806</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.9445</span>, p-value = <span class="number">0.1202</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  anova1[anova1$variable == i, ]$value</div><div class="line">W = <span class="number">0.95229</span>, p-value = <span class="number">0.1947</span></div></pre></td></tr></table></figure>
<p>P值大于0.05说明数据正态P值大于0.05说明数据正态</p>
<h5 id="方差齐性检验"><strong>3. 方差齐性检验:</strong></h5>
<p>方差齐性检验就是检验各组样本所代表的总体方差是否一致的检验，两样本方差齐性检验使用Bartlett法，同样，它也适用于多样本的方差齐性检验，它是它要求所检验的样本总体符合正态分页，当不符合正态分布的时候，就不能使用，则要用Levene检验。Levene检验不受数据颁贩限制，是一种稳健的检验，因而被广泛地认为是一种标准的检验方差齐性的检验。</p>
<p><strong>方差齐性通常用bartlett检验</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bartlett.test(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115233.png">

</div>
<p>结果显示p值大于0.05，可认为方差齐性。</p>
<p>或者用<strong>levene检验：</strong></p>
<p>Levene检验既可以用于正态分布的数据，也可以用于非正态分布的数据或分布不明的数据，具有比较稳健的特点，检验效果也比较理理想。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(car)</div><div class="line">leveneTest(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115250.png">

</div>
<p>结果发现sig值大于0.05,表明符合方差齐性假设,可以进行进一步的参数检验。</p>
<h5 id="检验整体均值是否有差异"><strong>4. 检验整体均值是否有差异</strong></h5>
<p>方差例如技术的目的就是要比较因素A的r水平上，试验结果是否有显著差异，以样本作为检验的标准，写出检验假设，如下所示：</p>
<p><span class="math inline">\(H_{0}:\alpha_{1}=\alpha_{2}=\cdots=\alpha_{r},\)</span>，<span class="math inline">\(H_{1}:\alpha_{1},\alpha_{2},\cdots,\alpha_{r}\)</span></p>
<p>如果拒绝原假设，则说明样本来自不同的正态总体，则由因素A的各个水平所造成的均值差异有统计意义；若不能拒绝原假设，说明样本来自相同的正态总体，因素的 不同水平之间无差异。在这个案例中，我们研究的就是不同剂量的药物对低密度脂蛋白的水平是否产生影响，我们可以使用3个函数来进行计算。</p>
<h6 id="aov">aov()</h6>
<p>aov函数的使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aov(formula,data=<span class="literal">NULL</span>,projections=<span class="literal">FALSE</span>,qr=<span class="literal">TRUE</span>,contrasts=<span class="literal">NULL</span>,<span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中formula表示主方差分析的公式，在单因素方差分析中，即为<code>x~A</code>；data表示方差分析的数据框；projections为逻辑值，表示是否返回预测结果；qr是逻辑值，表示是否返回QR分解结果，默认为TRUE；contrasts是公式中的一些因子的对比列表，计算过程如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result &lt;- aov(value~variable,data=anova1)</div><div class="line">summary(result)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115306.png">

</div>
<p>其中Residuals是残差，variable代表不同的组，p值小于0.001，因此各组之间存在显著性差异。另外，R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。</p>
<h6 id="oneway.test">oneway.test()</h6>
<p>也可以采用<code>oneway.test()</code>函数进行检验，</p>
<p><code>oneway.test()</code>函数的用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneway.test(formual,data,subset,na.action,var.equal=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>若各水平下的总体方差相等，且参数var.equal=TRUE，那么等于同函数aov()所作的方差分析结果。在默认情况下，各水平的总体方差不相等(var.equal=FALSE)，则使用Welch的近似方法，在任何多个样本的情况下作两样本Welch检验，在满足方差齐发的条件下，使用oneway.test()的计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; result2 &lt;- oneway.test(value~variable,data=anova1,var.equal=<span class="literal">TRUE</span>)</div><div class="line">&gt; result2</div><div class="line"></div><div class="line">	One-way analysis of means</div><div class="line"></div><div class="line">data:  value and variable</div><div class="line"><span class="literal">F</span> = <span class="number">24.884</span>, num df = <span class="number">3</span>, denom df = <span class="number">116</span>, p-value = <span class="number">1.674e-12</span></div></pre></td></tr></table></figure>
<h6 id="lm">lm()</h6>
<p>单因素方差分析的数学模型可以看作是一种特殊的线性模型，因此方差分析还可以通过线性模型函数lm()计算得到，再利用anova()提取其中的方差分析表，因此aov(formula)等价于anova(lm(formula))，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; anova(lm(value~variable,data=anova1))</div><div class="line">Analysis of Variance Table</div><div class="line"></div><div class="line">Response: value</div><div class="line">           Df Sum Sq Mean Sq <span class="literal">F</span> value    Pr(&gt;<span class="literal">F</span>)    </div><div class="line">variable    <span class="number">3</span> <span class="number">32.156</span> <span class="number">10.7187</span>  <span class="number">24.884</span> <span class="number">1.674e-12</span> ***</div><div class="line">Residuals <span class="number">116</span> <span class="number">49.967</span>  <span class="number">0.4308</span>                      </div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div></pre></td></tr></table></figure>
<h5 id="均数间的两两比较"><strong>5. 均数间的两两比较</strong></h5>
<p>方差分析得出总体之间有差异，要进一步知道哪两组之间有差异，就要使用均数间的多重比较，常用的比较方法有SNK检验（q检验），LSD检验，Bonferroni检验，Dunnett检验，TurkeyHSD检验，下面是对一些常用的两两比较方法的汇总：</p>
<h6 id="常见的两两比较方法">5.1 常见的两两比较方法</h6>
<p><strong>LSD</strong>：相当于t检验，只不过它需要在方差分析一定要有统计学差异的情况下才用。所以LSD法并没有控制假阳性错误。一般情况下，如果你在设计初期就有很明确的目的，可以考虑这种方法，因为每一对比较都是有特定意义的，不用非得控制假阳性错误。</p>
<p><strong>SNK</strong>法是先按多组均值大小排序，然后按一个有点类似于t检验的公式分别比较（不过误差计算不同）。比如a、b、c三组均值分别是a最小，c最大，b居中。那么比较时，很显然a和c差别最大，所以在最后的界值上做一些调整。例如，原来可能t检验的界值是2.83，只要t值大于2.83就算有差异，现在把界值调大，比如调到3.40，a和c的比较计算的t值，只有大于3.4才算有差异。这种调整的界值叫做q界值。这种方法对假阳性错误的控制依然不到位。所以如果你想控制假阳性，不要选这种方法。</p>
<p><strong>Bonferroni法</strong>大概是最流行的一种方法，因为简单。它的思想是调整检验水准，根据比较的次数重新设定检验水准，然后根据P值做出结论。比如常规的检验水准是0.05，只要P小于0.05就认为有统计学差异。但是如果用Bonferroni法调整，则需要0.05除以比较次数，如比较6次，这时调整后的检验水准是0.05/6=0.0083，也就是说，P值小于0.0083才算有差异。这种方法其实更像是一种检验水准调整方法，简单易用，不仅可以用于均值的两两比较，也可用于率的两两比较。比如你要做三组的卡方检验，想进一步两两比较，就可以考虑用这种方式，即分别做两组的卡方，但是一共比较3次，所以P值小于0.0167才算有差异。这种方法的缺点是，当比较次数多时，结果过于保守，比如比较10次，那就需要P值小于0.005才算有差异，有时很难达到。</p>
<p>再说点其它国内课本上不大介绍但是国外介绍比较多的几种方法。</p>
<p><strong>Tukey法</strong>，有时也叫<strong>Tukey HSD法</strong>（Honestly Significant Difference test），这种方法大概是统计学家最认可一致的方法了，绝大多数统计学家都相信，Tukey法的检验效率可能是最高的。Tukey法也是基于q检验，大概意思是先确定一个最大差异的临界值，然后分别对其中两组比较，看看哪两组差值大于这个界值，就算有差异。Tukey法是大多数统计学家首先推荐的两两比较方法，不过这种方法只适用于组间例数相等的情况。对于组间例数不等的时候，可用修正的Tukey法，也叫作Tukey-Kramer法。</p>
<p><strong>现在计算各组之间的均数与SD</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=mean)</div><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=sd)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115324.png">

</div>
<p><strong>绘制箱形图可能观察到不同因素对于因变量的影响</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot.design(value ~ variable,data =anova1, main = &quot;Group means&quot;) </div><div class="line"># plot.design was inclued in packages &quot;graphics&quot;</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115343.png">

</div>
<p><strong>绘制有置信区间的组均值图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(gplots)</div><div class="line">plotmeans(value ~ variable,data =anova1 )</div></pre></td></tr></table></figure>
<p>图片如下所示： <img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115358.png"></p>
<p>单因素方差分析是从总体的角度上说明各效应的均值之间存在着显著差异，但具体在哪些水平下的均值存在较大差异，还不清楚，因此我们要对每一对样本均值进行一一比较，既要进行组间均值的两两比较。最常用，也是最直接的方法就是多重t检验方法，其对因子A每个水平下的数据两两比较均值进行t检验，但估计方差时用的是全部数据的误差均方和<span class="math inline">\(MS_{E}\)</span>，检验的假设为：</p>
<p><span class="math inline">\(H_{0}:\mu_{i}=\nu_{j},i\neq j,i,j=1,2,\cdots,r\)</span></p>
<p>构建t检验统计量，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115413.png">

</div>
<p>在原假设成立的情况下，该统计量服从自由度为n-r的t分布，所以检验拒绝为<span class="math inline">\(|T_{ij}&gt;t_{\alpha/2}(n-r)\)</span>。</p>
<p>多重t检验的思路简单，但是这样的方法不能直接使用，这是因为在样本之间多次重复使用t检验会大大增加犯第一类错误的概率。例如因子A有三个水平，需要比较3次(n=k(k-1)/2)，显著性水平为0.05，回此每次比较犯第一类错误的概率就是0.05，那么截取次比较同时进行，犯第一次错误的总概率为<span class="math inline">\(1-(1-\alpha)^n=1-0.95^3=0.1426\)</span>，这个数字就比较大了，因此直接使用多重t检验的结果不一定是可靠的，统计学家们提供了很多方法对P值进行修正，R中的P值修正函数是<code>p.ajdust()</code>，其调用格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.adjust(p,method=p.ajdust.methods,n=length(p))</div></pre></td></tr></table></figure>
<p>在R中，输入如下指令可以看到调整方法的列表，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; p.adjust.methods</div><div class="line">[<span class="number">1</span>] <span class="string">"holm"</span>       <span class="string">"hochberg"</span>   <span class="string">"hommel"</span>     <span class="string">"bonferroni"</span> <span class="string">"BH"</span>         <span class="string">"BY"</span>         <span class="string">"fdr"</span>       </div><div class="line">[<span class="number">8</span>] <span class="string">"none"</span></div></pre></td></tr></table></figure>
<p>当多重检验次数较多时，bonferroni修正方法的效果比较好，思路也很简单：如果在同一个数据集上同时进行n个独立的假设检验，那么用于每一个假设的统计显著水平，应为仅检验一个假设时显著水平的<code>1/n</code>，即<span class="math inline">\(\alpha&#39;=\alpha/n\)</span>，其中n为多重t检验的次数。</p>
<p>在R中计算均值的多重t检验时，用函数<code>pairwise.t.test()</code>返回多重比较的修正P值，其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pairwise.t.test(x, g, p.adjust.method = p.adjust.methods,</div><div class="line">                pool.sd = !paired, paired = <span class="literal">FALSE</span>,</div><div class="line">                alternative = c(<span class="string">"two.sided"</span>, <span class="string">"less"</span>, <span class="string">"greater"</span>),</div><div class="line">                <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>其中参数x是响应向量，g是因子向量，p.adjust.methods给出了P值的修正方法，默认按Holm方法修正，若不作任何调整则设为none；paired为逻辑值，指示是否要配对t检验；alternative指明检验的方向问题。现在对前面的结果进行多重t检验，使用bonferroni修正方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; pairwise.t.test(anova1$value,anova1$variable,p.adjust.method = <span class="string">"bonferroni"</span>)</div><div class="line"></div><div class="line">	Pairwise comparisons using t tests with pooled SD </div><div class="line"></div><div class="line">data:  anova1$value and anova1$variable </div><div class="line"></div><div class="line">       control low     middle </div><div class="line">low    <span class="number">0.00029</span> -       -      </div><div class="line">middle <span class="number">0.00020</span> <span class="number">1.00000</span> -      </div><div class="line">high   <span class="number">2.1e-13</span> <span class="number">0.00013</span> <span class="number">0.00020</span></div><div class="line"></div><div class="line">P value adjustment method: bonferroni</div></pre></td></tr></table></figure>
<p>经过修正后的p值会比原理增大很多，这在一定程度上克服了多重t检验增加犯第一类错误概率的缺点，从上面结果来看，除了middle与low组外，其余组之间的p值都很小，说明这几个样本之间有差异。</p>
<p>再看其它的两两比较方法，这些方法有LSD，TukeyHSD，Scheffe检验，</p>
<h6 id="lsd检验">LSD检验</h6>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(agricolae) #此包中有LSD检验</div><div class="line">result &lt;- LSD.test(result,&quot;variable&quot;,p.adj=&quot;bonferroni&quot;)</div><div class="line">result</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115452.png">

</div>
<p>注：R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。 Bonferroni校正(“bonferroni”)，用于多重比较的p值校正，次数不多时适用。如果在同一数据集上同时检验n个独立的假设，那么用于每一假设的统计显著水平，应为仅检验一个假设时的显著水平的1/n。举个例子：如要在同一数据集上检验两个独立的假设，显著水平设为常见的0.05。此时用于检验该两个假设应使用更严格的0.025。即0.05* (1/2)。该方法是由Carlo Emilio Bonferroni发展的，因此称Bonferroni校正。在药理实验中，动物数通常不会太多，用Bonferroni校正的居多。</p>
<h6 id="tukeyhsd检验">TukeyHSD检验</h6>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">result2 &lt;- aov(value~variable,data=anova1)</div><div class="line">result.tukey &lt;- TukeyHSD(result2)</div><div class="line">result.tukey</div><div class="line">plot(result.tukey)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115507.png">

</div>
<p>图片结果：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115520.png">

</div>
<h6 id="glht函数做tukey检验">glht()函数做Tukey检验</h6>
<p>此外，<code>multcomp</code>包中<code>glht()</code>函数提供了多重均值更全面的方法，适用于线性模型和广义线性模型，下面的代码重现Tukey HSD检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(multcomp)</div><div class="line">result4 &lt;- aov(value ~ variable, data = anova1)</div><div class="line">tukey4 &lt;- glht(result4, linfct=mcp(variable=<span class="string">"Tukey"</span>))</div><div class="line">summary(tukey4)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; summary(tukey4)</div><div class="line"></div><div class="line">	 Simultaneous Tests <span class="keyword">for</span> General Linear Hypotheses</div><div class="line"></div><div class="line">Multiple Comparisons of Means: Tukey Contrasts</div><div class="line"></div><div class="line"></div><div class="line">Fit: aov(formula = value ~ variable, data = anova1)</div><div class="line"></div><div class="line">Linear Hypotheses:</div><div class="line">                      Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">low - control == <span class="number">0</span>    -<span class="number">0.71500</span>    <span class="number">0.16946</span>  -<span class="number">4.219</span> <span class="number">0.000291</span> ***</div><div class="line">middle - control == <span class="number">0</span> -<span class="number">0.73233</span>    <span class="number">0.16946</span>  -<span class="number">4.322</span> <span class="number">0.000171</span> ***</div><div class="line">high - control == <span class="number">0</span>   -<span class="number">1.46400</span>    <span class="number">0.16946</span>  -<span class="number">8.639</span>  &lt; <span class="number">1e-04</span> ***</div><div class="line">middle - low == <span class="number">0</span>     -<span class="number">0.01733</span>    <span class="number">0.16946</span>  -<span class="number">0.102</span> <span class="number">0.999615</span>    </div><div class="line">high - low == <span class="number">0</span>       -<span class="number">0.74900</span>    <span class="number">0.16946</span>  -<span class="number">4.420</span> <span class="number">0.000108</span> ***</div><div class="line">high - middle == <span class="number">0</span>    -<span class="number">0.73167</span>    <span class="number">0.16946</span>  -<span class="number">4.318</span> <span class="number">0.000170</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line">(Adjusted p values reported -- single-step method)</div></pre></td></tr></table></figure>
<p>绘制不同组的箱线图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot(cld(tukey4,level = <span class="number">.05</span>),col=<span class="string">"lightgrey"</span>)</div><div class="line"><span class="comment">#cld()函数中level选项设置了使用显著水平0.05，即95%的置信区间</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115535.png">

</div>
<h5 id="残差分析">7.残差分析</h5>
<p>这一步做残差分析就是为了再次验证原始数据是否服从正态分布，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">residual &lt;- rstudent(result4)</div><div class="line">qqnorm(residual, pch=<span class="number">20</span>, cex=<span class="number">2</span>)</div><div class="line">qqline(residual, col=<span class="string">"gray60"</span>, lwd=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>残差的QQ图如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115549.png">

</div>
<p>shapiro检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; shapiro.test(residual)</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  residual</div><div class="line">W = <span class="number">0.9884</span>, p-value = <span class="number">0.4026</span></div></pre></td></tr></table></figure>
<p>p值的为0.4026，可以认为残差满足正态性。</p>
<p>绘制残差图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(residual ~ anova1$variable, main=<span class="string">"各组的残差图"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115601.png">

</div>
<p>对残差进行方差齐性检验，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(car)</div><div class="line">&gt; leveneTest(result4)</div><div class="line">Levene<span class="string">'s Test for Homogeneity of Variance (center = median)</span></div><div class="line"><span class="string">       Df F value Pr(&gt;F)</span></div><div class="line"><span class="string">group   3   1.493 0.2201</span></div><div class="line"><span class="string">      116</span></div></pre></td></tr></table></figure>
<p>P值大于0.05，可以认为残差满足方差齐性。</p>
<h4 id="anova-案例b">ANOVA-案例B</h4>
<p>再看一个案例，进行一次完整的ANOVA分析，如下所示：</p>
<p>某单位研究不同药物对小白鼠的镇咳作用，抽取40只小白鼠随机分配到各个药物组中，实验时先用0.2mL NH4OH对小白鼠喷雾，测定其发生咳嗽时间。以给药前后发生咳嗽时间的差值衡量不同药物的镇咳作用，结果见表5.1.试比较3种药物的平均推迟咳嗽时间的差异有无差异。（王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.）</p>
<p>计算过程如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">anova2 &lt;- read.csv(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_anova_01.csv"</span>,sep=<span class="string">","</span>)</div><div class="line"><span class="comment"># input raw data </span></div><div class="line"><span class="comment"># 王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.例5.1</span></div><div class="line"></div><div class="line">anova2$group &lt;- as.factor(anova2$group)</div><div class="line"><span class="keyword">library</span>(car)</div><div class="line">leveneTest(anova2$time~anova2$group)</div><div class="line">result &lt;- aov(anova2$time~anova2$group)</div><div class="line">summary(result)</div><div class="line">compareresult &lt;- TukeyHSD(result)</div><div class="line">compareresult</div><div class="line">plot(compareresult)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">3</span>)&#123;</div><div class="line">+   result &lt;- shapiro.test(filter(anova2,group==i)$time)</div><div class="line">+   print(result)</div><div class="line">+ &#125;</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.9778</span>, p-value = <span class="number">0.9523</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.98349</span>, p-value = <span class="number">0.9878</span></div><div class="line"></div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  filter(anova2, group == i)$time</div><div class="line">W = <span class="number">0.94005</span>, p-value = <span class="number">0.5536</span></div><div class="line"></div><div class="line">&gt; </div><div class="line">&gt; <span class="comment"># test for homogeneity var</span></div><div class="line">&gt; leveneTest(anova2$time~anova2$group)</div><div class="line">Levene<span class="string">'s Test for Homogeneity of Variance (center = median)</span></div><div class="line"><span class="string">      Df F value Pr(&gt;F)</span></div><div class="line"><span class="string">group  2  1.4002 0.2593</span></div><div class="line"><span class="string">      37               </span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## test for mean of all samples</span></div><div class="line"><span class="string">&gt; result &lt;- aov(anova2$time~anova2$group)</span></div><div class="line"><span class="string">&gt; summary(result)</span></div><div class="line"><span class="string">             Df Sum Sq Mean Sq F value Pr(&gt;F)  </span></div><div class="line"><span class="string">anova2$group  2   5062  2531.2   3.485 0.0411 *</span></div><div class="line"><span class="string">Residuals    37  26877   726.4                 </span></div><div class="line"><span class="string">---</span></div><div class="line"><span class="string">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## GLM for mean of all samples</span></div><div class="line"><span class="string">&gt; anova(lm(anova2$time~anova2$group))</span></div><div class="line"><span class="string">Analysis of Variance Table</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Response: anova2$time</span></div><div class="line"><span class="string">             Df  Sum Sq Mean Sq F value  Pr(&gt;F)  </span></div><div class="line"><span class="string">anova2$group  2  5062.5 2531.23  3.4845 0.04107 *</span></div><div class="line"><span class="string">Residuals    37 26877.4  726.42                  </span></div><div class="line"><span class="string">---</span></div><div class="line"><span class="string">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></div><div class="line"><span class="string">&gt; </span></div><div class="line"><span class="string">&gt; ## test for each pair of samples</span></div><div class="line"><span class="string">&gt; ## TukeyHSD</span></div><div class="line"><span class="string">&gt; TukeyHSD(result)</span></div><div class="line"><span class="string">  Tukey multiple comparisons of means</span></div><div class="line"><span class="string">    95% family-wise confidence level</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Fit: aov(formula = anova2$time ~ anova2$group)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">$`anova2$group`</span></div><div class="line"><span class="string">        diff        lwr      upr     p adj</span></div><div class="line"><span class="string">2-1 12.33333 -11.694604 36.36127 0.4302024</span></div><div class="line"><span class="string">3-1 29.03333   2.169283 55.89738 0.0317315</span></div><div class="line"><span class="string">3-2 16.70000 -10.164050 43.56405 0.2944100</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">&gt; pairwise.t.test(anova2$time,anova2$group,p.adjust.method = "bonferroni")</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">	Pairwise comparisons using t tests with pooled SD </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  anova2$time and anova2$group </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">  1     2    </span></div><div class="line"><span class="string">2 0.654 -    </span></div><div class="line"><span class="string">3 0.036 0.413</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">P value adjustment method: bonferroni</span></div></pre></td></tr></table></figure>
<h2 id="重复测量方差分析">重复测量方差分析</h2>
<h3 id="未设立平等对照的前后测量">未设立平等对照的前后测量</h3>
<p>重复测量资料(repeated measurement data)最常见的情况是同一个试验对象前后有2次测量结果的试验结果，也称作前后测量设计(premeasure-postmeasure design)，如下所示：<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115617.png"></p>
<p>… …</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/DDCgeCg9hm.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>虽然这个表和配对设计的t检验结果表达完全相同，但却是属于两种不同类型的设计，其区别在于</p>
<ol style="list-style-type: decimal">
<li>配对设计中同一对子的两个实验单位可以随机分配处理，两个实验单位同期观察试验结果，哦可以比较处理组间差别。前后测量设计不能同期观察试验结果，虽然可以在前后测量之间安排处理，但本质上比较的是前后差别，推论处理是否有效是有条件的，即假定测量时间对观察结果没有影响。</li>
<li>配对t检验要求同一对子的两个实验单位的观察结果分别与差值相互独立，差值服从正态分布。而胶后测量设计前后两次观察结果通常与差值不独立，大多数情况下第一次观察结果与差值存在负相关关系，例如上表，治疗前舒张压与差值的相关系数为-0.602。</li>
<li>配对设计用平均差值推论处理的作用，前后测量测序除了分析平均差值外，还可以进行相关回归分析，由上表计算，治疗前后舒张压的相关系数为0.963，P&lt;0.01，用治疗前舒张压(X)推论治疗后舒张压(Y)的回归方向为<span class="math inline">\(\hat{Y}=-49.534+1.266X\)</span>，截矩检验P=0.014，回归系数检验P&lt;0.01。</li>
</ol>
<h3 id="设立平等对照的前后测量">设立平等对照的前后测量</h3>
<p>第1张表中的高血压患者治疗后的舒张压平均下降了16mmHg，虽然经配对t检验，t=16.18，P&lt;0.01，这也未必说明治疗有效，因为住院休息，环境和情绪的改变同样可以使血压恢复平衡。因此，确定疗效的前后测量设计必须增加平行对照，例如将20位轻度高血压患者随机分配到处理组和对照组，试验结果见表12-2.如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115638.png">

</div>
<p>比较这张表中处理组与对照组之间的差别，似乎可以用前后测量的差值(d)做两组均数比较的t检验，但上表中处理组与对照组的差值d方差不齐（F值为6.58，P&lt;0.01），不符合两无数比较t检验的前提条件，更为重要的是，如果处理组与对照组基线值（治疗前的舒张压）不同，那么差值不能作为判别组间差别的依据。</p>
<h3 id="重复测试设计">重复测试设计</h3>
<p>当前后测量设计的重复测量次数m&gt;=3时，称为<strong>重复测试设计</strong>或<strong>重复测量数据</strong>，重复测试数据类似于随机区间设计数据，如下表所示，而且同样可以计算出随机区组设计的方差分析表：</p>
<h3 id="案例分析b">案例分析B</h3>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115652.png">

</div>
<p>下表是随机区组数据的方差分析表：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115706.png">

</div>
<p>但重复测量设计与随机区级设计有区别，它们的区别在于：</p>
<p>（一）重复测量设计中的“处理”是在区组（受试者）间随机分配，区组内的各时间点是固定的，不能随机分配，如下表所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115734.png">

</div>
<p>A、B两种处理随机分配给各个患者后，每个患者测量的时间是相同的，随机区组设计要求每个区组内实验单位彼此独立，处理只能在区组内随机分配，每个实验单位接受的处理是不相同的，如下所示（随机区间设计）：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115748.png">

</div>
<p>（二）重复测量设计区组内实验单位彼此不独立，如在表12-3中，每个受试者血糖浓度的个体特征是用4个时间点的测量值刻画的，如下图所示：</p>
<div class="figure">
<img src="C:\Users\20161111\AppData\Roaming\Typora\typora-user-images\1561780695146.png" alt="1561780695146">
<p class="caption">1561780695146</p>
</div>
<p>同一受试者的血样重复测量结果是高度相关的，相关系数如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115838.png">

</div>
<p>更准确地说，表12-3重复测量数据用随机区组方差分析比较处理组间差异，前提条件是要满足<strong>“球对称(sphericity)”</strong>假设，即重复测量误差的协方差矩阵经正交对比变换后，与单位矩阵<span class="math inline">\(I_{4\times4}\)</span>成比较，表12-3数据Mauchly“球对称”检验结果见表12-7，其中<span class="math inline">\(\chi^2=15.44,\nu=5,P=0.01\)</span>，拒绝“球对称”假设，即表12-3的数据不满足随机区组方差分析（表12-4）“球对称”的条件，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115852.png">

</div>
<p>此时，就需要对组内效应的F界值进行校正，校正的方法是用“球对称”系数<span class="math inline">\(\epsilon\)</span>乘以组内效应F界值的自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(\nu_{2}\)</span>，得到<span class="math inline">\(\tau_{1}=\nu_{1}\epsilon,\tau_{2}=\nu_{2}\epsilon\)</span>，用<span class="math inline">\(F_{\alpha,(\tau_{1},\tau_{2})}\)</span>作为检验界值，“球对称”系数的常用估计方法有Greenhouse-Geisser、Huynh-Feldt和Lower-bound三种方法，例如，表12-4组内效应的F界值为<span class="math inline">\(F_{0.05,(3,21)}=3.07\)</span>，Greenhouse-Geisser的校正系数0.536校正后的F界值为<span class="math inline">\(F_{0.05,(1.6,11.25)}\approx F_{0.05,(1,11)}=4.84\)</span>，大于未校正的界值3.07，也就是说当重复测量数据不满足”球对称“假设时，采用随机区组设计方差分析时，增大了I型错误（无差别判断为有差别）的概率，当样本含量较小时，Mauchly”球对称“检验交通较低，易发生II型错误（不满足”球对称“判断为满足），此时，对处理组内效应F界值的自由度<span class="math inline">\(\nu_{1}\)</span>和<span class="math inline">\(\nu_{2}\)</span>仍要进行校正，以得到可信的统计结论。</p>
<h3 id="重复测量数据的两因素两水平分析">重复测量数据的两因素两水平分析</h3>
<h4 id="两因素离均差平方和分解">两因素离均差平方和分解</h4>
<p>将重复测量测序的干预因素作为A因素，共两个水平，1水平为”对照“，2水平为”干预“；前后两次测量时间作为B因素，共两个水平，1水平为”第1次测量时间“，2水平为”第2次测量时间“，这样共有(a1b1)、(a1b2)、(a2b1)、(a2b2)4个”处理“组，各组观察值的合计分别为T1、T2、T3、T4表示，A因素两水平的小计分别用A1、A2表示，B因素两水平的小计分别用B1、B2表示，处理组和对照组的例数相等，即n=n1=n2，<code>SS处理</code>可分解为A因素的离均差平方和<span class="math inline">\(SS_{A}\)</span>，B因素的离均差平方和<span class="math inline">\(SS_{B}\)</span>，AB交互作用的离均差平方和<span class="math inline">\(SS_{AB}\)</span>三部分，见表12-8，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115904.png">

</div>
<p>将表12-2的数据按照表12-8进行两因素离均差平方和进行分解，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115916.png">

</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180822/LHlIFDl6i8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>主效应与交互作用的离均差平方和分解：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115929.png">

</div>
<h3 id="组间组内离均差平方和分解与方差分析">组间、组内离均差平方和分解与方差分析</h3>
<p>重复测量数据的差异由两部分组成。一是观察对象的个体差异，其离均差平方和记作<code>SS组间</code>，二是每个观察对象前后两次观察之间的差异，其离均差平方和记作<code>SS组内</code>，设两组观察对象都为n，每个观察对象前后两次观察的合计值为<code>Mj</code>，<code>SS组间</code>和<code>SS组内</code>的计算方法见表12-9，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115942.png">

</div>
<p><code>SS组间</code>、<code>SS组内</code>分解完毕后，就可以用方差分析对A因素主效应、B因素主效应和AB因素交互作用进行假设检验了，由于A因素（干预分组）的作用于观察以刚，作用效应在<code>SS组间</code>，方差分析按表12-10进行，B因素主效应（测量前后）和AB交互作用的效应在<code>SS组内</code>,方差分析按表12-11进行，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629115955.png">

</div>
<p>现在根据表12-2中的数据，对处理组与对照组、治疗前后舒张压的差别进行统计分析。</p>
<h4 id="计算ss_组间ss_组内">1.计算<span class="math inline">\(SS_{组间}\)</span>、<span class="math inline">\(SS_{组内}\)</span></h4>
<p>表12-2共有20名患者，每个患者舒张压的合计为M1=130+114=244，M2=124+110=234，…，M19=120+124=244，M20=134+128=262，由于前面已经计算出C=580328.1，按表12-9中的公式计算，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120007.png">

</div>
<h4 id="测量前后比较与交互作用分析">2.测量前后比较与交互作用分析</h4>
<p>由于已经计算出了<span class="math inline">\(SS_{B}=1020.1,SS_{AB}=348.1\)</span>，现在<code>SS组内</code>=1702，代入表12-11，得到方差分析表，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120021.png">

</div>
<h4 id="处理组与对照组比较">3.处理组与对照组比较</h4>
<p>前面已经计算出<span class="math inline">\(SS_{A}=202.5\)</span>，现在<code>SS组间</code>=2517.9，代入表12-10，得到方差分析表，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120032.png">

</div>
<h4 id="结论">4.结论</h4>
<p>①由表12-12的方差分析表可知，治疗前后舒张压的交效应有差别(P&lt;0.01)，由于表12-2计算可知，治疗前的平均舒张压为(126.2+124.8)/2=125.5mmHg，治疗后的平均舒张压为(110.2+120.6)/2=115.4mmHg，治疗前后舒张压主效应的估计值为115.4-125.5=-9.6mmHg。①由表12-13方差分析表，不考虑测量时间，处理组与对照组舒张压的主效应未见差别(P&gt;0.05)，由原始数据过计算，处理组的平均舒张压为(126.2+110.2)/2=118.2mmHg，对照组的平均舒张压为(124.8+120.6)/2=122.7mmHg，处理组与对照组舒张压主效应的估计值为118.2-122.7=-4.5mmHg。③由表12-12方差分析表可知，测量前后与处理存在交互作用(P&lt;0.01)，即处理组和对照组治疗前后的舒张压的变化幅度不同。由单独效应、主效应和交互作用的概念可知，若存在交互作用，单独分析主效应的意义不大，需要爱一分析各因素的单位效应，按表12-2计算处理组和对照组的单独效应，处理组和对照组治疗前的基线数据没有统计学差异，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120101.png">

</div>
<p>但处理组和舒张压平均下降16.0mmmHg，对照组平均仅下降4.2mmHg，AB交互作用F=18.8，P&lt;0.01，说明处理组的降压效应优于对照组。</p>
<h2 id="随机区组设计">随机区组设计</h2>
<p>随机区组设计(randomized block design)又称为配伍组设计，是配对设计的扩展。具体做法是：先按影响实验结果的非处理因素（如性别、体重、年龄、职业、病情、病程等）将实验对象配成区组(block)，再分别将各区组内的实验对象随机分配到各处理组或对照组。与完全随机设计相比，随机区组设计的特点是随机同分配的次数要重复多次，每次随机分配都对同一个区组内的实验对象进行，且各个处理组的实验对象数量相同，区组内均衡。在进行统计分析时，将区组变异离均差平方和从完全随机设计的组内离均差平方和中分离出来，从而减小组内离均差平方和（误差平方和），提高统计检验效率。若将区组作为另一处理因素的不同水平，随机区组设计等同于无重复观察的两因素设计。</p>
<p>现在看一下随机区组设计的案例。</p>
<p>如何按随机区组设计，分配5个区组的15只小白鼠接受甲、乙、丙三种抗癌药物？</p>
<p>方法为先将小白鼠的体重从轻到重编号，体重相近的3只小白鼠配成一个区组（下表中第一行和第二行），然后对这些小鼠分配随机数，在每个区组内将随机数按大小排序（下表第四行），各区组中序号为1的接受甲药、序号为2的接受乙药、序号为3的接受丙药，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120119.png">

</div>
<p>随机区组设计资料在进行统计分析时，需要根据数据特征选择方法，对于正态分布且方差齐同的资料，采用双向分类的方差分析(two-way classification ANOVA)或配对t检验(g=2)，当不满足方差分析或t检验条件时，可以进行变量变换后采用双向分析的方差分析或采用Fredman M检验。</p>
<h2 id="重复测量数据的两因素多水平分析">重复测量数据的两因素多水平分析</h2>
<p>大多数医学实验都有重复测量记录，如果统计分析时只分析最后一次的测量结果，那就会丧失很多“过程“信息，如果通过记录不同时间点的重复观察数据了解测量指标的时间变化趋势、药物在血中浓度变化的时间分析特征、不同时间的治疗效果等。在临床上，各个单个时间的测量值或许都在正常参考值范围以内（或以外），但如果发现该测量值持续上升（或下降），也说明患者的状态处理变化中，在统计分析时，保留”处理“前的基线(baseline)，如前面所述的患者治疗前收缩压，可以评价随机分级的均衡性，也能够提高统计分析的效率。</p>
<h3 id="实验设计方法">实验设计方法</h3>
<p>一般来说，任何实验设计都可以采用重复测量计算，即在实验过得中定期记录观察结果。所谓重复测量数据的两因素多水平设计，两因素指干预（A因素）和测量时间（B因素），多水平指干预（A因素）有g（大于等于2）个水平，测量时间（B因素）有m（大于等于2）个水平（时间点），即每个观察对象有m个重复测量数据，随机化分组是将作用于观察对象的g个干预随机分配，前面提到的重复测量数据的两因素两水平是两因素多水平的设计的特征，即g=m=2.</p>
<h3 id="试验结果的方差分析">试验结果的方差分析</h3>
<p>重复测量数据的统计分析有许多统计方法供选用，可以用单因素方差分析，也可以用多变量方差分析(MANOVA)，其中单因素方差分析最简单。设有观察对象随机等分成g个干预组，每组倒数为n，重复测量次数为m，每个观察对象测量值合计为<span class="math inline">\(M_{j}\)</span>，g个干预组，每组的测量值合计为<span class="math inline">\(A_{i}\)</span>。多个干预组比较的方差分析用表12-14，设<span class="math inline">\(B_{j}\)</span>表示第j个时间的测量值合计，<span class="math inline">\(T_{ij}\)</span>表示第i个干预，第j个时间的点测量值合计，多个时间点测量前后与交互作用的方差分析见表12-15，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120132.png">

</div>
<h3 id="案例分析b-1">案例分析B</h3>
<p>将手术要求基本相同的15名患者随机分为3组，在手术过程中分别采用A、B、C三种麻醉诱导方法，在T0（诱导前）、T1、T2、T3、T4五个时间点测量患者的收缩压，数据记录见表12-16，试进行方差分析，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120146.png">

</div>
<h4 id="分解ss_组间ss_组内">1.分解<span class="math inline">\(SS_{组间}，SS_{组内}\)</span></h4>
<p>g=3,m=5,n=5,15名患者的合计分别为：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120158.png">

</div>
<h4 id="分解ss_ass_bss_ab">2.分解<span class="math inline">\(SS_{A}，SS_{B},SS_{AB}\)</span></h4>
<p>分组计算不同麻醉诱导、不同时间点患者的收缩压的合计值(<span class="math inline">\(T_{ij}\)</span>)，见表12-17，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120212.png">

</div>
<h4 id="方差分析表">3.方差分析表</h4>
<p>按表12-14、12-15列出方差分析表。</p>
<h4 id="f值的界值校正">4.F值的界值校正</h4>
<p>按表12-15的Lower-Bound自由度校正方法，<span class="math inline">\(F_{B}\)</span>的校正自由度<span class="math inline">\(\tau_{1}=1,\tau_{2}=g(n-1)=3 \times(5-1)=12\)</span>，查F界值表，<span class="math inline">\(F_{B}\)</span>的校正界值为<span class="math inline">\(F_{0.01,(1,12)=9.33}\)</span>（校正前为<span class="math inline">\(F_{0.01,(4,48)=3.74}\)</span>）。<span class="math inline">\(F_{AB}\)</span>的校正自由度<span class="math inline">\(\tau_{1}=g-1=2,\tau_{2}=g(n-1)=3 \times(5-1)=12\)</span>，查F界值表，<span class="math inline">\(F_{AB}\)</span>的校正界值为<span class="math inline">\(F_{0.01,(2,12)=6.93}\)</span>（校正前为<span class="math inline">\(F_{0.01,(8,48)=2.90}\)</span>），校正后的自由度和P值见下表：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120224.png">

</div>
<h4 id="结论-1">5.结论</h4>
<p>不同麻醉诱导方法存在组间差别，见表12-18：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120237.png">

</div>
<p>患者的收缩压在不同的诱导方法下，不同诱导时相变化的趋势不同，见表12-19:</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120250.png">

</div>
<p>其中A组不同诱导时间收缩压相对稳定，见表12-20，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120302.png">

</div>
<h3 id="重复测量数据的多重比较">重复测量数据的多重比较</h3>
<p>重复测量数据的多重比较是一个比较复杂的问题，对不同研究有不同的要求，例如前面提到的，A、B、C三种麻醉诱导方法存在差别，每组患者不同诱导时相收缩压的趋势不同，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120314.png">

</div>
<p>多重比较可能包括3种情况，一是A、B、C三组收缩压均数差别的两两比较，需要重复检验3次（A与B，A与C，B与C）；二是各组T0，T1，T2，T3和T4这5个不同时相收缩压均数变化曲线是否有固定趋势（<span class="math inline">\(H_{0}:\mu_{i}=\mu,i=1,2,3,4,5\)</span>)其中，<span class="math inline">\(\mu\)</span>是收缩压均数，如果拒绝H0，对于5次重复测量结果，曲线经下次多项式(polynomial)变换，需要检验下次多项式1次(linear)、2次(quadratic)、3次(cubic)、4次(order 4)是否为0，上图中的三条曲线共需要重复检验12次；三是各组T0，T1，T2，T3，T4这5个不同时相收缩压均数的两两比较，每组需要比较10次，3组共要做30次重复检验 。因此，前面提到的例题的多重检比较需要做2+12+30=44次。下面我们列出了SPSS重复测量数据的多重比较的计算结果。</p>
<h4 id="组间差别多重比较">组间差别多重比较</h4>
<p>在表12-18基础上进行两两比较，误差均方为<span class="math inline">\(\sqrt{946.48/4}=15.38\)</span>，由表12-20可知，A、B、C三组收缩压均数分别为119.68、124.48、128.20，两两比较可以选择LSD、SNK、Bonferroni等多重比较方法，下图为LSD两两比较结果，其中A与C的差别有统计学意义，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120331.png">

</div>
<h4 id="时间趋势比较">时间趋势比较</h4>
<p>由表12-20可知，A组5个时相的收缩压分别为121.00，112.40，118.40，125.80，120.80，在SPSS中选择Polynomial正交多项式。表12-23就列出了A组收缩压均数5个时相的时间趋势检验结果，正交多项式1次项、3次项有统计学意义(P&lt;0.05)，拒绝<span class="math inline">\(H_{0}:\mu_{i}\neq \mu\)</span>。B组和C组的时间趋势检验结果见表12-24、表12-25，正交多项式1次项、2次项、4次项均有统计学意义，拒绝<span class="math inline">\(H_{0}:\mu_{i}\neq \mu\)</span>。如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120343.png">

</div>
<h4 id="时间点的多重比较">时间点的多重比较</h4>
<p>一些医学研究关心同一个处理重复测量数据时间点的两两差别，如例12-3中A组5个时相收缩压均数之间的差别。由于当时间点较多时，重复检验次数将难以承受，如果假定5个处理组，10个时间点，重复检验次数就是5x45=225次。因此，时间点多重比较通常采用事前检验(prior tests)的策略。事前检验与事后检验(ost hoc tests)的不同之处在于，事前检验的检验次数是在试验开始前就确定了，无论方差分析结论如何都执行重复检验，比较的时间点按专业意义设定，如试验后各时间点均数与基线比较，重复检验次数比较少。事后检验则是方差分析结果拒绝<span class="math inline">\(H_{0}\)</span>才进行两两比较，通常所有的时间上炽都要比较、重复检验次数较多。</p>
<p>按照事前检验策略，例12-3中A组5个时间收缩压均数差别的两两比较，只比较麻醉诱导后各时相T1，T2，T3，T4与诱导前T0的差别，只需要检验4次，采用Bonferroni多重比较方法，设定α=0.05，检验的名义水准为<span class="math inline">\(a&#39;=0.05/4=0.0125\)</span>，下表为SPSS的检验结果，可以发现，A组麻醉诱导后的4个时相与诱导前比较的重复检验，仅T1收缩压降低(P&lt;0.05)。B组诱导后T2收缩压降低，T3、T4收缩压增高(P&lt;0.05)，C组诱导后T2收缩压降低，T3收缩压升高(P&lt;0.05)，因此A组麻醉诱导后收缩压的波动小于B组和C组，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190629120437.png">

</div>
<h1 id="例11-122析因设计">例11-1：2×2析因设计</h1>
<p>将20只家兔随机等分4组，每组5只，进行神经损伤后的缝合试验。处理由两个因素组合而成，A因素为缝合方法，有两水平，一水平为外膜缝合，另一水平为束膜缝合，B因素为缝合后的时间，有两水平，一水平为缝合后1月，另一水平为缝合后2月。试验结果为家兔神经缝合后的轴突通过率(%)（注：测量指标，视为计量资料），见表11-1。欲比较不同缝合方法及缝合后时间对轴突通过率的影响，试做析因方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data1101 &lt;- c(10,10,40,50,10,30,30,70,60,30,10,20,30,50,30,50,50,70,60,30)</div><div class="line">factor_a &lt;- gl(2,10) # a取两个水平，每个水平数量是10个，排列顺序是1...2...</div><div class="line">factor_b &lt;- rep(gl(2,5),2) # b取两个水平，每个水平是10个，排列顺序是1..2..1..2</div><div class="line">data1101.aov &lt;- aov(data1101~factor_a+factor_b+factor_a*factor_b) # factor_a*factor_b表示a与b的交互作用</div><div class="line">summary(data1101.aov)</div></pre></td></tr></table></figure>
<p>从上述分析结果可以看出，只有B因素的主效应达到了p&lt;0.05，而A因素的主效应p&gt;0.05，A与B的交互作用的p&gt;0.05，结论为：沿不能认为两咱缝合方法对神经轴突通过率有影响，但缝合后2个月与1个月相比，神经轴突通过率提高了。</p>
<h1 id="例11-2ij两因素析因分析">例11-2：I×J两因素析因分析</h1>
<p>观察A,B两种镇痛药物联合运用在产妇分娩时的镇痛效果。A药取3个剂量：1.0mg，2.5mg，5.0mg；B药也取3个剂量：5 ，15 ，30 。共9个处理组。将27名产妇随机等分为9组，每组3名产妇，记录每名产妇分娩时的镇痛时间，结果见表11-7。试分析A,B两药联合运用的镇痛效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data1102 &lt;- c(105,80,65,75,115,80,85,120,125,115,105,80,125,130,90,65,120,100,75,95,85,135,120,150,180,190,160)</div><div class="line">drug_a &lt;- factor(rep(gl(3,3),3))</div><div class="line">drug_b &lt;- factor(gl(3,9))</div><div class="line">data1102.aov &lt;- aov(data1102~drug_a+drug_b+drug_a*drug_b)</div><div class="line">summary(data1102.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-3ijk三因素析因分析">例11-3：I×J×K三因素析因分析</h1>
<p>用5×2×2析因设计研究5种类型的军装在两种环境、两种活动状态下的散热效果，将100名受试者随机等分20组，观察指标是受试者的主观热感觉(从“冷”到“热”按等级评分)，结果见表11-11。试进行方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data1103 &lt;- c(0.25,0.3,0.75,0.2,-0.1,-0.25,0.1,-0.5,-1,0,1.25,0.5,0.6,0.85,2.5,-0.75,-0.35,0.4,-0.5,0.1,0.4,0.05,-0.2,0.9,-0.1,4.75,4.6,4.55,4.25,4.72,3.45,4.8,3.5,3.1,4.3,4,4,4.25,4,4.1,4.85,5.2,4.1,5,4.8,4.55,4.3,4.4,4.2,3.6,0.5,1.5,0.75,-0.75,1.75,2.1,1.5,2.65,0.9,2.4,2.75,1.25,3,0.95,1.75,1,1.37,0.05,0.62,3.05,2.35,2.55,1.17,1.05,2.75,3.75,4,4.1,3.27,4.8,4,4.05,5,4.25,4.02,4,4.15,4.2,4,4.15,4.25,4.1,4.15,4.25,4.75,4.6,4.25,4.17,4.25,4.8)</div><div class="line"></div><div class="line">a &lt;- factor(rep(1:5,20))</div><div class="line">b &lt;- factor(rep(1:2,each=50))</div><div class="line">c &lt;- factor(rep(c(1,2,1,2),each=25))</div><div class="line"></div><div class="line">data1103.aov &lt;- aov(data1103~a+b+c+a*b+a*c+b*c+a*b*c)</div><div class="line">summary(data1103.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-4">例11-4</h1>
<p>研究雌螺产卵的最优条件，在20cm2的泥盒里饲养同龄雌螺10只，试验条件有4个因素（见表11-15），每个因素2个水平。试在考虑温度与含氧量对雌螺产卵有交互作用的情况下安排正交试验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data1104 &lt;- c(86, 95,91,94,91,96,83,88)</div><div class="line">A &lt;- factor(rep(1:2,each=4))</div><div class="line">B &lt;- factor(gl(2,2,8))</div><div class="line">AB &lt;- factor(c(1,1,2,2,2,2,1,1))</div><div class="line">C &lt;- factor(rep(1:2,4))</div><div class="line">D &lt;- factor(c(1,2,2,1,2,1,1,2))</div><div class="line">data1104.aov &lt;- aov(data1104~A+B+AB+C+D)</div><div class="line">summary(data1104.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-5">例11-5</h1>
<p>研究高频呼吸机A，B，C，D，E五个参数对通气量的影响，每个参数有高、低两个水平，试按正交设计安排试验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data1105 &lt;- c(16.26, 19.38,23.6,28.43,20.28,34.88,49.1,47.44,18.32,24.85,39.45,32.08,45.5,50.3,55.26,66.64)</div><div class="line">A &lt;- factor(rep(1:2,each=8)) # 产生2个水平的因子，每个因子8个</div><div class="line">B &lt;- factor(gl(2,4,16)) # 产生2个水平的因子，每个因子4个，并且把向量B补充到16个元素</div><div class="line">C &lt;- factor(gl(2,2,16))</div><div class="line">D &lt;- factor(rep(1:2,8)) # 产生2个水平的因子，2个水平的因子作为整体，复制8遍</div><div class="line">E &lt;- factor(c(1,2,2,1,2,1,1,2,2,1, 1,2,1,2,2,1))</div><div class="line"></div><div class="line">data1105.aov &lt;- aov(data1105~A+B+C+D+E)</div><div class="line">summary(data1103.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-6">例11-6</h1>
<p>试验甲、乙、丙三种催化剂在不同温度下对某化合物的转化作用。由于各催化剂所要求的温度范围不同，将催化剂作为一级实验因素（I=3），温度作为二级实验因素（J=3），采用嵌套设计，每个处理重复2次（n=2），试验结果见表11-25。试做方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">catalyst &lt;- factor(gl(3,6,18))</div><div class="line">temperature &lt;- factor(rep(c(70,80,90,55,65,75,90,95,100),each=2))</div><div class="line">data1106 &lt;- c(82, 84,91,88,85,83,65,61,62,59,56,60,71,67,75,78,85,89)</div><div class="line"></div><div class="line">data1106.aov &lt;- aov(data1106~catalyst+temperature)</div><div class="line">summary(data1106.aov)</div></pre></td></tr></table></figure>
<h1 id="例11-7">例11-7</h1>
<p>试验一种全身注射抗毒素对皮肤损伤的保护作用试验，将10只家兔随机等分两组，一组注射抗毒素，一组注射生理盐水作对照。分组后，每只家兔取甲、乙两部位，分别随机分配注射低浓度毒素和高浓度毒素，观察指标为皮肤受损直径(mm)，试验结果见表11-31。试做方差分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A &lt;- factor(gl(2,5,20))</div><div class="line">B &lt;- factor(rep(1:2,each=10))</div><div class="line">data1107 &lt;- c(15.75,15.5,15.5,17,16.5,18.25,18.5,19.75,21.5,20.75,19,20.75,18.5,20.5,20,22.25,21.5,23.5,24.75,23.75)</div><div class="line">data1107.aov &lt;- aov(data1107~A+B)</div><div class="line">summary(data1107.aov)</div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>白话统计.冯国双</li>
<li>医学统计学.孙振球.第四版</li>
<li>数据分析：R语言实战.李诗羽.电子工业出版社</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07协方差分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/BioStatistics/生物统计-07协方差分析/" itemprop="url">协方差分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T12:01:00+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,199
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>方差分析方法可以用于比较两组或多组均数，其处理因素一般是可以控制的。方差分析要求各比较组除了所施加的处理因素不同外，其它对观察指标有影响的因素应齐同或均衡。</p>
<p>例如，我想要研究某个药物的不同剂量对小鼠的体重影响时，我们要保证每组的小鼠体重在给药前都相同或接近。</p>
<p>但是在实际工作中，有时候有些因素根本无法控制，或者由于实验设计的疏忽、实验条件的限制等原因造成对观察指标有影响的个别因素未加控制或难以它抑制。</p>
<p>例如，在降压药物疗效考核的临床试验中，患者的初始血压水平对服药一段时间后的血压下降量有影响，但患者的初始血压水平是难以控制的。如果不考虑各组患者的初始血压水平的差异，直接用方差分析的方法比较不同处理组患者的平均血压下降量，以评价药物的降压效果是不恰当的。如何在比较两组或多组均数的同时扣除或均衡这些不可控制因素的影响，可以考虑协方差分析的方法。</p>
<h2 id="协方差矩阵">协方差矩阵</h2>
<p>举个例子，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">0.8</span>,<span class="number">1.5</span>,<span class="number">1.6</span>,<span class="number">1.4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3.1</span>,<span class="number">3.9</span>,<span class="number">4.6</span>)</div><div class="line">y &lt;- c(<span class="number">0.6</span>,<span class="number">1.3</span>,<span class="number">1.9</span>,<span class="number">3.0</span>,<span class="number">2.2</span>,<span class="number">3.1</span>,<span class="number">3.9</span>,<span class="number">4.8</span>,<span class="number">4.9</span>)</div><div class="line">plot(x,y)</div><div class="line">abline(h=mean(x))</div><div class="line">abline(v=mean(y))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190706174354.png">

</div>
<p>上图是x与y对应的散点图，我们把这个图形分为4个象限，即1、2、3、4，现在我们求一组值，分别为：</p>
<p><span class="math inline">\(y_{i}-\bar{y}\)</span>：每一个y值与y均值的偏离；</p>
<p><span class="math inline">\(x_{i}-\bar{x}\)</span>：每一个x值与x均值的偏离；</p>
<p><span class="math inline">\((y_{i}-\bar{y})\times (x_{i}-\bar{x})\)</span>。</p>
<p>这3组值分别如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">0.8</span>,<span class="number">1.5</span>,<span class="number">1.6</span>,<span class="number">1.4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3.1</span>,<span class="number">3.9</span>,<span class="number">4.6</span>)</div><div class="line">y &lt;- c(<span class="number">0.6</span>,<span class="number">1.3</span>,<span class="number">1.9</span>,<span class="number">3.0</span>,<span class="number">2.2</span>,<span class="number">3.1</span>,<span class="number">3.9</span>,<span class="number">4.8</span>,<span class="number">4.9</span>)</div><div class="line">diff_x_mean &lt;- x - mean(x)</div><div class="line">diff_y_mean &lt;- y - mean(y)</div><div class="line">diff_x_mean * diff_y_mean</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; diff_x_mean</div><div class="line">[<span class="number">1</span>] -<span class="number">1.6333333</span> -<span class="number">0.9333333</span> -<span class="number">0.8333333</span> -<span class="number">1.0333333</span> -<span class="number">0.4333333</span>  <span class="number">0.5666667</span>  <span class="number">0.6666667</span></div><div class="line">[<span class="number">8</span>]  <span class="number">1.4666667</span>  <span class="number">2.1666667</span></div><div class="line">&gt; diff_y_mean</div><div class="line">[<span class="number">1</span>] -<span class="number">2.2555556</span> -<span class="number">1.5555556</span> -<span class="number">0.9555556</span>  <span class="number">0.1444444</span> -<span class="number">0.6555556</span>  <span class="number">0.2444444</span>  <span class="number">1.0444444</span></div><div class="line">[<span class="number">8</span>]  <span class="number">1.9444444</span>  <span class="number">2.0444444</span></div><div class="line">&gt; diff_x_mean * diff_y_mean</div><div class="line">[<span class="number">1</span>]  <span class="number">3.6840741</span>  <span class="number">1.4518519</span>  <span class="number">0.7962963</span> -<span class="number">0.1492593</span>  <span class="number">0.2840741</span>  <span class="number">0.1385185</span>  <span class="number">0.6962963</span></div><div class="line">[<span class="number">8</span>]  <span class="number">2.8518519</span>  <span class="number">4.4296296</span></div></pre></td></tr></table></figure>
<p>这里面有正有负，可以得出以下结果：</p>
<p>1、2象限中，<span class="math inline">\(y_{i}-\bar{y}\)</span>为正，3、4象限中，<span class="math inline">\(y_{i}-\bar{y}\)</span>为负，</p>
<p>1、4象限中，<span class="math inline">\(x_{i}-\bar{x}\)</span>为正，2、3象限中，<span class="math inline">\(x_{i}-\bar{x}\)</span>为负。</p>
<p>画成表格就是下面的样子：</p>
<table>
<thead>
<tr class="header">
<th>象限</th>
<th><span class="math inline">\(y_{i}-\bar{y}\)</span></th>
<th><span class="math inline">\(x_{i}-\bar{x}\)</span></th>
<th><span class="math inline">\((y_{i}-\bar{y})\times (x_{i}-\bar{x})\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>+</td>
<td>+</td>
<td>+</td>
</tr>
<tr class="even">
<td>2</td>
<td>+</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>3</td>
<td>-</td>
<td>-</td>
<td>+</td>
</tr>
<tr class="even">
<td>4</td>
<td>-</td>
<td>+</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>通过上面的结果可以得出以下结论：</p>
<p>如果x和y变动一致，此时</p>
<p>根据这3组值，可以得到以下结论：</p>
<p>其中红色方框的部分是每列的方差，蓝色表示的是两两组合后（也就是xy，xz，yz）的协方差，其中我们可以发现，左下角用蓝色圈起来的部分与右上的未圈部分是一样的。用红色圈起来的部分好理解，在R中直接使用<code>var(x)</code>或<code>sd(x)^2</code>就可以直接计算，现在讲一下协方差如何计算，它的公式如下所示：</p>
<p><span class="math inline">\(cov(X,Y)=\frac{\sum_{i=1}^n (X_{i}-\bar{X})(Y_{i}-\bar{Y})}{n-1}\)</span></p>
<p>这个公式如果不好理解的话，可以看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">49</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">19</span>,<span class="number">3</span>,<span class="number">34</span>,<span class="number">20</span>,<span class="number">49</span>,<span class="number">20</span>,<span class="number">31</span>)</div><div class="line">y &lt;- c(<span class="number">7</span>,<span class="number">19</span>,<span class="number">8</span>,<span class="number">37</span>,<span class="number">43</span>,<span class="number">17</span>,<span class="number">34</span>,<span class="number">14</span>,<span class="number">26</span>,<span class="number">41</span>)</div><div class="line">z &lt;- c(<span class="number">29</span>,<span class="number">16</span>,<span class="number">14</span>,<span class="number">22</span>,<span class="number">21</span>,<span class="number">17</span>,<span class="number">27</span>,<span class="number">37</span>,<span class="number">21</span>,<span class="number">21</span>)</div><div class="line">cov_data &lt;- matrix(c(x,y,z),ncol=<span class="number">3</span>)</div><div class="line">colnames(cov_data) &lt;- c(<span class="string">"x"</span>,<span class="string">"y"</span>,<span class="string">"z"</span>)</div><div class="line">cov_data</div><div class="line"><span class="comment"># x  y  z</span></div><div class="line"><span class="comment"># [1,] 49  7 29</span></div><div class="line"><span class="comment"># [2,]  8 19 16</span></div><div class="line"><span class="comment"># [3,] 12  8 14</span></div><div class="line"><span class="comment"># [4,] 19 37 22</span></div><div class="line"><span class="comment"># [5,]  3 43 21</span></div><div class="line"><span class="comment"># [6,] 34 17 17</span></div><div class="line"><span class="comment"># [7,] 20 34 27</span></div><div class="line"><span class="comment"># [8,] 49 14 37</span></div><div class="line"><span class="comment"># [9,] 20 26 21</span></div><div class="line"><span class="comment"># [10,] 31 41 21</span></div></pre></td></tr></table></figure>
<p>以上面的这个矩阵为例说明一下<code>cov(X,Y)</code>是如何计算的，计算公式表示，x的值减去x的均值得到一个向量，y的值减去y的均值，得到一个向量，这两个向量相乘，并除以n-1（这里就是9了），就得到了<code>cov(X,Y)</code>，现在计算一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sum((x-mean(x))*(y-mean(y))/(length(x)-<span class="number">1</span>))</div><div class="line">[<span class="number">1</span>] -<span class="number">96.55556</span></div></pre></td></tr></table></figure>
<p>那么此时，<code>cov_data</code>协方差矩阵的第1列，第2行或第2列第1行的值就是-96.55556，也就是下面的黄色部分，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/9lkfGGFcJL.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>接着再计算<code>cov(z,x)</code>和<code>cov(z,y)</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; sum((x-mean(x))*(z-mean(z))/(length(x)-<span class="number">1</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">76.38889</span></div><div class="line">&gt; sum((z-mean(z))*(y-mean(y))/(length(x)-<span class="number">1</span>))</div><div class="line">[<span class="number">1</span>] -<span class="number">7.444444</span></div></pre></td></tr></table></figure>
<p>把它们填到这个矩阵中，就是下面的这个样子：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/cGaLIDmJ35.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>剩下的绿色部分就是每列的方差的，很好计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; var(x)</div><div class="line">[<span class="number">1</span>] <span class="number">254.9444</span></div><div class="line">&gt; <span class="comment"># 或sd(x)^x</span></div><div class="line">&gt; var(y)</div><div class="line">[<span class="number">1</span>] <span class="number">182.0444</span></div><div class="line">&gt; sd(z)^<span class="number">2</span></div><div class="line">[<span class="number">1</span>] <span class="number">47.16667</span></div></pre></td></tr></table></figure>
<p>再补充好矩阵，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/a4kghcFa6f.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上面只是过计算过程，在R中直接使用<code>cov()</code>函数即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; cov(cov_data)</div><div class="line">          x          y         z</div><div class="line">x <span class="number">254.94444</span> -<span class="number">96.555556</span> <span class="number">76.388889</span></div><div class="line">y -<span class="number">96.55556</span> <span class="number">182.044444</span> -<span class="number">7.444444</span></div><div class="line">z  <span class="number">76.38889</span>  -<span class="number">7.444444</span> <span class="number">47.166667</span></div></pre></td></tr></table></figure>
<p>在R中协方差矩阵的计算原理就搞清楚了。</p>
<h2 id="协方差分析基本思想">协方差分析基本思想</h2>
<p>协方差分析(analysis of covariance)是将线性回归分析与方差分析结合起来的一种统计方法。在协方差分析中，影响观察指标Y（应变量）的往往是一些定性变量；而在线性回归分析中，影响Y的都是定量变量。协方差分析的基本思想就是将那些定量产变量X（指未加或难以控制的因素）对Y的影响看作协变量(covariate)，建立应变量Y随协变量X变化的线性回归关系，并利用这种回归关系把X值化为相等后再进行各级Y的修正均数(adjusted means)的比较，其实质是从Y的总平方和中扣除协变量X对Y的回归平方和，对残差平方和作进一步分解后再进行方差分析，以更好地评价处理因素的效应。</p>
<p>按方差分析不同实验设计类型，相应有不同的协方差分析，如有完全随机设计、随机区组（配伍组）设计、拉丁方设计和析因设计等类型的协方差分析，而且协变量可以有一个、两个或多个，分析方法略有不同，但其解决问题的基本思想相同。</p>
<h2 id="应用条件">应用条件</h2>
<p>协方差分析有两个重要的应用条件：一是与方差分析的应用条件相同，即理论上要求观察变量服从正态分布，各观察变量相互独立，各样本的总体方差齐性；二是各总体客观存在应变量对协变量的线性回归关系且斜率相同（回归线平行），即要求各样本回归系数b本身有统计学意义而各样本回归系数b间的差别无统计学意义。因此，进行协方差分析时，必须先对样本资料进行方差齐性检验和回归系数的假设检验，若满足这两个条件或经变量变换后满足这两个条件，才可作协方差分析。</p>
<p>协方差分析要求协变量是连续变量，而且不能是影响处理的变量，其取值应在研究之前被观察；或者虽在研究中被观察，但不能受到处理的影响。</p>
<p>协方差分析中比较的修正均数，而修正均数实际上是假设协变量取值固定在其总均数时的观察变量的均数。修正均数间的差别与实际均数间的差别并不是一回事，只是用作合理比较。当各比较组的协变量相关悬殊时，协变量的总均数可能不落在各处理组协变量的实测范围内，这时的修正均数可能是对回归线的一种外推，但是这种外推是否仍满足线性和平等的条件无人知晓。因此，协方差分林的时最好先对协变量间的差别作假设检验，协方差分析应用于协变量均数间差别不大的资料较好，利于对分析结果作出较恰当的解释。</p>
<p>如果在多因素研究中有一个或多个因素（协变量）不能或难以控制，而这个或这些协变量对观察变量可能有影响，解决这一类问题可以用多元协方差分析方法(analysis of multiple covariance)。</p>
<h2 id="分析步骤">分析步骤</h2>
<p>现在我们以完全随机资料为例，设有G组回归样本，每组有n对观察值，总观察值对数为N=nG（一般情况为各组有<span class="math inline">\(n_{j}\)</span>对观察值，总观察值对数为<span class="math inline">\(N=n_{1}+n_{2}+\cdots+n_{G})\)</span>，其基础数据与协方差分析计算模式如表13-1和表13-2。</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180827/i5D4G975JD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180827/gg24L5fkFj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<ol style="list-style-type: decimal">
<li><p>计算各组<span class="math inline">\(\sum X_{j},\sum Y_{j},\sum X_{j}^2,\sum Y_{j}^2,\sum X_{j},\sum Y_{j},\bar{X_{j}},\bar{Y_{j}}\)</span></p></li>
<li><p>利用合计项各数据计算较正数<span class="math inline">\(C_{1},C_{2},C_{3}\)</span>，以及总变异的离均差平方和<span class="math inline">\(l_{XX},l_{YY}\)</span>积和<span class="math inline">\(l_{XY}\)</span>及自由度<span class="math inline">\(\nu\)</span>，如下所示：</p></li>
</ol>
<p><span class="math inline">\(C_{1}=\frac{(\sum X)^2}{N},C_{2}=\frac{\sum Y)^2}{N},C_{3}=\frac{\sum X \cdot \sum Y}{N}\)</span></p>
<p><span class="math inline">\(l_{XX}=\sum X^2=C_{1},l_{YY}=\sum Y^2=C_{2}\)</span></p>
<p><span class="math inline">\(l_{XY}=\sum XY=C_{3}\)</span></p>
<p><span class="math inline">\(\nu=N-1\)</span></p>
<ol start="3" style="list-style-type: decimal">
<li>计算各处理组间的离均差平方和<span class="math inline">\(l_{XX},l_{YY}\)</span>，积和<span class="math inline">\(l_{XY}\)</span>及自由度<span class="math inline">\(\nu\)</span>，如下所示：</li>
</ol>
<p><span class="math inline">\(l_{XX}=\sum \frac{(\sum X_{j})^2}{n_{j}}-C_{1}\)</span></p>
<p><span class="math inline">\(l_{XX}=\sum \frac{(\sum Y_{j})^2}{n_{j}}-C_{2}\)</span></p>
<p><span class="math inline">\(l_{XX}=\sum \frac{(\sum X_{j})\sum y_{j})}{n_{j}}-C_{3}\)</span></p>
<p><span class="math inline">\(\nu=G-1\)</span></p>
<ol start="4" style="list-style-type: decimal">
<li><p>列出协方差分析计算表13-2，将上述第2步，第3步的计算结果列入表的左侧部分，再由总变量的<span class="math inline">\(l_{XX},l_{XY}\)</span>及<span class="math inline">\(\nu\)</span>减去与处理组（组间）相应的各值，得到组内的<span class="math inline">\(l_{XX},l_{XY}\)</span>及<span class="math inline">\(\nu\)</span>。</p></li>
<li><p>计算回归估计估计误差平方和<span class="math inline">\(\sum(Y-\bar{Y})^2\)</span>及徙度，如表13-2右侧部分，其中总的平方和、组内平方和分别由下面的公式计算：</p></li>
</ol>
<p><span class="math inline">\(\sum(Y-\bar{Y})^2=l_{YY}-\frac{l_{XY}^2}{l_{XX}}\)</span></p>
<p>总的平方和减去组内平方和即为“修正零数”的平方和，总的及组内的自由度分别为表13-2左侧相应部分的自由度减去1，再由总的自由度减去组内的自由度得修正均数的自由度。</p>
<ol start="6" style="list-style-type: decimal">
<li>以修正均数和组内的估计误差平方和分别除以相应的自由度得到修正均数和组内的估计误差均方，简称为修正均数均方和组内均方，再按下面公式计算F值：</li>
</ol>
<p><span class="math inline">\(F=\frac{修正均数均方}{组内均方}\)</span></p>
<ol start="7" style="list-style-type: decimal">
<li><p>以上述公式中的公子和分母两均方的自由度查表F表，得到P值，按所设立的检验水准α作出统计推断，若<span class="math inline">\(P\leq \alpha\)</span>，则可认为各总体修正均数问总的来说有差别，但空间哪两组间有差别，哪两组间没有差别，必要的时候还要做进一步的多重比较。</p></li>
<li><p>若需要计算各修正均数，可先按下面的公式计算出公共回归系数(common regression coefficient)<span class="math inline">\(b_{c}\)</span>，再由下面的公式计算出各修正均数<span class="math inline">\(\bar{y_{j}}^*\)</span> <span class="math inline">\(b_{c}=\frac{组内l_{XY}}{组内l_{XX}},\quad \bar{Y_{j}}^*=\bar{Y_{j}}-b_{c}(\bar{X_{j}}-\bar{X})\)</span></p></li>
<li><p>修正均数间的多重比较，使用q检验，公式如下所示：</p></li>
</ol>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/f64H14EFIE.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>上式中<span class="math inline">\(\bar{Y_{A}}^*,\bar{Y_{B}}^*\)</span>为多重比较中任两个对比组的修正均数，分母为其差值的标准误，<span class="math inline">\(S_{Y \cdot X}^2\)</span>为组内估计误差的均方，<span class="math inline">\(n_{0}\)</span>为每组平均例数，a为将修正均数按大小顺序排列后两对比修正均数间所包含的组数，求得q之后，先按协方差分析表“估计误差”栏中组内自由度和a，查表得到p值，然后再按所设立的检验水准a作推断结论。</p>
<h2 id="完全随机设计资料的协方差分析">完全随机设计资料的协方差分析</h2>
<p>现在看一个案例A，如下所示： ### 案例A 为研究某降血糖药物的有效性及其合用盐酸二甲双胍片的有效性，选择收治90名2型糖尿病患者，并采用随机对照试验，分为三个治疗组，第一组为该降糖药组，第二组为盐酸二甲双胍片组，第三组为该降糖药+盐酸二甲双胍片组，每组30名患者，治疗3个月，主要有效性指标为糖化血红蛋白。测得每个患者入组前（X）和3个月后（Y）的糖化血红蛋白含量（％）见表13-3的上部，试分析三种治疗降糖化血红蛋白的效果是否不同（《医学统计学》（第四版，孙振球，例13-1，P204），数据如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/3bKglCCJ1A.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>各种计算结果如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/dfDflf2dJA.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在此例中，给予何种药物治疗是人为可以控制的定性因素，称为定性变量；患者初始（入组前）的糖化血红蛋白含量是难以控制的定量因素，称为协变量X；试验的观察指标是患者治疗3个月后的糖化血红蛋白含量，称为应变量Y，如果不考虑3组患者初始糖化血红蛋白含量不同的影响，那么此例就是一个典型的完全随机设计类的方差分析问题。</p>
<p>现在我们使用常规的方差分析来计算一下数据（这个案例不能用方差分析，这里使用方差分析只是为了说明一下为什么不能用方差分析），计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; summary(result_anova)</div><div class="line">            Df Sum Sq Mean Sq <span class="literal">F</span> value   Pr(&gt;<span class="literal">F</span>)    </div><div class="line">data1$group  <span class="number">2</span>  <span class="number">18.63</span>   <span class="number">9.314</span>   <span class="number">18.11</span> <span class="number">2.65e-07</span> ***</div><div class="line">Residuals   <span class="number">87</span>  <span class="number">44.73</span>   <span class="number">0.514</span>                     </div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div></pre></td></tr></table></figure>
<p>由上面的结果我们可以认为这3种治疗组降糖化血红蛋白的效果不同，但是这样得出的结论是不恰当的。因为从前面的原始数据我们可以得知，3种治疗组患者的初始糖化血红蛋白含量均数不同，第一组最高（10），第三组最低（9.947）。</p>
<p>仅对给药后的糖化血红蛋白进行方差分析，再经SNK-q的两两比较我们可以知道，除了第一组与第二组间的差异无统计学意义外（P&gt;0.05），第一组和第二组分别与第三组间的差异均有统计学意义(P&lt;0.01)，计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>结果如下所示（只截取了各组均分与两两比较的结果）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$means</div><div class="line">         y       std  r Min  Max   Q25 Q50   Q75</div><div class="line"><span class="number">1</span> <span class="number">8.443333</span> <span class="number">0.7398431</span> <span class="number">30</span> <span class="number">7.2</span> <span class="number">10.0</span> <span class="number">8.000</span> <span class="number">8.5</span> <span class="number">8.800</span></div><div class="line"><span class="number">2</span> <span class="number">8.803333</span> <span class="number">0.7471709</span> <span class="number">30</span> <span class="number">7.1</span> <span class="number">10.2</span> <span class="number">8.200</span> <span class="number">8.9</span> <span class="number">9.150</span></div><div class="line"><span class="number">3</span> <span class="number">7.710000</span> <span class="number">0.6609032</span> <span class="number">30</span> <span class="number">6.1</span>  <span class="number">9.0</span> <span class="number">7.425</span> <span class="number">7.8</span> <span class="number">8.175</span></div><div class="line">$groups</div><div class="line">         y groups</div><div class="line"><span class="number">2</span> <span class="number">8.803333</span>      a</div><div class="line"><span class="number">1</span> <span class="number">8.443333</span>      a</div><div class="line"><span class="number">3</span> <span class="number">7.710000</span>      b</div></pre></td></tr></table></figure>
<p>但是，这是在没有扣除X对Y影响的情况下的计算的结果，也就是说第二组降糖均数最低，第三组最高（看Q50），提示患者初始的糖化血红蛋白含量与治疗药物的效应混杂，即患者治疗3个月后的糖化血红蛋白含量的多少除了与治疗的药物有关外，还受其初始糖化血红蛋白含量的影响。对此，可以采用完全随机设计且有一个协变量的协方差分析方法，将三组患者初始的糖化血红蛋白含量化为相等，以扣除其影响，再比较三种治疗组的降糖效果，即检验三组修正均数间的差别有无统计学意义。具体的计算步骤如下：</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(H_{0}:\)</span> 各组降糖的总体修正数相等，<span class="math inline">\(H_{1}\)</span>：各组降糖总体修正均数不全相等，<span class="math inline">\(\alpha=0.05\)</span></li>
<li>列表，并计算初步结果，也就是下面的这一部分：</li>
</ol>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/KA6ml5fjaj.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>根据前面的公式，计算相应的校正数，总的，组间和组内的离均差平方和、积和自由度，计算结果如下所示：</li>
</ol>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/5ffhbik7l4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，校正系数为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/7agg5F9b14.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>总的离均差平方和、积和及自由度为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/CAbfKG853F.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>组间离均差平方和、积和及自由度为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/cmHL56iEh5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>组内离均差平方和、积和及自由度：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/cC7LIC4Hk7.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>根据前面的公式计算出总的、组内和修正均数的估计误差平方和、自由度、均方及F值，见前面表13-5右侧部分，如下所示：</li>
</ol>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180828/LHkGL4aFd2.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li><p><span class="math inline">\(\nu_{1}=2,\nu_{2}=86\)</span>查表可得，Ｐ&lt;0.01,按α=0.05水准,拒绝H0，接受H1，可以认为在扣除初始糖化血红蛋白含量因素的影响后，3组患者的总体降糖均数有差别。</p></li>
<li><p>根据前面的表13-3，表13-5及公式，求得公共回归系数<span class="math inline">\(b_{c}\)</span>及各组修正均数<span class="math inline">\(\bar{Y}^*\)</span>为</p></li>
</ol>
<p><span class="math inline">\(b_{c}=13.26/53.40=0.25\)</span></p>
<p>第一组<span class="math inline">\(\bar{Y_{1}}^*=1.61-0.25(10.09-9.970)=1.61\)</span></p>
<p>第一组<span class="math inline">\(\bar{Y_{2}}^*=1.07-0.25(9.88-9.970)=1.09\)</span></p>
<p>第一组<span class="math inline">\(\bar{Y_{3}}^*=2.24-0.25(9.95-9.970)=2.24\)</span></p>
<p>根据前面的q值公式，对这三个修正均数间差别进行两两比较的结果显示，第一组与第二组、第一组与第三组、第二组与第三组总体修正均数间均有差别(P&lt;0.01)，可以认为在扣除患者初始糖化血红蛋白含量因素的影响后，第三种治疗患者的平均降糖量最多，第一种治疗次之，第二种治疗最少。</p>
<p>使用R进行协方差分析时，需要安装HH包，用这个包中的ancova()函数进行协方差分析。</p>
<p>计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(HH)</div><div class="line">data.x &lt;- c(<span class="number">10.8</span>,<span class="number">11.6</span>,<span class="number">10.6</span>,<span class="number">9</span>,<span class="number">11.2</span>,<span class="number">9.9</span>,<span class="number">10.6</span>,<span class="number">10.4</span>,<span class="number">9.6</span>,<span class="number">10.5</span>,<span class="number">10.6</span>,<span class="number">9.9</span>,<span class="number">9.5</span>,<span class="number">9.7</span>,<span class="number">10.7</span>,<span class="number">9.2</span>,<span class="number">10.5</span>,<span class="number">11</span>,<span class="number">10.1</span>,<span class="number">10.7</span>,<span class="number">8.5</span>,<span class="number">10</span>,<span class="number">10.4</span>,<span class="number">9.7</span>,<span class="number">9.4</span>,<span class="number">9.2</span>,<span class="number">10.5</span>,<span class="number">11.2</span>,<span class="number">9.6</span>,<span class="number">8</span>,<span class="number">10.4</span>,<span class="number">9.7</span>,<span class="number">9.9</span>,<span class="number">9.8</span>,<span class="number">11.1</span>,<span class="number">8.2</span>,<span class="number">8.8</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">9.4</span>,<span class="number">8.9</span>,<span class="number">10.3</span>,<span class="number">9.3</span>,<span class="number">9.2</span>,<span class="number">10.9</span>,<span class="number">9.2</span>,<span class="number">9.2</span>,<span class="number">10.4</span>,<span class="number">11.2</span>,<span class="number">11.1</span>,<span class="number">11</span>,<span class="number">8.6</span>,<span class="number">9.3</span>,<span class="number">10.3</span>,<span class="number">10.3</span>,<span class="number">9.8</span>,<span class="number">10.5</span>,<span class="number">10.7</span>,<span class="number">10.4</span>,<span class="number">9.4</span>,<span class="number">9.8</span>,<span class="number">11.2</span>,<span class="number">10.7</span>,<span class="number">9.6</span>,<span class="number">10.1</span>,<span class="number">9.8</span>,<span class="number">10.1</span>,<span class="number">10.3</span>,<span class="number">11</span>,<span class="number">10.5</span>,<span class="number">9.2</span>,<span class="number">10.1</span>,<span class="number">10.4</span>,<span class="number">10</span>,<span class="number">8.4</span>,<span class="number">10.1</span>,<span class="number">9.3</span>,<span class="number">10.5</span>,<span class="number">11.1</span>,<span class="number">10.5</span>,<span class="number">9.7</span>,<span class="number">9.2</span>,<span class="number">9.3</span>,<span class="number">10.4</span>,<span class="number">10</span>,<span class="number">10.3</span>,<span class="number">9.9</span>,<span class="number">9.4</span>,<span class="number">8.3</span>,<span class="number">9.2</span>)</div><div class="line">data.y &lt;- c(<span class="number">9.4</span>,<span class="number">9.7</span>,<span class="number">8.7</span>,<span class="number">7.2</span>,<span class="number">10</span>,<span class="number">8.5</span>,<span class="number">8.3</span>,<span class="number">8.1</span>,<span class="number">8.5</span>,<span class="number">9.1</span>,<span class="number">9.2</span>,<span class="number">8.4</span>,<span class="number">7.6</span>,<span class="number">7.9</span>,<span class="number">8.8</span>,<span class="number">7.4</span>,<span class="number">8.6</span>,<span class="number">9.2</span>,<span class="number">8</span>,<span class="number">8.5</span>,<span class="number">7.3</span>,<span class="number">8.3</span>,<span class="number">8.6</span>,<span class="number">8.7</span>,<span class="number">7.6</span>,<span class="number">8</span>,<span class="number">8.8</span>,<span class="number">9.5</span>,<span class="number">8.2</span>,<span class="number">7.2</span>,<span class="number">9.2</span>,<span class="number">9</span>,<span class="number">8.9</span>,<span class="number">8.6</span>,<span class="number">9.9</span>,<span class="number">7.1</span>,<span class="number">7.8</span>,<span class="number">7.9</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">7.9</span>,<span class="number">8.9</span>,<span class="number">8.9</span>,<span class="number">8.1</span>,<span class="number">10.2</span>,<span class="number">8.5</span>,<span class="number">9</span>,<span class="number">8.9</span>,<span class="number">9.8</span>,<span class="number">10.1</span>,<span class="number">8.5</span>,<span class="number">8.1</span>,<span class="number">8.6</span>,<span class="number">8.9</span>,<span class="number">9.6</span>,<span class="number">8.1</span>,<span class="number">9.9</span>,<span class="number">9.3</span>,<span class="number">8.7</span>,<span class="number">8.7</span>,<span class="number">7.6</span>,<span class="number">7.9</span>,<span class="number">9</span>,<span class="number">7.8</span>,<span class="number">8.5</span>,<span class="number">7.5</span>,<span class="number">8.3</span>,<span class="number">8.2</span>,<span class="number">8.4</span>,<span class="number">8.1</span>,<span class="number">7</span>,<span class="number">7.7</span>,<span class="number">8</span>,<span class="number">6.6</span>,<span class="number">6.1</span>,<span class="number">8.1</span>,<span class="number">7.8</span>,<span class="number">8.4</span>,<span class="number">8.2</span>,<span class="number">8</span>,<span class="number">7.6</span>,<span class="number">6.9</span>,<span class="number">6.7</span>,<span class="number">8.1</span>,<span class="number">7.4</span>,<span class="number">8.2</span>,<span class="number">7.6</span>,<span class="number">7.8</span>,<span class="number">6.6</span>,<span class="number">7.2</span>)</div><div class="line">group &lt;- factor(rep(<span class="number">1</span>:<span class="number">3</span>,each=<span class="number">30</span>))</div><div class="line">data1 &lt;-data.frame(group,data.x,data.y)</div><div class="line">result1 &lt;- ancova(data.y~group+data.x,data=data1)</div><div class="line">result1</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; result1</div><div class="line">Analysis of Variance Table</div><div class="line"></div><div class="line">Response: data.y</div><div class="line">          Df Sum Sq Mean Sq F value    Pr(&gt;F)    </div><div class="line">group      2 18.628  9.3138  55.161 3.852e-16 ***</div><div class="line">data.x     1 30.210 30.2096 178.917 &lt; 2.2e-16 ***</div><div class="line">Residuals 86 14.521  0.1688                      </div><div class="line">---</div><div class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180827/Ii7aJe63D5.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>从这个协方差的最终结果图上我们可以知道，第三种疗法对血红蛋白的降低程度最大，第一种次之，第二种降低程度最弱。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>孙振球. 医学统计学.第3版[M]. 人民卫生出版社, 2010.</li>
<li><a href="http://www.cnblogs.com/chaosimple/p/3182157.html" target="_blank" rel="external">浅谈协方差矩阵</a></li>
<li><a href="https://www.cnblogs.com/terencezhou/p/6235974.html" target="_blank" rel="external">协方差与协方差矩阵</a></li>
<li><a href="https://mp.weixin.qq.com/s?src=3&amp;timestamp=1562405662&amp;ver=1&amp;signature=cpyhrpV-EBnnSLknSlPZCc-JSraKiijI8*fzedhtCnhuNpVPu9fLP3iiPqWdLlqlyatTlbGojko5hpeXHlQE34jYchfM2v*V7ERkM0S9WcTeywTkCRmvY-hwdZAvjtFx*ikqV34LBWbhpSfc0QycczRjCeTW8wX0HAgLy*WDbvo=" target="_blank" rel="external">从协方差到相关系数.冯国双.微信公众号文章：小白学统计</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/04/BioStatistics/生物统计-04常见概率分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/04/BioStatistics/生物统计-04常见概率分布/" itemprop="url">常见概率分布笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-04T12:00:00+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  10,388
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  42
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>随机变量取一切可能值的概率的规律称为<strong>概率分布(probability distribution)</strong>，简称为分布，通常使用表格，图形，公式来表示这些分布，一个概率分布总是一和个总体(population)相关联的，这里的总体也称为<strong>样本空间(sample space)</strong>，它是由某种试验的所有可能结果构成的集合，这些结果的获取服从某种概率规律，因此， 一个总体（样本空间）是由一个取值范围及与之相连的概率所组成。于是，给出了这个概率分布就等于知了总体，这些用数学语言表示的概率分布有一些理论参数，称为<strong>总体参数(population parameter)</strong>，对于一个样本来说，它有自己的一些参数，例如样本均值、样本方差、样本标准差、样本分位数等。相对于总体，它也有总体均值、总体方差、总体标准差，总体分位数等参数。只是对于不同的总体，这些参数可能不同，并且对于某些总体，某些参数可能就不存在。</p>
<h2 id="离散型分布">离散型分布</h2>
<p>离散变量很常见，例如在一批产品的质量检查中可能发现的次品数目、一日内通过某电话总体的通话次数、在若干次试验中成功的次数等，这些变量取离散值，而且按照某种概率来取每个值，取每个值的概率应该大于或等于0、小于或等于1，并且取各种值的概率之和应该等于1，用符号来表示就是，假定离散随机变量X的取值范围为<span class="math inline">\(x_{1},x_{2},\cdots,\)</span>而且取可能值<span class="math inline">\(x_{i}\)</span>的概率记为<span class="math inline">\(P(x_{i})\equiv P(X=x_{i})\)</span>，那么这些概率应该同时满足下面的关系：</p>
<p><span class="math inline">\(\sum_{i}P(x_{i})=1,\qquad 0 \leq P(x_{i})\)</span></p>
<p>满足这样关系的概率<span class="math inline">\(P(x_{i})\)</span>的总和就是该离散变量的概率分布。离散变量的取值不一定是有穷的，例如Poisson分布的取值范围就是所有的非负整数，因而有无穷多可能的值。</p>
<h3 id="常见的离散型分布">常见的离散型分布</h3>
<p>常用的离散型随机变量包括二项分布、几何分布、 超几何分布、 负二项分布和泊松分布等。</p>
<h2 id="累积分布函数cdf">累积分布函数(CDF)</h2>
<p>除了分布函数<span class="math inline">\(P(X=x_{i})\)</span>外，还有<strong>累积分布函数(cumulative distribution function, CDF)</strong>的概念，离散随机变量的累积分布函数的定义如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329101700.png">

</div>
<p><strong>统计教科书上的各种概率分布表，通常都是累积分布函数的值</strong>。</p>
<p>具体来说就是，<code>CDF</code>是<code>x</code>的函数，其中<code>x</code>是分布中的某个值，计算给定<code>x</code>的<code>CDF(x)</code>，就是计算样本中小于等于<code>x</code>的值的比例。</p>
<p>指数分布的CDF是： <span class="math display">\[
\operatorname{CDF}(x)=1-\mathrm{e}^{-\lambda x}
\]</span> 其中参数<span class="math inline">\(\lambda\)</span>决定了分布的形状，后边介绍的婴儿出生的案例中，<span class="math inline">\(\lambda = 2\)</span>。通常指数分布的均值是<span class="math inline">\(1/\lambda\)</span>，因此后面婴儿出生案例中，这个分布的均值是0.5，分布的中位数是<span class="math inline">\(log(2)/\lambda\)</span>，大概等于0.35。</p>
<h3 id="cdf简单案例">CDF简单案例</h3>
<p>看一个简单的案例，某个样本中的值是<code>{1, 2, 2, 3, 5}</code>，那么每个值对应的<code>CDF</code>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CDF(<span class="number">0</span>) = <span class="number">0</span> </div><div class="line">CDF(<span class="number">1</span>) = <span class="number">0.2</span> </div><div class="line">CDF(<span class="number">2</span>) = <span class="number">0.6</span> </div><div class="line">CDF(<span class="number">3</span>) = <span class="number">0.8</span> </div><div class="line">CDF(<span class="number">4</span>) = <span class="number">0.8</span> </div><div class="line">CDF(<span class="number">5</span>) = <span class="number">1</span></div></pre></td></tr></table></figure>
<p>从上面的案例中我们就可以知道，我们能计算出样本中任意值x的CDF。在其他情况下，我们可能计算出任意值的CDF，而不仅仅是样本中的值，如果计算的<code>x</code>比最小的值还要小，那么<code>CDF(x)</code>就等于0。巢x比样本中的最大值还要大，那么<code>CDF(x)</code>就是1。下图就是CCDF图形化的表示方法：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703191400.png">

</div>
<p>再看一个近似指数分布的例子（案例来源于《程序员数学之概率统计》），在这个案例中，我们看看婴儿出生时间的间隔，1997年12月18日，澳大利亚布里斯班的医院总共出生了44个婴儿，这个数据的的指数分布图如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703210023.png">

</div>
<p>上图是婴儿出生间隔时间的CDF，单位是分钟，这看上去跟指数分布的形状很像。</p>
<p>如何确定这就是一个指数分布呢？</p>
<p>一种办法是画出取对数后的<code>互补积累分布函数(Complementary CDF, CCDF)</code>，即<code>1-CDF(x)</code>。如果数据服从指数分布，这应该是一条直线，接下来看一下为什么会这样。</p>
<p>指数分布的数据集的CCDF公式为： <span class="math display">\[
y \approx \mathrm{e}^{-\lambda x}
\]</span> 两边取对数后，得到 <span class="math display">\[
\log y \approx-\lambda x
\]</span> 因此，在对y轴上的值取对数后，CCDF是一条斜率为<span class="math inline">\(-\lambda\)</span>的直线。</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703210751.png">

</div>
<p>在上图中，这是y轴取对数后的间隔时间的CCDF，图中并不是一条严格意义上的直线，这说明指数分布还只是一个近似。</p>
<p>在实际计算时，CDF往往比原始的概率分布要方便，例如我要计算<span class="math inline">\(P(a&lt;X \leq b)\)</span>，那么或者用求和来计算，即如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329101726.png">

</div>
<p>或者是通过相减来计算，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329101753.png">

</div>
<p>显然，通过相减计算要容易得多，只需要找到F(b)和F(a)即可。</p>
<p>对于离散分布随机变量X来说，它的总体均值（通常用<span class="math inline">\(\mu\)</span>表示）定义如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/B4ECgkBac3.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>它又称为X的数学期望，这里的符号<span class="math inline">\(E(x)\)</span>就是X的期望(expectation)的意思。</p>
<p>变量X的总体方差通常用<span class="math inline">\(\delta^2\)</span>表示，它的公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/4jGcihFbea.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>这里的符号<span class="math inline">\(Var(X)\)</span>就是X的方差(variance)的意思，总体标准差定义为总体方差的平方根，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/HjcKe9cHB1.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>显然，这里的均值、方差等概率和样本均值、样本方差很相似，只要把这里的<span class="math inline">\(x_{i}\)</span>换成样本点，而把<span class="math inline">\(P(x_{i})\)</span>换成<span class="math inline">\(1/n\)</span>（在样本方差经常使用<span class="math inline">\(1/(n-1)\)</span>，在样本量大的时候<span class="math inline">\(1/n\)</span>和<span class="math inline">\(1/(n-1)\)</span>差别不大），就和样本量为n的情况下的样本均值和样本方差一致了，需要注意的是，总体均值和总体方差有可能是无穷或者不存在的（总体的数据很难得到，只能根据样本来推测总体），但样本均值和样本方差总是存在的。</p>
<h2 id="概率密度函数与累积分布函数的关系">概率密度函数与累积分布函数的关系</h2>
<p>累积分布函数的导数称为概率密度函数()，记为PDF，例如指数分布的概率密度函数为： <span class="math display">\[
\operatorname{PDF}_{\mathrm{expo}}(x)=\lambda \mathrm{e}^{-\lambda x}
\]</span> 正态分布的概率密度函数为： <span class="math display">\[
\operatorname{PDF}_{\text { normal }}(x)=\frac{1}{\sigma \sqrt{2 \pi}} \exp \left[-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^{2}\right]
\]</span> 概率密度函数的值并不是概率，它表示的是一种<strong>概率密度(probability density)</strong>。</p>
<h3 id="什么是概率密度">什么是概率密度</h3>
<p>现在描述一下什么是概率密度。</p>
<p>物理学中，密度指的是单位体积内物质所拥有的质量，质量就等于体积乘以密度。如果物理的密度不固定，即不同部位密度不同，那么我们可以通过对密度函数进行积分得到质量。</p>
<p>同样地，概率密度称量的是x轴上每个单位的概率。为了得到随机变量落在某个区间的概率，我们可以计算其密度函数在这段区间上的积分。假设随机变量X的概率密度函数为<span class="math inline">\(PDF_{X}\)</span>，那么X落在区间<code>[-0.5,0.5)</code>的概率为： <span class="math display">\[
P(-0.5 \leqslant X&lt;0.5)=\int_{-0.5}^{0.5} \operatorname{PDF}_{X}(x) \mathrm{d} x
\]</span> 因为累积分布函数是概率密度函数的积分，所以上式也可以写成： <span class="math display">\[
P(-0.5 \leqslant X&lt;0.5)=\operatorname{CDF}_{X}(0.5)-\mathrm{CDF}_{X}(-0.5)
\]</span></p>
<p>下面看一些常见的离散型分布。</p>
<h2 id="二项分布">二项分布</h2>
<p>先看一个案例描述。</p>
<p>某项考虑有10道题，假定某考生答对每道题的概率是0.6，并假定各个题目的答案独立，而及格的标准则是至少答对6道题，那么至少答对6道题的概率就是事件“通过考试“的概率，这时，如果把答对题目的数目记为X，那么X是一个定量变量，而通过考虑的或者考试及格的概率就可以用以下公式来表示，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/k0DhlIhj8m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>而没有一道题答对的概率为<span class="math inline">\(P(X=0)\)</span>，这就是说10道题都答错，根据题目中的描述，我们知道答错题的概率是0.4，10道全错的概率就是<span class="math inline">\(0.4^{10} \approx 0.0001048576\)</span>，</p>
<p>这个案例中描述的变量就是一个二项分布随机变量，每回答一道题就是一个试验，每次试验成功的概率是固定的，这里是0.6，这10次试验（答10道题）是互相独立的，在重复的独立试验中，如查每个试验仅可能为两种可能结果之一，而且得到相应结果的概率在每次试验中保持不变，则称这些重复独立试验为Bernoulli试验，一般用<span class="math inline">\(p\)</span>和<span class="math inline">\(q=(1-p)\)</span>分别表示每次试验得到的两种结果的概率，这两种结果通常被抽象地称为”成功“和”失败“，这当然不是实际意义上的成功和失败，仅仅是两种结果的代号而已。</p>
<p>人们一般会关心，如果进行n次Bernoulli试验，每次成功的概率是p，那么某中成功次数X=k次的概率是多少？</p>
<p>我们用下面的抽球案例来理解这个问题。</p>
<h3 id="抽球实验">抽球实验</h3>
<p>Bernoulli试验：一个罐子中，含有1个红球，3个蓝球，每次随机取出1个球，观察其颜色，再放回，再抽取下一个球（这是有放回的抽样），每次抽得的红球的概率为p=1/4，蓝球的概率是q=1-p=3/4，用R表示红球的事件，用B表示蓝球的事件，而用P(RB)表示第一次得到的是红球，第二次得到的蓝球的概率等，用X表示在n次试验中观测到红球的次数，下面以n=2和n=3为例说明一下这个概率。</p>
<p>其中下面的这个公式</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/59jKHa8hfk.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>它表示从n个元素中选取k个元素的组合数。</p>
<p>现在看n=2的情况。</p>
<p>n=2表示是我们抽取2次，这里面又分3种情况。</p>
<p>第1种情况：2次抽取，抽到0个红球，也就是两次都是蓝球，这种情况的概率如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/gcDa8laAGg.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第2种：2次抽取，刚好有一次观测到红球的概率（这种情况可以理解为，第1次红球，第2次蓝球或第1次蓝球，第2次红球），如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/7jlJLk636K.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第3种：2次抽取，均是红球的概率：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/86Hb6fjHDD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>现在看n=3的情况。</p>
<p>n=3表示是我们抽取3次，这里面又分4种情况。</p>
<p>第1种情况：抽取3次，只有0个红球，概率如下：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/8dH4i22F99.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第2种情况：抽取3次，只抽到1个红球，概率如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/BjD76CckKB.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第3种情况：抽取3次，抽到2个红球，概率如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/iK1JlBDjlG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>第4种情况：抽取3次，抽到3个红球，概率如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/DB40kife7i.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>从这个问题的描述中我们可以知道下面的信息：</p>
<p>当n=2时，对于<span class="math inline">\(k=0,1,2,P(X=k)=C_{2}^kp^kq^{2-k}\)</span></p>
<p>当n=3时，对于<span class="math inline">\(k=0,1,2,3,P(X=k)=C_{3}^kp^kq^{3-k}\)</span></p>
<p>因此，我们可以把它们放在一起，如下所示：</p>
<p><span class="math inline">\(P(X=k)=C_{n}^kp^k(1-p)^{n-k},\quad k=0,1,\cdots,n,\)</span></p>
<p>这里的<span class="math inline">\(C_{n}^k\)</span>就是<span class="math inline">\((a+b)^n\)</span>展开的系数，我们把在成功概率为p的n次Bernoulli试验中成功次数X称为具有参数(n,p)的二项分布(binomial distribution)的随机变量，可以用B(n,p)、Bin(n,p)或Binomial(n,p)等表示这样的二项分布，由于参数中的n和p可能取不同的值，因此二项分布是一族分布，称为二项分布族，在n=1时的二项分布又称为bernoulli分布，它的概率分布如下所示：</p>
<p><span class="math inline">\(P(X=1)=p,\quad P(X=0)=1-p\)</span></p>
<p>可以利用排列组合和二项式展开的性质证明：二项分布Binomial(n,p)变量的总体均值为<span class="math inline">\(\mu=np\)</span>，方差为<span class="math inline">\(\delta^2=np(1-p)\)</span>，标准差为<span class="math inline">\(\delta=\sqrt{np(1-np)}\)</span>。</p>
<p>下图就是二项分布Binomial(5,p)的图，这里p取0.1，0.2，，，一直到0.9，可以看出，当p=0.5时，分布是对称的，当p为0.1或0.9时，分布概率偏向左边或右边，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">k &lt;- seq(<span class="number">0.1</span>,<span class="number">0.9</span>,<span class="number">0.1</span>)</div><div class="line">par(mfrow=c(<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">9</span>)</div><div class="line">  barplot(dbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,k[i]),xlab=<span class="string">"x"</span>,</div><div class="line">          ylab=<span class="string">"Probability"</span>,</div><div class="line">          ylim=c(<span class="number">0</span>,<span class="number">0.6</span>),</div><div class="line">          main=substitute(Binomial(<span class="number">5</span>,b),</div><div class="line">                          list(b=k[i])))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/6eD3LJkah5.jpg?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>案例分析</p>
<p>假定在一项外语考试中，如果每题有四个选项，只有1个是对的，一共有5道题，这些题目相互独立，如果答题者没有任何知识，全凭随机猜测，那么答对一道题的概率应该是0.25，此时答题就像是一系列bernoulli试验，每次试验成功的概率是0.25，失败的概率为1-0.25=0.75，如果用X表示答对的题目，则X可以看成是参数为n=5，p=0.25的二项分布，下表就给出了对于k=0,1,2,3,4,5，X的概率分布函数P(X=k)和累积分布函数<span class="math inline">\(P(X\leq x)\)</span>，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>k</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(P(X=k)\)</span></td>
<td>0.2373</td>
<td>0.3955</td>
<td>0.2637</td>
<td>0.08789</td>
<td>0.01465</td>
<td>0.00098</td>
</tr>
<tr class="even">
<td><span class="math inline">\(P(X\leq x)\)</span></td>
<td>0.2373</td>
<td>0.6328</td>
<td>0.8965</td>
<td>0.98438</td>
<td>0.99902</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>此时，<span class="math inline">\(P(X=k)=C_{5}^k\times0.25^k\times0.75^{5-k},\quad k=0,1,2,3,4,5\)</span></p>
<p>下图的左图显示的是概率分布图，下图的右图是累积分布函数图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">x &lt;- dbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>)</div><div class="line">barplot(x,xlab=<span class="string">"X"</span>,</div><div class="line">        ylab=<span class="string">"Probability Function"</span>,</div><div class="line">        ylim=c(<span class="number">0</span>,<span class="number">0.4</span>),</div><div class="line">        main=<span class="string">"Binomial(5,0.25)"</span>)</div><div class="line">plot(<span class="number">0</span>:<span class="number">5</span>,pbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>),</div><div class="line">     ylim = c(<span class="number">0</span>,<span class="number">1</span>),</div><div class="line">     type=<span class="string">"s"</span>,</div><div class="line">     xlab=<span class="string">"X"</span>,</div><div class="line">     ylab=<span class="string">"Cumulative Distribution Function"</span>,</div><div class="line">     main=<span class="string">"Binomial(5,0.25)"</span>)</div><div class="line">points(<span class="number">0</span>:<span class="number">5</span>,pbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329101830.png">

</div>
<h2 id="多项分布">多项分布</h2>
<p>二项分布是基于每次的实验有两个可能结果的重复独立Bernoulli试验，如果把二项分布进行拓展，例如每次实验不是有2个结果，而有k个结果，并且针对每个结果的概率分别为<span class="math inline">\((p_{1},p_{2},\cdots,p_{k})\)</span>，并且这些概率都是固定的，其实可以简单地理解为掷骰子，这样在n次实验中，得到的k个可能的结果数目为<span class="math inline">\((X_{1},X_{2},\cdots,X_{k})\)</span>的概率分布为多项分布（multinomial distribution），显然约束条件为：</p>
<p><span class="math inline">\(X_{1}+X_{2}+\cdots+X_{k}=n\)</span></p>
<p><span class="math inline">\(p_{1}+p_{2}+\cdots+p_{k}=1\)</span></p>
<p>多项分布可以用<span class="math inline">\(M(n,p_{1},\cdots,p_{k})\)</span>表示，多项分布为多元分布，也就是说我们感兴趣的随机变量有k个<span class="math inline">\((X_{1},X_{2},\cdots,X_{k})\)</span>，这是一个k维随机向量，如果用<span class="math inline">\(P(X_{1}=n_{1},X_{2}=n_{2},\cdots,X_{k}=n_{k})=p(n_{1},\cdots,n_{k})\)</span>代表多项分布k的可能结果在n次试验中分别出现<span class="math inline">\(n_{1},\cdots,n_{k}\)</span>次的概率，而<span class="math inline">\(p_{1},\cdots,p_{k}\)</span>分别为一次试验时各种结果出现的概率，于是多项分布可以用下面的公式来表示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/FaGcCAi3lD.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中下面就是多项式系数：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/1GACKGGb94.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>它就是多项式展开，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/5m93JHA38h.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>多面项分布的一个典型就是掷骰子，此时k=6，而对于一个正常的骰子来说，每掷一次，它的6个面朝上的概率是一样的，即<span class="math inline">\(p_{1}=p_{2}=\cdots =p_{k}=1/6\)</span>，显然，多项分布是一个分布族，用不同的参数来区分。</p>
<h2 id="超几何分布">超几何分布</h2>
<p>超几何分布是一种离散概率分布，它描述的是不放回抽样的问题。例如在一批产品里，一共有N件产品，其中有M件次品，那么当我们任何取n件产品，其中恰有X件次品的概率P就可以按归照下面的公式进行计算：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180721/6bed6CC66m.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其实超几何分布就是不放回的Bernoulli试验。此处我们回忆一下二项分布，如下所示：</p>
<blockquote>
<p>二项分布：一个罐子里有m个白球，n个黑球，如果每次随机取出1个，记录下颜色后放回，重复这样的试验就形成了一系列独立的Bernoulli试验，每次摸到白球的概率是p=m/(m=n)，在取了k次后，取到白球的总次数X就服从参数k和p的二项分布。</p>
</blockquote>
<p>如果我们不放回白球，我们在取了k后后，取到白球的总次数X就服从超几何分布(hypergeometric distribution)。</p>
<p>R语言中与超几何分布有关的函数为<code>phyper</code>，<code>dhyper</code>，<code>rhyper</code>，<code>qhyper</code>。</p>
<p>其中dhyper的参数为dhyper(x, m, n, k)，这几个参数的含义如下所示： x：从一个含有白球和黑球的盒子里不放回取出的白球数目。 m：白球的数量 n：黑球的数量 k：抽取的次数</p>
<h3 id="超几何分布的计算">超几何分布的计算</h3>
<p>现在计算一下，有100个白球，400个黑球，不放回取50个球，有10个白球的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">10</span>,<span class="number">100</span>,<span class="number">400</span>,<span class="number">50</span>,log = <span class="literal">FALSE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1474</span></div></pre></td></tr></table></figure>
<p>现在计算一下，有100个白球，400个黑球，不放回取50个球，小于等于10个白球的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; phyper(<span class="number">10</span>, <span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.5851</span></div></pre></td></tr></table></figure>
<h3 id="超几何分布的概率密度曲线">超几何分布的概率密度曲线</h3>
<p>现在绘制超几何分布的概率密度曲线，如下所示：</p>
<p>参数说明：其中N表示的是总的球的数目，即<code>N=m+n</code>，这里设定的数目是500个，k表示抽取的次数，这里分别绘制了白球为100个抽取50次，白球为200个抽取60次，白球为300个抽取70次的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">50</span>)</div><div class="line">y1&lt;-dhyper(x,<span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">y2&lt;-dhyper(x,<span class="number">200</span>, <span class="number">300</span>, <span class="number">60</span>)</div><div class="line">y3&lt;-dhyper(x,<span class="number">300</span>, <span class="number">200</span>, <span class="number">70</span>)</div><div class="line">plot(x,y1)</div><div class="line">plot(x,y1,col=<span class="string">"red"</span>,ylab=<span class="string">"density"</span>,</div><div class="line">     xlim=c(<span class="number">0</span>,<span class="number">55</span>),xlab=<span class="string">""</span>,</div><div class="line">     main=<span class="string">"Hypergeometric distribution"</span>)</div><div class="line">lines(x,y1,col=<span class="string">"red"</span>)</div><div class="line">points(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">lines(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">points(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">lines(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"topright"</span>,legend=paste(<span class="string">"N="</span>,c(<span class="number">500</span>,<span class="number">500</span>,<span class="number">500</span>),</div><div class="line">                               <span class="string">"k="</span>,c(<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>)),</div><div class="line">       lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/4EjkaG80Km.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="超几何分布的概率积累分布曲线">超几何分布的概率积累分布曲线</h3>
<p>现在绘制超几何分布的概率积累分布曲线，参数说明：其中N表示的是总的球的数目，即<code>N=m+n</code>，这里设定的数目是500个，k表示抽取的次数，这里分别绘制了白球为100个抽取50次，白球为200个抽取60次，白球为300个抽取70次的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">50</span>)</div><div class="line">y1&lt;-phyper(x,<span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">y2&lt;-phyper(x,<span class="number">200</span>, <span class="number">300</span>, <span class="number">60</span>)</div><div class="line">y3&lt;-phyper(x,<span class="number">300</span>, <span class="number">200</span>, <span class="number">70</span>)</div><div class="line">plot(x,y1)</div><div class="line">plot(x,y1,col=<span class="string">"red"</span>,ylab=<span class="string">"density"</span>,</div><div class="line">     xlim=c(<span class="number">0</span>,<span class="number">55</span>),xlab=<span class="string">""</span>,</div><div class="line">     main=<span class="string">"Hypergeometric Cumulative distribution"</span>)</div><div class="line">lines(x,y1,col=<span class="string">"red"</span>)</div><div class="line">points(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">lines(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">points(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">lines(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"bottomright"</span>,legend=paste(<span class="string">"N="</span>,c(<span class="number">500</span>,<span class="number">500</span>,<span class="number">500</span>),</div><div class="line">                               <span class="string">"k="</span>,c(<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>)),</div><div class="line">       lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/GIlFbbElB8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>案例分析</p>
<p>假定在一个20个人的研究生班中，有12个女生（用m表示，即m=12），有8个男生（用n表示，即n=8），因此，女生的比例是60%，如果随机抽取10个学生进行论文主审查，那么X=8篇女生的论文被抽中的概率是多少呢？</p>
<p>按照超几何分布Hyper(12,8,10)来计算，容易得出，其概率为0.0750，如果按照二项分布Binomial(10,0.6)来计算，则得出的概率是0.1209，显然这两种计算的差异很大，但是如果有120个女生和80个男生，那么随机抽取10个学生的论文，其中有8篇是女生的论文的概率就基本上差不多了，用超几何分布过计算，此概率是0.1183，用二项分布来计算，是0.1209。</p>
<p>现在计算一下这两个概率。</p>
<p>第1个概率（女生12个，男生8个），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; m=<span class="number">12</span>;n=<span class="number">8</span>;k=<span class="number">10</span>;x=<span class="number">8</span></div><div class="line">&gt; dhyper(x,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.07501786</span></div><div class="line">&gt; dbinom(x,k,m/(m+n))</div><div class="line">[<span class="number">1</span>] <span class="number">0.1209324</span></div></pre></td></tr></table></figure>
<p>dhyper的参数前面了解了，现在看一下dbinom的参数，它的参数有3个，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbinom(x, size, prob, log = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>其中x表示目标事件的次数，我们的目标事件是”论文中是女生论文“，目标次数是8篇，此处x就等于8，k表示抽样的次数，这里是取了10个同学，prob表示目标事件的概率，我们的目标事件是”论文中是女生论文“，因此这个prob此处为0.6，也就是m/(m+n)。</p>
<p>现在扩大一下样本，女生120个，男生80个，抽10份论文，女生论文是8篇的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; m=<span class="number">120</span>;n=<span class="number">80</span>;k=<span class="number">10</span>;x=<span class="number">8</span></div><div class="line">&gt; dhyper(x,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1182677</span></div><div class="line">&gt; dbinom(x,k,m/(m+n))</div><div class="line">[<span class="number">1</span>] <span class="number">0.1209324</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们研究的是具体的某个事件的概率，也就是抽到女生论文是8篇的概率，如果我们要研究至少投到8篇是女生论文的概率，那么就需要求出8，9，10篇是女生论文的概率之和（女生人数为120人，男生80个），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">8</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)+dhyper(<span class="number">9</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)+dhyper(<span class="number">10</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>这里使用到了一个phyper函数，它的用法如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">phyper(q, m, n, k, lower.tail = TRUE, log.p = FALSE)</div></pre></td></tr></table></figure>
<p>q就是目标事件的次数，这里是8，因此使用这个函数计算出来的结果其实就是，抽取10篇，其中小于等于8篇是女生论文的概率，因此这个概率并不是我们想要的，我们想要的概率是至少8篇是女生论文的概率，也就是8，9，10篇。因此，此处我们计算出小于等于7篇是女生论文的概率，再用1减去就是我们要想的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="number">1</span>-phyper(<span class="number">7</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>现在用dhyper函数来验证下，分别计算出8，9，10篇是女生论文的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">8</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1182677</span></div><div class="line">&gt; dhyper(<span class="number">9</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.03726013</span></div><div class="line">&gt; dhyper(<span class="number">10</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.005169843</span></div><div class="line">&gt; dhyper(<span class="number">8</span>,m,n,k)+dhyper(<span class="number">9</span>,m,n,k)+dhyper(<span class="number">10</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>结果是一样的。</p>
<h2 id="二项分布与超几何分布的联系与区别">二项分布与超几何分布的联系与区别</h2>
<p>在抽样调查的实践中，一般不会重复调查同一个人，这相当于不放回抽样。严格来说应该用超几何分布来描述，但对于很大的总体，通常都考虑二项分布模型。这是因为，在一个很大的一群人中进行随机调查，就相当于从有大量黑白球的罐子中摸球，无论是放回抽样，还是不放回抽样，抽样时待抽取的黑白球所点的比例不会有显著的区别，由于二项分布计算简单，所以都用二项分布来近似。但是如果仅仅在一个人数不多的单位中进行调查，就相当于上面的不放回摸球，而且由于球的总数不多，每次抽样后，待抽取的黑白球所占的比例变化会很大，因此就应该考虑用超几何分布。</p>
<p>附图：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329103227.png">

</div>
<h2 id="负二项分布">负二项分布</h2>
<h2 id="poisson分布">Poisson分布</h2>
<p>在二战中，德国的导弹不断袭击英国，为了研究导弹袭击的规律，英国的统计学家R.D. Clarke把一个地区划分为许多小块，使得每个小块被击中的概率极小，在袭击是随机的假定下，各个小块被击中的概率在整个区域假定是一个常数，这样，一个小块被南路的次数就大致相当于在大量重复的成功概率很小的独立Bernoulli试验中成功的次数，他于是就导出了Poisson分布，而实际观测的导弹袭击的频数和用Poisson分布预测的频率相当吻合，在许多事件中，例如某种疾病的发生数目，一个自动生产线出现的废品数，某种事故发生的数目等，只要出现一次的概率很小，一般被看成近似地服从Poisson分布，Poisson分布的总体参数是其均值，而且其总体均值和总体方差相等，这里用λ表示该总体均值，Poission分布常用P(λ)或Poisson(λ)表示，此分布P(λ)的概率分布为：对于<span class="math inline">\(x=0,1,\cdots\)</span>，以及<span class="math inline">\(\lambda&gt;0\)</span>，有：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180814/29871IeHg8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>下图就是参数为3、6、10的Poission分布图（只标出了20之内的部分），Poisson分布是一个分布族，其成员用不同的λ来区分，若干个独立的Poisson分布变量的和也服从Poisson分布，其参数等于那些Poisson分布的参数之和。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">x&lt;-<span class="number">0</span>:<span class="number">20</span></div><div class="line">z&lt;-cbind(dpois(x,<span class="number">3</span>),dpois(x,<span class="number">6</span>),dpois(x,<span class="number">10</span>))</div><div class="line">matplot(x,z,</div><div class="line">        pch=c(<span class="number">19</span>,<span class="number">8</span>,<span class="number">17</span>),</div><div class="line">        cex=<span class="number">1.5</span>,</div><div class="line">        xlab=<span class="string">"x"</span>,ylab=<span class="string">"P(X=x)"</span>,</div><div class="line">        col=<span class="number">1</span>,</div><div class="line">        main=<span class="string">"Poisson Distribution"</span>,</div><div class="line">        type=<span class="string">"b"</span>)</div><div class="line">legend(<span class="number">15</span>,<span class="number">0.23</span>,</div><div class="line">       c(<span class="string">"P(3)"</span>,<span class="string">"P(6)"</span>,<span class="string">"P(10)"</span>),</div><div class="line">       cex=<span class="number">1.5</span>,</div><div class="line">       pch=c(<span class="number">19</span>,<span class="number">8</span>,<span class="number">17</span>),</div><div class="line">       col=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102846.png">

</div>
<p>正如前面的导弹袭击案例所说，当Bernoulli试验的次数很大，而每次成功概率很小时，可以用Poisson分布来近似二项分布，数学上，如果二项分布Binomial(n,p)的p趋于0，而np趋于常数λ时，该二项分布则趋于Poisson分布P(λ)，由于当n很大，以及p很小时，二项分布计算很麻烦，因此在计算机出现之前，人们在计算概率时，往往用P(np)来对二项分布Binomial(n,p)做近似。</p>
<p>看一个案例，现在使用不同的n（例如取值10，100，1000，10000，100000，这里的n就是试验次数）和p（例如取值0.1，0.01，0.001，0.0001，0.00001，这里的p就是某事件发生的概率）分别利用二项分布和Poisson分布近似来计算X=2的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; n&lt;-c(<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>,<span class="number">10000</span>,<span class="number">100000</span>)</div><div class="line">&gt; p&lt;-c(<span class="number">0.1</span>,<span class="number">0.01</span>,<span class="number">0.001</span>,<span class="number">0.0001</span>,<span class="number">0.00001</span>)</div><div class="line">&gt; cbind(dbinom(<span class="number">2</span>,n,p),dpois(<span class="number">2</span>,n*p))</div><div class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]</div><div class="line">[<span class="number">1</span>,] <span class="number">0.1937102</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">2</span>,] <span class="number">0.1848648</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">3</span>,] <span class="number">0.1840317</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">4</span>,] <span class="number">0.1839489</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">5</span>,] <span class="number">0.1839406</span> <span class="number">0.1839397</span></div></pre></td></tr></table></figure>
<p>从上面的这个结果我们可以看到，随着试验次数的增加，以及p值的降低，那么二项分布与Poisson的结果就非常接近了。</p>
<h2 id="连续型分布">连续型分布</h2>
<p>常见的连续型分布有：贝塔分布、柯西分布、卡方分布、指数分布、F分布、伽马分布、对数正态分布、Logistic分布、正态分布、t分布、均匀分布，Wilcoxon signed Rank分布、Weibull分布，Wilcoxon Rank Sum分布、多元正态分布。</p>
<h2 id="正态分布">正态分布</h2>
<p>正态分布内容参见这篇笔记《正态分布笔记》</p>
<h2 id="伽玛分布gamma分布">伽玛分布（<span class="math inline">\(\Gamma\)</span>分布）</h2>
<p>这里介绍伽玛分布是因为它与卡方分布和指数分布有关，卡方分布与指数分布可以视为一种特殊的伽玛分布。</p>
<p>许多随机变量，例如计算机使用寿命的长度，假定仅取非负值，这种类型数据的相对频率分布通过用<span class="math inline">\(\Gamma\)</span>型密度函数建模，<span class="math inline">\(\Gamma\)</span>密度函数公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/all92Geej8.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/3KKfkDm5jG.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p><span class="math inline">\(\Gamma\)</span>型随机变量的均值和方差分别如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/1lblKmkJG6.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>当α是正整数时，可以证明（略）Γ(α)=(α-1)Γ(α-1)以及Γ(α)=(α-1)！</p>
<p>Γ密度函数公式中包含两个参数α和β，参数β称作尺度参数，反映了Y度量单位的大小（它和出现在正态密度函数公式中的参数σ有相同的功能），参数α称作形状参数，改变它的值会改变Γ分布的形状，这就使得我们在建立试验数据的相对频率分布模型时，能得到许多不同形状的密度函数，下图就给出了α=1,3和5，β=1时的Γ密度函数图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">10</span>,length.out=<span class="number">100</span>)</div><div class="line">y1&lt;-data.frame(x,y=dgamma(x,<span class="number">1</span>,<span class="number">1</span>),g=<span class="string">"alpha=1,beta=1"</span>)</div><div class="line">y3&lt;-data.frame(x,y=dgamma(x,<span class="number">3</span>,<span class="number">1</span>),g=<span class="string">"alpha=3,beta=1"</span>)</div><div class="line">y5&lt;-data.frame(x,y=dgamma(x,<span class="number">5</span>,<span class="number">1</span>),g=<span class="string">"alpha=5,beta=1"</span>)</div><div class="line"></div><div class="line">y&lt;-sqldf(<span class="string">"</span></div><div class="line"><span class="string">         select x,y,g from y1</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y3</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y5"</span>)</div><div class="line"></div><div class="line">ggplot(y,aes(x=x,y=y,group=factor(g),colour=factor(g)))+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102749.png">

</div>
<p>以下是累积分布函数密度图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">10</span>,length.out=<span class="number">100</span>)</div><div class="line">y1&lt;-data.frame(x,y=pgamma(x,<span class="number">1</span>,<span class="number">1</span>),g=<span class="string">"alpha=1,beta=1"</span>)</div><div class="line">y3&lt;-data.frame(x,y=pgamma(x,<span class="number">3</span>,<span class="number">1</span>),g=<span class="string">"alpha=3,beta=1"</span>)</div><div class="line">y5&lt;-data.frame(x,y=pgamma(x,<span class="number">5</span>,<span class="number">1</span>),g=<span class="string">"alpha=5,beta=1"</span>)</div><div class="line"></div><div class="line">y&lt;-sqldf(<span class="string">"</span></div><div class="line"><span class="string">         select x,y,g from y1</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y3</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y5"</span>)</div><div class="line"></div><div class="line">ggplot(y,aes(x=x,y=y,group=factor(g),colour=factor(g)))+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102814.png">

</div>
<p>除了α作为整数的特殊情况外，我们不能得到Γ密度函数积分的显式表示，因此Γ随机变量的累积分布函数称作不完全Γ函数，必须在计算机帮助下用近似方法得到，在统计学中，重要的Γ型随机变量是卡方随机变量。</p>
<p>卡方随机变量是α=ν/2和β=2的Γ型随机变量，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/ac51g6IjEK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/A89BLKGgFK.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>卡方随机变量的均值和方差分别为：<span class="math inline">\(\mu=\nu \quad \delta^2=2\nu\)</span>，参数<span class="math inline">\(\nu\)</span>称为卡方分布的自由度个数。</p>
<h2 id="指数分布exponential-distribution">指数分布(exponential distribution)</h2>
<p>举个例子，在观察一系列事件之间的间隔时间(interarrival time)内，若某事件在每个时间点发生的概率相同，那么间隔时间的分布就氛这于指数分布，那么指数分布的累积分布函数就类似于以下公式： <span class="math display">\[
\operatorname{CDF}(x)=1-\mathrm{e}^{-\lambda x}
\]</span> 其中，参数<span class="math inline">\(\lambda\)</span>决定了分布的形状，下图表示的就是<span class="math inline">\(\lambda = 2\)</span>时的图形：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703192332.png">

</div>
<p>通常，指数分布的均值是<span class="math inline">\(1/\lambda\)</span>，所以上图的这个分布的均值是0.5.分布的中位数是<span class="math inline">\(log(2)/\lambda\)</span>，大概等于0.35。</p>
<h3 id="指数分布案例之一">指数分布案例之一</h3>
<p>再来看一下案例。1997</p>
<p>指数分布可以用来描述电子产品的寿命，例如一个灯光的平均寿命是2500个小时，我们假设认为这个灯泡的寿命服从均值为2500的指数分布，如果一个变量x服从指数分布，就记为<span class="math inline">\(~exp(\lambda)\)</span>，其中<span class="math inline">\(\lambda\)</span>等于均值的倒数。</p>
<p>在R中，生成指数分布随机数的函数是<code>rexp()</code>，其用法是<code>rexp(n,lambda = 1)</code>，其中n表示生成的随机数，<code>lambda=1/mean</code>，例如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x &lt;- rexp(<span class="number">100</span>,<span class="number">1</span>/<span class="number">10</span>)</div><div class="line">hist(x,prob=<span class="literal">T</span>,col=gray(<span class="number">0.9</span>),main=<span class="string">"均值为10的指数分布随机数"</span>)</div><div class="line">curve(dexp(x,<span class="number">1</span>/<span class="number">10</span>),add=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102539.png">

</div>
<p>使用<code>rexp()</code>和逆变换法生成<code>X~Exp(1)</code>的随机数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Nsim = <span class="number">10000</span></div><div class="line">U &lt;- runif(Nsim)</div><div class="line">x = -log(U)</div><div class="line">y &lt;- rexp(Nsim)</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">hist(x,freq=<span class="literal">F</span>,main=<span class="string">"Exp from Uniform"</span>)</div><div class="line">curve(dexp(x,<span class="number">1</span>),add=<span class="literal">T</span>,col=<span class="string">"red"</span>)</div><div class="line">hist(y,freq=<span class="literal">F</span>,main=<span class="string">"Exp from R"</span>)</div><div class="line">curve(dexp(x,<span class="number">1</span>),add=<span class="literal">T</span>,col=<span class="string">"red"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102513.png">

</div>
<h2 id="卡方分布">卡方分布</h2>
<p>正态分布内容参见这篇笔记<a href="http://rvdsd.top/2017/06/06/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-08%E5%8D%A1%E6%96%B9%E5%88%86%E6%9E%90%E4%B8%8E%E5%8D%A1%E6%96%B9%E5%88%86%E5%B8%83/">《卡方检验》</a>。</p>
<h2 id="t分布">t分布</h2>
<p>正态分布内容参见这篇笔记<a href="http://rvdsd.top/2017/06/03/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-03-T%E5%88%86%E5%B8%83%E4%B8%8E%E6%A3%80%E9%AA%8C/">《T分布与t检验》</a>。</p>
<h2 id="f分布">F分布</h2>
<p>F-分布（F-distribution）是一种连续概率分布，被广泛应用于似然比率检验，特别是ANOVA中。F分布定义为：设X、Y为两个独立的随机变量，X服从自由度为k1的卡方分布，Y服从自由度为k2的卡方分布，这2个独立的卡方分布被各自的自由度除以后的比率这一统计量的分布。用公式表示就是下面的样子：</p>
<p>如果X是<span class="math inline">\(\chi^2(m)\)</span>变量，Y是<span class="math inline">\(\chi^2(n)\)</span>变量，而且X和Y独立，那么就有下面的这个公式，即 <span class="math inline">\(F=\frac{X/m}{Y/n}\)</span> 这个公式可以称为具有自由度(m,n)的F分布，记为F(m,n)，也就是说，两个独立<span class="math inline">\(\chi^2\)</span>分布变量（在除以它们各自的自由度后）的比为F分布变量。</p>
<p>F分布的概率密度函数为：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102448.png">

</div>
<p>在F分布中，两个<span class="math inline">\(\chi^2\)</span>分布的自由度则为F分布的自由度，因此，F分布有两个自由度，第一个自由度等于在分子上的<span class="math inline">\(\chi^2\)</span>分布的自由度，第二个自由度等于在分母的<span class="math inline">\(\chi^2\)</span>分布的自由度，下图显著了自由度分别为(3,20)，(10,20)和(50,20)的三条F分布密度曲线：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">x &lt;-c(seq(<span class="number">0</span>,<span class="number">4.5</span>,length=<span class="number">1000</span>))</div><div class="line">y2 &lt;- df(x,<span class="number">50</span>,<span class="number">20</span>)</div><div class="line">y3 &lt;- df(x,<span class="number">10</span>,<span class="number">20</span>)</div><div class="line">y5 &lt;- df(x,<span class="number">3</span>,<span class="number">20</span>)</div><div class="line">plot(x,y2,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">1</span>,main=<span class="string">""</span>)</div><div class="line">lines(x,y3,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">2</span>)</div><div class="line">lines(x,y5,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">3</span>)</div><div class="line">legend(<span class="number">3</span>,<span class="number">1.1</span>,c(<span class="string">"F(50,20)"</span>,<span class="string">"F(10,20)"</span>,<span class="string">"F(3,20)"</span>),lty=<span class="number">1</span>:<span class="number">3</span>)</div><div class="line">text(<span class="number">0</span>,<span class="number">0.6</span>,<span class="string">"F(3,20)"</span>)</div><div class="line">text(<span class="number">0.8</span>,<span class="number">0.85</span>,<span class="string">"F(10,20)"</span>)</div><div class="line">text(<span class="number">1</span>,<span class="number">1.0</span>,<span class="string">"F(50,20)"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102433.png">

</div>
<p>从图上可以看出，当第二个自由度相时，第一个自由度越小，峰越靠近左边。</p>
<h2 id="均匀分布">均匀分布</h2>
<p>均匀分布(uniform distribution)是最简单的连续型分布，它的聚会范围是一个区间，例如(a,b)，均匀颁同随机变量X聚会在该区间的一个子区间的概率等于该子区间宽度与区间(a,b)宽度b-1的比值，如果区间(a,b)为(0,1)区间，那么X落入(0.3,0.7)的概率为(0.7-0.3)/(1-0)=0.4，显然，均匀分布的密度函数在(a,b)区间为常数1/(b-a)，而在该区间外为零，用公式就是以下表示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102417.png">

</div>
<p>这种形状为一个矩形，因此均匀分布也称为矩形分布(rectangular distribution)，定义在(a,b)区间上的均匀分布通常用U(a,b)或Unif(a,b)表示，下图是均匀分布U(0,1)的密度函数（左）和一个来自U(a,b)的样本的直方图（右），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># uniform distribution</span></div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">plot(-<span class="number">10</span>,<span class="number">10</span>,xlab=<span class="string">"X"</span>,ylab=<span class="string">""</span>,xlim=c(-<span class="number">0.3</span>,<span class="number">1.3</span>),ylim=c(<span class="number">0</span>,<span class="number">1.2</span>),main=<span class="string">"U(0,1)"</span>)</div><div class="line">segments(-<span class="number">0.3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</div><div class="line">segments(<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">segments(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1.3</span>,<span class="number">0</span>)</div><div class="line">segments(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,lty=<span class="number">2</span>)</div><div class="line">segments(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,lty=<span class="number">2</span>)</div><div class="line">x&lt;-runif(<span class="number">10000</span>)</div><div class="line">hist(x)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102404.png">

</div>
<h2 id="样本函数的分布">样本函数的分布</h2>
<p>我们希望利用样本，尤其是通过作为样本函数的样本统计量来了解总体，并对总体参数进行推断。这些统计量包括閒贩蛭过的样本均值、样本中位数、样本标准差以及由它们组成的函数。统计量对不同的样本（但有相同的样本量）会取不同的值，作为随机样本的函数，它们也是随机的，也有自己的分布，这些分布就称为抽样分布(sampling distribution)， 我们来看一个案例。 我们有一个正常的色子，看一下每次投掷10次的试验（样本量为10），看一下这个均值的变化，下表记录了15次试验每次得到的结果和该次的样本均值，而和该表相应的左边为15条10个点的拆线，显示了15次共150个点数，右边为掷色子点数的15个均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a &lt;- <span class="literal">NULL</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">15</span>)&#123;</div><div class="line">  x &lt;- sample(<span class="number">1</span>:<span class="number">6</span>,<span class="number">10</span>,rep=<span class="literal">T</span>)</div><div class="line">  a &lt;- rbind(a,c(x,mean(x)))&#125;</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">matplot(<span class="number">1</span>:<span class="number">10</span>,t(a[,-<span class="number">11</span>]),type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,main=<span class="string">"每次掷10次色子，重复15遍"</span>,ylab=<span class="string">"点数"</span>)</div><div class="line">plot(<span class="number">1</span>:<span class="number">15</span>,a[,<span class="number">11</span>],type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,main=<span class="string">"15个均值（每个来自10次掷色子结果)"</span>,ylab=<span class="string">"点数"</span>,ylim=c(<span class="number">1</span>,<span class="number">6</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102303.png">

</div>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102327.png">

</div>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102345.png">

</div>
<p>这些样本均值都和真正的总体均值(1+2+3+4+5+6)/6=3.5不完全一样，它们比较稳定，而不像那些原先的150个样本点，显然，这些均值有其自己的分布，与掷色子原先的多项分布不同，这使得人们对这些样本均值的分布感兴趣，前面介绍的<span class="math inline">\(\chi^2\)</span>分布，t分布和F分布都可以是正态分布总体有关的抽样分布。</p>
<h2 id="样本均值的性质和中心极限定理">样本均值的性质和中心极限定理</h2>
<p>我们把前面的掷色子试验的样本量从10增加到5000，而抽取1000个样本（原来是15个），结果得到1000个均值，这些均值的直方图如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a&lt;-<span class="literal">NULL</span></div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>)&#123;</div><div class="line">x&lt;-sample(<span class="number">1</span>:<span class="number">6</span>,<span class="number">5000</span>,rep=<span class="literal">T</span>)</div><div class="line">a&lt;-rbind(a,mean(x))&#125;</div><div class="line">hist(a,xlab=<span class="string">""</span>,<span class="number">15</span>,freq=<span class="literal">F</span>)</div><div class="line">lines(density(a))</div><div class="line">rug(a)</div><div class="line">mean(a)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102225.png">

</div>
<p>上图解释：做1000次试验，每次掷5000次色子，这样就得到了1000个均值的直方图，图中的曲线是对这1000个均值的密度估计，下面小的短线标出了这1000个均值的实际位置。</p>
<p>这看上去很像正态分布的形状，这些均值的均值为3.500001，接近掷色子的总体均值3.5。这就意味着，当样本量增加时，多项分布（掷色子）的总体均值或许可能用正态分布来近似。其实，在一定条件下，在样本量趋于无穷时，一般分布的样本均值的分布趋于正态分布，这就是关于样本均值的中心极限定量。</p>
<h2 id="中心极限定理">中心极限定理</h2>
<p>假定随机变量X的n个独立观测值组成一个样本，假定X的总体均值为μ，而总体标准差为σ，这两个总体参数通常是未知的，从这个样本，我们还可以计算样本均值<span class="math inline">\(\bar{x}\)</span>和样本标准差x，当然样本均值可以用来估计μ的值，具体这种估计的好坏，依赖于样本均值有什么样的抽样分布。样本均值作为随机变量有如下性质（注：这里没有假定X的分布）：</p>
<ol style="list-style-type: decimal">
<li>样本均值<span class="math inline">\(\bar{x}\)</span>的抽样分布的总体均值等于μ；</li>
<li>样本均值<span class="math inline">\(\bar{x}\)</span>的抽样分布的总体标准差等于<span class="math inline">\(\delta/\sqrt{n}\)</span>，样本量越大，<span class="math inline">\(\bar{x}\)</span>的集中程度越大；</li>
<li>即使X的分布不是正态，那么在很一般的条件下（中心极限定理成立的一个充分条件是：样本点是独立的，来自一个总体（同一个分布），总体均值存在，并且有非零有限总体方差。），当样本量增加时，<span class="math inline">\(\bar{x}\)</span>的分布走近于正态分布<span class="math inline">\(N(\mu,\delta/\sqrt{n})\)</span>，这就是中心极限定理（CLT,central limit theorem)。</li>
</ol>
<p>把上面第二条中的样本均值<span class="math inline">\(\bar{x}\)</span>的抽样分布的总体标准差公式中的σ换成样本标准差s，得到<span class="math inline">\(s/\sqrt{n}\)</span>就是均值的标准误差(standard error of mean,SEM)，它是对<span class="math inline">\(\delta/\sqrt{n}\)</span>的一个近似。现在我们从U(0,1)，<span class="math inline">\(\chi^2(2)\)</span>和F(0,10)这三种分布对于三种样本量大小n=1，3，100分别取600个样本，再计算出每个样本的均值，这样对每一种样本量都有600个均值，用这些均值画直方图，如下所示，可以看出，样本量越大，均值的直方图就越像正态分布，并且数据的分散程度也越小（越集中）。</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102204.png">

</div>
<p>下面代码是《R语言与统计分析》（汤银才）书中的代码来模拟中心极限定理，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">limite.central &lt;- <span class="keyword">function</span>(r=runif,distpar=c(<span class="number">0</span>,<span class="number">1</span>),m=<span class="number">0.5</span>,</div><div class="line">                           s=<span class="number">1</span>/sqrt(<span class="number">12</span>),</div><div class="line">                           n=c(<span class="number">1</span>,<span class="number">3</span>,<span class="number">100</span>),N=<span class="number">600</span>)</div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> n)&#123;</div><div class="line">    <span class="keyword">if</span> (length(distpar)==<span class="number">2</span>)&#123;</div><div class="line">      x&lt;-matrix(r(i*N,distpar[<span class="number">1</span>],distpar[<span class="number">2</span>]),nc=i)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">      x&lt;-matrix(r(i*N,distpar),nc=i)</div><div class="line">    &#125;</div><div class="line">    x&lt;-(apply(x,<span class="number">1</span>,sum)-i*m)/(sqrt(i)*s)</div><div class="line">    hist(x,col=<span class="string">'Light blue'</span>,probability=<span class="literal">T</span>,main=paste(<span class="string">"n="</span>,i),</div><div class="line">         ylim=c(<span class="number">0</span>,max(<span class="number">0.4</span>,density(x)$y)))</div><div class="line">    lines(density(x),col=<span class="string">'red'</span>,lwd=<span class="number">3</span>)</div><div class="line">    curve(dnorm(x),col=<span class="string">'blue'</span>,lwd=<span class="number">3</span>,lty=<span class="number">3</span>,add=<span class="literal">T</span>)</div><div class="line">    <span class="keyword">if</span>(N&gt;<span class="number">100</span>)&#123;</div><div class="line">      rug(sample(x,<span class="number">100</span>))</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">      rug(x)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(runif,distpar = c(<span class="number">0</span>,<span class="number">1</span>))</div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(rchisq,distpar = c(<span class="number">2</span>))</div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(rf,distpar = c(<span class="number">2</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure>
<p>均匀分布：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102026.png">

</div>
<p>卡方分布：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102101.png">

</div>
<p>F分布：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190329102135.png">

</div>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://blog.sina.com.cn/s/blog_670445240101m4z3.html" target="_blank" rel="external">每日一生信–富集分析（超几何分布）（Fisher’s Exact Test）</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_5d1edf6a0100ujcv.html" target="_blank" rel="external">R 超几何分布</a></li>
<li><a href="https://en.wikipedia.org/wiki/Hypergeometric_distribution" target="_blank" rel="external">Wikipedia:Hypergeometric distribution</a></li>
<li>DawnGriffiths. 深入浅出统计学[M]. 电子工业出版社, 2012.</li>
<li>高桥信陈刚. 漫画统计学[M]. 科学出版社, 2009.</li>
<li>拉里·戈尼克, 沃尔科特·史密斯. 漫画统计学入门[M]. 辽宁教育出版社, 2002.</li>
<li>陈希孺.概率论与数理统计[M].中国科学技术大学出版社,1992.</li>
<li><a href="http://blog.fens.me/r-density/" target="_blank" rel="external">常用连续型分布介绍及R语言实现</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/32932782" target="_blank" rel="external">一张图说明二项分布、泊松分布、指数分布、几何分布、负二项分布、伽玛分布的联系</a></li>
<li>统计思维：程序员数学之概率统计.作者: Allen B.Downey，译者: 张建锋 / 陈钢 出版社: 人民邮电出版社</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/03/BioStatistics/生物统计-03假设检验笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/BioStatistics/生物统计-03假设检验笔记/" itemprop="url">假设检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T12:00:00+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,167
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="用小概率事件进行判断">用小概率事件进行判断</h2>
<p>我们有时候会听到“意外发生了”这样的说法，这句话意味着我们相信某个事件发生的概率很小，也就是说它预期不会发生，但是它发生了，例如，没有人会对一个大城市某一天发生交通事故感到意外，因为这要瓣城市每天都发生大量的交通事故，但如果某一天没有发生交通事故，就真是意外了，即小概率事件发生了，另外，人们会觉得一个从来没有出过事故的老司机出事故的概率很小，如果这个司机发生事故了，人们会由于小概率事件发生了而觉得意外。</p>
<p>在统计中，我们常用小概率事件对某项论述进行判断，假如我们对于某个说法表示怀疑，并且试图否定这个说法，那么，我们就要表示，这个说法成立的情况下，我们所观测的数据出现的概率很小。我们用下面的例子说明，人们如何计算用来否定某种说法的这种概率。比如，某大型百货商场说它的抽奖活动有10%的可能抽到奖，而有人注意到有70人抽奖，结果都未中奖，这样人们就会怀疑这个商场作假，在奖券很多的情况下，我们可以假定抽奖70次中成功的次数应该服从二项分布Bin(70,p)，按照商场的说法，每次中奖概率p=0.10，因此我们可以诈出70次抽奖没有人中奖的概率是0.0006265787</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dbinom(<span class="number">0</span>,<span class="number">70</span>,<span class="number">0.1</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.0006265787</span></div></pre></td></tr></table></figure>
<p>也就是说，按照商场的差距中奖概率的说法，70次抽奖都没有抽中的概率只有约万分之六，由此70交抽奖没有人中奖就是发生了小概率事件，这里的“小概率”事件是根据商场提供的参数p=0.1计算出来的，因此我们有理由怀疑商场中关于p=0.1说法的合理性。这里我们所做的就是按照某个假定（这里的商场的说法）来计算随机试验发生某结果的概率，如果小概率事件发生，那么我们有理由质疑那个假定。</p>
<p>假设检验的原理也是如此。</p>
<h2 id="假设检验的基本原理">假设检验的基本原理</h2>
<p>在实际中我们会遇到这样的问题：某一样本均数是否来自于某已知均数的总体？两个不同样本均数是否来自均数不相等的总体等？要回答这类问题，经常使用统计推断的一个方法，即假设检验（hypothesis test）来解决。 假设检验过去称为显著性检验（significance test），它是利用小概率反证法的思想，从问题的对立面（<span class="math inline">\(H_{0}\)</span>）出发，间接判断要解决的问题（<span class="math inline">\(H_{0}\)</span>）是否成立。即在假设<span class="math inline">\(H_{1}\)</span>成立的条件下计算检验统计是不是，然后根据获得的P值来判断。其原理和步骤用以下实例说明。</p>
<h3 id="案例">案例</h3>
<p>例3-5 某医生测量了36名人事铅作用男性工人的血红蛋白含量，算得其均数为130.83g/L，标准差为25.74g/L，问：人事铅作用男性工人的血红蛋白含量均数(<span class="math inline">\(\mu\)</span>)是否不等于正常成年男性的无数140g/L（<span class="math inline">\(\mu_{0}\)</span>）？（医学统计学第四版，孙振球） 本例题可用下图表示： <img src="http://ortxpw68f.bkt.clouddn.com/hypothesis%20test.png"></p>
<p>本题的目的是判断是否<span class="math inline">\(\mu \neq \mu_{0}\)</span>，从所给的条件来看，样本均数<span class="math inline">\(\bar{X}\)</span>与已知总体均数<span class="math inline">\(\mu_{0}\)</span>不等，造成两者不等的原因有二：①从事铅作用工人的血红蛋白含量确实高于正常成年男性，即非同一总体（<span class="math inline">\(\mu \neq \mu_{0}\)</span>）；②因抽样误差导致两者不等，即为同一总体（<span class="math inline">\(\mu = \mu_{0}\)</span>）。 要直接证明是否<span class="math inline">\(\mu \neq \mu_{0}\)</span>很难，但可以利用反证法的思想，从<span class="math inline">\(\mu \neq \mu_{0}\)</span>的对立面<span class="math inline">\(\mu = \mu_{0}\)</span>出发，间接判断是否<span class="math inline">\(\mu \neq \mu_{0}\)</span>。 假设：<span class="math inline">\(\mu = \mu_{0}\)</span>，判断由于抽样误差造成不相等的可能性有多大？</p>
<p>如果<span class="math inline">\(\bar{X}\)</span>与<span class="math inline">\(\mu_{0}\)</span>接近，其差别可用抽样误差解释，可认为<span class="math inline">\(\bar{X}\)</span>来自<span class="math inline">\(\mu_{0}\)</span>总体；如果<span class="math inline">\(\bar{X}\)</span>与<span class="math inline">\(\mu_{0}\)</span>相关甚远，不宜用抽样误差解释，则怀疑<span class="math inline">\(\bar{X}\)</span>不是来自<span class="math inline">\(\mu_{0}\)</span>总体，那么<span class="math inline">\(\bar{X}\)</span>与<span class="math inline">\(\mu_{0}\)</span>相关多大算是由抽样误差造成的呢？若假设<span class="math inline">\(\mu = \mu_{0}\)</span>成立，则可用公式<span class="math inline">\(\frac{\bar{X}-\mu}{S/\sqrt{n}} =t\)</span>或<span class="math inline">\(\frac{\bar{X}-\mu}{\delta/ \sqrt{n}} =\mu\)</span>计算t值或<span class="math inline">\(\mu\)</span>值，然后由t值或<span class="math inline">\(\mu\)</span>值求得P值来判断。如果<span class="math inline">\(\bar{X}\)</span>与<span class="math inline">\(\mu_{0}\)</span>相差较过错，t或<span class="math inline">\(\mu\)</span>值就大，P值就小，当P小于或等于预先规定的概率值<span class="math inline">\(\alpha\)</span>，如0.05时，则为小概率事件。小概率事件在一次抽样中发生的可能性很小，如果它发生了，则有理由怀疑原假设<span class="math inline">\(\mu = \mu_{0}\)</span>可能不成立，认为其对立面<span class="math inline">\(\mu \neq \mu_{0}\)</span>成立，该结婚的正确性冒着5%的错误风险。</p>
<p>从上面分析可以看出，假设检验可归纳为三大基本步骤。 1. 建立检验假设，确定检验水准，假设有两种： (1) <span class="math inline">\(\mu = \mu _{0}\)</span>，常称为无效假设或零假设，用<span class="math inline">\(H_{0}\)</span>表示。 (2) <span class="math inline">\(\mu \neq \mu _{0}\)</span>，常称为备选假设，用<span class="math inline">\(H_{1}\)</span>表示。</p>
<p>对于假设检验，需要注意的是：</p>
<ol style="list-style-type: decimal">
<li>检验假设针对的是总体，而不是样本；</li>
<li><span class="math inline">\(H_{0}\)</span>和<span class="math inline">\(H_{1}\)</span>是相互关系、对立的假设，后面统计推断的结论是根据<span class="math inline">\(H_{0}\)</span>和<span class="math inline">\(H_{1}\)</span>作出的，两者缺一不可；</li>
<li><span class="math inline">\(H_{0}\)</span>为无效假设，其假定通常是：某两个（或多个）总体参数相等，或某两个总体参数之差为0，或某资料服从某一特定分布；</li>
<li><span class="math inline">\(H_{1}\)</span>的内容直接反映了检验的单双侧，若<span class="math inline">\(H_{1}\)</span>为<span class="math inline">\(\mu &gt; \mu_{0}\)</span>或<span class="math inline">\(H_{1}\)</span>为<span class="math inline">\(\mu &lt; \mu_{0}\)</span>，则此检验为单侧检验，它不仅考虑是否有差异，而且还考虑差异的方向，假如上述例3-5中医生只关心铅作业男性工人的血红蛋白含量均数是否低于正常男性的均数；若<span class="math inline">\(H_{1}\)</span>为<span class="math inline">\(\mu \neq \mu_{0}\)</span>，则此检验为双侧检验，例如上述例题中的问题，从事铅作业男性工人的血红蛋白含量均数是否不等于男性的均数140g/L，此时高于和低于正常男性这两种可能性都存在。单侧检验的确定，首先要根据专业知识，其次是根据所要解决的问题来确定。若从专业上看一种方法的结果不可能低于或高于另一种方法，尽量提问为：两种方法的测定结果是否相同？此时仍用单侧检验。一般认为，双侧检验比较保守和稳妥，探索性研究多用双侧检验；而证实性研究多用单侧检验。现在以单样本和两样本均数比较的t检验为例，用下面两张表说明单双侧检验的确定。 <img src="http://ortxpw68f.bkt.clouddn.com/hypothesis%20test2.png"></li>
</ol>
<p>(3)<span class="math inline">\(\alpha\)</span>：即检验水准，也称显著性水准，它属于I型错误的范畴，<span class="math inline">\(\alpha\)</span>是预先规定的概率值，它确定了小概率事件的标准，在实际工作中，常取<span class="math inline">\(\alpha=0.05\)</span>。除了I型错误外，还有II型错误。后面会详细说明第1类错误和第2类错误。</p>
<h2 id="第一类错误和第二类错误">第一类错误和第二类错误</h2>
<h3 id="第一类错误">第一类错误</h3>
<p>第一类错误又称Ⅰ型错误、拒真错误，是指拒绝了实际上成立的、正确的假设，为“弃真”的错误，其概率通常用α表示。即“原假设是正确的，却拒绝了原假设”。我们平时遇到的文献里，基本上都是与第一类错误有关的假设检验，这就是我们常说的“假阳性”，即无中生有，本来实验结果是阳性，非常高兴，后来才发现这是假阳性，把本来不存在的事情，当作了存在。</p>
<h3 id="第二类错误">第二类错误</h3>
<p>第二类错误又称Ⅱ型错误，接受了实际上不成立的H0 ，也就是错误地判为无差别，这类取伪的错误称为第二类错误，其概率用β表示。即“原假设是错误的，却没有拒绝原假设”，这可以理解为“假阴性“，下面的一幅图可以很清楚地说明第一类错误与第二类错误：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703212334.png">

</div>
<h3 id="第一类错误和第二类错误的关系">第一类错误和第二类错误的关系</h3>
<p>当样本例数固定时，α愈小，β愈大；反之，α愈大，β愈小。因而可通过选定α控制β大小。要同时减小α和β，唯有增加样本例数。统计上将1-β称为检验效能或把握度(power of a test)，即两个总体确有差别存在，而以α为检验水准，假设检验能发现它们有差别的能力。实际工作中应权衡两类错误中哪一个重要以选择检验水准的大小。</p>
<h3 id="对第一类错误和第二类错误的简单理解">对第一类错误和第二类错误的简单理解</h3>
<p>我们常把假设检验比作法庭判案，我们想知道被告是好人还是坏人。原假设是“被告是好人”，备择假设是“被告是坏人”。法庭判案会犯两种错误：如果被告真是好人，而你判他有罪，这是第一类错误(错杀好人)；如果被告真是坏人，而你判他无罪，这是第二类错误(放走坏人)。</p>
<p>记忆方法：我们可以把第一类错误记为“以真为假”，把第二类错误记为“以假为真”。当然我们也可以将第一类错误记为“错杀好人”，把第二类错误记为“放走坏人”。</p>
<p>在其他条件不变的情况下，如果要求犯第一类错误概率越小，那么犯第二类错误的概率就会越大。这个结论比较容易理解，当我们要求“错杀好人”的概率降低时，那么往往就会“放走坏人”。</p>
<p>同样的，在其他条件不变的情况下，如果要求犯第二类错误概率越小，那么犯第一类错误的概率就会越大。当我们要求“放走坏人”的概率降低时，那么往往就会“错杀好人”。同样的，在其他条件不变的情况下，如果要求犯第二类错误概率越小，那么犯第一类错误的概率就会越大。当我们要求“放走坏人”的概率降低时，那么往往就会“错杀好人”。</p>
<h2 id="p值的理解">p值的理解</h2>
<p>在假设检验中，拒绝零假设时所允许的最大的犯第一类错误的概率称为显著性水平(level of significance或significance level)，通常用α表示。显著性水平通常是由进行检验的根据实际目标确定的。最常用的显著性水平为0.05，0.01，0.005，0.001等。</p>
<p>在假设检验中，我们通常使用样本的一个统计量作为证据来称量零假设的真伪，该统计量称为检验统计量(test statistic)，和检验统计量关联的一个概念是p值(p-value)，它是在零假设下，出现检验统计量的实现值以及（向备选假设方向）更极端的值的概率，有关p值的更好理解，可以参见这一篇文章<a href="https://mp.weixin.qq.com/s/4LmVdoQdxDlZ6xOgSfXRaA" target="_blank" rel="external">《p值详解》</a>。</p>
<p>p值度量从样本数据得到的信息对零假设的支持程度。因此，p值越小，越有理由说明样本数据不支持零假设。如果p值小于显著性水平α，那么能够拒绝零假设，否则就不能拒绝零假设。因此p值常常被称为该检验的<strong>观测显著性水平(observed level of significance)</strong>。在统计软件的输出中，通常只输出p值，而由用户自己决定p值是多少时拒绝零假设。p值是由数据决定的，而显著性水平是由用户决定的。计算软件仅仅给出p值，而不给出α，例如我们计算得到的p值是0.0005，这时如果以α=0.05为显著性水平，那么此时就拒绝零假设，如果以α=0.001为显著性水平，那么就无法拒绝零假设。α=0.05表明，拒绝零假设时犯错误的概率是百分之五，α=0.001表明，拒绝零假设时犯错误的概率是千分之一。在统计软件的输出结果中，有的使用“p-value”，有的使用significance的缩写，即“Sig”来标明。</p>
<p>根据数据产生的p值来减少α的值以展示结果的精确性总是没有害处的。这就好比一个身高180cm的男生，可能愿意被认为高于或等于180cm，而不愿意被说成高于或等于155cm，虽然第二种说法在数学上没有丝毫错误。</p>
<h3 id="在实际情况中如何把握α与β错误">在实际情况中，如何把握α与β错误</h3>
<p>举个例子，某研究者研究一个化合物A，原假设（H0）：化合物A对于改善糖尿病没有作用。而化合物A可能对改善糖尿病有作用，也可能没有作用。</p>
<p>如果化合物A真的没有作用，而研究的数据支持A有作用，则是犯了第一类错误（即无中生有）。</p>
<p>如果化合物A真的有作用，而数据支持A没有作用，则是犯了第二类错误（即有中生无）。 对于研究者来说，如何把握呢？如果把第一类错误标准定得过于宽松，很容易得到化合物A有作用的结论，把没有效果的东西当作是有效果的，他会把自己的研究结果报告，或者发布到学术界中。其他研究者便会去尝试重复实验，投入大量的人力和物力，去搞一个原本就不存在东西上，这就是极大的浪费，就像某医药公司看到了化合物A能够降改善糖尿病的论文，就投入大量资源去研究（事实上化合物A根本没有作用），这样就会造成浪费。因此宁可把第一类错误的标准定得高一些，这样即使犯了第二类错误，也不至于在本不存在的事情上浪费资源。</p>
<h2 id="假设检验中的一些注意事项">假设检验中的一些注意事项</h2>
<p>某些书中会提到，不能拒绝零假设就接受零假设的说法，而且没有给出犯第二类错误的概率，这是不恰当的。首选，你说“接受零假设”，那么就应该负责任地提供接受零假设时可能犯第二类错误的概率，这就要算出在备选假设正确的情况下，错误地接近零假设的概率。但是，这只有在备选假设仅仅是一个与零假设不同的确定值（而不是范围）时才有可能，多数初等统计教科书中的备选假设是一个范围，例如前面提到例题，在这个例题中，H0:μ=50，H1:μ&lt;50，在这种情况下，根本无法确定犯第二类错误的概率。</p>
<p>在很多应用回归分析的方法中，也有不少书中往往把一系列不能拒绝零假设的检验当成接受这些假设的通行证。比如不能拒绝某样本的正态性就变成了证明该样本是正态的等。其实，不能拒绝这些零假设，仅仅说明，根据当前所使用的检验方法和当前的数据，没有足够证据拒绝这些假设而已。因此，在不能拒绝零假设时，只能够说，按照目前的证据和检验方法，不足以拒绝零假设。</p>
<h2 id="效应">效应</h2>
<h2 id="参考资料">参考资料：</h2>
<p><a href="https://www.zhihu.com/question/20993864/answer/81244176" target="_blank" rel="external">第一类错误和第二类错误的关系是什么？马志阳的回答</a> <a href="https://zhuanlan.zhihu.com/p/25734905" target="_blank" rel="external">假设检验之五：α风险 vs. β风险</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/03/BioStatistics/生物统计-06T分布与检验/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/BioStatistics/生物统计-06T分布与检验/" itemprop="url">t分布与t检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T12:00:00+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,091
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="t分布">t分布</h2>
<p>具有正态分布<span class="math inline">\(N(\mu,\sigma)\)</span>观测值的样本量为n的样本均值也是正态分布变量，在统计推断中往往希望利用它减去总体的均值再除以均值的总体标准差来得到标准正态变量，如下所示：</p>
<p><span class="math inline">\(Z=\frac{\bar{X}-\mu}{\sigma\sqrt{n}}\)</span></p>
<p>在这个变换中，如果用均值的样本标准差来代替其未知的总体标准差时（因为总体的标准差往往未知），即用<span class="math inline">\((\bar{x}-\mu)/(s/\sqrt{n})\)</span>代替<span class="math inline">\((\bar{x}-\mu)/(\delta/\sqrt{n})\)</span>，如下所示：</p>
<p><span class="math inline">\(t=\frac{\bar{X}-\mu}{s\sqrt{n}}\)</span></p>
<p>得到的分布就不再是标准正态分布了，它的密度曲线有点像正态分布，不过中间瘦，尾巴长，这种分布称为<strong>t分布</strong>（t-distribution，或称为学生分布，Student’s t），这个分布是戈塞特（Gosset）发现的，他当时用t来表示这个变量，当时戈塞特在发表论文中，他使用的笔名是Student，因此也叫学生分布，不同的样本量通过标准化所产生的t分布也不同，这样就形成了一族分布，t分布族中的成员是以自由度来区分的，这里的自由度等于样本量减去1，即n-1，t分布通常用于研究小样本的均值，如果自由度趋于无穷，那么t分布就是标准正态分布了，一个有k个自由度的t分布用t(k)表示，下图就展示了标准正态分布N(0,1)和自由度等于1的t(1)以及自由度等于2的t(2)分布的密度函数曲线，我们可以看出，t分布两边尾巴比较长，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">xt&lt;-seq(-<span class="number">4</span>,<span class="number">4</span>,length=<span class="number">300</span>)</div><div class="line">yt1&lt;-data.frame(x=xt,y=dnorm(xt),group=rep(<span class="string">"N(0,1)"</span>,<span class="number">300</span>))</div><div class="line">yt2&lt;-data.frame(x=xt,y=dt(xt,<span class="number">2</span>),group=rep(<span class="string">"t(2)"</span>,<span class="number">300</span>))</div><div class="line">yt3&lt;-data.frame(x=xt,y=dt(xt,<span class="number">1</span>),group=rep(<span class="string">"t(3)"</span>,<span class="number">300</span>))</div><div class="line">y_t &lt;- rbind(yt1,yt2,yt3)</div><div class="line">ggplot(y_t,aes(x=x,y=y,color=group))+geom_line()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180818/IjiL215LF9.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>通常使用<span class="math inline">\(t_{\alpha}\)</span>表示t分布相应于右侧尾概率<span class="math inline">\(\alpha\)</span>的t变量的<span class="math inline">\(\alpha\)</span>上侧分位数，即对t分布变量T，有<span class="math inline">\(P(T&gt;t_{\alpha})=\alpha\)</span>，下图就表示了自由度为2的t(2)分布右边的尾概率（<span class="math inline">\(\alpha=0.05\)</span>），如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180716/4CDKF3aHd4.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h3 id="t分布的密度分布图">t分布的密度分布图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x &lt;- seq(-<span class="number">5</span>,<span class="number">5</span>,length.out=<span class="number">1000</span>)</div><div class="line">y &lt;- dt(x,<span class="number">1</span>,<span class="number">0</span>)</div><div class="line">plot(x,y,col=<span class="string">"red"</span>,xlim=c(-<span class="number">5</span>,<span class="number">5</span>),ylim=c(<span class="number">0</span>,<span class="number">0.5</span>),type=<span class="string">"l"</span>,</div><div class="line">xaxs=<span class="string">"i"</span>,yaxs=<span class="string">"i"</span>,ylab=<span class="string">"density"</span>,xlab=<span class="string">""</span>,</div><div class="line">main=<span class="string">"The T density distribution"</span>)</div><div class="line">lines(x,dt(x,<span class="number">5</span>,<span class="number">0</span>),col=<span class="string">"green"</span>)</div><div class="line">lines(x,dt(x,<span class="number">5</span>,<span class="number">2</span>),col=<span class="string">"blue"</span>)</div><div class="line">lines(x,dt(x,<span class="number">50</span>,<span class="number">4</span>),col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"topleft"</span>,legend=paste(<span class="string">"df="</span>,c(<span class="number">1</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">50</span>),<span class="string">"ncp="</span>,c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>)),lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"green"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/t%20density%20distribution.png">

</div>
<h3 id="t分布的累积分布图">t分布的累积分布图</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">set.seed(1)</div><div class="line">x&lt;-seq(-5,5,length.out=1000)</div><div class="line">y&lt;-pt(x,1,0)</div><div class="line">plot(x,y,col=&quot;red&quot;,xlim=c(-5,5),ylim=c(0,0.5),type=&apos;l&apos;,</div><div class="line">xaxs=&quot;i&quot;, yaxs=&quot;i&quot;,ylab=&apos;density&apos;,xlab=&apos;&apos;,</div><div class="line">main=&quot;The T Cumulative Distribution Function&quot;)</div><div class="line">lines(x,pt(x,5,0),col=&quot;green&quot;)</div><div class="line">lines(x,pt(x,5,2),col=&quot;blue&quot;)</div><div class="line">lines(x,pt(x,50,4),col=&quot;orange&quot;)</div><div class="line">legend(&quot;topleft&quot;,legend=paste(&quot;df=&quot;,c(1,5,5,50),&quot; ncp=&quot;, c(0,0,2,4)), lwd=1, col=c(&quot;red&quot;, &quot;green&quot;,&quot;blue&quot;,&quot;orange&quot;))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180716/gDJ786KC9E.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="某一数据是否符合t分布">某一数据是否符合t分布</h2>
<p>Kolmogorov-Smirnov连续分布检验: 检验单一样本是不是服从某一预先假设的特定分布的方法。以样本数据的累计频数分布与特定理论分布比较，若两者间的差距很小，则推论该样本取自某特定分布族。 该检验原假设为H0:数据集符合T分布，H1:样本所来自的总体分布不符合T分布。令F0(x)表示预先假设的理论分布，Fn(x)表示随机样本的累计概率(频率)函数. 统计量D为: D=max|F0(x) - Fn(x)| D值越小，越接近0，表示样本数据越接近T分布 p值，如果p-value小于显著性水平α(0.05)，则拒绝H0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set.seed(1)</div><div class="line">S&lt;-rt(1000, 1,2)</div><div class="line">ks.test(S, &quot;pt&quot;, 1, 2)</div></pre></td></tr></table></figure>
<p>其中p-value = 0.5461，说明数据集S符合df1=1, ncp=2的T分布</p>
<h2 id="方差齐性检验">方差齐性检验</h2>
<p>t检验过程，是对两样本均数(mean)差别的显著性进行检验。惟t检验须知道两个总体的方差(Variances)是否相等；t检验值的计算会因方差是否相等而有所不同。也就是说，t检验须视乎方差齐性(Equality of Variances)结果。但现在多数统计软件中已经有了方差不齐情况下的检验。另外，在ANOVA检验中，也要进行方差齐性检验。</p>
<h2 id="t检验">t检验</h2>
<p>T检验，亦称student t检验（Student’s t test），主要用于样本含量较小（例如n&lt;30），<strong>总体标准差σ未知</strong>的正态分布资料。</p>
<p>在此要提一下Z检验。 Z检验是一般用于<strong>大样本（即样本容量大于30）</strong>平均值差异性检验的方法。它是用<strong>标准正态分布</strong>的理论来推断差异发生的概率，从而比较两个平均数&gt;平均数的差异是否显著。当<strong>已知标准差</strong>时，验证一组数的均值是否与某一期望值相等时，用Z检验。</p>
<p>R中t检验的函数为t.test()，参数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">t.test(x, <span class="keyword">...</span>)</div><div class="line"></div><div class="line">t.test(x, y = <span class="literal">NULL</span>,alternative = c(<span class="string">"two.sided"</span>, <span class="string">"less"</span>, <span class="string">"greater"</span>),mu = <span class="number">0</span>, paired = <span class="literal">FALSE</span>, var.equal = <span class="literal">FALSE</span>,      conf.level = <span class="number">0.95</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>参数说明 其中x, y是我们样本数据构成的向量，alternative表示备择假设的形式，“two.sided”表示双边检验（H1: 1不等于μ2）， “less”表示单边检验（H1:μ1小于μ2），“greater”表示单边检验（H1:μ1大于μ2），paired表示样本是否是配对的，var.equal表示两总体方差是否相等。</p>
<h3 id="案例运用">案例运用</h3>
<h4 id="配对t检验">配对t检验</h4>
<p>例3-6为比较两种方法对乳酸饮料中脂肪含量测定结果是否不同，随机抽取了10份乳酸饮料制品，分别用脂肪酸水解法和哥特里－罗紫法测定其结果如表3-5第(1)~(3)栏。问两法测定结果是否不同？（《医学统计学》（第四版，孙振球）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_306.csv&quot;,sep=&quot;\t&quot;)</div><div class="line"># read raw data</div><div class="line"></div><div class="line">t.test(raw_data$result[1:10]-raw_data$result[11:20],mu=0)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; t.test(raw_data$result[<span class="number">1</span>:<span class="number">10</span>]-raw_data$result[<span class="number">11</span>:<span class="number">20</span>],mu=<span class="number">0</span>)</div><div class="line"></div><div class="line">	One Sample t-test</div><div class="line"></div><div class="line">data:  raw_data$result[<span class="number">1</span>:<span class="number">10</span>] - raw_data$result[<span class="number">11</span>:<span class="number">20</span>]</div><div class="line">t = <span class="number">7.926</span>, df = <span class="number">9</span>, p-value = <span class="number">2.384e-05</span></div><div class="line">alternative hypothesis: true mean is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.1946542</span> <span class="number">0.3501458</span></div><div class="line">sample estimates:</div><div class="line">mean of x </div><div class="line">   <span class="number">0.2724</span></div></pre></td></tr></table></figure>
<p>结果与书中相同，p值小于0.01，但我觉得这个方法不一定要用配对t检验，普通的t检验也能胜任。</p>
<h4 id="双样本t检验">双样本t检验</h4>
<p>例3-7 为研究国产四类新药阿卡波糖胶囊的降血糖效果，某医院用40名II型糖尿病病人进行同期随机对照试验。研究者将这些病人随机等分到试验组(用阿卡波糖胶囊)和对照组(用拜唐苹胶囊)，分别测得试验开始前和8周时的空腹血糖，算得空腹血糖下降值见表3-6，能否认为该国产四类新药阿卡波糖胶囊与拜唐苹胶囊对空腹血糖的降糖效果不同？（《医学统计学》（第四版，孙振球）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_307.csv&quot;,,header=T,sep=&quot;,&quot;)</div><div class="line"></div><div class="line">a &lt;- as.numeric(raw_data[,1])</div><div class="line">b &lt;- as.numeric(raw_data[,2])</div><div class="line">t.test(a,b)</div></pre></td></tr></table></figure>
<p>运算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	Welch Two Sample t-test</div><div class="line"></div><div class="line">data:  a and b</div><div class="line">t = -<span class="number">0.64187</span>, df = <span class="number">36.086</span>, p-value = <span class="number">0.525</span></div><div class="line">alternative hypothesis: true difference <span class="keyword">in</span> means is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> -<span class="number">2.32926</span>  <span class="number">1.20926</span></div><div class="line">sample estimates:</div><div class="line">mean of x mean of y </div><div class="line">    <span class="number">2.065</span>     <span class="number">2.625</span></div></pre></td></tr></table></figure>
<p>结果p值为0.525。因此尚不能认为阿卡波糖胶囊与拜唐苹胶囊对空腹血糖的降糖效果不同。</p>
<h2 id="t检验的局限">t检验的局限</h2>
<p>虽然t检验使用起来很方便，但是如果不加以注意，很容易误用，经常误用的情况包括：</p>
<ol style="list-style-type: decimal">
<li>不考虑数据的正态性，只要是两组比较就直接使用t检验（如果不符合正态性，就要采用Wilcoxon检验）。</li>
<li>将t检验用于多组实验设计中的两两比较，增加假阳性错误（此时应该使用ANOVA）；</li>
<li>不考虑资料是否独立，采用独立资料的t检验分析。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/02/BioStatistics/生物统计-02点估计与区间估计笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/02/BioStatistics/生物统计-02点估计与区间估计笔记/" itemprop="url">点估计与区间估计笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-02T12:00:00+08:00">
                2017-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,055
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  24
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="点估计">点估计</h2>
<p>用于估计总体参数的统计量叫做估计量(estimator)。统计量是随机变量，估计量也是，对于不同的样本，估计量的聚会也不同，对于任意取定的一个样本，把样本数据代谢估计量的公式，就得到了估计量的一个值，称为估计值(estimate)或者估计量的一个实现(realization)。</p>
<p>衡量估计量的一个标准是相合性(consistency)，这个标准表明，样本量越大，相合估计量(consistent estimator)对总体参数的估计就越精确。另一个标准就是无偏性(unbiasedness)。这意味着，虽然从一个样本得到的估计量的实现并不一定等于总体参数的值，但无穷个估计量的平均观测值（期望值）等于相应的总体参数。满足这样条件的估计量称为无偏估计量(unbiased estimator)。第三个标准就是所有相合、无偏估计量中取方差最小的估计量，也称为最有效或者最好的估计量。</p>
<p>下面看一个简单的例子来介绍一下无偏性和最小方差性。假定<span class="math inline">\(X_{1},X_{2},X_{3},X_{4}\)</span>均服从某均值为<span class="math inline">\(\mu\)</span>的分布的独立观测值。如果我们需要从下面四个关于<span class="math inline">\(\mu\)</span>的估计量中选择一个，那么根据随机变量线性组合的总体均值和方差的性质，这四个估计量的均值都是<span class="math inline">\(\mu\)</span>，因此这个统计量都是<span class="math inline">\(\mu\)</span>的无偏估计量，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180806/AJG1HJEH2J.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>它们的方差分别为：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180806/Lb3A5FcH4D.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>因此，在这四个估计量中，第1个样本均值，即<span class="math inline">\(\bar{X}=\frac{1}{4} \sum\limits_{i=1}^4X_{i}\)</span>的方差最小，这个样本的估计量要优于其他三个。</p>
<p>最常用的估计量就是样本均值(<span class="math inline">\(\bar{x}\)</span>)、样本标准差(s)和(Bernoulli试验的)成功比例(x/n)，常用这几个统计量来分别估计总体均值(<span class="math inline">\(\mu\)</span>)、总体标准差(<span class="math inline">\(\delta\)</span>)和成功概率（或总体中具有某种特征元素的比值）p。</p>
<h2 id="区间估计">区间估计</h2>
<p>在讲区间估计之前，先看一个简单的例子。</p>
<p>当一个人谈论他高三时班上男生的平均身高时，他不太可能会说班长男生的平均身高是“171.25厘米”，而更可能会说“在170厘米左右”或者说“在1.65米到1.75米之间”。后者就是区间估计。</p>
<p>区间估计给出了估计者认为比较可能的一个范围，例如在民间调查中，如果调查是关于对某个看法的支持率时，也可能会说“对于该看法的支持率为45%加减3%的误差，其置信度为95%”，这种描述，既给出了点估计45%，这是样本中的支持率，也给出了一个区间，即45%±3%，或置信区间(confidence interval)(42%,48%).而这里的置信度(confidence level)则是对产生这样一个区间估计的一种信心，并不涉及从样本数据得到的某一个特定的区间。</p>
<p>一般来说，我们不知道总体参数（例如总体的均值或比例）是多少，需要通过样本来估计这个总体参数，其中点估计和区间估计都是从样本中得到的，而点估计中的估计量和区间估计的两个端都是统计量，因而也是随机变量。</p>
<p>“某总体参数ξ的置信度为100(1-α)%的置信区间”这句话表明：如果我们抽取（相同样本量）的大量样本，那么，从这些样本中得到的以同样方法（或公式）计算的大量区间中会有大约1-α比例的区间包含未知的总体参数ξ，而有约α比例的区间不包含该总体参数。例如从具体的一个样本中计算出来的一个数值区间，比如前面的(42%,48%)，这个区间可能包含真实的比例，也有可能不包含真实的比例。由于真实的比例和这个区间(42%,48%)都是确定的数，不包括随机性，也没有概率可言。因此如果用这样的话来描述“95%置信区间(42%,48%)以概率0.95包括真实比例”，这样的话是错误的。如果用概率语言来描述，应该说构造95%置信区间两个端的统计量以0.95的概率包含真实的参数（我觉得可以这么理解，我们在(42%,48%)这个区间内取机抽取一些样本，这些样本有0.95的概率包含真实值）。</p>
<p>通常来说，我们希望区间越窄越好，而另一方面，我们又希望置信度越大越好，对于一定的样本量，如果要增加置信度，通常要加宽区间，而如果要使区间变窄，就要牺牲置信度。但是，如果可以变化样本量，那么在固定了区间的宽度时，置信度会随着样本量的增加而增加，而在固定置信度时，区间宽度会随着样本量的增加而变窄。这主要是因为样本量大，对总体的信息也大，区间估计就会更理想。</p>
<h2 id="正态分布总体均值mu的区间估计">正态分布总体均值<span class="math inline">\(\mu\)</span>的区间估计</h2>
<p>假定X1,X2,..Xn是一个来自于正态分布的样本，我们可以根据这个样本求出关于这个正态总体均值的置信区间，我们知道，总体均值的一个点估计量为样本均值<span class="math inline">\(\bar{X}\)</span>，我们这里所要建立的对均值的区间估计就是以<span class="math inline">\(\bar{X}\)</span>为中心的一个区间，而区间的上下界是根据样本、事先选择的置信度以及正态分布的性质来确定的两个统计量。这样的置信度为1-α的随机区间由下式表示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180807/96ccl8HJeb.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>这里s为样本标准差，n为样本量，<span class="math inline">\(t_{\alpha/2}\)</span>为自由度为n-1的t分布的上侧<span class="math inline">\(\alpha/2\)</span>分位数，这里的上侧<span class="math inline">\(\alpha/2\)</span>分位数是指对于t(n-1)随机变量T，<span class="math inline">\(P(T&gt;t_{\alpha/2})=\alpha/2\)</span>。</p>
<p>这个区间的上下界是统计量，因此该区间是随机区间，置信度是是该随机区间覆盖真实均值的概率，如果根据一个样本的数据算出上下界的真实值，就不是随机区间了，而是一个固定的数值区间，这个区间的宽度为<span class="math inline">\(t\alpha/2s\ \sqrt{n}\)</span>。因此，可以看出，当其他因素固定时，区间宽度和样本量的平方根成反比，此外，由于当置信度1-α增加时，<span class="math inline">\(t_{\alpha/2}\)</span>也增加，因此当其他因素固定时，置信度增加会导致区间变宽，如果其他因素不变时，样本标准差s的减少也会导致置信区间变窄。</p>
<p>现在看一个案例。下面是某厂家标有“净重50克”的30包味精的实际重量，如下所示：</p>
<p>51.5,48.0,47.0,46.3,46.7,47.8,51.6,49.4,48.2,52.3,48.5,45.7,52.1,51.0,48.7,46.6,50.1,48.5,50.9,46.8,51.6,49.2,46.9,52.5,46.2,45.8,51.0,48.1,49.9,49.3</p>
<p>如果我们想要对这个厂家的这各味精重量的总体均值做出区间值估计，置信度取95%。</p>
<p>假定该总体服从正态分布，根据数据，计算出置信区间如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; data&lt;-c(<span class="number">51.5</span>,<span class="number">48.0</span>,<span class="number">47.0</span>,<span class="number">46.3</span>,<span class="number">46.7</span>,<span class="number">47.8</span>,<span class="number">51.6</span>,<span class="number">49.4</span>,<span class="number">48.2</span>,<span class="number">52.3</span>,<span class="number">48.5</span>,<span class="number">45.7</span>,<span class="number">52.1</span>,<span class="number">51.0</span>,<span class="number">48.7</span>,<span class="number">46.6</span>,<span class="number">50.1</span>,<span class="number">48.5</span>,<span class="number">50.9</span>,<span class="number">46.8</span>,<span class="number">51.6</span>,<span class="number">49.2</span>,<span class="number">46.9</span>,<span class="number">52.5</span>,<span class="number">46.2</span>,<span class="number">45.8</span>,<span class="number">51.0</span>,<span class="number">48.1</span>,<span class="number">49.9</span>,<span class="number">49.3</span>)</div><div class="line">&gt; data</div><div class="line"> [<span class="number">1</span>] <span class="number">51.5</span> <span class="number">48.0</span> <span class="number">47.0</span> <span class="number">46.3</span> <span class="number">46.7</span> <span class="number">47.8</span> <span class="number">51.6</span> <span class="number">49.4</span> <span class="number">48.2</span> <span class="number">52.3</span> <span class="number">48.5</span> <span class="number">45.7</span> <span class="number">52.1</span> <span class="number">51.0</span> <span class="number">48.7</span> <span class="number">46.6</span> <span class="number">50.1</span> <span class="number">48.5</span> <span class="number">50.9</span> <span class="number">46.8</span> <span class="number">51.6</span> <span class="number">49.2</span> <span class="number">46.9</span> <span class="number">52.5</span> <span class="number">46.2</span> <span class="number">45.8</span> <span class="number">51.0</span> <span class="number">48.1</span> <span class="number">49.9</span> <span class="number">49.3</span></div><div class="line">&gt; t.test(data,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">        One Sample t-test</div><div class="line"></div><div class="line">data:  data</div><div class="line">t = <span class="number">125.94</span>, df = <span class="number">29</span>, p-value &lt; <span class="number">2.2e-16</span></div><div class="line">alternative hypothesis: true mean is not equal to <span class="number">0</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">48.14524</span> <span class="number">49.73476</span></div><div class="line">sample estimates:</div><div class="line">mean of x </div><div class="line">    <span class="number">48.94</span></div></pre></td></tr></table></figure>
<p>从上面结果可以看出来，这批数据的95%置信区间为(48.14524,49.73476)。</p>
<p>或者直接通过公式进行计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; mean(data)+qt(<span class="number">0.025</span>,<span class="number">29</span>,low=<span class="literal">F</span>)*sd(data)/sqrt(<span class="number">30</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">49.73476</span></div><div class="line">&gt; mean(data)-qt(<span class="number">0.025</span>,<span class="number">29</span>,low=<span class="literal">F</span>)*sd(data)/sqrt(<span class="number">30</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">48.14524</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180807/gA6FDi3lJ0.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>为了说明不同置信度和不同的样本量对置信区间的影响，下图显示了n=50和n=20，以及置信度为0.95和0.60的四种排列组合情况的各自基于80个正态样本的置信区间，如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180809/BBHA0c4a6j.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>在下图中，置信区间为两边有短的竖直线段，线段中间的点为样本均值，图中水平虚线为真实的总体均值，从图中可以看到，对于固定的样本量，置信度越大，包含总体均值的区间就越多（上下图比较）。</p>
<p>而对于相同的置信度，样本量n越大，区间狭窄（左右图比较）。在每个图内部的各个置信区间的长短也不一样，这是因为样本标准差因样本而异，这也影响置信区间的长度，从图中可以看出，每个根据样本得到的置信区间，有的覆盖真实的总体均值，有的不覆盖真实的总体均值，但众多的置信区间中覆盖总体均值的区间数量的比例则反映了置信度的大小，这些区间都是随机区间的实现，而置信度只是随机区间覆盖总体均值的概率。</p>
<p>两个独立正态分布总体均值差<span class="math inline">\(\mu_{1}-\mu_{2}\)</span>的区间估计</p>
<p>假定样本量为m和n的独立样本<span class="math inline">\(X_{1},\cdots,X_{m}\)</span>和<span class="math inline">\(Y_{1},\cdots,Y_{n}\)</span>分别来自均值为<span class="math inline">\(\mu_{1}\)</span>和<span class="math inline">\(\mu_{2}\)</span>的两个独立正态总体，现在求出这两个正态总体均值之差<span class="math inline">\(\mu_{1}-\mu_{2}\)</span>的置信区间。总体均值差的一个点估计量为样本均值<span class="math inline">\(\bar{X}-\bar{Y}\)</span>，此时要求的均值差的区间估计就是以<span class="math inline">\(\bar{X}-\bar{Y}\)</span>为中心的一个区间，而区间的上下界为根据样本、选择的置信度以及正态分布的性质来确定的两个统计量。这个计算过程由统计软件完成，但在计算的时候，要注意两点，第一，当两个总体的方差一样时，统计软件会用一种方法来计算置信区间；第二，当两个总体的方差不同时，需要用另外一种方法来计算置信区间。</p>
<p>现在看一案例。</p>
<p>下面的这组数据描述了两个生产线生产每一个零件的耗时（单位：s）记录。其中第一个生产线记录了27个时间，第二个记录了25个时间，现在我们计算一下第一个和第二个生产线生产一个零件所花的时间均值差别为95%的置信区间。我们假定两个记录均来自独立正态分布的总体，下面是这两个记录，如下所示：</p>
<p>生产线1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">25.8,30.1,26.8,33.3,26.9,33.7,34.5,24.6,31.7,39.1,29.5,25.6,28.2,29.5,32.4,23.7,</div><div class="line">26.2,28.0,30.1,31.0,29.5,37.7,28.6,27.0,29.8,27.6,29.0</div></pre></td></tr></table></figure>
<p>生产线2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">28.7,31.1,27.9,28.7,30.2,30.5,23.3,27.5,29.5,28.6,26.6,26.8,26.6,29.6,30.4,24.8,</div><div class="line">24.4,25.3,30.6,27.3,27.2,32.0,27.6,29.6,25.8</div></pre></td></tr></table></figure>
<p>在比较这两组数据之前，需要比较两个正态总体相等或不相等时，关于均值差的置信区间计算有所不同，现在我们用x和y分别表示两个样本。</p>
<p>检验方差是不相等时，使用<code>var.test(x,y)$p.value</code>，此时会得到一个数值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt; x&lt;-c(<span class="number">25.8</span>,<span class="number">30.1</span>,<span class="number">26.8</span>,<span class="number">33.3</span>,<span class="number">26.9</span>,<span class="number">33.7</span>,<span class="number">34.5</span>,<span class="number">24.6</span>,<span class="number">31.7</span>,<span class="number">39.1</span>,<span class="number">29.5</span>,</div><div class="line">+      <span class="number">25.6</span>,<span class="number">28.2</span>,<span class="number">29.5</span>,<span class="number">32.4</span>,<span class="number">23.7</span>,<span class="number">26.2</span>,<span class="number">28.0</span>,<span class="number">30.1</span>,<span class="number">31.0</span>,<span class="number">29.5</span>,<span class="number">37.7</span>,</div><div class="line">+      <span class="number">28.6</span>,<span class="number">27.0</span>,<span class="number">29.8</span>,<span class="number">27.6</span>,<span class="number">29.0</span>)</div><div class="line">&gt; y&lt;-c(<span class="number">28.7</span>,<span class="number">31.1</span>,<span class="number">27.9</span>,<span class="number">28.7</span>,<span class="number">30.2</span>,<span class="number">30.5</span>,<span class="number">23.3</span>,<span class="number">27.5</span>,<span class="number">29.5</span>,<span class="number">28.6</span>,<span class="number">26.6</span>,</div><div class="line">+      <span class="number">26.8</span>,<span class="number">26.6</span>,<span class="number">29.6</span>,<span class="number">30.4</span>,<span class="number">24.8</span>,<span class="number">24.4</span>,<span class="number">25.3</span>,<span class="number">30.6</span>,<span class="number">27.3</span>,<span class="number">27.2</span>,<span class="number">32.0</span>,</div><div class="line">+      <span class="number">27.6</span>,<span class="number">29.6</span>,<span class="number">25.8</span>)</div><div class="line">&gt; var.test(x,y)</div><div class="line"></div><div class="line">	<span class="literal">F</span> test to compare two variances</div><div class="line"></div><div class="line">data:  x and y</div><div class="line"><span class="literal">F</span> = <span class="number">2.7086</span>, num df = <span class="number">26</span>, denom df = <span class="number">24</span>, p-value = <span class="number">0.01657</span></div><div class="line">alternative hypothesis: true ratio of variances is not equal to <span class="number">1</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">1.205780</span> <span class="number">6.006175</span></div><div class="line">sample estimates:</div><div class="line">ratio of variances </div><div class="line">          <span class="number">2.708634</span> </div><div class="line"></div><div class="line">&gt; var.test(x,y)$p.value</div><div class="line">[<span class="number">1</span>] <span class="number">0.01656675</span></div></pre></td></tr></table></figure>
<p>在这个案例中，此时的p值为0.01656675，这就说明，如果说方差不相等，那么出错的概率约为0.0166，它是小于0.05的（通常以这个显著性水平来判断），因此可认为方差不等。</p>
<p>此时我们使用<code>t.test(x,y,con=0.95)$con</code>就可以得到方差不等时的95%置信区间，因为在R中，<code>t.test()</code>这个函数默认的参数中，<code>var=F</code>，如果方差相等，那么就使用<code>t.test(x,y,con=0.95,var=T)$con</code>来计算置信区间，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; t.test(x,y,con=<span class="number">0.95</span>)$con</div><div class="line">[<span class="number">1</span>] -<span class="number">0.1025709</span>  <span class="number">3.3064227</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>
<p>注：求两个样本差值的置信区间公式如下所示：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180809/H33EfhL97l.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<h2 id="配对正态分布总体均值差mu_dmu_1-mu_2的区间估计">配对正态分布总体均值差<span class="math inline">\(\mu_{D}=\mu_{1}-\mu_{2}\)</span>的区间估计</h2>
<p>看完了独立正态总体的均值差的区间估计。再看一下两个总体是配对的情况(paired)，这种情况下，它们的样本称为配对样本，常见的情况有减肥前后的重量比较，治疗前后的症状比较，同样情况下对两种材料某种性能的比较，看下面一个案例。</p>
<p>一个有13人畚听减肥计算实话前后所称体重列在下表中，这里的X和Y分别是减肥前后的重量，而D为其差值，如下所示：</p>
<table>
<thead>
<tr class="header">
<th>X</th>
<th>88.9</th>
<th align="center">107.3</th>
<th>106.2</th>
<th>121.8</th>
<th>103.7</th>
<th>133.8</th>
<th>65.5</th>
<th>77.7</th>
<th>50.8</th>
<th>81.5</th>
<th>95.6</th>
<th>74.4</th>
<th>96.7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Y</td>
<td>58.5</td>
<td align="center">119.6</td>
<td>80.8</td>
<td>97.5</td>
<td>106.3</td>
<td>106.5</td>
<td>43</td>
<td>66.4</td>
<td>55</td>
<td>61.1</td>
<td>95.2</td>
<td>59.1</td>
<td>103.8</td>
</tr>
<tr class="even">
<td>D</td>
<td>30.4</td>
<td align="center">-12.3</td>
<td>25.4</td>
<td>24.3</td>
<td>-2.6</td>
<td>27.3</td>
<td>22.5</td>
<td>11.3</td>
<td>-4.2</td>
<td>20.4</td>
<td>0.4</td>
<td>15.3</td>
<td>-7.1</td>
</tr>
</tbody>
</table>
<p>现在我们计算一下减肥前后体重差值的均值<span class="math inline">\(\mu_{D}(=\mu_{1}-\mu_{2})\)</span>的估计，这里假定重量区间为正态分布。</p>
<p>在这个案例中，减肥前后的体重并不是独立的，不是独立的是指，减肥前的体重与减肥后的体重只是与同一个人比较才有意义，因此这个问题不能用前面对待两个独立样本的方法来求估计值。不过，可以把每个人减肥前后的重量相减，用得到的差值来进行估计，我们用(X,Y)代表配对样本，样本量为n，均值分别为<span class="math inline">\(\mu_{1}\)</span>和<span class="math inline">\(\mu_{2}\)</span>，并令D=X-Y为这两个样本相应元素之间的差，即对于<span class="math inline">\(i=1,\cdots,n,D_{i}=X_{i}-Y_{i}\)</span>，假定D服从均值为<span class="math inline">\(\mu_{D}(=\mu_{1}-\mu_{2})\)</span>的正态分布，在这种情况下，问题就转化成了求单样本均值估计的问题了，现在过计算一下<span class="math inline">\(\mu_{D}\)</span>的95%置信区间就是(2.627,20.619)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; x&lt;-c(<span class="number">88.9</span>,<span class="number">107.3</span>,<span class="number">106.2</span>,<span class="number">121.8</span>,<span class="number">103.7</span>,<span class="number">133.8</span>,<span class="number">65.5</span>,<span class="number">77.7</span>,<span class="number">50.8</span>,<span class="number">81.5</span>,<span class="number">95.6</span>,<span class="number">74.4</span>,<span class="number">96.7</span>)</div><div class="line">&gt; y&lt;-c(<span class="number">58.5</span>,<span class="number">119.6</span>,<span class="number">80.8</span>,<span class="number">97.5</span>,<span class="number">106.3</span>,<span class="number">106.5</span>,<span class="number">43</span>,<span class="number">66.4</span>,<span class="number">55</span>,<span class="number">61.1</span>,<span class="number">95.2</span>,<span class="number">59.1</span>,<span class="number">103.8</span>)</div><div class="line">&gt; t.test(x,y,paired=<span class="literal">T</span>)$conf</div><div class="line">[<span class="number">1</span>]  <span class="number">2.627241</span> <span class="number">20.618913</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div><div class="line">&gt; t.test(x-y)$conf</div><div class="line">[<span class="number">1</span>]  <span class="number">2.627241</span> <span class="number">20.618913</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>
<h2 id="总体比例bernoulli试验成功概率p的区间估计">总体比例(Bernoulli试验成功概率)p的区间估计</h2>
<p>在抽样调查中，计算某特征的总体比例是最基本的目的之一，任何一个调查报告，都应给出样本比例，以及所描述的总体比例的具有某置信度的置信区间，下面就是一个案例。</p>
<p>某地对1050人的随机调查结果显示，有1048人支持减少公车数量，另外，有人调查了政府机关中盺30人，有2人支持减少官员公车数量，我们希望分别找根据这两个调查数据找出总体中支持减少公车的人的比例的点估计以及其置信度为95%的置信区间，并且比较这两个调查。</p>
<p>我们知道，严格说来，抽样调查应该是不施加抽样，而样本中具有某种特征的元素数目应该属于超几何分布，但在大总体时，可以看成为放回抽样，因此可以看成近似于二项分布。如果总体量大，且样本量充分大时，那么根据中心极限定量，可以用视为近似正态分布。</p>
<p>假定样本量为n，样本中具有某种特征的元素数目(Bernoulli试验成功次数)为x，而样本比例为<span class="math inline">\(\hat{p}=x/n​\)</span>，在这种符号，用正态近似计算总体比例的置信度为<span class="math inline">\((1-\alpha)​\)</span>的置信区间的公式如下所示： <img src="http://ortxpw68f.bkt.clouddn.com/professional/180810/DGcgh6hD75.png?imageslim" alt="mark"></p>
<p>这里的<span class="math inline">\(z_{\alpha/2}\)</span>是标准正态分布的上<span class="math inline">\(\alpha/2\)</span>分位点。但是，一般来说，很难确定需要多大样本才能使用用正态分布。如果使用这个公式计算出来的区间包含了0或者1，则说明样本不够大，这是因为总体比例不可能小于0，也不可能大于1，是否为大样本，不仅依赖于n，而且依赖于<span class="math inline">\(\hat{p}\)</span>的大小，当<span class="math inline">\(\hat{p}\)</span>越接近于0或1时，为了正态近似所需要样本量就越大。</p>
<p>现在看前面的这个案例的计算结果。</p>
<p>第一个调查，n=1050，x=1048，那么<span class="math inline">\(\hat{p}=x/n=0.9980952\)</span> p的精确95%置信区间计算如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; n=<span class="number">1050</span></div><div class="line">&gt; x=<span class="number">1048</span></div><div class="line">&gt; binom.test(x,n,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">	Exact binomial test</div><div class="line"></div><div class="line">data:  x and n</div><div class="line">number of successes = <span class="number">1048</span>, number of trials = <span class="number">1050</span>, p-value &lt; <span class="number">2.2e-16</span></div><div class="line">alternative hypothesis: true probability of success is not equal to <span class="number">0.5</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.9931364</span> <span class="number">0.9997692</span></div><div class="line">sample estimates:</div><div class="line">probability of success </div><div class="line">             <span class="number">0.9980952</span></div></pre></td></tr></table></figure>
<p>也就是( 0.9931364,0.9997692)，置信区间宽度为0.0066328。</p>
<p>也可以使用<code>Hmisc</code>包中的<code>binconf</code>函数来计算，binconf函数的用法为binconf(x,n,alpha=c,method=“all”)，它计算的是三种置信区间：</p>
<p>(1)精确置信区间；</p>
<p>(2)一种Wilson近似区间；</p>
<p>(3)正态近似区间，其中置信度为1-c（我们计算的是95%置信区间，因此这里的c就是0.05）。</p>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; binconf(x,n,alpha=<span class="number">0.95</span>,method=<span class="string">"all"</span>)</div><div class="line">            PointEst     Lower     Upper</div><div class="line">Exact      <span class="number">0.9980952</span> <span class="number">0.9973564</span> <span class="number">0.9984768</span></div><div class="line">Wilson     <span class="number">0.9980952</span> <span class="number">0.9980090</span> <span class="number">0.9981778</span></div><div class="line">Asymptotic <span class="number">0.9980952</span> <span class="number">0.9980109</span> <span class="number">0.9981796</span></div></pre></td></tr></table></figure>
<p>第三行就是近拟正态分布的95%置信区间。</p>
<p>再看第二个调查，n=30，x=2，那么<span class="math inline">\(\hat{p}=x/n=0.0666667\)</span> p的精确95%置信区间计算如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; n=<span class="number">30</span></div><div class="line">&gt; x=<span class="number">2</span></div><div class="line">&gt; binom.test(x,n,con=<span class="number">0.95</span>)</div><div class="line"></div><div class="line">	Exact binomial test</div><div class="line"></div><div class="line">data:  x and n</div><div class="line">number of successes = <span class="number">2</span>, number of trials = <span class="number">30</span>, p-value = <span class="number">8.68e-07</span></div><div class="line">alternative hypothesis: true probability of success is not equal to <span class="number">0.5</span></div><div class="line"><span class="number">95</span> percent confidence interval:</div><div class="line"> <span class="number">0.008178134</span> <span class="number">0.220735402</span></div><div class="line">sample estimates:</div><div class="line">probability of success </div><div class="line">            <span class="number">0.06666667</span></div></pre></td></tr></table></figure>
<p>也就是( 0.008178134,,0.220735402)，置信区间宽度为0.2125573。</p>
<p>也可以使用<code>Hmisc</code>包中的<code>binconf</code>函数来计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; binconf(x,n,alpha=<span class="number">0.95</span>,method=<span class="string">"all"</span>)</div><div class="line">            PointEst     Lower     Upper</div><div class="line">Exact      <span class="number">0.9980952</span> <span class="number">0.9973564</span> <span class="number">0.9984768</span></div><div class="line">Wilson     <span class="number">0.9980952</span> <span class="number">0.9980090</span> <span class="number">0.9981778</span></div><div class="line">Asymptotic <span class="number">0.9980952</span> <span class="number">0.9980109</span> <span class="number">0.9981796</span></div></pre></td></tr></table></figure>
<p>从上面的两个计算结果可以看出，第一个正态近似所得到的区间包含了1，因此应该采用精确方法计算的区间，精确的区间宽度只有约0.0066328，非常精确，按照抽样调查通常的说法是“误差约为±0.332%”，因此可以说“该地公众中约有99.8%的人支持减少官员公车的数量，误差为0.332%”。对于第二个调查来说，正态近似公式区间和精确区间有些出入，第二个调查得到的精确区间宽度约为0.2125573，是第一个区间的32.05倍，很不精确，可以说“该地政府机关工作者中有约6.7%的人支持减少公车的数量，误差为±10.628%。</p>
<p>第一个调查代表了群众的观点，第二个调查只代表了政府机关工作人员的观点，从这个例子可以看出，只给出比例是不行的，必须给出样本量或者具有某置信度的置信区间，还应该告知抽样的对象和范围。很多调查报告只给出比例是不合适的 ，假定关于某药品疗效的调查的样本量是2，有效率是1/2，那么有效率的95%置信区间为(0.01257912,0.9874209)，区间宽度为0.9748418，几乎和所有可能取值范围(0,1)相同，这样结果没有任何意义，但如果不给出分母或给出具有某置信度的置信区间，而只说50%有效，必然会误导大众。</p>
<h2 id="如何概算调查所需的样本量">如何概算调查所需的样本量</h2>
<p>在美国总统选举的各种民意测序人中，关于支持率的一个常用标准是置信度为95%，而误差在3%以内（置信区间宽度为6%）。那么要达到这样的标准需要调查多少人，就需要概算一下样本量了，我们可以根据前面关于总体比例置信区间的正态近似公式，由<span class="math inline">\(\hat{p}\)</span>、<span class="math inline">\(z_{\alpha/2}\)</span>来推算样本量，通过查表或者统计软件，容易得出<span class="math inline">\(z_{0.025}\approx1.96\)</span>，如果取<span class="math inline">\(\hat{p}=0.5\)</span>，那么由下面的公式可以计算：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180811/54Dfh0cg4a.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>求得n=1067.11，取大于它的最小整数，得n=1068，这就是说，至少要问1068个人，人们可能会问，为什么取<span class="math inline">\(\hat{p}=0.5\)</span>呢，这是因为人们在抽样前并不知道<span class="math inline">\(\hat{p}\)</span>是多少，而在<span class="math inline">\(\hat{p}=0.5\)</span>时，需要的n最大，因此保险的作用是在计算样本量时取<span class="math inline">\(\hat{p}=0.5\)</span>，比方说，假如取了<span class="math inline">\(\hat{p}=0.1\)</span>，会得到n=385，这时，如果真实的<span class="math inline">\(\hat{p}=0.5\)</span>，那么误差就约等于0.0499，大于要求的0.03了。</p>
<h2 id="总体比例之差p_1-p_2的区间估计">总体比例之差<span class="math inline">\(p_{1}-p_{2}\)</span>的区间估计</h2>
<p>现在通过以下案例来说明两个比例之差的区间估计 两个商场某天对某品牌的洗衣粉的销售表明，在商场A的1217名顾客中，购买这种洗衣粉的有53名，而在商场B的1750个顾客中，购买这种洗衣粉的有20人，假定两个商场的交易分别代表两个总体，求这两个总体中购买该品牌洗衣粉的比例之间的区间估计。</p>
<p>这里有两个总体比例，分别是商场A和B所有交易中购买该品牌洗衣粉的比例，现在的数据表明<span class="math inline">\(n_{1}=1217,x_{1}=53,n_{2}=1750,x_{2}=20\)</span>，假定两个总体比例分别是<span class="math inline">\(p_{1}\)</span>和<span class="math inline">\(p_{2}\)</span>，我们希望求这两个总体比例之差<span class="math inline">\(p_{1}-p_{2}\)</span>的95%点估计和区间估计，令<span class="math inline">\(\hat{p_{1}}=x_{1}/n_{1}\)</span>，<span class="math inline">\(\hat{p_{2}}=x_{2}/n_{2}\)</span>。</p>
<p>点估计很好计算，<span class="math inline">\(\hat{p_{1}}-\hat{p_{2}}\)</span>即可，区间估计一般都使用正态分布近似或者<span class="math inline">\(\chi^2\)</span>分布近似区间。常用的正态近似公式有几种，常用的是下面的这一种：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180811/DmmH22ibgc.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>而且都可以为了适应连续分布而做连续性修正，在这个案例中，这两个总体比例之差<span class="math inline">\(p_{1}-p_{2}\)</span>的95%置信区间为(0.01892344,0.04531884)，计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; prop.test(c(<span class="number">53</span>,<span class="number">20</span>),c(<span class="number">1217</span>,<span class="number">1750</span>),con=<span class="number">0.95</span>)$con</div><div class="line">[<span class="number">1</span>] <span class="number">0.01892344</span> <span class="number">0.04531884</span></div><div class="line">attr(,<span class="string">"conf.level"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.95</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/01/BioStatistics/生物统计-01统计学基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/01/BioStatistics/生物统计-01统计学基础/" itemprop="url">统计学基础汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-01T12:00:00+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  10,825
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  43
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="统计学术语">统计学术语</h2>
<p>下面是一些常见的医学或生物学统计学术语。</p>
<h2 id="数据和变量">数据和变量</h2>
<p>在了解这两个术语之前，先看一组数据，从这组数据出发，说明这几个术语。</p>
<p>这组数据是R中自带的数据集，即<code>iris</code>这个数据集，iris数据集的中文名是安德森鸢尾花卉数据集，英文全称是Anderson’s Iris data set。iris包含150个样本，对应数据集的每行数据。每行数据包含每个样本的四个特征和样本的类别信息，所以iris数据集是一个150行5列的二维表，我们先看一下这个数据集的结构，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; str(iris)</div><div class="line"><span class="string">'data.frame'</span>:   <span class="number">150</span> obs. of  <span class="number">5</span> variables:</div><div class="line"> $ Sepal.Length: num  <span class="number">5.1</span> <span class="number">4.9</span> <span class="number">4.7</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">5.4</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">4.4</span> <span class="number">4.9</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Width : num  <span class="number">3.5</span> <span class="number">3</span> <span class="number">3.2</span> <span class="number">3.1</span> <span class="number">3.6</span> <span class="number">3.9</span> <span class="number">3.4</span> <span class="number">3.4</span> <span class="number">2.9</span> <span class="number">3.1</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Length: num  <span class="number">1.4</span> <span class="number">1.4</span> <span class="number">1.3</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.7</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Width : num  <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.4</span> <span class="number">0.3</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.1</span> <span class="keyword">...</span></div><div class="line"> $ Species     : Factor w/ <span class="number">3</span> levels <span class="string">"setosa"</span>,<span class="string">"versicolor"</span>,..: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>再看一下前几条信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(iris)</div><div class="line">  Sepal.Length Sepal.Width Petal.Length Petal.Width Species</div><div class="line"><span class="number">1</span>          <span class="number">5.1</span>         <span class="number">3.5</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">2</span>          <span class="number">4.9</span>         <span class="number">3.0</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">3</span>          <span class="number">4.7</span>         <span class="number">3.2</span>          <span class="number">1.3</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">4</span>          <span class="number">4.6</span>         <span class="number">3.1</span>          <span class="number">1.5</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">5</span>          <span class="number">5.0</span>         <span class="number">3.6</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">6</span>          <span class="number">5.4</span>         <span class="number">3.9</span>          <span class="number">1.7</span>         <span class="number">0.4</span>  setosa</div></pre></td></tr></table></figure>
<p>从上面的这两个结果，我们可以得到这些信息：</p>
<p>第一，这个数据集一共有150行，5列。</p>
<p>第二，每1列的名称分别为<code>Sepal.Length</code>、<code>Sepal.Width</code>、<code>Petal.Length</code>、<code>Petal.Width</code>和<code>Species</code>，它们分别表示鸢尾花的花萼长度，花萼宽度、花瓣长度，花瓣宽度，种属，也就是说第1行中一共有这5个信息，我们把这5个信息称为<code>变量(variable)</code>。这里需要说明一下的是，变量(variable)在计算机/数据库等领域也叫属性(attribute)、特征(feature)、特性(characteristic)、字段(field)等等。</p>
<p>再回到<code>iris</code>这个数据集中。</p>
<p>其中，我们把种属(Species)这个信息称为<code>定性变量（qualitative variable）</code>，定性变量取的值称为<code>水平(level)</code>或<code>类(class)</code>。定性变量有其它的教材中也会称为分类变量(categorical variable)、属性变量(attributives variable)、名义变量/标称变量(nominal variable)或维度(dimension)。</p>
<p>再看其它的4个变量，它们是用具体的数字表示，这些变量称为<code>定量变量(quantitative variable)</code>，有也领域也称为指标。</p>
<p>定性变量的例子除了种属外，还有其他的例子，例如我们常见的性别，颜色等，在有些情况下，定量变量也会按照定性变量去处理，例如，为了调查方便，我们在问卷中可以只问高收入、中收入还是低收入，而不是问具体多少钱，这种定性变量还能进行排序，它们也常常称为定序变量（ordinal variable）。</p>
<p>定量变量还能分为<code>连续型变量(continuous variable)</code>和<code>离散型变量(discrete variable)</code>。</p>
<p>连续型变量的例子有身高、体重、热量、速度、长度等，它们的取值 是实数轴的某一个区间或者是某些区间集合中的所有可能点的变量。</p>
<p>离散型变量的例子有，某种事件发生的次数，例如抛5次硬币，在描述有几次正面朝上的时候，只可能是0次，1次，2次，3次，4次，5次，而不可能是1.5次这种小数，离散型变量只能取正整数或0。</p>
<p>还看上面的案例，整个<code>iris</code>这个数据集中，除了第1行的变量名称外，剩下的内容则是与这些变量对应的数据(data)，可以把数据看成变量的观测值，或者是试验结果，例如，身高是一个变量，测量一个人的身高，就好比一次试验，可观测到一次试验结果，就是<code>观测值(observation)</code>。这里还要提一下，观测值(observation)在计算机/数据库领域也叫记录(record)、对象(object)、向量(vector)、模式(pattern)、事件(event)、例(case,instance)、样本(sample)、或项、实体(entity)等等。</p>
<p>我们一般所说的数据是一个集合名词，每一个数字包含很多观测值，每个观测值也称为一个数据点(data point, point)或例(case)。就以这个<code>iris</code>的数据集为例，它的每1列代表一个变量，而每1行则为一个对象关于各个变量的观测值，簇也把这种数据方阵的每一行叫做一个观测（值），就像下面的样子，它就是一个观测：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101801.png">

</div>
<p>这也是一个观测值，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101825.png">

</div>
<h2 id="横断面研究和纵贯研究">横断面研究和纵贯研究</h2>
<p><code>横断面研究(cross-sectional  study)</code>是指，它的数据是一群人在某个时间点的情况。</p>
<p><code>纵贯研究(longitudinal study)</code>是指，在一段时间内手里观察同一群人。</p>
<h2 id="概率和随机变量">概率和随机变量</h2>
<p>在统计学研究中，有很多对象都被认为具有随机性(randomness)，随机的事情也有规律的，例如我们抛一个硬币，在硬币落在地面之前，硬币朝哪面我们是不知道的，它是随机的，事先无法准确地预测。但是，只要这个硬币是正常的，没问题的，那么我们就知道，硬币朝上与朝下的概率基本上是相等的。</p>
<p>在这里，硬币的朝上与朝下的这个变量，它就是随机变量(random variable)。而一个随机变量的性质则完全被与其相关的概率或概率分布决定。那什么是概率？</p>
<p>一个事件(event)的概率(probability)是该事件发生可能性的一个数量度量，它的聚会范围是0到1，也可能是0或1.当一个事件的概率接近1时，则说明这个事件很可能发生；如果概率接近0，则说明不太可能发生，如果概率为0.5，那么说明该事件发生和不发生的可能性一样。</p>
<p>简单来说，概率称量某个事件出现的机会，有些概率在某种假定条件下可以算出来，例如抛硬币，得到正面朝上与反面朝上的概率都是0.5，这种可能计算概率的事件称为等可能事件（equally likely event)，这种可能是假定的，对于硬币来说，就是假定正面与反面朝上的㜅一样，如果我们抛了一千次，其中得到正面与反面朝上的频率或相对频数(relative frequency)都接近0.5，那么就说明这个硬币是公平的，是正常的，这些事件理论上可能通过重复试验中出现的频率来计算其发生的概率。</p>
<p>不过有些概率是无法用重复计算来估计的，例如有人认为，最近3个月内中东地区发生大规模军事冲突的概率是80%，这显著无法用重复试剂来估计，这只是他们基于过去的经合和掌握的信息形成的信息，这种概率称为主观概率(subjective probability)。</p>
<h2 id="利用r产生随机数">利用R产生随机数</h2>
<p>在进行抽样时，或者是模拟某个分布时，我们常常要用到随机数，现在都是用软件来生成随机数，虽然这种随机数不晃真正的随机数，但是已经足够使用了，使用软件生成的这种随机数称为伪随机数(pseudo-random number)，现在介绍一下用R来如何生成随机数。</p>
<p>现在生成10个2到3之间的，服从均匀分布的伪随机数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; set.seed(<span class="number">1000</span>)</div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"> [<span class="number">1</span>] <span class="number">2.327879</span> <span class="number">2.758846</span> <span class="number">2.113936</span> <span class="number">2.690755</span> <span class="number">2.516402</span> <span class="number">2.067738</span> <span class="number">2.738715</span> <span class="number">2.583535</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.215771</span> <span class="number">2.256122</span></div></pre></td></tr></table></figure>
<p>现在解释一下，先看<code>runif()</code>这个函数，在R中，这个函数前面的<code>r</code>表示随机，<code>unif</code>表示服从均匀分布，类似的还有<code>rnorm()</code>，它的功能类似，只是它生成的是服从正态分布的随机数，其中<code>norm</code>就是正态分布的意思。</p>
<p>现在，再看<code>set.seed(1000)</code>的作用是保证你随机生成的数字前后一致，如果它的参数就是一个数字，这个数字可以随意指定，括号里的数字只要一致，那么每次生成的随机数就一致，如果不使用这个函数，那么我们每次运行<code>runif(10,2,3)</code>，它生成的随机数就不一样，现在看一下下面的代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 不指定set.seed()</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.567518</span> <span class="number">2.049710</span> <span class="number">2.561620</span> <span class="number">2.966179</span> <span class="number">2.509945</span> <span class="number">2.700937</span> <span class="number">2.020349</span> <span class="number">2.783569</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.584397</span> <span class="number">2.317293</span></div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 再次运行runif(10,2,3),生成的结果就不一样</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.996208</span> <span class="number">2.531047</span> <span class="number">2.109908</span> <span class="number">2.633212</span> <span class="number">2.797929</span> <span class="number">2.712990</span> <span class="number">2.702835</span> <span class="number">2.562833</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.258873</span> <span class="number">2.506937</span></div><div class="line">&gt; set.seed(<span class="number">1000</span>) <span class="comment"># 指定set.seed(1000)</span></div><div class="line">&gt; runif(<span class="number">10</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment"># 生成的结果就与前面的一样</span></div><div class="line"> [<span class="number">1</span>] <span class="number">2.327879</span> <span class="number">2.758846</span> <span class="number">2.113936</span> <span class="number">2.690755</span> <span class="number">2.516402</span> <span class="number">2.067738</span> <span class="number">2.738715</span> <span class="number">2.583535</span></div><div class="line"> [<span class="number">9</span>] <span class="number">2.215771</span> <span class="number">2.256122</span></div></pre></td></tr></table></figure>
<h2 id="个体总体样本和抽样">个体、总体、样本和抽样</h2>
<p>为了说明这几个术语，我们还要看一个案例。</p>
<p>我们要调查一下外地游客在重庆认路的情况进行调查，那么我们可以这么设计问题，“请问，你在重庆旅游时，是否很容易找到目的地？”可能的回答有这些：“很容易”，“不容易“，”不知道“。调查的目的是希望知道在重庆的游客中，对这个问题的三种回答所占的比例，显然不可能调查所有的游客，但我们可以调查其中的一部分，进而估计出在重庆的所有游客的回答。</p>
<p>在这个例子中，单个游客称为调查的对象(object)，他们的回答称为个体(element,或individual, unit)，而所有在重庆的游客对这个问题的回答称为一个总体(population)，总体是包含所有要研究的个体的集合，而调查时，问到那些游客则称为该总体的一个样本(sample)，是总体中挑选出来的一部分。</p>
<p>在抽取样本时，如果总体中的每一个体都有同等机会被选到样本中，这种抽样称为简单随机抽样(sample random sampling)，这样得到的样本称为随机样本(random sample)。不过即使是随机抽样，也不可能保证样本与总体的对应特征完全一样，会出现与总体的误差，这种误差无法避免，这样的误差称为抽样误差(sampling error)。</p>
<h3 id="观察单位observed-unit">观察单位（observed unit）</h3>
<p>观察单位也叫个体（individual），是统计研究中的基本单位，它可以是一个人，一头动物，也可能是特指一群人（例如一个家庭、一个幼儿园，一个自然村）。</p>
<h3 id="总体population">总体（population）</h3>
<p>根据研究目的而确定的同质观察单位的全体，更确切地说，它是同质的所有观察单位某种观察值的集合，例如调查某地2008年7岁正常女童的身高，而其中的观察单位（个体）则是每个女童。由于这里的总体明确规定了空间、时间、人群范围内有限个观察单位，因此称为<strong>有限总体（finite populaton）</strong>。而在一些情况下，总体的概念则是设想的或抽象的，例如研究某治疗慢性前列腺增生的药物的疗效，这里的总体的同质基础是慢性前列腺增生患者，该总体应包括用该药治疗的所有前列腺增生症患者的治疗结果，没有时间和空间的限制，其观察单位的全体数只是理论上存在的，因此可以视为“无限”，称为<strong>无限总体（infinite populaton）</strong>。</p>
<p>虽然我们要研究某个问题是关于整个总体的，但是研究者通常不可能考察总体中的所有个体，为了降低成本，因此在医学研究中通常彩从总体中抽取样本（sample）的方法，根据样本信息来推断总体特征，这种方法叫<strong>抽样研究（sampling research）</strong>，从总体中抽取部分观察单位的过程称为<strong>抽样（sampling）</strong>。</p>
<p>为了保证样本的代表性，抽样必须遵循<strong>随机化（randomization）</strong>原则。从总体中随机抽得的部分观察单位，其实际测量的集合就是样本，该样本中包含的观察单位数称为该样本的<strong>样本含量（sample size）</strong>。例中从某地2008年7岁正常女童中，随机抽取了110名女童，测量身高，得到了110名女童的身高测量值，组成了样本；也可能从就诊的前列腺增生症患者中随机抽取了100名患者，并观察药物的治疗效果，就组成了治疗效果的样本。</p>
<h3 id="变量variable">变量（variable）</h3>
<p>确定总体后，研究者对每个观察单位的某项特征进行观察或测量，这种特征能表现观察单位的变量异，就是变量。例如某地7岁女童的身高，体重都可以视为变量。</p>
<h3 id="统计推断">统计推断</h3>
<p>在实际研究工作中，受条件所限，在研究中很难得到整个总体，往往堡垒有得到总体中的一个子集，即实际工作中往往按随机的方式从总体中抽取若干有代表性的同质个体所构成的一个样本（sample）进行研究，这就需要通过样本有限的、不确定的信息来歓有关总体的特征，这就是统计推断（statistical inference），简言之，统计推断是指由样本所提供的信息对总体数量规律做出推断。</p>
<h3 id="强度相对数">强度相对数</h3>
<p>说明某现象发生的频率或强度，称为率。常以百分率(%)、千分率(‰)、万分率(1/万)、十万分率（1/10万）等表示。 例5-1：2839名职工，发生高血压5人，高血压发病率为5/2839=1.76‰。</p>
<h3 id="结构相对数">结构相对数</h3>
<p>表示事物内部某一部分的个体数与该事物部分个体数的总和之比，用来说明各构成部分在总体中所占的比重或分布，称为构成比，通常以100%为比例基数。 例5-2 某医院1990年因五种疾病死亡的人数共190人，其中死于恶性肿瘤者58人，恶性肿瘤死亡人数占五种疾病死亡人数的构成比为58/190=30.53% 。</p>
<h3 id="相对比">相对比</h3>
<p>相对比简称比(ratio)，是两个有关指标之比，说明两指标间的比例关系，通常以倍数或百分数（%）表示。例如某年医院出生婴儿中，男性为370，女性为358，则婴儿性别比为370/358*100=103</p>
<h3 id="同比">同比</h3>
<p>发展速度主要是为了消除季节变动的影响，用以说明本期发展水平与去年同期发展水平对比而达到的相对发展速度。如，本期2月比去年2月，本期6月比去年6月等。其计算公式为：同比发展速度=本期发展水平/去年同期发展水平×100%。</p>
<h3 id="环比">环比</h3>
<p>当前水平与前一时期水平之比，表明现象逐期的发展速度。如计算一年内各月与前一个月对比，即2月比1月，3月比2月，4月比3月 ……12月比11月，说明逐月的发展程度。</p>
<h2 id="数据的描述">数据的描述</h2>
<p>我们拿到一批数据，可能会考虑这些问题，这些数据是什么，这些数据如何表示，如何从整体上来描述这批数据。</p>
<h3 id="如何查看数据">如何查看数据</h3>
<h2 id="计量资料measurement-data">计量资料（measurement data）</h2>
<p>计量资料又叫定量资料（quantitative data）或数值变量资料(numerical variable)，表现为数值大小，一般有计量单位，例如身高多少厘米，体重多少公斤。根据测量值是否连续，又可分为连续型（continuous）和离散型（discrete），连续理革可在褛范围内聚任意值，例如身高，体重，而离散型只能取整数值，例如死亡人数。</p>
<h3 id="离散型数据discrete-data">离散型数据(discrete data)</h3>
<p>离散型数据本质上是一种分类。最典型的例子，就是性别、种族、职业、教育程度等。在多数情况下，离散型数据并没有具体的数值（比如性别中的男和女），或者虽然形式上由数值表示，但数值本身并没有明确的意义（比如用邮政编码来记录受试者居住的地域）。有些离散变量是有某种顺序关系的，比如说教育程度可以从低到高排列，而有些离散变量并没有这种顺序，比如说某个基因的基因型。这两种情况分别称为有序变量(ordinal variable)和名义变量(nominal variable)。</p>
<h3 id="连续型数据continuous-data">连续型数据(continuous data)</h3>
<p>连续型数据的数值有具体的科学意义，并且可以在数轴上的某个范围连续取值比如身高、体重、血糖浓度、肾小球滤过率等。</p>
<h2 id="计数资料enumeration-data">计数资料（enumeration data）</h2>
<p>计数资料又称定性资料(qualitative data )或无序分类（unordered categorical variable）变量资料，亦称为名义变量资料，它的变量值是定性的，表现为互不相容的特性，例如结果的阴阳，家族史的有无等，分为两种：一种是二分类，例如治愈与未治愈，另一种是多分类，例如血型，A型，B型，AB型和O型。</p>
<h2 id="等级资料ranked-data">等级资料（ranked data）</h2>
<p>又称半定量资料（semi-quantitative data）或有序分类变量（ordinal categorical variable）资料：它将观察单位按某种程度分为等级，例如某药物治疗的效果为治愈、显效、好转、无效。</p>
<h2 id="数据整体的一般描述">数据整体的一般描述</h2>
<h3 id="极差">极差</h3>
<p>又叫全距(Range)，是用来表示统计资料中的变异量数(measures of variation)，其最大值与最小值之间的差距；即最大值减最小值后所得之数据。</p>
<h3 id="均值">均值</h3>
<p>通常情况下，我们所说的均值都是所有的数据之和除以数据的数目，但是，在一些特殊的情况下，会指明均值的类型，例如是算术均值，还是几何均值。</p>
<h3 id="算术均值arithmetic-mean">算术均值(arithmetic mean)</h3>
<p>算术平均数是对集中趋势的最常用的描述。我们对某个量进行了n次观测，把测量到的数值分别记为X1, X2,…, Xn，那么要得到算术平均数，只需把X1到Xn加起来，再除以数据的个数n。数学公式为： <span class="math display">\[ \bar{X}=\frac{\sum_{i=1}^nX{_i}}{n}  \]</span></p>
<h3 id="几何均值geometric-mean">几何均值（geometric mean）</h3>
<p>几何平均数是指n个观察值连乘积的n次方根。</p>
<h3 id="中位数median">中位数(median)</h3>
<p>中位数是把该变量所有取值从小到大（或从大到小）排序，取最中间的一个（例如总共有21个数，则取排行第11的）。如果样本量是偶数，则取中间两个数的平均。</p>
<h3 id="众数mode">众数(mode)</h3>
<p>一组数据中出现次数最多的数值，叫众数，有时众数在一组数中有好几个。用M表示。 理性理解：简单的说，就是一组数据中占比例最多的那个数。</p>
<p>例如：2，3，3，3，4，5的众数是3。 但是，如果有两个或两个以上个数出现次数都是最多的，那么这几个数都是这组数据的众数。 例如：2，2，3，3，4，5的众数是2和3。 其次，如果所有数据出现的次数都一样，那么这组数据没有众数。 例如：2，3，4，5没有众数。</p>
<h3 id="百分位数percentile">百分位数(percentile)</h3>
<p>如果将一组数据从小到大排序，并计算相应的累计百分位，则某一百分位所对应数据的值就称为这一百分位的百分位数。可表示为：一组n个观测值按数值大小排列。如，处于p%位置的值称第p百分位数。</p>
<h3 id="百分位数的计算">百分位数的计算</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">w&lt;-c(75.0,64.0,47.4,66.9,62.2,62.2,58.7,63.5,66.6,64.0,57.0,69.0,56.9,50.0,72.0) # 建立向量w</div><div class="line">quantile(w) # 给出w的四分位数</div><div class="line">quantile(w,probs=seq(0,1,0.2),na.rm=FALSE) # 给出向量w的20%，40%分位数</div><div class="line">quantile(w,0.80) # 求w的80%分位数</div><div class="line">quantile(w,0.75)- quantile(w,0.25) #半极差计算</div></pre></td></tr></table></figure>
<p>结果如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; quantile(w) # 给出w的四分位数</div><div class="line">   0%   25%   50%   75%  100% </div><div class="line">47.40 57.85 63.50 66.75 75.00 </div><div class="line">&gt; quantile(w,probs=seq(0,1,0.2),na.rm=FALSE) # 给出向量w的20%，40%分位数</div><div class="line">   0%   20%   40%   60%   80%  100% </div><div class="line">47.40 56.98 62.20 64.00 67.32 75.00 </div><div class="line">&gt; quantile(w,0.80) # 求w的80%分位数</div><div class="line">  80% </div><div class="line">67.32 </div><div class="line">&gt; quantile(w,0.75)- quantile(w,0.25) #半极差计算</div><div class="line">75% </div><div class="line">8.9</div></pre></td></tr></table></figure></p>
<p>另外一种方法是用<code>cumsum()</code>函数来计算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cumsum(round(table(w)/length(w)*100,2)) # cumsum表示的是累积之和</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; cumsum(round(table(w)/length(w)*100,2)) # cumsum表示的是累积之和</div><div class="line">  47.4     50   56.9     57   58.7   62.2   63.5     64   66.6   66.9     69     72     75 </div><div class="line">  6.67  13.34  20.01  26.68  33.35  46.68  53.35  66.68  73.35  80.02  86.69  93.36 100.03</div></pre></td></tr></table></figure>
<h3 id="四分位数quartile">四分位数（Quartile)</h3>
<p>统计学中，把所有数值由小到大排列并分成四等份，处于三个分割点位置的数值就是四分位数。第一，四分位数 (Q1)，又称“较小四分位数”，等于该样本中所有数值由小到大排列后第25%的数字。第二，四分位数 (Q2)，又称“中位数”，等于该样本中所有数值由小到大排列后第50%的数字。第三，四分位数 (Q3)，又称“较大四分位数”，等于该样本中所有数值由小到大排列后第75%的数字。第三，四分位数与第一四分位数的差距又称四分位距（InterQuartile Range,IQR）。四分位距的优点在于，与全距（极差）相比，较少受异常值的影响。 R中用来显示四分位数的函数是quantile，另外用boxplot可以绘制出某个数据集的箱线图。</p>
<p>箱线图结果<code>boxplot(w)</code>如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190703182218.png">

</div>
<p>条睛线图的解读：最下面是下界，最上面的圆圈是上界，上界的圆圈是异常值，中间矩形的底边是下分位数，上边是上四分位数，中间的粗线是中位数，箱体的高是四分位距。</p>
<h2 id="数据离散程度的描述">数据离散程度的描述</h2>
<p>对于一批数据来说，我们有时候需要看一下这批数据的波动分散程度如何，这就需要一些指标。</p>
<h3 id="变异">变异</h3>
<p>医学研究的对象虽功能复杂的有机作整体。不同的个体在相同的条件下，对外因环境因素可以发生不同的反应，这种同质基础上个体特征值之间的差异，称为变异（variation）（医学统计学及SAS应用，王炳顺）。</p>
<h3 id="离均差deviation-from-the-mean">离均差(deviation from the mean)</h3>
<p>每一个变量值X与均数<span class="math inline">\(\mu\)</span>的差值，即离均差(X-<span class="math inline">\(\mu\)</span>)。</p>
<h3 id="离均差平方和">离均差平方和</h3>
<p>由于离均差有正有负，最终所有离均差的和即<span class="math inline">\((X-\mu)\)</span>为0，因此离均差的和无法描述一组数据的变异大小。因此将离均差平方后相加得到平方和<span class="math inline">\(Var(X)=E(X-\mu)^2\)</span>，这就是离均差平方和（sum of squares of deviations from mean）。</p>
<h3 id="总体方差">总体方差</h3>
<p>虽然离均差平方和消除了正负的影响，但是如果变量值N越大，则离均差平方和也越大，为此，将离均离平方和除以N就得到了方差，方差用<span class="math inline">\(\delta^2\)</span>表示，计算公式为：</p>
<p><span class="math display">\[ \delta^2={\frac{\sum(X-\mu)^2}{N}}  \]</span></p>
<p>另外，方差（variance）也称均方差（mean square deviation）</p>
<h3 id="样本方差">样本方差</h3>
<p>上面的是总体方差，如果是样本方差，那么总体均值<span class="math inline">\(\mu\)</span>是未知的，因此，这个时候就要用样本的均值来替代总体的均值，这个时候也不能用<span class="math inline">\(\delta^2\)</span>来表示样本方差，需要用<span class="math inline">\(s^2\)</span>来表示方差，此外，N值也要减去1，公式就如下所示：</p>
<p>$s^2={} $</p>
<h3 id="标准差">标准差</h3>
<p>标准差（standard deviation）是方差的正平方根，其单位与原变量值的单位相同，总体标准差用<span class="math inline">\(\delta\)</span>表示，计算公式为： <span class="math display">\[ \delta=\sqrt{\frac{\sum(X-\mu)^2}{N}}  \]</span></p>
<h3 id="为什么是n-1">为什么是N-1？</h3>
<p>前面我们看到了总体方差与样本方差的分母不太一样，总体方差的分母是N，而样本方差则是N-1，为什么不一样呢？</p>
<p>在了解这个问题之前，我们先要了解一个统计学中的概念，自由度（degree of freedom）。</p>
<h3 id="自由度的理解">自由度的理解</h3>
<p>这里的N严格意义上来讲，就是自由度，在统计学中，几乎所有的方法、所有指标都会涉及自由度，因为自由度跟样本的数目有关，任何统计学方法都离不开样本数目这个变量。自由度的字面意思是，计算样本统计量时能够自由取值的个数，一般用df来表示，来看一个简单的例子，如果有一个方程为x+y+z=100，一旦y和z的值固定，那么x的值也就固定了，因此x=100-y-z，因此，x，y，z这三个变量是不可能同时自由取值的，能够自由取值的个数只有2个，而不是3个，这就是说，自由度为2。</p>
<p>现在再来看一下样本的自由度为什么是N-1，因为我们在用样本统计量来估计总体参数时，我们有一个暗含的假定，即假定统计量是参数的无偏估计，也就是说样本的参数与总体的参数是相等的，这就相当于我们默认了一个限定（就像x+y+z=100一样），因此，样本的自由度就不是N，而是n-1。在不同的统计方法中，自由度都不一样，但基本原则都是每估计1个参数，就要降低一个自由度，现在看一下其他的统计学方法。</p>
<ol style="list-style-type: decimal">
<li>在单样本t检验中，自由度是t-1，因为只需要估计1个参数（均数），所以只需要消耗1个自由度，所以自由度是t-1.</li>
<li>在两组比较的t检验中，自由度是n1+n2-2，这是因为需要估计的参数有2个，也就是两组的均值，对于每一组而言，一旦均值固定，能够自由取值的个数就只有n1-1个（n1是第一组的例数），即自由度为n1-1。同样的道理，对于第二组而言，其自由度为n2-2，所以，总体自由度就是n1+n2-2。</li>
<li>在多组比较的方差分析中，当有k个组的时候，需要估计k值组的均数，所以总的自由度是(n1+n2+…nk)-k。而对于组间变异所用到的自由度，因为总均数是固定的，所以需要减去1个自由度，即k-1。</li>
<li>在回归分析中，如果有m个自变量，就有m个参数需要估计，而且还需要估计截距项，因此待估计的参数有m+a个（m个自变量加1个截矩项），所以模型的F检验用到的自由度为n-(m+1)。它意味着只剩下n-(m+1)个可以自由取值的数值来估计模型误差，当自变量数m固定时，如果样本n比较小，就会导致有效估计例数不足，从而导致结果不可靠。</li>
</ol>
<p>因此，样本方差的分母使用n-1才更接近于总体的参数，这是无偏估计（unbiased estimator），如果直接使用n，那就是有偏估计（biased estimator ），不过当样本数量大到一定程度时，分母是n-1和n差别不大。</p>
<p>自由度这个角度是一种比较粗糙的理解方式，不过知乎上有人列出了证明过程，如下所示：</p>
<p>本来，按照定义，方差的估计值应时是这个：</p>
<p><span class="math inline">\(S_{1}^{2}=\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}\)</span>，<span class="math inline">\(S_{1}^{2}=\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}\)</span></p>
<p>但是这个估计是有编的，因为： <span class="math display">\[
\begin{aligned} E\left(S_{1}^{2}\right) &amp;=\frac{1}{n} \sum_{i=1}^{n} E\left(\left(X_{i}-\overline{X}\right)^{2}\right)=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu+\mu-\overline{X}\right)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(\left(X_{i}-\mu\right)^{2}-2\left(X_{i}-\mu\right)(\overline{X}-\mu)+(\overline{X}-\mu)^{2}\right)\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-2 \sum_{i=1}^{n}\left(X_{i}-\mu\right)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n(\overline{X}-\mu)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n E\left((\overline{X}-\mu)^{2}\right)\right) \\ &amp;=\frac{1}{n}(\operatorname{nVar}(X)-n \operatorname{Var}(\overline{X}))\\&amp;=\operatorname{Var}(X)-\operatorname{Var}(\overline{X})\\&amp;=\sigma^{2}-\frac{\sigma^{2}}{n}\\&amp;=\frac{n-1}{n} \sigma^{2} \end{aligned}
\]</span> 接着，</p>
<p><span class="math display">\[
\begin{aligned} E\left(S_{1}^{2}\right) &amp;=\frac{1}{n} \sum_{i=1}^{n} E\left(\left(X_{i}-\overline{X}\right)^{2}\right)=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu+\mu-\overline{X}\right)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(\left(X_{i}-\mu\right)^{2}-2\left(X_{i}-\mu\right)(\overline{X}-\mu)+(\overline{X}-\mu)^{2}\right)\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-2 \sum_{i=1}^{n}\left(X_{i}-\mu\right)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n}\left(X_{i}-\mu\right)^{2}-n(\overline{X}-\mu)(\overline{X}-\mu)+n(\overline{X}-\mu)^{2}\right) \\ &amp;=\frac{1}{n} E\left(\sum_{i=1}^{n} E\left(\left(X_{i}-\mu\right)^{2}-n E(\overline{X}-\mu)^{2}\right)\right) \\ &amp;=\frac{1}{n}(\operatorname{nVar}(X)-n \operatorname{Var}(\overline{X}))\\&amp;=\operatorname{Var}(X)-\operatorname{Var}(\overline{X})\\&amp;=\sigma^{2}-\frac{\sigma^{2}}{n}=\frac{n-1}{n} \sigma^{2}\end{aligned}
\]</span> 而<span class="math inline">\((\mathrm{n}-1) / \mathrm{n} \times \sigma^{2} \neq \sigma^{2}\)</span>。所以，为了避免使用有偏的估计值，我们通常使用它的修正值<span class="math inline">\(S^2\)</span>，如下所示：<span class="math inline">\(S^{2}=\frac{1}{n-1} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}\)</span>，<span class="math inline">\(S^{2}=\frac{1}{n-1} \sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}\)</span></p>
<h3 id="样本标准差">样本标准差</h3>
<p>样本标准差的公式如下所示： <span class="math display">\[ s=\sqrt{\frac{\sum(X-\bar{X})^2}{n-1}}  \]</span></p>
<h3 id="标准差计算函数">标准差计算函数</h3>
<p>在Excel中计算方差的公式为<code>STDEV.P</code>和<code>STDEV.S</code>其中，STDEV.P计算时，认为你给出的数据是总体，因此它的分母为N，而STDEV.S计算时，认为你给出的数据是样本，因此它的分母为N-1。在R中，用到的函数为<code>sd</code>，默认的就是样本，因此分母为N-1。</p>
<h3 id="标准误与标准差的区别">标准误与标准差的区别</h3>
<p>在医学统计中，还经常遇到标准差与标准误。例如我们要调查地区A中10岁男孩的身高。如果全部都统计下来，直接测是最准确的数据。但是成本高，不现实。因此需要进行采样，一次测量100个男孩的身高，求这一次的均值M1与标准差S1，如果采样10次，每次都取100人，我们会得到10个均值，分别记为M1，M2，M3…M10，对这10个均值再求一个均值M以及标准差S，其中这个标准差S就是<code>标准误(standard error)</code>，即<code>均值的标准误差(standard error of mean)</code>。</p>
<p>从上面的描述我们就知道了，标准差与标准误的区别在于：第一，标准差是对一次抽样的原始数据进行计算的，而标准误则是对多次抽样的样本统计量进行计算的（这个统计量可以是均值，可以是率）；第二，标准差只是一个描述性指标，只是描述原始数据的波动情况，而标准误是跟统计推断有关的指标，大多数的统计量计算都需要用到标准误。</p>
<p>很多统计量都跟标准误有关，以简单的<em>t</em>检验为例，可能以前有的人都没有注意过。仔细观察一下就可以发现，<em>t</em>检验统计量的分子是两组样本数据的均值差值，反映了样本数据的差异；分母是标准误，反映了抽样误差。所以<em>t</em>检验反映了什么呢？其实就是看到底是抽样误差大还是真实差异大。如果分母的抽样误差大，那就说明结果可能不可靠，所以P值就会比较大；如果分子的差异大，说明抽样误差造成这种差异的可能性不大，所以P值就会比较小。</p>
<h3 id="标准误与标准差的联系">标准误与标准差的联系</h3>
<p>SEM表示每次抽样获得的均数的标准差，因此如果要获取SEM，就必须做很多次抽样，这样也非常麻烦，但是标准误与标准差虽然不是一个概念，但在数学上有一定的联系，其公式如下所示： <span class="math display">\[ SEM=SD/\sqrt{N}  \]</span></p>
<h3 id="变异系数coefficient-of-variation">变异系数(coefficient of variation)</h3>
<p>简称为CV，标准差与均值的比值。公式为： <span class="math display">\[ CV=\frac{S}{\bar{X}}\times100\% \]</span></p>
<h2 id="数据整体的呈现方式">数据整体的呈现方式</h2>
<h3 id="箱线图和频率直方图">箱线图和频率直方图</h3>
<p>箱线图(boxplot)汇集了中位数、四分位差以及一些其他信息，能够使我们对样本的分布有一个直观的了解，也可以让我们快速发现数据中可能存在的错误（例如因为数据录入或单位错误导致的异常值）。它之所以被称为箱线图，是因为它用一个“箱子”来表示我们的数据中最靠中间的一半（即Q1和Q3之间的所有数据点），而用箱子上下的两根“胡须”来表示数据的上下限范围。箱线图的画法以及含义见下图。</p>
<h2 id="正态分布">正态分布</h2>
<p>若随机变量X服从一个数学期望为<span class="math inline">\(\mu\)</span>、方差为<span class="math inline">\({\sigma}^2\)</span>的正态分布，记为<span class="math inline">\(N(\mu,{\sigma}^2)\)</span>。其概率密度函数为正态分布的期望值<span class="math inline">\(\mu\)</span>决定了其位置，其标准差<span class="math inline">\(\sigma\)</span>决定了分布的幅度。因其曲线呈钟形，因此人们又经常称之为钟形曲线。我们通常所说的标准正态分布，即<span class="math inline">\(\mu\)</span> = 0,<span class="math inline">\(\sigma\)</span> = 1的正态分布，其公式为： <span class="math display">\[ p(x|\mu,\sigma)=\mathcal{N}(x|\mu,\sigma)=\frac{1}{\sigma\sqrt{2\pi}}\exp(-\frac{(x-\mu)^2}{2\sigma^2})\]</span></p>
<h2 id="医学参考值">医学参考值</h2>
<p>医学参考值（reference value）是指包括约大多数正常人的人体形态、功能和代谢产物等各种生理及生化指标常数，也称正常值。由于存在个体差异，生物医学数据并非常数而是在一定范围内波动，帮采用学参考值范围（medical reference range）作为判定正常和异常的参考标准。 医学参考值范围涉及采用单侧界值还是双侧界值的问题，这通常是依据医学专业知识而定，例如课本（医学统计学，孙振球，第四版）中的例2-1的红细胞数无论过低或过高均属异常，就采用双侧参考值范围制定下侧和上侧界值；血清转氨酶仅过高异常，应采用单侧参考值范围制定上侧界值；肺活量仅过低异常，就采用单侧参考值范围制定下侧界值。医学上常用的参考值范围有90%，95%，99%等，其中95%最常用。</p>
<p>其中确定参考值的方法通常有两种，分别为正态分布法和百分位数法。</p>
<h3 id="正态分布法">正态分布法</h3>
<p>对于服从正态分布的医学数据，可采用正态分布法计算参考值的范围，其计和公式为： 双侧1-<span class="math inline">\(1-\alpha\)</span>参考值范围为：<span class="math inline">\(\bar{X}\pm\mu_{\alpha/2}S\)</span> 单侧1-<span class="math inline">\(\alpha\)</span>的参考值范围为：<span class="math inline">\(&gt;\bar{X}-\mu_{\alpha/2}S\)</span>。 其中<span class="math inline">\(bar{X}\)</span>为无数，S为标准差，<span class="math inline">\(\mu\)</span>值可以查表得到。</p>
<p>案例：现在我们计算课本[^１]例2-1的资料估计正常成年女子的红细胞数的95%的参考值范围。计算结果如下所示： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_201.csv&quot;) #导入数据</div><div class="line">extract_data &lt;- raw_data[,1] # 提取第一列数据</div><div class="line">sd1 &lt;- sd(extract_data)</div><div class="line">mean1 &lt;- mean(extract_data)</div><div class="line">mean1 - 1.96*sd1 # 参考值的下限</div><div class="line">mean1 + 1.96*sd1 # 参考值的上限</div></pre></td></tr></table></figure></p>
<p>因此参考值的范围为3.353299，5.104657。</p>
<h3 id="百分位数法">百分位数法</h3>
<p>偏态分布资料医学参考值范围的制定通常采用百分位数法，所要求的样本含量比正态分布法要多（不低于100），其计算公式为： 双侧<span class="math inline">\(1-\alpha\)</span>参透值范围为：<span class="math inline">\(P_{100\alpha/2}{\sim}P_{100-100\alpha/2}\)</span></p>
<p>单侧<span class="math inline">\(1-\alpha\)</span>参透值范围为：<span class="math inline">\(&gt;P_{100\alpha}\)</span>或<span class="math inline">\(&gt;P_{100-100\alpha}\)</span> 案例：课本无原始数据，此题略过。</p>
<h2 id="数据描述的练习">数据描述的练习</h2>
<h3 id="例题2-1的描述性统计">例题2-1的描述性统计</h3>
<p>（医学统计学.第四版.孙振球）</p>
<p>某医院用随机抽样方法检查了138名正常成年女子的红细胞数 ，其测量结果如下，试编制频数分布表。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- read.csv(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_201.csv"</span>) </div><div class="line"><span class="comment">#导入数据</span></div><div class="line"></div><div class="line">extract_data &lt;- raw_data[,<span class="number">1</span>] </div><div class="line"><span class="comment"># 提取第一列数据</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(reshape2)</div><div class="line">breaks&lt;-seq(from = <span class="number">3.07</span>, to = <span class="number">5.47</span>, by = <span class="number">0.2</span>) </div><div class="line"><span class="comment"># 产生各个组距</span></div><div class="line"></div><div class="line">data_table&lt;-cut(extract_data,breaks=breaks,right=<span class="literal">FALSE</span>) </div><div class="line"><span class="comment">#分组,right=FALSE表示左闭右开</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(reshape2) </div><div class="line"><span class="comment">#载入reshape2包，使用其中的melt函数</span></div><div class="line"></div><div class="line">melt(table(data_table)) </div><div class="line"><span class="comment">#查看频数分布</span></div><div class="line"></div><div class="line">middle_data&lt;-c() </div><div class="line"><span class="comment">#求组中值，组中值从表中可以看出来就是区间两边的数的平均数</span></div><div class="line"></div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> seq(<span class="number">1</span>,<span class="number">12</span>))&#123;</div><div class="line">  middle &lt;- (breaks[i]+breaks[i+<span class="number">1</span>])*<span class="number">0.5</span></div><div class="line">  middle_data&lt;-append(middle_data,middle)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># 绘图表</span></div><div class="line">hist(extract_data,breaks,</div><div class="line">     right=<span class="literal">FALSE</span>,main=<span class="string">""</span>,</div><div class="line">     xlab=<span class="string">""</span>,ylab=<span class="string">"频数"</span>,</div><div class="line">     axes=<span class="literal">FALSE</span>,</div><div class="line">     border=<span class="string">"grey"</span>,</div><div class="line">     col=<span class="string">"red"</span>,freq=<span class="literal">F</span>)</div><div class="line"><span class="comment">#data为数据集，breaks则是分组依据，right=FALSE则是左开右闭,xlab，ylab控制坐标</span></div><div class="line"></div><div class="line">lines(density(extract_data)) </div><div class="line"><span class="comment">#加入概率密度曲线</span></div><div class="line"></div><div class="line">title(xlab=<span class="string">"红细胞数(×10e-12/L)"</span>,line=<span class="number">0.8</span>)</div><div class="line"><span class="comment">#加x轴的标题，往下超过x轴垂直距离为0.8个行距</span></div><div class="line"></div><div class="line">text(<span class="number">4.5</span>,-<span class="number">2.8</span>,<span class="string">"-12"</span>,cex=<span class="number">0.5</span>)</div><div class="line">mtext(<span class="string">"138名正常成年女性红细胞数的频数分布"</span>,<span class="number">1</span>,line=<span class="number">2.5</span>,cex=<span class="number">1.2</span>,font=<span class="number">2</span>)</div><div class="line"><span class="comment">#加主标题,1表示为下方</span></div><div class="line"><span class="comment"># line=2.5表示超过x轴垂直距离为2.5个行距</span></div><div class="line"><span class="comment"># cex为字体扩大倍数</span></div><div class="line"><span class="comment"># font=2表示加粗</span></div><div class="line"></div><div class="line">abline(h=<span class="number">0</span>)</div><div class="line"><span class="comment">#绘制y=0的线段，用此线表示x轴</span></div><div class="line"></div><div class="line">axis(<span class="number">1</span>,at=middle_data,tick=<span class="literal">FALSE</span>,pos=<span class="number">0.03</span>)</div><div class="line"><span class="comment"># 绘制x轴，坐标为middle_data</span></div><div class="line"><span class="comment"># tick=FALSE表示坐标刻度不绘出,pos=1表示坐标轴在y=1处</span></div><div class="line"></div><div class="line">axis(<span class="number">2</span>)</div><div class="line"><span class="comment">#绘制y轴</span></div></pre></td></tr></table></figure>
<p>频数分布如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; melt(table(data_table)) <span class="comment">#查看频数分布</span></div><div class="line">    data_table value</div><div class="line"><span class="number">1</span>  [<span class="number">3.07</span>,<span class="number">3.27</span>)     <span class="number">2</span></div><div class="line"><span class="number">2</span>  [<span class="number">3.27</span>,<span class="number">3.47</span>)     <span class="number">3</span></div><div class="line"><span class="number">3</span>  [<span class="number">3.47</span>,<span class="number">3.67</span>)     <span class="number">9</span></div><div class="line"><span class="number">4</span>  [<span class="number">3.67</span>,<span class="number">3.87</span>)    <span class="number">14</span></div><div class="line"><span class="number">5</span>  [<span class="number">3.87</span>,<span class="number">4.07</span>)    <span class="number">22</span></div><div class="line"><span class="number">6</span>  [<span class="number">4.07</span>,<span class="number">4.27</span>)    <span class="number">30</span></div><div class="line"><span class="number">7</span>  [<span class="number">4.27</span>,<span class="number">4.47</span>)    <span class="number">21</span></div><div class="line"><span class="number">8</span>  [<span class="number">4.47</span>,<span class="number">4.67</span>)    <span class="number">15</span></div><div class="line"><span class="number">9</span>  [<span class="number">4.67</span>,<span class="number">4.87</span>)    <span class="number">10</span></div><div class="line"><span class="number">10</span> [<span class="number">4.87</span>,<span class="number">5.07</span>)     <span class="number">6</span></div><div class="line"><span class="number">11</span> [<span class="number">5.07</span>,<span class="number">5.27</span>)     <span class="number">4</span></div><div class="line"><span class="number">12</span> [<span class="number">5.27</span>,<span class="number">5.47</span>)     <span class="number">2</span></div></pre></td></tr></table></figure>
<p>图表如下所示</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101705.png">

</div>
<p>对例2-1，例2-2和例2-14已计算出某医院随机抽查的138名成年女子的红细胞数均数 ，标准差 。试估计该医院所抽查成年女子的红细胞数：①在4.0 以下者占成年女子总人数的百分比；②在4.00~5.00 之间者占成年女子总人数的百分比；③在5.00 以上者占成年女子总人数的百分比。 计算过程如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mean.data &lt;- mean(extract_data)</div><div class="line">sd.data &lt;- sd(extract_data)</div><div class="line">pnorm((4-mean.data)/sd.data) # 4.0以下的百分比</div><div class="line">pnorm((5-mean.data)/sd.data) #5.0以下的百分比</div><div class="line">1-pnorm((5-mean.data)/sd.data) #5.0以上的百分比</div><div class="line">pnorm((5-mean.data)/sd.data)-pnorm((4-mean.data)/sd.data) #在4.00~5.00 之间的百分比</div><div class="line"></div><div class="line">#或者是：</div><div class="line">pnorm(5,mean(data),sd(data))-pnorm(4,mean(data),sd(data))</div><div class="line"></div><div class="line"># 绘制数据集的正态分布图</div><div class="line">x &lt;- seq(min(extract_data)-0.52,max(extract_data)+0.52,length=1000)</div><div class="line">y &lt;- dnorm(x,mean(extract_data),sd(extract_data))</div><div class="line">r1 &lt;- 4</div><div class="line">r2 &lt;- 5</div><div class="line">x2 &lt;- c(r1,r1,x[x&lt;r2&amp;x&gt;r1],r2,r2)</div><div class="line">y2=c(0,dnorm(c(r1,x[x&lt;r2&amp;x&gt;r1],r2),mean(data),sd(data)),0)</div><div class="line">plot(x,y,type=&quot;l&quot;,xlab=&quot;&quot;,ylab=&quot;&quot;,lty=1)</div><div class="line">abline(0,0)</div><div class="line">polygon(x2,y2,col=&quot;grey&quot;)</div></pre></td></tr></table></figure></p>
<p><strong>结果如下所示：</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[1] 0.3041459</div><div class="line">&gt; pnorm((5-mean.data)/sd.data) #5.0以下的百分比</div><div class="line">[1] 0.9578038</div><div class="line">&gt; 1-pnorm((5-mean.data)/sd.data) #5.0以上的百分比</div><div class="line">[1] 0.04219616</div><div class="line">&gt; pnorm((5-mean.data)/sd.data)-pnorm((4-mean.data)/sd.data) #在4.00~5.00 之间的百分比</div><div class="line">[1] 0.653658</div><div class="line">&gt; pnorm(5,mean(data),sd(data))-pnorm(4,mean(data),sd(data))</div><div class="line">[1] 0.6532998</div><div class="line">结果与书中的不太一样，但结果接近，我估计是因为书中是查表，用的是近似值，R中的比较精确</div></pre></td></tr></table></figure></p>
<p>数据的正态分布图如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190303101726.png">

</div>
<h3 id="例2-4几何均数">例2-4：几何均数</h3>
<p>某地5例微丝蚴血症患者治疗7年后用间接荧光抗体试验没得某抗体满意度例数分别为10，20，40，40，160，求几何均数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data24&lt;-c(10,20,40,40,160)</div><div class="line">exp(mean(log(data24)))</div></pre></td></tr></table></figure>
<p>结果如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; data24</div><div class="line">[1]  10  20  40  40 160</div><div class="line">&gt; exp(mean(log(data24)))</div><div class="line">[1] 34.82202</div></pre></td></tr></table></figure></p>
<h3 id="例2-5-平均抗体滴度">例2-5 平均抗体滴度</h3>
<p>69例风湿关节炎(RA)患者血清EBV-VCA-IgG抗体满意度的分布，求其平均抗体滴度。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data25&lt;-c(<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,</div><div class="line"><span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">10</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,</div><div class="line"><span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">1280</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">1280</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,</div><div class="line"><span class="number">320</span>,<span class="number">640</span>,<span class="number">40</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">40</span>,<span class="number">80</span>,<span class="number">80</span>,<span class="number">160</span>,<span class="number">320</span>,<span class="number">640</span>,<span class="number">640</span>)</div><div class="line">x &lt;- table(data25)</div><div class="line">x &lt;- data.frame(x)</div><div class="line">x$countdown &lt;- as.numeric(levels(x$data25))</div><div class="line">x$lgX &lt;- round(log10(x$countdown),<span class="number">4</span>)</div><div class="line">x$flgX &lt;- round(x$Freq*x$lgX,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line">  data25 Freq countdown    lgX    flgX</div><div class="line"><span class="number">1</span>     <span class="number">10</span>    <span class="number">4</span>        <span class="number">10</span> <span class="number">1.0000</span>  <span class="number">4.0000</span></div><div class="line"><span class="number">2</span>     <span class="number">20</span>    <span class="number">3</span>        <span class="number">20</span> <span class="number">1.3010</span>  <span class="number">3.9030</span></div><div class="line"><span class="number">3</span>     <span class="number">40</span>   <span class="number">10</span>        <span class="number">40</span> <span class="number">1.6021</span> <span class="number">16.0210</span></div><div class="line"><span class="number">4</span>     <span class="number">80</span>   <span class="number">10</span>        <span class="number">80</span> <span class="number">1.9031</span> <span class="number">19.0310</span></div><div class="line"><span class="number">5</span>    <span class="number">160</span>   <span class="number">11</span>       <span class="number">160</span> <span class="number">2.2041</span> <span class="number">24.2451</span></div><div class="line"><span class="number">6</span>    <span class="number">320</span>   <span class="number">15</span>       <span class="number">320</span> <span class="number">2.5051</span> <span class="number">37.5765</span></div><div class="line"><span class="number">7</span>    <span class="number">640</span>   <span class="number">14</span>       <span class="number">640</span> <span class="number">2.8062</span> <span class="number">39.2868</span></div><div class="line"><span class="number">8</span>   <span class="number">1280</span>    <span class="number">2</span>      <span class="number">1280</span> <span class="number">3.1072</span>  <span class="number">6.2144</span></div><div class="line"></div><div class="line">上述结果是书中的频数表，与R的计算关系不大，在R中可以直接计算，如下</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; exp(mean(log(data25)))</div><div class="line">[1] 150.6411</div></pre></td></tr></table></figure>
<h3 id="例2-6-中位数">例2-6 中位数</h3>
<p>7名病人患某病的潜伏期分别为2，3，4，5，6，9，16天，求其中位数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; data26&lt;-c(2,3,4,5,6,9,16)</div><div class="line">&gt; median(data26)</div><div class="line">[1] 5</div></pre></td></tr></table></figure>
<h3 id="例2-11均数和极差">例2-11：均数和极差</h3>
<p>试计算下面三组同龄男孩的身高 均数和极差。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">range.f &lt;- function (x) (max(x)-min(x))</div><div class="line">甲组 &lt;- c(90,95,100,105,110)</div><div class="line">乙组 &lt;- c(96,98,100,102,104)</div><div class="line">丙组 &lt;- c(96,99,100,101,104)</div><div class="line">range.f(甲组)</div><div class="line">mean(甲组)</div><div class="line">range.f(乙组)</div><div class="line">mean(乙组)</div><div class="line">range.f(丙组)</div><div class="line">mean(丙组)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; range.f(甲组)</div><div class="line">[<span class="number">1</span>] <span class="number">20</span></div><div class="line">&gt; mean(甲组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line">&gt; range.f(乙组)</div><div class="line">[<span class="number">1</span>] <span class="number">8</span></div><div class="line">&gt; mean(乙组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line">&gt; range.f(丙组)</div><div class="line">[<span class="number">1</span>] <span class="number">8</span></div><div class="line">&gt; mean(丙组)</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>医学统计学.第四版.孙振球</li>
<li>小白统计.冯国双</li>
<li><a href="https://www.zhihu.com/question/20099757?rf=21126585" target="_blank" rel="external">为什么样本方差（sample variance）的分母是 n-1？</a></li>
<li>统计思维：程序员数学之概率统计.作者: Allen B.Downey，译者: 张建锋 / 陈钢 出版社: 人民邮电出版社</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">177</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">54</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>

<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:30px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共663.8k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
