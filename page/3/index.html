<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/3/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/3/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/07/Experiment/HIPC介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/07/Experiment/HIPC介绍/" itemprop="url">HIPC介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-07T12:00:00+08:00">
                2019-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物实验笔记/" itemprop="url" rel="index">
                    <span itemprop="name">生物实验笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  803
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>最近在看GSEA有关的内容，GSEA官网里涉及到一个基因集，即<code>C7 collection: Immunologic signatures</code>，这是一个与免疫相关的基因集，根据官网的介绍，这个基因集是由BROAD实验室与丹娜法伯癌症研究院（Dana-Farber Cancer Institute）的Haining Lab和人类免疫学项目联合合会(HIPC)合作的一部分，当时还发了一篇Immunity，文献信息如下：</p>
<p>Godec J, Tan Y, Liberzon A, Tamayo P, Bhattacharya S, Butte A, Mesirov JP, Haining WN, Compendium of Immune Signatures Identifies Conserved and Species-Specific Biology in Response to Inflammation, 2016, Immunity 44(1), 194-206.</p>
<p>以下内容是HIPC官网的一些资料。</p>
<h2 id="hipc简介">HIPC简介</h2>
<p>HIPC英文全称是Human Immunology Project Consortium，即人类免疫学项目研究联合会，成立于2010年，后又于2015年重组，即由原来的NIAID的过敏所（注：NIAID的全称为National Institute of Allergy and Infectious Diseases，即<strong>国家过敏与感染性疾病研究院</strong>），免疫所和移植所进行合并，统一作为NIAID的构成部分，集中研究人类免疫学。</p>
<p>注：上面一段话是我按原文翻译后理解的，不一定准确，为了避免歧义我，这里贴出原文：</p>
<blockquote>
<p>The Human Immunology Project Consortium (HIPC) program was established in 2010, and renewed in 2015, by the NIAID Division of Allergy, Immunology, and Transplantation as part of the overall NIAID focus on human immunology.</p>
</blockquote>
<p>通过HIPC计划，研究者们使用各种现代分析工具分析人类多个免疫学方面的数据，其中包括多重转录(multiplex transcriptional)，细胞因子，蛋白质谱；白细胞亚型的多参数表型(multiparameter phenotyping of leukocyte subsets)；评估白细胞功能状态以及开发多种算法。</p>
<p>HIPC项目旨在建立一个集中的研究中心，以及一个广泛的，中心化的数据库，从而让更多的研究者们使用。HIPC项目产生的信息将会有助于研究者们广泛地理解人类免疫系统方方面面，包括免疫系统的调控，发现免疫系统组分与其它生物系统的新型关系，从而确定新的免疫介质与通路，以及构建不同种群疫苗案安全性的预测因子，从而确保对不同疫苗配方的快速评估，确立接种方案等。该知识库还将会构建起免疫系统介导的人类疾病的研究基础，这些人类免疫性疾病包括过敏，哮喘，移植排斥和自身免疫性疾病以及各种炎症性疾病。</p>
<h2 id="hipc的任务">HIPC的任务</h2>
<h3 id="目标">目标</h3>
<ol style="list-style-type: decimal">
<li>定义稳定和活化的人类免疫系统的表达谱/标签/足迹(Define profiles/signatures/fingerprints of steady-state and activated human immune system)</li>
<li>创建一个中心化的知识库或资源：</li>
</ol>
<ul>
<li>有利于研究人类免疫系统；</li>
<li>针对人类疾病开发新的疗法。</li>
</ul>
<h3 id="研究">研究</h3>
<ol style="list-style-type: decimal">
<li>感染导致的稳态异常(Perturbations of the steady-state by infection)；</li>
<li>疫苗；</li>
<li>佐剂研究(Adjuvant administration )</li>
</ol>
<h3 id="方法">方法</h3>
<ol style="list-style-type: decimal">
<li>定义人类转录组/蛋白质谱；</li>
<li>多重分析(multiplex assays)；</li>
<li>多参数表型，系统生物学；</li>
<li>质谱。</li>
</ol>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>https://www.immuneprofiling.org/hipc/page/showPage?pg=sci-about</li>
<li>http://software.broadinstitute.org/gsea/msigdb/collection_details.jsp#C7</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/07/Genomics Data Analysis Series/GDAS007-管理与处理大量BED文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/07/Genomics Data Analysis Series/GDAS007-管理与处理大量BED文件/" itemprop="url">GDAS007-管理与处理大量BED文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-07T12:00:00+08:00">
                2019-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,782
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言">前言</h1>
<p>我们已经通过<code>ExpressionSet</code>类和<code>BamFileList</code>文件（含有BAM比对后的文件）来了解了一些关于数据管理的基本知识。</p>
<ul>
<li>S4类有助于控制某个数据结构中不同组件之间的复杂程度和一致性。</li>
<li>R包能够进一步用于协调和发布数据、软件程度和文档。在这个课程的后面部分里我们会学习如何构建R包。</li>
</ul>
<p>在这个一部分的结尾处，我们来解决一个明显没有最佳解决方案的问题。我们考虑打包GRanges的序列化后的实例以及已经建立了索引的压缩文本文件，这些文件都可以使用GenomicFiles进行并行计算处理。</p>
<p>为什么这是一个比较难解决的问题呢？因为在某些情况下，含有大量功能的GRanges实例将会非常大，加载它们可能会花费大量的时间，并且会占用大量的内存。这可能导致在RAM有限时，在群集节点上使用这些表示方法出现困难。如果数据以允许随机访问的索引格式保存在磁盘上，则根据需要将文件内容的目标提取，并转换为GRanges，就可能为某些应用程度带来更好的性能。创建<code>erma</code>包的一个原因就是获取关于这些不同方法之间平衡后的数据。</p>
<h1 id="erma表观遗传路线图简介">erma：表观遗传路线图简介</h1>
<p>为了促进对DNA突变体的理解，我们对细胞类型之间的表观基因组变异有所兴趣。NIH表观基因组路线图收集了很多关于ChIP-seq实验分析的数据，在这个公众数据库里记录了数百个不同细胞类型和标志特异性文件供其他研究者使用。</p>
<p>管理这类数据的有效方法是什么呢？其中<a href="http://www.bioconductor.org/packages/erma" target="_blank" rel="external">erma</a> 包就提供了这样一种方法。</p>
<h2 id="bed文件集合">BED文件集合</h2>
<p>如同Ernst和Kellis使用大量细胞系的数据所报道的那样，他们已经进行了染色质状态的统计“估算”，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(erma)</div><div class="line">ef = dir(system.file(<span class="string">"bed_tabix"</span>, package=<span class="string">"erma"</span>), patt=<span class="string">"bed.gz$"</span>)</div><div class="line">length(ef)</div><div class="line"><span class="comment">## [1] 31</span></div><div class="line">head(ef)</div><div class="line"><span class="comment">## [1] "E002_25_imputed12marks_mnemonics.bed.gz"</span></div><div class="line"><span class="comment">## [2] "E003_25_imputed12marks_mnemonics.bed.gz"</span></div><div class="line"><span class="comment">## [3] "E021_25_imputed12marks_mnemonics.bed.gz"</span></div><div class="line"><span class="comment">## [4] "E032_25_imputed12marks_mnemonics.bed.gz"</span></div><div class="line"><span class="comment">## [5] "E033_25_imputed12marks_mnemonics.bed.gz"</span></div><div class="line"><span class="comment">## [6] "E034_25_imputed12marks_mnemonics.bed.gz"</span></div></pre></td></tr></table></figure>
<h2 id="使用genomicfiles进行管理">使用GenomicFiles进行管理</h2>
<p>我们认为文件名是不变的，但是储存BED文件路径的向量则可以被命名得更详细。通过<code>makeErmaSet</code>函数可以获取元数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">mm = makeErmaSet()</div><div class="line"><span class="comment">## <span class="doctag">NOTE:</span> input data had non-ASCII characters replaced by ' '.</span></div><div class="line">mm</div><div class="line"><span class="comment">## ErmaSet object with 0 ranges and 31 files: </span></div><div class="line"><span class="comment">## files: E002_25_imputed12marks_mnemonics.bed.gz, E003_25_imputed12marks_mnemonics.bed.gz, ..., E088_25_imputed12marks_mnemonics.bed.gz, E096_25_imputed12marks_mnemonics.bed.gz </span></div><div class="line"><span class="comment">## detail: use files(), rowRanges(), colData(), ...</span></div><div class="line">head(colData(mm))</div><div class="line"><span class="comment">## (showing narrow slice of  6 x 95  DataFrame)   narrDF with 6 rows and 6 columns</span></div><div class="line"><span class="comment">##      Epigenome.ID..EID.          GROUP Epigenome.Mnemonic     ANATOMY</span></div><div class="line"><span class="comment">##             &lt;character&gt;    &lt;character&gt;        &lt;character&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">## E002               E002            ESC            ESC.WA7         ESC</span></div><div class="line"><span class="comment">## E003               E003            ESC             ESC.H1         ESC</span></div><div class="line"><span class="comment">## E021               E021           iPSC        IPSC.DF.6.9        IPSC</span></div><div class="line"><span class="comment">## E032               E032   HSC &amp; B-cell       BLD.CD19.PPC       BLOOD</span></div><div class="line"><span class="comment">## E033               E033 Blood &amp; T-cell        BLD.CD3.CPC       BLOOD</span></div><div class="line"><span class="comment">## E034               E034 Blood &amp; T-cell        BLD.CD3.PPC       BLOOD</span></div><div class="line"><span class="comment">##                TYPE         SEX</span></div><div class="line"><span class="comment">##         &lt;character&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">## E002 PrimaryCulture      Female</span></div><div class="line"><span class="comment">## E003 PrimaryCulture        Male</span></div><div class="line"><span class="comment">## E021 PrimaryCulture        Male</span></div><div class="line"><span class="comment">## E032    PrimaryCell        Male</span></div><div class="line"><span class="comment">## E033    PrimaryCell     Unknown</span></div><div class="line"><span class="comment">## E034    PrimaryCell        Male</span></div><div class="line"><span class="comment">## use colnames() for full set of metadata attributes.</span></div><div class="line">names(files(mm)) = colData(mm)$Epigenome.Mnemonic</div><div class="line">head(files(mm))</div><div class="line"><span class="comment">##                                                                                                                 ESC.WA7 </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E002_25_imputed12marks_mnemonics.bed.gz" </span></div><div class="line"><span class="comment">##                                                                                                                  ESC.H1 </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E003_25_imputed12marks_mnemonics.bed.gz" </span></div><div class="line"><span class="comment">##                                                                                                             IPSC.DF.6.9 </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E021_25_imputed12marks_mnemonics.bed.gz" </span></div><div class="line"><span class="comment">##                                                                                                            BLD.CD19.PPC </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E032_25_imputed12marks_mnemonics.bed.gz" </span></div><div class="line"><span class="comment">##                                                                                                             BLD.CD3.CPC </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E033_25_imputed12marks_mnemonics.bed.gz" </span></div><div class="line"><span class="comment">##                                                                                                             BLD.CD3.PPC </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/erma/bed_tabix/E034_25_imputed12marks_mnemonics.bed.gz"</span></div></pre></td></tr></table></figure>
<h1 id="使用表格描述染色质状态信息">使用表格描述染色质状态信息</h1>
<h2 id="定义染色体状态与标记概述">定义染色体状态与标记概述</h2>
<p>下表显示了不同类型的染色质标记是如何组合并用于判断染色体质片段的状态的。那些缩写的意义为：活跃TSS(TssA)，两种类型的上下流启动子(PromU, PromD1, PromD2)，转录为5’或3‘优先或略强或弱(Tx5’, Tx3’, Tx, TxWk)，联合转录或调控(TxReg)，优先转录，增强子活性和可能弱(TxEnh5‘，TxEnh3‘，TxEnhW)，两种类型的活跃增强子，可能是侧翼或弱的(EnhA1，EnhA2，EnhAF，EnhW1，EnhW2)或由H3K27ac(EnhAc)，初级DNase(DNase)，ZNF基因和重复序列(ZNF/rpts)，异染色质(Het)，二价或平衡型启动子(Propp，PromBiv)，抑制多梳(ReprPC)或静默(Quies)。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(png)</div><div class="line">im = readPNG(system.file(<span class="string">"pngs/emparms.png"</span>, package=<span class="string">"erma"</span>))</div><div class="line">grid.raster(im)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_multibed-lkxy-1.png" alt="plot of chunk lkxy">
<p class="caption">plot of chunk lkxy</p>
</div>
<p><code>erma</code>包中含有的文件包括31个不同细胞系和基因组的信息（原文里面是tilings，这个我的理解就是表示了一些信息），并根据上面显示了状态图将这些信息分配给染色体状态。</p>
<p>下面展示了两个基因BRCA2和Eome启动子区域的状态标记，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">stateProfile(mm, <span class="string">"BRCA2"</span>)</div><div class="line"><span class="comment">## 'select()' returned 1:many mapping between keys and columns</span></div><div class="line"><span class="comment">## Warning: executing %dopar% sequentially: no parallel backend registered</span></div><div class="line"><span class="comment">## Scale for 'y' is already present. Adding another scale for 'y', which</span></div><div class="line"><span class="comment">## will replace the existing scale.</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_multibed-lkbr-1.png" alt="plot of chunk lkbr">
<p class="caption">plot of chunk lkbr</p>
</div>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">stateProfile(mm, <span class="string">"EOMES"</span>)</div><div class="line"><span class="comment">## 'select()' returned 1:many mapping between keys and columns</span></div><div class="line"><span class="comment">## Scale for 'y' is already present. Adding another scale for 'y', which</span></div><div class="line"><span class="comment">## will replace the existing scale.</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_multibed-lkbr2-1.png" alt="plot of chunk lkbr2">
<p class="caption">plot of chunk lkbr2</p>
</div>
<p>有两个基因在启动子区域的状态与常规的状态不同，以及与细胞类型的一致性方面也不同。</p>
<h2 id="并行目标查询">并行目标查询</h2>
<p>虽然可视化很直观，但是我们也希望能够进行文本编辑，从而提取一些信息供下游使用。在这里我们简单地将每个细胞类型的状态制成表格。使用<code>readuceByFile</code>函数就能将文件分配给可用的内核或主机进行并行处理，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">gm = promoters(range(genemodel(<span class="string">"BRCA2"</span>))) <span class="comment"># 2000 upstream, 200 down by default</span></div><div class="line"><span class="keyword">library</span>(BiocParallel)</div><div class="line">register(MulticoreParam(workers=<span class="number">2</span>))</div><div class="line"><span class="keyword">library</span>(GenomicFiles)</div><div class="line">ans = reduceByFile( gm, files(mm), MAP=<span class="keyword">function</span>(range,file) &#123;</div><div class="line">   table( import(file, genome=<span class="string">"hg19"</span>, which=range)$name ) &#125; )</div><div class="line">ans= unlist(ans, recursive=<span class="literal">FALSE</span>)</div><div class="line">names(ans) = colData(mm)$Epigenome.Mnemonic</div><div class="line">ans[<span class="number">1</span>:<span class="number">4</span>]</div><div class="line"><span class="comment">## $$ESC.WA7</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   1_TssA 16_EnhW1  2_PromU 25_Quies </span></div><div class="line"><span class="comment">##        1        1        1        1 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$ESC.H1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   1_TssA 16_EnhW1 19_DNase  2_PromU 25_Quies 3_PromD1 </span></div><div class="line"><span class="comment">##        1        1        1        1        1        1 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$IPSC.DF.6.9</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   1_TssA 16_EnhW1 19_DNase  2_PromU 25_Quies </span></div><div class="line"><span class="comment">##        1        1        1        1        1 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$BLD.CD19.PPC</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   1_TssA 16_EnhW1 19_DNase  2_PromU 25_Quies 3_PromD1 </span></div><div class="line"><span class="comment">##        1        1        1        1        1        1</span></div></pre></td></tr></table></figure>
<p>因此，我们看到，在某个特定的基因的启动子区域的基因序列方面，不同的细胞类型存在着数量和状态类型的变化。在后面的练习中，我们将会考虑如何以这种方式开发其它潜在感兴趣的信息。</p>
<h1 id="总结">总结</h1>
<p>在这一部分中我们看到：</p>
<ul>
<li>在磁盘中，使用了大量添加了索引的文本来表示基因组注释或实验结果（原文是：“leave on disk” large numbers of indexed textual representations of genomic annotation or experimental result）；</li>
<li>使用R包的方式来简化标记这些数据；</li>
<li>使用<code>GenomicFiles</code>来管理有关文件的元数据；</li>
<li>使用<code>reduceByFile</code>来并行处理文件内容。</li>
</ul>
<p>这些技术避免了创建，加载大量的R对象，从而提供了某种程度的便捷性。在内存资源有限的情况下，对于那些需要大量集群(clusters)的应用来说，这种策略就显得性价比较高。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/bioc1_multibed.html" target="_blank" rel="external">Managing and processing large numbers of BED files</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/06/Genomics Data Analysis Series/GDAS016-shiny的交互式操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/06/Genomics Data Analysis Series/GDAS016-shiny的交互式操作/" itemprop="url">GDAS010-Bioconductor中的基因组注释</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-06T12:00:00+08:00">
                2019-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,834
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="interaction-beyond-the-read-eval-print-loop">Interaction beyond the “read-eval-print” loop</h2>
<p>在R语言中，除了使用命令行模式来分析数据外，还可以使用图形用户界面(GUI)来分析数据，Rstudio中有一个shiny包，它可以创建GUI。</p>
<h2 id="dfhclust函数"><code>dfHclust</code>函数</h2>
<h3 id="主要布局">主要布局</h3>
<p><code>ph525x</code>包中含有<code>dfHclust</code> 函数，我们使用这个函数来展示一个数据，这个数据是数据框类型，，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ph525x)</div><div class="line">dfHclust(mtcars)</div></pre></td></tr></table></figure>
<p>注：由于<code>ph525x</code> 这个包有点老了，可以直接去官网找到这个包中函数<code>dfHclust()</code>的<a href="https://raw.githubusercontent.com/genomicsclass/ph525x/master/R/dfHclustTab.R" target="_blank" rel="external">源代码</a>来运行上述命令，运行结果如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191119213818.png">

</div>
<p>左侧是侧边栏，里面有这些内容：</p>
<ul>
<li><code>distance</code> ：用于聚类的距离类型；</li>
<li><code>clustering method</code> ：用于聚类的方法；to form the hierarchy through object agglomeration</li>
<li><code>height</code> ：用于聚类的系统树的切割高度，将其分为几组；</li>
<li>最下面是参与计算距离的一些特征值（变量）。</li>
</ul>
<p>在这个案例中，我们所研究的对象是不同制造商和型号的汽车；特征值是这些汽车的结构或操作特性。我们注意一下，我们在启动这个交互页面时，我们的默认选项如下所示：</p>
<ul>
<li>euclidean距离</li>
<li>聚类算法是ward.D</li>
<li>在40处进行切割</li>
<li>前两个变量作为特征值</li>
</ul>
<p>右侧图形包括了几个选项卡，如下所示：</p>
<ul>
<li>聚类树；</li>
<li>两两配对的散点图（就是在<code>pairs</code>这个选项卡上），如下所示：</li>
</ul>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191119224654.png">

</div>
<ul>
<li>用于评估所选的切割高度下聚类质量的轮廓图，如下所示：</li>
</ul>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191119224802.png">

</div>
<p>为了充分理解聚类中<code>tree</code>和<code>silh</code>选项卡中所显示的数量，用户应该查看距离(distance)、聚类方法(clustering method)和轮廓(silhouette)的具体参数，直接你能简洁明了地向非统计人员解释这些内容，具体参数含义如下：</p>
<p>要完全理解“tree”和“silh”选项卡中显示的数量，您应该查看距离、聚类方法和轮廓的定义，直到您愿意向非统计人员解释这些内容。</p>
<ul>
<li>距离(Distance)是多元分析中非常重要的一个参数；<br>
</li>
<li>聚类程序(Hierarchical clustering procedures)有点复杂；具体的可能参考Wiki百科中的 <a href="https://en.wikipedia.org/wiki/Ward&#39;s_method" target="_blank" rel="external">definition of Ward’s method</a> ，或者我以前的笔记。</li>
<li>轮廓(Silhouett)的定义可以查看<code>cluster</code>包中的 <code>silhouette</code> 文档。</li>
</ul>
<h3 id="与显示界面交互">与显示界面交互</h3>
<p>需要注意的是，当选择<code>tree</code>选项卡时，默认情况下，页面展示的一个具有三个主干的树，而<code>silh</code>选项卡则展示了聚类成员的在每个主干树中的检测值（这个值是怎么算的，先不用管），这三个值是通过设计cut的值来将树切为三个主干分别进行计算的，通过<code>silh</code>选项卡，我们知道以下内容：</p>
<ul>
<li>平均silhouette的宽度是0.56；</li>
<li>如果改动<code>Select height for cut</code>，将其改为70，那么silhouette图也会改变，它的平均值就会变为0.59，这个值变大的，并且我们看到，在<code>silh</code>页面，我们只能看到两个聚类结果的计算值，并且还有一个silhouette是负值；</li>
<li>我们还可以改变距离(distance)参数，聚类方法等，这些参数都能改变聚类树的形状。</li>
</ul>
<h2 id="a-view-of-the-code">A view of the code</h2>
<p>在这一小节中，我们将看一下 <code>dfHclust</code> 函数的源代码，并且解释一下其中的元素。这些代码是以一种非常简洁直白的方式书写的，但它有三个优点：</p>
<ul>
<li>代码相对较短，并且能独立运行；</li>
<li>在交互式数据探索中能运行良好，并发挥相应作用；</li>
<li>通过复制和修改可以轻松扩展。</li>
</ul>
<p>但是也有一些地方需要改进：</p>
<ul>
<li>在<code>ui</code>组件中处理全局变量；</li>
<li>data.frame重复过多，<code>server</code>组件中构建的子集data.frame过多。</li>
</ul>
<h3 id="开始">开始</h3>
<p>我们有一个简单的固定接口，如果函数参数中没有2个以上的data.frame，那么就会抛出错误。如果没有安装相应的包，那么也会抛出错误，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dfHclust = <span class="keyword">function</span>(df) &#123;</div><div class="line"><span class="comment"># validate input</span></div><div class="line">   stopifnot(inherits(df, <span class="string">"data.frame"</span>))</div><div class="line">   stopifnot(ncol(df)&gt;<span class="number">1</span>)</div><div class="line"><span class="comment"># obtain software</span></div><div class="line">   <span class="keyword">require</span>(shiny)</div><div class="line">   <span class="keyword">require</span>(cluster)</div></pre></td></tr></table></figure>
<h3 id="用于填写参数的一些向量">用于填写参数的一些向量</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># global variables ... </span></div><div class="line">   nms = names(df)</div><div class="line">   cmeths = c(<span class="string">"ward.D"</span>, <span class="string">"ward.D2"</span>,</div><div class="line">             <span class="string">"single"</span>, <span class="string">"complete"</span>, <span class="string">"average"</span>, <span class="string">"mcquitty"</span>,</div><div class="line">             <span class="string">"median"</span>, <span class="string">"centroid"</span>)</div><div class="line">   dmeths = c(<span class="string">"euclidean"</span>, <span class="string">"maximum"</span>, <span class="string">"manhattan"</span>, <span class="string">"canberra"</span>,</div><div class="line">             <span class="string">"binary"</span>)</div></pre></td></tr></table></figure>
<h3 id="用户界面的布局">用户界面的布局</h3>
<p>还有几个高级选项用于控制浏览器的界面。现在我们将使用一种名为<code>fluidPage</code>；也可以参考<code>shinydashboard</code> 包，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># main shiny components: ui and server</span></div><div class="line"><span class="comment">#   ui: defines page layout and components</span></div><div class="line"><span class="comment">#   server: defines operations</span></div><div class="line"><span class="comment">#</span></div><div class="line">   ui &lt;- fluidPage(</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># we will have four components on sidebar: selectors for </span></div><div class="line"><span class="comment"># distance, agglomeration method, height for tree cut, and variables to use</span></div></pre></td></tr></table></figure>
<h4 id="标题和侧边栏">标题和侧边栏</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line">     titlePanel(paste(substitute(df), <span class="string">"hclust"</span>)),</div><div class="line">     sidebarPanel(</div><div class="line">          helpText(paste(<span class="string">"Select distance:"</span> )),</div><div class="line">          fluidRow(</div><div class="line">             selectInput(<span class="string">"dmeth"</span>, <span class="literal">NULL</span>, choices=dmeths,</div><div class="line">               selected=dmeths[<span class="number">1</span>])),</div><div class="line">          helpText(paste(<span class="string">"Select clustering method:"</span> )),</div><div class="line">          fluidRow(</div><div class="line">             selectInput(<span class="string">"meth"</span>, <span class="literal">NULL</span>, choices=cmeths,</div><div class="line">               selected=cmeths[<span class="number">1</span>])),</div><div class="line">          helpText(paste(<span class="string">"Select height for cut:"</span> )),</div><div class="line">          fluidRow(</div><div class="line">             numericInput(<span class="string">"cutval"</span>, <span class="literal">NULL</span>, value=<span class="number">40</span>, min=<span class="number">0</span>, max=<span class="literal">Inf</span>, step=<span class="number">1</span>)),</div><div class="line">          helpText(paste(<span class="string">"Select variables for clustering from"</span>, substitute(df), <span class="string">":"</span> )),</div><div class="line">          fluidRow(</div><div class="line">             checkboxGroupInput(<span class="string">"vars"</span>, <span class="literal">NULL</span>, choices=nms,</div><div class="line">               selected=nms[<span class="number">1</span>:<span class="number">2</span>]))</div><div class="line">            ),</div></pre></td></tr></table></figure>
<h4 id="显示的主要选项卡">显示的主要选项卡</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># main panel is a simple plot</span></div><div class="line"><span class="comment">#</span></div><div class="line">     mainPanel(</div><div class="line">       tabsetPanel(</div><div class="line">        tabPanel(<span class="string">"tree"</span>, </div><div class="line">         plotOutput(<span class="string">"plot1"</span>)),</div><div class="line">        tabPanel(<span class="string">"pairs"</span>, </div><div class="line">         plotOutput(<span class="string">"pairsplot"</span>)),</div><div class="line">        tabPanel(<span class="string">"silh"</span>, </div><div class="line">         plotOutput(<span class="string">"silplot"</span>))</div><div class="line">         )</div><div class="line">       )</div><div class="line">  )  <span class="comment"># end fluidPage</span></div></pre></td></tr></table></figure>
<h3 id="定义服务器">定义服务器</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># a function with up to three arguments (input, output, session)</span></div><div class="line"><span class="comment"># can be used to define the server component of the app</span></div><div class="line"><span class="comment"># renderPlot makes it reactive, so when input components are altered,</span></div><div class="line"><span class="comment"># data frame in use and plot are updated</span></div><div class="line"><span class="comment">#</span></div><div class="line">   server &lt;- <span class="keyword">function</span>(input, output) &#123;</div><div class="line">     output$plot1 &lt;- renderPlot(&#123;</div><div class="line">       xv = df[,input$vars]</div><div class="line">       plot(hclust(dist(data.matrix(xv),method=input$dmeth), method=input$meth),</div><div class="line">         xlab=paste(input$dmeth, <span class="string">"distance;"</span>, input$meth, <span class="string">"clustering"</span>))</div><div class="line">       abline(h=input$cutval, lty=<span class="number">2</span>, col=<span class="string">"gray"</span>)</div><div class="line">     &#125;)</div><div class="line">     output$pairsplot &lt;- renderPlot(&#123;</div><div class="line">       xv = df[,input$vars]</div><div class="line">       pairs(data.matrix(xv))</div><div class="line">     &#125;)</div><div class="line">     output$silplot &lt;- renderPlot(&#123;</div><div class="line">       xv = df[,input$vars]</div><div class="line">       dm = dist(data.matrix(xv),method=input$dmeth)</div><div class="line">       hc = hclust(dist(data.matrix(xv),method=input$dmeth), method=input$meth)</div><div class="line">       ct = cutree(hc, h=input$cutval)</div><div class="line">       plot(silhouette(ct, dm))</div><div class="line">     &#125;)</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   shinyApp(ui, server)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="一些重要细节">一些重要细节</h2>
<p>一个shiny app含有两个主要组件，一个是用户界面，一个是服务器函数。为了使用这个UI界面，R中必须要加载<code>shiny</code>包。我们可以通过各种方式来使用户界面；我们使用的是<code>shinyApp</code>并且支持两个参数<code>ui</code>与<code>server</code>。如下所示：</p>
<ul>
<li><p><code>ui</code> 是 <code>shiny.tag.list</code>的一个实例。你可以通过检查<code>fluidPage()</code>的结果来感受一下这个实例。</p></li>
<li></li>
<li><p><code>server</code> 是一个函数，它有三个参数，分别为 <code>input</code>, <code>output</code> and <code>session</code>；最后一个参数是可选的。<code>input</code>是一个列表，它与<code>ui</code> 中给定的值绑定，<code>ouput</code> 会将服务器中的元素填充到UI中（这段话不太理解，原文如下）：</p></li>
</ul>
<blockquote>
<p><code>server</code> is a function of three arguments <code>input</code>, <code>output</code> and <code>session</code>; the latter is optional. <code>input</code> is a list with bindings given values in the <code>ui</code> component, and <code>output</code> will be populated with elements in the server for rendering in the UI.</p>
</blockquote>
<h3 id="fluidpage的一个案例">fluidPage的一个案例</h3>
<p>使用以下代码就可以查看shiny是如何运行的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(shiny)</div><div class="line">fluidPage(</div><div class="line">  titlePanel(<span class="string">"a title"</span>),</div><div class="line">  sidebarPanel(</div><div class="line">    selectInput(<span class="string">"seli1"</span>, <span class="string">"some letters"</span>, letters[<span class="number">1</span>:<span class="number">4</span>])</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>设置<code>sink(file=&quot;dem.html&quot;)</code>参数，并再次运行上述代码。然后就出现<code>sink(NULL); browseURL(&quot;dem.html&quot;)</code>。R将启动浏览器并显示出一个非常简洁的页面。这个页面中会出现含有a,…d的选择控件。</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191120093855.png">

</div>
<p>这个特殊的案例很容易用手写代码，但是<code>selectInput</code>函数可以允许你开发具有任何R向量定义的选择的控件。此外，高级R函数还可以允许输入不同的类型，用鼠标还可以驱动这些事件。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/bioc2_shiny.html" target="_blank" rel="external">shiny for interactive visualization of multivariate data</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/06/Genomics Data Analysis Series/GDAS006-深入理解SummarizedExperiment类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/06/Genomics Data Analysis Series/GDAS006-深入理解SummarizedExperiment类/" itemprop="url">GDAS006-深入理解SummarizedExperiment类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-06T12:00:00+08:00">
                2019-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,289
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言">前言</h1>
<p>在数据管理部分，我们应用<code>summarizeOverlaps</code> 来管理<code>RNAseqData.HNRNPC.bam.chr14</code>中的BAM文件。现在我们再次来操作一下。</p>
<h2 id="使用summarizedexperiment来管理bam文件">使用SummarizedExperiment来管理BAM文件</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RNAseqData.HNRNPC.bam.chr14)</div><div class="line">bfp = RNAseqData.HNRNPC.bam.chr14_BAMFILES</div><div class="line"><span class="keyword">library</span>(Rsamtools)</div><div class="line">bfl = BamFileList(file=bfp)</div><div class="line">hnrnpcLoc = GRanges(<span class="string">"chr14"</span>, IRanges(<span class="number">21677296</span>, <span class="number">21737638</span>))</div><div class="line"><span class="keyword">library</span>(GenomicAlignments)</div><div class="line"><span class="keyword">library</span>(BiocParallel)</div><div class="line">register(SerialParam())</div><div class="line">hnse = summarizeOverlaps(hnrnpcLoc,bfl)</div><div class="line">hnse</div><div class="line"><span class="comment">## class: RangedSummarizedExperiment </span></div><div class="line"><span class="comment">## dim: 1 8 </span></div><div class="line"><span class="comment">## metadata(0):</span></div><div class="line"><span class="comment">## assays(1): counts</span></div><div class="line"><span class="comment">## rownames: NULL</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(8): ERR127306 ERR127307 ... ERR127304 ERR127305</span></div><div class="line"><span class="comment">## colData names(0):</span></div></pre></td></tr></table></figure>
<p><code>hnse</code> 是<code>RangedSummarizedExperiment</code> 类的一实例。这个类就类似于 <code>ExpressionSet</code> ，不过有着更多的内容来管理元数据，它的流程如下所示：</p>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_summex-lkseee-1.png" alt="plot of chunk lkseee">
<p class="caption">plot of chunk lkseee</p>
</div>
<p>有效地使用<code>SummarizedExperiment</code>实例涉及学习它的一些方法。为了获取HNRNPC基因的读长/区域(read/region)，我们可以使用<code>assay</code>方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">assay(hnse)</div><div class="line"><span class="comment">##      ERR127306 ERR127307 ERR127308 ERR127309 ERR127302 ERR127303 ERR127304</span></div><div class="line"><span class="comment">## [1,]      5422      6320      5896      5558       172       196       316</span></div><div class="line"><span class="comment">##      ERR127305</span></div><div class="line"><span class="comment">## [1,]       282</span></div></pre></td></tr></table></figure>
<p>以上就是最基本的结果表示方法。列名则是样本标识符，但是有关区域检查的一些信息则已经丢失。</p>
<h2 id="summarizedexperiment中的元数据">SummarizedExperiment中的元数据</h2>
<p><code>hnse</code> 对象还有一些其它的信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">rowRanges(hnse)</div><div class="line"><span class="comment">## GRanges object with 1 range and 0 metadata columns:</span></div><div class="line"><span class="comment">##       seqnames               ranges strand</span></div><div class="line"><span class="comment">##          &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt;</span></div><div class="line"><span class="comment">##   [1]    chr14 [21677296, 21737638]      *</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></div><div class="line">seqinfo(hnse)</div><div class="line"><span class="comment">## Seqinfo object with 1 sequence from an unspecified genome; no seqlengths:</span></div><div class="line"><span class="comment">##   seqnames seqlengths isCircular genome</span></div><div class="line"><span class="comment">##   chr14            NA         NA   &lt;NA&gt;</span></div><div class="line">metadata(hnse)</div><div class="line"><span class="comment">## list()</span></div></pre></td></tr></table></figure>
<p>我们还可以进一步分析差异信息，从而输出更多，更广泛的信息。</p>
<h1 id="通过添加输入信息来更有效地生成summarizedexperiment">通过添加输入信息来更有效地生成SummarizedExperiment</h1>
<h2 id="使用元数据定义感兴趣的区域">使用元数据定义感兴趣的区域</h2>
<p>We have seen that it is sufficient to define a single GRanges to drive <code>summarizeOverlaps</code> over a set of BAM files. We’d like to preserve more metadata about the regions examined. We’ll use the TxDb infrastructure, to be described in more detail later, to get a structure defining gene regions on chr14. We’ll also use the Homo.sapiens annotation package to add gene symbols.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(TxDb.Hsapiens.UCSC.hg19.knownGene)</div><div class="line">txdb = TxDb.Hsapiens.UCSC.hg19.knownGene</div><div class="line">gr14 = genes(txdb, vals=list(tx_chrom=<span class="string">"chr14"</span>))</div><div class="line"><span class="comment">## Warning: 'elementLengths' is deprecated.</span></div><div class="line"><span class="comment">## Use 'elementNROWS' instead.</span></div><div class="line"><span class="comment">## See help("Deprecated")</span></div><div class="line"></div><div class="line"><span class="comment">## Warning: 'elementLengths' is deprecated.</span></div><div class="line"><span class="comment">## Use 'elementNROWS' instead.</span></div><div class="line"><span class="comment">## See help("Deprecated")</span></div><div class="line">gr14$symbol = mapIds(Homo.sapiens, keys=gr14$gene_id, keytype=<span class="string">"ENTREZID"</span>,</div><div class="line">   column=<span class="string">"SYMBOL"</span>)</div><div class="line"><span class="comment">## 'select()' returned 1:1 mapping between keys and columns</span></div><div class="line">gr14</div><div class="line"><span class="comment">## GRanges object with 781 ranges and 2 metadata columns:</span></div><div class="line"><span class="comment">##             seqnames                 ranges strand |     gene_id</span></div><div class="line"><span class="comment">##                &lt;Rle&gt;              &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt;</span></div><div class="line"><span class="comment">##       10001    chr14 [ 71050957,  71067384]      - |       10001</span></div><div class="line"><span class="comment">##   100113389    chr14 [ 45580078,  45580176]      + |   100113389</span></div><div class="line"><span class="comment">##   100113391    chr14 [ 20794600,  20794698]      - |   100113391</span></div><div class="line"><span class="comment">##   100124539    chr14 [ 91592770,  91592896]      + |   100124539</span></div><div class="line"><span class="comment">##   100126297    chr14 [101507700, 101507781]      + |   100126297</span></div><div class="line"><span class="comment">##         ...      ...                    ...    ... .         ...</span></div><div class="line"><span class="comment">##        9870    chr14 [ 75127955,  75179807]      - |        9870</span></div><div class="line"><span class="comment">##        9878    chr14 [ 21945335,  21967319]      + |        9878</span></div><div class="line"><span class="comment">##        9895    chr14 [102829300, 102968818]      + |        9895</span></div><div class="line"><span class="comment">##        9950    chr14 [ 93260650,  93306304]      + |        9950</span></div><div class="line"><span class="comment">##        9985    chr14 [ 24641234,  24649463]      + |        9985</span></div><div class="line"><span class="comment">##                  symbol</span></div><div class="line"><span class="comment">##             &lt;character&gt;</span></div><div class="line"><span class="comment">##       10001        MED6</span></div><div class="line"><span class="comment">##   100113389    SNORD127</span></div><div class="line"><span class="comment">##   100113391    SNORD126</span></div><div class="line"><span class="comment">##   100124539    SNORA11B</span></div><div class="line"><span class="comment">##   100126297      MIR300</span></div><div class="line"><span class="comment">##         ...         ...</span></div><div class="line"><span class="comment">##        9870       AREL1</span></div><div class="line"><span class="comment">##        9878        TOX4</span></div><div class="line"><span class="comment">##        9895      TECPR2</span></div><div class="line"><span class="comment">##        9950      GOLGA5</span></div><div class="line"><span class="comment">##        9985        REC8</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 93 sequences (1 circular) from hg19 genome</span></div></pre></td></tr></table></figure>
<h2 id="定义bam文件的样本信息">定义BAM文件的样本信息</h2>
<p>现在我们有三个样本，一个用于控制，两个用于敲低。我们使用<code>GenomicFiles</code>来绑定样本信息的元数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">char = rep(c(<span class="string">"hela_wt"</span>, <span class="string">"hela_hkd"</span>), each=<span class="number">4</span>)</div><div class="line">bff = GenomicFiles(files=path(bfl))</div><div class="line">colData(bff)$condition = char</div><div class="line">sid = c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>)</div><div class="line">bff$sample = sid</div><div class="line">bff</div><div class="line"><span class="comment">## GenomicFiles object with 0 ranges and 8 files: </span></div><div class="line"><span class="comment">## files: ERR127306_chr14.bam, ERR127307_chr14.bam, ..., ERR127304_chr14.bam, ERR127305_chr14.bam </span></div><div class="line"><span class="comment">## detail: use files(), rowRanges(), colData(), ...</span></div></pre></td></tr></table></figure>
<h2 id="比较读长覆盖区保留元数据">比较读长覆盖区，保留元数据</h2>
<p>我们来查看5个基因，其中就包括HNRNPC。当计算后，我们会将样本信息再绑定回结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">hnse = summarizeOverlaps(gr14[c(<span class="number">1</span>:<span class="number">4</span>,<span class="number">305</span>)],files(bff))</div><div class="line">colData(hnse) = cbind(colData(hnse), colData(bff))</div><div class="line">hnse</div><div class="line"><span class="comment">## class: RangedSummarizedExperiment </span></div><div class="line"><span class="comment">## dim: 5 8 </span></div><div class="line"><span class="comment">## metadata(0):</span></div><div class="line"><span class="comment">## assays(1): counts</span></div><div class="line"><span class="comment">## rownames(5): 10001 100113389 100113391 100124539 3183</span></div><div class="line"><span class="comment">## rowData names(2): gene_id symbol</span></div><div class="line"><span class="comment">## colnames(8): ERR127306 ERR127307 ... ERR127304 ERR127305</span></div><div class="line"><span class="comment">## colData names(2): condition sample</span></div><div class="line">assay(hnse)</div><div class="line"><span class="comment">##           ERR127306 ERR127307 ERR127308 ERR127309 ERR127302 ERR127303</span></div><div class="line"><span class="comment">## 10001           114       156       129       144       175       213</span></div><div class="line"><span class="comment">## 100113389         0         0         0         0         0         0</span></div><div class="line"><span class="comment">## 100113391         0         0         0         0         0         0</span></div><div class="line"><span class="comment">## 100124539         0         0         0         0         0         0</span></div><div class="line"><span class="comment">## 3183           2711      3160      2948      2779        86        98</span></div><div class="line"><span class="comment">##           ERR127304 ERR127305</span></div><div class="line"><span class="comment">## 10001           210       165</span></div><div class="line"><span class="comment">## 100113389         0         0</span></div><div class="line"><span class="comment">## 100113391         0         0</span></div><div class="line"><span class="comment">## 100124539         0         0</span></div><div class="line"><span class="comment">## 3183            158       141</span></div></pre></td></tr></table></figure>
<p>从上面我们可以看出，行标识符是随计数矩阵一起出现的，现在我们绘制出这几个基因的箱线图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">2</span>:<span class="number">5</span>) &#123;</div><div class="line">  boxplot(assay(hnse)[i,]~hnse$condition, ylab=rowRanges(hnse)$symbol[i])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_summex-lkbo-1.png" alt="plot of chunk lkbo">
<p class="caption">plot of chunk lkbo</p>
</div>
<h1 id="从expressionset提取数据">从ExpressionSet提取数据</h1>
<p>从ExpressionSet中提取数据很容易，但是还需要基于基因组范围查询的阵列探针的子集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ALL)</div><div class="line">data(ALL)</div><div class="line">allse = makeSummarizedExperimentFromExpressionSet(ALL)</div><div class="line">allse</div><div class="line"><span class="comment">## class: RangedSummarizedExperiment </span></div><div class="line"><span class="comment">## dim: 12625 128 </span></div><div class="line"><span class="comment">## metadata(3): experimentData annotation protocolData</span></div><div class="line"><span class="comment">## assays(1): exprs</span></div><div class="line"><span class="comment">## rownames(12625): 1000_at 1001_at ... AFFX-YEL021w/URA3_at</span></div><div class="line"><span class="comment">##   AFFX-YEL024w/RIP1_at</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(128): 01005 01010 ... 83001 LAL4</span></div><div class="line"><span class="comment">## colData names(21): cod diagnosis ... f.u date.last.seen</span></div><div class="line">rowRanges(allse)</div><div class="line"><span class="comment">## Warning: 'elementLengths' is deprecated.</span></div><div class="line"><span class="comment">## Use 'elementNROWS' instead.</span></div><div class="line"><span class="comment">## See help("Deprecated")</span></div><div class="line"><span class="comment">## GRangesList object of length 12625:</span></div><div class="line"><span class="comment">## $$1000_at </span></div><div class="line"><span class="comment">## GRanges object with 0 ranges and 0 metadata columns:</span></div><div class="line"><span class="comment">##    seqnames    ranges strand</span></div><div class="line"><span class="comment">##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$1001_at </span></div><div class="line"><span class="comment">## GRanges object with 0 ranges and 0 metadata columns:</span></div><div class="line"><span class="comment">##      seqnames ranges strand</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$1002_f_at </span></div><div class="line"><span class="comment">## GRanges object with 0 ranges and 0 metadata columns:</span></div><div class="line"><span class="comment">##      seqnames ranges strand</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## ...</span></div><div class="line"><span class="comment">## &lt;12622 more elements&gt;</span></div><div class="line"><span class="comment">## -------</span></div><div class="line"><span class="comment">## seqinfo: no sequences</span></div></pre></td></tr></table></figure>
<h1 id="总结">总结</h1>
<p><code>RangedSummarizedExperiment</code>类实例化了一些Bioconductor数据结构设计的一些关键原则：</p>
<ul>
<li>基于样本特征的数据分析和元数据分析，并将它们以某种方式绑定在一起。</li>
<li>类似于矩阵的子集直接用于分析和样本数据分析。</li>
<li>基于范围的子集设置适用于可通过基因组坐标寻址的分析。</li>
<li>可以在<code>mcol</code>中提供关键分析特征的任意元数据(<code>rowRanges(se)</code>)。</li>
<li>可以通过<code>metadata(se)&lt;-</code> 来添加任何元数据。</li>
</ul>
<p>在后面的内容里我们还将会了解更多的关于<code>SummarizedExperiment</code>改造的一些数据结构，从而用于专门用于RNA-seq的多个阶段处理和数据分析。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/bioc1_summex.html" target="_blank" rel="external">SummarizedExperiment class in depth</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/05/Genomics Data Analysis Series/GDAS005-基因组实验中的数据结构与管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/05/Genomics Data Analysis Series/GDAS005-基因组实验中的数据结构与管理/" itemprop="url">GDAS005-基因组实验中的数据结构与管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-05T12:00:00+08:00">
                2019-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9,924
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  45
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言">前言</h1>
<p>在科学研究中，大家都认为数据管理是一项专业且乏味的工作。因为数据管理一旦出现问题，会导致自身的资源与声誉付出高昂的代价，因此，数据管理必须要高度可靠且有效。在传统实验室中，研究人员通常使用电子表格来管理数据，但是这种方式存在着风险。因此，我们希望通常简化可靠的数据管理操作来增加数据的价值。</p>
<p>在Bioconductor中，指导软件开发的原则也可以应用于数据管理。模块化和可扩展的数据结构能够发挥更高的价值。打包和版本控制协议适用于定义数据类(data class)。我们可以将电子表格转化为语义丰富的对象，并联合使用NCBI GEO数据库，处理BAM和BED文件，以及外部存储来促进与大型多组学数据库（例如TCGA）衔接来说明一下上述的这些思路。</p>
<h1 id="汇总多个表格信息">汇总多个表格信息</h1>
<h2 id="演示包gse5859subset">演示包：GSE5859Subset</h2>
<p>GSE5859Subset是一个包，里面含有一个实验的表达数据。当加载了这个包后，我们可以看到这个包有三个组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">library(GSE5859Subset)</div><div class="line">data(GSE5859Subset)</div><div class="line">dim(geneExpression)</div><div class="line">## [1] 8793   24</div><div class="line">dim(geneAnnotation)</div><div class="line">## [1] 8793    4</div><div class="line">dim(sampleInfo)</div><div class="line">## [1] 24  4</div></pre></td></tr></table></figure>
<p>我们来查看一下这3个组件是否有关（一个矩阵，两个数据框），如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">all.equal(sampleInfo$filename, colnames(geneExpression))</div><div class="line">## [1] TRUE</div><div class="line">all.equal(rownames(geneExpression), geneAnnotation$PROBEID)</div><div class="line">## [1] TRUE</div></pre></td></tr></table></figure>
<p>简单来讲，我们可以把 <code>sampleInfo$filename</code> 视为一个按行连接的节点(key)，它连接了样本信息表格与基因表达表格。<code>colnames(geneExpression)</code>将该矩阵的列连接到<code>sampleInfo</code>的行中对应的样本。简单来说就是，geneExpression的列名是样本名，而sampleInfo中的某1列中也含有这些样本名，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191029171318.png">

</div>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191029171338.png">

</div>
<p>与之类似, <code>geneExpression</code> 的行名，对应了<code>geneAnnotation</code>中探针数据，即 <code>PROBEID</code> ，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">options(digits=2)</div><div class="line">cbind(sampleInfo[1:3,], colnames(geneExpression)[1:3], </div><div class="line">    t(geneExpression)[1:3,1:4])</div><div class="line">##     ethnicity       date         filename group</div><div class="line">## 107       ASN 2005-06-23 GSM136508.CEL.gz     1</div><div class="line">## 122       ASN 2005-06-27 GSM136530.CEL.gz     1</div><div class="line">## 113       ASN 2005-06-27 GSM136517.CEL.gz     1</div><div class="line">##     colnames(geneExpression)[1:3] 1007_s_at 1053_at 117_at 121_at</div><div class="line">## 107              GSM136508.CEL.gz       6.5     7.5    5.4    7.9</div><div class="line">## 122              GSM136530.CEL.gz       6.4     7.3    5.1    7.7</div><div class="line">## 113              GSM136517.CEL.gz       6.3     7.2    5.0    7.5</div></pre></td></tr></table></figure>
<h2 id="在expressionset汇总表格">在ExpressionSet汇总表格</h2>
<p><code>ExpressionSet</code> 容器用于管理一个项目中的所有信息。为了改善基因名与样本名命名的可视化效果，我们可以以下每个组件的注释信息，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">head(rownames(sampleInfo))</div><div class="line">head(rownames(geneAnnotation))</div><div class="line">rownames(sampleInfo) = sampleInfo$filename</div><div class="line">rownames(geneAnnotation) = geneAnnotation$PROBEID</div><div class="line">head(rownames(sampleInfo))</div><div class="line">head(rownames(geneAnnotation))</div></pre></td></tr></table></figure>
<p>结果如下所：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; head(rownames(sampleInfo))</div><div class="line">[<span class="number">1</span>] <span class="string">"107"</span> <span class="string">"122"</span> <span class="string">"113"</span> <span class="string">"163"</span> <span class="string">"153"</span> <span class="string">"161"</span></div><div class="line">&gt; head(rownames(geneAnnotation))</div><div class="line">[<span class="number">1</span>] <span class="string">"1"</span>  <span class="string">"30"</span> <span class="string">"31"</span> <span class="string">"32"</span> <span class="string">"33"</span> <span class="string">"34"</span></div><div class="line">&gt; rownames(sampleInfo) = sampleInfo$filename</div><div class="line">&gt; rownames(geneAnnotation) = geneAnnotation$PROBEID</div><div class="line">&gt; head(rownames(sampleInfo))</div><div class="line">[<span class="number">1</span>] <span class="string">"GSM136508.CEL.gz"</span> <span class="string">"GSM136530.CEL.gz"</span> <span class="string">"GSM136517.CEL.gz"</span></div><div class="line">[<span class="number">4</span>] <span class="string">"GSM136576.CEL.gz"</span> <span class="string">"GSM136566.CEL.gz"</span> <span class="string">"GSM136574.CEL.gz"</span></div><div class="line">&gt; head(rownames(geneAnnotation))</div><div class="line">[<span class="number">1</span>] <span class="string">"1007_s_at"</span> <span class="string">"1053_at"</span>   <span class="string">"117_at"</span>    <span class="string">"121_at"</span>    <span class="string">"1255_g_at"</span></div><div class="line">[<span class="number">6</span>] <span class="string">"1294_at"</span></div></pre></td></tr></table></figure>
<p>现在我们已经将样本的信息进行了更改，现在我们生成 <code>ExpressionSet</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(Biobase)</div><div class="line">es5859 = ExpressionSet(assayData=geneExpression)</div><div class="line">pData(es5859) = sampleInfo</div><div class="line">fData(es5859) = geneAnnotation</div><div class="line">es5859</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 8793 features, 24 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: GSM136508.CEL.gz GSM136530.CEL.gz ...</span></div><div class="line"><span class="comment">##     GSM136572.CEL.gz (24 total)</span></div><div class="line"><span class="comment">##   varLabels: ethnicity date filename group</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData</span></div><div class="line"><span class="comment">##   featureNames: 1007_s_at 1053_at ... AFFX-r2-P1-cre-5_at (8793</span></div><div class="line"><span class="comment">##     total)</span></div><div class="line"><span class="comment">##   fvarLabels: PROBEID CHR CHRLOC SYMBOL</span></div><div class="line"><span class="comment">##   fvarMetadata: labelDescription</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">## Annotation:</span></div></pre></td></tr></table></figure>
<p>这样做的一个好处的就是，我们可以使用<code>fData</code>和<code>pData</code>组件中更高层次的注释来选择特征。例如，我们现在只提取Y染色体上的基因表达特征：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">es5859[which(fData(es5859)$CHR==<span class="string">"chrY"</span>),]</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 21 features, 24 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: GSM136508.CEL.gz GSM136530.CEL.gz ...</span></div><div class="line"><span class="comment">##     GSM136572.CEL.gz (24 total)</span></div><div class="line"><span class="comment">##   varLabels: ethnicity date filename group</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData</span></div><div class="line"><span class="comment">##   featureNames: 201909_at 204409_s_at ... 211149_at (21 total)</span></div><div class="line"><span class="comment">##   fvarLabels: PROBEID CHR CHRLOC SYMBOL</span></div><div class="line"><span class="comment">##   fvarMetadata: labelDescription</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">## Annotation:</span></div></pre></td></tr></table></figure>
<p>我们可以看一下可<code>ExpressionSet</code>这种类所能使用的所有方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">methods(class=<span class="string">"ExpressionSet"</span>)</div><div class="line"><span class="comment">##  [1] [                [[               [[&lt;-             $$               </span></div><div class="line"><span class="comment">##  [5] $$&lt;-              abstract         annotation       annotation&lt;-    </span></div><div class="line"><span class="comment">##  [9] as.data.frame    as.matrix        assayData        assayData&lt;-     </span></div><div class="line"><span class="comment">## [13] boxplot          classVersion     classVersion&lt;-   coerce          </span></div><div class="line"><span class="comment">## [17] combine          description      description&lt;-    dim             </span></div><div class="line"><span class="comment">## [21] dimnames         dimnames&lt;-       dims             esApply         </span></div><div class="line"><span class="comment">## [25] experimentData   experimentData&lt;- exprs            exprs&lt;-         </span></div><div class="line"><span class="comment">## [29] fData            fData&lt;-          featureData      featureData&lt;-   </span></div><div class="line"><span class="comment">## [33] featureNames     featureNames&lt;-   fvarLabels       fvarLabels&lt;-    </span></div><div class="line"><span class="comment">## [37] fvarMetadata     fvarMetadata&lt;-   initialize       isCurrent       </span></div><div class="line"><span class="comment">## [41] isVersioned      KEGG2heatmap     KEGGmnplot       makeDataPackage </span></div><div class="line"><span class="comment">## [45] notes            notes&lt;-          pData            pData&lt;-         </span></div><div class="line"><span class="comment">## [49] phenoData        phenoData&lt;-      preproc          preproc&lt;-       </span></div><div class="line"><span class="comment">## [53] protocolData     protocolData&lt;-   pubMedIds        pubMedIds&lt;-     </span></div><div class="line"><span class="comment">## [57] rowMedians       rowQ             sampleNames      sampleNames&lt;-   </span></div><div class="line"><span class="comment">## [61] show             storageMode      storageMode&lt;-    updateObject    </span></div><div class="line"><span class="comment">## [65] updateObjectTo   varLabels        varLabels&lt;-      varMetadata     </span></div><div class="line"><span class="comment">## [69] varMetadata&lt;-    write.exprs     </span></div><div class="line"><span class="comment">## see '?methods' for accessing help and source code</span></div></pre></td></tr></table></figure>
<p>在这些方法中比较重要的有以下几个：</p>
<ul>
<li><code>exprs()</code>: 获取数值型表达值；</li>
<li><code>pData()</code>: 获取样本数据，就是样本名；</li>
<li><code>fData()</code>: 获取特征数据，就是基因表达值；</li>
<li><code>annotation()</code>: 获取特征名的标签；get a tag that identifies nomenclature for feature names</li>
<li><code>experimentData()</code>: 获取符合 <a href="https://www.ncbi.nlm.nih.gov/geo/info/MIAME.html" target="_blank" rel="external">MIAME</a>的元数据结构。</li>
</ul>
<p>许多方法都具有<code>setter</code>属性（注：这里的<code>setter</code>应该是R面向对象编程中的一个方法，我猜测可能是赋值一类的操作，具体的我还不清楚）。例如，</p>
<p><code>exprs&lt;-</code> 可以用于指定表达数值。此外，所有的组件都是可选的，因此我们的<code>es5859</code>对象中没有<code>annotation</code>或<code>experimentData</code>也不奇怪。我们随后会改善一下这个对象的自身的描述，首选我们设置注释信息，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">annotation(es5859)</div><div class="line">annotation(es5859) = &quot;hgfocus.db&quot; # need to look at GSE record in GEO, and know .db</div><div class="line">annotation(es5859)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; annotation(es5859)</div><div class="line">character(<span class="number">0</span>)</div><div class="line">&gt; annotation(es5859) = <span class="string">"hgfocus.db"</span> <span class="comment"># need to look at GSE record in GEO, and know .db</span></div><div class="line">&gt; </div><div class="line">&gt; annotation(es5859)</div><div class="line">[<span class="number">1</span>] <span class="string">"hgfocus.db"</span></div></pre></td></tr></table></figure>
<p>第二，获取符合MIAME文档的实验元数据信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(annotate)</div><div class="line">es5859</div><div class="line">mi = pmid2MIAME(<span class="string">"17206142"</span>)</div><div class="line">experimentData(es5859) = mi</div><div class="line">es5859</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 8793 features, 24 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: GSM136508.CEL.gz GSM136530.CEL.gz ...</span></div><div class="line"><span class="comment">##     GSM136572.CEL.gz (24 total)</span></div><div class="line"><span class="comment">##   varLabels: ethnicity date filename group</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData</span></div><div class="line"><span class="comment">##   featureNames: 1007_s_at 1053_at ... AFFX-r2-P1-cre-5_at (8793</span></div><div class="line"><span class="comment">##     total)</span></div><div class="line"><span class="comment">##   fvarLabels: PROBEID CHR CHRLOC SYMBOL</span></div><div class="line"><span class="comment">##   fvarMetadata: labelDescription</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">##   pubMedIds: 17206142 </span></div><div class="line"><span class="comment">## Annotation: hgfocus.db</span></div></pre></td></tr></table></figure>
<p>现在我们通过<code>abstract</code>方法就能获取一定信息：</p>
<p>Now, for example, the <code>abstract</code> method will function well:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">nchar(abstract(es5859))</div><div class="line"><span class="comment">## [1] 1057</span></div><div class="line">substr(abstract(es5859),<span class="number">1</span>,<span class="number">50</span>)</div><div class="line"><span class="comment">## [1] "Variation in DNA sequence contributes to individua"</span></div></pre></td></tr></table></figure>
<p>用于汇总这些表格的最新方法就是使用<code>SummarizedExperiment</code>类，我们后面会讲到。</p>
<h2 id="自同态环概念endomorphism">*自同态环概念(endomorphism)</h2>
<p>关于ExpressionSet容器设计的一个最后备注：假设 <code>x</code> 是一个ExpressionSet。方括号被定义为一操作符，当<code>G</code>和<code>S</code>分别是标识特征和合适样本的合适向量时，那么<code>X[G,S]</code>是具有仅限于<code>G</code>和<code>S</code>中标记的那些特征值和样本的ExrpessionSet。对<code>X</code>有限的所有操作也都对 <code>X[G, S]</code> 有效。此属性称为ExpressionSet相对于中括号进行子集的自同态。</p>
<p>上面一段不太懂，以下是原文：</p>
<blockquote>
<p>A final remark about the ExpressionSet container design: Suppose <code>X</code> is an ExpressionSet. The bracket operator has been defined so that whenever <code>G</code> and <code>S</code> are suitable vectors identifying features and samples respectively, <code>X[G, S]</code> is an ExpressionSet with features and samples restricted to those identified in <code>G</code> and <code>S</code>. All operations that are valid for <code>X</code> are valid for <code>X[G, S]</code>. This property is called the <em>endomorphism of ExpressionSet with respect to subsetting with bracket</em>.</p>
</blockquote>
<h1 id="geo-geoquery-arrayexpress与表达数据储存">GEO, GEOquery, ArrayExpress与表达数据储存</h1>
<p>基因表达数据库(GEO)储存了源于NIH资助的所有微阵列实验的数据。 Bioconductor的GEOquery软件包可以很方便地获取这些数据。而ArrayExpress软件包则可以很容易地获取欧洲分子生物学实验室赞助的ArrayExpress数据。</p>
<h2 id="geometadb">GEOmetadb</h2>
<p>GEO中有数以万计的实验结果。<em>GEOmetadb</em>包括了用于获取和检索SQLite数据库的工具，SQLite数据库含有对GEO内容的广泛注释信息。2017年10月检索到的信息超过了6G。因此，我们并不需要你使用这个包。如果你有兴趣的话，可以参考vignette中案例，介绍得非常详细。</p>
<h2 id="getgeo获取geo中的expressionset">getGEO获取GEO中的ExpressionSet</h2>
<p>例如我们对胶质母细胞瘤的基因组学特别感兴趣，并且已经性了一篇论文(Pmid 27746144)讨论了一种新陈代谢途径作可能会增强其治疗开发策略。这个实验使用了Affymetrix PrimeView阵列，并储存在GEO。现在我们使用getGEO获取这些数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(GEOquery)</div><div class="line">glioMA = getGEO(<span class="string">"GSE78703"</span>)[[<span class="number">1</span>]]</div><div class="line"><span class="comment">## Found 1 file(s)</span></div><div class="line"><span class="comment">## GSE78703_series_matrix.txt.gz</span></div><div class="line"><span class="comment">## Parsed with column specification:</span></div><div class="line"><span class="comment">## cols(</span></div><div class="line"><span class="comment">##   ID_REF = col_character(),</span></div><div class="line"><span class="comment">##   GSM2072905 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072906 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072907 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072908 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072909 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072910 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072911 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072912 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072913 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072914 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072915 = col_double(),</span></div><div class="line"><span class="comment">##   GSM2072916 = col_double()</span></div><div class="line"><span class="comment">## )</span></div><div class="line"><span class="comment">## File stored at:</span></div><div class="line"><span class="comment">## /var/folders/5_/14ld0y7s0vbg_z0g2c9l8v300000gr/T//RtmpKRbO0i/GPL15207.soft</span></div><div class="line"><span class="comment">## Warning: 102 parsing failures.</span></div><div class="line"><span class="comment">##   row     col           expected         actual         file</span></div><div class="line"><span class="comment">## 49294 SPOT_ID 1/0/T/F/TRUE/FALSE AFFX-BioB-3_at literal data</span></div><div class="line"><span class="comment">## 49295 SPOT_ID 1/0/T/F/TRUE/FALSE AFFX-BioB-5_at literal data</span></div><div class="line"><span class="comment">## 49296 SPOT_ID 1/0/T/F/TRUE/FALSE AFFX-BioB-M_at literal data</span></div><div class="line"><span class="comment">## 49297 SPOT_ID 1/0/T/F/TRUE/FALSE AFFX-BioC-3_at literal data</span></div><div class="line"><span class="comment">## 49298 SPOT_ID 1/0/T/F/TRUE/FALSE AFFX-BioC-5_at literal data</span></div><div class="line"><span class="comment">## ..... ....... .................. .............. ............</span></div><div class="line"><span class="comment">## See problems(...) for more details.</span></div><div class="line">glioMA</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 49395 features, 12 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: GSM2072905 GSM2072906 ... GSM2072916 (12 total)</span></div><div class="line"><span class="comment">##   varLabels: title geo_accession ... treated with:ch1 (35 total)</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData</span></div><div class="line"><span class="comment">##   featureNames: 11715100_at 11715101_s_at ... AFFX-TrpnX-M_at</span></div><div class="line"><span class="comment">##     (49395 total)</span></div><div class="line"><span class="comment">##   fvarLabels: ID GeneChip Array ... SPOT_ID (36 total)</span></div><div class="line"><span class="comment">##   fvarMetadata: Column Description labelDescription</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">##   pubMedIds: 27746144 </span></div><div class="line"><span class="comment">## Annotation: GPL15207</span></div></pre></td></tr></table></figure>
<p>通过以上操作中，我们可以看到使用这个对象（数据集）可以查看使用LXR-623处理能够影响基因ABCA1的表达，文献对应的PubMed ID为27746144。</p>
<h2 id="arrayexpress检索并获取embl-ebi的arrayexpress">ArrayExpress检索并获取EMBL-EBI的ArrayExpress</h2>
<p><a href="https://www.ebi.ac.uk/arrayexpress/" target="_blank" rel="external">ArrayExpress Archive of Functional Genomics Data</a>储存了高通量功能基因组实验的数据，并为其他研究者再次使用这些数据提供方便。最近，ArrayExpress还从NCBI GEO导入了所有表达数据。</p>
<p><em>ArrayExpress</em>包支持使用<code>queryAE</code>直接查询EMBL-EBI数据库，现在我们来试一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ArrayExpress)</div><div class="line">sets = queryAE(keywords = <span class="string">"glioblastoma"</span>, species = <span class="string">"homo+sapiens"</span>)</div><div class="line">dim(sets)</div><div class="line"><span class="comment">## [1] 546   8</span></div><div class="line">sets[<span class="number">5</span>:<span class="number">7</span>,-c(<span class="number">7</span>,<span class="number">8</span>)]</div><div class="line"><span class="comment">##                      ID Raw Processed ReleaseDate PubmedID      Species</span></div><div class="line"><span class="comment">## E-MTAB-6881 E-MTAB-6881  no        no  2019-04-30       NA Homo sapiens</span></div><div class="line"><span class="comment">## E-MTAB-6882 E-MTAB-6882  no        no  2019-04-29       NA Homo sapiens</span></div><div class="line"><span class="comment">## E-MTAB-7490 E-MTAB-7490 yes        no  2019-03-22       NA Homo sapiens</span></div></pre></td></tr></table></figure>
<p><code>PubmedID</code>这一列显示的是Pubmed号，有的有，有的没有（没有的用NA标记），通过<code>getAE</code>函数则可以获取原始数据，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">initdir = dir()</div><div class="line">if (!file.exists(&quot;E-MTAB-5797.sdrf.txt&quot;)) nano = getAE(&quot;E-MTAB-5797&quot;)</div></pre></td></tr></table></figure>
<p>上面的代码将与该实验相关的数据下载到当前文件夹，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">afterget = dir()</div><div class="line">setdiff(afterget, initdir)</div><div class="line">##  [1] &quot;9406922003_R01C01_Grn.idat&quot; &quot;9406922003_R01C01_Red.idat&quot;</div><div class="line">##  [3] &quot;9406922003_R02C01_Grn.idat&quot; &quot;9406922003_R02C01_Red.idat&quot;</div><div class="line">##  [5] &quot;9406922003_R03C02_Grn.idat&quot; &quot;9406922003_R03C02_Red.idat&quot;</div><div class="line">##  [7] &quot;9406922003_R04C02_Grn.idat&quot; &quot;9406922003_R04C02_Red.idat&quot;</div><div class="line">##  [9] &quot;9406922003_R05C01_Grn.idat&quot; &quot;9406922003_R05C01_Red.idat&quot;</div><div class="line">## [11] &quot;A-MEXP-2255.adf.txt&quot;        &quot;E-MTAB-5797.idf.txt&quot;       </div><div class="line">## [13] &quot;E-MTAB-5797.raw.1.zip&quot;      &quot;E-MTAB-5797.sdrf.txt&quot;</div></pre></td></tr></table></figure>
<p>在接下来的部分里，我们会讲解一下如何导入并处理这些数据。</p>
<h1 id="summarizedexperiment实例">SummarizedExperiment实例</h1>
<p>在使用微阵列的时代，目标核酸的是由微阵列里面的探针决定的。而在现在广泛使用的短读长测序方法则为目标核酸的定量提供了更大的灵活性。因此，Bioconductor针对大规模的基因检测设计了一种更加灵活的容器。这种容器的一个重要思路就是我们仅仅通过基因组的坐标就能对我们的目标核酸进行识别。这种容器容器可以使用户们仅仅使用基因组坐标就能方便地分析各种数据。通用方法<code>subsetByOverlaps</code>可以与<code>SummarizedExperiment</code>实例配合使用来实现这一目标。</p>
<h2 id="常规思路">常规思路</h2>
<p>应用于<code>SummarizedExperiment</code>的方法要比<code>ExpressionSet</code>的多，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">methods(class=<span class="string">"SummarizedExperiment"</span>)</div><div class="line"><span class="comment">##   [1] !=                [                 [[               </span></div><div class="line"><span class="comment">##   [4] [[&lt;-              [&lt;-               %in%             </span></div><div class="line"><span class="comment">##   [7] &lt;                 &lt;=                ==               </span></div><div class="line"><span class="comment">##  [10] &gt;                 &gt;=                $$                </span></div><div class="line"><span class="comment">##  [13] $$&lt;-               aggregate         anyDuplicated    </span></div><div class="line"><span class="comment">##  [16] anyNA             append            as.character     </span></div><div class="line"><span class="comment">##  [19] as.complex        as.data.frame     as.env           </span></div><div class="line"><span class="comment">##  [22] as.integer        as.list           as.logical       </span></div><div class="line"><span class="comment">##  [25] as.matrix         as.numeric        as.raw           </span></div><div class="line"><span class="comment">##  [28] assay             assay&lt;-           assayNames       </span></div><div class="line"><span class="comment">##  [31] assayNames&lt;-      assays            assays&lt;-         </span></div><div class="line"><span class="comment">##  [34] bindROWS          by                c                </span></div><div class="line"><span class="comment">##  [37] cbind             coerce            coerce&lt;-         </span></div><div class="line"><span class="comment">##  [40] colData           colData&lt;-         countOverlaps    </span></div><div class="line"><span class="comment">##  [43] dim               dimnames          dimnames&lt;-       </span></div><div class="line"><span class="comment">##  [46] duplicated        elementMetadata   elementMetadata&lt;-</span></div><div class="line"><span class="comment">##  [49] eval              expand            expand.grid      </span></div><div class="line"><span class="comment">##  [52] extractROWS       FactorToClass     findOverlaps     </span></div><div class="line"><span class="comment">##  [55] head              intersect         is.na            </span></div><div class="line"><span class="comment">##  [58] length            lengths           match            </span></div><div class="line"><span class="comment">##  [61] mcols             mcols&lt;-           merge            </span></div><div class="line"><span class="comment">##  [64] mergeROWS         metadata          metadata&lt;-       </span></div><div class="line"><span class="comment">##  [67] mstack            names             names&lt;-          </span></div><div class="line"><span class="comment">##  [70] NROW              overlapsAny       parallelSlotNames</span></div><div class="line"><span class="comment">##  [73] pcompare          rank              rbind            </span></div><div class="line"><span class="comment">##  [76] realize           relist            rename           </span></div><div class="line"><span class="comment">##  [79] rep               rep.int           replaceROWS      </span></div><div class="line"><span class="comment">##  [82] rev               rowData           rowData&lt;-        </span></div><div class="line"><span class="comment">##  [85] ROWNAMES          rowRanges         rowRanges&lt;-      </span></div><div class="line"><span class="comment">##  [88] selfmatch         seqlevelsInUse    setdiff          </span></div><div class="line"><span class="comment">##  [91] setequal          shiftApply        show             </span></div><div class="line"><span class="comment">##  [94] sort              split             split&lt;-          </span></div><div class="line"><span class="comment">##  [97] subset            subsetByOverlaps  summary          </span></div><div class="line"><span class="comment">## [100] table             tail              tapply           </span></div><div class="line"><span class="comment">## [103] transform         union             unique           </span></div><div class="line"><span class="comment">## [106] updateObject      values            values&lt;-         </span></div><div class="line"><span class="comment">## [109] window            window&lt;-          with             </span></div><div class="line"><span class="comment">## [112] xtabs             xtfrm            </span></div><div class="line"><span class="comment">## see '?methods' for accessing help and source code</span></div></pre></td></tr></table></figure>
<p>不过其中的一些关键方法的使用类似于<code>ExpressionSet</code>中的方法，如下所示：</p>
<ul>
<li><code>assay()</code>: 获取原始数值量化结果，这里需要注意的是，该方法支持多个分析结果，使用<code>assays()</code>可以以列表的形式获取多个结果</li>
<li><code>colData()</code>: 获取样本信息（从名字上来看，就是列信息）。</li>
<li><code>rowData()</code>: 获取表达值信息。当表达值信息是使用基因组坐标来表示时，则可以使用 <code>rowRanges()</code> 。</li>
<li><code>metadata()</code>: 获取可能包含相关实验的任何相关元数据的列表。</li>
</ul>
<h2 id="rna-seq实验">RNA-seq实验</h2>
<p>现在我们使用 <code>airway</code> 包来演示一下 <code>SummarizedExperiment</code>的概念，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(airway)</div><div class="line">data(airway)</div><div class="line">airway</div><div class="line"><span class="comment">## class: RangedSummarizedExperiment </span></div><div class="line"><span class="comment">## dim: 64102 8 </span></div><div class="line"><span class="comment">## metadata(1): ''</span></div><div class="line"><span class="comment">## assays(1): counts</span></div><div class="line"><span class="comment">## rownames(64102): ENSG00000000003 ENSG00000000005 ... LRG_98 LRG_99</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(8): SRR1039508 SRR1039509 ... SRR1039520 SRR1039521</span></div><div class="line"><span class="comment">## colData names(9): SampleName cell ... Sample BioSample</span></div></pre></td></tr></table></figure>
<p>元数据(Metadata)是以列表的形式储存的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">metadata(airway)</div><div class="line"><span class="comment">## [[1]]</span></div><div class="line"><span class="comment">## Experiment data</span></div><div class="line"><span class="comment">##   Experimenter name: Himes BE </span></div><div class="line"><span class="comment">##   Laboratory: NA </span></div><div class="line"><span class="comment">##   Contact information:  </span></div><div class="line"><span class="comment">##   Title: RNA-Seq transcriptome profiling identifies CRISPLD2 as a glucocorticoid responsive gene that modulates cytokine function in airway smooth muscle cells. </span></div><div class="line"><span class="comment">##   URL: http://www.ncbi.nlm.nih.gov/pubmed/24926665 </span></div><div class="line"><span class="comment">##   PMIDs: 24926665 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   Abstract: A 226 word abstract is available. Use 'abstract' method.</span></div></pre></td></tr></table></figure>
<p>这个数据集中的表达矩阵有64102行，它们的使用ENSEMBL数据库的命名方法定量了外显子的表达量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">rowRanges(airway)</div><div class="line"><span class="comment">## GRangesList object of length 64102:</span></div><div class="line"><span class="comment">## $$ENSG00000000003</span></div><div class="line"><span class="comment">## GRanges object with 17 ranges and 2 metadata columns:</span></div><div class="line"><span class="comment">##        seqnames            ranges strand |   exon_id       exon_name</span></div><div class="line"><span class="comment">##           &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt;     &lt;character&gt;</span></div><div class="line"><span class="comment">##    [1]        X 99883667-99884983      - |    667145 ENSE00001459322</span></div><div class="line"><span class="comment">##    [2]        X 99885756-99885863      - |    667146 ENSE00000868868</span></div><div class="line"><span class="comment">##    [3]        X 99887482-99887565      - |    667147 ENSE00000401072</span></div><div class="line"><span class="comment">##    [4]        X 99887538-99887565      - |    667148 ENSE00001849132</span></div><div class="line"><span class="comment">##    [5]        X 99888402-99888536      - |    667149 ENSE00003554016</span></div><div class="line"><span class="comment">##    ...      ...               ...    ... .       ...             ...</span></div><div class="line"><span class="comment">##   [13]        X 99890555-99890743      - |    667156 ENSE00003512331</span></div><div class="line"><span class="comment">##   [14]        X 99891188-99891686      - |    667158 ENSE00001886883</span></div><div class="line"><span class="comment">##   [15]        X 99891605-99891803      - |    667159 ENSE00001855382</span></div><div class="line"><span class="comment">##   [16]        X 99891790-99892101      - |    667160 ENSE00001863395</span></div><div class="line"><span class="comment">##   [17]        X 99894942-99894988      - |    667161 ENSE00001828996</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 722 sequences (1 circular) from an unspecified genome</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## ...</span></div><div class="line"><span class="comment">## &lt;64101 more elements&gt;</span></div></pre></td></tr></table></figure>
<p>在以前使用微阵列的时候，我们可能习惯于基因水平的定量信息。但在这个案例中，我们使用的外显子水平的定量信息，因此这里需要一个特定的计算方法将其转换为基因的定量信息。例如，基因ORMDL3在ENSEMBL中的标记符为ENSG00000172057，那么在<code>SummarizedExperiment</code>对象中，它所对应的坐标如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">rowRanges(airway)$ENSG00000172057</div><div class="line"><span class="comment">## GRanges object with 20 ranges and 2 metadata columns:</span></div><div class="line"><span class="comment">##        seqnames            ranges strand |   exon_id       exon_name</span></div><div class="line"><span class="comment">##           &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt;     &lt;character&gt;</span></div><div class="line"><span class="comment">##    [1]       17 38077294-38078938      - |    549057 ENSE00001316037</span></div><div class="line"><span class="comment">##    [2]       17 38077296-38077570      - |    549058 ENSE00002684279</span></div><div class="line"><span class="comment">##    [3]       17 38077929-38078002      - |    549059 ENSE00002697088</span></div><div class="line"><span class="comment">##    [4]       17 38078351-38078552      - |    549060 ENSE00002718599</span></div><div class="line"><span class="comment">##    [5]       17 38078530-38078938      - |    549061 ENSE00001517665</span></div><div class="line"><span class="comment">##    ...      ...               ...    ... .       ...             ...</span></div><div class="line"><span class="comment">##   [16]       17 38081876-38083094      - |    549072 ENSE00001517669</span></div><div class="line"><span class="comment">##   [17]       17 38082049-38082592      - |    549073 ENSE00002700064</span></div><div class="line"><span class="comment">##   [18]       17 38083070-38083099      - |    549074 ENSE00002688012</span></div><div class="line"><span class="comment">##   [19]       17 38083320-38083482      - |    549075 ENSE00002700595</span></div><div class="line"><span class="comment">##   [20]       17 38083737-38083854      - |    549076 ENSE00001283878</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 722 sequences (1 circular) from an unspecified genome</span></div></pre></td></tr></table></figure>
<p>另外，<code>GenomicRanges</code>的工作类似于<code>rowRanges()</code> 。 如果要查看在这个列表中外显子坐标是否存在重叠区域，可以使用 <code>reduce()</code>方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">reduce(rowRanges(airway)$ENSG00000172057)</div><div class="line"><span class="comment">## GRanges object with 8 ranges and 0 metadata columns:</span></div><div class="line"><span class="comment">##       seqnames            ranges strand</span></div><div class="line"><span class="comment">##          &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt;</span></div><div class="line"><span class="comment">##   [1]       17 38077294-38078938      -</span></div><div class="line"><span class="comment">##   [2]       17 38079365-38079516      -</span></div><div class="line"><span class="comment">##   [3]       17 38080283-38080478      -</span></div><div class="line"><span class="comment">##   [4]       17 38081008-38081058      -</span></div><div class="line"><span class="comment">##   [5]       17 38081422-38081624      -</span></div><div class="line"><span class="comment">##   [6]       17 38081876-38083099      -</span></div><div class="line"><span class="comment">##   [7]       17 38083320-38083482      -</span></div><div class="line"><span class="comment">##   [8]       17 38083737-38083854      -</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 722 sequences (1 circular) from an unspecified genome</span></div></pre></td></tr></table></figure>
<p>这表明从外显子集合投身到基因组中的信息有可能包含8个被转录的亚区域。关于如何将这些信息转换为基因水平的定量信息，可以参考其它章节 <a href="http://genomicsclass.github.io/book/pages/rnaseq_gene_level.html" target="_blank" rel="external">elsewhere in the genomicsclass book.</a></p>
<p>除了对表达值进行详细地注释外，我们还需要<code>colData()</code>来处理样本信息。其中 <code>$</code> 符号可以从列中提取样本信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">names(colData(airway))</div><div class="line"><span class="comment">## [1] "SampleName" "cell"       "dex"        "albut"      "Run"       </span></div><div class="line"><span class="comment">## [6] "avgLength"  "Experiment" "Sample"     "BioSample"</span></div><div class="line">table(airway$dex) <span class="comment"># main treatment factor</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   trt untrt </span></div><div class="line"><span class="comment">##     4     4</span></div></pre></td></tr></table></figure>
<h2 id="处理由illumina-450k甲基化芯片生成的数据">处理由Illumina 450k甲基化芯片生成的数据</h2>
<p><code>SummarizedExperiment</code> 类设计出来用于储存所有类似的芯片数据或短序列读长测序数据。前面我们提到的 <code>getAE</code> 用于从ArrayExpress提取了一批文件，这批文件是胶质母细胞瘤组织中的甲基化定量数据。</p>
<p>而样本信息储存在 <code>sdrf.txt</code> 文件中，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(data.table)</div><div class="line">sd5797 = fread(<span class="string">"E-MTAB-5797.sdrf.txt"</span>)</div><div class="line">head(sd5797[,c(<span class="number">3</span>,<span class="number">16</span>,<span class="number">18</span>)])</div><div class="line"><span class="comment">##    Characteristics[age] Label                   Performer</span></div><div class="line"><span class="comment">## 1:                   58   Cy3 IntegraGen SA, Evry, France</span></div><div class="line"><span class="comment">## 2:                   58   Cy5 IntegraGen SA, Evry, France</span></div><div class="line"><span class="comment">## 3:                   72   Cy3 IntegraGen SA, Evry, France</span></div><div class="line"><span class="comment">## 4:                   72   Cy5 IntegraGen SA, Evry, France</span></div><div class="line"><span class="comment">## 5:                   70   Cy3 IntegraGen SA, Evry, France</span></div><div class="line"><span class="comment">## 6:                   70   Cy5 IntegraGen SA, Evry, France</span></div></pre></td></tr></table></figure>
<p>原始表达数据储存在 <code>idat</code> 文件中。现在我们使用 <code>mnfi</code> 包中的<code>read.metharray()</code> 函数将其提取出来，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(minfi)</div><div class="line">pref = unique(substr(dir(patt=<span class="string">"idat"</span>),<span class="number">1</span>,<span class="number">17</span>)) <span class="comment"># find the prefix strings</span></div><div class="line">raw = read.metharray(pref)</div><div class="line">raw</div><div class="line"><span class="comment">## class: RGChannelSet </span></div><div class="line"><span class="comment">## dim: 622399 5 </span></div><div class="line"><span class="comment">## metadata(0):</span></div><div class="line"><span class="comment">## assays(2): Green Red</span></div><div class="line"><span class="comment">## rownames(622399): 10600313 10600322 ... 74810490 74810492</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(5): 9406922003_R01C01 9406922003_R02C01 9406922003_R03C02</span></div><div class="line"><span class="comment">##   9406922003_R04C02 9406922003_R05C01</span></div><div class="line"><span class="comment">## colData names(0):</span></div><div class="line"><span class="comment">## Annotation</span></div><div class="line"><span class="comment">##   array: IlluminaHumanMethylation450k</span></div><div class="line"><span class="comment">##   annotation: ilmn12.hg19</span></div></pre></td></tr></table></figure>
<p>现在已经出现了很多算法可以将原始数值转换为生物学上可以解释的相对甲基化数值。在这个案例中我们使用分位数归一化算法(quantile normalization)来将红色和绿色的信号转换为相对甲基化数值(M)，并且估计<code>SummarizedExperiment</code> 实例中的拷贝数(CN, copy number)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">glioMeth = preprocessQuantile(raw) <span class="comment"># generate SummarizedExperiment</span></div><div class="line"><span class="comment"># Require IlluminaHumanMethylation450kmanifest packages</span></div><div class="line"><span class="comment"># BiocManager::install("IlluminaHumanMethylation450kmanifest")</span></div><div class="line"><span class="comment"># BiocManager::install("IlluminaHumanMethylation450kanno.ilmn12.hg19")</span></div><div class="line"><span class="comment">## [preprocessQuantile] Mapping to genome.</span></div><div class="line"><span class="comment">## [preprocessQuantile] Fixing outliers.</span></div><div class="line"><span class="comment">## [preprocessQuantile] Quantile normalizing.</span></div><div class="line">glioMeth</div><div class="line"><span class="comment">## class: GenomicRatioSet </span></div><div class="line"><span class="comment">## dim: 485512 5 </span></div><div class="line"><span class="comment">## metadata(0):</span></div><div class="line"><span class="comment">## assays(2): M CN</span></div><div class="line"><span class="comment">## rownames(485512): cg13869341 cg14008030 ... cg08265308 cg14273923</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(5): 9406922003_R01C01 9406922003_R02C01 9406922003_R03C02</span></div><div class="line"><span class="comment">##   9406922003_R04C02 9406922003_R05C01</span></div><div class="line"><span class="comment">## colData names(3): xMed yMed predictedSex</span></div><div class="line"><span class="comment">## Annotation</span></div><div class="line"><span class="comment">##   array: IlluminaHumanMethylation450k</span></div><div class="line"><span class="comment">##   annotation: ilmn12.hg19</span></div><div class="line"><span class="comment">## Preprocessing</span></div><div class="line"><span class="comment">##   Method: Raw (no normalization or bg correction)</span></div><div class="line"><span class="comment">##   minfi version: 1.31.1</span></div><div class="line"><span class="comment">##   Manifest version: 0.4.0</span></div></pre></td></tr></table></figure>
<p>在后面部分中，我们会来讲解一下如何处理这些数据。</p>
<h1 id="外部数据储存hdf5array-savehdf5summarizedexperiment">外部数据储存—HDF5Array, saveHDF5SummarizedExperiment</h1>
<h2 id="测试内存占用">测试内存占用</h2>
<p>在常规的交互式使用中，R数据都是驻留在内存中。我们可以使用 <code>gc()</code>函数来估计一下某个任务占用的内存。Ncell所占用的空间用于处理语言结构，例如解析树(parse tree)和名称空间(namespaces)，Vcell的空间用于储存会话中加载的数字和字符数据，现在我们打开R，查看一下，如下所示：</p>
<p>专用于Ncell的空间用于处理语言结构，如解析树和名称空间，而专用于Vcell的空间用于存储会话中加载的数字和字符数据。在我的MacBook Air上，R的香草启动收益率</p>
<p>Space devoted to Ncells is used to deal with language constructs such as parse trees and namespaces, while space devoted to Vcells is used to store numerical and character data loaded in the session. On my macbook air, a vanilla startup of R yields</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; gc()</div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">10410962</span> <span class="number">556.1</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">38615493</span> <span class="number">294.7</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div></pre></td></tr></table></figure>
<p>当我们加载了 <code>airway</code> 包后，再查看一下，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; suppressMessages(&#123;library(airway)&#125;)</div><div class="line">&gt; gc()</div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells 10410859 556.0   18810631 1004.6  16638654 888.6</div><div class="line">Vcells 38613228 294.6  128861398  983.2 128847953 983.1</div></pre></td></tr></table></figure>
<p>现在加载 <code>airway</code> 这个 SummarizedExperiment实例，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; data(airway)</div><div class="line">&gt; gc()</div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells 11229539 599.8   18810631 1004.6  16638654 888.6</div><div class="line">Vcells 42534679 324.6  128861398  983.2 128847953 983.1</div><div class="line">&gt; dim(airway)</div><div class="line">[1] 64102     8</div></pre></td></tr></table></figure>
<p>随着加载数据的增多，内存的占用也在增大。使用 <code>rm()</code> 函数可以清除一些不使用的对象，从而释放内存，不过在实际分析过程中很少这样做，或者说这样做效率并不高。</p>
<h2 id="hdf5用于外部存储">HDF5用于外部存储</h2>
<p><a href="https://blog.csdn.net/mzpmzk/article/details/89188968" target="_blank" rel="external">HDF5</a> 的全称是Hierarchical Data Format Version 5，即层次性数据格式第五版，它是一种广泛用于储存数值型的数据结构，并且提供了各种科学编程语言的接口。<code>HDF5Array</code> 包简化了管理大量数据型数组的操作，它的使用如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(airway)</div><div class="line"><span class="keyword">library</span>(HDF5Array)  <span class="comment"># setup for external serialization</span></div><div class="line"><span class="comment">## Loading required package: rhdf5</span></div><div class="line">data(airway)</div><div class="line">airass = assay(airway)  <span class="comment"># obtain numerical data, then save as HDF5</span></div><div class="line">href = writeHDF5Array(airass, <span class="string">"airass.h5"</span>, <span class="string">"airway"</span>)</div></pre></td></tr></table></figure>
<p>现在我们可以发现，当我们访问相同的数值型数据时，内存的占用并没有增长，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; gc()  <span class="comment"># after attaching HDF5Array package</span></div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">11246377</span> <span class="number">600.7</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">42828456</span> <span class="number">326.8</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div><div class="line">&gt; myd = HDF5Array(<span class="string">"airass.h5"</span>, <span class="string">"airway"</span>)  <span class="comment"># get reference to data</span></div><div class="line">&gt; gc()</div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">11246488</span> <span class="number">600.7</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">42828777</span> <span class="number">326.8</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div><div class="line">&gt; dim(myd)</div><div class="line">[<span class="number">1</span>] <span class="number">64102</span>     <span class="number">8</span></div></pre></td></tr></table></figure>
<p>这样运行起来一切还都正常，不过我们更常用 <code>SummarizedExperiment</code> 容器来操作airway数据，也就是我们下面要讲解的内容。</p>
<h2 id="summarizedexperiment支持hdf5">SummarizedExperiment支持HDF5</h2>
<p>针对某个特定的 SummarizedExperiment 实例，<code>saveHDF5SummarizedExperiment</code>能将数据与元素数据汇集在一起，控制内存占用，同时保留容器中丰度的信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">saveHDF5SummarizedExperiment(airway, <span class="string">"externalAirway"</span>, replace=<span class="literal">TRUE</span>)</div><div class="line">newse = loadHDF5SummarizedExperiment(<span class="string">"externalAirway"</span>)</div><div class="line">newse</div><div class="line"><span class="comment">## class: RangedSummarizedExperiment </span></div><div class="line"><span class="comment">## dim: 64102 8 </span></div><div class="line"><span class="comment">## metadata(1): ''</span></div><div class="line"><span class="comment">## assays(1): counts</span></div><div class="line"><span class="comment">## rownames(64102): ENSG00000000003 ENSG00000000005 ... LRG_98 LRG_99</span></div><div class="line"><span class="comment">## rowData names(0):</span></div><div class="line"><span class="comment">## colnames(8): SRR1039508 SRR1039509 ... SRR1039520 SRR1039521</span></div><div class="line"><span class="comment">## colData names(9): SampleName cell ... Sample BioSample</span></div><div class="line">assay(newse[c(<span class="string">"ENSG00000000005"</span>, <span class="string">"LRG_99"</span>), </div><div class="line">        which(newse$dex == <span class="string">"trt"</span>)]) <span class="comment"># use familiar subsetting</span></div><div class="line"><span class="comment">## &lt;2 x 4&gt; DelayedMatrix object of type "integer":</span></div><div class="line"><span class="comment">##                 SRR1039509 SRR1039513 SRR1039517 SRR1039521</span></div><div class="line"><span class="comment">## ENSG00000000005          0          0          0          0</span></div><div class="line"><span class="comment">## LRG_99                   0          0          0          0</span></div></pre></td></tr></table></figure>
<p>在这个案例中，处理SummarizedExperiment元数据的操作抵抗了外部化这些数据的优势，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; gc() <span class="comment"># after loading SummarizedExperiment</span></div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">11252592</span> <span class="number">601.0</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">42840344</span> <span class="number">326.9</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div><div class="line">&gt; gc() <span class="comment"># after loading SummarizedExperiment</span></div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">11252592</span> <span class="number">601.0</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">42840344</span> <span class="number">326.9</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div><div class="line">&gt; newse = loadHDF5SummarizedExperiment(<span class="string">"externalAirway"</span>)</div><div class="line">&gt; gc()</div><div class="line">           used  (Mb) gc trigger   (Mb)  max used  (Mb)</div><div class="line">Ncells <span class="number">11252922</span> <span class="number">601.0</span>   <span class="number">18810631</span> <span class="number">1004.6</span>  <span class="number">16638654</span> <span class="number">888.6</span></div><div class="line">Vcells <span class="number">44883257</span> <span class="number">342.5</span>  <span class="number">128861398</span>  <span class="number">983.2</span> <span class="number">128847953</span> <span class="number">983.1</span></div></pre></td></tr></table></figure>
<p>对那些大量的数据，支持HDF5的SummarizedExperiment会在内存不够的情况下，提供灵活的计算。</p>
<h1 id="genomicfiles某个特定类型的文件家族">GenomicFiles某个特定类型的文件家族</h1>
<p><code>GenomicFiles</code> 是一个用于管理文件集合的包。当我们不想整体对某批数据进行解析和建模时，这个包就比较重要了，它可以导入某些文件的部分内容。</p>
<p><code>GenomicFiles</code> 类的实例有<code>rowRanges</code> 和 <code>colData</code> 方法。我们可以在 <code>GenomicFiles</code> 实例的 <code>colData</code> 组件中提取有关样本或实验的元数据，并且可以使用 <code>rowRanges</code> 组件来查看感兴趣的基因组间隔信息。</p>
<h2 id="bam-文件集">BAM 文件集</h2>
<p>现在我们使用一个案例来说明一下这个文件集。我们所使用的案例是由 <a href="http://dx.doi.org/10.1016/j.cell.2012.12.023" target="_blank" rel="external">Zarnack团队</a>在2013年进行的一个HNRNPC敲除后的RNA-seq测序项目。在这个项目中，一共有8个Hela细胞样本，其中4个是野生型，4个使用了RNAi敲低了HNRNPC，这个基因位于14号染色体上。</p>
<p><code>RNAseqData.HNRNPC.bam.chr14</code> 中已经包含了比对好的读长。BAM文件被储存在了一个名为 <code>RNAseqData.HNRNPC.bam.chr14_BAMFILES</code> 的向量中，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RNAseqData.HNRNPC.bam.chr14)</div><div class="line"><span class="keyword">library</span>(GenomicFiles)</div><div class="line">gf = GenomicFiles(files=RNAseqData.HNRNPC.bam.chr14_BAMFILES)</div><div class="line">gf</div><div class="line"><span class="comment">## GenomicFiles object with 0 ranges and 8 files: </span></div><div class="line"><span class="comment">## files: ERR127306_chr14.bam, ERR127307_chr14.bam, ..., ERR127304_chr14.bam, ERR127305_chr14.bam </span></div><div class="line"><span class="comment">## detail: use files(), rowRanges(), colData(), ...</span></div></pre></td></tr></table></figure>
<p>我们可以通过将感兴趣的区域绑定到对象中，从而增强一个文件的信息，现在我们使用 <code>GRanges</code> 来检索HNRNPC，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hn = GRanges(&quot;chr14&quot;, IRanges(21677296, 21737638), strand=&quot;-&quot;)</div><div class="line">rowRanges(gf) = hn</div></pre></td></tr></table></figure>
<p>如果要提取与感兴趣的区域重叠的比对信息(alignments)，我们可以使用<code>GenomicFiles</code>包中的 <code>reduceByRange</code> 方法。我们需要定义一个映射函数来加入到 <code>reduceByRange</code> 函数中。这个映射函数我们在下面会定义为 <code>MAP()</code> ， 它的参数有两个，其中 <code>r</code> 表示感兴趣的范围，<code>f</code> 指的是，被解析的文件中比对信息的重叠范围。在<code>MAP()</code> 函数中我们还使用了 <code>readGAlignmentPairs</code> 函数，这是因为我们霜肆处理配对的末端测序数据，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(GenomicAlignments)</div><div class="line">MAP = <span class="keyword">function</span>(r, f) </div><div class="line">    readGAlignmentPairs(f, param=ScanBamParam(which=r))</div><div class="line">ali = reduceByRange(gf, MAP=MAP)</div><div class="line"><span class="comment">## Warning in .make_GAlignmentPairs_from_GAlignments(gal, strandMode = strandMode, :   4 alignments with ambiguous pairing were dumped.</span></div><div class="line"><span class="comment">##     Use 'getDumpedAlignments()' to retrieve them from the dump environment.</span></div><div class="line">sapply(ali[[<span class="number">1</span>]], length)</div><div class="line"><span class="comment">## ERR127306 ERR127307 ERR127308 ERR127309 ERR127302 ERR127303 ERR127304 </span></div><div class="line"><span class="comment">##      2711      3160      2946      2779        86        98       158 </span></div><div class="line"><span class="comment">## ERR127305 </span></div><div class="line"><span class="comment">##       141</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们大致比较了一下这8个样本的目标范围，对于前4个样本来说，有更多的读长与HNRNPC区域比对上了，因此我们可以知道前4个样本是野生型细胞，后4个样本有较少的读长与HNRNPC区域比对上，这表明它们是敲低的HNRNPC。这里我们注意的是，敲低的效率并不是100%的，也就是说，我们仍然有可能会检测到有HNRNPC的一些转录本。</p>
<h2 id="bed-文件集">BED 文件集</h2>
<p><code>erma</code> 这个包设计用来演示在内存不足的情况下，基于表观遗传学中各种细胞类型数据分析，如何打包大量的数据。 这个包创建的基础容器是对 <code>GenomicFiles</code> 的简单扩展，它使用 <code>makeErmaSet()</code> 函数进行构建，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(erma)</div><div class="line">erset = makeErmaSet()</div><div class="line"><span class="comment">## <span class="doctag">NOTE:</span> input data had non-ASCII characters replaced by ' '.</span></div><div class="line">erset</div><div class="line"><span class="comment">## ErmaSet object with 0 ranges and 31 files: </span></div><div class="line"><span class="comment">## files: E002_25_imputed12marks_mnemonics.bed.gz, E003_25_imputed12marks_mnemonics.bed.gz, ..., E088_25_imputed12marks_mnemonics.bed.gz, E096_25_imputed12marks_mnemonics.bed.gz </span></div><div class="line"><span class="comment">## detail: use files(), rowRanges(), colData(), ... </span></div><div class="line"><span class="comment">## cellTypes() for type names; data(short_celltype) for abbr.</span></div></pre></td></tr></table></figure>
<p>我们可以使用 <code>colData</code> 来查看样本信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">colData(erset)</div><div class="line"><span class="comment">## (showing narrow slice of  31 x 95  DataFrame)   narrDF with 31 rows and 6 columns</span></div><div class="line"><span class="comment">##      Epigenome.ID..EID.          GROUP  Epigenome.Mnemonic     ANATOMY</span></div><div class="line"><span class="comment">##             &lt;character&gt;    &lt;character&gt;         &lt;character&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">## E002               E002            ESC             ESC.WA7         ESC</span></div><div class="line"><span class="comment">## E003               E003            ESC              ESC.H1         ESC</span></div><div class="line"><span class="comment">## E021               E021           iPSC         IPSC.DF.6.9        IPSC</span></div><div class="line"><span class="comment">## E032               E032   HSC &amp; B-cell        BLD.CD19.PPC       BLOOD</span></div><div class="line"><span class="comment">## E033               E033 Blood &amp; T-cell         BLD.CD3.CPC       BLOOD</span></div><div class="line"><span class="comment">## ...                 ...            ...                 ...         ...</span></div><div class="line"><span class="comment">## E071               E071          Brain        BRN.HIPP.MID       BRAIN</span></div><div class="line"><span class="comment">## E072               E072          Brain         BRN.INF.TMP       BRAIN</span></div><div class="line"><span class="comment">## E073               E073          Brain BRN.DL.PRFRNTL.CRTX       BRAIN</span></div><div class="line"><span class="comment">## E088               E088          Other             LNG.FET        LUNG</span></div><div class="line"><span class="comment">## E096               E096          Other                 LNG        LUNG</span></div><div class="line"><span class="comment">##                TYPE            SEX</span></div><div class="line"><span class="comment">##         &lt;character&gt;    &lt;character&gt;</span></div><div class="line"><span class="comment">## E002 PrimaryCulture         Female</span></div><div class="line"><span class="comment">## E003 PrimaryCulture           Male</span></div><div class="line"><span class="comment">## E021 PrimaryCulture           Male</span></div><div class="line"><span class="comment">## E032    PrimaryCell           Male</span></div><div class="line"><span class="comment">## E033    PrimaryCell        Unknown</span></div><div class="line"><span class="comment">## ...             ...            ...</span></div><div class="line"><span class="comment">## E071  PrimaryTissue           Male</span></div><div class="line"><span class="comment">## E072  PrimaryTissue          Mixed</span></div><div class="line"><span class="comment">## E073  PrimaryTissue          Mixed</span></div><div class="line"><span class="comment">## E088  PrimaryTissue Female/Unknown</span></div><div class="line"><span class="comment">## E096  PrimaryTissue         Female</span></div><div class="line"><span class="comment">## use colnames() for full set of metadata attributes.</span></div></pre></td></tr></table></figure>
<p>我们可以使用熟悉的简捷方式来查看样本元数据的表格信息：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">table(erset$ANATOMY)</div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##    BLOOD    BRAIN      ESC      FAT     IPSC    LIVER     LUNG     SKIN </span></div><div class="line"><span class="comment">##       15        7        2        1        1        1        2        1 </span></div><div class="line"><span class="comment">## VASCULAR </span></div><div class="line"><span class="comment">##        1</span></div></pre></td></tr></table></figure>
<p>因此我们可以在R中通过轻量级的接口（仅限于关于示例和文件路径的元数据）来访问大量的BED文件集。如果这些文件是用tabix建立索引的，那么我们就可以非常快速地针对性地检索特定范围的数据，我们可以使用 <code>stateProfile</code> 函数来说明这一点，如下所示：</p>
<blockquote>
<p>注：tabix是第一个能够对排序好的TAB分割数据进行处理，例如GEF，BED，PSL，SAM与SQL的输出数据等，它能快速地检索特定区域的重合部分。具体的使用方法可以参考本文的参考资料。</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">stateProfile(erset[,<span class="number">26</span>:<span class="number">31</span>], shortCellType=<span class="literal">FALSE</span>)</div><div class="line"><span class="comment">## 'select()' returned 1:many mapping between keys and columns</span></div><div class="line"><span class="comment">## Scale for 'y' is already present. Adding another scale for 'y', which</span></div><div class="line"><span class="comment">## will replace the existing scale.</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/dataman2019-lkstpr-1.png" alt="plot of chunk lkstpr">
<p class="caption">plot of chunk lkstpr</p>
</div>
<p>这张图描述在chr9的正义链上，基因IL33的启动子区域的表观遗传状态中的的解剖位点之间的变异。需要注意的是，胎儿肺样本似乎说明，与成人肺样本在这个区域的静默相比，胎儿肺样本则表现出增强子活性。。</p>
<h1 id="管理大量的dna变异信息">管理大量的DNA变异信息</h1>
<h2 id="vcf背景">VCF背景</h2>
<p>处理大量SNP基因型（或小indels）的最常用方法就是处理VCF文件（Variant Call Format）。从Wikipedia或相关文档，例如<a href="http://samtools.github.io/hts-specs/VCFv4.3.pdf" target="_blank" rel="external">spec</a>和<a href="http://vcftools.sourceforge.net/VCF-poster.pdf" target="_blank" rel="external">diagram</a>很容易查看VCF文件的内容。VCF文件的基本设计中含有一个头部信息，这个头部信息提供了关于VCF文件的元数据，并且包括了每个基因组的突变体(variant)信息。这些突变体信息记录了突变体的性质（那些已经检测出来与参考基因组的差异信息），以及包括用于描述存在于突变体结构(variant configuration)中的样本字段(field)。一些突变体是已经确定的，而一些突变体则无法确定，在这种情况下，基因型的可能性就会被记录下来。突变体也许是阶段性的(phased)，这就意味着，在某条具体的染色体上，突变的位置也有可能不同。</p>
<blockquote>
<p>后两句话不太理解，这里放上原文：Some variants are “called”, others may be uncertain and in this case genotype likelihoods are recorded. Variants may also be <em>phased</em>, meaning that it is possible to locate different variant events on a given chromosome.</p>
</blockquote>
<p><code>VariantAnnotation</code> 包定义了处理这种格式的基础工具。<code>Rsamtools</code> 包有一个处理这些文件的tabix索引程序，因此也可以使用这个包。</p>
<h2 id="基因组vcf">*1000基因组VCF</h2>
<p>DNA突变体的一个明显案例就是<a href="http://www.internationalgenome.org/" target="_blank" rel="external">1000 genomes project</a>。Bioconductr的 <code>ldblock</code> 包中有一个工具可以处理VCF文件，它能处理压缩的，由tabix建立索引的VCF文件，这个项目位于Amzon的云上，操作如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ldblock)</div><div class="line">sta = stack1kg()</div><div class="line">sta</div><div class="line"><span class="comment">## VcfStack object with 22 files and 2548 samples</span></div><div class="line"><span class="comment">## Seqinfo object with 22 sequences from an unspecified genome; no seqlengths </span></div><div class="line"><span class="comment">## use 'readVcfStack()' to extract VariantAnnotation VCF.</span></div></pre></td></tr></table></figure>
<p>这里注意一下，创建的基因组标记为<code>b37</code>。这是一个不太寻常的特征，它绑定到了VCF突变体数据中的元数据里，无法被改变。</p>
<p>我们将在此文件中添加有关样本地理来源的信息。正好 <code>ph525x</code> 这个包中就包含这些地理信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ph525x)</div><div class="line">data(sampInfo_1kg)</div><div class="line">rownames(sampInfo_1kg) = sampInfo_1kg[,<span class="number">1</span>]</div><div class="line">cd = sampInfo_1kg[ colnames(sta), ]</div><div class="line">colData(sta) = DataFrame(cd)</div></pre></td></tr></table></figure>
<p>注：这一部分的代码运行出错，经检索后，可能是由于网络问题。</p>
<h2 id="输入并处理vcf数据">输入并处理VCF数据</h2>
<p>现在我们使用 <code>GenomicFiles</code> 包中的 <code>readVcfStack</code> 函数来提取VCF中的储存的内容。我们提取的内容是针对ORMDL3的编码区，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(erma)</div><div class="line">orm = range(genemodel(<span class="string">"ORMDL3"</span>)) <span class="comment"># quick lookup</span></div><div class="line"><span class="comment">## 'select()' returned 1:many mapping between keys and columns</span></div><div class="line">genome(orm) = <span class="string">"b37"</span>  <span class="comment"># must agree with VCF</span></div><div class="line">seqlevelsStyle(orm) = <span class="string">"NCBI"</span>  <span class="comment"># use integer chromosome codes</span></div><div class="line">ormRead = readVcfStack(sta, orm)</div><div class="line">ormRead</div><div class="line"><span class="comment">## class: CollapsedVCF </span></div><div class="line"><span class="comment">## dim: 3 2548 </span></div><div class="line"><span class="comment">## rowRanges(vcf):</span></div><div class="line"><span class="comment">##   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></div><div class="line"><span class="comment">## info(vcf):</span></div><div class="line"><span class="comment">##   DataFrame with 12 columns: AF, AC, NS, AN, EAS_AF, EUR_AF, AFR_AF, AM...</span></div><div class="line"><span class="comment">## info(header(vcf)):</span></div><div class="line"><span class="comment">##              Number Type    Description                                   </span></div><div class="line"><span class="comment">##    AF        A      Float   Estimated allele frequency in the range (0,1) </span></div><div class="line"><span class="comment">##    AC        A      Integer Total number of alternate alleles in called...</span></div><div class="line"><span class="comment">##    NS        1      Integer Number of samples with data                   </span></div><div class="line"><span class="comment">##    AN        1      Integer Total number of alleles in called genotypes   </span></div><div class="line"><span class="comment">##    EAS_AF    A      Float   Allele frequency in the EAS populations cal...</span></div><div class="line"><span class="comment">##    EUR_AF    A      Float   Allele frequency in the EUR populations cal...</span></div><div class="line"><span class="comment">##    AFR_AF    A      Float   Allele frequency in the AFR populations cal...</span></div><div class="line"><span class="comment">##    AMR_AF    A      Float   Allele frequency in the AMR populations cal...</span></div><div class="line"><span class="comment">##    SAS_AF    A      Float   Allele frequency in the SAS populations cal...</span></div><div class="line"><span class="comment">##    VT        .      String  indicates what type of variant the line rep...</span></div><div class="line"><span class="comment">##    EX_TARGET 0      Flag    indicates whether a variant is within the e...</span></div><div class="line"><span class="comment">##    DP        1      Integer Approximate read depth; some reads may have...</span></div><div class="line"><span class="comment">## geno(vcf):</span></div><div class="line"><span class="comment">##   SimpleList of length 1: GT</span></div><div class="line"><span class="comment">## geno(header(vcf)):</span></div><div class="line"><span class="comment">##       Number Type   Description    </span></div><div class="line"><span class="comment">##    GT 1      String Phased Genotype</span></div></pre></td></tr></table></figure>
<p><code>CollapsedVCF</code> 类用于管理输入的基因型数据。现在我们检索3个突变体的信息。我们将得到的结果的子集转换为 <code>VariantTools</code> 所代表的<code>VRanges</code> 形式，从而可以更加清楚地了解到内容，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(VariantTools)</div><div class="line">vr = as(ormRead[,<span class="number">1</span>:<span class="number">5</span>], <span class="string">"VRanges"</span>)</div><div class="line">vr[<span class="number">1</span>:<span class="number">3</span>,]</div><div class="line"><span class="comment">## VRanges object with 3 ranges and 14 metadata columns:</span></div><div class="line"><span class="comment">##                     seqnames            ranges strand         ref</span></div><div class="line"><span class="comment">##                        &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG       17          38078372      *           T</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T       17 38078393-38078395      *         TGG</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT       17          38078398      *           G</span></div><div class="line"><span class="comment">##                                  alt     totalDepth       refDepth</span></div><div class="line"><span class="comment">##                     &lt;characterOrRle&gt; &lt;integerOrRle&gt; &lt;integerOrRle&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG               TG           &lt;NA&gt;           &lt;NA&gt;</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T                T           &lt;NA&gt;           &lt;NA&gt;</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT              GGT           &lt;NA&gt;           &lt;NA&gt;</span></div><div class="line"><span class="comment">##                           altDepth   sampleNames softFilterMatrix |</span></div><div class="line"><span class="comment">##                     &lt;integerOrRle&gt; &lt;factorOrRle&gt;         &lt;matrix&gt; |</span></div><div class="line"><span class="comment">##    17:38078372_T/TG           &lt;NA&gt;       HG00096                  |</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T           &lt;NA&gt;       HG00096                  |</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT           &lt;NA&gt;       HG00096                  |</span></div><div class="line"><span class="comment">##                          QUAL            AF            AC        NS</span></div><div class="line"><span class="comment">##                     &lt;numeric&gt; &lt;NumericList&gt; &lt;IntegerList&gt; &lt;integer&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG      &lt;NA&gt;          0.01            61      2548</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T      &lt;NA&gt;          0.04           191      2548</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT      &lt;NA&gt;          0.05           272      2548</span></div><div class="line"><span class="comment">##                            AN        EAS_AF        EUR_AF        AFR_AF</span></div><div class="line"><span class="comment">##                     &lt;integer&gt; &lt;NumericList&gt; &lt;NumericList&gt; &lt;NumericList&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG      5096             0             0          0.04</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T      5096             0          0.01          0.13</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT      5096          0.01          0.04          0.13</span></div><div class="line"><span class="comment">##                            AMR_AF        SAS_AF              VT EX_TARGET</span></div><div class="line"><span class="comment">##                     &lt;NumericList&gt; &lt;NumericList&gt; &lt;CharacterList&gt; &lt;logical&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG             0             0           INDEL     FALSE</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T          0.01          0.01           INDEL     FALSE</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT          0.02          0.03           INDEL     FALSE</span></div><div class="line"><span class="comment">##                            DP          GT</span></div><div class="line"><span class="comment">##                     &lt;integer&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">##    17:38078372_T/TG    240289         0|0</span></div><div class="line"><span class="comment">##   17:38078393_TGG/T    222931         0|0</span></div><div class="line"><span class="comment">##   17:38078398_G/GGT    218409         0|0</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></div><div class="line"><span class="comment">##   hardFilters: NULL</span></div></pre></td></tr></table></figure>
<p>从上面结果我们可以看出来，我们从VCF中提取了完整的信息，如果要列表出某个人的基因型，可以按下面进行操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">table(vr[which(sampleNames(vr)==<span class="string">"HG00096"</span>),]$GT)</div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## 0|0 </span></div><div class="line"><span class="comment">##   3</span></div></pre></td></tr></table></figure>
<p>总结</p>
<ul>
<li>VCF文件储存队列(cohorts)的突变体信息，并且通过<code>VariantAnnotation</code>包可以导入这样的文件。</li>
<li>染色体特异性的VCF文件可以储存在VcfStack类中。</li>
<li><code>colData</code>可以绑定到VcfStack文件中，并将样本信息与其基因型对应起来。</li>
<li>VariantTools中的VRanges类可以用于生成丰富的元数据表示的单个样本-突变体表格(metadata-rich variant-by-individual tables)。</li>
</ul>
<h1 id="多组学multiassayexperiment以tcga为例说明">多组学：MultiAssayExperiment，以TCGA为例说明</h1>
<p><a href="https://cancergenome.nih.gov/" target="_blank" rel="external">癌基因组计划(The Cancer Genome Atlas)</a> 收集了来自于14000个人的数据，提供了29个不同肿瘤位点的基因组信息。我们可以通过位于CUNY的<a href="http://waldronlab.org/" target="_blank" rel="external">Levi Waldron实验室</a>实验室下载那些关于多型神经胶质细胞瘤的公共数据。Ｒ中的<code>MultiAssayExperiment</code> 类对象已经储存于Amazon S3中，并且<a href="http://tinyurl.com/MAEOurls" target="_blank" rel="external">Goolge表格</a>提供了详细地说明信息与链接。</p>
<h2 id="检索神经胶质细胞瘤数据">检索神经胶质细胞瘤数据</h2>
<p>现在我们来检索一下关于GBM的数据，其些软件可能要使用 <code>updateObject</code>，操作如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(curatedTCGAData)</div><div class="line">gbm = curatedTCGAData(<span class="string">"GBM"</span>, c(<span class="string">"Mutation"</span>, <span class="string">"CNASNP"</span>, <span class="string">"RNASeq2GeneNorm"</span>,</div><div class="line">   <span class="string">"Methylation_methyl27-20160128"</span>), dry.run=<span class="literal">FALSE</span>)</div><div class="line"><span class="comment">## snapshotDate(): 2019-08-13</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## see ?curatedTCGAData and browseVignettes('curatedTCGAData') for documentation</span></div><div class="line"><span class="comment">## downloading 0 resources</span></div><div class="line"><span class="comment">## loading from cache</span></div><div class="line"><span class="comment">## harmonizing input:</span></div><div class="line"><span class="comment">##   removing 6320 sampleMap rows not in names(experiments)</span></div><div class="line"><span class="comment">##   removing 4 colData rownames not in sampleMap 'primary'</span></div><div class="line">gbm</div><div class="line"><span class="comment">## A MultiAssayExperiment object of 3 listed</span></div><div class="line"><span class="comment">##  experiments with user-defined names and respective classes. </span></div><div class="line"><span class="comment">##  Containing an ExperimentList class object of length 3: </span></div><div class="line"><span class="comment">##  [1] GBM_CNASNP-20160128: RaggedExperiment with 602338 rows and 1104 columns </span></div><div class="line"><span class="comment">##  [2] GBM_Mutation-20160128: RaggedExperiment with 22073 rows and 290 columns </span></div><div class="line"><span class="comment">##  [3] GBM_RNASeq2GeneNorm-20160128: SummarizedExperiment with 20501 rows and 166 columns </span></div><div class="line"><span class="comment">## Features: </span></div><div class="line"><span class="comment">##  experiments() - obtain the ExperimentList instance </span></div><div class="line"><span class="comment">##  colData() - the primary/phenotype DataFrame </span></div><div class="line"><span class="comment">##  sampleMap() - the sample availability DataFrame </span></div><div class="line"><span class="comment">##  `$`, `[`, `[[` - extract colData columns, subset, or experiment </span></div><div class="line"><span class="comment">##  *Format() - convert into a long or wide DataFrame </span></div><div class="line"><span class="comment">##  assays() - convert ExperimentList to a SimpleList of matrices</span></div></pre></td></tr></table></figure>
<p>因此，单一的R变量可以用于处理（子集）593个人的3种不同的分析方法。成分分析(Constituent assays)含有ExpressionSet，SummarizedExperiment和RaggedExperiment。<code>RaggedExperiment</code>是它自己的包，可以通过<code>vignette</code>函数来查看使用方法。</p>
<p>为了了解GBM数据的范围和完整性，我们可以使用<code>UpSet</code>图来查看一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">upsetSamples(gbm)</div><div class="line"><span class="comment">## Loading required namespace: UpSetR</span></div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191104094334.png">

</div>
<p>这显示了绝大多数参与者提供的拷贝数变异和基于阵列的表达数据，但是很少有人提供RNA-seq或蛋白质组(PRRA，反相蛋白质组分析)数据。</p>
<h2 id="处理tcga突变数据">处理TCGA突变数据</h2>
<p>突变数据的复杂性为统一描述这种异质性数据提出了基本的挑战，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mut = experiments(gbm)[[<span class="string">"GBM_Mutation-20160128"</span>]]</div><div class="line">mut</div><div class="line"><span class="comment">## class: RaggedExperiment </span></div><div class="line"><span class="comment">## dim: 22073 290 </span></div><div class="line"><span class="comment">## assays(74): Hugo_Symbol Entrez_Gene_Id ... OREGANNO_ID</span></div><div class="line"><span class="comment">##   OREGANNO_Values</span></div><div class="line"><span class="comment">## rownames: NULL</span></div><div class="line"><span class="comment">## colnames(290): TCGA-02-0003-01A-01D-1490-08</span></div><div class="line"><span class="comment">##   TCGA-02-0033-01A-01D-1490-08 ... TCGA-81-5911-01A-12D-1845-08</span></div><div class="line"><span class="comment">##   TCGA-87-5896-01A-01D-1696-08</span></div><div class="line"><span class="comment">## colData names(0):</span></div></pre></td></tr></table></figure>
<p>一个长度为74的向量已经给出了突变的“阵列”(assay)名称。通常意义上来说，这些都不是数组，而是不同个体之间可能存在着的不同突变特征或背景（注：这里的assay理解不清楚，后面理解清楚后再修改，原文已经列出）。</p>
<blockquote>
<p>The names of the ‘assays’ of mutations are given in a vector of length 74. These are not assays in the usual sense, but characteristics or contexts of mutations that may vary between individuals.</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">head(assayNames(mut))</div><div class="line"><span class="comment">## [1] "Hugo_Symbol"            "Entrez_Gene_Id"        </span></div><div class="line"><span class="comment">## [3] "Center"                 "NCBI_Build"            </span></div><div class="line"><span class="comment">## [5] "Variant_Classification" "Variant_Type"</span></div></pre></td></tr></table></figure>
<h3 id="突变的位置和基因关联性">突变的位置和基因关联性</h3>
<p>突变信息包含在了一个<code>GRanges</code>结构中，它记录了突变的坐标，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">rowRanges(mut)</div><div class="line"><span class="comment">## GRanges object with 22073 ranges and 0 metadata columns:</span></div><div class="line"><span class="comment">##           seqnames    ranges strand</span></div><div class="line"><span class="comment">##              &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span></div><div class="line"><span class="comment">##       [1]        1   1430871      +</span></div><div class="line"><span class="comment">##       [2]        1 154148652      +</span></div><div class="line"><span class="comment">##       [3]        1 161206281      +</span></div><div class="line"><span class="comment">##       [4]        1 230846235      +</span></div><div class="line"><span class="comment">##       [5]       10 123810032      +</span></div><div class="line"><span class="comment">##       ...      ...       ...    ...</span></div><div class="line"><span class="comment">##   [22069]        X  77112989      +</span></div><div class="line"><span class="comment">##   [22070]        X 119243159      +</span></div><div class="line"><span class="comment">##   [22071]        X 131348336      +</span></div><div class="line"><span class="comment">##   [22072]        X 138643011      +</span></div><div class="line"><span class="comment">##   [22073]        X 150891145      +</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 24 sequences from 37 genome; no seqlengths</span></div></pre></td></tr></table></figure>
<p>我们来查看一下哪些基因的突变频率最高，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sort(table(assay(mut, <span class="string">"Hugo_Symbol"</span>)), decreasing=<span class="literal">TRUE</span>)[<span class="number">1</span>:<span class="number">6</span>]</div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Unknown     TTN    EGFR    TP53    PTEN   MUC16 </span></div><div class="line"><span class="comment">##     126     121     102     101      93      68</span></div></pre></td></tr></table></figure>
<h3 id="突变类型">突变类型</h3>
<p>我们可以通过表格形式来查看突变类型，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">table(as.character(assay(mut, <span class="string">"Variant_Classification"</span>)))</div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##        Frame_Shift_Del        Frame_Shift_Ins           In_Frame_Del </span></div><div class="line"><span class="comment">##                    566                    217                    214 </span></div><div class="line"><span class="comment">##           In_Frame_Ins      Missense_Mutation      Nonsense_Mutation </span></div><div class="line"><span class="comment">##                     28                  14213                    851 </span></div><div class="line"><span class="comment">##       Nonstop_Mutation                 Silent            Splice_Site </span></div><div class="line"><span class="comment">##                     17                   5514                    382 </span></div><div class="line"><span class="comment">## Translation_Start_Site </span></div><div class="line"><span class="comment">##                     71</span></div></pre></td></tr></table></figure>
<p>哪些基因的碱基的删除导致了移码突变呢？</p>
<p>我们可以使用一个矩阵下标来找到前10个发生移码突变的基因，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sort(table(assay(mut, <span class="string">"Hugo_Symbol"</span>)[assay(mut, <span class="string">"Variant_Classification"</span>)==</div><div class="line">  <span class="string">"Frame_Shift_Del"</span>]),decreasing=<span class="literal">TRUE</span>)[<span class="number">1</span>:<span class="number">10</span>]</div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##    PTEN     NF1    ATRX     RB1   CDC27    TP53     TTN Unknown    CHD8 </span></div><div class="line"><span class="comment">##      16      10       7       7       6       6       4       4       3 </span></div><div class="line"><span class="comment">##    OGDH </span></div><div class="line"><span class="comment">##       3</span></div></pre></td></tr></table></figure>
<p>总结</p>
<ul>
<li>MultiAssayExperiment统一了各种微阵列数据，并收集了一个队列的不同样本信息。</li>
<li>TCGA肿瘤特异性数据集已经被序列化为MultiAssayExperiments ，可以从Amzon S3作为公共数据。</li>
<li>含有复杂注释的异质性数据(Idiosyncratic data)可能通过RaggedAssay结构进行管理；这些结构已经被证明在处理突变和拷贝数变异方面发挥了强大的作用。</li>
</ul>
<h1 id="云端管理策略cgc与gdc概念">云端管理策略：CGC与GDC概念</h1>
<p>在前面部分，我介绍了如何将肿瘤的TCGA数据收集在一个队列对象中，该对象统一管理大量的基因组数据。在这一部分里，我们想说明如何通过单个的R连接对象来访问TCGA的完整数据并用于交互式分析。如果要使用这一部分中的命令，用户需要向由 Institute for Systems Biology管理的Cancer Genomics Cloud 获取权利。可以向[ISB project administrators] (https://www.systemsbiology.org/research/cancer-genomics-cloud/)联系，获取账户。</p>
<p>在下面的代码，我们使用r-db-stats团队维护的<code>bigrquery</code>包来创建一个连接到 <a href="https://cloud.google.com/bigquery/" target="_blank" rel="external">Google BigQuery</a>,的DBI连接。然后我们列出可用的表，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(bigrquery)</div><div class="line"><span class="keyword">library</span>(dplyr)</div><div class="line"><span class="keyword">library</span>(magrittr)</div><div class="line">tcgaCon = DBI::dbConnect(dbi_driver(), project=<span class="string">"isb-cgc"</span>, </div><div class="line">     dataset=<span class="string">"TCGA_hg38_data_v0"</span>, billing = Sys.getenv(<span class="string">"CGC_BILLING"</span>)) </div><div class="line">dbListTables(tcgaCon)</div><div class="line"><span class="comment">##  [1] "Copy_Number_Segment_Masked"  "DNA_Methylation"            </span></div><div class="line"><span class="comment">##  [3] "DNA_Methylation_chr1"        "DNA_Methylation_chr10"      </span></div><div class="line"><span class="comment">##  [5] "DNA_Methylation_chr11"       "DNA_Methylation_chr12"      </span></div><div class="line"><span class="comment">##  [7] "DNA_Methylation_chr13"       "DNA_Methylation_chr14"      </span></div><div class="line"><span class="comment">##  [9] "DNA_Methylation_chr15"       "DNA_Methylation_chr16"      </span></div><div class="line"><span class="comment">## [11] "DNA_Methylation_chr17"       "DNA_Methylation_chr18"      </span></div><div class="line"><span class="comment">## [13] "DNA_Methylation_chr19"       "DNA_Methylation_chr2"       </span></div><div class="line"><span class="comment">## [15] "DNA_Methylation_chr20"       "DNA_Methylation_chr21"      </span></div><div class="line"><span class="comment">## [17] "DNA_Methylation_chr22"       "DNA_Methylation_chr3"       </span></div><div class="line"><span class="comment">## [19] "DNA_Methylation_chr4"        "DNA_Methylation_chr5"       </span></div><div class="line"><span class="comment">## [21] "DNA_Methylation_chr6"        "DNA_Methylation_chr7"       </span></div><div class="line"><span class="comment">## [23] "DNA_Methylation_chr8"        "DNA_Methylation_chr9"       </span></div><div class="line"><span class="comment">## [25] "DNA_Methylation_chrX"        "DNA_Methylation_chrY"       </span></div><div class="line"><span class="comment">## [27] "Protein_Expression"          "RNAseq_Gene_Expression"     </span></div><div class="line"><span class="comment">## [29] "Somatic_Mutation"            "Somatic_Mutation_Jun2017"   </span></div><div class="line"><span class="comment">## [31] "miRNAseq_Expression"         "miRNAseq_Isoform_Expression"</span></div></pre></td></tr></table></figure>
<p>现在我们使用<code>dplyr</code>来对GBM中的突变类型做一个汇总，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">tcgaCon %&gt;% tbl(<span class="string">"Somatic_Mutation"</span>) %&gt;% dplyr::filter(project_short_name==<span class="string">"TCGA-GBM"</span>) %&gt;% </div><div class="line">      dplyr::select(Variant_Classification, Hugo_Symbol) %&gt;% group_by(Variant_Classification) %&gt;%</div><div class="line">      summarise(n=n())</div><div class="line"><span class="comment">## # Source:   lazy query [?? x 2]</span></div><div class="line"><span class="comment">## # Database: BigQueryConnection</span></div><div class="line"><span class="comment">##    Variant_Classification     n</span></div><div class="line"><span class="comment">##                     &lt;chr&gt; &lt;int&gt;</span></div><div class="line"><span class="comment">##  1                  3'UTR  4166</span></div><div class="line"><span class="comment">##  2                 Intron  3451</span></div><div class="line"><span class="comment">##  3                3'Flank   423</span></div><div class="line"><span class="comment">##  4       Nonstop_Mutation    58</span></div><div class="line"><span class="comment">##  5                    IGR     3</span></div><div class="line"><span class="comment">##  6                    RNA  1338</span></div><div class="line"><span class="comment">##  7            Splice_Site   955</span></div><div class="line"><span class="comment">##  8        Frame_Shift_Del  1487</span></div><div class="line"><span class="comment">##  9      Missense_Mutation 53054</span></div><div class="line"><span class="comment">## 10 Translation_Start_Site    60</span></div><div class="line"><span class="comment">## # ... with more rows</span></div></pre></td></tr></table></figure>
<p>这从本质上证明了，我们可以使用单个R变量（在本例中是 <code>tcgaCon</code> ）的操作来查看整个TCGA数据的概念。构成这个操作的基础设施是由Google提供的，但是这种基本思路也可以在其它环境中进行重现。</p>
<p>我们能设想一个类似于 <code>SummarizedExperiment</code> 样的接口来连接这种数据储存的？这是没问题的，可以参考Github上的<code>seByTumor</code> 函数，它位于<code>shwetagopaul92/restfulSE</code> 包（这个包正在进行Bioconductor的评估，不过可以通过Github来进行安装）。</p>
<p>Institute for Systems Biology的癌症基因组去试点项目(Cancer Genomics Cloud pilot instance)的介绍到此为止。其它的云试点项目则是由 <a href="http://www.cancergenomicscloud.org/" target="_blank" rel="external">Seven Bridges Genomics</a> 和 <a href="https://software.broadinstitute.org/firecloud/" target="_blank" rel="external">Broad Institute</a>创建的。这些项目目前正在努力形成一个云端框架，从而整合大量的通用基因组学数据，从而减少基因组学数据的传输。 <a href="https://grants.nih.gov/grants/guide/rfa-files/RFA-HG-17-011.html" target="_blank" rel="external">RFA</a> 提供了非常丰富的信息。</p>
<h1 id="总体总结">总体总结</h1>
<p>我们已经回顾了几个实验案例的基因组数据管理方式，包括这几类：</p>
<ul>
<li>基于微阵列的基因表达检测</li>
<li>基于微阵列的DNA甲基化检测</li>
<li>RNA-seq比对和由此衍生的基因表达测量</li>
<li>全基因组基因分型</li>
<li>肿瘤突变评估</li>
</ul>
<p>数据来源包括：</p>
<ul>
<li>本地文件</li>
<li>机构数据库 (NCBI GEO, EMBL ArrayExpress)</li>
<li>高通量外部数据储存 (HDF5)</li>
<li>云端分布式数据储存 (Google BigQuery or Amazon S3)</li>
</ul>
<p>重要的管理原则包括：</p>
<ul>
<li>统一的正式对象类(ExpressionSet，Summary)中的分析，样本和实验元数据。</li>
<li>当处理一个队列的重叠子集时，要协调分析集的合并 (MultiAssayExperiment)。</li>
<li>在特征过滤或样本过滤对错中的自同态特征。</li>
<li>使用Granges作为查询的基因组坐标的过滤工具。</li>
<li>通过使用关键来源信息（例如构建一个参考基因组）标记对象来检测其一致性。</li>
</ul>
<p>这是一个在分子分析技术、数据存储和检索领域正在进行重大创新的时代。制定基准和支持策略的选择是一个非常有价值但不简单的过程。这一章已经向您介绍了一系列概念和解决方案，其中许多内容已经应用于本课程中要进行讲解的分析案例中。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/dataman2019.html" target="_blank" rel="external">Management of genome-scale data (2019, Bioc 3.9)</a></li>
<li><a href="https://davetang.org/muse/2013/02/22/using-tabix/" target="_blank" rel="external">Using tabix</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/04/Genomics Data Analysis Series/GDAS004-Bioconductor与基因组级数据分析简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/04/Genomics Data Analysis Series/GDAS004-Bioconductor与基因组级数据分析简介/" itemprop="url">GDAS004-Bioconductor与基因组级数据分析简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-04T12:00:00+08:00">
                2019-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,657
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言">前言</h1>
<p>在生命科学研究领域的相关人员，经常使用电子表格来记录和管理实验数据。针对这个问题，我们将会提出一个使用R和Bioconductor管理基因组级实验数据的原则。使用基于R的软件来管理数据似乎并不太常见。通常来说，R仅用于编写程序，构建统计模型。但是，针对复杂生物实验数据的多方面需求这种情况，Bioconductor已经非常着手以统一的方式来详细地注释这些数据。Bioconductor的这种做法可以让我们导入初步分析的结果（例如多个微阵列的扫描结果以及多个测序结果的比对信息），将这些初步的结果与有关实验证的元数据，以及检测的样本信息结合起来，从而将所有的信息都保存在一个R变量中。通过周全的设计该变量的数据结构，程序可以对这些数据进行各种操作，最终获得更加有效的管理和分析环境。</p>
<p>在这一节中，我们会通过一些实验数据来演示一下基本的操作方法，从而，逐步过滤到更加全面的表示方法（</p>
<p>我们将通过对Bioconductor中所表示的实验数据的一些非常基本的表示法，逐步走向更先进的综合表示法，从而理解这种数据操作方法所表现出来的高效率。</p>
<h2 id="案例说明-youtube上有相应视频">案例说明 (Youtube上有相应视频)</h2>
<p>1.0 Distinct components from an experiment.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(GSE5859Subset)</div><div class="line"><span class="keyword">library</span>(Biobase)</div><div class="line">.oldls = ls()</div><div class="line">data(GSE5859Subset)</div><div class="line">.newls = ls()</div></pre></td></tr></table></figure>
<p>我们导入了一个<code>GSE5859Subset</code>的实验数据，现在我们使用 <code>setdiff()</code>函数来比较一下导入前后文件的区别，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">newstuff = setdiff(.newls, .oldls)</div><div class="line">newstuff</div><div class="line"><span class="comment">## [1] "geneAnnotation" "geneExpression" "sampleInfo"</span></div></pre></td></tr></table></figure>
<p>从结果中我们可以发现，当导入了 <code>GSE5859Subset</code>实验数据中，这个数据中含有3个文件。它们3个分别属于不同的类，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cls = lapply(newstuff, <span class="keyword">function</span>(x) class(get(x)))</div><div class="line">names(cls) = newstuff</div><div class="line">cls</div><div class="line"><span class="comment">## $$geneAnnotation</span></div><div class="line"><span class="comment">## [1] "data.frame"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$geneExpression</span></div><div class="line"><span class="comment">## [1] "matrix"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $$sampleInfo</span></div><div class="line"><span class="comment">## [1] "data.frame"</span></div></pre></td></tr></table></figure>
<p>我们可以按照种族绘制绘制出它们不同时间的图形，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boxplot(date~factor(ethnicity), data=sampleInfo, ylab=&quot;chip date&quot;)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_mgt_gsd-lket-1.png" alt="plot of chunk lket">
<p class="caption">plot of chunk lket</p>
</div>
<p>假如我们想查看一下BRCA2在不同种族中的表达情况，我们可以按以下操作进行：</p>
<ul>
<li>我们需要知道<code>geneExpression</code> 这个矩阵中哪一行代表BRCA2的数据，并且我们要知道<code>geneAnnotation</code>哪一列提供了BRCA2的信息（探针名与基因名的对应关系）；</li>
<li>我们需要知道 <code>geneExpression</code> 这个矩阵中的顺序与<code>samkpleInfo</code>是一致的，要知道<code>sampleInfo</code>中的信息与<code>geneExpression</code>中的标签的对应关系。</li>
</ul>
<p>因此，我为了将基因表达矩阵与样本信息联系起来，我们需要对三个数据进行操作（分别为表达矩阵，样本信息，基因注释信息），从而确保这些信息能够匹配起来，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">all.equal(colnames(geneExpression), sampleInfo$filename)</div><div class="line"><span class="comment">## [1] TRUE</span></div><div class="line">all.equal(rownames(geneExpression), geneAnnotation$PROBEID)</div><div class="line"><span class="comment">## [1] TRUE</span></div><div class="line">ind = which(geneAnnotation$SYMBOL==<span class="string">"BRCA2"</span>)</div><div class="line">boxplot(geneExpression[ind,]~sampleInfo$ethnicity, ylab=<span class="string">"BRCA2 by hgfocus"</span>)</div></pre></td></tr></table></figure>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/bioc1_mgt_gsd-dochks-1.png" alt="plot of chunk dochks">
<p class="caption">plot of chunk dochks</p>
</div>
<p>虽然我们绘制出了图形，但是这略微复杂，为了降低操作难度，Bioconductor定义了一个名为<code>ExpressionSet</code>数据结构。</p>
<h3 id="expressionset数据结构">ExpressionSet数据结构</h3>
<p>我们使用简单的命令就能构建起ExpressionSet这种数据结构，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">es1 = ExpressionSet(geneExpression)</div><div class="line">pData(es1) = sampleInfo</div><div class="line">fData(es1) = geneAnnotation</div><div class="line">es1</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 8793 features, 24 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: 107 122 ... 159 (24 total)</span></div><div class="line"><span class="comment">##   varLabels: ethnicity date filename group</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData</span></div><div class="line"><span class="comment">##   featureNames: 1 30 ... 12919 (8793 total)</span></div><div class="line"><span class="comment">##   fvarLabels: PROBEID CHR CHRLOC SYMBOL</span></div><div class="line"><span class="comment">##   fvarMetadata: labelDescription</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">## Annotation:</span></div></pre></td></tr></table></figure>
<p>上面的<code>es</code> 这个单一变量就浓缩了整个实验的数据，将原来的三个数据变为了一个。现在我们使用<code>es1</code>就能直接绘图，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">boxplot(es1$date~es1$ethnicity)</div></pre></td></tr></table></figure>
<p>现在我们已经了解了<code>ExpressionSet</code>容器的设计，你自己也能构建一个ExpressionSet实例。我们将会在下面的实验中，使用一个更加广泛的数据表示方法，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(GSE5859)</div><div class="line">data(GSE5859)</div><div class="line">e</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 8793 features, 208 samples </span></div><div class="line"><span class="comment">##   element names: exprs, se.exprs </span></div><div class="line"><span class="comment">## protocolData</span></div><div class="line"><span class="comment">##   sampleNames: GSM25349.CEL.gz GSM25350.CEL.gz ...</span></div><div class="line"><span class="comment">##     GSM136729.CEL.gz (208 total)</span></div><div class="line"><span class="comment">##   varLabels: ScanDate</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: 1 2 ... 208 (208 total)</span></div><div class="line"><span class="comment">##   varLabels: ethnicity date filename</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData: none</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">## Annotation: hgfocus</span></div></pre></td></tr></table></figure>
<h3 id="元数据管理metadata-management">元数据管理(Metadata management)</h3>
<p>及时地了解关于实验意图和方法的信息非常有用。GSE5859中使用的一些微阵列数据就是类来源于一篇发表于2004年（PubmedID为15269782）的论文。在联网的情况下，我们可以将论文的信息导入R，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(annotate)</div><div class="line">p = pmid2MIAME(<span class="string">"15269782"</span>)</div><div class="line">p</div><div class="line"><span class="comment">## Experiment data</span></div><div class="line"><span class="comment">##   Experimenter name: Morley M </span></div><div class="line"><span class="comment">##   Laboratory: NA </span></div><div class="line"><span class="comment">##   Contact information:  </span></div><div class="line"><span class="comment">##   Title: Genetic analysis of genome-wide variation in human gene expression. </span></div><div class="line"><span class="comment">##   URL:  </span></div><div class="line"><span class="comment">##   PMIDs: 15269782 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   Abstract: A 167 word abstract is available. Use 'abstract' method.</span></div></pre></td></tr></table></figure>
<p>现在查看你R环境中的<code>e</code>变量，使用<code>experimentData(e) &lt;- p</code>后，就能够将PubmedID信息添加到<code>e</code>中。使用<code>experimentData(e)</code>也能发现<code>e</code>中的信息改变了，也含有Pubmed ID信息。</p>
<h1 id="关于expressionset的why与how">关于ExpressionSet的Why与How</h1>
<p>现在我们通过创建以及使用<code>ExpressionSet</code> 实例已经快速了解了这种数据结构的特点。我们现在将要了解一下，为什么要这样设计这种数据结构，以及如何使用这些数据结构。</p>
<p>设计<code>ExpressionSet</code> 这种数据结构的初衷有很多，以下几点最为关键：</p>
<ul>
<li>降低复杂分析，注释以及样本信息编程的难度；</li>
<li>支持特征值（其实就是表达值）和样本信息的简单的过滤；</li>
<li>在将分析数据传递给分析函数时控制内存占用。</li>
</ul>
<p>以上就是为什么要设计ExpressionSet这种数据结构。关于如何使用这种结构，这些内容就要涉及一些设计模式问题，在R中，与面向对象编程相关类被称为S4类。</p>
<h2 id="面向对象编程与s4类">面向对象编程与S4类</h2>
<p>面向对象编程(OOP, Object-oriented programming)是计算机编程一个学科，它有助于降低程序的复杂性和维护要求，并能增强程度的互动性。OOP有着各种解决方式，即使在R中，也可以进行OOP，这就是所谓的S4方法。在R中，OOP的基本思想就是一个对象有些特征：</p>
<ul>
<li>将不同类型的数据集中放到一个统一的结构中，</li>
<li>它被标记为某个正式指定类的成员，并且可以正式地位于相关对象的系统中，</li>
<li>以类特异性方式对泛型方法进行响应。</li>
</ul>
<p>我们可以使用<code>getClass</code>函数查看一个<code>ExpresionSet</code>的类结构，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">getClass(<span class="string">"ExpressionSet"</span>)</div><div class="line"><span class="comment">## Class "ExpressionSet" [package "Biobase"]</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Slots:</span></div><div class="line"><span class="comment">##                                                                </span></div><div class="line"><span class="comment">## Name:      experimentData          assayData          phenoData</span></div><div class="line"><span class="comment">## Class:              MIAME          AssayData AnnotatedDataFrame</span></div><div class="line"><span class="comment">##                                                                </span></div><div class="line"><span class="comment">## Name:         featureData         annotation       protocolData</span></div><div class="line"><span class="comment">## Class: AnnotatedDataFrame          character AnnotatedDataFrame</span></div><div class="line"><span class="comment">##                          </span></div><div class="line"><span class="comment">## Name:   .__classVersion__</span></div><div class="line"><span class="comment">## Class:           Versions</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Extends: </span></div><div class="line"><span class="comment">## Class "eSet", directly</span></div><div class="line"><span class="comment">## Class "VersionedBiobase", by class "eSet", distance 2</span></div><div class="line"><span class="comment">## Class "Versioned", by class "eSet", distance 3</span></div></pre></td></tr></table></figure>
<p>从上面我们可以看到，一共有7个组件定义了该类。只有<code>annoataion</code>这个组件占据了一个单独的R类型，也就是<code>character</code>类型。至于其它的组件，都是S4类的一个实例（或者说是更多的R数据类型）。</p>
<p>举例说明一下，<code>MIAME</code>类的定义如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">getClass(<span class="string">"MIAME"</span>)</div><div class="line"><span class="comment">## Class "MIAME" [package "Biobase"]</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Slots:</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:               name               lab           contact</span></div><div class="line"><span class="comment">## Class:         character         character         character</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:              title          abstract               url</span></div><div class="line"><span class="comment">## Class:         character         character         character</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:          pubMedIds           samples    hybridizations</span></div><div class="line"><span class="comment">## Class:         character              list              list</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:       normControls     preprocessing             other</span></div><div class="line"><span class="comment">## Class:              list              list              list</span></div><div class="line"><span class="comment">##                         </span></div><div class="line"><span class="comment">## Name:  .__classVersion__</span></div><div class="line"><span class="comment">## Class:          Versions</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Extends: </span></div><div class="line"><span class="comment">## Class "MIAxE", directly</span></div><div class="line"><span class="comment">## Class "characterORMIAME", directly</span></div><div class="line"><span class="comment">## Class "Versioned", by class "MIAxE", distance 2</span></div></pre></td></tr></table></figure>
<p>因此，我们可以发现，S4可以让我们定义包含各种信息的新数据结。我们虽然可以使用R中非常通用的列表结构来实现这一目的（就是说实现封装不同信息），但是S4允许我们能保证有新结构的属性，以便为这些结构定义的程序不必“检查”它们正在操作什么。这些检查过程内置在了类系统中。</p>
<h2 id="数据框dataframe-表格数据的增强型结构">数据框(DataFrame): 表格数据的增强型结构</h2>
<p>数据框是R中非常基础的数据结构。Bioconductor中引入了<code>DataFrame</code>类，它可以实现其它一些额外的功能，后面我们会提到。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(S4Vectors)</div><div class="line">sa2 = DataFrame(sampleInfo)</div><div class="line">sa2</div><div class="line"><span class="comment">## DataFrame with 24 rows and 4 columns</span></div><div class="line"><span class="comment">##     ethnicity       date         filename     group</span></div><div class="line"><span class="comment">##      &lt;factor&gt;     &lt;Date&gt;      &lt;character&gt; &lt;numeric&gt;</span></div><div class="line"><span class="comment">## 1         ASN 2005-06-23 GSM136508.CEL.gz         1</span></div><div class="line"><span class="comment">## 2         ASN 2005-06-27 GSM136530.CEL.gz         1</span></div><div class="line"><span class="comment">## 3         ASN 2005-06-27 GSM136517.CEL.gz         1</span></div><div class="line"><span class="comment">## 4         ASN 2005-10-28 GSM136576.CEL.gz         1</span></div><div class="line"><span class="comment">## 5         ASN 2005-10-07 GSM136566.CEL.gz         1</span></div><div class="line"><span class="comment">## ...       ...        ...              ...       ...</span></div><div class="line"><span class="comment">## 20        ASN 2005-06-27 GSM136524.CEL.gz         0</span></div><div class="line"><span class="comment">## 21        ASN 2005-06-23 GSM136514.CEL.gz         0</span></div><div class="line"><span class="comment">## 22        ASN 2005-10-07 GSM136563.CEL.gz         0</span></div><div class="line"><span class="comment">## 23        ASN 2005-10-07 GSM136564.CEL.gz         0</span></div><div class="line"><span class="comment">## 24        ASN 2005-10-07 GSM136572.CEL.gz         0</span></div></pre></td></tr></table></figure>
<p><code>show</code>方法描述顶部和底部的行数据，提供有关列数据类型的信息，并且能够比<code>data.frame</code>数据结构更有效地管理列中的复杂数据类所，下面是类定义：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">getClass(<span class="string">"DataFrame"</span>)</div><div class="line"><span class="comment">## Class "DataFrame" [package "S4Vectors"]</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Slots:</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:           rownames             nrows          listData</span></div><div class="line"><span class="comment">## Class: character_OR_NULL           integer              list</span></div><div class="line"><span class="comment">##                                                             </span></div><div class="line"><span class="comment">## Name:        elementType   elementMetadata          metadata</span></div><div class="line"><span class="comment">## Class:         character DataTable_OR_NULL              list</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Extends: </span></div><div class="line"><span class="comment">## Class "DataTable", directly</span></div><div class="line"><span class="comment">## Class "SimpleList", directly</span></div><div class="line"><span class="comment">## Class "DataTable_OR_NULL", by class "DataTable", distance 2</span></div><div class="line"><span class="comment">## Class "List", by class "SimpleList", distance 2</span></div><div class="line"><span class="comment">## Class "Vector", by class "SimpleList", distance 3</span></div><div class="line"><span class="comment">## Class "Annotated", by class "SimpleList", distance 4</span></div></pre></td></tr></table></figure>
<h2 id="源于多样本ngs数据的成熟数据表示方法">源于多样本NGS数据的成熟数据表示方法</h2>
<p>短读长测序产生了远比微阵列多得多的数据。测序实验也可以通过更加多样化的手段进行分析，因此测序实验能够在不同粒度级别(at various levels of granularity)提供有效的输入。</p>
<p>处理RNA-seq数据的典型流程包括：</p>
<ol style="list-style-type: decimal">
<li>展示每个周期中碱基所调用的色谱（2008年后就不再提供了）；</li>
<li>碱基的读取质量值，它们通常以FASTQ格式进行储存；</li>
<li>通过基因组或转录本比对后，对各个基因统计的结果；</li>
<li>基因组极的多个样本的数据储存，用于推断感兴趣的生物学问题。通常一个样本对应两个FASTQ文件。</li>
</ol>
<h3 id="bioconductor中的bam文件">Bioconductor中的BAM文件</h3>
<p><code>RNAseqData.HNRNPC.bam.chr14</code> 中含有一些BAM文件，这些BAM文件是8个Hela细胞系样本的双端测序数据，其中4个样本通过RNAi的方式敲低了异质核核糖核蛋白C1和C2（hnRNPC,heterogeneous nuclear ribonucleoproteins C1 and C2)。这个家庭的核蛋白参与pre-mRNA的加工。现在我们演示一下，如何从BAM文件中来统计与HNRNPC有关的读长数目(reads count)。</p>
<p>BAM文件储存在<code>RNAseqData.HNRNPC.bam.chr14</code> 包中，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(RNAseqData.HNRNPC.bam.chr14)</div><div class="line">bfp = RNAseqData.HNRNPC.bam.chr14_BAMFILES</div><div class="line">length(bfp)</div><div class="line"><span class="comment">## [1] 8</span></div><div class="line">bfp[<span class="number">1</span>]</div><div class="line"><span class="comment">##                                                                                                                ERR127306 </span></div><div class="line"><span class="comment">## "/Library/Frameworks/R.framework/Versions/3.4/Resources/library/RNAseqData.HNRNPC.bam.chr14/extdata/ERR127306_chr14.bam"</span></div></pre></td></tr></table></figure>
<p>我们使用<code>Rsamtools</code>包以一个变量的形式管理这些信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(Rsamtools)</div><div class="line">bfl = BamFileList(file=bfp)</div><div class="line">bfl</div><div class="line"><span class="comment">## BamFileList of length 8</span></div><div class="line"><span class="comment">## names(8): ERR127306 ERR127307 ERR127308 ... ERR127303 ERR127304 ERR127305</span></div></pre></td></tr></table></figure>
<p>BAM文件包括关于读长(reads)与基因组比对后的有限数量的元数据。这里我们以<code>BamFileList</code>实例来说明一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">seqinfo(bfl)</div><div class="line"><span class="comment">## Seqinfo object with 93 sequences from an unspecified genome:</span></div><div class="line"><span class="comment">##   seqnames              seqlengths isCircular genome</span></div><div class="line"><span class="comment">##   chr1                   249250621       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chr10                  135534747       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chr11                  135006516       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chr11_gl000202_random      40103       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chr12                  133851895       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   ...                          ...        ...    ...</span></div><div class="line"><span class="comment">##   chrUn_gl000247             36422       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chrUn_gl000248             39786       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chrUn_gl000249             38502       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chrX                   155270560       &lt;NA&gt;   &lt;NA&gt;</span></div><div class="line"><span class="comment">##   chrY                    59373566       &lt;NA&gt;   &lt;NA&gt;</span></div></pre></td></tr></table></figure>
<p>我们看到基因”没有指定“，但是我们碰巧知道参考基因组<code>hg19</code>用于进入基因序列的比对。使用<code>[genome(bfl) &lt;- “hg19”</code>可以纠正这点，但是还存在着一个bug。这个bug应该修正一下，以便可以标记使用不同的参考基因组来进行比对或纠正错误，注：这段不太理解，原文如下：</p>
<blockquote>
<p>We see that the genome is “unspecified”, but we happen to know that the reference build ‘hg19’ was used to define the genomic sequence for alignment. [genome(bfl) &lt;- “hg19” should rectify this but at present there is a bug. This should be fixed so that attempts to compare alignments using different references can be flagged or throw errors.]</p>
</blockquote>
<p>为了验证是否成功敲除，我们将检查编码HNRNPC的基因组附近的序列的比对情况。稍后，我们将展示如何使用Bioconductor注释工具获取基因地址；不过这个地址仅用于hg19基因组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hnrnpcLoc = GRanges(<span class="string">"chr14"</span>, IRanges(<span class="number">21677296</span>, <span class="number">21737638</span>))</div><div class="line">hnrnpcLoc</div><div class="line"><span class="comment">## GRanges object with 1 range and 0 metadata columns:</span></div><div class="line"><span class="comment">##       seqnames               ranges strand</span></div><div class="line"><span class="comment">##          &lt;Rle&gt;            &lt;IRanges&gt;  &lt;Rle&gt;</span></div><div class="line"><span class="comment">##   [1]    chr14 [21677296, 21737638]      *</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></div></pre></td></tr></table></figure>
<p>这标识了HNRNPC编码基因为hg19注释的染色体14的区域。评估表达式量化的一种简单方法是使用GenomicAlignmentspackage中的summary izeOverlaps。此计数方法将隐式使用多核计算。</p>
<p>上面的代码标识了14号染色体中编码HNRNPC附近的序列。评估基因表达量化的一种简单方法就是使用<code>GenomicAlignmentspackage</code>包中的<code>summarizeOverlaps</code> 函数，这个计算方法隐式地使用了多核计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(GenomicAlignments)</div><div class="line"><span class="keyword">library</span>(BiocParallel)</div><div class="line">register(SerialParam())</div><div class="line">hnse = summarizeOverlaps(hnrnpcLoc,bfl)</div></pre></td></tr></table></figure>
<h3 id="练习">练习</h3>
<ol style="list-style-type: decimal">
<li>检查<code>hnse</code>中的<code>count</code>组件内容。与HNRNPC敲除相对应的有关量化的指标是什么？</li>
<li>向<code>hnse</code>的<code>colData</code>组件中添加一个变量<code>condition</code>，用于指示敲除株与野生株。</li>
<li>具有后缀306和307的样本是单个对照的技术重复；308和309同样如此。因此使用了6个不同的生物学样本。现在向<code>colData</code>中添加一个变量，用于区别这6个样本。</li>
</ol>
<h2 id="expressionset设计的一些复杂性进阶">ExpressionSet设计的一些复杂性(进阶)</h2>
<p>生物信息学家是在一个不断变化的环境中工作。自Bioconductor建立以来，计算机的容量和通量已经大幅度增加。R语言也性现了很大的变量。在早期的时候，大家都比较注意内存的使用，因为当时在R中，向一个函数传递参数时，会复制内存中的对象， 这种操作比较低效。而“环境”类中的R对象则不会发生复制，这就导致了使用环境来储存大量的数据用于分析。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class(slot(es1, <span class="string">"assayData"</span>))</div><div class="line"><span class="comment">## [1] "environment"</span></div><div class="line">ae = slot(es1, <span class="string">"assayData"</span>)</div><div class="line">ae</div><div class="line"><span class="comment">## &lt;environment: 0x7f813b4dc698&gt;</span></div></pre></td></tr></table></figure>
<p>“环境”是R中一种非常特殊的对象类型，可以将它视为对表达值矩阵引用的容器。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ls(ae)</div><div class="line"><span class="comment">## [1] "exprs"</span></div><div class="line">dim(ae$exprs)</div><div class="line"><span class="comment">## [1] 8793   24</span></div><div class="line">dim(exprs(es1))</div><div class="line"><span class="comment">## [1] 8793   24</span></div><div class="line">object.size(ae)</div><div class="line"><span class="comment">## 56 bytes</span></div><div class="line">object.size(ae$exprs)</div><div class="line"><span class="comment">## 2253824 bytes</span></div></pre></td></tr></table></figure>
<h3 id="练习可选">练习（可选）</h3>
<p>请解释以下运行结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">e1 = new.env()</div><div class="line">l1 = list()</div><div class="line">e1$x = <span class="number">5</span></div><div class="line">l1$x = <span class="number">5</span></div><div class="line">all.equal(e1$x, l1$x)</div><div class="line"><span class="comment">## [1] TRUE</span></div><div class="line">f = <span class="keyword">function</span>(z) &#123;z$x = <span class="number">4</span>; z$x&#125;</div><div class="line">all.equal(f(e1), f(l1))</div><div class="line"><span class="comment">## [1] TRUE</span></div><div class="line">all.equal(e1$x, l1$x)  <span class="comment"># different from before</span></div><div class="line"><span class="comment">## [1] "Mean relative difference: 0.25"</span></div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; e1 = new.env()</div><div class="line">&gt; l1 = list()</div><div class="line">&gt; e1$x = <span class="number">5</span></div><div class="line">&gt; l1$x = <span class="number">5</span></div><div class="line">&gt; all.equal(e1$x, l1$x)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; <span class="comment">## [1] TRUE</span></div><div class="line">&gt; f = <span class="keyword">function</span>(z) &#123;z$x = <span class="number">4</span>; z$x&#125;</div><div class="line">&gt; all.equal(f(e1), f(l1))</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; <span class="comment">## [1] TRUE</span></div><div class="line">&gt; all.equal(e1$x, l1$x)  <span class="comment"># different from before</span></div><div class="line">[<span class="number">1</span>] <span class="string">"Mean relative difference: 0.25"</span></div><div class="line">&gt; <span class="comment">## [1] "Mean relative difference: 0.25"</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/bioc1_mgt_gsd.html" target="_blank" rel="external">Management of genome-scale data</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/03/Genomics Data Analysis Series/GDAS003-Bioconductor与R语言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/Genomics Data Analysis Series/GDAS003-Bioconductor与R语言/" itemprop="url">GDAS003-Bioconductor与基因组级数据分析简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T12:00:00+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,445
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>本篇笔记主要是介绍了Bioconductor与基因组级数据分析的关系。</p>
<h2 id="r语言r包与仓库repositories">R语言，R包与仓库(repositories)</h2>
<p>学习这一系列课程的前提是你已经有了一定的R语言基因。并且我们推荐使用RStudio作为R语言的使用环境。如果你跳过前面的1x-4x部分，直接进入5x，可以先参考一下其它的R语言教程，例如 <a href="http://tryr.codeschool.com/" target="_blank" rel="external">Try R</a> 。</p>
<h2 id="why-r">Why R?</h2>
<p>Bioconductor的基础就是R。使用R有3个原因：</p>
<ul>
<li>许多统计学家与生物统计学家使用R语言，并且他们使用R语言设计了许多算法可以帮助我们理解复杂的实验数据。</li>
<li>R语言有着高度的互操作性(interoperable)，促进了使用其它语言编写软件组件的重用。</li>
<li>R可移植到在各种计算机上的操作系统里(Linux、MacOSX、Windows)，初学者可以使用这些平台中的任一个来学习。</li>
</ul>
<p>总之，R的易用性和在统计学和“数据科学”中扮演着核心角色，因此当生物学家和统计学家面对基因组级的实验数据时，选择R作为处理工具就是自然而然的事情了。Bioconductor项目开始于2001年，自那以后，它就与基因组级生物学中不断增长的数据量和复杂性保持着同步。</p>
<h2 id="函数式面向对象程序设计">函数式面向对象程序设计</h2>
<p>R语言是一种混合了函数式编程与面向对象的混合型语言。</p>
<p>在R中进行函数式编程时，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">square = <span class="keyword">function</span>(x) x^<span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面就是一个典型的函数式编程。我们定义了一个函数<code>square()</code>，它会计算输入的数据字的平方，即<code>^2</code>，例如当我们输入3时，结果就是在R中，所有的计算都是通过函数进行的。</p>
<p>在进行面向对象的编程时，我们所关注的生就是构建数据结构，定义能够操作这些结构化数据的方法。这是一种接近于人正常思维的编程思想。最早出现在20世纪90年代。现在我们以Bioconductor中的一个案例说明一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(Homo.sapiens)</div><div class="line">class(Homo.sapiens)</div><div class="line">methods(class=class(Homo.sapiens))</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(Homo.sapiens)</div><div class="line">&gt; class(Homo.sapiens)</div><div class="line">[<span class="number">1</span>] <span class="string">"OrganismDb"</span></div><div class="line">attr(,<span class="string">"package"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"OrganismDbi"</span></div><div class="line">&gt; methods(class=class(Homo.sapiens))</div><div class="line"> [<span class="number">1</span>] asBED                 asGFF                 cds                   cdsBy                </div><div class="line"> [<span class="number">5</span>] coerce&lt;-              columns               dbconn                dbfile               </div><div class="line"> [<span class="number">9</span>] disjointExons         distance              exons                 exonsBy              </div><div class="line">[<span class="number">13</span>] extractUpstreamSeqs   fiveUTRsByTranscript  genes                 getTxDbIfAvailable   </div><div class="line">[<span class="number">17</span>] intronsByTranscript   isActiveSeq           isActiveSeq&lt;-         keys                 </div><div class="line">[<span class="number">21</span>] keytypes              mapIds                mapToTranscripts      metadata             </div><div class="line">[<span class="number">25</span>] microRNAs             promoters             resources             select               </div><div class="line">[<span class="number">29</span>] selectByRanges        selectRangesById      seqinfo               show                 </div><div class="line">[<span class="number">33</span>] taxonomyId            threeUTRsByTranscript transcripts           transcriptsBy        </div><div class="line">[<span class="number">37</span>] tRNAs                 TxDb                  TxDb&lt;-               </div><div class="line">see <span class="string">'?methods'</span> <span class="keyword">for</span> accessing help and <span class="keyword">source</span> code</div></pre></td></tr></table></figure>
<p>在这个案例中，我们可以看到：</p>
<ol style="list-style-type: decimal">
<li><code>OrganismDb</code>是一个类(<code>class</code>)；</li>
<li><code>Homo.sapiens</code>是<code>OrganismDb</code>这个类的一个实例(instance)；</li>
<li>某个类的所有方法都可以应用到这个类的所有实例中去（<code>methods(class=class(Homo.sapiens))</code>就是查看这个类的方法）；</li>
<li>每个方法的实现是通过R中的函数进行的（我的理解就是，方法其实本质上就是函数）。并且函数的运行依赖于它自身的参数。</li>
</ol>
<p>其中需要特别注意的是juncture(交界区)的方法，即<code>genes</code>，<code>exons</code>，<code>transcripts</code>，这三个方法输出基因组基本组成成分的一些信息。上面我们列出的所有方法都可以应用于<code>OrganismDb</code>类定义的一些实例，也就是一些模式生物，例如小鼠(Mus musculus)，酒酿酵母(S. cerevisiae)和秀丽隐杆线虫(C. elegans)。</p>
<h2 id="r包模块化与持续集成continuous-integration">R包，模块化与持续集成(Continuous* *Integration)</h2>
<p>这一部分在阅读的时候可以跳过。</p>
<h3 id="r包的结构">R包的结构</h3>
<p>我们可以通过编写R代码来用R执行面向对象的函数式编程。一种基本的方法就是创建“脚本”，用于定义数据的导入和分析的基本流程。当脚本以仅定义函数和数据结构的方式编写时，我们就可以将这些脚本打包，从而方便地发布，供其他有类似数据处理问题的用户使用。</p>
<p>R软件的<a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" target="_blank" rel="external">打包协议</a>规定了如何将R和其他语言的源代码与元数据以及文档一起组织起来，以促进简便的测试和发布的流程。例如，它义些文档的包的早期版本具有如下的目录和文件布局：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">├── DESCRIPTION  (文本文件，用于说明提供的元数据，授权信息)</div><div class="line">├── NAMESPACE    (定义输入与输出)</div><div class="line">├── R            (文件夹，包含了一些R代码)</div><div class="line">├── README.md    (可选，Github上的说明内容)</div><div class="line">├── data         (文件夹，含有示例数据)</div><div class="line">├── man          (文件夹，包的详细文档)</div><div class="line">├── tests        (文件夹，正式软件测试代码)</div><div class="line">└── vignettes    (文件夹，含有高质量的文档)</div><div class="line">    ├── biocOv1.Rmd</div><div class="line">    ├── biocOv1.html</div></pre></td></tr></table></figure>
<p>打包协议文档“Writing R Extensions”提供了完整的详细信息。使用R命令 <code>R CMD build [foldername]</code> 将对程度包文件夹的内容进行打包，从而创建可使用<code>R CMD install[archivename]</code> 添加到R安装的文件。不过现在都使用R Studio来完成这些任务。</p>
<h3 id="模块化与包的相互依赖">模块化与包的相互依赖</h3>
<p>打包协议可以帮助我们隔离执行有限操作集的软件，并识别随时间固有变化的程序集合的版本。没有客观的方法来确定一组操作是否适合打包。一些非常有用的包仅执行少量任务，而其他包则具有非常广泛的应用范围。重要的是打包的概念允许软件的模块化。这在两个方面很重要：范围和时间。范围的模块化对于允许并行独立开发解决不同问题的软件工具非常重要。时间上的模块化对于识别行为稳定的软件版本是很重要的。</p>
<h3 id="持续集成测试包的正确性和互操作性">持续集成：测试包的正确性和互操作性</h3>
<p>下列的图片就是开发Bioconductor分支的一个构建报告的<a href="http://bioconductor.org/checkResults/3.6/bioc-LATEST/" target="_blank" rel="external">快照</a>：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20191105142824.png">

</div>
<p>在上面的表格中，一共有6列，其中最后1列标明了“Installed Pkgs”，其中2000表示用于Linux平台，这个数据在不同平台之间有所不同，并且通常会伴随着开发分支的时间而增加。</p>
<h2 id="汇总">汇总</h2>
<p>Bioconductor的核心开发者小组致力于开发数据结构，使用户能够方便地处理基因组和基因组规模的数据。用于设计的结构是为了支持基因组规模生物学实验的主要目标：</p>
<ul>
<li>解析由微阵列或测序仪产生的大规模数据集。</li>
<li>对（相对）原始数据进行预处理，以支持可靠的统计解释。</li>
<li>将分析量化与样本信息数据进行结合，用于检验分子过程和生物体水平特征（例如生长、疾病状态）之间关系的假设。</li>
<li>在本课程里，我们将回顾你可以在自己的研究中用于执行这些相关任务的无明和功能。</li>
</ul>
<h1 id="x的基因前提和概述">5x的基因前提和概述</h1>
<p>你知道如何使用R来操作和分析数据后，并且还对统计建模有不错的理解后。Bioconductor项目就会证明，在进行基因组级规模的计算生物操作时（但非所有），R是一个有效的工具。</p>
<p>将Bioconductor与处理基因组数据的其它软件系统的不同之处在于：</p>
<ul>
<li>使用面向对象的设计理解统一了基因组实验中出现的不同数据类型；</li>
<li>致力于基因组注释的可互操作结构，从核苷酸到人口规模；</li>
<li>发布和开发周期的持续集成原则，在多个广泛使用的计算平台上进行日常测试。我们这个为期四周的模块化学习目标旨在针对基因组规模数据分析的方方面面建立起对该系统使用的专业能力。</li>
</ul>
<p>525.5x课程主要为了四个主要部分，每部分花费一周时间来学习，内容如下：</p>
<ul>
<li>动机和技术：我们为什么要检测，以及如何检测数据，以及我们如何使用R语言来管理数据。</li>
<li>基因组注释：尤其是要注意基因组坐标中的区间（ranges，有的译为“范围”）在识别基因组结构方面的作用。</li>
<li>基因组级数据的预处理概念，重要如何通过Bioconductor来实现。</li>
<li>使用Bioconductor来做基因组级数据的假设检验。</li>
</ul>
<p>Some of the fundamental concepts that distinguish Bioconductor from other software systems addressing genome-scale data are</p>
<p>本章的不同小节将简要描述一下这些概念，以及说明如何进行计算。</p>
<h2 id="动机与技术">动机与技术</h2>
<p>“What we measure and why”这个视频（这个视频位于Youtube上）给出了基本生物过程的示意图，我们可以通过计算来研究这些过程。我们注意到，对有机体的生命过程至关重要的所有蛋白质的编码序列都位于有机体的基因组DNA中。研究生物体之间的差异， 以及生物体内的某些变化（例如肿瘤的发展），通常涉及基因组DNA序列的计算。</p>
<p>Bioconductor提供了处理许多生物体基因组DNA序列的工具。一种处理序列的基本方法计算就是给定一个“参考序列”，然后我们计算另外一条序列与参考序列之间的差异。</p>
<h3 id="参考序列的获取">参考序列的获取</h3>
<p>使用Bioconductor很容易处理人类(Homo sapiens)的参考序列。现在我们来看一下17号染色体，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(BSgenome.Hsapiens.UCSC.hg19)</div><div class="line">Hsapiens$chr17</div><div class="line"><span class="comment">##   81195210-letter "DNAString" instance</span></div><div class="line"><span class="comment">## seq: AAGCTTCTCACCCTGTTCCTGCATAGATAATTGC...GGTGTGGGTGTGGTGTGTGGGTGTGGGTGTGGT</span></div></pre></td></tr></table></figure>
<p>我们注意到：</p>
<ul>
<li>我们通过了一个R包来提供了序列。</li>
<li>包的名称表明了这个是来源于UCSC的参考基因组hg19。</li>
<li>我们使用美元符号 <code>$</code> 提取了染色体的序列。</li>
</ul>
<h3 id="表示dna突变体">表示DNA突变体</h3>
<p>与参考序列有单个偏离的标准表示方法就是使用VCF格式的文件（ <a href="http://samtools.github.io/hts-specs/VCFv4.1.pdf" target="_blank" rel="external">Variant Call Format</a>）。<code>VariantAnnotation</code>包就含有这样一个案例。我们有两个某些DNA突变体的两个高质量表示方法(high-level representations)，即VCF内容中的摘要，以及突变体本身在基因组上的地址，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">fl &lt;- system.file(<span class="string">"extdata"</span>, <span class="string">"ex2.vcf"</span>, package=<span class="string">"VariantAnnotation"</span>) </div><div class="line">vcf &lt;- readVcf(fl, <span class="string">"hg19"</span>)</div><div class="line">vcf</div><div class="line"><span class="comment">## class: CollapsedVCF </span></div><div class="line"><span class="comment">## dim: 5 3 </span></div><div class="line"><span class="comment">## rowRanges(vcf):</span></div><div class="line"><span class="comment">##   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></div><div class="line"><span class="comment">## info(vcf):</span></div><div class="line"><span class="comment">##   DataFrame with 6 columns: NS, DP, AF, AA, DB, H2</span></div><div class="line"><span class="comment">## info(header(vcf)):</span></div><div class="line"><span class="comment">##       Number Type    Description                </span></div><div class="line"><span class="comment">##    NS 1      Integer Number of Samples With Data</span></div><div class="line"><span class="comment">##    DP 1      Integer Total Depth                </span></div><div class="line"><span class="comment">##    AF A      Float   Allele Frequency           </span></div><div class="line"><span class="comment">##    AA 1      String  Ancestral Allele           </span></div><div class="line"><span class="comment">##    DB 0      Flag    dbSNP membership, build 129</span></div><div class="line"><span class="comment">##    H2 0      Flag    HapMap2 membership         </span></div><div class="line"><span class="comment">## geno(vcf):</span></div><div class="line"><span class="comment">##   SimpleList of length 4: GT, GQ, DP, HQ</span></div><div class="line"><span class="comment">## geno(header(vcf)):</span></div><div class="line"><span class="comment">##       Number Type    Description      </span></div><div class="line"><span class="comment">##    GT 1      String  Genotype         </span></div><div class="line"><span class="comment">##    GQ 1      Integer Genotype Quality </span></div><div class="line"><span class="comment">##    DP 1      Integer Read Depth       </span></div><div class="line"><span class="comment">##    HQ 2      Integer Haplotype Quality</span></div><div class="line">rowRanges(vcf)</div><div class="line"><span class="comment">## GRanges object with 5 ranges and 5 metadata columns:</span></div><div class="line"><span class="comment">##                  seqnames             ranges strand | paramRangeID</span></div><div class="line"><span class="comment">##                     &lt;Rle&gt;          &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;factor&gt;</span></div><div class="line"><span class="comment">##        rs6054257       20 [  14370,   14370]      * |         &lt;NA&gt;</span></div><div class="line"><span class="comment">##     20:17330_T/A       20 [  17330,   17330]      * |         &lt;NA&gt;</span></div><div class="line"><span class="comment">##        rs6040355       20 [1110696, 1110696]      * |         &lt;NA&gt;</span></div><div class="line"><span class="comment">##   20:1230237_T/.       20 [1230237, 1230237]      * |         &lt;NA&gt;</span></div><div class="line"><span class="comment">##        microsat1       20 [1234567, 1234569]      * |         &lt;NA&gt;</span></div><div class="line"><span class="comment">##                             REF                ALT      QUAL      FILTER</span></div><div class="line"><span class="comment">##                  &lt;DNAStringSet&gt; &lt;DNAStringSetList&gt; &lt;numeric&gt; &lt;character&gt;</span></div><div class="line"><span class="comment">##        rs6054257              G                  A        29        PASS</span></div><div class="line"><span class="comment">##     20:17330_T/A              T                  A         3         q10</span></div><div class="line"><span class="comment">##        rs6040355              A                G,T        67        PASS</span></div><div class="line"><span class="comment">##   20:1230237_T/.              T                           47        PASS</span></div><div class="line"><span class="comment">##        microsat1            GTC             G,GTCT        50        PASS</span></div><div class="line"><span class="comment">##   -------</span></div><div class="line"><span class="comment">##   seqinfo: 1 sequence from hg19 genome</span></div></pre></td></tr></table></figure>
<p>我们需要注意：</p>
<ul>
<li>演示中的数据已经包含在了包中，它仅用于说明和测试</li>
<li>变量 <code>vcf</code> 向用户简洁地展示了信息</li>
<li>使用<code>rowRanges</code>函数提取了突变体在hg19基因组中的位置，并与标签一同显示</li>
</ul>
<h3 id="检测基因表达">检测基因表达</h3>
<p>我们将以观察模式生物酿酒酵母(Sacchomyces Cerevisiae)中基因表达的检测数值来结束这一部分的讨论。现在我们来看一个实验，这个实验检测了酿酒酵母生殖周期中一系列时间点上的全基因组mRNA丰度。我们会使用R包来管理这些数据，并且我们使用特殊的Bioconductor定义 的数据结构来访问有关的实验和结果信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(yeastCC)</div><div class="line">data(spYCCES)</div><div class="line">spYCCES</div><div class="line"><span class="comment">## ExpressionSet (storageMode: lockedEnvironment)</span></div><div class="line"><span class="comment">## assayData: 6178 features, 77 samples </span></div><div class="line"><span class="comment">##   element names: exprs </span></div><div class="line"><span class="comment">## protocolData: none</span></div><div class="line"><span class="comment">## phenoData</span></div><div class="line"><span class="comment">##   sampleNames: cln3_40 cln3_30 ... elu_390 (77 total)</span></div><div class="line"><span class="comment">##   varLabels: syncmeth time</span></div><div class="line"><span class="comment">##   varMetadata: labelDescription</span></div><div class="line"><span class="comment">## featureData: none</span></div><div class="line"><span class="comment">## experimentData: use 'experimentData(object)'</span></div><div class="line"><span class="comment">##   pubMedIds: 9843569 </span></div><div class="line"><span class="comment">## Annotation:</span></div><div class="line">experimentData(spYCCES)</div><div class="line"><span class="comment">## Experiment data</span></div><div class="line"><span class="comment">##   Experimenter name: Spellman PT </span></div><div class="line"><span class="comment">##   Laboratory: Department of Genetics, Stanford University Medical Center, Stanford, California 94306-5120, USA. </span></div><div class="line"><span class="comment">##   Contact information:  </span></div><div class="line"><span class="comment">##   Title: Comprehensive identification of cell cycle-regulated genes of the yeast Saccharomyces cerevisiae by microarray hybridization. </span></div><div class="line"><span class="comment">##   URL:  </span></div><div class="line"><span class="comment">##   PMIDs: 9843569 </span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   Abstract: A 150 word abstract is available. Use 'abstract' method.</span></div></pre></td></tr></table></figure>
<p>经过一段时间的学习，你就会在接下来的几周内成为这方面的高手，你可以将整个细胞周期中参与调控的基因随时间变化的过程绘制出来。</p>
<div class="figure">
<img src="http://genomicsclass.github.io/book/pages/figure/biointro-lkycc2-1.png" alt="plot of chunk lkycc2">
<p class="caption">plot of chunk lkycc2</p>
</div>
<p>需要注意：</p>
<ul>
<li>关于实验的元数据已经绑定到R包的数据中（通过 <code>experimentData</code>可以可看PubmedID和摘要）；</li>
<li>我们使用简单的语法就能选择这些复杂实验设计中的信息；在这个案例中，我们使用<code>spYCCES[, spYCCES$syncmeth==&quot;alpha&quot;]</code> 就能提取出控制alpha pheromone的基因；</li>
<li>R的绘图工具支持通用的绘图注释与增强功能 (plot annotation and enhancemetn)；</li>
<li>统计模型工具能够直接帮我们区分周期与非周期的基因。</li>
</ul>
<h2 id="结束语">结束语</h2>
<p>你即将学习一些关于基因组结构和检测它们的分子生物学技术的高水平讲座。当你遇到这些概念时，请你记住那些与理解结构以及数据处理过程相关的计算思路与方法。在Bioconductor中找到相应的计算工具，并熟练掌握这些工具。如果你找不到它们，请通知我们，或者是如果满足某些需求的工具不存在，你也可以选择构建它们。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://rafalab.github.io/pages/harvardx.html" target="_blank" rel="external">HarvardX Biomedical Data Science Open Online Training</a></li>
<li><a href="http://genomicsclass.github.io/book/pages/biointro.html" target="_blank" rel="external">Bioconductor for genome-scale data – quick intro</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/02/Genomics Data Analysis Series/GDAS002-Bioconductor备忘录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/02/Genomics Data Analysis Series/GDAS002-Bioconductor备忘录/" itemprop="url">GDAS002-Bioconductor备忘录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-02T12:00:00+08:00">
                2019-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,455
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>这篇笔记的主要内容是关于Bioconductor的一些备忘录(cheat sheet)，作者总结的不错，我就按原文翻译了下来，由于一些知识点并没有学到，因此未翻译，后面学到后，再回头过来翻译。</p>
<h2 id="安装">安装</h2>
<p>安装细节参考http://bioconductor.org/install/，具体代码如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if (!requireNamespace(&quot;BiocManager&quot;))</div><div class="line">    install.packages(&quot;BiocManager&quot;)</div><div class="line">BiocManager::install()</div><div class="line">BiocManager::install(c(&quot;package1&quot;,&quot;package2&quot;)</div><div class="line">BiocManager::valid() # are packages up to date?</div><div class="line"></div><div class="line"># what Bioc version is release right now?</div><div class="line">http://bioconductor.org/bioc-version</div><div class="line"># what Bioc versions are release/devel?</div><div class="line">http://bioconductor.org/js/versions.js</div></pre></td></tr></table></figure>
<h2 id="r语言帮助">R语言帮助</h2>
<p>简单的帮忙如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">?函数名</div><div class="line">?&quot;eSet-class&quot; # 如果要查看类的帮助，需要后缀&apos;-class&apos;</div><div class="line">help(package=&quot;foo&quot;,help_type=&quot;html&quot;) # 使用web浏览器来查看帮助文档</div><div class="line">vignette(&quot;topic&quot;)</div><div class="line">browseVignettes(package=&quot;package&quot;) # 某包的简单案例</div></pre></td></tr></table></figure>
<p>高级用户的帮助功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">functionName # 直接输入函数名（不带括号），则显示函数代码</div><div class="line">getMethod(method,&quot;class&quot;)  # 显示某类的方法代码</div><div class="line">selectMethod(method, &quot;class&quot;) # 查看继承来的方法</div><div class="line">showMethods(classes=&quot;class&quot;) # 显示某类的所有方法show all methods for class</div><div class="line">methods(class=&quot;GRanges&quot;) # 此函数限于R &gt;=3.2</div><div class="line">?&quot;functionName,class-method&quot; # 用于查看S4对象的方法文档</div><div class="line">?&quot;plotMA,data.frame-method&quot; # 需要加载geneplotter包，from library(geneplotter)</div><div class="line">?&quot;method.class&quot; # 查看S3对象的方法 </div><div class="line">?&quot;plot.lm&quot;</div><div class="line">sessionInfo() # 获取R语言版本的相关帮助信息 </div><div class="line">packageVersion(&quot;foo&quot;) # 查看某个包的版本</div></pre></td></tr></table></figure>
<p>Bioconductor相关的论坛： https://support.bioconductor.org</p>
<p>如果你使用的Rstudio，则可以使用<code>?</code>或<code>help</code>来查看帮忙文档，如果使用是命令行模式（例如Linux），则可以使用下面的代码通过浏览器来查看帮助文档（我使用的Rstudio，因此未尝试以下代码）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias rhelp=&quot;Rscript -e &apos;args &lt;- commandArgs(TRUE); help(args[2], package=args[3], help_type=\&quot;html\&quot;); Sys.sleep(5)&apos; --args&quot;</div></pre></td></tr></table></figure>
<h2 id="debugging-r">debugging R</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">traceback() # 查看哪一步导致了R错误 </div><div class="line"># debug a function</div><div class="line">debug(myFunction) # 逐行遍历函数中的代码 </div><div class="line">undebug(myFunction) # 停止debugging</div><div class="line">debugonce(myFunction) # 功能如上，但是不需要undebug()</div><div class="line"># 在写代码的过程中，可以将函数browser()放到一个关系的节点上</div><div class="line"># this plus devtools::load_all() can be useful for programming</div><div class="line"># to jump in function on error:</div><div class="line">options(error=recover)</div><div class="line"># turn that behavior off:</div><div class="line">options(error=NULL)</div><div class="line"># debug, e.g. estimateSizeFactors from DESeq2...</div><div class="line"># debugging an S4 method is more difficult; this gives you a peek inside:</div><div class="line">trace(estimateSizeFactors, browser, exit=browser, signature=&quot;DESeqDataSet&quot;)</div></pre></td></tr></table></figure>
<h2 id="显示某个类的包特异方法">显示某个类的包特异方法</h2>
<p>以下两个段代码实现的功能大致相同：查看特定的某个包中，某个特定类对象的操作方法。给定类的对象的操作方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">intersect(sapply(strsplit(as.character(methods(class=&quot;DESeqDataSet&quot;)), &quot;,&quot;), `[`, 1), ls(&quot;package:DESeq2&quot;))</div><div class="line">sub(&quot;Function: (.*) \\(package .*\\)&quot;,&quot;\\1&quot;,grep(&quot;Function&quot;,showMethods(classes=&quot;DESeqDataSet&quot;, </div><div class="line">    where=getNamespace(&quot;DESeq2&quot;), printTo=FALSE), value=TRUE))</div></pre></td></tr></table></figure>
<h2 id="注释annotations">注释Annotations</h2>
<p>这里需要先更新一下AnnotationHub，现在我们查看一下AnnotationHub的某个案例：</p>
<p>https://master.bioconductor.org/packages/release/bioc/html/AnnotationHub.html</p>
<p>以下代码是如何使用数据库包，以及<code>biomart</code>，先看<a href="http://www.bioconductor.org/packages/release/bioc/html/AnnotationDbi.html" target="_blank" rel="external">AnnotationDbi</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 某用包个注释包</div><div class="line">library(AnnotationDbi)</div><div class="line">library(org.Hs.eg.db) # 这个是人类注释包，即Homo.sapiens</div><div class="line">columns(org.Hs.eg.db)</div><div class="line">keytypes(org.Hs.eg.db) # columns与keytypes返回的结果一样，即有什么样的注释内容</div><div class="line">k &lt;- head(keys(org.Hs.eg.db, keytype=&quot;ENTREZID&quot;))</div><div class="line"></div><div class="line"># 返回一个字符向量（1对1的关系），查看mapIds则可以查看多个选项</div><div class="line">res &lt;- mapIds(org.Hs.eg.db, keys=k, column=&quot;ENSEMBL&quot;, keytype=&quot;ENTREZID&quot;)</div><div class="line"></div><div class="line"># 产生1对多的映射关系 </div><div class="line">res &lt;- select(org.Hs.eg.db, keys=k,</div><div class="line">  columns=c(&quot;ENTREZID&quot;,&quot;ENSEMBL&quot;,&quot;SYMBOL&quot;),</div><div class="line">  keytype=&quot;ENTREZID&quot;)</div></pre></td></tr></table></figure>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/biomaRt.html" target="_blank" rel="external">biomaRt</a></p>
<p>这个包主要用于各种基因ID的转换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 使用biomart包，将一个注释与另外一个注释进行映射</div><div class="line">library(biomaRt)</div><div class="line">m &lt;- useMart(&quot;ensembl&quot;, dataset = &quot;hsapiens_gene_ensembl&quot;)</div><div class="line">map &lt;- getBM(mart = m,</div><div class="line">  attributes = c(&quot;ensembl_gene_id&quot;, &quot;entrezgene&quot;),</div><div class="line">  filters = &quot;ensembl_gene_id&quot;, </div><div class="line">  values = some.ensembl.genes)</div></pre></td></tr></table></figure>
<h2 id="genomicranges包">GenomicRanges包</h2>
<p><a href="http://bioconductor.org/packages/release/bioc/html/GenomicRanges.html" target="_blank" rel="external">GenomicRanges</a>这个包用于分析高通量测序数据，它能有效地表壳与操作基因组注释信息(genomic annotations)与比对结果(alignments)。GenomicRanges包定义了一个通用容器，此容器用于储存与操作基因间隔(genomic intervals)与变量(variables)。在GenomicAlignments包和SummarizedExperiment包中定义了一个更加特殊的容器，GenomicAlignments包中的这个更加特殊的容器可以根据一个参考基因组来表示和操作一些短比对结果(short alignments)，SummarizedExperiment包中容器可以构建一个实验的矩阵样汇总信息。</p>
<p>此包的使用如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">library(GenomicRanges)</div><div class="line">z &lt;- GRanges(&quot;chr1&quot;,IRanges(1000001,1001000),strand=&quot;+&quot;)</div><div class="line">start(z)</div><div class="line">end(z)</div><div class="line">width(z)</div><div class="line">strand(z)</div><div class="line">mcols(z) # the &apos;metadata columns&apos;, any information stored alongside each range</div><div class="line">ranges(z) # gives the IRanges</div><div class="line">seqnames(z) # the chromosomes for each ranges</div><div class="line">seqlevels(z) # the possible chromosomes</div><div class="line">seqlengths(z) # the lengths for each chromosome</div></pre></td></tr></table></figure>
<h3 id="intra-range-methods">Intra-range methods</h3>
<p>不清楚功能，后面补充。</p>
<p>Affects ranges independently</p>
<table>
<thead>
<tr class="header">
<th>function</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>shift</td>
<td>moves left/right</td>
</tr>
<tr class="even">
<td>narrow</td>
<td>narrows by relative position within range</td>
</tr>
<tr class="odd">
<td>resize</td>
<td>resizes to width, fixing start for +, end for -</td>
</tr>
<tr class="even">
<td>flank</td>
<td>returns flanking ranges to the left +, or right -</td>
</tr>
<tr class="odd">
<td>promoters</td>
<td>similar to flank</td>
</tr>
<tr class="even">
<td>restrict</td>
<td>restricts ranges to a start and end position</td>
</tr>
<tr class="odd">
<td>trim</td>
<td>trims out of bound ranges</td>
</tr>
<tr class="even">
<td>+/-</td>
<td>expands/contracts by adding/subtracting fixed amount</td>
</tr>
<tr class="odd">
<td>*</td>
<td>zooms in (positive) or out (negative) by multiples</td>
</tr>
</tbody>
</table>
<h3 id="inter-range-methods">Inter-range methods</h3>
<p>Affects ranges as a group</p>
<table>
<thead>
<tr class="header">
<th>function</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>range</td>
<td>one range, leftmost start to rightmost end</td>
</tr>
<tr class="even">
<td>reduce</td>
<td>cover all positions with only one range</td>
</tr>
<tr class="odd">
<td>gaps</td>
<td>uncovered positions within range</td>
</tr>
<tr class="even">
<td>disjoin</td>
<td>breaks into discrete ranges based on original starts/ends</td>
</tr>
</tbody>
</table>
<h3 id="nearest-methods">Nearest methods</h3>
<p>Given two sets of ranges, <code>x</code> and <code>subject</code>, for each range in <code>x</code>, returns…</p>
<table style="width:100%;">
<colgroup>
<col width="22%">
<col width="77%">
</colgroup>
<thead>
<tr class="header">
<th>function</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>nearest</td>
<td>index of the nearest neighbor range in subject</td>
</tr>
<tr class="even">
<td>precede</td>
<td>index of the range in subject that is directly preceded by the range in x</td>
</tr>
<tr class="odd">
<td>follow</td>
<td>index of the range in subject that is directly followed by the range in x</td>
</tr>
<tr class="even">
<td>distanceToNearest</td>
<td>distances to its nearest neighbor in subject (Hits object)</td>
</tr>
<tr class="odd">
<td>distance</td>
<td>distances to nearest neighbor (integer vector)</td>
</tr>
</tbody>
</table>
<p>A Hits object can be accessed with <code>queryHits</code>, <code>subjectHits</code> and <code>mcols</code> if a distance is associated.</p>
<h3 id="set-methods">set methods</h3>
<p>If <code>y</code> is a GRangesList, then use <code>punion</code>, etc. All functions have default <code>ignore.strand=FALSE</code>, so are strand specific.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">union(x,y) </div><div class="line">intersect(x,y)</div><div class="line">setdiff(x,y)</div></pre></td></tr></table></figure>
<h3 id="overlaps">Overlaps</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x %over% y  # logical vector of which x overlaps any in y</div><div class="line">fo &lt;- findOverlaps(x,y) # returns a Hits object</div><div class="line">queryHits(fo)   # which in x</div><div class="line">subjectHits(fo) # which in y</div></pre></td></tr></table></figure>
<h3 id="seqnames-and-seqlevels">Seqnames and seqlevels</h3>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/GenomicRanges.html" target="_blank" rel="external">GenomicRanges</a> and <a href="http://www.bioconductor.org/packages/release/bioc/html/GenomeInfoDb.html" target="_blank" rel="external">GenomeInfoDb</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gr.sub &lt;- gr[seqlevels(gr) == &quot;chr1&quot;]</div><div class="line">seqlevelsStyle(x) &lt;- &quot;UCSC&quot; # convert to &apos;chr1&apos; style from &quot;NCBI&quot; style &apos;1&apos;</div></pre></td></tr></table></figure>
<h2 id="sequences">Sequences</h2>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/Biostrings.html" target="_blank" rel="external">Biostrings</a>是一个操作序列或序列集的包，简要操作可以参考<a href="http://www.bioconductor.org/packages/release/bioc/vignettes/Biostrings/inst/doc/BiostringsQuickOverview.pdf" target="_blank" rel="external">Biostrings Quick Overview PDF</a>，关于一些物种的，缩写的信息可以参考<a href="http://genomicsclass.github.io/book/pages/annoCheat.html" target="_blank" rel="external">cheat sheet for annotation</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(BSgenome.Hsapiens.UCSC.hg19)</div><div class="line">dnastringset &lt;- getSeq(Hsapiens, granges) # returns a DNAStringSet</div><div class="line"># also Views() for Bioconductor &gt;= 3.1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(Biostrings)</div><div class="line">dnastringset &lt;- readDNAStringSet(&quot;transcripts.fa&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">substr(dnastringset, 1, 10) # to character string</div><div class="line">subseq(dnastringset, 1, 10) # returns DNAStringSet</div><div class="line">Views(dnastringset, 1, 10) # lightweight views into object</div><div class="line">complement(dnastringset)</div><div class="line">reverseComplement(dnastringset)</div><div class="line">matchPattern(&quot;ACGTT&quot;, dnastring) # also countPattern, also works on Hsapiens/genome</div><div class="line">vmatchPattern(&quot;ACGTT&quot;, dnastringset) # also vcountPattern</div><div class="line">letterFrequecy(dnastringset, &quot;CG&quot;) # how many C&apos;s or G&apos;s</div><div class="line"># also letterFrequencyInSlidingView</div><div class="line">alphabetFrequency(dnastringset, as.prob=TRUE)</div><div class="line"># also oligonucleotideFrequency, dinucleotideFrequency, trinucleotideFrequency</div><div class="line"># transcribe/translate for imitating biological processes</div></pre></td></tr></table></figure>
<h2 id="测序数据">测序数据</h2>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/Rsamtools.html" target="_blank" rel="external">Rsamtools</a>中的 <code>scanBam</code> 返回BAM文件中的原始数值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">library(Rsamtools)</div><div class="line">which &lt;- GRanges(&quot;chr1&quot;,IRanges(1000001,1001000))</div><div class="line">what &lt;- c(&quot;rname&quot;,&quot;strand&quot;,&quot;pos&quot;,&quot;qwidth&quot;,&quot;seq&quot;)</div><div class="line">param &lt;- ScanBamParam(which=which, what=what)</div><div class="line"># for more BamFile functions/details see ?BamFile</div><div class="line"># yieldSize for chunk-wise access</div><div class="line">bamfile &lt;- BamFile(&quot;/path/to/file.bam&quot;)</div><div class="line">reads &lt;- scanBam(bamfile, param=param)</div><div class="line">res &lt;- countBam(bamfile, param=param) </div><div class="line"># for more sophisticated counting modes</div><div class="line"># see summarizeOverlaps() below</div><div class="line"></div><div class="line"># quickly check chromosome names</div><div class="line">seqinfo(BamFile(&quot;/path/to/file.bam&quot;))</div><div class="line"></div><div class="line"># DNAStringSet is defined in the Biostrings package</div><div class="line"># see the Biostrings Quick Overview PDF</div><div class="line">dnastringset &lt;- scanFa(fastaFile, param=granges)</div></pre></td></tr></table></figure>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/GenomicAlignments.html" target="_blank" rel="external">GenomicAlignments</a> 返回一个Bioconductor对象(GRanges-based)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(GenomicAlignments)</div><div class="line">ga &lt;- readGAlignments(bamfile) # single-end</div><div class="line">ga &lt;- readGAlignmentPairs(bamfile) # paired-end</div></pre></td></tr></table></figure>
<h2 id="转录本数据库">转录本数据库</h2>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/GenomicFeatures.html" target="_blank" rel="external">GenomicFeatures</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># get a transcript database, which stores exon, trancript, and gene information</div><div class="line">library(GenomicFeatures)</div><div class="line">library(TxDb.Hsapiens.UCSC.hg19.knownGene)</div><div class="line">txdb &lt;- TxDb.Hsapiens.UCSC.hg19.knownGene</div><div class="line"></div><div class="line"># or build a txdb from GTF file (e.g. downloadable from Ensembl FTP site)</div><div class="line">txdb &lt;- makeTranscriptDbFromGFF(&quot;file.GTF&quot;, format=&quot;gtf&quot;)</div><div class="line"></div><div class="line"># or build a txdb from Biomart (however, not as easy to reproduce later)</div><div class="line">txdb &lt;- makeTranscriptDbFromBiomart(biomart = &quot;ensembl&quot;, dataset = &quot;hsapiens_gene_ensembl&quot;)</div><div class="line"></div><div class="line"># in Bioconductor &gt;= 3.1, also makeTxDbFromGRanges</div><div class="line"></div><div class="line"># saving and loading</div><div class="line">saveDb(txdb, file=&quot;txdb.sqlite&quot;)</div><div class="line">loadDb(&quot;txdb.sqlite&quot;)</div><div class="line"></div><div class="line"># extracting information from txdb</div><div class="line">g &lt;- genes(txdb) # GRanges, just start to end, no exon/intron information</div><div class="line">tx &lt;- transcripts(txdb) # GRanges, similar to genes()</div><div class="line">e &lt;- exons(txdb) # GRanges for each exon</div><div class="line">ebg &lt;- exonsBy(txdb, by=&quot;gene&quot;) # exons grouped in a GRangesList by gene</div><div class="line">ebt &lt;- exonsBy(txdb, by=&quot;tx&quot;) # similar but by transcript</div><div class="line"></div><div class="line"># then get the transcript sequence</div><div class="line">txSeq &lt;- extractTranscriptSeqs(Hsapiens, ebt)</div></pre></td></tr></table></figure>
<h2 id="根据范围ranges和实验汇总信息">根据范围(ranges)和实验汇总信息</h2>
<p><code>SummarizedExperiment</code>是高维数据的储存类， 它与<code>GRanges</code>或<code>GRangesList</code>配合使用（使用每个基因外显子的read计数）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">library(GenomicAlignments)</div><div class="line">fls &lt;- list.files(pattern=&quot;*.bam$&quot;)</div><div class="line">library(TxDb.Hsapiens.UCSC.hg19.knownGene)</div><div class="line">txdb &lt;- TxDb.Hsapiens.UCSC.hg19.knownGene</div><div class="line">ebg &lt;- exonsBy(txdb, by=&quot;gene&quot;)</div><div class="line"># see yieldSize argument for restricting memory</div><div class="line">bf &lt;- BamFileList(fls)</div><div class="line">library(BiocParallel)</div><div class="line">register(MulticoreParam(4))</div><div class="line"># lots of options in the man page</div><div class="line"># singleEnd, ignore.strand, inter.features, fragments, etc.</div><div class="line">se &lt;- summarizeOverlaps(ebg, bf)</div><div class="line"></div><div class="line"># operations on SummarizedExperiment</div><div class="line">assay(se) # the counts from summarizeOverlaps</div><div class="line">colData(se)</div><div class="line">rowRanges(se)</div></pre></td></tr></table></figure>
<p><a href="https://combine-lab.github.io/salmon/" target="_blank" rel="external">Salmon</a>是一个定量工具，如果数据占有GC依赖的数据，那么就添加上<code>--gcBias</code>参数，接着使用 <a href="http://bioconductor.org/pacakges/tximport" target="_blank" rel="external">tximport</a>，以下是使用案例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">coldata &lt;- read.table(&quot;samples.txt&quot;)</div><div class="line">rownames(coldata) &lt;- coldata$id</div><div class="line">files &lt;- coldata$files; names(files) &lt;- coldata$id</div><div class="line">txi &lt;- tximport(files, type=&quot;salmon&quot;, tx2gene=tx2gene)</div><div class="line">dds &lt;- DESeqDataSetFromTximport(txi, coldata, ~condition)</div></pre></td></tr></table></figure>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/Rsubread.html" target="_blank" rel="external">Rsubread</a>包中的<code>featureCounts</code>函数也可以用于read计算，速度可能更快。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">library(Rsubread)</div><div class="line">res &lt;- featureCounts(files, annot.ext=&quot;annotation.gtf&quot;,</div><div class="line">  isGTFAnnotationFile=TRUE,</div><div class="line">  GTF.featureType=&quot;exon&quot;,</div><div class="line">  GTF.attrType=&quot;gene_id&quot;)</div><div class="line">res$counts</div></pre></td></tr></table></figure>
<h2 id="rna-seq分析方法">RNA-seq分析方法</h2>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/DESeq2.html" target="_blank" rel="external">DESeq2</a>：My preferred pipeline for DESeq2 users is to start with a lightweight transcript abundance quantifier such as <a href="https://combine-lab.github.io/salmon/" target="_blank" rel="external">Salmon</a> and to use <a href="http://bioconductor.org/packages/tximport" target="_blank" rel="external">tximport</a>, followed by <code>DESeqDataSetFromTximport</code>.</p>
<p>Here, <code>coldata</code> is a <em>data.frame</em> with <code>group</code> as a column.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">library(DESeq2)</div><div class="line"># from tximport</div><div class="line">dds &lt;- DESeqDataSetFromTximport(txi, coldata, ~ group)</div><div class="line"># from SummarizedExperiment</div><div class="line">dds &lt;- DESeqDataSet(se, ~ group)</div><div class="line"># from count matrix</div><div class="line">dds &lt;- DESeqDataSetFromMatrix(counts, coldata, ~ group)</div><div class="line"># minimal filtering helps keep things fast </div><div class="line"># one can set &apos;n&apos; to e.g. min(5, smallest group sample size)</div><div class="line">keep &lt;- rowSums(counts(dds) &gt;= 10) &gt;= n </div><div class="line">dds &lt;- dds[keep,]</div><div class="line">dds &lt;- DESeq(dds)</div><div class="line">res &lt;- results(dds) # no shrinkage of LFC, or:</div><div class="line">res &lt;- lfcShrink(dds, coef = 2, type=&quot;apeglm&quot;) # shrink LFCs</div></pre></td></tr></table></figure>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/edgeR.html" target="_blank" rel="external">edgeR</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># this chunk from the Quick start in the edgeR User Guide</div><div class="line">library(edgeR) </div><div class="line">y &lt;- DGEList(counts=counts,group=group)</div><div class="line">keep &lt;- filterByExpr(y)</div><div class="line">y &lt;- y[keep,]</div><div class="line">y &lt;- calcNormFactors(y)</div><div class="line">design &lt;- model.matrix(~group)</div><div class="line">y &lt;- estimateDisp(y,design)</div><div class="line">fit &lt;- glmFit(y,design)</div><div class="line">lrt &lt;- glmLRT(fit)</div><div class="line">topTags(lrt)</div><div class="line"># or use the QL methods:</div><div class="line">qlfit &lt;- glmQLFit(y,design)</div><div class="line">qlft &lt;- glmQLFTest(qlfit)</div><div class="line">topTags(qlft)</div></pre></td></tr></table></figure>
<p><a href="http://www.bioconductor.org/packages/release/bioc/html/limma.html" target="_blank" rel="external">limma-voom</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">library(limma)</div><div class="line">design &lt;- model.matrix(~ group)</div><div class="line">y &lt;- DGEList(counts)</div><div class="line">keep &lt;- filterByExpr(y)</div><div class="line">y &lt;- y[keep,]</div><div class="line">y &lt;- calcNormFactors(y)</div><div class="line">v &lt;- voom(y,design)</div><div class="line">fit &lt;- lmFit(v,design)</div><div class="line">fit &lt;- eBayes(fit)</div><div class="line">topTable(fit)</div></pre></td></tr></table></figure>
<p>更多有关RNA-seq操作的包可以参考：<a href="http://www.bioconductor.org/packages/release/BiocViews.html#___RNASeq" target="_blank" rel="external">Many more RNA-seq packages</a></p>
<h2 id="表达数据集expression-set">表达数据集Expression set</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">library(Biobase)</div><div class="line">data(sample.ExpressionSet)</div><div class="line">e &lt;- sample.ExpressionSet</div><div class="line">exprs(e)</div><div class="line">pData(e)</div><div class="line">fData(e)</div></pre></td></tr></table></figure>
<h2 id="下载geo数据库">下载GEO数据库</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(GEOquery)</div><div class="line">e &lt;- getGEO(&quot;GSE9514&quot;)</div></pre></td></tr></table></figure>
<h2 id="芯片分析">芯片分析</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">library(affy)</div><div class="line">library(limma)</div><div class="line">phenoData &lt;- read.AnnotatedDataFrame(&quot;sample-description.csv&quot;)</div><div class="line">eset &lt;- justRMA(&quot;/celfile-directory&quot;, phenoData=phenoData)</div><div class="line">design &lt;- model.matrix(~ Disease, pData(eset))</div><div class="line">fit &lt;- lmFit(eset, design)</div><div class="line">efit &lt;- eBayes(fit)</div><div class="line">topTable(efit, coef=2)</div></pre></td></tr></table></figure>
<h2 id="icobra包">iCOBRA包</h2>
<p>iCOBRA包用于计算和可视化排序数据以及二分类匹配后的数据。例如，iCOBRA包的一个典型用途就是用于评估基因表达实验中不同组之间的比较方法，我们可以视之为一个排序问题（评估正确的效应量(effect size)以及按照显著性进行排列的基因），还是一个二分类比较问题（binary assignment problem）（例如将基因分为差异表达和非差异表达）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">library(iCOBRA)</div><div class="line">cd &lt;- COBRAData(pval=pval.df, padj=padj.df, score=score.df, truth=truth.df)</div><div class="line">cp &lt;- calculate_performance(cd, binary_truth = &quot;status&quot;, cont_truth = &quot;logFC&quot;)</div><div class="line">cobraplot &lt;- prepare_data_for_plot(cp)</div><div class="line">plot_fdrtprcurve(cobraplot)</div><div class="line"># interactive shiny app:</div><div class="line">COBRAapp(cd)</div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><p><a href="http://genomicsclass.github.io/book/pages/annoCheat.html" target="_blank" rel="external">Genomic annotation in Bioconductor: Cheat sheet</a></p></li>
<li><p><a href="http://rafalab.github.io/pages/harvardx.html" target="_blank" rel="external">HarvardX Biomedical Data Science Open Online Training</a></p></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/01/Genomics Data Analysis Series/GDAS001-安装Bioconductor与获取帮助/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/01/Genomics Data Analysis Series/GDAS001-安装Bioconductor与获取帮助/" itemprop="url">GDAS001-安装Bioconductor与获取帮助</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-01T12:01:00+08:00">
                2019-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,400
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装bioconductor">安装Bioconductor</h2>
<p>使用以下代码安装Bioconductor，直接粘贴到R的控制台即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">source(&quot;http://bioconductor.org/biocLite.R&quot;)</div><div class="line">biocLite()</div></pre></td></tr></table></figure>
<p>这两行代码会安装核心的Bioconductor包。如果要再安装其它的包，则要使用<code>biocLite()</code>函数，并且使用字符串参数指定包的名称，例如我们安装以下的两个包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">biocLite(c(&quot;genefilter&quot;,&quot;geneplotter&quot;))</div></pre></td></tr></table></figure>
<p>在使用的时候，就跟常规的R包一样了，例如<code>library()</code>加载即可，例如 <code>library(genefilter)</code>。</p>
<h2 id="获取帮助">获取帮助</h2>
<p>R中的帮助函数很多， 如果在命令行中直接输入 <code>help.start()</code> 就能查看R帮助起始页面。</p>
<h2 id="查看函数帮助文档">查看函数帮助文档</h2>
<p>通常情况，使用<code>?</code>后面添加函数名称，回车则可以查看此函数的帮助文档。使用<code>example(函数)</code>则能查看该函数的帮助文档中Examples部分中的案例，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">?mean</div><div class="line">?mad</div><div class="line">example(mad)</div><div class="line">example(boxplot)</div></pre></td></tr></table></figure>
<p>输入函数名称，但不添加任何参数，则显示此函数的所有代码。</p>
<p>在函数的帮助文档中，我们可以看到许多内容，包括关于此函数的描述，用法，参数，细节，参考文献，使用案例等。</p>
<h2 id="包帮助">包帮助</h2>
<p>如果想查看某个包中所有函数的帮助文档，那么此时可以直接查看该函数的包文档，如果想使用Web浏览器来查看这些文档，那么需要添加以下参数（R默认的IDE）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">help(package=&quot;genefilter&quot;, help_type=&quot;html&quot;)</div></pre></td></tr></table></figure>
<p>如果使用的Rstudio，那么上述命令与下面命令的功能是一样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">help(package=&quot;genefilter&quot;)</div></pre></td></tr></table></figure>
<p>一种查看某个包中的有哪些函数的快速方法是使用双冒号<code>::</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(geneplotter)</div><div class="line">geneplotter::</div></pre></td></tr></table></figure>
<h2 id="对象帮助">对象帮助</h2>
<p>如果要在R中查看某个对象的帮助信息，可以按如下操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class(6)</div><div class="line">?numeric</div><div class="line">?&quot;numeric-class&quot;</div></pre></td></tr></table></figure>
<p>不过有的时候，在一些包中，某个构建的函数与此函数构建的对象的帮助文档是一样的，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(Biobase)</div><div class="line">?ExpressionSet</div><div class="line">?&quot;ExpressionSet-class&quot;</div></pre></td></tr></table></figure>
<p>快速查看某个对象的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">methods(class=&quot;ExpressionSet&quot;)</div><div class="line">methods(class=&quot;lm&quot;)</div></pre></td></tr></table></figure>
<p>使用<code>method()</code>函数则能查看由某个类定义的实例的所有方法：</p>
<p>R has good capabilities for self-description. Classes can be formally linked to methods that operate usefully on their instances. The methods available can be listed using the <code>methods</code> function.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">data(sample.ExpressionSet)</div><div class="line">methods(class=class(sample.ExpressionSet))</div><div class="line">##  [1] [                [[               [[&lt;-             $$               </div><div class="line">##  [5] $$&lt;-              abstract         annotation       annotation&lt;-    </div><div class="line">##  [9] as.data.frame    assayData        assayData&lt;-      classVersion    </div><div class="line">## [13] classVersion&lt;-   coerce           combine          description     </div><div class="line">## [17] description&lt;-    dim              dimnames         dimnames&lt;-      </div><div class="line">## [21] dims             esApply          experimentData   experimentData&lt;-</div><div class="line">## [25] exprs            exprs&lt;-          fData            fData&lt;-         </div><div class="line">## [29] featureData      featureData&lt;-    featureNames     featureNames&lt;-  </div><div class="line">## [33] fvarLabels       fvarLabels&lt;-     fvarMetadata     fvarMetadata&lt;-  </div><div class="line">## [37] initialize       isCurrent        isVersioned      KEGG2heatmap    </div><div class="line">## [41] KEGGmnplot       makeDataPackage  Makesense        notes           </div><div class="line">## [45] notes&lt;-          pData            pData&lt;-          phenoData       </div><div class="line">## [49] phenoData&lt;-      preproc          preproc&lt;-        protocolData    </div><div class="line">## [53] protocolData&lt;-   pubMedIds        pubMedIds&lt;-      rowMedians      </div><div class="line">## [57] rowQ             sampleNames      sampleNames&lt;-    show            </div><div class="line">## [61] storageMode      storageMode&lt;-    updateObject     updateObjectTo  </div><div class="line">## [65] varLabels        varLabels&lt;-      varMetadata      varMetadata&lt;-   </div><div class="line">## [69] write.exprs     </div><div class="line">## see &apos;?methods&apos; for accessing help and source code</div></pre></td></tr></table></figure>
<h2 id="源代码">源代码</h2>
<p>You can find the source code for many functions by typing out the name of the function without () and pressing enter.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">read.csv</div><div class="line"><span class="comment">## function (file, header = TRUE, sep = ",", quote = "\\"", dec = ".", </span></div><div class="line"><span class="comment">##     fill = TRUE, comment.char = "", ...) </span></div><div class="line"><span class="comment">## read.table(file = file, header = header, sep = sep, quote = quote, </span></div><div class="line"><span class="comment">##     dec = dec, fill = fill, comment.char = comment.char, ...)</span></div><div class="line"><span class="comment">## &lt;bytecode: 0x7f8e35b19200&gt;</span></div><div class="line"><span class="comment">## &lt;environment: namespace:utils&gt;</span></div></pre></td></tr></table></figure>
<p>我们从上面可以看出来，<code>read.csv()</code>函数只是打包了(wraps)了<code>read.table()</code>函数。</p>
<p>有的时候，你需要指定一个特定的类，才能查看该方法的源代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">plotMA</div><div class="line"><span class="comment">## nonstandardGenericFunction for "plotMA" defined from package "BiocGenerics"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## function (object, ...) </span></div><div class="line"><span class="comment">## &#123;</span></div><div class="line"><span class="comment">##     standardGeneric("plotMA")</span></div><div class="line"><span class="comment">## &#125;</span></div><div class="line"><span class="comment">## &lt;environment: 0x7f8e338381b8&gt;</span></div><div class="line"><span class="comment">## Methods may be defined for arguments: object</span></div><div class="line"><span class="comment">## Use  showMethods("plotMA")  for currently available ones.</span></div><div class="line">showMethods(<span class="string">"plotMA"</span>)</div><div class="line"><span class="comment">## Function: plotMA (package BiocGenerics)</span></div><div class="line"><span class="comment">## object="ANY"</span></div><div class="line"><span class="comment">## object="data.frame"</span></div><div class="line">getMethod(<span class="string">"plotMA"</span>,<span class="string">"data.frame"</span>)</div><div class="line"><span class="comment">## Method Definition:</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## function (object, ...) </span></div><div class="line"><span class="comment">## &#123;</span></div><div class="line"><span class="comment">##     .local &lt;- function (object, ylim = NULL, colNonSig = "gray32", </span></div><div class="line"><span class="comment">##         colSig = "red3", colLine = "#ff000080", log = "x", cex = 0.45, </span></div><div class="line"><span class="comment">##         xlab = "mean expression", ylab = "log fold change", ...) </span></div><div class="line"><span class="comment">##     &#123;</span></div><div class="line"><span class="comment">##         if (!(ncol(object) == 3 &amp; inherits(object[[1]], "numeric") &amp; </span></div><div class="line"><span class="comment">##             inherits(object[[2]], "numeric") &amp; inherits(object[[3]], </span></div><div class="line"><span class="comment">##             "logical"))) &#123;</span></div><div class="line"><span class="comment">##             stop("When called with a data.frame, plotMA expects the data frame to have 3 columns, two numeric ones for mean and log fold change, and a logical one for significance.")</span></div><div class="line"><span class="comment">##         &#125;</span></div><div class="line"><span class="comment">##         colnames(object) &lt;- c("mean", "lfc", "sig")</span></div><div class="line"><span class="comment">##         object = subset(object, mean != 0)</span></div><div class="line"><span class="comment">##         py = object$lfc</span></div><div class="line"><span class="comment">##         if (is.null(ylim)) </span></div><div class="line"><span class="comment">##             ylim = c(-1, 1) * quantile(abs(py[is.finite(py)]), </span></div><div class="line"><span class="comment">##                 probs = 0.99) * 1.1</span></div><div class="line"><span class="comment">##         plot(object$mean, pmax(ylim[1], pmin(ylim[2], py)), log = log, </span></div><div class="line"><span class="comment">##             pch = ifelse(py &lt; ylim[1], 6, ifelse(py &gt; ylim[2], </span></div><div class="line"><span class="comment">##                 2, 16)), cex = cex, col = ifelse(object$sig, </span></div><div class="line"><span class="comment">##                 colSig, colNonSig), xlab = xlab, ylab = ylab, </span></div><div class="line"><span class="comment">##             ylim = ylim, ...)</span></div><div class="line"><span class="comment">##         abline(h = 0, lwd = 4, col = colLine)</span></div><div class="line"><span class="comment">##     &#125;</span></div><div class="line"><span class="comment">##     .local(object, ...)</span></div><div class="line"><span class="comment">## &#125;</span></div><div class="line"><span class="comment">## &lt;environment: namespace:geneplotter&gt;</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## Signatures:</span></div><div class="line"><span class="comment">##         object      </span></div><div class="line"><span class="comment">## target  "data.frame"</span></div><div class="line"><span class="comment">## defined "data.frame"</span></div></pre></td></tr></table></figure>
<h2 id="简要案例vignettes">简要案例Vignettes</h2>
<p>“Vignettes”包含在R包中，并且是Bioconductor包的标准组件之一。这个函数通常会通过“块”代码的形式，来显示此包中函数的使用案例。</p>
<p>在Bioconductor的官网有PDF格式或R代码的Vignettes。此外，通过在R中来调用vignette能够保证正在使用的包的正确版本。以下代码就是列出某个特定包的vignettes名字，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vignette(package=&quot;Biobase&quot;)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Vignettes <span class="keyword">in</span> package ‘Biobase’:</div><div class="line"></div><div class="line">ExpressionSetIntroduction</div><div class="line">                  An introduction to Biobase and</div><div class="line">                  ExpressionSets (<span class="keyword">source</span>, pdf)</div><div class="line">esApply           esApply Introduction (<span class="keyword">source</span>, pdf)</div><div class="line">BiobaseDevelopment</div><div class="line">                  Notes <span class="keyword">for</span> eSet developers (<span class="keyword">source</span>,</div><div class="line">                  pdf)</div></pre></td></tr></table></figure>
<p>进行一步调用 <code>vignette</code> 能够浏览PDF格式的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vignette(&quot;ExpressionSetIntroduction&quot;)</div></pre></td></tr></table></figure>
<p>也可以使用Web浏览器的方式来查看vignette，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">browseVignettes(package=&quot;Biobase&quot;)</div></pre></td></tr></table></figure>
<h2 id="分析帮助">分析帮助</h2>
<p><a href="http://www.bioconductor.org/help/workflows/" target="_blank" rel="external">workflows repository</a> 这个库中包含了大量的可计算文档(computable documents)，以及描述了如何执行某些常见的分析，这些数据来源于已经发布的数据。</p>
<h2 id="总结">总结</h2>
<ul>
<li>Bioconductor上的所有R函数都有自己的文档，以及运行案例；</li>
<li>所有的Bioconductor包都有自己的vignettes，它描述了该包中的函数如何配合使用，并且是如何实现包的目标；</li>
<li>Bioconductor包含许多workflow documents，我们可以通过这些工作流程文档来进行学习；</li>
<li>R内置了许多基础函数用于完成基础的统计分析；</li>
<li>R’s <a href="https://stat.ethz.ch/mailman/listinfo/r-help" target="_blank" rel="external">mailing list for elementary questions</a> 与Bioconductor’s <a href="https://support.bioconductor.org/" target="_blank" rel="external">support site</a> 上含有非常多的信息，可以用于进一步的学习。</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="http://genomicsclass.github.io/book/pages/installing_Bioconductor_finding_help.html" target="_blank" rel="external">Installing Bioconductor and finding help</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2019/09/01/Genomics Data Analysis Series/GDAS000-基因组数据分析系列笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/01/Genomics Data Analysis Series/GDAS000-基因组数据分析系列笔记/" itemprop="url">GDAS000-基因组数据分析系列笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-01T12:00:00+08:00">
                2019-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Genomics-Data-Analysis-Series/" itemprop="url" rel="index">
                    <span itemprop="name">Genomics Data Analysis Series</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  385
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言">前言</h2>
<p>以前在网上看到了哈佛大学的<a href="http://genomicsclass.github.io/book/" target="_blank" rel="external">PH525x系列课程</a>，这个系列教程主要是生物信息学相关的内容，一共是17章。这17章内容可以大致分为三部分。</p>
<p>第一部分：第1章到10章主要是讲的与生物信息学有关的统计学基础，参考书是《Data Analysis for the life sciences》，<a href="http://rvdsd.top/categories/Data-Analysis-for-the-life-sciences/">第1章到第10章</a>的笔记已经做完。</p>
<p>第二部分：第11章到第17章，涉及生物信息学的应用部分，例如Bioconductor上的几个包使用等，根据官网信息，这部分是《Genomics Data Analysis Series》，本来是想按照<a href="http://genomicsclass.github.io/book/" target="_blank" rel="external">PH525x series - Biomedical Data Science</a> 这个系列课程的目录来做笔记的，但是这里面的顺序并不太好，有部分重复，后来又发现了<a href="http://rafalab.github.io/pages/harvardx.html" target="_blank" rel="external">HarvardX Biomedical Data Science Open Online Training的课程目录</a>，这个就比较友好了，里面有视频，也有代码。因此就按后者的顺序来做笔记。</p>
<p>第三部分：一些使用案例，内容是《Using Python for Research》，这个后面也会有笔记。</p>
<h2 id="主要内容">主要内容</h2>
<p>基因组数据分析系列笔记主要分为以下几部分：</p>
<h3 id="第一部分bioconductor介绍">第一部分：Bioconductor介绍</h3>
<p>这一部分涉及Bioconductor的基本情况，包括注释，基因组分析与基因分析（Introduction to Bioconductor: Annotation and Analysis of Genomes and Genomic Assays，注：我是区别不了Analysis of Genomes与Genomic Assays）。</p>
<h3 id="第二部分使用biconducotor重现高通量数据的分析结果">第二部分：使用Biconducotor重现高通量数据的分析结果</h3>
<h3 id="第三部分功能基因组的案例分析">第三部分：功能基因组的案例分析</h3>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">118</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:0px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共988.9k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
