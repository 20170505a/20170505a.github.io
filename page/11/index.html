<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/11/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/11/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习过程中的输出</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/28/Literature/文献笔记-巨噬细胞/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/28/Literature/文献笔记-巨噬细胞/" itemprop="url">巨噬细胞笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-28T12:00:00+08:00">
                2017-06-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/文献笔记/" itemprop="url" rel="index">
                    <span itemprop="name">文献笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  980
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是巨噬细胞？"><a href="#什么是巨噬细胞？" class="headerlink" title="什么是巨噬细胞？"></a>什么是巨噬细胞？</h2><p>答：</p>
<p>主要文献信息：<br>Ginhoux, F., et al. (2016). “New insights into the multidimensional concept of macrophage ontogeny, activation and function.” Nat Immunol 17(1): 34-40.</p>
<h2 id="巨噬细胞分类"><a href="#巨噬细胞分类" class="headerlink" title="巨噬细胞分类"></a>巨噬细胞分类</h2><p>经典活化型：LPS与IFN-gamma的刺激会诱导一个炎症表型，它能促进TH1应答，有抗菌，抗肿瘤的特性。这种表型称为“经典活化型”，即M1型（classically activated macrophage）。Adams,  D.O.  &amp;  Hamilton,  T.A.  The  cell  biology  of  macrophage  activation.  Annu. Rev. Immunol. 2, 283–318 (1984).</p>
<p>替代活化型巨噬细胞：IL-4或IL-13刺激，特征是产生促炎细胞因子，偏向精氨酸代谢为鸟氨酸（ornithine），表达精氨酸酶，清道夫受体表达增加，吞噬活性增强。即M2型。Stein,  M.,  Keshav,  S.,  Harris,  N.  &amp;  Gordon,  S.  Interleukin  4  potently  enhances murine macrophage mannose receptor activity: a marker of alternative immunologic macrophage activation. J. Exp. Med. 176, 287–292 (1992).</p>
<h2 id="小鼠品系差异"><a href="#小鼠品系差异" class="headerlink" title="小鼠品系差异"></a>小鼠品系差异</h2><p>C57BL/6小鼠的巨噬细胞经LPS刺激后可以将精氨酸代谢为NO，在LPS与IFN-gamma处理后表现出TH1样细胞因子的应答。BALB/c小鼠的巨噬细胞偏向于TH2应答，它将精氨酸代谢为鸟氨酸。因此巨噬细胞分为M1型和M2型。Mills, C.D., Kincaid, K., Alt, J.M., Heilman, M.J. &amp; Hill, A.M. M-1/M-2 macrophages and the Th1/Th2 paradigm. J. Immunol. 164, 6166–6173 (2000).这样划分主要是依照TH1和TH2细胞的应答进行的。</p>
<h2 id="M2细胞的严密划分"><a href="#M2细胞的严密划分" class="headerlink" title="M2细胞的严密划分"></a>M2细胞的严密划分</h2><p>M2细胞红抗炎因子现后表现出一些精密的不同，因此可以进一步划分，即M2a（由IL-4或IL-13诱导），M2b（IL-10诱导），M2c（免疫复合物与LPS诱导）。 Mantovani,  A.  et  al.  The  chemokine  system  in  diverse  forms  of  macrophage<br>activation and polarization. Trends Immunol. 25, 677–686 (2004).</p>
<h2 id="M1-M2划分的不足"><a href="#M1-M2划分的不足" class="headerlink" title="M1-M2划分的不足"></a>M1-M2划分的不足</h2><p>某些疾病中的巨噬细胞不明确地表现出M1和M2表型。<strong>(1)</strong> Egawa, M. et al. Inflammatory monocytes recruited to allergic skin acquire an anti-inflammatory  M2  phenotype  via  basophil-derived  interleukin-4.  Immunity  38, 570–580 (2013).<strong>(2)</strong>Arnold,  L.  et  al.  Inflammatory  monocytes  recruited  after  skeletal  muscle  injury switch  into  antiinflammatory  macrophages  to  support  myogenesis.  J.  Exp.  Med. 204, 1057–1069 (2007).<strong>(3)</strong>Nahrendorf,  M.  &amp;  Swirski,  F.K.  Monocyte  and  macrophage  heterogeneity  in  the heart. Circ. Res. 112, 1624–1633 (2013).</p>
<p>巨噬细胞的微环境决定了巨噬细胞的表型。</p>
<p>除了以下的情况以外，单核细胞不会参与组织巨噬细胞的稳态：肠道，皮肤，心脏（在这三个地方，单核细胞会分化为巨噬细胞）。<strong>(1)</strong>Bain, C.C. et al. Constant replenishment from circulating monocytes maintains the macrophage  pool  in  the  intestine  of  adult  mice.  Nat.  Immunol.  15,  929–937 (2014).<strong>(2)</strong>Tamoutounour, S. et al. Origins and functional specialization of macrophages and of conventional and monocyte-derived dendritic cells in mouse skin. Immunity 39,925–938 (2013).<strong>(3)</strong>Epelman, S. et al. Embryonic and adult-derived resident cardiac macrophages are maintained through distinct mechanisms at steady state and during inflammation. Immunity 40, 91–104 (2014).<br>在一些炎症中，源于胚胎祖细胞的巨噬细胞可以自我更新。 Ginhoux, F. &amp; Jung, S. Monocytes and macrophages: developmental pathways and tissue homeostasis. Nat. Rev. Immunol. 14, 392–404 (2014).</p>
<h2 id="巨噬细胞起源"><a href="#巨噬细胞起源" class="headerlink" title="巨噬细胞起源"></a>巨噬细胞起源</h2><p>参见fig.1<img src="http://ortxpw68f.bkt.clouddn.com/macrophage.png" alt=""></p>
<p>巨噬细胞起源有：（1）</p>
<h2 id="巨噬细胞与感染"><a href="#巨噬细胞与感染" class="headerlink" title="巨噬细胞与感染"></a>巨噬细胞与感染</h2><p>在细菌感染过程中，单核细胞（monocytes）会补充Kupffer细胞的丢失</p>
<p>文献：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Molawi, K. <span class="keyword">and</span> M. H. Sieweke (<span class="number">2015</span>). <span class="string">"Monocytes compensate Kupffer cell loss during bacterial infection."</span> Immunity <span class="number">42</span>(<span class="number">1</span>): <span class="number">10</span><span class="number">-12.</span></div></pre></td></tr></table></figure>
<p>细菌感染会导致Kupffer的坏死性坏死（necroptosis），它会被单细胞来源的巨噬细胞替换。巨噬细胞是髓系细胞的天然免疫细胞，在胚胎形成过程中，大多数驻留组织巨噬细胞会增多，它们会一直持续到成人时期（Gentek, R., Molawi, K., and Sieweke, M.H. (2014).Immunol. Rev. 262 , 56–73.）。但组织中巨噬细胞也会被单核细胞来源的巨噬细胞取代，心脏中的巨噬细胞就是这样，而小肠中的巨噬细胞则不太容易被取代。Ble´ riot, C., Dupuis, T., Jouvion, G., Eberl, G., Dis-<br>son, O., and Lecuit, M. (2015). Immunity 42 , this issue, 145–158.LM感染过程中，M-CSFR与IL-4信号是刺激巨噬细胞增殖的外部信号。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/28/Literature/文献笔记-中性粒细胞/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/28/Literature/文献笔记-中性粒细胞/" itemprop="url">中性粒细胞笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-28T12:00:00+08:00">
                2017-06-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/文献笔记/" itemprop="url" rel="index">
                    <span itemprop="name">文献笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,675
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="中性粒细胞背景"><a href="#中性粒细胞背景" class="headerlink" title="中性粒细胞背景"></a>中性粒细胞背景</h2><p>中性粒细胞（neutrophils）是循环中白细胞中最非常的细胞。19世纪晚期，Paul Ehrlich用新发明的细胞染色方法研究白细胞（leukocytes）中的亚群，他发现白细胞中存在着一些亚群，其中的一类他称为“多型核细胞”（polymorphous nucleus），即中性粒细胞。</p>
<h2 id="中性粒细胞特征"><a href="#中性粒细胞特征" class="headerlink" title="中性粒细胞特征"></a>中性粒细胞特征</h2><ol>
<li>细胞核呈多核；</li>
<li>含有颗粒状的细胞质，里面含有抗菌物质。</li>
<li>细胞数量：小鼠循环血液中占30%，人类的则占70%.</li>
</ol>
<h2 id="活化"><a href="#活化" class="headerlink" title="活化"></a>活化</h2><p>炎症部位，细菌来源的物质以及宿主产生的炎症信号非常丰富。这些物质及信号包括LPS，fMLP，TNF-alpha，IL-1beta，IL-17会促进内皮细胞产生黏附因子（adhesion），即P-选择素，E-选择素，一些整合素家族的成员（ICAMs）。中性粒细胞表面有两个分子：PSGL-1，L-选择素，这两个分子可以识别内皮细胞的炎症信号，一旦中性粒细胞与内皮细胞随机接触，这两个物质就分别与P选择素和E选择素结合，将中性粒细胞固定在内皮表面。接着中性粒细胞会在内皮表面进行翻滚。</p>
<p>PSGL-1和L-选择素的接触会诱导各种激酶的活化，包括Src家族汽配Syk，还有PI3K，以及p3丝裂原激活蛋白激酶，这种级联反应会改变中性粒细胞的生物学特征，并使细胞进入整合素活化阶段，产生更牢固的黏附。</p>
<p>牢固结合的阶段是由beta2整合素家族蛋白介导的（LFA-a和Mac-1），牢固结合之后就是跨内皮细胞的迁移。随着中性粒细胞在内皮上的翻滚，加上趋化因子，细胞因子，细胞产物的作用，中性粒细胞表面的beta2整合素开始聚合，它的配体是ICAM-1。之后，中性粒细胞产生尖锐边缘的片足，趋化因子受体和吞噬受体会在片足上集合，细胞骨架会重构，向着趋化因子浓度梯度的方向进行迁移，从而诱发中性粒细胞的氧爆作用(oxidative burst)。</p>
<p>中性粒细胞的招募示意图如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/Neutrophil%20recruitment%20to%20sites%20of%20in%EF%AC%82ammation..png" alt=""><br>NET为neutrophil extracellular traps。</p>
<h2 id="中性粒细胞的杀菌物质"><a href="#中性粒细胞的杀菌物质" class="headerlink" title="中性粒细胞的杀菌物质"></a>中性粒细胞的杀菌物质</h2><p>三种颗粒：</p>
<ol>
<li>Azurophilic granules (嗜天青颗粒，也称为as peroxidase-positive或primary granules) ，尺寸最大，直径约为0.3 μM，这是中性粒细胞成熟中最先生成的颗粒，含有 myeloperoxidase (MPO)。</li>
<li>specific颗粒</li>
<li>gelatinase颗粒。</li>
<li><img src="http://ortxpw68f.bkt.clouddn.com/Neutrophil%20granules..png" alt=""></li>
</ol>
<h2 id="中性粒细胞的分离"><a href="#中性粒细胞的分离" class="headerlink" title="中性粒细胞的分离"></a>中性粒细胞的分离</h2><p>根据中性粒细胞的来源（外周血，骨髓，腹腔），中性粒细胞的分离有三种方法：</p>
<h3 id="从骨髓中分离中性粒细胞"><a href="#从骨髓中分离中性粒细胞" class="headerlink" title="从骨髓中分离中性粒细胞"></a>从骨髓中分离中性粒细胞</h3><h4 id="实验原理"><a href="#实验原理" class="headerlink" title="实验原理"></a>实验原理</h4><p>Histopaque主要由葡聚糖、泛影葡胺钠组成，并调整成不同的密度，利用密度梯度离心或双重梯度离心技术，从人、大鼠、小鼠或其他小型哺乳动物全血中分离纯化单核细胞、淋巴细胞和粒细胞等。</p>
<h4 id="实验材料与试剂"><a href="#实验材料与试剂" class="headerlink" title="实验材料与试剂"></a>实验材料与试剂</h4><ol>
<li>Histopaque 1077（密度梯度离心液，Sigma- Aldrich, catalog number: 10771 ; MP Biomedicals, catalog number: 091692254，这个型号是1077）</li>
<li>Histopaque 1119</li>
<li>无菌PBS（HBSS或Hanks液）</li>
<li>离心机</li>
<li>双抗</li>
<li>1640培养基</li>
<li>剪刀，15cm离心管</li>
</ol>
<h4 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h4><ol>
<li>处死小鼠，取出小鼠的股骨和胫骨；</li>
<li>放75%的酒精中消毒，随后再放入无菌PBS冲掉多余的酒精；</li>
<li>剪掉骨头的一头，用PBS冲洗骨头，冲洗三次；</li>
<li>四摄氏度，2000rmp离心5分钟，去掉上清；</li>
<li>用2mL的无菌PBS重悬；</li>
<li>在15mL的离心管底部中加入3mL的Histopaque 1119；</li>
<li>其次，缓慢加入3mL的Histopaque 1077；</li>
<li>最后，缓慢将2mL的细胞悬液加入到Histopaque 1-77的上层；</li>
<li>2000rpm，no brake,no accelerate，4摄氏度，离心30分钟；</li>
<li>在 Histopaque 1119和Histopaque 1077界面处取白色层的细胞；</li>
<li>用加入了双抗的1640培养基冲洗1次（1400rpm，7min，4摄氏度）；</li>
<li>取合适量细胞流式染色Ly-6G和CD11b；</li>
<li>30min后清洗细胞，上机检测细胞纯度。<br>Histopaque的加入分层如下图右图所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/Histopaque.png" alt=""></li>
</ol>
<h3 id="外周血中性粒细胞的分离"><a href="#外周血中性粒细胞的分离" class="headerlink" title="外周血中性粒细胞的分离"></a>外周血中性粒细胞的分离</h3><h4 id="实验步骤-1"><a href="#实验步骤-1" class="headerlink" title="实验步骤"></a>实验步骤</h4><ol>
<li>收集4mL的PMBC，加入肝素化的试管中；</li>
<li>在15mL的离心管中加入4mL的Histopaque。</li>
<li>将PMBC轻轻加到Histopaque的上层（要注意Histopaque与PMBC呈现明显的两层，动作不能过大）。</li>
<li>100g，离心30分钟，刹车与加速都要调到最小。</li>
<li>吸取白色的细胞层（位于Histopaque和培养基之间，如下图的左图所示），这一步要在10分钟内完成 。</li>
<li>用PBS清洗细胞两次（100g，10分钟），4mL的PBMC约能取到1X10e7-8个细胞。<br><img src="http://ortxpw68f.bkt.clouddn.com/Histopaque.png" alt=""></li>
</ol>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>Histopaque与所要离心的外周血体积比为1:1。</li>
<li>Histopaque的储存温度是4摄氏度，在使用之前，要将Histopaque置于室温下1到2个小时，使其温度与室温接近，因为PBMC在低温下会发生冷休克（cold shock），并有可能在离心过程中形成聚集物。</li>
</ol>
<h2 id="中性粒细胞杀伤作用评价"><a href="#中性粒细胞杀伤作用评价" class="headerlink" title="中性粒细胞杀伤作用评价"></a>中性粒细胞杀伤作用评价</h2><p>（Blank, B. S., et al. (2014). “Misregulation of the broad-range phospholipase C activity increases the susceptibility of Listeria monocytogenes to intracellular killing by neutrophils.” Microbes and Infection 16(2): 104-113.）</p>
<ol>
<li>纯化后的BMN（骨髓来源中性粒细胞）用1640培养基混匀（加10% FBS，10mM HEPES），抑肽酶（aprotinin）浓度为0.4ug/mL，浓度为2X10e7/mL。</li>
<li>加入细菌，离心10分钟，700g。</li>
<li>孵育25分钟（吞菌）</li>
<li>用Opti-MEM培养基（含有50ug/ gentamicin）来替代原来的培养基；</li>
<li>感染25分钟后（从离心后开始计算时间），用含有200ug/mL的gentamicin的完全培养基清洗细胞；，</li>
<li>继续孵育30分钟，杀死细胞外细菌；</li>
</ol>
<h2 id="中性粒细胞的流式鉴定"><a href="#中性粒细胞的流式鉴定" class="headerlink" title="中性粒细胞的流式鉴定"></a>中性粒细胞的流式鉴定</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>Amulic B, Cazalet C, Hayes G L, et al. Neutrophil Function: From Mechanisms to Disease[J]. Annual Review of Immunology, 2012, 30(1):459.</li>
<li><a href="http://www.bioon.com/trends/news/609626.shtml" target="_blank" rel="external">http://www.bioon.com/trends/news/609626.shtml</a></li>
<li>Panda, S. K., S. Kumar, N. C. Tupperwar, T. Vaidya, A. George, S. Rath, V. Bal and B. Ravindran (2012). Chitohexaose activates macrophages by alternate pathway through TLR4 and blocks endotoxemia. PLoS Pathog 8(5): e1002717.</li>
<li>Boari, J. T. and Rodríguez, E. A. (2012). Adoptive Transfer of Isolated Bone Marrow Neutrophils. Bio-protocol 2(23): e298. DOI: 10.21769/BioProtoc.298; Full Text</li>
<li>Tosello Boari, J., Amezcua Vesely, M. C., Bermejo, D. A., Ramello, M. C., Montes, C. L., Cejas, H., Gruppi, A. and Acosta Rodriguez, E. V. (2012). IL-17RA signaling reduces inflammation and mortality during Trypanosoma cruzi infection by recruiting suppressive IL-10-producing neutrophils. PLoS Pathog 8(4): e1002658.</li>
<li>Swamydas M, Lionakis MS. Isolation, Purification and Labeling of Mouse Bone Marrow Neutrophils for Functional Studies and Adoptive Transfer Experiments. Journal of Visualized Experiments : JoVE. 2013;(77):50586. doi:10.3791/50586.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/22/BioStatistics/生物统计-12COX比例风险回归模型笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/22/BioStatistics/生物统计-12COX比例风险回归模型笔记/" itemprop="url">COX比例风险回归模型笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-22T12:02:00+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,602
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="COx回归模型简介"><a href="#COx回归模型简介" class="headerlink" title="COx回归模型简介"></a>COx回归模型简介</h2><p>Kaplan-Meier法与寿命表法研究的是单个分组变量的生存分析，而Cox比例风险回归模型（Cox proportional hazard regression medel）研究的由是多因素生存分析的主要方法。此方法是由英国统计学家Cox提出的而因此命名。</p>
<h3 id="Cox模型的基本形式"><a href="#Cox模型的基本形式" class="headerlink" title="Cox模型的基本形式"></a>Cox模型的基本形式</h3><script type="math/tex; mode=display">h(t,{\bf{X}})=h_{0} exp({\bf{\beta' X}})=h_{0}exp(\beta_{1}X_{1}+\beta_{2}X_{2}+\cdots+\beta_{m}X_{m})</script><p>其中$h(t,{\bf{X}})$是具有协变量${\bf{X}}$的个体在时刻t时的风险函数，t为生存时间，${\bf{X}}=(X_{1},X_{2},\cdots,X_{m})’$是可能影响生存时间的有关因素，也称协变量，这些变量可以是定量的，也可以是定性的，在整个观察期间内不随时间的变化而变化。$h_{0}(t)$是所有协变量取0时的风险函数，称为基线风险函数（）。${\bf{\beta}}=(\beta1,\beta2,\cdots,\beta_{m})’$为Cox模型的回归系数，是一组估的回归参数。由于此公式右侧的$h_{0}(t)$不需要服从特定的分布是形状，具有非参数的特点，而指数部分$exp({\bf{\beta’X}})$具有参数模型的形式，因此模型又称为半参数模型（semi-parametric model）。</p>
<p>如果采用生存率表示，则模型可写为：</p>
<script type="math/tex; mode=display">S(t,{\bf{X}}=S_{0}(t)^{exp({\bf{\beta'X}})}=S_{0}(t)^{exp(\beta_{1}X_{1}+\beta_{2}X_{2}+\cdots+\beta_{m}X_{m})}</script><p>其中S(t,X)是具有协变量X的个体在时刻t时的生存率，$S_{0}(t)$为在时刻t的基线生存率。</p>
<h3 id="RR或HR"><a href="#RR或HR" class="headerlink" title="RR或HR"></a>RR或HR</h3><p>两个分别具有协变量$X_{i}$和$X_{j}$的个体，其风险函数之比筄为相对危险度（risk ration，RR）或风险比（hazard ration，HR），是一个与时间无关的量，即</p>
<script type="math/tex; mode=display">h(t,{\bf{X_{i}}}/h(t,{\bf{X_{j}}}=exp[{\bf{\beta(X_{i}-X_{j)})}}]</script><p>例如$X_{i}$是暴露组观察对象对应各因素的聚会，$X_{j}$是非暴露组观察对象对应各因素的取值，求得${\bf{\beta}}$的估计时后就能救出暴露组对非暴露组的相对危险度估计。</p>
<h3 id="因素的初步筛选与最佳模型的建立"><a href="#因素的初步筛选与最佳模型的建立" class="headerlink" title="因素的初步筛选与最佳模型的建立"></a>因素的初步筛选与最佳模型的建立</h3><p><strong>1. 因素的筛选</strong>：影响生存时间的因素称为协变量，当协变量较多时，需要对这些协商量进行筛选。</p>
<p><strong>2. 最佳模型的建立</strong>：为建立最佳模型常需要对研究的因素进行筛选，筛选因素的方法有前进法，后退法和逐步回归法。在逐步筛选变量建立多元Cox回归模型的时候需要规定检验水准，以确定方程中引入哪些因素和剔除哪些因素，一般情况下确定引入检验的水准为0.05，剔除检验水准为0.1。检验各因素是否有统计学意义的方法有似然比检验、Wald检验和计分检验。</p>
<h3 id="比例风险假定的检验"><a href="#比例风险假定的检验" class="headerlink" title="比例风险假定的检验"></a>比例风险假定的检验</h3><p>Cox比例风险回归模型的主要前提是假定风险比值$h(t)/h_{0}(t)$为固定值，即协变量对生存率的影响不随时间的改变而改变，只有该条件得到满足，Cox回归模型的结果才有效，检验这一假定条件的方法有：</p>
<p>①如果分类协变量的每一组别的Kaplan-Meier生存曲线间无交叉，同满足比例风险假定；</p>
<p>②以生存时间t为横轴，对数生存率$ln[-ln\hat{S}(t)]$为纵轴，绘制分类协变量每一组别的生存曲线，如果协变量各组别对应的曲线平行，则满足风险比例条件；</p>
<p>③对于连续型协变量，可将每个协变量与对数生存时间的交互作用项$(Xln(t))$放入回归模型中，如果交互作用项无统计学意义，则满足风险比例条件。</p>
<p>当风险比例的假定条件不成立时，可采用如下方法解决：①将不成比例的协变量作为分层变量，然后再用其余变量进行多元Cox回归模型分析；②采用参数回归模型替代Cox回归模型进行分析。</p>
<h3 id="案例分析流程"><a href="#案例分析流程" class="headerlink" title="案例分析流程"></a>案例分析流程</h3><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>（例19-5）为探讨某恶性肿瘤的预后，某研究值得收集了63例患者的生存时间生存结局及影响因素。影响因素包括患者年龄、性别、组织学类型、治疗方式、淋巴结转移、肿瘤浸润程度，生存时间t以月计算。变量的同形和所收集的资料分别见下表，试用Cox回归模型进行分析。<br><img src="http://ortxpw68f.bkt.clouddn.com/cox1.png" alt=""></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/cox2.png" alt=""></p>
<p>完整数据<a href="https://github.com/20170505a/raw_data/blob/master/data_szq_survival_cox1.csv" target="_blank" rel="external">单击此处</a>。</p>
<h4 id="R包及函数"><a href="#R包及函数" class="headerlink" title="R包及函数"></a>R包及函数</h4><p>所用到R包为survival，所用函数如下所示：</p>
<ol>
<li>coxph：构建COX回归模型</li>
<li>cox.zph：检验PH假设是否成立</li>
<li>survreg：构建参数模型</li>
</ol>
<h4 id="计算流程"><a href="#计算流程" class="headerlink" title="计算流程"></a>计算流程</h4><h5 id="导入原始数据："><a href="#导入原始数据：" class="headerlink" title="导入原始数据："></a>导入原始数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data1905 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_survival_cox1.csv&quot;,sep=&quot;,&quot;)</div><div class="line"># read raw data</div></pre></td></tr></table></figure>
<h5 id="构建生存分析对象："><a href="#构建生存分析对象：" class="headerlink" title="构建生存分析对象："></a>构建生存分析对象：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data1905.surv &lt;- Surv(data1905$t,data1905$Y)</div><div class="line">coxph.data1905 &lt;- coxph(data1905.surv ~ X1+X2+X3+X4+X5+X6,</div><div class="line">                        data=data1905,</div><div class="line">                        method=&quot;breslow&quot;)</div></pre></td></tr></table></figure>
<h5 id="筛选变量："><a href="#筛选变量：" class="headerlink" title="筛选变量："></a>筛选变量：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">step(coxph.data1905)</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/cox3.jpg" alt=""></p>
<h5 id="AIC信息准则"><a href="#AIC信息准则" class="headerlink" title="AIC信息准则"></a>AIC信息准则</h5><p>从筛选的变量结果来看，里面含有AIC的字样，AIC的全称为Akaike information criterion，这是衡量统计模型拟合优良性的一种标准，由于它为日本统计学家赤池弘次创立和发展的，因此又称赤池信息量准则。</p>
<p>在一般的情况下，AIC可以表示为： AIC=2k-2ln(L)<br>其中：k是参数的数量，L是似然函数。 假设条件是模型的误差服从独立正态分布。 让n为观察数，RSS为剩余平方和，那么AIC变为： AIC=2k+nln(RSS/n)。</p>
<p>AIC鼓励数据拟合的优良性但是尽量避免出现过度拟合(Overfitting)的情况。<strong>所以优先考虑的模型应是AIC值最小的那一个</strong>。赤池信息准则的方法是寻找可以最好地解释数据但包含最少自由参数的模型。</p>
<p>从<code>step(coxph.data1905)</code>计算的结果来看，筛选出来的变量是X4和X5，如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/cox4.jpg" alt=""></p>
<p>然后对X4和X5进行Cox回归，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fit &lt;- coxph(data1905.surv~X4+X5,data=data1905,method = &quot;breslow&quot;)</div><div class="line">fit</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/cox5.png" alt=""></p>
<p>从结果中可以看来，新型疗法的死亡风险只是传统疗法的0.172倍，协变量X5对应的相对危险度为2.538，这说明有淋巴结转移者的死亡风险是无淋巴结转移风险者的2.5倍。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/21/BioStatistics/生物统计-11生存分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/21/BioStatistics/生物统计-11生存分析/" itemprop="url">生存分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-21T12:01:00+08:00">
                2017-06-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,049
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="生存分析"><a href="#生存分析" class="headerlink" title="生存分析"></a>生存分析</h2><p>使用对象：生存分析（survival analysis）使是将事件的结果和出现这一结果所经历的时间结合起来分析的一类统计分析方法，不仅考虑事件是否出现，而且也考虑事件出现的时间长短，因此这类方法也称为事件时间分析（time-to-event analysis）。</p>
<p>生存分析的资料通常有以下特点：①同时考虑生存时间和生存结局；②通常含有删失数据；③生存时间的分布通常不服从正态分析。</p>
<h3 id="以案例说明各种术语"><a href="#以案例说明各种术语" class="headerlink" title="以案例说明各种术语"></a>以案例说明各种术语</h3><p>以教材中的案例一下：<br>例19-1  为了估计HIV（人类免疫缺陷病毒）阳性患者的生存时间，某研究者进行了临床随访研究。研究对象是于2002年1月1日至2004年12月31日期间在某市确诊为HIV阳性者，随访这些对象直至死于AIDS（艾滋病）或其并发症（status=1为死亡，0为删失），研究截至日期为2008年12月31日。并记录每个研究对象的性别（sex=1为男， 0为女）、年龄（age，岁）、是否用药（drug=1为用药，0为不用），2017-09-26 15:09:14结果见表19-1所示。<br><img src="http://ortxpw68f.bkt.clouddn.com/19-1.png" alt=""></p>
<h4 id="起始事件、终点事件、生存时间"><a href="#起始事件、终点事件、生存时间" class="headerlink" title="起始事件、终点事件、生存时间"></a>起始事件、终点事件、生存时间</h4><p>事件可以分为起始事件（initial event）和终点事件（terminal event），从起始事件到终点事件之间所经历的时间跨度为生存时间（survival time），常记为随机㸄T，其中T&gt;=0，其值记为t。</p>
<p>在例19-1中的起始事件就是“确认HIV明性”，感兴趣的终点事件为“死于AIDS或其并发症”。表19-1中的起始日期（entdate）至终点日期（enddate）之间的月数就是生存时间（time），如编号ID个体的生存时间t=10个月。</p>
<h4 id="生存时间的分布"><a href="#生存时间的分布" class="headerlink" title="生存时间的分布"></a>生存时间的分布</h4><p>生存时间的分布通常不呈正态分布，而呈偏态分布，如呈指数分析、Weibul分布、Gompertz分布、对数Logistic分布等，下图就是19-1中的生存间分布图，其中组距为6个月，横轴是生存时间，纵轴是频率（%，其分子为频数，分母为总例数）：<br><img src="http://ortxpw68f.bkt.clouddn.com/19-1-2.png" alt=""></p>
<h4 id="删失"><a href="#删失" class="headerlink" title="删失"></a>删失</h4><p>生存结局（status）分为“死亡”和“删失”两类，“死亡”是感兴趣的终点事件，其它的终点事件或生存结局都归于删失（censoring，也称为示截尾或终检）。产生删失的原因可能为：①研究截至日期时，感兴趣终点事件仍未出现；②因搬迁等原因失去联系，不知感兴趣终点事件何时发生或是否会发生；③困其它各种原因中途退出；④死亡其它“事件”，例如交通事故或其它产生。</p>
<p>删失分为左删失、区间删失、右删失3类。</p>
<p>左删失：只知道感兴趣终点事件会在目前知晓时间（如截至时间、失访时间、死于其它疾病时间）之前发生。</p>
<p>区间删失：只知道感兴趣终点事件会在某一区间内发生。</p>
<p>右删失：只知道感兴趣终点事件会在知晓昱是之后发生。例如表19-1的ID=2个体的生存时间为1个月，因为是删失个体，所以该个体至少可以存活1个月，记为t=1+(月)，采用“+”就表示个体为右删失。</p>
<h4 id="生存时间图示"><a href="#生存时间图示" class="headerlink" title="生存时间图示"></a>生存时间图示</h4><p>每一个体进入随访队列的时间可以相同也可以不相同，当起时间不相同的时候，一般应规定一个时间范围，如例19-1就规定2002年1月1日至2004年12月31日。通常研究也会规研究截至时间，例19-1就规定为2008年12月31日。为了采用图形反映生存时间，特从表19-1中取出了个5个个体。生存结局根据记录的“终点事件”获得。生存时间通地客经2列和第3列的起始日期与终点日期计算获得。<br><img src="http://ortxpw68f.bkt.clouddn.com/19-1-3.png" alt=""><br><img src="http://ortxpw68f.bkt.clouddn.com/19-1-4.png" alt=""><br>图19-2分别采用年历时间（图19-2a）和生存时间（图19-2b）反映了表19-2中5个个体的生存情况，用“X”表示“死亡”，用“o”表示“删失”。第4、29、78号个体“死于AIDS”，即死于感兴趣的终点事件，其终点标记为“X”。第38号、39号个体为删失数据，其终点标记为“o”。第38号个体删失的原因为“失访”；第89号个体删失的原因为已到“截至日期”，感兴趣终点事件仍然没有发生。</p>
<h4 id="生存率"><a href="#生存率" class="headerlink" title="生存率"></a>生存率</h4><p>如果对图19-1的生存时间直方图拟合一条光滑曲线（图19-3），如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/19-1-5%EF%BC%882%EF%BC%89.png" alt="曲线"><br>则这条曲线就是死亡概率密度函数（probability density funciotn,PDF）曲线，死亡概率密度函数记为f(t)，其定义为：</p>
<script type="math/tex; mode=display">f(t)=\lim_{\Delta \to 0} \frac{P(t\leq T< t + \Delta t)}{\Delta t}</script><p>如果资料中没有删失数据，则生存率如下所示：</p>
<script type="math/tex; mode=display">S(t)=P(Tt)=\frac{t时刻仍存活的例数}{观察总例数}</script><p>如果含有删失数据，则要分时段计算生存概率。假定观察对象在各个时段的生存事件独立，应用概率乘法定量将各时段的生存概率相乘得到生存率，如下所示：</p>
<script type="math/tex; mode=display">S(t)=p_{1}\cdot p_{2} \cdots p_{i} \cdots p_{k}=S(t_{k-1})\cdot p_{k}</script><p>其中</p>
<script type="math/tex; mode=display">p_{i}(i=1,2, \cdots,k)$$是各时段的生存概率。对于以区间陈列的生存时间资料，可以采用以下的公式来计算死亡概率密度函数值：
$$f(t)=[S(t_{i-1})-S(t_{i})]</script><p>其中，$wi$为第i区间的时间宽度，$S(t_{i-1})$、$S(t_{i})$分别是时间$t_{i-1})$和$t_{i})$的生存率。</p>
<h4 id="生存概率与死亡概率"><a href="#生存概率与死亡概率" class="headerlink" title="生存概率与死亡概率"></a>生存概率与死亡概率</h4><p>生存概率（probablity of survival）表示某时段开始时存活的个体，到该时段估结束时仍存活的可能性。如年生存要纺表示年初尚存人口存活满一年的可能性。如下所示：</p>
<script type="math/tex; mode=display">p=\frac{活过该年人数}{某年年初人数}</script><p>死亡概率（probablity of death）表示某时段开始时存活的个体，在该时段内死亡的可能性。如年死亡概率表示年初尚存人口在今后1年内死亡的可能性，如下所示：</p>
<script type="math/tex; mode=display">q=\frac{该年内死亡人数}{某年年初人口数}</script><p>显然，死亡概率$q=1-p$。</p>
<p>注：死亡概率与一般死亡率（death rate或mortality rate）有所不同，如年死亡率：</p>
<script type="math/tex; mode=display">m=\frac{该年内死亡人数}{某年平均人口数}</script><p>其分母不同，为”某年平均人口数”，但分子相同。</p>
<h4 id="风险函数"><a href="#风险函数" class="headerlink" title="风险函数"></a>风险函数</h4><p>风险率（hazard rate）或风险函数（hazard funciton）记为h(t)，定义如下所示：</p>
<script type="math/tex; mode=display">f(t)=\lim_{\Delta \to 0} \frac{P[(t\leq T< t + \Delta t|(T\geq t))}{\Delta t}=\frac{f(t)}{S(t)}</script><p>公式解读：已生存到时间t的观察对象在t时刻的瞬时死亡率。为非负数，且可以$&gt;1$。当Δt=1，$h(t)\approx P(t\leq T &lt; t+1|T \geq t)$，此时的风险率就是时刻t存活的个体在此后一个单位时段内的死亡概率。</p>
<p>累积风险函数（cumulative hazard function），记为H(t)，与和正函数之间的关系为H(t)=-lnS(t)</p>
<h2 id="生存分析的两种方法"><a href="#生存分析的两种方法" class="headerlink" title="生存分析的两种方法"></a>生存分析的两种方法</h2><h3 id="Kaplan-Meier法"><a href="#Kaplan-Meier法" class="headerlink" title="Kaplan-Meier法"></a>Kaplan-Meier法</h3><p>R中与生存分析有关的包是survival，会涉及到三个函数，如下所示：</p>
<ul>
<li>Surv：用于创建生存数据对象</li>
<li>survfit：创建KM生存曲线或是Cox调整生存曲线</li>
<li>survdiff：用于不同组的统计检验，其中rho数量参数用以指定检验类型，0为log-rank法或Mantel-Haenszel法，1为Wilcoxon法，默认为0。</li>
</ul>
<h4 id="案例1：Kaplan-Meier法，生存曲线，"><a href="#案例1：Kaplan-Meier法，生存曲线，" class="headerlink" title="案例1：Kaplan-Meier法，生存曲线，"></a>案例1：Kaplan-Meier法，生存曲线，</h4><p>例19-2  为了比较不同手术方法治疗肾上腺肿瘤的疗效，某研究者随机将43例病人分成两组，甲组23例、乙组20例的生存时间（月）如下所示：</p>
<h5 id="原始数据如下所示："><a href="#原始数据如下所示：" class="headerlink" title="原始数据如下所示："></a>原始数据如下所示：</h5><p>甲组：1，3，5（3），6（3），7，8，10（2），14+，17，19+，20+ ，22+，26+，31+，34， 34+，44，59</p>
<p>乙组：1（2），2，3（2），4（3），  6（2），8，9（2），10，11，12，13，15，17，18<br>其中有“+”者是删失数据，表示病人仍生存或失访，括号内为重复死亡数。试计算甲组的生存率与标准误。</p>
<p>计算过程如下所示：</p>
<h5 id="导入原始数据"><a href="#导入原始数据" class="headerlink" title="导入原始数据"></a>导入原始数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">library(survival)</div><div class="line">library(coin)</div><div class="line"></div><div class="line"># 导入例题19-02的数据文件</div><div class="line">data1902 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_1902.csv&quot;,sep=&quot;,&quot;)</div><div class="line"></div><div class="line">str(data1902) # 查看数据结构</div></pre></td></tr></table></figure>
<p>如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-1.jpg" alt=""></p>
<p>可以发现，group都是整数型，需要将其转换为因子类型的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data1902$group &lt;-as.factor(data1902$group) #将分组转化为因子类型的数据</div><div class="line">str(data1902)</div></pre></td></tr></table></figure>
<p>转换结果如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-2.jpg" alt=""></p>
<h5 id="创建生存分析的对象："><a href="#创建生存分析的对象：" class="headerlink" title="创建生存分析的对象："></a>创建生存分析的对象：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Surv(data1902$t,data1902$status==1) </div><div class="line">#此语句的意思是创建一个生存分析对象；</div><div class="line">#status==1表示完整数据，0为删失数据；</div><div class="line"># 其中&quot;+&quot;是删失的数据，表示病人仍生存或失访</div></pre></td></tr></table></figure>
<p>生存分析对象如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-4.jpg" alt=""></p>
<h5 id="生存分析各种参数进行计算："><a href="#生存分析各种参数进行计算：" class="headerlink" title="生存分析各种参数进行计算："></a>生存分析各种参数进行计算：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data.fit &lt;- survfit(Surv(t,status==1)~group,data=data1902) </div><div class="line">summary(data.fit)</div><div class="line"># 查看分析结果，group=1表示甲组，2表示乙组</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-3.jpg" alt=""></p>
<h5 id="Surv-结果说明："><a href="#Surv-结果说明：" class="headerlink" title="Surv()结果说明："></a>Surv()结果说明：</h5><ol>
<li>time表示的是生存时间，这里与教材中的不太一样，教材中的信息比较全，而R中只列举了有死亡事件出现的生存时间，例如教材中的14个月有数据，而R中没有，因为在14月这个生存时间内，没有死亡，但R中没有列出，没有教材中的详细</li>
<li>n代表处于风险中的人数，这个数字就是上一个生存时间内的人数减去上一个生存时间内的死亡人数</li>
<li>n.event代表的是事件数，默认的status==1表示的是1代表死亡；</li>
<li>survival表示的是生存率</li>
<li>std.err表示的是生存率的标准误；</li>
<li>lower 95% CI：下95%置信区间；</li>
<li>upper 95% CI：上95%置信区间。</li>
</ol>
<h5 id="Log-Rank检验："><a href="#Log-Rank检验：" class="headerlink" title="Log-Rank检验："></a>Log-Rank检验：</h5><p>这里使用的是Log-Rank检验法，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">survdiff(Surv(t,status==1)~group,data=data1902)</div><div class="line"># 比较两条生存曲线的差异，用的是Log-rank检验</div></pre></td></tr></table></figure>
<p>如下所示<br><img src="http://ortxpw68f.bkt.clouddn.com/survival-5.jpg" alt="">：</p>
<p>可以发现，${\chi}^2$ 值为8.8，p值为0.00309，可见这两种组别的数据有差异。</p>
<h5 id="绘制生存曲线："><a href="#绘制生存曲线：" class="headerlink" title="绘制生存曲线："></a>绘制生存曲线：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">plot(data.fit,col=c(&quot;red&quot;,&quot;blue&quot;),lwd=1) #绘图</div><div class="line"></div><div class="line">legend(&quot;topright&quot;,legend=c(&quot;甲组&quot;,&quot;乙组&quot;),col=c(&quot;red&quot;,&quot;blue&quot;),lty=1,cex=0.8,adj=-0.7,bty=&quot;o&quot;) </div><div class="line">#加图例</div></pre></td></tr></table></figure>
<p>如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-6.png" alt=""></p>
<p>或者使用survminer包中的ggsurvplot生成图片：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(survminer)</div><div class="line">data.fit &lt;- survfit(Surv(data1$time~data1$status)~data1$group)</div><div class="line">ggsurvplot(data.fit,legend.title = &quot;Sex&quot;,legend.labs = c(&quot;甲组&quot;, &quot;乙组&quot;))</div></pre></td></tr></table></figure>
<p>如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/ggsurvplot.png" alt=""></p>
<h5 id="中位数生存时间"><a href="#中位数生存时间" class="headerlink" title="中位数生存时间"></a>中位数生存时间</h5><p>中位数生存时间（median survival time）又称为生存时间的中位数，表示刚好有50%的个体其存活期大于该时间。</p>
<p>计算中位数生存时间的方法有两种：</p>
<p>①在纵轴生存率为0.5处画一条与横轴平等的线，并与生存率曲线相交，然后自交点画垂线与横轴相交，此效应对应的时间点即为中位生存时间，但结果较粗略，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">plot(data.fit,col=c(&quot;red&quot;,&quot;blue&quot;),lwd=1) #绘图</div><div class="line"></div><div class="line">legend(&quot;topright&quot;,legend=c(&quot;甲组&quot;,&quot;乙组&quot;),col=c(&quot;red&quot;,&quot;blue&quot;),lty=1,cex=0.8,adj=-0.7,bty=&quot;o&quot;) </div><div class="line">#加图例 </div><div class="line"></div><div class="line">abline(h=0.5)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/suvival-median2.jpeg" alt=""></p>
<p>②线性内插法，原理见书，但R中有类似的方法，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a &lt;- which(data1902$group==1)</div><div class="line">b &lt;- which(data1902$group==2)</div><div class="line">data1902[a]</div><div class="line">data1902[b]</div><div class="line">median_a &lt;- Surv(data1902[a,]$t,data1902[a,]$status==1)</div><div class="line">median_b &lt;- Surv(data1902[b,]$t,data1902[b,]$status==1)</div><div class="line">summary(median_a)</div><div class="line">summary(median_b)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival-median.png" alt=""></p>
<p>可以看到，甲组的中位数生存时间为10个月；乙组为7个月，跟书中略有出入。</p>
<h2 id="案例分析补充"><a href="#案例分析补充" class="headerlink" title="案例分析补充"></a>案例分析补充</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p>某研究者分别用免疫疗法、药物与免疫结合疗法治疗黑色素瘤患者，经随访得到各患的生存时间（月）见下表（孙振球. 医学统计学习题解答-第4版[M]. 人民卫生出版社, 2015.P136）。</p>
<ol>
<li>试彩乘积极限法计算其生存率及其标准误。</li>
<li>对两组的生存率进行log-rank可检验。</li>
<li>绘制生存曲线。</li>
</ol>
<p>计算过程如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">library(survival)</div><div class="line">library(coin)</div><div class="line">data1&lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_survival_case1.csv&quot;,sep=&quot;,&quot;)</div><div class="line">data1$group &lt;-as.factor(data1$group) #将分组转化为因子类型的数据</div><div class="line">Surv(data1$time,data1$status==1)</div><div class="line">data.fit &lt;- survfit(Surv(data1$t,data1$status==1)~data1$group) </div><div class="line">summary(data.fit)</div><div class="line">survdiff(Surv(time,status==1)~group,data=data1) </div><div class="line">plot(data.fit,col=c(&quot;red&quot;,&quot;blue&quot;),lwd=1) #绘图</div><div class="line">legend(&quot;topright&quot;,legend=c(&quot;BCG治疗组&quot;,&quot;药物和BCG治疗组&quot;),col=c(&quot;red&quot;,&quot;blue&quot;),lty=1,cex=0.8,x.intersp=1,bty=&quot;o&quot;)</div></pre></td></tr></table></figure>
<p>标准误与生存率：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/survival_case1_1.png" alt=""></p>
<p>两组进行比较：<br><img src="http://ortxpw68f.bkt.clouddn.com/survival_case1_2.png" alt=""><br>p值为0.811，还不能认为两种治疗方法有差异。</p>
<p>生存曲线：<br><img src="http://ortxpw68f.bkt.clouddn.com/survival_case1_3.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/09/BioStatistics/生物统计-11Logistics回归/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/09/BioStatistics/生物统计-11Logistics回归/" itemprop="url">Logistics回归笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-09T12:02:00+08:00">
                2017-06-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,920
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  22
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在回归中，如果因变量不是数量型的，而是取两个可能值的分类变量，而自变量可以为定性变量及定量变量，那么此时普通的线性回归模型就不适用了，至少回归方程的左边不能是分类变量。我们回忆一下二项分布Bin(n,p)，取两个值的二分布变量和二项分布有关，满足二项分布的变量取两种可能的值，预付过程可以看成为n次独立的随机试验（Bernoulli试验），每次试验只可能取两个可能的值这一，如果称一个试验结果为“成功”，而另一个为“不成功”，并记每次试验成功的概率为p，那么不成功的概率则为1-p。在这里，在所有n次试验中，成功概率p保持不变，然而在初中中，概率在所有情况下都不变的假定往往不成立，概率p可能是一些自变量的函数，此时，回归方程的右边与普通的回归方程的类似，而左边则是概率p的函数，而不是p（因变量成功概率）本身，这种回归就是Logistic回归。</p>
<p>Logistic回归（logistic regression）属于概率型线性回归，它是研究二分类（可以扩展到多类）观察结果与一些影响因素之间关系的一种多变量分析方法。在流行病学研究中，经常需要分析疾病与各危险因素之间的定量关系，如食管癌的发生与吸烟、饮酒、不良包含习惯等危险因素的关系，为了正确说明这种关系，需要排除一些混杂因素的影响，传统上常使用Mantel-Haenszel分层分析方法，但这一方法适用于样本含量大、分析因素较少的情况。如果用线性回归，由于应变量Y是一个二值变量（通常取值为1或0），不满足应用条件，尤其当各因素都处于低水平或高水平时，预测值$\hat{Y}​$可能超出0~1的范围，出现不合理的现象，用Logistic回归分析就是为了解决上述问题的。</p>
<h2 id="Logistic回归"><a href="#Logistic回归" class="headerlink" title="Logistic回归"></a>Logistic回归</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="logistic回归模型"><a href="#logistic回归模型" class="headerlink" title="logistic回归模型"></a>logistic回归模型</h4><p>设应变量是一个二值变量，取值为0或1，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/il9cIc07aI.png?imageslim" alt="mark"></p>
<p>另有影响Y取值的m个奕变量，分别为$X_{1},X_{2},\dots,X_{m}$，记作$P=P(Y=1|X_{1},X_{2},\dots,X_{m})$，表示在m个自变量作用下阳性结果发生的概率，logistic回归模型就可以表示为下面的公式，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/B3kHgh2kF6.png?imageslim" alt="mark"></p>
<p>其中$\beta_{0}$是常数项，$\beta_{1},\beta_{2},\cdots,\beta_{m}$是回归系数，如果用Z表示m个自变量的线性组合，就是下面的样子：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/gH7G8a4jdl.png?imageslim" alt="mark"></p>
<p>则Z与P之间的logistic曲线就是下面的图形，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/cblf06iB27.png?imageslim" alt="mark"></p>
<p>从图中可以看出：当Z趋于$+\infty$时，P值逐渐趋于1；当Z趋于$-\infty$时，P值逐渐趋于0；P值的变化在0~1这个范围内，并且随着Z的增加或减少，以点$(0,0.5)$为中心呈对称S形变化，logistic模型的这些特点能够较好地配合生物学反应资料，对(16-1)的公式作对数变量，logistic回归模型就成了下面的线性形式，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/l9G812hIe5.png?imageslim" alt="mark"></p>
<p>上述公式的左端为阳性与阴性结果发生概率之比的自然对数，称为P的logit变换，称为logitP，这就可以看出，虽然概率P的取值范围是0~1，但是logitP却没有数值界限。</p>
<h4 id="模型参数意义"><a href="#模型参数意义" class="headerlink" title="模型参数意义"></a>模型参数意义</h4><p>以浒病学来说明一下模型参数的意义，从公式(16-2)可以看出，常数项$\beta_{0}$表示暴露剂量为0时，个体发病与不发病概率比之的自然对数，回归系数$\beta_{j}(j=1,2,\cdots,m)$表示自变量$X_{j}$改变一个单位时，logitP的改变量，它与称量危险因素作用大小的比数变称优势比（odds ratio，OR）有一个对应的关系，对比某一危险因素两个不同暴露水平$X_{j}=c_{1}$与$X_{j}=c_{0}$的发病情况（假定其他因素的水平相同），其优势比的自然对数如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/m33bbA2dbf.png?imageslim" alt="mark"></p>
<p>转换成真数，则是如下的样子：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/5ekdJ13eik.png?imageslim" alt="mark"></p>
<p>在上面的这些公式中，$P_{1}$和$P_{2}$分别表示在$X_{j}$聚会为$c_{1}$及$c_{0}$时的发病概率，$OR_{j}$称作多变量调整后的优势比（adjusted odds ratio），表示扣除了其他自变量影响后危险因素的作用，如果$X_{j}$赋值上为1，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/2HEiLjbAjK.png?imageslim" alt="mark"></p>
<p>那么，暴露组与非暴露组发病的优势比则为</p>
<p>$OR_{j}=exp(\beta_{j})$(<strong>16-5</strong>)</p>
<p>当$\beta_{j}=0$时，$OR_{j}=1$，说明因素$X_{j}$对产生的发生不起作用；当$\beta_{j}&gt;0$时，$OR_{j}&gt;1$，说明$X_{j}$是一个危险因子；当$\beta_{j}&lt;1$时，$OR_{j}&lt;1$，说明$X_{j}$是一个保护因子。</p>
<p>由于$OR_{j}$值与模型中的常数项无关，$\beta_{0}$在危险因素分析中视为无效参数，对于发病率较低的慢性疾病如心脑血管疾病、恶性中肿瘤等，由于P很小，优势比可以作用相对危险度（relative risk，RR）的近似估计，如：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/G0jKg4aH0E.png?imageslim" alt="mark"></p>
<p>这是logistic回归用一皳行病学调查资料的优势之一，即得到某一因素的回归系数估计值后，便可以得到该因素不同水平下优势比的估计值和相对危险度的近似估计值。</p>
<h3 id="logistic回归模型的参数估计"><a href="#logistic回归模型的参数估计" class="headerlink" title="logistic回归模型的参数估计"></a>logistic回归模型的参数估计</h3><h4 id="参数估计"><a href="#参数估计" class="headerlink" title="参数估计"></a>参数估计</h4><p>根据一组实际观察资料估计logistic回归模型的参数时，通常采用<strong>最大似然法估计（maximum likelihood estimate, MLE）</strong>，即建立一个样本似然函数，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/BCLLk6g26i.png?imageslim" alt="mark"></p>
<p>式中$P_{i}$表示第$i$例观察对象在暴露条件下阳性结果发生的概率，如果实际出现的是阳性结果，取$Y_{i}=1$，否则取$Y_{i}=0$，根据最大似然原理，在一次抽样中，获得现有样本的概率应该最大，即似然函数L应该达到最大值，为了简化计算，通常取似然函数的对数形式，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/ca1ifm2laf.png?imageslim" alt="mark"></p>
<p>形成要计算的目标函数lnL，然后采用Newton-Raphson迭代方法使对数似然函数达到极大值，此时参数的聚会$b_{0},b_{1},b_{2},\cdots,b_{m}$即为$\beta_{0},\beta_{1},\beta_{2},\cdots,\beta_{m}$的最大似然估计值，同时得到参数估计值的方差，即协方差矩阵（对角线元素开平方为标准误$S_{b_{0}},S_{b_{1}},S_{b_{2}},\cdots,S_{b_{m}}$。</p>
<p>如果我们有下述的分层资料，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/5iAFH48fd5.png?imageslim" alt="mark"></p>
<p>高有g层，每层有$n_{k}(k=1,2,\cdots,g)$例观察以对象，其中有$d_{k}$个病例，则似然函数为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/8ghGBC6Kaf.png?imageslim" alt="mark"></p>
<p>其中，$P_{k}$表示第k层阳性结果发生的概率，上述求解过程现在都是通过软件来完成的。</p>
<h4 id="优势比估计"><a href="#优势比估计" class="headerlink" title="优势比估计"></a>优势比估计</h4><p>根据公式(16-4)，其一因素两个不同水平$(c_{1},c_{0})$优势比的估计值如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/4fi9JCGKgL.png?imageslim" alt="mark"></p>
<p>$OR_{j}$的可信区间可以利用$b_{j}$的抽样分布来估计，在样本含量比较大的情况下，它近似服从正态分布，特殊情况下，若自变量$X_{j}$只有暴露和非暴露两个水平，则优势比$OR_{j}$的$1-\alpha$可信区间计算公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/eB0cgmF84B.png?imageslim" alt="mark"></p>
<h3 id="案例A"><a href="#案例A" class="headerlink" title="案例A"></a>案例A</h3><p>对前面所述的表格（16-1）做logistic回归分析，也就是下面的这个表格</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>分层</th>
<th>吸烟$X_{1}$</th>
<th>饮酒$X_{2}$</th>
<th>观察例数$n_{k}$</th>
<th>阳性数$d_{k}$</th>
<th>阴性数$n_{k}-d_{k}$</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>199</td>
<td>63</td>
<td>136</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>1</td>
<td>170</td>
<td>63</td>
<td>107</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>0</td>
<td>101</td>
<td>44</td>
<td>57</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>1</td>
<td>416</td>
<td>265</td>
<td>151</td>
</tr>
</tbody>
</table>
</div>
<p>确定各变量的赋值或编码，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/21e8gfChkI.png?imageslim" alt="mark"></p>
<p>进行logistic回归计算，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">smoke &lt;- c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="comment"># 0表示不吸烟，1表示吸烟</span></div><div class="line">wine &lt;- c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>)</div><div class="line">n1 &lt;- c(<span class="number">199</span>,<span class="number">170</span>,<span class="number">101</span>,<span class="number">416</span>) <span class="comment"># 0表示不饮酒，1表示饮酒</span></div><div class="line">positive1 &lt;- c(<span class="number">63</span>,<span class="number">63</span>,<span class="number">44</span>,<span class="number">265</span>)</div><div class="line">negative1 &lt;- c(<span class="number">136</span>,<span class="number">107</span>,<span class="number">57</span>,<span class="number">151</span>)</div><div class="line">data1 &lt;- positive1/n1 <span class="comment"># data1用来计算阳性率</span></div><div class="line">result1 &lt;- glm(data1~smoke+wine,binomial,weights=n1) <span class="comment"># data1为百分比，需要加上总数</span></div><div class="line">con1 &lt;- as.matrix(confint(result1))[<span class="number">2</span>,] <span class="comment"># confint(result1)查看各个系数对应的置信区间</span></div><div class="line">exp(con1) <span class="comment"># 计算吸烟与不吸烟优势比的可信区间</span></div><div class="line">con2 &lt;- as.matrix(confint(result1))[<span class="number">3</span>,] </div><div class="line">exp(con2) <span class="comment"># 计算饮酒与不饮酒优势比的可信区间</span></div><div class="line">summary(result1) <span class="comment"># 查看各个系数,z值的平方即为Wald检验值</span></div><div class="line">anova(result1,test=<span class="string">"Chisq"</span>) <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">&gt; exp(con1) # 计算吸烟与不吸烟优势比的可信区间</div><div class="line">   2.5 %   97.5 % </div><div class="line">1.809052 3.258006 </div><div class="line">&gt; con2 &lt;- as.matrix(confint(result1))[3,] </div><div class="line">Waiting for profiling to be done...</div><div class="line">&gt; exp(con2) # 计算饮酒与不饮酒优势比的可信区间</div><div class="line">   2.5 %   97.5 % </div><div class="line">1.244161 2.304882 </div><div class="line">&gt; summary(result1) # 查看各个系数,z值的平方即为Wald检验值</div><div class="line"></div><div class="line">Call:</div><div class="line">glm(formula = data1 ~ smoke + wine, family = binomial, weights = n1)</div><div class="line"></div><div class="line">Deviance Residuals: </div><div class="line">      1        2        3        4  </div><div class="line"> 0.9133  -0.9240  -1.1731   0.5968  </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error z value Pr(&gt;|z|)    </div><div class="line">(Intercept)  -0.9099     0.1358  -6.699 2.11e-11 ***</div><div class="line">smoke         0.8856     0.1500   5.904 3.54e-09 ***</div><div class="line">wine          0.5261     0.1572   3.348 0.000815 ***</div><div class="line">---</div><div class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class="line"></div><div class="line">(Dispersion parameter for binomial family taken to be 1)</div><div class="line"></div><div class="line">    Null deviance: 71.9659  on 3  degrees of freedom</div><div class="line">Residual deviance:  3.4202  on 1  degrees of freedom</div><div class="line">AIC: 32.005</div><div class="line"></div><div class="line">Number of Fisher Scoring iterations: 3</div><div class="line"></div><div class="line">&gt; anova(result1,test=&quot;Chisq&quot;) # </div><div class="line">Analysis of Deviance Table</div><div class="line"></div><div class="line">Model: binomial, link: logit</div><div class="line"></div><div class="line">Response: data1</div><div class="line"></div><div class="line">Terms added sequentially (first to last)</div><div class="line"></div><div class="line"></div><div class="line">      Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    </div><div class="line">NULL                      3     71.966              </div><div class="line">smoke  1   57.315         2     14.651 3.713e-14 ***</div><div class="line">wine   1   11.230         1      3.420 0.0008047 ***</div><div class="line">---</div><div class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div></pre></td></tr></table></figure>
<p>从上面结果可以看出：</p>
<p>$b_{0}=-0.9099,S_{b_{0}}=0.1358,b_{1}=0.8856,S_{b_{1}}=0.1500,b_{2}=0.5261,S_{b_{2}}=0.1572$</p>
<p>吸烟与不吸烟的优势比为：</p>
<p>$ \widehat{OR_{1}}=exp(b_{1})=exp(0.8856)=2.42 $ </p>
<p>$OR_{1}$的95%可信区间如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/B338JCG4gA.png?imageslim" alt="mark"></p>
<p>饮酒与不饮酒的优势比为：</p>
<p>$ \widehat{OR_{2}}=exp(b_{1})=exp(0.5261)=1.69 $ </p>
<p>$OR_{2}$的95%可信区间如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/mfI8e4D6gg.png?imageslim" alt="mark"></p>
<h3 id="logistic回归模型的假设检验"><a href="#logistic回归模型的假设检验" class="headerlink" title="logistic回归模型的假设检验"></a>logistic回归模型的假设检验</h3><p>得到logistic回归方程后，还需要对其回归系数进行假设检验，用于说明所研究的自变量对于应变量Y的是影响是否有统计学意义，为此，需要对模型中的回归系数是否不全为0作出检验，这个跟多重线性回归的检验是一样的，检验假设条件如下所示：</p>
<p>$H_{0}:\beta_{1}=\beta_{1}=\cdots=\beta_{m}=0$</p>
<p>$H_{1}:$各$\beta_{j}(j=1,2,\cdots,m)$不全为0</p>
<p>更典型的问题是对一个回归系数的检验，检验假设为$H_{0}:\beta_{j}=0,H_{1}:\beta \neq 0$。常用的检验验方法有似然比检验（likelihood ratio test），Wald检验和计分检验（score test）。</p>
<h4 id="似然比检验"><a href="#似然比检验" class="headerlink" title="似然比检验"></a>似然比检验</h4><p>似然比检验的基本思想是比较在两种不同假设条件下的对数似然函数值，看其差别大小。具体做法是，先拟合一个不包含准备检测的变量在内的logistic回归模型，求出它的对数似然函数值$lnL_{0}$，然后把需要检验的变量加入模型中去，再检验配合，得到一个新的对数似然函数值$lnL_{1}$，假设前后两个模型分别包含$l$个自变量和$p$个自变量，似然比统计量G的计算公式为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180726/GEj57Gk3Cf.png?imageslim" alt="mark"></p>
<p>当样本含量较大时，在零假设下得到的G统计量近似服从自由度为$d(d=p-l)$的$\chi^2$分布，若$G\geq{\chi^2_{\alpha,d}}$时，𩇡新加入的$d$个自变量对回归方程有统计学意义，如果只对一个回归系数检验，则$d=1$，由上面的案例可以计算出来：</p>
<p>$lnL(X_{1})=-585.326,lnL(X_{2})=-597.436,lnL(X_{1},X_{2})=-579.711$</p>
<p>符号$L(X_{1})$和$L(X_{2})$分别表示模型中只含有$X_{1}$和$X_{2}$的最大似然函数值，而$L(X_{1},X_{2})$则表示模型中同时含有$X_{1}$和$X_{2}$的最大似然函数。</p>
<p>对于$H_{0}:\beta_{1}=0,H_{1}:\beta \neq 0$，则有：</p>
<p>$G=2[lnL(X_{1},X_{2})-lnL(X_{2})]=2[-579.711-(-597.436)]=35.45$</p>
<p>查$\chi^2$界值表可以得，$\chi^2_{0.05,1}=3.84$，$G&gt;3.84$，因此在$\alpha=0.05$检验水平上拒绝$H_{0}$，接受$H_{1}$，说明控制了饮酒因素是呼后，食管癌与吸烟有显著性关系。</p>
<p>同理，对于$H_{0}:\beta_{2}=0,H_{1}:\beta_{2} \neq 0$，则有</p>
<p>$G=2[lnL(X_{1},X_{2})-lnL(X_{2})]=2[-579.711-(-585.326)]=11.23$</p>
<p>$G&gt;3.84$，拒绝$H_{0}$，接受$H_{1}$，说明控制了吸烟因素的影响后，食管癌与饮酒有显著性关系。</p>
<h4 id="Wald检验"><a href="#Wald检验" class="headerlink" title="Wald检验"></a>Wald检验</h4><p>Wald检验只需要将各参数$\beta_{j}$的估计值$b_{j}$与0比较，并且它的标准误$S_{b_{j}}$作为参照；为检验$H_{0}:\beta_{j}=0,H_{1}:\beta_{j} \neq0$，计算如下统计量</p>
<p>$\mu=\frac{b_{j}}{S_{b_{j}}} \qquad (16-13)$</p>
<p>或</p>
<p>$\chi^2=(\frac{b_{j}}{S_{b_{j}}})^2 \qquad (16-14)$</p>
<p>对于大样本资料，在零假设下$\mu$近似服从标准正态分布，而$\chi^2$则近似服从自由度$\nu=1$的$\chi^2$分布，在本例中，对于$H_{0}:\beta_{1}=0,H_{1}:\beta_{2} \neq 0$，则有：</p>
<p>$\chi^2=(\frac{0.8856}{0.1500})^2=34.86$</p>
<p>对于$H_{0}:\beta_{2}=0,H_{1}:\beta_{2} \neq 0$，则有：</p>
<p>$\chi^2=(\frac{0.5261}{0.1572})^2=11.20$</p>
<p>$\chi^2$值均大于3.84，说明食管癌与吸烟、吸烟有显著性关系，结论同前。</p>
<p>现在在R中计算一下这个案例，如下所示：</p>
<p>第一步：原始数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">smoke &lt;- rep(c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>),c(<span class="number">199</span>,<span class="number">170</span>,<span class="number">101</span>,<span class="number">416</span>))</div><div class="line">alcohol &lt;- rep(c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>),c(<span class="number">199</span>,<span class="number">170</span>,<span class="number">101</span>,<span class="number">416</span>))</div><div class="line">Y &lt;- rep(c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>),c(<span class="number">136</span>,<span class="number">63</span>,<span class="number">107</span>,<span class="number">63</span>,<span class="number">57</span>,<span class="number">44</span>,<span class="number">151</span>,<span class="number">265</span>))</div><div class="line">logistic_raw &lt;- data.frame(smoke,alcohol,Y)</div><div class="line">head(logistic_raw)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; head(logistic_raw)</div><div class="line">  smoke alcohol Y</div><div class="line">1     0       0 0</div><div class="line">2     0       0 0</div><div class="line">3     0       0 0</div><div class="line">4     0       0 0</div><div class="line">5     0       0 0</div><div class="line">6     0       0 0</div></pre></td></tr></table></figure>
<p>第二步：logistic回归计算</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">logistic_glm &lt;- glm(Y ~ smoke + alcohol, family=binomial(link=<span class="string">'logit'</span>), data=logistic_raw)</div><div class="line">logistic_glm</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; logistic_glm</div><div class="line"></div><div class="line">Call:  glm(formula = Y ~ smoke + alcohol, family = binomial(link = &quot;logit&quot;), </div><div class="line">    data = logistic_raw)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line">(Intercept)        smoke      alcohol  </div><div class="line">    -0.9099       0.8856       0.5261  </div><div class="line"></div><div class="line">Degrees of Freedom: 885 Total (i.e. Null);  883 Residual</div><div class="line">Null Deviance:	    1228 </div><div class="line">Residual Deviance: 1159 	AIC: 1165</div></pre></td></tr></table></figure>
<p>从这个结果我们可以发现，logistic的截矩为-0.9099，smoke的系数为0.8856，alcohol为0.5261，与书中结果相同。</p>
<p>第三步：OR与95% IC</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## OR 与 95% CI</span></div><div class="line">OR &lt;- exp(coef(logistic_result))</div><div class="line">CI &lt;- exp(confint(logistic_glm,level = <span class="number">0.95</span>))</div><div class="line"></div><div class="line"></div><div class="line">coef_result &lt;- exp(cbind(OR = coef(logistic_result)[<span class="number">2</span>:<span class="number">3</span>,<span class="number">1</span>], </div><div class="line">                         CI_low = confint(logistic_glm ,level=<span class="number">0.95</span>)[<span class="number">2</span>:<span class="number">3</span>,<span class="number">1</span>],</div><div class="line">                         CI_up = confint(logistic_glm ,level=<span class="number">0.95</span>)[<span class="number">2</span>:<span class="number">3</span>,<span class="number">2</span>]))</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; coef_result</div><div class="line">              OR   CI_low    CI_up</div><div class="line">smoke   <span class="number">2.424399</span> <span class="number">1.809052</span> <span class="number">3.258006</span></div><div class="line">alcohol <span class="number">1.692359</span> <span class="number">1.244161</span> <span class="number">2.304882</span></div></pre></td></tr></table></figure>
<h2 id="Logistic回归变量筛选"><a href="#Logistic回归变量筛选" class="headerlink" title="Logistic回归变量筛选"></a>Logistic回归变量筛选</h2><p>与多元线性回归分析类似，当自变量的个数较多时，为了使建立的logistic回归模型比较稳定和便于解释，应尽可能将回归效果显著的自变量选入模型中，将作用不显著的自变量排除在外，具体的算法有前进法、后退法和逐步法。logistic逐步回归与线性逐步回归过程非常相似，使用其中所用的检验统计量不再是F统计量，而是似然比统计量、Wald统计量和计分统计量之一，例如使用似然比统计量，即利用如下的公式：</p>
<p>$G=2(lnL_{1}^{(l)}-lnL_{0}^{(l)})$</p>
<p>在进行到第$l$步时，通过比较含有某一自变量$X_{j}$和不含有$X_{j}$的模型，决定$X_{j}$是否引入模型或从模型中剔除。</p>
<p>看下面的案例（《医学统计学》，第四版，孙振球）：</p>
<h3 id="案例B"><a href="#案例B" class="headerlink" title="案例B"></a>案例B</h3><p>为了探讨冠心病的有关危险因素，对26例冠心病患者和28便对照者进行病例对照研究，各因素的说明及资料见下表1和表2，试用logistic逐步回归分析法筛选危险因素（$\alpha_{入}=0.10$，$\alpha_{出}=0.15$），如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>表1</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>因素</td>
<td>变量名</td>
<td>赋值说明</td>
</tr>
<tr>
<td>年龄（岁）</td>
<td>X1</td>
<td>&lt;45=1,45~=2,55~=3,65~=4</td>
</tr>
<tr>
<td>高血压史</td>
<td>X2</td>
<td>无=0,有=1</td>
</tr>
<tr>
<td>高血压家族史</td>
<td>X3</td>
<td>无=0,有=1</td>
</tr>
<tr>
<td>吸烟</td>
<td>X4</td>
<td>不吸=0,吸=1</td>
</tr>
<tr>
<td>高血脂史</td>
<td>X5</td>
<td>无=0,有=1</td>
</tr>
<tr>
<td>动物脂肪摄入</td>
<td>X6</td>
<td>低=0,高=1</td>
</tr>
<tr>
<td>体重指数（BMI）</td>
<td>X7</td>
<td>&lt;24~=1,24~=2,26~=3</td>
</tr>
<tr>
<td>A型性格</td>
<td>X8</td>
<td>否=0,是=1</td>
</tr>
<tr>
<td>冠心病</td>
<td>Y</td>
<td>对照=0,病例=1</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>表2</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>序号</td>
<td>X1</td>
<td>X2</td>
<td>X3</td>
<td>…</td>
<td>X7</td>
<td>X8</td>
<td>Y</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>…</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>…</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>…</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>54</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>…</td>
<td>3</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>（原始数据已放github上）</p>
<p>计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">No &lt;- <span class="number">1</span>:<span class="number">54</span></div><div class="line">X1 &lt;- c(<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">X2 &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">X3 &lt;- c(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>)</div><div class="line">X4 &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>)</div><div class="line">X5 &lt;- c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>)</div><div class="line">X6 &lt;- c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</div><div class="line">X7 &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>)</div><div class="line">X8 &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">Y &lt;- c(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">data2 &lt;- data.frame(No,X1,X2,X3,X4,X5,X6,X7,X8,Y)</div><div class="line">y.glm &lt;- glm(Y~X1+X2+X5+X6+X7+X8,family=binomial,data=data2)</div><div class="line">summary(y.glm)</div><div class="line">y.step2 &lt;- step(y.glm)</div><div class="line">summary(y.step2)</div><div class="line">y.glm2 &lt;- glm(Y~X1+X5+X6+X8,family=binomial,data=data2)</div><div class="line">summary(y.glm2)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&gt; summary(y.glm)</div><div class="line"></div><div class="line">Call:</div><div class="line">glm(formula = Y ~ X1 + X2 + X5 + X6 + X7 + X8, family = binomial, </div><div class="line">    data = data2)</div><div class="line"></div><div class="line">Deviance Residuals: </div><div class="line">    Min       1Q   Median       3Q      Max  </div><div class="line">-2.3631  -0.6437  -0.2306   0.5883   2.2950  </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error z value Pr(&gt;|z|)   </div><div class="line">(Intercept)  -5.0195     1.6820  -2.984  0.00284 **</div><div class="line">X1            0.7242     0.4883   1.483  0.13805   </div><div class="line">X2            1.1076     0.8171   1.356  0.17524   </div><div class="line">X5            1.2089     0.7808   1.548  0.12158   </div><div class="line">X6            3.3788     1.3397   2.522  0.01167 * </div><div class="line">X7            0.2881     0.5714   0.504  0.61419   </div><div class="line">X8            1.9090     0.8973   2.128  0.03338 * </div><div class="line">---</div><div class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class="line"></div><div class="line">(Dispersion parameter for binomial family taken to be 1)</div><div class="line"></div><div class="line">    Null deviance: 74.786  on 53  degrees of freedom</div><div class="line">Residual deviance: 43.907  on 47  degrees of freedom</div><div class="line">AIC: 57.907</div><div class="line"></div><div class="line">Number of Fisher Scoring iterations: 5</div></pre></td></tr></table></figure>
<p>从结果来看，X6，X8这2项的P值小于0.05，现在再对这2项进行回归拟合，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>《医学统计学》（第四版.孙振球）</li>
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/08/BioStatistics/生物统计-10相关分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/BioStatistics/生物统计-10相关分析/" itemprop="url">相关分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T12:02:00+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,547
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="直线相关（Linear-correlation）"><a href="#直线相关（Linear-correlation）" class="headerlink" title="直线相关（Linear correlation）"></a>直线相关（Linear correlation）</h2><h2 id="变量之间的关系"><a href="#变量之间的关系" class="headerlink" title="变量之间的关系"></a>变量之间的关系</h2><p>变量之间的关系有两种，一种是变量间存在着完全确定的有关系，这类变量间的关系称为函数关系；另一类是变量间关系不存在完全的确定性，不能用精确的数学公式来表示，这些变量间都存在着十分密切的关系，但不能由一个或几个变量的值精确地求出求出另一个变量的值，这些变量间的关系称为相关关系，存在相关关系的变量是相关变量。</p>
<h3 id="直线相关的概念"><a href="#直线相关的概念" class="headerlink" title="直线相关的概念"></a>直线相关的概念</h3><p>对于两变量关系的研究，有时并不需要由X估计Y，也就是说我们有时候并不需要考虑直线回归的问题，而是考虑两个变量之间是否有明确的直线相关关系，例如为了研究向量元素锰在胆固醇合成中的作用，探讨大刀肝脏中胆固醇含量和锰含量之间是否存在直线关系？这种关系表现为随着锰含量的增加，胆固醇的是增加还是减少呢？像这类判断两个数值变量之间有元直线相关关系，并回答相关的方向和相关程度如何时，可以采用相关分析。</p>
<h2 id="回归与相关的区别与联系"><a href="#回归与相关的区别与联系" class="headerlink" title="回归与相关的区别与联系"></a>回归与相关的区别与联系</h2><h3 id="两者的区别"><a href="#两者的区别" class="headerlink" title="两者的区别"></a>两者的区别</h3><p>回归和相关都是研究两个变量相互关系的分析方法。相关分析研究两个变量之间相关的方向和相关的密切程度。但是相关分析不能指出两变量相互关系的具体形式，也无法从一个变量的变化来推测另一个变量的变化关系。</p>
<p>回归方程则是通过一定的数学方程来反映变量之间相互关系的具体形式，以便从一个已知量来推测另一个未知量。为估算预测提供一个重要的方法。具体区别有：</p>
<ol>
<li><p>相关分析中变量之间处于平等的地位；回归分析中，因变量处在被解释的地位，自变量用于预测因变量的变化；</p>
</li>
<li><p>相关分析中不必确定自变量和因变量，所涉及的变量可以都是随机变量；而回归分析则必须事先确定具有相关关系的变量中，哪个是因变量，哪个是因变量。一般来说，回归分析中因变量是随机变量，而把自变量作为研究时给定的非随机变量；</p>
</li>
<li><p>相关分析研究变量之间相关的方向和相关的程度，但相关分析不能根据一个变量的变化来推测另一个变量的变化情况；回归分析是研究变量之间相互关系的具体表现形式，根据变量之间的联系确定一个相关的数学表达式，从而可以从已知量来推测未知量。</p>
</li>
<li><p>对两个变量来说，相关分析中只能计算出一个相关系数；而回归分析中有时可以根据研究目的的不同建立两个不同的回归方程。</p>
</li>
</ol>
<h3 id="两者的联系"><a href="#两者的联系" class="headerlink" title="两者的联系"></a>两者的联系</h3><p>相关分析与回归分析是广义相关分析的两个阶段,两者有着密切的联系 ：</p>
<ol>
<li>相关分析是回归分析的基础和前提，回归分析则是相关分析的深入和继续。相关分析需要依靠回归分析来表现变量之间数量相关的具体形式，而回归分析则需要依靠相关分析来表现变量之间数量变化的相关程度。只有当变量之间存在高度相关时，进行回归分析寻求其相关的具体形式才有意义。如果在没有对变量之间是否相关以及相关方向和程度做出正确判断之前，就进行回归分析，很容易造成“虚假回归”。</li>
<li>由于相关分析只研究变量之间相关的方向和程度，不能推断变量之间相互关系的具体形式，也无法从一个变量的变化来推测另一个变量的变化情况，因此，在具体应用过程中，只有把相关分析和回归分析结合起来，才能达到研究和分析的目的。</li>
</ol>
<p>相关分析与回归分析都是研究变量相互关系的分析方法，相关分析是回归分析的基础，而回归分析则是认识变量之间相关程度的具体形式。</p>
<h2 id="直线相关的类别"><a href="#直线相关的类别" class="headerlink" title="直线相关的类别"></a>直线相关的类别</h2><p>直线相关（linear correlation）又称简单相关（simple correlation），用于双变量正态分布（bivariate normal distribution）资料，直线在养的性质可由散点图直观的说明，看下图：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/K48HE5gGC4.png?imageslim" alt="mark"></p>
<p>第1张图和第2张图的散点呈椭圆形分布，若两变量X、Y同时增大或减小，变化趋势是同向的，称为正相关（positive correlation），反之，X、Y间呈反向变化，则是负相关（negative correlation），第5和第6张图中，散点基本上在一条直线上，若X、Y是同向变化，称为完全正相关（perfect positive correlation），反之，X、Y呈反向变化，称为完全负相关（perfect negative correlation），再看第第3、4、7、8这四张图，散点分布为圆形等一些形状，两变量之间没有直线相关关系，称为零相关（zero correlation）。正相关或负相关并不一定表示一个变量的改变是另一个变量变化的原因，有可能同受另一个因素的影响，因此，相关关系并不一定是因果关系，打个比方吧，某个地区每年七八月份溺水死亡的人数与雪糕的销量呈现正相关的关系，我们不能推断出来，是雪糕的销售与溺水死亡之间存在着因果关系，因为它们都受同一个因素的影响，就是天气，天气热，雪糕的销量自然高，下水游泳的人也多。</p>
<h2 id="Pearson相关系数"><a href="#Pearson相关系数" class="headerlink" title="Pearson相关系数"></a>Pearson相关系数</h2><p><strong>相关系数（coefficient of correlation）</strong>又称<strong>Pearson积差相关系数（coefficient of product-moment correlation）</strong>，以符号r表示样本相关系数，符号$\rho​$表示其总体相关系数，它用来说明直线关系的两个变量间相关的密切程度与相关方向。</p>
<p>如果$(x_{1},y_{1}),\cdots,(x_{n},y_{n})$为相应于这两个变量x和y的n个观侧值对子，那么Pearson相关系数的总体和样本形式分别如下所示：</p>
<p>总体相关系数$\rho$的计算公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/el118fDdkL.png?imageslim" alt="mark"></p>
<p>样本相关系数r的计算公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/c8EjkLii84.png?imageslim" alt="mark"></p>
<p>相关系数没有单位，其值为$-1\leq r \leq 1$，r值为正，表示正相关，r值为负表示负相关，r的绝对值等于1为完全相关，r=0为零相关，在生物界，由于影响因素众多，因此很少完全相关，注意：这里的r实际上是就总体相关系数$\rho$来说的，r是$\rho$的估计值。</p>
<p>上面的这两个公式反应了两个变量之间的关系。</p>
<ol>
<li>两个变量正线性相关。这时当x（相对于其样本均值）较大时，多数的y（相对于其样本均值）也应该较大；而当x相对于均值较小时，多数的y也应该相对于均值较小，无论在哪种情况下，分子中的$(X-\bar{X})$的符号和$(Y-\bar{Y})$的符号相同的就多，这样就得到一个较大的正值（但不会超过1）。通常来说，当r的值在0.75以上表示很强的相关，介于0.3到0.7之间为适中的相关性，而在0.25以下为很弱的相关性。</li>
<li>两个变量负线性相关。这时当x（相对于其样本均值）较大时，多数的y相对于其样本均较小；而当x相对于均值较小时，多数的y也应该相对于均值较大，而分子中的$(X-\bar{X})$的符号和$(X-\bar{X})$的符号相反的就多，这样就得到一个较大的负值（但不会小于-1）。</li>
<li>两个变量不线性相关。这时分子中的大于零的项和小于零的项的个数差不多，大小也不会差很多，这样公式的结果就是一个接近于0的数目。</li>
</ol>
<h2 id="直线相关的计算"><a href="#直线相关的计算" class="headerlink" title="直线相关的计算"></a>直线相关的计算</h2><h3 id="案例：直线相关"><a href="#案例：直线相关" class="headerlink" title="案例：直线相关"></a>案例：直线相关</h3><p>现在看一个案例，这个案例来源于《医学统计学》（第四版，孙振球）的第九章，具体内容如下所示：</p>
<p>某医师测量了15名正常成年人的体重（kg）与CT双肾总体积（ml）的大小，数据如下表所示，据引回答，两变量是否有关联？其方向与密切程度如何？</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>编号</th>
<th>体重（kg）</th>
<th>双肾总体积（ml）</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>43</td>
<td>217</td>
</tr>
<tr>
<td>2</td>
<td>74</td>
<td>316.18</td>
</tr>
<tr>
<td>3</td>
<td>51</td>
<td>231.11</td>
</tr>
<tr>
<td>4</td>
<td>58</td>
<td>220.96</td>
</tr>
<tr>
<td>5</td>
<td>50</td>
<td>254.7</td>
</tr>
<tr>
<td>6</td>
<td>65</td>
<td>293.84</td>
</tr>
<tr>
<td>7</td>
<td>54</td>
<td>263.28</td>
</tr>
<tr>
<td>8</td>
<td>57</td>
<td>271.73</td>
</tr>
<tr>
<td>9</td>
<td>67</td>
<td>263.46</td>
</tr>
<tr>
<td>10</td>
<td>69</td>
<td>276.53</td>
</tr>
<tr>
<td>11</td>
<td>80</td>
<td>341.15</td>
</tr>
<tr>
<td>12</td>
<td>48</td>
<td>261</td>
</tr>
<tr>
<td>13</td>
<td>38</td>
<td>213.2</td>
</tr>
<tr>
<td>14</td>
<td>85</td>
<td>315.12</td>
</tr>
<tr>
<td>15</td>
<td>54</td>
<td>252.08</td>
</tr>
</tbody>
</table>
</div>
<p>计算过程如下所示：</p>
<p>先绘制出散点图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">weight &lt;-c(<span class="number">43</span>,<span class="number">74</span>,<span class="number">51</span>,<span class="number">58</span>,<span class="number">50</span>,<span class="number">65</span>,<span class="number">54</span>,<span class="number">57</span>,<span class="number">67</span>,<span class="number">69</span>,<span class="number">80</span>,<span class="number">48</span>,<span class="number">38</span>,<span class="number">85</span>,<span class="number">54</span>)</div><div class="line">area &lt;-c(<span class="number">217</span>,<span class="number">316.18</span>,<span class="number">231.11</span>,<span class="number">220.96</span>,<span class="number">254.7</span>,<span class="number">293.84</span>,<span class="number">263.28</span>,<span class="number">271.73</span>,<span class="number">263.46</span>,<span class="number">276.53</span>,<span class="number">341.15</span>,<span class="number">261</span>,<span class="number">213.2</span>,<span class="number">315.12</span>,<span class="number">252.08</span>)</div><div class="line">plot(weight,area)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/L2gaj7AA3c.png?imageslim" alt="mark"></p>
<h3 id="相关系数的计算"><a href="#相关系数的计算" class="headerlink" title="相关系数的计算"></a>相关系数的计算</h3><p>现在计算一下相关系数，用<code>cor()</code>函数即可，<code>cor()</code>函数的用法为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cor(x,use=, mehtod= )</div><div class="line">其中，x是数据集，它可以是矩阵，可以是数据框</div><div class="line">use指定缺失数据的处理方式，可选的方式为all.obs（假设不存在缺失数据），everything（遇到缺失数据时，相关系数的计睡结果将被设为missing),complete.obs（行删除）以及pairwise.complete.obs（成对删除，pairwise deletion）</div><div class="line">method：指定的相关系数的类型，可选类型为pearson、spearman或kendall</div></pre></td></tr></table></figure>
<p>现在我们计算的是线性相关，使用的method参数为pearson（默认参数应时pearso，因此method参数可加不加），如果是直接计算两个变量的相关关系，也可以不使用数据框形式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; cor(weight,area)</div><div class="line">[<span class="number">1</span>] <span class="number">0.8754715</span></div></pre></td></tr></table></figure>
<h3 id="相关系数的统计推断"><a href="#相关系数的统计推断" class="headerlink" title="相关系数的统计推断"></a>相关系数的统计推断</h3><h4 id="相关系数的假设检验"><a href="#相关系数的假设检验" class="headerlink" title="相关系数的假设检验"></a>相关系数的假设检验</h4><p>从同一总体中抽出的不同样本会得到不同的样本相关系数，所以要判断X、Y之间是否确有直线相关关系，就要检验r是否来自于$rho\neq 0$的总体，因为即使从$\rho=0$的总体作随机抽样，由于抽样误差的影响，所得的r值也常不等于零。因此，当计算出r值后，接着要做$\rho=0$的假设检验，常用t检验，检验统计量t值的计算公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/3KF6Jc3GCE.png?imageslim" alt="mark"></p>
<p>其中，分母为相关系数的标准误，求得t值后，查t值表就可以得到p值，这个过程现在用软件就可以计算，现在我们计算以下前面的那个案例，也就浊对于所得到的r值，检验CT双肾总体积与体重是否有直线相关关系？</p>
<p>它的假设检验如下所示：</p>
<p>$H_{0}:\rho=0$，即CT双肾减少呢体积与体重之间无直线相关关系</p>
<p>$H_{1}:\rho\neq 0$，即CT双肾减少呢体积与体重之间有直线相关关系</p>
<p>$\alpha=0.05$，在本例中，n=15，r=0.8754，根据公式（二），可得</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/de0a8CKeCF.png?imageslim" alt="mark"></p>
<p>按$\nu=13$，查t值表可知，p&lt;0.001，按$\alpha=0.05$的检验水准，拒绝$H_{0}$，接受$H_{1}$，可以认为CT双肾总体积与体重之间存在正相关，现在用R来计算一下，此时使用<code>cor.test</code>函数，<code>cor.test()</code>函数的使用为<code>cor.test(x,y,alternative=,method=)</code>，参数如下所示：</p>
<p>alternative用来指定进行双侧检验或单侧检验（取值为”two.side”、”less”,”greater”）；</p>
<p>method用于指定要计算的类型（”pearson”、”kendall”或”spearman”），</p>
<p>当研究的假设为总体的相关系数小于0时，使用alternative=”less”参数，当研究的假设为总体的相关系数大于0时，使用alternative=”greater”参数，默认性下是使用alternative=”two.side”，表示总体相关系数不等于零，这个案例的计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(weight,area)</div><div class="line"></div><div class="line">	Pearson<span class="string">'s product-moment correlation</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  weight and area</span></div><div class="line"><span class="string">t = 6.5317, df = 13, p-value = 1.907e-05</span></div><div class="line"><span class="string">alternative hypothesis: true correlation is not equal to 0</span></div><div class="line"><span class="string">95 percent confidence interval:</span></div><div class="line"><span class="string"> 0.6585492 0.9580681</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      cor </span></div><div class="line"><span class="string">0.8754715</span></div></pre></td></tr></table></figure>
<p>现在我们看一下这个结果，在这个结果中，我们可以得到这些信息：</p>
<ol>
<li>对总体相关系数进行t检验，发现t值为6.5317，p值远远小于0.001，因此拒绝原假设，接受备选假设，也就是说，可以认为CT双肾总体积与体重之间存在正相关；</li>
<li>总体相关系数的95%置信区间为(0.6585492, 0.9580681)。</li>
</ol>
<h3 id="决定系数"><a href="#决定系数" class="headerlink" title="决定系数"></a>决定系数</h3><p>直线回归与相关分析中，还有一个非常重要的统计量，称为决定系数（coefficient of determination），定义为回归平方与总平方和之比（这里可以看一下<a href="http://rvdsd.top/2017/06/07/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-08%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/">《线性回归笔记》</a>），计算公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/jib3eBE2I6.png?imageslim" alt="mark"></p>
<p>为了方便描述，在双变量分析和多变量分析中，决定系数都用$R^2$表示，但是对于双变量分析矾，$R^2$就等于$r^2$，具体公式就是公式（一）。</p>
<p>$R^2$的聚会在0到1之间且无单位，其数值大小反映了回归贡献的相对程度，也就是在Y的总变异中，回归关系所能解释的百分比，公式三也说明了，当$SS_{总}$固定不变时，回归平方和的大小决定了相关系数r绝对值的大小，回归平方和越接近于总平方和，则r的绝对值越接近于1，说明相关的实际效果越好，在前面的案例中，15名成年人CT双肾总体积与体重之间的直线相关系数r=0.875，那么$R^2$=0.7656，表示在这批数据中，体重可解释双肾体积变异性的76.56%，另外约23%的变异不能用体重来解释，决定系数除了作为相关或回归拟合效果的概括统计量外，还可以利用它对回归或相关作假设检验，其中对直线回归的拟合优度检验就等价于对总体回归系数的假设检验，检验统计量为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/dLEAe6Lkbj.png?imageslim" alt="mark"></p>
<p>将此F统计量开平方根，就等于相对公式（二）中的相关系数做假设检验的t统计量，这又验证了相关与回归的假设检验是等价的。</p>
<h2 id="多元线性相关分析"><a href="#多元线性相关分析" class="headerlink" title="多元线性相关分析"></a>多元线性相关分析</h2><p>在相关分析中，研究较多的是两个变量之间的关系，称为简单相关，当涉及的变量为三个或三个以上时，称为偏相关或复相关，实际上偏相关（复相关）是对简单相关的一种推广。在有些情况下，我们只想了解两变量之间有元线性相关关系，并不需要建立它们之间的回归模型，也不需要区分自变量和因变量，这时候就可以使用较为方便的相关分析方法。</p>
<h3 id="矩阵相关分析"><a href="#矩阵相关分析" class="headerlink" title="矩阵相关分析"></a>矩阵相关分析</h3><p>设$x_{1},x_{2},\cdots,x_{n}$来自正态总体$N_{p}(\mu,\sum)$容量为n的样本，样本资料矩阵为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/H36IHG218a.png?imageslim" alt="mark"></p>
<p>此时，任意两个变量间的相关系数构成的矩阵为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/JAIFDed7eG.png?imageslim" alt="mark"></p>
<p>其中，$r_ij$为任意两个变量之间的简单相关系数，即：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/I6jmgkE985.png?imageslim" alt="mark"></p>
<h3 id="案例：多元相关分析"><a href="#案例：多元相关分析" class="headerlink" title="案例：多元相关分析"></a>案例：多元相关分析</h3><p>现在看一个案例，这个案例来源于《医学统计学》第四版.孙振球，案例描述如下：</p>
<p>27名糖尿病患者的血清总胆固醇、甘油三酯、空腹胰岛素、糖化血红蛋白、空腹血糖的测量值位于下表中，试计算这几个变量两两之间的相关系数。</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/aG3BEk29fH.png?imageslim" alt="mark"></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/abbIG27Ajm.png?imageslim" alt="mark"></p>
<p>第一步：计算两两变量之间的相关系数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mlr &lt;- read.table(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_1501.csv"</span>,header=<span class="literal">T</span>,sep=<span class="string">","</span>) <span class="comment"># 原始数据集</span></div><div class="line">cor(mlr[<span class="number">2</span>:<span class="number">6</span>])</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; cor(mlr[<span class="number">2</span>:<span class="number">6</span>])</div><div class="line">           X1          X2          X3         X4          Y</div><div class="line">X1  <span class="number">1.0000000</span>  <span class="number">0.63150583</span> -<span class="number">0.35479471</span>  <span class="number">0.4152708</span>  <span class="number">0.5585251</span></div><div class="line">X2  <span class="number">0.6315058</span>  <span class="number">1.00000000</span> -<span class="number">0.03863221</span>  <span class="number">0.2189743</span>  <span class="number">0.4585096</span></div><div class="line">X3 -<span class="number">0.3547947</span> -<span class="number">0.03863221</span>  <span class="number">1.00000000</span> -<span class="number">0.3297787</span> -<span class="number">0.5101213</span></div><div class="line">X4  <span class="number">0.4152708</span>  <span class="number">0.21897432</span> -<span class="number">0.32977870</span>  <span class="number">1.0000000</span>  <span class="number">0.6096420</span></div><div class="line">Y   <span class="number">0.5585251</span>  <span class="number">0.45850963</span> -<span class="number">0.51012130</span>  <span class="number">0.6096420</span>  <span class="number">1.0000000</span></div></pre></td></tr></table></figure>
<p>从上面的结果可以看出来，X4与血糖的高低最为密切，它的r值为0.609，接着是X1，它的r值是0.558。</p>
<p>第二步：绘制出两两间的矩阵散点图，使用<code>pairs()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pairs(mlr[<span class="number">2</span>:<span class="number">6</span>])</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/a1cca88Jf2.png?imageslim" alt="mark"></p>
<p>现在看一下相关系数的假设检验，这里用到的包是<code>mvstats</code>，但是这个包不在CRAN上，可能是《多元统计分析及R语言建模》（王斌会 ）自己写的，网上有，下载后安装即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(mvstats)</div><div class="line">&gt; corr.test(mlr[<span class="number">2</span>:<span class="number">6</span>])</div><div class="line">corr test: </div><div class="line">       X1      X2      X3     X4      Y</div><div class="line">X1  <span class="number">0.000</span>  <span class="number">0.0004</span>  <span class="number">0.0694</span> <span class="number">0.0312</span> <span class="number">0.0025</span></div><div class="line">X2  <span class="number">4.072</span>  <span class="number">0.0000</span>  <span class="number">0.8483</span> <span class="number">0.2725</span> <span class="number">0.0162</span></div><div class="line">X3 -<span class="number">1.897</span> -<span class="number">0.1933</span>  <span class="number">0.0000</span> <span class="number">0.0930</span> <span class="number">0.0066</span></div><div class="line">X4  <span class="number">2.283</span>  <span class="number">1.1221</span> -<span class="number">1.7466</span> <span class="number">0.0000</span> <span class="number">0.0007</span></div><div class="line">Y   <span class="number">3.367</span>  <span class="number">2.5797</span> -<span class="number">2.9655</span> <span class="number">3.8455</span> <span class="number">0.0000</span></div><div class="line">lower is t value，upper is p value</div></pre></td></tr></table></figure>
<p>左下角为t值，右上角为p值，现在把这个表格拆分一下就可以看清楚了，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/2Ea6fkmf9B.png?imageslim" alt="mark"></p>
<p>左下角是相关系数的t值，右上三解是p值，至于如何查看，还不清楚，略过，有空补上。</p>
<h2 id="Spearman秩相关"><a href="#Spearman秩相关" class="headerlink" title="Spearman秩相关"></a>Spearman秩相关</h2><h3 id="秩相关的使用范围"><a href="#秩相关的使用范围" class="headerlink" title="秩相关的使用范围"></a>秩相关的使用范围</h3><p>秩相关(rank correlation)又称等级相关，是用双变量等级数据作直线相关分析，这类方法对原变量分布不作要求，属于非参数统计法，这种方法适用于下列资料：</p>
<ol>
<li>不服从双变量正态分布而不宜作积差相关分析，这一点从原始数据的基本统计描述中或直观的散点图中就可以看出来；</li>
<li>总体分布型未知，例如限于仪器测量精度，个别样本的具体数值无法读取而出现“超限值”时；</li>
<li>原始数据是等级资料（例如某些药物治疗疾病的结果用恶化，没改善，好转来表示）。</li>
</ol>
<h3 id="秩相关的基本思想"><a href="#秩相关的基本思想" class="headerlink" title="秩相关的基本思想"></a>秩相关的基本思想</h3><p>在秩相关中，使用等级相关系数$r_{s}$来说明两个变量之间直线相关关系的密切程度与相关方向，其基本思想是将n对观察值$X_{i},Y_{i}(i=1,2,\cdots,n)$分别由小到大偏秩（秩就编号的意思，最小的是1，第2小的是2，最后1个是n），用$P_{i}$表示$X_{i}$的秩，用$Q_{i}$表示$Y_{i}$的秩，其中，每对$P_{i},Q_{i}$可能相等，也可能不等，这里考虑用$P_{i}$与$Q_{i}$之差来反映X、Y两变量秩排列一致性的情况，令$d_{i}=P_{i}-Q_{i}$，由于$d_{i}$可正可负，那么$\sum d_{i}$就无法准确地反映$P_{i}$与$Q_{i}$差值的大小，因此取$\sum {d_{i}}^2=\sum(P_{i}-Q_{i})^2$。在n为一定值时，当每对$X_{i},Y_{i}$的秩完全相等时，此为完全正相关，此时，$\sum {d_{i}}^2$有最小值，为0。当每对$X_{i},Y_{i}$的秩完全相反时，此为完全负相关，此时，$\sum {d_{i}}^2$有最大值，最大值如下所示：</p>
<p>$\sum {d_{i}}^2=\sum(P_{i}-Q_{i})^2=\sum[(n+1-i)-i]^2=n(n^2-1)/3$（公式五）</p>
<p>$\sum {d_{i}}^2$从0到其最大值的范围的变化，反映了X、Y两变量的相关程度，为了与积差相关系数r（这个r就是直线相关的相关系数）表示相关程度与方向的形式一致，那么过计算Spearman等级相关的系数$r_{s}$就如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/f66BKgJ424.png?imageslim" alt="mark"></p>
<p>$r_{s}$的值介于-1到1之间，当为正值时，表示正相关，为负表示负相关，等于0表示零相关，样本等级相关系数$r_{s}$是总体等级相关系数$\rho_{s}$的估计值，检验$\rho_{s}$是否不为零可以查表，当n&gt;50时，可以按下面的这个公式计算 检验统计量u，查u表确定p值，公式如下：</p>
<p>$\mu=r_{s} \sqrt{n-1}$（公式七）</p>
<h2 id="案例A：秩相关"><a href="#案例A：秩相关" class="headerlink" title="案例A：秩相关"></a>案例A：秩相关</h2><p>这个案例来源于《医学统计学》（第四版，孙振球），案例描述如下所示：</p>
<p>某省调查了1995年到1999年当地居民18类死因的构成以及每种死因导致的潜在工作损失年数WYPLL的构成，结果见下表，以死因构成为X，WYPLL构成为Y，作等级相关分析。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>死因类别</th>
<th>死因构成（%）</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>X</td>
<td>P</td>
<td>Y</td>
<td>Q</td>
<td>d</td>
<td>$d^2$</td>
</tr>
<tr>
<td>(1)</td>
<td>(2)</td>
<td>(3)</td>
<td>(4)</td>
<td>(5)</td>
<td>(6)=(3)-(5)</td>
<td>(7)=(6)^2</td>
</tr>
<tr>
<td>1</td>
<td>0.03</td>
<td>1</td>
<td>0.05</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>0.14</td>
<td>2</td>
<td>0.34</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>0.2</td>
<td>3</td>
<td>0.93</td>
<td>6</td>
<td>-3</td>
<td>9</td>
</tr>
<tr>
<td>4</td>
<td>0.43</td>
<td>4</td>
<td>0.69</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>0.44</td>
<td>5</td>
<td>0.38</td>
<td>3</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>6</td>
<td>0.45</td>
<td>6</td>
<td>0.79</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>7</td>
<td>0.47</td>
<td>7</td>
<td>1.19</td>
<td>8</td>
<td>-1</td>
<td>1</td>
</tr>
<tr>
<td>8</td>
<td>0.65</td>
<td>8</td>
<td>4.74</td>
<td>12</td>
<td>-4</td>
<td>16</td>
</tr>
<tr>
<td>9</td>
<td>0.95</td>
<td>9</td>
<td>2.31</td>
<td>9</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>10</td>
<td>0.96</td>
<td>10</td>
<td>5.95</td>
<td>14</td>
<td>-4</td>
<td>16</td>
</tr>
<tr>
<td>11</td>
<td>2.44</td>
<td>11</td>
<td>1.11</td>
<td>7</td>
<td>4</td>
<td>16</td>
</tr>
<tr>
<td>12</td>
<td>2.69</td>
<td>12</td>
<td>3.53</td>
<td>11</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>13</td>
<td>3.207</td>
<td>13</td>
<td>3.48</td>
<td>10</td>
<td>3</td>
<td>9</td>
</tr>
<tr>
<td>14</td>
<td>7.78</td>
<td>14</td>
<td>5.65</td>
<td>13</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>15</td>
<td>9.82</td>
<td>15</td>
<td>33.95</td>
<td>18</td>
<td>-3</td>
<td>9</td>
</tr>
<tr>
<td>16</td>
<td>18.93</td>
<td>16</td>
<td>17.16</td>
<td>17</td>
<td>-1</td>
<td>1</td>
</tr>
<tr>
<td>17</td>
<td>22.59</td>
<td>17</td>
<td>8.42</td>
<td>15</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>18</td>
<td>27.96</td>
<td>18</td>
<td>9.33</td>
<td>16</td>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
<p>假设检验：</p>
<p>$H_{0}:\rho_{s}=0$，即死因构成和WYPLL构成之间无直线相关关系</p>
<p>$H_{1}:\rho_{s} \neq0$，即死因构成和WYPLL构成之间有直线相关关系</p>
<p>$\alpha=0.05$</p>
<p>将两变量X、Y的实测值分别从小到大编秩，用$P_{i}$和${Q_{i}}$表示，见上表的(3)、(5)列，每个变量中若有观察值相同的秩，则取平均秩。求每天的秩的差值d、$d^2$，$\sum d^2$，也就是上表的第(6)、(7)栏，按前面的公式（六）计算$r_{s}$，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/C8GKLGAa77.png?imageslim" alt="mark"></p>
<p>在本例中，n=18，查$r_{s}$的界值表可知，p&lt;.0.001，按$\alpha=0.05$的检验水准，拒绝$H_{0}$，接受$H_{1}$，可认为当地居民死因的构成和和各种死因导致的潜在工作损失年数WYPLL的构成存在正相关关系。</p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">death_reason &lt;- c(<span class="number">0.03</span>,<span class="number">0.14</span>,<span class="number">0.2</span>,<span class="number">0.43</span>,<span class="number">0.44</span>,<span class="number">0.45</span>,<span class="number">0.47</span>,<span class="number">0.65</span>,<span class="number">0.95</span>,<span class="number">0.96</span>,<span class="number">2.44</span>,<span class="number">2.69</span>,<span class="number">3.207</span>,<span class="number">7.78</span>,<span class="number">9.82</span>,<span class="number">18.93</span>,<span class="number">22.59</span>,<span class="number">27.96</span>)</div><div class="line">wyypll &lt;-c(<span class="number">0.05</span>,<span class="number">0.34</span>,<span class="number">0.93</span>,<span class="number">0.69</span>,<span class="number">0.38</span>,<span class="number">0.79</span>,<span class="number">1.19</span>,<span class="number">4.74</span>,<span class="number">2.31</span>,<span class="number">5.95</span>,<span class="number">1.11</span>,<span class="number">3.53</span>,<span class="number">3.48</span>,<span class="number">5.65</span>,<span class="number">33.95</span>,<span class="number">17.16</span>,<span class="number">8.42</span>,<span class="number">9.33</span>)</div><div class="line">cor.test(death_reason,wyypll,method=<span class="string">"spearman"</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(death_reason,wyypll,method=<span class="string">"spearman"</span>)</div><div class="line"></div><div class="line">	Spearman<span class="string">'s rank correlation rho</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  death_reason and wyypll</span></div><div class="line"><span class="string">S = 92, p-value &lt; 2.2e-16</span></div><div class="line"><span class="string">alternative hypothesis: true rho is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      rho </span></div><div class="line"><span class="string">0.9050568</span></div></pre></td></tr></table></figure>
<p>其中，可以发现p值远小于0.01，因此，可认为当地居民死因的构成和和各种死因导致的潜在工作损失年数WYPLL的构成存在正相关关系。</p>
<h2 id="Kendall-τ相关系数"><a href="#Kendall-τ相关系数" class="headerlink" title="Kendall τ相关系数"></a>Kendall τ相关系数</h2><p>Kendall τ相关系数也是一种关于两个变量相关的度量，它的原理是把所有的样本点配对，如果$(x_{1},y_{1}),\cdots,(x_{n},y_{n})$是这两个变量的n个观测值对子。</p>
<p>如果每一个点由x和y组成的坐标(x,y)代表，一对点，就是诸如$(x_{i},y_{i})$和$(x_{j},y_{j})$的点对（这里的i和j不同）；然后看每一对中的x和y的观测值是否同时增加（或减少），比如由点对$(x_{1},y_{1})$和$(x_{2},y_{2})$可以算出乘积$(x_{2}-x_{1})(y_{2}-y_{1})$是否大于0。如果$(x_{2}-x_{1})(y_{2}-y_{1})$大于0，则说明这点中的x和y同时增长或下降。我们就说这两点<strong>协同(concordant)</strong>，如果这个乘积小于0，那么说明这两个点中的x和y并非同时增长或同时下降，我们称这两点<strong>不协同(discordant)</strong>。如果样本中协同的点数目多，两个变量就更加正相关一些；如果样本中不协同的点数目多，两个变量就更加负相关一些；如果既不正相关，也不负相关，则为不相关。</p>
<p>这种方法用不差对总体做任何假定也可以检验，因此这是一个非参数的检验（所谓非参数方法，就是它不依赖于变量背后的总体分布）。Kendall τ也是在-1和1之间的娄和，也是越接近1或-1就越相关，越接近于0就不相关。<br>和Kendall τ相联系也有零假设是“两个变量独立”的假设检验，即使在正态假定成立时，相对于和Pearson相关系数有关检验，这个检验的效率也很高，在正态假定不那么确定时，与Kendall τ有关的检验对查看两个变量的独立性是非常有用的。</p>
<p>现在我们看一下案例A使用Kenall进行计算的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">death_reason &lt;- c(<span class="number">0.03</span>,<span class="number">0.14</span>,<span class="number">0.2</span>,<span class="number">0.43</span>,<span class="number">0.44</span>,<span class="number">0.45</span>,<span class="number">0.47</span>,<span class="number">0.65</span>,<span class="number">0.95</span>,<span class="number">0.96</span>,<span class="number">2.44</span>,<span class="number">2.69</span>,<span class="number">3.207</span>,<span class="number">7.78</span>,<span class="number">9.82</span>,<span class="number">18.93</span>,<span class="number">22.59</span>,<span class="number">27.96</span>)</div><div class="line">wyypll &lt;-c(<span class="number">0.05</span>,<span class="number">0.34</span>,<span class="number">0.93</span>,<span class="number">0.69</span>,<span class="number">0.38</span>,<span class="number">0.79</span>,<span class="number">1.19</span>,<span class="number">4.74</span>,<span class="number">2.31</span>,<span class="number">5.95</span>,<span class="number">1.11</span>,<span class="number">3.53</span>,<span class="number">3.48</span>,<span class="number">5.65</span>,<span class="number">33.95</span>,<span class="number">17.16</span>,<span class="number">8.42</span>,<span class="number">9.33</span>)</div><div class="line">cor.test(death_reason,wyypll,method=<span class="string">"kendall"</span>)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; cor.test(death_reason,wyypll,method=<span class="string">"kendall"</span>)</div><div class="line"></div><div class="line">	Kendall<span class="string">'s rank correlation tau</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  death_reason and wyypll</span></div><div class="line"><span class="string">T = 133, p-value = 2.522e-06</span></div><div class="line"><span class="string">alternative hypothesis: true tau is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">      tau </span></div><div class="line"><span class="string">0.7385621</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看到，p值几乎为0，τ的相关系数为0.7385621。</p>
<h2 id="关于这三个相关系数"><a href="#关于这三个相关系数" class="headerlink" title="关于这三个相关系数"></a>关于这三个相关系数</h2><p>Pearson相关系数描述的是两个变量的线性关系，而Spearman和Kendall τ这两个非参数度量更为一般的关于单调关系的度量，这是因为一个变量的秩不会被任何对该变量的单调的严格递增的变换所改变，因此，把这两个非参数度量称为关联(association)的度量可能更为合适。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>医学统计学 第四版 孙振球</li>
<li>深入浅出统计学</li>
<li>多元统计分析及R语言建模（第4版） [Multivariate Statistical Analysis and Modeling for R Language]</li>
<li>从数据到结论.吴喜之</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/07/BioStatistics/生物统计-09线性回归/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/07/BioStatistics/生物统计-09线性回归/" itemprop="url">线性回归笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-07T12:02:00+08:00">
                2017-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  10,194
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  41
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="直线回归的概念"><a href="#直线回归的概念" class="headerlink" title="直线回归的概念"></a>直线回归的概念</h2><p>为了直观地说明直线回归的概念，我们以8名儿童的年龄（岁）与其尿肌酐含量（mmol/24h）数据绘制出一个散点图（scatter plot），原始数据如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>编号</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr>
<td>年龄X</td>
<td>13</td>
<td>11</td>
<td>9</td>
<td>6</td>
<td>8</td>
<td>10</td>
<td>12</td>
<td>7</td>
</tr>
<tr>
<td>尿肌酐含量Y</td>
<td>3.54</td>
<td>3.01</td>
<td>3.09</td>
<td>2.48</td>
<td>2.56</td>
<td>3.36</td>
<td>3.18</td>
<td>2.65</td>
</tr>
</tbody>
</table>
</div>
<p>现在绘图出这些数据的散点图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">age &lt;- c(<span class="number">13</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>,<span class="number">7</span>)</div><div class="line">cr &lt;- c(<span class="number">3.54</span>,<span class="number">3.01</span>,<span class="number">3.09</span>,<span class="number">2.48</span>,<span class="number">2.56</span>,<span class="number">3.36</span>,<span class="number">3.18</span>,<span class="number">2.65</span>)</div><div class="line">data001 &lt;- data.frame(age,cr)</div><div class="line">ggplot(data001, aes(x=age, y=cr)) + geom_point(size=<span class="number">3</span>,shape=<span class="number">21</span>)</div></pre></td></tr></table></figure>
<p>图表如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/i8CbCHbgIa.png?imageslim" alt="mark"></p>
<p>在定量描述儿童尿肌酐含量与年龄数据的依存关系时，将年龄称为<strong>自变量（independent variable）</strong>，用X表示，尿肌酐含量称为<strong>应变量（dependent variable）</strong>，用Y表示。由上图可知，尿肌酐含量Y随年龄X的增加而增大，呈直线趋势，但这8个数据点并非恰好全在一条直线上，不过我们可以找到一条最合适的直线来代表这两个变量的关系，这条曲线可以称为最佳拟合线，这两个变量的这种关系称为<strong>直线回归（linear regression）</strong>或<strong>简单回归（simple regression）。</strong></p>
<blockquote>
<h3 id="回归和分类的区别"><a href="#回归和分类的区别" class="headerlink" title="回归和分类的区别"></a>回归和分类的区别</h3><p>如果因变量为取值广泛的定量变量（数量变量），通常称该模型为回归（regression)，如果因变量为定性变量（分数变量），通常称建模为分类(classification)或判断分析(discriminant analysis)；如果没有给出因变量，要根据自变量本身来对以没值分类，则称为聚类分析(cluster analysis)。《从概念到数据分析》（吴喜之）。</p>
</blockquote>
<p>直线回归可以用以下<strong>直线回归方程（linear regression equation）</strong>来表示，如下所示：</p>
<p>$\hat{Y}=a+bX$ 或者写作$\hat{Y}=\hat{a}+\hat{b}X$    (公式一)</p>
<p>公式（一）称为经验回归方程或样本回归方程，其中b表示这条方程的斜率，a表示这个方程在y轴上的截矩，有的教材上把a与b写作是$\hat{a}​$和$\hat{b}​$，这两个字母上面的符号读作hat，称为“帽子”，它们表示利用样本的数据估计得得来的截矩和斜率。我们可以通过一系列的计算求出这个方程的a和b，这个方程是对两变量总体间线性关系的一个估计，根据散点图可以假设，对于X的各个取值，相应Y的总体均数$\mu_{Y|X}​$在一条直线上，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/fFlH2dh41C.png?imageslim" alt="mark"></p>
<p>总体均数表示为：$\mu_{Y|X}=\alpha+\beta X$    公式（二）</p>
<p>除了图中所示两变量呈直线关系外，一般还假定每个X对应Y的总体为正态分布，各个正态分布的总体方差相等且各次观测相互独立，这样公式（一）中的$\hat{Y}$实际上是x所对应Y的总体均数$\mu_{Y|X}$的一个样本估计值，称为回归方程的预测值（predicted value），而a、 b分别为$\alpha$和$\beta$的样本估计，其中a称为常数项，b称为回归系数（coefficient of regression），b是直线的斜率（slope），其统计意义是，当X变化一个单位时，Y的平均改变的估计值，b&gt;0时，直线从左下方走到右上方，Y随X的增大而增大，当b&lt;0时，直线从左上方走向右下方，Y随X的增大而减小；当b=0时，直线与X轴平行，Y与X没有关系。</p>
<h2 id="直线回归方程的计算思路"><a href="#直线回归方程的计算思路" class="headerlink" title="直线回归方程的计算思路"></a>直线回归方程的计算思路</h2><p>如果能够从样本数据中求得a和b的数值，那么回归方程即可唯一确定，从散点图上来看，求解a和b实际上就是怎么找到一条最能代表数据点分布趋势的直线，将实测值Y与假定回归线上估计值$\hat{Y}$（这个Y的上面有一个帽子结构的符号表示这是Y值的估计值）的纵向距离$Y-\hat{Y}$称为<strong>残差（residual）</strong>，残差通常用$e_{i}$表示，如果把残差进行了均一化，即进行了z转换，那它就是标准化残差，其中对于要找到的这条最佳的直线，它的<strong>残差平方和（sum of squared residuals, sum of squared errors或residual sum of squares，简称为SSE或RSS等）</strong>是最小的，这就是最小二乘法（Least sum of squares，LS）的思想（因为古中国的数学家在描述平方时，使用的术语是“二乘”，因此这里叫最小二乘法），如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/Jlg9aK0JG7.png?imageslim" alt="mark"></p>
<p>在一定假设条件下，如此得到的回归系数最为理解，按照这一原则，数学上可以很容易得到a和b的计算公式，如下所示：</p>
<p>$b=\frac{l_{XY}}{l_{XX}}=\frac{\sum(X-\bar{X})(Y-\bar{Y}))}{\sum(X-\bar{X})^2}$$    公式（三）（公式是如何得推导出来的，我不清楚，有空了补上）</p>
<p>$a=\bar{Y}-b \bar{X}$$    公式（四）（公式是如何得推导出来的，我不清楚，有空了补上）</p>
<p>其中，$l_{XY}$是X与Y的均离均差平交叉乘积和，简称离均差积和，公式为：</p>
<p>$l_{XY}=\sum(X-\bar{X})(Y-\bar{Y})=\sum XY-\frac{\sum(X)(\sum(Y)}{n}$   公式（五）</p>
<p>除了用公式（一）来表示两变量线性回归关系，还可以在散点图上绘制出样本回归直线作为一种直</p>
<p>观的统计描述补充形式，此直线必然通过点$(\bar{X},\bar{Y})$，且与纵坐标轴相关于截矩a，如果散点图没有从坐标系原点开始，可以在自变量实测范围内远端取易于读取的X值代入回归方程得到一个点的坐标，连接此点与点$(\bar{X},\bar{Y})$也能绘制出回归直线。</p>
<p>现在再看一下原始数据：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>编号</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr>
<td>年龄X</td>
<td>13</td>
<td>11</td>
<td>9</td>
<td>6</td>
<td>8</td>
<td>10</td>
<td>12</td>
<td>7</td>
</tr>
<tr>
<td>尿肌酐含量Y</td>
<td>3.54</td>
<td>3.01</td>
<td>3.09</td>
<td>2.48</td>
<td>2.56</td>
<td>3.36</td>
<td>3.18</td>
<td>2.65</td>
</tr>
</tbody>
</table>
</div>
<p>由原始数据与散点图可知，两变量之间呈直线趋势，因此可以计算出相应的参数：</p>
<h2 id="线性回归方程的计算过程"><a href="#线性回归方程的计算过程" class="headerlink" title="线性回归方程的计算过程"></a>线性回归方程的计算过程</h2><p>第一步：计算出X、Y的均值$\bar{X}$、$\bar{Y}$，离均差平方和$l_{XX}$、$l_{YY}$与离均差积和$l_{XY}$，如下所示：</p>
<p>$\bar{X}=\frac{\sum X}{n}=\frac{76}{8}=9.5,\bar{Y}=\frac{\sum X}{n}=\frac{23.87}{8}=9.5$</p>
<p>$l_{XX}=\sum X^2-\frac{(\sum X)^2}{n}=764-\frac{(76)^2}{8}=42$</p>
<p>$l_{YY}=\sum X^2-\frac{(\sum Y)^2}{n}=72.2683-\frac{(23.87)^2}{8}=1.0462$</p>
<p>$l_{YY}=\sum XY-\frac{(\sum X)(\sum Y)}{n}=232.61-\frac{(76)(23.87)}{8}=5.8450$</p>
<p>第二步：计算出回归系数b和截矩a</p>
<p>根据公式（三），b=5.8450/42=0.1392</p>
<p>根据公式（四），a=2.9838-(0.1392)(9.5)=1.667</p>
<p>列出直线回归方程，如下所示：</p>
<p>$\hat{Y}=0.1392X + 1.667$</p>
<p>R计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; lm(cr~age)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = cr ~ age)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line">(Intercept)          age  </div><div class="line">     <span class="number">1.6617</span>       <span class="number">0.1392</span></div></pre></td></tr></table></figure>
<h2 id="直线回归中的统计推断"><a href="#直线回归中的统计推断" class="headerlink" title="直线回归中的统计推断"></a>直线回归中的统计推断</h2><h3 id="回归方程的假设检验"><a href="#回归方程的假设检验" class="headerlink" title="回归方程的假设检验"></a>回归方程的假设检验</h3><p>建立样本直线回归方程，只是完成了统计分析中两个变量关系的描述，研究者还必须要回答它所来自总体的直线回归关系是否确实存在，即是否对总体有$\beta \neq 0$（$\beta$就是自变量与因变量的相关系数），如下图所示，无论X如何取值，$\mu_{Y|X}$总在一条水平线上，即$\beta=0$，总体直线回归方程并不成立，也就是说Y与X无直接线性关系，此时$\mu_{Y|X}=\mu_{Y}$，然而在一次随机抽样中，如果所得的样本为实心圆点所示，则会得到一个并不等于0的样本回归系数b，b与0相关多大可以认为具有统计学意义？这就需要方差分析或与其等价的t检验来说明问题。</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/1E4L2hJ510.png?imageslim" alt="mark"></p>
<h4 id="方差分析"><a href="#方差分析" class="headerlink" title="方差分析"></a>方差分析</h4><p>先看一张图，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/83E7EGFj70.png?imageslim" alt="mark"></p>
<p>在上图中，任意一点P的纵坐标被回归直线$\hat{Y}$与无数$\bar{Y}$截成三个线段，其中：$Y-\bar{Y}=(\hat{Y}-\bar{Y}=(Y-\hat{Y}))$。由于P点是散点图中任取的一点，将全部数据点都这样处理，并将等式两端平方后再求和，可以证明：</p>
<script type="math/tex; mode=display">\sum(\hat{Y}-\bar{Y})(Y-\hat{Y})=0$$(如何证明？)

那么有以下的公式：

$\sum(Y-\hat{Y})^2=\sum(\hat{Y}-\bar{Y})^2+\sum(\bar{Y}-\hat{Y})^2$

上面的公式用符号表示就是：$SS_{总}=SS_{回}+SS_{残}$（公式六)

其中，$SS_{总}$即$\sum(Y-\bar{Y})^2$，这是Y的离均差平方和，表示未考虑Y与X的回归关系时，Y的总变异。

$SS_{回}$即$\sum(\hat{Y}-\bar{Y})^2$，这是回归平方和，由于特定样本的均数$\bar{Y}$是固定的，因此这部分变异由$\hat{Y}_{i}$的大小不同引起，当X被引物回归以后，正是由于$X_{i}$的不同导致了$\hat{Y}=a+bX_{i}$的不同，所以，$SS_{回}$就反映了在Y的总变异中可以用Y与X的直线关系解释的那部分变异，b离0越远，Y受X的影响越大，$SS_{回}$就越大，说明回归效果就越好。

$SS_{残}$即$\sum({Y-\hat{Y}})^2$，为残差平方和。它反映了除了X对Y的线性影响之外的一切因素对Y的变异的作用，也就是在总平方和中无法用X解释的部分，表示考虑回归之后Y真正的随机误差，在散点图中，各实测点离回归直线越近，$SS_{残}$也就越小，说明直线回归的估计误差越小，回归的作用就越明显。

上述的三个平方和，各有其相应的自由度$\nu$，并有如下的关系：

$\nu_{总}=\nu_{回}+\nu_{残},  \nu_{总}=n-1, \nu_{回}=1, \nu_{残}=n-2$

从以上离均差平方和及其自由度的分解可知，不考虑回归时，随机误差是Y的总变异$SS_{总}$，而考虑回归以后，由于回归的贡献，使原来的随机误差减小为$SS_{残}$，如果两变量之间总体回归关系确实存在，回归的贡献就要大于随机误差，大到何种程度时可以认为具有统计学意义，可以计算如下F统计量（其实就是方差分析了），如下所示：

$F=\frac{SS_{回}/\nu_{回}}{SS_{残}/\nu_{残}}=\frac{MS_{回}}{MS_{残}}, \nu_{回}=1, \nu_{残}=n-2$（公式八）

在这个公式中，$MS_{回}$、$MS_{残}$分别称为回归均方与残差均方，统计量F服从自由度为$\nu_{回}$，$\nu_{残}$的F分布，求F值后，查F界值表，得到p值，按所取检验水准作为推断结论。实际计算时，可以先将$X_{i}$依次代入回归方程，求得${\hat{Y}}$，再求得$SS_{残}$，$SS_{回}$也可以利用下面的公式直接求出$SS_{回}$，再得到$SS_{残}$，如下所示：

$SS_{回}=bl_{XY}=l^2_{XY}/l_{XX}=b^2l_{XX}$（公式九）

#### t检验

对于$\beta=0$这一假设是否成立还可以进行如下t检验，如下所示：

$t=\frac{b-0}{S_{b}},\nu=n-2$（公式十）

$S_{b}=\frac{S_{Y \cdot X}}{\sqrt{L_{XX}}}$$（公式十一）

$S_{X \cdot Y}=\sqrt{\frac{SS_{残}}{n-2}}$$（公式十二）

其中，$SS_{Y\cdot X}$是回归的剩余标准差（standard deviation of residuals），$S_{b}$是样本回归系数标准误，这些计算公式表明，扩大自变量的取值范围可以减小$S_{b}$，使得回归系数的估计更稳定。




## 第1案例：简单线性回归

现在我们看一下前面的数据得到的直线回归方程是否成立，前面得到的线性回归方程如下所示：

$\hat{Y}=0.1392X + 1.667$

### 方差分析

$H_{0}:\beta=0$，即尿肌酐含量与年龄之间无直线关系。

$H_{1}:\beta \neq 0$，即尿肌酐含量与年龄之间有直线关系。

$\alpha=0.05$

根据公式（九），可知$SS_{回}=l^2_{XY}/l_{XX}=5.845^2/42=0.8134$

根据公式（六），可知$SS_{残}=SS_{总}-SS_{回}=1.0462-0.8134=0.2328$

下面是方差分析表，如下所示：

| 变异来源 | 自由度 | SS     | MS     | F      | P     |
| -------- | ------ | ------ | ------ | ------ | ----- |
| 变异来源 | 7      | 10462  |        |        |       |
| 回归     | 1      | 0.8134 | 0.8134 | 20.963 | <0.01 |
| 残差     | 6      | 0.2328 | 0.0388 |        |       |

$\nu_{1}=1$、$\nu_{2}=6$，查F界值表，得P<0.01，按$\alpha=0.05$的检验水准，拒绝$H_{0}$，接受$H_{1}$，可以认为尿肌酐含量与年龄宰有直线关系。

### t检验

t检验的$H_{0}$、${H_{1}}$与$\alpha$同上，在这个案例中，n=8，$SS_{残}=0.2328$、$L_{XX}=42$，b=0.1392，根据公式（十），公式（十一），公式（十二），可得：

$S_{Y\cdot X}=\sqrt{\frac{0.2328}{8-2}}=0.1970$, S_{b}=\frac{0.1970}{\sqrt{42}}=0.0304</script><p>$t=\frac{0.1392}{0.0304}=4.579$</p>
<p>由于$\nu=6$，查t界值表可知，0.002&lt;P&lt;0.005，按照$\alpha=0.05$的检验水准，拒绝$H_{0}$，接受$H_{1}$，可以认为尿肌酐含量与年龄间有直线关系。注意，在本例中，$\sqrt{F}=\sqrt{20.97}=4.579=t$，实际上直线回归中对回归系数的t检验与F检验等价，类似于两样本均数比较可以作为t检验，也可以做方差分析。</p>
<p>这里要说明一下，两个变量关系的密切程度或数量上的影响大小的统计量是相关系数或者是另归系数的绝对值r，而不是假设检验的p值，p值越小，只能说越有理由谇国变量间的直线关系存在，而不能说关系越密切或越“显著”。另外，直线回归用于预测时，其适用范围一般不应超出样本中自变量的取值范围，此时求得的预测值称炒内插（interpolation），而超过自变量取值范围所得预测值称为外延（extrapolation），若元充分理由说明现有自变量范围以外的两变量间仍然是直线关系，应尽量避免不合理的外延，举个例子，我们在使用BCA测蛋白浓度时，标准品的浓度范围是0-0.5ug/uL，我们构建的线性回归方程是<code>蛋白浓度=a X OD562 + b</code>，如果我们的样本OD562的吸光度超过了标准品最高浓度的OD562的值（例如标准品0.5ug/uL的OD562值是0.4，我的蛋白样本的OD562的值是0.45），那么此时，我们使用求出来的线性回归方程来计算蛋白样本中的蛋白浓度是不太准的。</p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; result &lt;- lm(cr~age)</div><div class="line">&gt; summary(result)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = cr ~ age)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">     Min       1Q   Median       3Q      Max </div><div class="line">-<span class="number">0.21500</span> -<span class="number">0.15937</span> -<span class="number">0.00125</span>  <span class="number">0.09583</span>  <span class="number">0.30667</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)   </div><div class="line">(Intercept)  <span class="number">1.66167</span>    <span class="number">0.29700</span>   <span class="number">5.595</span>  <span class="number">0.00139</span> **</div><div class="line">age          <span class="number">0.13917</span>    <span class="number">0.03039</span>   <span class="number">4.579</span>  <span class="number">0.00377</span> **</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">0.197</span> on <span class="number">6</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.7775</span>,	Adjusted R-squared:  <span class="number">0.7404</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">20.97</span> on <span class="number">1</span> and <span class="number">6</span> DF,  p-value: <span class="number">0.003774</span></div></pre></td></tr></table></figure>
<p>结果解释：</p>
<ol>
<li><p>其中0.4.579是对系数（斜率）是否为零t的检验，t=4.579,p&lt;0.00377，表示斜率不为零，它的零假设为$H_{0}:\beta=0$，而备选假设为$H_{1}:\beta \neq 0$。  </p>
</li>
<li><p>Residual standard error: 0.197 on 6 degrees of freedom，这个是残差，自由度为6</p>
</li>
<li><p>Multiple R-squared: 0.7775, Adjusted R-squared: 0.7404，R平方，叫测定系数或可决系数，越接近于1表示两者的线性关系越好。</p>
</li>
<li><p>F-statistic: 20.97 on 1 and 6 DF, p-value: 0.003774，F检验，p值小于0.01，在只一个自变量的情况下，F检验的p值与t检验的p值在数值上相等，并且F的值等于t值的平方。</p>
</li>
</ol>
<h3 id="总体回归系数-beta-的可信区间"><a href="#总体回归系数-beta-的可信区间" class="headerlink" title="总体回归系数$\beta$的可信区间"></a>总体回归系数$\beta$的可信区间</h3><p>利用上述对回归系数的t检验，我们可以得到$\beta$的$1-\alpha$的置信区间为</p>
<p>$b\pm t_{\alpha/2,\nu}S_{b}$ （公式十三）</p>
<p>根据前面计算的结果，b=0.1392，$S_{b}=0.0304$，按自由度为6，查t界值表，得到t值为2.447，那么根据公式（十三），我们可以计算出$\beta$的95%置信区间，如下所示：</p>
<p>$(0.1392-2.447 \times0.0304,0.1392+2.447 \times0.0304)$</p>
<p>即$(0.0648,0.2136)$，需要注意的是，这个区间不包括0，可按$\alpha=0.05$水准同样得到总体回归系数不为0的结论，即用区间估计回答相同$\alpha$时的假设检验问题。</p>
<h3 id="利用回归方程进行估计和预测"><a href="#利用回归方程进行估计和预测" class="headerlink" title="利用回归方程进行估计和预测"></a>利用回归方程进行估计和预测</h3><h4 id="总体均数-mu-Y-X-的可信区间"><a href="#总体均数-mu-Y-X-的可信区间" class="headerlink" title="总体均数$\mu_{Y|X}$的可信区间"></a>总体均数$\mu_{Y|X}$的可信区间</h4><p>给定X的数值$X_{0}$，由样本回归方程计算出的$\hat{Y}$只是相应总体均数$\mu_{Y|X}$的一个点估计，$\hat{Y}_{0}$会因样本而异，存在抽样误差，反映其抽样误差的标准误按以下公式计算：</p>
<p>$S_{\hat{Y}_{0}}=S_{Y\cdot X}\sqrt{\frac{1}{n}-\frac{(X_{0}-\bar{X})^2}{\sum(X-\bar{X})^2}}$（公式十四）</p>
<p>$\hat{Y}$的标准误与回归的剩余标准差$S_{Y\cdot X}$成正比，当$X_{0}=\bar{X}$时，达到其最小值$S_{Y\cdot X}/\sqrt{n}$，$X_{0}$离$\bar{X}$越远，其标准误$S_{\hat{Y}_{0}}$越大，给定$X=X_{0}$时，总体均数$\nu_{Y|X_{0}}$的$1-\alpha$的置信区间为</p>
<p>$\hat{Y}_{0}\pm t_{\alpha/2,\nu},S_{\hat{Y}_{0}}$（公式十五）</p>
<p>在直角坐标系占，（公式十五）表示一条中间窄，两端宽的带子，如下所示图中的两条实曲线所示，其中最窄处对应$X_{0}=\bar{X}$，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/fk66iDA0I7.png?imageslim" alt="mark"></p>
<h4 id="个体Y值的预测区间"><a href="#个体Y值的预测区间" class="headerlink" title="个体Y值的预测区间"></a>个体Y值的预测区间</h4><p>预测应时把自变量X代入到回归方程，对总体中的应变量量Y的个体值进行预测，给定X的数值$X_{0}$，对应的个体Y值也存在一个波动范围，其标准差$S_{Y_{0}}$按公式十六计算，如下所示：</p>
<p>$S_{Y_{0}}=S_{Y\cdot X} \sqrt{1+\frac{1}{n}+\frac{(X_{0}-\bar{X})^2}{\sum(X-\bar{X})^2}}$$（公式十六）</p>
<p>于是给定$X=X_{0}$时，个体Y值的$1-\alpha$的预测区间为</p>
<p><script type="math/tex">\hat{Y_{0}}\pm t_{\alpha/2,\nu} S_{Y_{0}}</script>（公式十七）</p>
<p>在上图中，有两条虚曲线，这两条虚曲线比实曲线范围更宽，它也是中间窄，两头宽，同样在$X_{0}=\bar{X}$处最窄。</p>
<p>需要注意的是，在给定$X=X_{0}$处，相应Y的均数的置信区间与其个体Y值的预测区间的含义是不同的：前者表示在固定的$X_{0}$处，如果反复抽样100次，可以算出100个相应Y的总体均数的置信区间，平均有100x(1-$\alpha$)个置信区间包含总体均数；后者表示的是一个预测值的取值范围，即预测100个个体值中平均将有100x(1-$\alpha$)个个体值在求出的范围内。</p>
<p>现在我们用这个案例中所求的直线回归方程，计算当$X_{0}=12$时，$\nu_{Y|X_{0}}$的95%置信区间和相应个体Y值的95%预测区间，前面我们知道，这个方程为$\hat{Y}=0.1392X + 1.667$，另外还知道$\bar{X}=9.5,l_{XX}=42$，面还计算出了$S_{Y\cdot X}=0.1970$，当$X_{0}=12$时，$\hat{Y}=1.6617+0.1392\times 12=3.3321$，根据公式十四和公式十六可得：</p>
<p>$S_{\hat{Y_{0}}}=0.1970\sqrt{\frac{1}{8}+\frac{(12-9.5)^2}{42}}=0.1031$</p>
<p>$S_{Y_{0}}=0.1970\sqrt{1+\frac{1}{8}+\frac{(12-9.5)^2}{42}}=0.2223$</p>
<p>查表可知$t_{0.05/2,6}=2.447$，因此按公式十五可知，当$X_{0}=12$时，尿肌酐含量总体均数的95%置信区间为：</p>
<p>$(3.3321-2.447\times 0.1031,3.3321+2.447\times 0.1031)=(3.080,3.584)$</p>
<p>按公式十七，当$X_{0}=12$时，尿肌酐含量个体值的95%预测区间为：</p>
<p>$(3.3321-2.447\times 0.2223,3.3321+2.447\times 0.2223)=(2.788,3.876)$</p>
<p>现在用R来计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; data94 &lt;- data.frame(age=<span class="number">12</span>)</div><div class="line">&gt; predict(result,data94,interval=<span class="string">"prediction"</span>,level=<span class="number">0.95</span>) <span class="comment"># 预测区间</span></div><div class="line">       fit      lwr      upr</div><div class="line"><span class="number">1</span> <span class="number">3.331667</span> <span class="number">2.787731</span> <span class="number">3.875602</span></div><div class="line">&gt; predict(result,data94,interval=<span class="string">"confidence"</span>,level=<span class="number">0.95</span>) <span class="comment"># 均数的可信区间</span></div><div class="line">       fit      lwr      upr</div><div class="line"><span class="number">1</span> <span class="number">3.331667</span> <span class="number">3.079481</span> <span class="number">3.583852</span></div></pre></td></tr></table></figure>
<h2 id="第2个案例：简单线性回归及诊断"><a href="#第2个案例：简单线性回归及诊断" class="headerlink" title="第2个案例：简单线性回归及诊断"></a>第2个案例：简单线性回归及诊断</h2><p>在这个案例中，我们按照正常的直线加中归的流程计算一下，这个案例源于《医学统计学及SAS应用》（王炳顺）。</p>
<h3 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h3><p>在研究某抗心律扮演药对电刺激狗右心室致颤阈的影响，实验测得狗静脉注射不同剂量心律扮演药与右心室致颤阈的数据如下表所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>药物剂量/(mg/kg)</th>
<th>1</th>
<th>3</th>
<th>5</th>
<th>7</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>阈值提高/V</td>
<td>8.03</td>
<td>14.97</td>
<td>19.23</td>
<td>27.83</td>
<td>36.23</td>
</tr>
</tbody>
</table>
</div>
<h3 id="第一步：绘制散点图"><a href="#第一步：绘制散点图" class="headerlink" title="第一步：绘制散点图"></a>第一步：绘制散点图</h3><p>线性回归的第一步通常是绘制两个变量的散点图，在绘制的散点图中，x值表示药的剂量，y轴表示的是阈值的提高值，最终计算出来的线性方程应该是y(阈值提高值)=bx(药物剂量)+a，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dose &lt;-c(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</div><div class="line">value&lt;-c(<span class="number">8.03</span>,<span class="number">14.97</span>,<span class="number">19.23</span>,<span class="number">27.83</span>,<span class="number">36.23</span>)</div><div class="line">drug_data &lt;- data.frame(dose,value)</div><div class="line">ggplot(drug_data,aes(x=dose,y=value))+ geom_point()</div></pre></td></tr></table></figure>
<p>散点图如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/C5JimCkfKc.png?imageslim" alt="mark"></p>
<h3 id="第二步：估计回归系数"><a href="#第二步：估计回归系数" class="headerlink" title="第二步：估计回归系数"></a>第二步：估计回归系数</h3><p>直接使用<code>lm()</code>函数即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lm.drug_data &lt;- lm(value~dose,data=drug_data)</div><div class="line">summary(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; lm.drug_data &lt;- lm(value~dose,data=drug_data)</div><div class="line">&gt; summary(lm.drug_data)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = value ~ dose, data = drug_data)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">     <span class="number">1</span>      <span class="number">2</span>      <span class="number">3</span>      <span class="number">4</span>      <span class="number">5</span> </div><div class="line"> <span class="number">0.624</span>  <span class="number">0.638</span> -<span class="number">2.028</span> -<span class="number">0.354</span>  <span class="number">1.120</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)    </div><div class="line">(Intercept)   <span class="number">3.9430</span>     <span class="number">1.3151</span>   <span class="number">2.998</span> <span class="number">0.057748</span> .  </div><div class="line">dose          <span class="number">3.4630</span>     <span class="number">0.2289</span>  <span class="number">15.127</span> <span class="number">0.000627</span> ***</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">1.448</span> on <span class="number">3</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.9871</span>,	Adjusted R-squared:  <span class="number">0.9827</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">228.8</span> on <span class="number">1</span> and <span class="number">3</span> DF,  p-value: <span class="number">0.0006272</span></div></pre></td></tr></table></figure>
<p>结果解释：</p>
<ol>
<li>从结果中我们可以看出来，我们所求的方程y(阈值提高值)=bx(药物剂量)+a中，截矩a的值是3.9430，斜率b的值是3.4630。</li>
<li>R计算的结果中还有t检验的值，与相应的p值，我们可以发现，斜率b的t检验的值小于0.001，这个值是必须要小于0.01的，也就是说必须要显著性意义，而截矩的值，不用管它。</li>
<li>线性方程的自由度是3，残差的标准差为1.448。</li>
<li>$R^2$是0.9871，它表示药物的剂量可以解释98.71%的变异，后面的是调整R的平方值。</li>
<li>F统计量的值为228.8，它的两个自由度为1和3，p值为0.0006272。</li>
</ol>
<h3 id="第三步：回归诊断"><a href="#第三步：回归诊断" class="headerlink" title="第三步：回归诊断"></a>第三步：回归诊断</h3><p>回归诊断的内容主要有三个方面：</p>
<ol>
<li>误差项是否满足独立性、等方差性和正态性，选择模型是否合适。</li>
<li>是否存在异常样本，回归分析的结果是否对某些样本依赖过重，即回归模型是否具备稳定性。</li>
<li>自变量之间是否存在高度相关，即是否有多重共线性问题存在。 </li>
</ol>
<p>计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</div><div class="line">plot(lm.drug_data)</div></pre></td></tr></table></figure>
<p>图片结果如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/DI9h80a7Ba.png?imageslim" alt="mark"></p>
<p>现在解释一下这些图形：</p>
<p>第一张图（左上），残差图。在构建线性回归模型时，通常采用的是最小二乘法来估计回归系数，并在此基础上作进一步的推断，前文中对其应用条件已经有强调，例如应变量与自变量的关系为线性、误差服从均数为0的正态分布，且方差相等、各观测独立等。如果实际数据不满足这些假设而直接拿来做线性回归，那么就会得到专业上无法解释的导论，至少会影响回归估计的精度与假设检验的p值，对于这些条件的检查，较为简单有效的方法就是考虑回归的<strong>残差图（residual plot）</strong>。残差图一般是将现在有模型求出来的各点残差$e_{i}=Y_{i}-\hat{Y_{i}}$作为纵坐标，相应的预测值$\hat{Y}$或者自变量取值X作为横坐标来绘制的，如果数据符合模型的基本假设，那么残差与回归预测值的散点图基本上都是呈0的上下随机分布，而不是会表现出任何特殊的结构。在这张图形中，Residual vs fitted为拟合值y对残差的图形, 可以看出,数据点都基本均匀地分布在直线y=0的两侧, 无明显趋势，满足线性假设。</p>
<p>现在我们看一些比较异常的残差图，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/32JG4DCC2b.png?imageslim" alt="mark"></p>
<p>其中a图是正常的残差图，它的残差均匀地分布在0的上面侧，说明此数据用于拟合直线回归方程是恰当的。b图，是某农药厂工人全血胆碱酯酶活性Y与工龄X进行直线回归得到的残差图，其中可以发现有一个点的残差相对于其他的点大很多，这就是一个异常点，可以考虑删除或改用其他可减小离群点影响的回归分析方法。c图是锡克反应性率Y与1-3岁儿童年龄X之间经直线回归得到的残差图，图中的残差与回归预测值表现为曲线关系，提示在目前的直线回归模型中加入自变量的二次项可能改善拟合效果（原因书中没提到，我也不明白），d图为舒张压Y与女性儿童年龄X之间直线回归的残差图，图中的残差呈喇叭口形状，说明误差的方差不剂，应考虑某种对方差进行稳定化的处理，e图表示残差之间不独立，可以看到残差与各个观测的测量时间存在较强的相关。（医学统计学.第四版.孙振球）</p>
<p>第二张图（右上），当预测变量值固定时，因变量成正态分布，则残差图也应是一个均值为0的正态分布。正态Q-Q图是在正态颁对应的值上，标准化残差的概率图，若满足正态假设，则图上的点应该落在45度角的直线上，若不是，则违反了正态性假设。第二幅（右上），Normal QQ-plot图中数据点分布趋于一条直线, 说明残差是服从正态分布的，用于回归的自变量的标准化残差落在(-2，2)区间以外的概率要≤0.05，若某一自变量数值的标准化残差落在(-2，2)区间以外，可在95%置信度将其判为异常实验点，不参与回归直线拟合。 </p>
<p>第三幅图位置尺度图（Scale-Location Graph）中，水平线周围的点应随机分布，Scale-Location 图显示了标准化残差(standardized residuals)的平方根的分布情况，最高点为残差最大值点。第三副图显示基本符合方差齐性的要求。</p>
<p>第四幅图（Residuals vs Leverage）提供了单个观测点的信息，从图中可以鉴别离群点、高高杆值点和强影响点，主要是通过Cook距离(Cook’s distance)显示各个点对回归的影响点 </p>
<p>还可以使用<code>shapiro.test</code>函数对线性回归方程的残差正态性进行验证，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; shapiro.test(residuals(lm.drug_data))</div><div class="line"></div><div class="line">	Shapiro-Wilk normality test</div><div class="line"></div><div class="line">data:  residuals(lm.drug_data)</div><div class="line">W = <span class="number">0.86452</span>, p-value = <span class="number">0.2449</span></div></pre></td></tr></table></figure>
<p>正态性检验结果表明W值为0.86452，P值为0.2449，说明残差符合正态分布。 </p>
<h4 id="有关残差图"><a href="#有关残差图" class="headerlink" title="有关残差图"></a>有关残差图</h4><p>在构建线性回归模型时，通常采用的是最小二乘法来估计回归系数，并在此基础上作进一步的推断，前文中对其应用条件已经有强调，例如应变量与自变量的关系为线性、误差服从均数为0的正态分布，且方差相等、各观测独立等。如果实际数据不满足这些假设而直接拿来做线性回归，那么就会得到专业上无法解释的导论，至少会影响回归估计的精度与假设检验的p值，对于这些条件的检查，较为简单有效的方法就是考虑回归的残差图（residual plot）。</p>
<p>残差图一般是将现在有模型求出来的各点残差$e_{i}=Y_{i}-\hat{Y_{i}}$作为纵坐标，相应的预测值$\hat{Y}$或者自变量取值X作为横坐标来绘制的，如果数据符合模型的基本假设，那么残差与回归预测值的散点图基本上都是呈0的上下随机分布，而不是会表现出任何特殊的结构。</p>
<h4 id="独立性检验"><a href="#独立性检验" class="headerlink" title="独立性检验"></a>独立性检验</h4><p>判断因变量（或残差）最好的方法时依据收集数据的方式的先验知识。lmtest包提供了dwtest检验函数，car包提供了Durbin-Watson检验的函数，都能够检验误差序列的相关性，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"lmtest"</span>)</div><div class="line"><span class="keyword">library</span>(lmtest)</div><div class="line">dwtest(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; dwtest(lm.drug_data)</div><div class="line"></div><div class="line">	Durbin-Watson test</div><div class="line"></div><div class="line">data:  lm.drug_data</div><div class="line">DW = <span class="number">1.9213</span>, p-value = <span class="number">0.1807</span></div><div class="line">alternative hypothesis: true autocorrelation is greater than <span class="number">0</span></div></pre></td></tr></table></figure>
<p>本例结果中DW值为1.9213，我不清楚这个p值的意义是什么，不过从网上的资料来看，DW值越接近于2，表示检验结果越理想。</p>
<p>另外一种独立性检验方法是使用car包中的crPlots()函数绘制偏残差图(partial residual plot )，也叫成分残差图(component plus residual plot) ，来显示因变量与自变量之间是否呈非线性关系，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(car)</div><div class="line">crPlots(lm.drug_data)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/h09c1b02Bg.png?imageslim" alt="mark"></p>
<p>car包中还有一个<code>linearHypothesis</code>函数用于线性假设检验，比图形更准，其中<code>dose=0</code>表示要检验自变量dose的系数是否为0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">linearHypothesis(lm.drug_data)</div></pre></td></tr></table></figure>
<p>P值小于0.05，可以认为x的系数不为0。 </p>
<h4 id="方差齐性"><a href="#方差齐性" class="headerlink" title="方差齐性"></a>方差齐性</h4><p>通过以因变量为x轴，学生化残差为y轴做残差图，进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(predict(lm.drug_data),rstudent(lm.drug_data))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/9BBLl8leIK.png?imageslim" alt="mark"></p>
<p>所有的学生化残差均在$\pm 2$的范围内波动，没有明显的上升或下降趋势，可以认为符合方差齐性。还通过自变量与残差绝对值的等级相关检验来判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"pspearman"</span>)</div><div class="line"><span class="keyword">library</span>(pspearman)</div><div class="line">spearman.test(dose,abs(residuals(lm.drug_data))) </div><div class="line"><span class="comment">#R中pspearman包中的spearman.</span></div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; spearman.test(dose,abs(residuals(lm.drug_data)))</div><div class="line"></div><div class="line">	Spearman<span class="string">'s rank correlation rho</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">data:  dose and abs(residuals(lm.drug_data))</span></div><div class="line"><span class="string">S = 16, p-value = 0.7833</span></div><div class="line"><span class="string">alternative hypothesis: true rho is not equal to 0</span></div><div class="line"><span class="string">sample estimates:</span></div><div class="line"><span class="string">rho </span></div><div class="line"><span class="string">0.2</span></div></pre></td></tr></table></figure>
<p>自变量与残差绝对值的等级相关系数为0.2，P值大于0.05，无统计学意义，可以认为残差方差齐性。 car包提供了两个有用的函数，可判断误差方差是否恒定，<code>ncvTest()</code>函数生成一个计分检验，零假设为误差方差不变,备择假设为误差方差随着拟合值水平的变化而变化。若检验显著，择说明存在异方差性。<code>spreadLevelPlot()</code>函数创建一个添加了最佳拟合曲线的散点图，展示标准化残差绝对值与拟合值的关系，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; ncvTest(lm.drug_data)</div><div class="line">Non-constant Variance Score Test </div><div class="line">Variance formula: ~ fitted.values </div><div class="line">Chisquare = <span class="number">0.06629594</span>    Df = <span class="number">1</span>     p = <span class="number">0.7968083</span> </div><div class="line">&gt;spreadLevelPlot(lm.drug_data)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/FGkC4IJiE6.png?imageslim" alt="mark"></p>
<p>计分检验结果不显著，说明满足方差齐性的假设。通过水平分布图，可以看到其中的点在水平的最佳拟合曲线周围呈水平随机分布。若违反了该假设，将会呈现一个非水平的曲线。</p>
<h4 id="线性模型假设的综合验证"><a href="#线性模型假设的综合验证" class="headerlink" title="线性模型假设的综合验证"></a>线性模型假设的综合验证</h4><p>使用gvlma中的<code>gvlma()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"gvlma"</span>)</div><div class="line"><span class="keyword">library</span>(gvlma)</div><div class="line">gvlma(lm.drug_data)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; gvlma(lm.drug_data)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = value ~ dose, data = drug_data)</div><div class="line"></div><div class="line">Coefficients:</div><div class="line">(Intercept)         dose  </div><div class="line">      <span class="number">3.943</span>        <span class="number">3.463</span>  </div><div class="line"></div><div class="line"></div><div class="line">ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS</div><div class="line">USING THE GLOBAL TEST ON <span class="number">4</span> DEGREES-OF-FREEDOM:</div><div class="line">Level of Significance =  <span class="number">0.05</span> </div><div class="line"></div><div class="line">Call:</div><div class="line"> gvlma(x = lm.drug_data) </div><div class="line"></div><div class="line">                     Value p-value                Decision</div><div class="line">Global Stat        <span class="number">3.84262</span> <span class="number">0.42772</span> Assumptions acceptable.</div><div class="line">Skewness           <span class="number">0.70287</span> <span class="number">0.40182</span> Assumptions acceptable.</div><div class="line">Kurtosis           <span class="number">0.08023</span> <span class="number">0.77698</span> Assumptions acceptable.</div><div class="line">Link Function      <span class="number">2.99322</span> <span class="number">0.08361</span> Assumptions acceptable.</div><div class="line">Heteroscedasticity <span class="number">0.06630</span> <span class="number">0.79681</span> Assumptions acceptable.</div></pre></td></tr></table></figure>
<p>Global Stat给模型假设提供了一个单独的综合检验（通过/不通过），本例中，可以看到数据满足线性回归模型所有的统计假设（P=0.7071）。同时还对偏度(Skewness)、峰度(Kurtosis)、连接函数(Link function)和异方差性(Heteroscedasticity)进行了评价。</p>
<h4 id="影响分析"><a href="#影响分析" class="headerlink" title="影响分析"></a>影响分析</h4><p>是探查对估计有异常影响的数据，如果一个样本不服从某个模型，其余数据服从这个模型，则称该样本点为强影响点。影响分析就是区分这样的样本数据。</p>
<h4 id="离群点"><a href="#离群点" class="headerlink" title="离群点"></a>离群点</h4><p>指那些模型预测效果不佳的观测点，通常有很大的、或正或负的残差，正残差说明模型低估了响应值，负残差说明高佑了响应值。 <code>outlierTest()</code>函数是根据单个最大（或正或负）残差值的显著性来判断是否有离群点，若不显著，则说明数据集中没有离群点，若显著，则必须删除该离群点，然后再检验是否还有其他离群点存在。qqPlot图中落在置信区间带外的点可被认为时离群点，本例中未发现有离群点。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">outlierTest(lm.drug_data) <span class="comment">#Bonferroni离群点检验</span></div><div class="line">No Studentized residuals with Bonferonni p &lt; <span class="number">0.05</span></div><div class="line">Largest |rstudent|:</div><div class="line">   rstudent unadjusted p-value Bonferonni p</div><div class="line"><span class="number">3</span> -<span class="number">2.992805</span>           <span class="number">0.095862</span>      <span class="number">0.47931</span></div></pre></td></tr></table></figure>
<p>绘制残差的QQ图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qqPlot(lm.drug_data,labels=row.names(df),id.method = <span class="string">"identify"</span>,simulate=<span class="literal">T</span>,main=<span class="string">"QQPlot"</span>) <span class="comment">#car包</span></div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/GCCLfgcD53.png?imageslim" alt="mark"></p>
<h4 id="高杠杆值点"><a href="#高杠杆值点" class="headerlink" title="高杠杆值点"></a>高杠杆值点</h4><p>高杠杆值点是与其他预测变量有关的离群点，即它们是由许多异常的预测变量组合起来的，与响应变量值没有关系。 高杠杆值的观测点可通过帽子矩阵的值（hat statistic）判断。对于一个给定的数据集，帽子均值为p/n，其中p是模型估计的参数数目（包含截距项），n是样本量。一般来说，若观测点的帽子值大于帽子均值的2或3倍，则可认定为高杠杆值点。</p>
<h4 id="强影响点"><a href="#强影响点" class="headerlink" title="强影响点"></a>强影响点</h4><p>强影响点，即对模型参数估计值影响有些比例失衡的点。例如，当移除 模型的一个观测点时模型会发生巨大的改变，那么需要检测一下数据中是否存在强影响点。Cook距离，或称为D统计量。Cook’s D值大于4/(n-k-1)，则表明它是强影响点，其中n为样本量大小，k是预测变量数目（有助于鉴别强影响点，但并不提供关于这些点如何影响模型的信息），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(lm.drug_data,which=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/m2Gf9D6Dd5.png?imageslim" alt="mark"></p>
<p>car包中的influencePlot函数，可将离群点、杠杆点和强影响点的信息整合到一幅图形中，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">influencePlot(lm.drug_data)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180718/6FF70f4CIe.png?imageslim" alt="mark"></p>
<p>帽子统计量、DFFITS准测、Cook统计量和COVRATIO准则在R软件可分别通过hatvalues(),dffits(),cooks.distance()和covration()函数计算。influence.measures()可对一次获得这四个统计量的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; influence.measures(lm.drug_data)</div><div class="line">Influence measures of</div><div class="line">	 lm(formula = value ~ dose, data = drug_data) :</div><div class="line"></div><div class="line">   dfb.1_  dfb.dose  dffit  cov.r cook.d hat inf</div><div class="line"><span class="number">1</span>  <span class="number">0.7375</span> -<span class="number">6.05e-01</span>  <span class="number">0.741</span> <span class="number">4.0184</span> <span class="number">0.3483</span> <span class="number">0.6</span>   *</div><div class="line"><span class="number">2</span>  <span class="number">0.2673</span> -<span class="number">1.71e-01</span>  <span class="number">0.296</span> <span class="number">2.6474</span> <span class="number">0.0594</span> <span class="number">0.3</span>    </div><div class="line"><span class="number">3</span> -<span class="number">0.7368</span> -<span class="number">2.93e-16</span> -<span class="number">1.496</span> <span class="number">0.0937</span> <span class="number">0.3065</span> <span class="number">0.2</span>    </div><div class="line"><span class="number">4</span>  <span class="number">0.0159</span> -<span class="number">9.15e-02</span> -<span class="number">0.158</span> <span class="number">3.0339</span> <span class="number">0.0183</span> <span class="number">0.3</span>   *</div><div class="line"><span class="number">5</span> -<span class="number">0.7366</span>  <span class="number">1.41e+00</span>  <span class="number">1.727</span> <span class="number">1.4138</span> <span class="number">1.1220</span> <span class="number">0.6</span>   *</div></pre></td></tr></table></figure>
<p>纵坐标超过2或小于-2的值可被认为是离群点，水平轴超过0.2或0.3的值有高杠杆值（通常为预测值的组合）。圆圈大小与影响成比例，圆圈很大的点可能是对模型估计造成的不成比例影响的强影响点，influence.measures()的inf用星号标注异常值。</p>
<h2 id="多元线性回归"><a href="#多元线性回归" class="headerlink" title="多元线性回归"></a>多元线性回归</h2><p>直线回归是研究一个应变量与单个自变量之间呈直线关系的一种统计方法。但是在医学研究中，许多疾病都有多种原因，而且预后也是多种因素决定的，如糖尿病患者的血糖变化可能受胰岛素、糖化血红蛋白、血清总胆固醇、甘油三酯等多种生化指标的影响，这个时候就需要研究多个因素对一个结果变量数量依存的线性关系以及多个因素之间的线性关系，这种关系就称为多元线性回归。</p>
<p>多元线性回归（multiple linear regression）是研究用线性方程描述多个自变量和一个应变量之间数量依存关系的统计分析方法。如人体的体表现积随身高和体重而改变，则体表面积为应变量，身高和体重为自变量，设体表现为Y，身高和体重为X1和X2，则所建立的含有两个自变量二元回归方程为：</p>
<p>$\hat{y}=a+b_{1}x_{1}=b_{2}x_{2}$</p>
<p>其中$\hat{y}$是y均数的估计值或预测值（predicted value，y hat），a为截距，表示各自变量取0时，y的估计值，$b_{1}$和$b_{2}$称为偏回归系数（partial regression coefficient），其中$b_{1}$表示在体重的取值固定不变时，身高每增加一个单位，y估计值平均变化$b_{1}$个单位；$b{_2}$表示在身高的取值不变时，体重每增加一个单位，y估计值平均变化$b_{2}$个单位。一般来讲，对于拟合一个应变量y和m个自变量$x_{1},x_{2},\cdots,x_{m}$的多元回归方程，其形式为：</p>
<p>$\hat{y}=a+b_{1}x_{1}+b_{2}x_{2}+\cdots=b_{i}x_{i}+\cdots+b_{m}x_{m}$</p>
<p>其中，a为截距，意义同上，$b_{i}$为当其他自变量取值固定不变时，$x_{i}$每增加一个单位，y的估计值平均变化$b_{i}$个单位。</p>
<p>多元线性回归资料应满足以下条件：</p>
<ol>
<li>自变量和应变量之间的关系是线性关系；</li>
<li>各观测单位相互独立；</li>
<li>残差服从正态分布；</li>
<li>残差满足方差齐性。</li>
</ol>
<h3 id="多元线性回归的原理"><a href="#多元线性回归的原理" class="headerlink" title="多元线性回归的原理"></a>多元线性回归的原理</h3><p>对于多元回归方程的建立，也就是求出各常数项和各偏回归系数，原理还是使用最小二乘法来求各待估计系数，即根据观察到的n例数据，使残差平方和最小，即如下所示：</p>
<p>$Q=\sum_{k=1}^n(Y_{k}-\hat{Y_{k})^2}=\sum_{k=1}^n[Y_{k}-(b_{0}+b_{1}X_{1k}+b_{2}X_{2k}+\cdots=b_{m}X_{mk})]^2$（公式十八）</p>
<p>由此可以得到下面的方程组，求解得到$b_{1},b_{2},\cdots,b_{m}$,并求出$b_{0}$项，如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/j3B3I11b2c.png?imageslim" alt="mark"></p>
<p>$b_{0}$的计算如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/hm5EHFC0gI.png?imageslim" alt="mark"></p>
<p>这两个公式分别表示自变量的离均差平方和（i=j），两个自变量的离均差积和（$i\neq j$）及自变量$X_{j}$与应变量Y的离均差和和。</p>
<h3 id="多元线性回归的计算过程"><a href="#多元线性回归的计算过程" class="headerlink" title="多元线性回归的计算过程"></a>多元线性回归的计算过程</h3><h2 id="案例：多元线性回归"><a href="#案例：多元线性回归" class="headerlink" title="案例：多元线性回归"></a>案例：多元线性回归</h2><p>现在看一个案例，这个案例来源于《医学统计学》第四版.孙振球，案例描述如下：</p>
<p>27名糖尿病患者的血清总胆固醇、甘油三酯、空腹胰岛素、糖化血红蛋白、空腹血糖的测量值位于下表中，试建立血糖与其他几项指标的多元线性回归方程。</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/aG3BEk29fH.png?imageslim" alt="mark"></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/abbIG27Ajm.png?imageslim" alt="mark"></p>
<p>计算过程与直线回归基本上类似，也是使用<code>lm()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mlr &lt;- read.table(<span class="string">"https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_1501.csv"</span>,header=<span class="literal">T</span>,sep=<span class="string">","</span>) <span class="comment"># 原始数据集</span></div><div class="line">mlr_result &lt;- lm(mlr$Y~mlr$X1+mlr$X2+mlr$X3+mlr$X4)</div><div class="line">summary(mlr_result)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; summary(mlr_result)</div><div class="line"></div><div class="line">Call:</div><div class="line">lm(formula = mlr$Y ~ mlr$X1 + mlr$X2 + mlr$X3 + mlr$X4)</div><div class="line"></div><div class="line">Residuals:</div><div class="line">    Min      1Q  Median      3Q     Max </div><div class="line">-<span class="number">3.6268</span> -<span class="number">1.2004</span> -<span class="number">0.2276</span>  <span class="number">1.5389</span>  <span class="number">4.4467</span> </div><div class="line"></div><div class="line">Coefficients:</div><div class="line">            Estimate Std. Error t value Pr(&gt;|t|)  </div><div class="line">(Intercept)   <span class="number">5.9433</span>     <span class="number">2.8286</span>   <span class="number">2.101</span>   <span class="number">0.0473</span> *</div><div class="line">mlr$X1        <span class="number">0.1424</span>     <span class="number">0.3657</span>   <span class="number">0.390</span>   <span class="number">0.7006</span>  </div><div class="line">mlr$X2        <span class="number">0.3515</span>     <span class="number">0.2042</span>   <span class="number">1.721</span>   <span class="number">0.0993</span> .</div><div class="line">mlr$X3       -<span class="number">0.2706</span>     <span class="number">0.1214</span>  -<span class="number">2.229</span>   <span class="number">0.0363</span> *</div><div class="line">mlr$X4        <span class="number">0.6382</span>     <span class="number">0.2433</span>   <span class="number">2.623</span>   <span class="number">0.0155</span> *</div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div><div class="line"></div><div class="line">Residual standard error: <span class="number">2.01</span> on <span class="number">22</span> degrees of freedom</div><div class="line">Multiple R-squared:  <span class="number">0.6008</span>,	Adjusted R-squared:  <span class="number">0.5282</span> </div><div class="line"><span class="literal">F</span>-statistic: <span class="number">8.278</span> on <span class="number">4</span> and <span class="number">22</span> DF,  p-value: <span class="number">0.0003121</span></div></pre></td></tr></table></figure>
<p>从结果中可以看出来，截矩，X1，X2，X3，X4的偏回归系数分别为5.9433，0.1424，0.3515，-0.2706，0.6382，那么我们计算得到的多元线性回归方程就是下面的这个样子：</p>
<p>$\hat{Y}=5.9433+0.1424X_{1}+0.3515X_{2}+ -0.2706X_{3}+0.6382X_{4}$</p>
<h3 id="多元线性回归方程的假设检验及评价"><a href="#多元线性回归方程的假设检验及评价" class="headerlink" title="多元线性回归方程的假设检验及评价"></a>多元线性回归方程的假设检验及评价</h3><p>这个方程的假设检验如下所示：</p>
<p>$H_{0}:\beta_{1}=\beta_{2}=\cdots=\beta_{m}=0$</p>
<p>$H_{1}$各$\beta_{j}(j=1,2,\cdots,m)$不全为0</p>
<p>在上面的计算结果中我们就能够看出来的对这个多元线性回归方程的评价，其中包括这些部分：</p>
<ol>
<li>方差分析法。这个方程的F值为8.278，有4个自由度，p值为0.0003121，远小于0.01。因此拒绝$H_{0}$，接受$H_{1}$，即认为应变量Y与m个自变量之间存在线性关系，表明回归模型中至少有一个自变量的回归系数不为0，所拟合的回归方程具有统计学意义。</li>
<li>决定系数，从上面的结果可以看出来$R^2=0.6008$，表明血糖含量变量的68%可由总胆固醇、甘油三酯、胰岛素和糖化血红蛋白的变化来解释。</li>
<li>复相关系数，$R=\sqrt{R^2}$称为复相关系数（multiple correlation coefficient），可用来度量应变量Y与多个自变量的线性相关程度，亦即观察值Y与估计值$\hat{Y}$之间的相关程度，在这个案例中，复相关系数$R=\sqrt{0.6008}=0.7751$，如果只有一个自变量时，$R=|r|$，r为简单相关系数。</li>
</ol>
<p>绘制多元线性回归的残差图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">2</span>,<span class="number">2</span>))</div><div class="line">plot(mlr_result)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180719/b0Jaldjhjd.png?imageslim" alt="mark"></p>
<p>也可以采用方差分析对多元线性回归的结果进行诊断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; anova(mlr_result)</div><div class="line">Analysis of Variance Table</div><div class="line"></div><div class="line">Response: mlr$Y</div><div class="line">          Df Sum Sq Mean Sq <span class="literal">F</span> value    Pr(&gt;<span class="literal">F</span>)    </div><div class="line">mlr$X1     <span class="number">1</span> <span class="number">69.425</span>  <span class="number">69.425</span> <span class="number">17.1919</span> <span class="number">0.0004221</span> ***</div><div class="line">mlr$X2     <span class="number">1</span>  <span class="number">4.143</span>   <span class="number">4.143</span>  <span class="number">1.0261</span> <span class="number">0.3220970</span>    </div><div class="line">mlr$X3     <span class="number">1</span> <span class="number">32.348</span>  <span class="number">32.348</span>  <span class="number">8.0105</span> <span class="number">0.0097411</span> ** </div><div class="line">mlr$X4     <span class="number">1</span> <span class="number">27.794</span>  <span class="number">27.794</span>  <span class="number">6.8827</span> <span class="number">0.0155156</span> *  </div><div class="line">Residuals <span class="number">22</span> <span class="number">88.841</span>   <span class="number">4.038</span>                      </div><div class="line">---</div><div class="line">Signif. codes:  <span class="number">0</span> ‘***’ <span class="number">0.001</span> ‘**’ <span class="number">0.01</span> ‘*’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></div></pre></td></tr></table></figure>
<p>从方差分析的结果来看，模型的p值小于0.001，因此回归模型是有意义的。综合一下t检验和方差分析的结果来看，X3，X4的p值都小于0.01，可以认为这两个变量可以解释血糖。</p>
<h3 id="多元线性回归中的方差分析"><a href="#多元线性回归中的方差分析" class="headerlink" title="多元线性回归中的方差分析"></a>多元线性回归中的方差分析</h3><p>在多元线性回归中，为什么要做方差分析呢，这是因为在线性回归中，把因变量的总变异，也就是因变量的所有观测值到其均值$\bar{y}$的距离平方和（通常用SST）表示，分解成对应于各个自变量的若干平方和(SS,sum of squares)，每一个这样的平方和代表了一个自变量对总变异平方的贡献，剩下不能被自变量解释的，就是误差平方和或残差平方和(SSE,error sum of squares)，自变量及残差平方和所对应的平方和加起来等于因变量的总变异。</p>
<p>用简单的话来讲，就是方差分析表把由自变量所导致的因㸄的变化和误差所导致的因变量的变化找出来，并进行比较（通过F检验），如果这两个变化很不一样，那么则认为自变量在回归中的确显著影响了因变量，表示回归有道理，否则，没有理由认为因变量和误差有所不同。</p>
<p>具体来讲，如果我们有两个自变量，分别为A和B，则把SSt分解为对应于这两个自变量的两个平方和SSA，SSB以及残差平方和SSE，即SST=SSA+SSB+SSE。那么如果SSA与SSE相比较很显著，即变量A的贡献显著大于误差的贡献，则称变量A显著，否则，如果SSA和SSE的贡献差不多，那么变量A就不显著。这种显著需要正式的检验，如果前面关于误差的四个假定成立（回归模型的误差项独立，且服从正态分布），那么这些平方和（比如这里的SSA、SSB、SSE）都有$\chi^2$分布（因为它们是正态分布变量的平方和），而除以各自的自由度之后，得到它们的平均（叫均方，mean square，记为MSA，MSB，MSE），根据F分布的定义，MSA/MSE和MSB/MSE都有F分布，如果MSA/MSE很大，那么A就是和残差相比显著，则相应的p值就小。</p>
<h3 id="有交互作用的多元线性回归"><a href="#有交互作用的多元线性回归" class="headerlink" title="有交互作用的多元线性回归"></a>有交互作用的多元线性回归</h3><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>医学统计学 第四版 孙振球</li>
<li>深入浅出统计学</li>
<li>医学统计学及SAS应用.王炳顺</li>
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/06/BioStatistics/生物统计-08卡方分析与卡方分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/06/BioStatistics/生物统计-08卡方分析与卡方分布/" itemprop="url">卡方分布与卡方检验笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T12:02:00+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9,490
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  37
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是卡方分析"><a href="#什么是卡方分析" class="headerlink" title="什么是卡方分析"></a>什么是卡方分析</h2><h3 id="第1个案例"><a href="#第1个案例" class="headerlink" title="第1个案例"></a>第1个案例</h3><p>先看一个案例，这个案例会告诉我们什么是卡方分析，这个案例源于《深入浅出统计学》。</p>
<p>某个赌场遇到了一个问题，也就是赌场的老虎机总是出头奖，轮盘总是停在12位，这样赌客就很容易赢钱，如果再这么下赌下去，赌场撑不住，赌场的老板怀疑有人在老虎机上动了手脚，此时就来研究，老虎机是否被动了手脚。下面是某台老虎机的期望概率分布，其中X代表每一局游戏的净收益，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>x</th>
<th>-2</th>
<th>23</th>
<th>48</th>
<th>73</th>
<th>98</th>
</tr>
</thead>
<tbody>
<tr>
<td>P(X=x)</td>
<td>0.977</td>
<td>0.008</td>
<td>0.008</td>
<td>0.006</td>
<td>0.001</td>
</tr>
</tbody>
</table>
</div>
<p>其中-2表示，每局的赌注是2美元，如果你没赢的话，你就损失2美元。现在赌场收集了一些统计数据，给出了人们获得某种收益的次数，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>x</th>
<th>-2</th>
<th>23</th>
<th>48</th>
<th>73</th>
<th>98</th>
</tr>
</thead>
<tbody>
<tr>
<td>频数</td>
<td>965</td>
<td>10</td>
<td>9</td>
<td>9</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
<p>现在我们要将每个x值的实际频数与根据概率分布得出的期望频数进行比较，此时时我们定义观察的频数为1000，现在用1000分别乘以概率分布，得到期望频数，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>x</th>
<th>观察频数</th>
<th>期望频数</th>
</tr>
</thead>
<tbody>
<tr>
<td>-2</td>
<td>965</td>
<td>977</td>
</tr>
<tr>
<td>23</td>
<td>10</td>
<td>8</td>
</tr>
<tr>
<td>48</td>
<td>9</td>
<td>8</td>
</tr>
<tr>
<td>73</td>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>98</td>
<td>7</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>从这个表中我们可以知道，观察频数与期望频数有差别，但是这种差异有多，我们并不清楚。因此我们需要进行某种假设检验，以检验观察频数和期望频数之间的差别，这样我们就能够判定：老虎机被人动过手脚。现在的问题就是，我们使用哪种分布进行这项假设检验？</p>
<p>答案就是使用卡方检验来评估差异，卡方分布通过一个检验统计量来比较<strong>期望结果</strong>和<strong>实际结果</strong>之间的差别，然后得出观察频数极值的发生概率。</p>
<p>现在我们先来求一下检验统计量，为此，首先画出一张表，填入相应问题的观察频数和期望频数，然后，用观察频数和期望频数计算下列统计量，其中O代表观察频数，E代表期望频数，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/jJKlBFh99K.png?imageslim" alt="mark"></p>
<p>也就是说，对于概率分布中的每一个概率，取期望频数和实际频数的差，求差的平方数，再除以期望频数，最后将结果相加，现在我们求一下老虎机问题的检验统计量是多少。</p>
<p>计算过程如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/HF4mC0jL48.png?imageslim" alt="mark"></p>
<p>如果$\chi^2$的值很小，说明观察频数和期望频数之间的差别不显著，卡方越大，差别越显著。</p>
<p>再回到卡方分析的统计量上，检验统计量$\chi^2$提供了一种对观察频数和期望频数之间的差异进行量度的办法，$\chi^2$的数值越小，观察频数和期望频数之间的总差值越小。除数E为期望频数，于是所得的结果与期望频数成反比，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/9JeiIj8Hjk.png?imageslim" alt="mark"></p>
<p>$\chi^2$大到什么程度才算得上显著呢？此处先不做解答，现在先了解一下卡方分布。</p>
<h2 id="卡方分布简介"><a href="#卡方分布简介" class="headerlink" title="卡方分布简介"></a>卡方分布简介</h2><p>卡方分布是由正态分布推导出来的分布，它的定义为，n个独立标准正态变量的平方和称为有n个自由度的$\chi^2$分布，记为$\chi^2(n)$，$\chi^2(n)$的总体均值为n，总体方差为2n（不知道这是如何推导出来的）。</p>
<p>此外，若干个独立的卡方分布变量的和也能构成卡方方分布，其自由度等于那些卡方分布自由度之和，卡方分布也是一族分布，由该族成员的不同自由度来区分，由于上方分布是正态变量的平方和，因此，它不会取负值（《从数据到结论》吴喜之 ）。</p>
<p>现在再看一下卡方分析的简介。</p>
<h2 id="卡方分析简介"><a href="#卡方分析简介" class="headerlink" title="卡方分析简介"></a>卡方分析简介</h2><p>两个样本率的比较通常是使用$\chi^2$检验（Chi-square test）。$\chi^2$检验是以$\chi^2$分布为理论依据，用途广泛的假设检验方法，卡方分析用于比较不同组之间的构成比，它的零假设是假定各组之间的构成是相同的，计算出理论每组的理论构成比，再计算理论值与实际值的差别，如果差别大的话，就拒绝零假设。它用于推断两个总体率或构成比之间有无差别、多个总体率或构成比之间有无差别、多个样品率间的多重比较、两个分类变量之间有无关联性、多维列联表的分析和频数分页拟合优度的$\chi^2$检验，它的扩展分析方法有Fisher精确分析，Ridit分析，CMH分析。</p>
<h2 id="卡方分布用途"><a href="#卡方分布用途" class="headerlink" title="卡方分布用途"></a>卡方分布用途</h2><p>卡方分布的两个主要用途。卡方概率分布主要用于检查实际结果与期望结果之间何时存在显著差别，该概率分布使用前前面讲到的检验统计量$\chi^2$进行检验。卡方分布主要有两个用途。</p>
<p>第一用于检验拟合优度，也就是可以检验一组给定的数据与指定分布的吻合程度。例如，可以用它检验老虎机收益的观察频率与我们所期望的分布的吻合程度。$\chi^2$分布的另一个用途是检验两个变量的独立性，通过这个方法可以检查变量之间是否存在某种关联。$\chi^2$分布用到一个参数，即希腊字母$\nu$，读作“纽”，下面是可以看一下$\nu$如何影响概率分布的形状。</p>
<h2 id="卡方分布的概率密度曲线"><a href="#卡方分布的概率密度曲线" class="headerlink" title="卡方分布的概率密度曲线"></a>卡方分布的概率密度曲线</h2><p>卡方分布（Chi-square distribution）是一种连续型分布，$\chi^2$分布只有一个参数，即自由度$\nu$。按$\chi^2$分布的密度函数$f(\chi^2)$可以给出自由度$\nu=1,2,3,\dots$的一簇$\chi^2$分布曲线，由$\chi^2$分布曲线可见，$\chi^2$分布的形状依赖于自由度$\nu$的大小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(seq(0,15,length = 1000)) </div><div class="line">#生成从0到10之间的1000个数字</div><div class="line"></div><div class="line">y1 &lt;- dchisq(x,1) </div><div class="line"># 生成对x的卡方密度值，自由度为1</div><div class="line"></div><div class="line">y2 &lt;- dchisq(x,2) </div><div class="line"># 生成对x的卡方密度值，自由度为1</div><div class="line"></div><div class="line">y6 &lt;- dchisq(x,6) </div><div class="line"># 生成对x的卡方密度值，自由度为6</div><div class="line"></div><div class="line">y10 &lt;- dchisq(x,10) </div><div class="line"># 生成对x的卡方密度值，自由度为10</div><div class="line"></div><div class="line">plot(x,y1,type = &quot;l&quot;, ylim = c(0,0.5),xlim=c(0,15),xlab=&quot;&quot;, ylab=&quot;&quot;, lty = 1, main = expression(paste(chi^2,&quot;Distribution&quot;)))</div><div class="line"># type =&quot;l&quot;表示绘制线，如果是n则不绘线；lty=1表示绘制实线</div><div class="line"></div><div class="line">lines(x,y2, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty =2) </div><div class="line"></div><div class="line">lines(x,y6, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty =2) </div><div class="line"># lty=2表示绘制虚线lines(x,y10, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty= 3) # lty=3表示绘制点线</div><div class="line"></div><div class="line">lines(x,y10, type = &quot;l&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, lty= 3) # lty=3表示绘制点线</div><div class="line"></div><div class="line">text(0.2,0.3, c(expression(chi^2*(1))))</div><div class="line">text(1.9,0.3, c(expression(chi^2*(2))))</div><div class="line">text(4,0.15, c(expression(chi^2*(6))))</div><div class="line">text(8,0.11, c(expression(chi^2*(10))))</div></pre></td></tr></table></figure>
<p>图片如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/E3EJ5Cc1lb.png?imageslim" alt="mark"></p>
<ol>
<li>当自由度$\nu \leq 2$时，曲线呈L形，也就是一条先高后低的平滑曲线，检验统计量等于较小的数值的概率远远高于等于较大数值的概率，这就是说，观察频数有可能接近期望频数；</li>
<li>当$\nu&gt;2$时，卡方分布的曲线就会表现出先低后高，再低的特征，其外形沿着正向扭曲，但是当，随着$\nu$的增加，曲线逐渐趋于对称；</li>
<li>当自由度$\nu \rightarrow \infty$时，$\chi^2$分布趋于正态分布。</li>
</ol>
<p>卡方分布的一个基本性质是它的可加性；如果两个独立的随机变量$X_{1}$和$X_{2}$分别服从自由度$\nu_{1}$和$\nu_{2}$的$\chi^2$分布，则它们的和$X_{1}+X_{2}$服从自由度$\nu_{1}$和$nu_{2}$的$\chi^2$分布，即$X_{1}+X_{2}~\chi^2_{\nu1+\nu2}$.</p>
<p>如果使用具有特定参数$\nu$的$\chi^2$分布以及检验统计量${X}^2$，可以简单记为如下形式：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/331G7A5ABh.png?imageslim" alt="mark"></p>
<p>$\chi^2$分布的界值：当自由度$\nu$确定后，$\chi^2$分布曲线下右侧尾部的面积为$\alpha$时，横轴上相应的$\chi^2$值记为$\chi^2_{\alpha,\nu}$，即$\chi^2$分布的界值。$\chi^2$值越大，p值越小，反之，$\chi^2$值越小，界值越大。</p>
<h2 id="卡方分析的显著性"><a href="#卡方分析的显著性" class="headerlink" title="卡方分析的显著性"></a>卡方分析的显著性</h2><p>现在回答前面的那个问题，即检验统计量$\chi^2$大到什么程度才算得上显著呢？</p>
<p>这要取决于显著性水平，用卡方分布进行的检验为单尾检验，右尾被称作拒绝域，于是，通过查看检验统计量是否位于右尾的拒绝域内，就可以判定根据期望分布得出目前结果的可能性，如果用显著性水平$\alpha$进行检验，就写为$\chi^2_{\alpha}(\nu)$，在以前没有计算机的时候，通常是使用卡方概率表来计算卡方分布的拒绝域，下面先讲一下如何使用卡方概率表，理解了这个，就方便理解软件的计算结果。</p>
<p>为了求出临界值，首选找出自由度$\nu$以及显著性水平$\alpha$，在第一列查找$\nu$，第一行查找$\alpha$，交点即x值，从$P(\chi^2\alpha(\nu) \geq(x)=\alpha$中得出临界值。</p>
<p>以5%为显著性水平，8为自由度进行检验，若要得到临界值，那么在第一列查找8，第一行查找0.05，查出数值为15.51，因此只要统计量$\chi^2$大于15.51，则在显著性水平为5%，自由度为8的情况下，检验统计量就位于拒绝域以内，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/5492jhlcga.png?imageslim" alt="mark"></p>
<p>我们在前面通过卡方分析计算过老虎机的理论期望频数与实际频数的卡方值是38.272，它的值大于15.51，也就是位于拒绝域内，因为我们可以判定，老虎机做了手脚，事实上，我们还在前面使用了R来计算这个卡方值，结论也是，p值远小于0.05，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- c(<span class="number">0.977</span>,<span class="number">0.008</span>,<span class="number">0.008</span>,<span class="number">0.006</span>,<span class="number">0.001</span>)  <span class="comment"># 期望概率</span></div><div class="line">x &lt;- c(<span class="number">965</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">7</span>) <span class="comment"># 实际的频数</span></div><div class="line">chisq.test(x,p=p)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- c(<span class="number">0.977</span>,<span class="number">0.008</span>,<span class="number">0.008</span>,<span class="number">0.006</span>,<span class="number">0.001</span>) </div><div class="line">&gt; x &lt;- c(<span class="number">965</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">7</span>) </div><div class="line">&gt; chisq.test(x,p=p)</div><div class="line"></div><div class="line">        Chi-squared test <span class="keyword">for</span> given probabilities</div><div class="line"></div><div class="line">data:  x</div><div class="line">X-squared = <span class="number">38.272</span>, df = <span class="number">4</span>, p-value = <span class="number">9.845e-08</span></div><div class="line"></div><div class="line">Warning message:</div><div class="line">In chisq.test(x, p = p) : Chi-squared近似算法有可能不准</div></pre></td></tr></table></figure>
<p>结果显示，卡方值为38.272，自由度为4，p值远小于0.01。</p>
<h2 id="卡方分析的假设检验步骤"><a href="#卡方分析的假设检验步骤" class="headerlink" title="卡方分析的假设检验步骤"></a>卡方分析的假设检验步骤</h2><p>利用卡方分布进行假设检验的步骤与其他方法进行假设检验的步骤基本上一样，包括哪下步好：</p>
<ol>
<li>确定进行检验的假设及其备选假设；</li>
<li>求出期望频数和自由度；</li>
<li>确定用于决策的拒绝域；</li>
<li>计算检验统计量$\chi^2$；</li>
<li>查看检验统计量是否位于拒绝域以内；</li>
<li>作出决策。</li>
</ol>
<h3 id="第2个案例"><a href="#第2个案例" class="headerlink" title="第2个案例"></a>第2个案例</h3><p>再看一个案例，这个案例还是来源于《深入浅出统计学》，案例是这个样子的：</p>
<p>赌场中的某个赌桌上的骰子有问题，赌场老板列出了这个股子的观察频数，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>数值</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>频数</td>
<td>107</td>
<td>198</td>
<td>192</td>
<td>125</td>
<td>132</td>
<td>248</td>
</tr>
</tbody>
</table>
</div>
<p>现在我们要计算一下，这个股子到底有没有问题，我们按照卡方检验的步骤来进行。</p>
<p>第一步：决定要进行检验的假设和备选假设。</p>
<p>H0（假设）：骰子没问题，每一面数值出现的概率都相同，也就是1/6。</p>
<p>H1（备选假设）：股子有问题。</p>
<p>第二步：求出期望频数和自由度。</p>
<p>根据上面的数据，我们知道，所有的观察频数相加为1002，现在我们计算一下理论上每个面出现的频数，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>x</th>
<th>观察频数</th>
<th>期望频数</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>107</td>
<td>167</td>
</tr>
<tr>
<td>2</td>
<td>198</td>
<td>167</td>
</tr>
<tr>
<td>3</td>
<td>192</td>
<td>167</td>
</tr>
<tr>
<td>4</td>
<td>125</td>
<td>167</td>
</tr>
<tr>
<td>5</td>
<td>132</td>
<td>167</td>
</tr>
<tr>
<td>6</td>
<td>248</td>
<td>167</td>
</tr>
</tbody>
</table>
</div>
<p>自由度为5，这个很好理解，6个期望频数，总和为1002，即我们必须求出6个信息，同时受到1个限制，因此$\nu$=6-1=5.</p>
<p>第三：确定用于做决策的拒绝域。</p>
<p>从概率表中可以查出$\chi^2_{1\%}(5)=15.09$，那么拒绝域为$\chi^2&gt;15.09$的范围。</p>
<p>第四：计算检验统计量$\chi^2$，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180717/IGJ82gdH3b.png?imageslim" alt="mark"></p>
<p>第五：查提检验统计量是否位于拒绝域以内</p>
<p>拒绝域由$\chi^2&gt;15.09$决定，由于我们计算出来的$\chi^2=88.24$，因此检验统计量位于拉拒绝域内。</p>
<p>第六：做出决策。</p>
<p>由于我们计算出来的检验统计量位于拒绝域内，因此说明在显著性水平为1%的情况下，有足够的证据拒绝原假设，于是我们接受备选假设，骰子有问题。</p>
<p>现在用R来过计算一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- c(<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>,<span class="number">1</span>/<span class="number">6</span>) </div><div class="line">&gt; x &lt;- c(<span class="number">107</span>,<span class="number">198</span>,<span class="number">192</span>,<span class="number">125</span>,<span class="number">132</span>,<span class="number">248</span>) </div><div class="line">&gt; chisq.test(x,p=p)</div><div class="line"></div><div class="line">        Chi-squared test <span class="keyword">for</span> given probabilities</div><div class="line"></div><div class="line">data:  x</div><div class="line">X-squared = <span class="number">88.24</span>, df = <span class="number">5</span>, p-value &lt; <span class="number">2.2e-16</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们可以发现，卡方分析不仅能够比较两个率的大小，还能计算出理论频数与实际频数的差异，实际上，这就是拟合优度（Goodness of Fit）的思想，即看实际值与理论值（预测值）的差异有多大，在不同的场合下，拟合优度有不同的用处，例如，在组间比较时，通过比较实际值与理论值的差异大小，做出是否有统计学差异的结论；在模型评价中，根据实际值与模型值的差异大小，判断模型是否很好地拟合了数据；在判断数据是否服从某一分布时，根据其理论分布与实际数据的差异做出判断，等等。</p>
<p>以下是其他的一些案例练习。</p>
<h2 id="四格表资料的-chi-2-检验"><a href="#四格表资料的-chi-2-检验" class="headerlink" title="四格表资料的$\chi^2$检验"></a>四格表资料的$\chi^2$检验</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p>某医院欲比较异梨醇口服液（试验组）和氢氯噻嗪+地塞米松（对照组）降低颅内压的疗效。将200例颅内压增高症患者随机分为两组，结果见表7-1。问两组降低颅内压的总体有效率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验 例7-1，P96）</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi02.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data71&lt;-matrix(c(99,75,5,21),nr = 2,dimnames = list(c(&quot;试验组&quot;, &quot;对照组&quot;),c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">data71</div></pre></td></tr></table></figure></p>
<p>数据的四格表如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi03.png" alt=""></p>
<p>这张图里的四个数是该表的基本数据，其余的数据都是由这4个基本数据推算出来的，称为四格表（fourfold table）资料。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chi &lt;- chisq.test(data71)</div><div class="line">chi$expected #　显示理论数</div></pre></td></tr></table></figure>
<p>理论数如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi04.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data71,correct=F) </div><div class="line"># correct = F表示不进行Yates连续性校正</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi05.png" alt=""></p>
<p>结果：卡方值为12.8571，p值= 0.0003362小于0.01，按sig = 0.01的水准，拒绝原假设，接受备用假设，可以认为异山梨醇口服液降低颅内压的有效率高于氢氯噻嗪+地塞米松的有效率。这个结果与SAS计算的结果相同。R语言中默认的卡方检验是进行Yates连续性校正，因此上题中进行检验时，要加入correct=F。</p>
<h2 id="四格表资料的Fisher确切概率法"><a href="#四格表资料的Fisher确切概率法" class="headerlink" title="四格表资料的Fisher确切概率法"></a>四格表资料的Fisher确切概率法</h2><p>四格表中的计数资料的实际频数都是分类资料，是不连续的，因此计算出的卡方值都是离散型分布，而卡方界值表的依据是卡方分布，卡方分布是连续分布，因此在实际工作中，对于四格表资料，需要进行Yates校正，其规则如下：</p>
<ol>
<li>当$n\geq 40$，且所有的$T\geq 5$时，用卡方检验的基本公式。</li>
<li>当$n\geq 40$，但有$1\leq T \geq 5$时，用校正公式，或改用四格表资料的Fisher确切概率法。</li>
<li>当$n\leq 40$，或T \leq 1$时，用四格表资料的Fisher确切概率法。</li>
</ol>
<h3 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h3><p>某医师欲比较胞磷胆碱与神经节苷酯治疗脑血管疾病的疗效，将78例脑血管疾病患者随机分为两组，结果见表7-2。问两种药物治疗脑血管疾病的有效率是否有差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-2）</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi06.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">data72&lt;-matrix(c(46,18,6,8),</div><div class="line">               nr = 2,</div><div class="line">               dimnames = list(c(&quot;胞磷胆碱&quot;,&quot;神经节苷脂&quot;),c(&quot;有效&quot;,&quot;无效&quot;)))</div><div class="line">chisq.test(data72,correct=F) # 不进行Yates校正的结果</div><div class="line"></div><div class="line">chisq.test(data72,correct=T) # 进行Yates校正的结果</div><div class="line"></div><div class="line"># 这个结果与下面的结果一样</div><div class="line"># 因为R中进行卡方检验时是默认进行Yates连续性校正的</div><div class="line">chisq.test(data72)</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi07.png" alt=""></p>
<p>不校正的情况下，卡方值为4.35，p值为0.03695小于0.05，进行卡方连续性校正的情况下，卡方值为3.1448,p=0.07617。校正与不校正得出的结果在0.05附近，因此下结论要谨慎。</p>
<h2 id="配对四格表卡方检验"><a href="#配对四格表卡方检验" class="headerlink" title="配对四格表卡方检验"></a>配对四格表卡方检验</h2><h3 id="案例3"><a href="#案例3" class="headerlink" title="案例3"></a>案例3</h3><p>某实验室分别用乳胶凝集法和免疫荧光法对58名可疑系统红斑狼疮患者血清中抗核抗体进行测定，结果见表7-3。问两种方法的检测结果有无差别？（《医学统计学》第三版，孙振球，第七章 卡方检验，例7-3）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">data73&lt;-matrix(c(11,2,12,33),</div><div class="line">               nr = 2,dimnames = list(c(&quot;+&quot;, &quot;-&quot;),c(&quot;+&quot;, &quot;-&quot;)))</div><div class="line"></div><div class="line">library(epiR) # 载入epiR包，使用其中的epi.kappa函数</div><div class="line"></div><div class="line">mcnemar.test(data73) # 配对检验</div><div class="line"></div><div class="line">chisq.test(data73)$expect</div><div class="line"></div><div class="line">epi.kappa(data73)$kappa </div><div class="line"># 一致性检验，即考察这两个方法在检验方面是否吻合</div><div class="line"></div><div class="line"># 或者使用vcd包中的Kappa</div><div class="line">library(vcd)</div><div class="line">Kappa(data73)</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi08.png" alt=""></p>
<p>结果分析：McNemar配对卡方检验的p值为0.01616,在0.05水平上，有显著性差异，免疫荧光法的总体阳性检出率要高于乳胶凝集法。</p>
<p>Kappa检验结果的p值小于0.01，估计值为0.455，说明两种方法的吻合度有统计学意义，但吻合度一般。</p>
<p>简单来说，McNemar检验是比较两种方法A与B对同一个对象的检验是否有差异，判断哪种方法比较好，比较容易检验出来结果。而Kappa检验就是比较A与B这两种方法检验出来的结果是不是一致的。在有些配对案例中可能会出现A的方法优于B，但A与B检验的结果不一致的情况。</p>
<h2 id="四格表精确Fisher检验"><a href="#四格表精确Fisher检验" class="headerlink" title="四格表精确Fisher检验"></a>四格表精确Fisher检验</h2><h3 id="案例4"><a href="#案例4" class="headerlink" title="案例4:"></a>案例4:</h3><p>某医师为研究乙肝免疫球蛋白预防胎儿宫内感染HBV的效果，将33例HBsAg阳性孕妇随机分为预防注射组和非预防组，结果见表7-4。问两组新生儿的HBV总体感染率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-4)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">data74&lt;-matrix(c(4,5,18,6),nr = 2,</div><div class="line">               dimnames = list(c(&quot;预防注射组&quot;, </div><div class="line">                                 &quot;非预防组&quot;),c(&quot;阳性&quot;, &quot;阴性&quot;)))</div><div class="line">chi&lt;-chisq.test(data74) </div><div class="line"># 理论频数小于5的情况，这里用Yates连续校正，</div><div class="line"># 默认的就是，不用添加correct = T</div><div class="line"></div><div class="line">chi$expected </div><div class="line"># 查看理论频数，有小于5的情况</div><div class="line"></div><div class="line">fisher.test(data74)</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi09.png" alt=""></p>
<h3 id="案例5"><a href="#案例5" class="headerlink" title="案例5:"></a>案例5:</h3><p>某单位研究胆囊腺癌、腺瘤的P53基因表达，对同期手术切除的胆囊腺癌、腺瘤标本各10份，用免疫组化法检测P53基因，资料见表7-6。问胆囊腺癌和胆囊腺瘤的P53基因表达阳性率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-5）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data75&lt;-matrix(c(6,1,4,9),nr = 2,</div><div class="line">               dimnames = list(c(&quot;胆囊腺癌&quot;, &quot;胆囊腺瘤&quot;),</div><div class="line">                               c(&quot;阳性&quot;, &quot;阴性&quot;)))</div><div class="line"></div><div class="line">fisher.test(data75)</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi10.png" alt=""></p>
<h2 id="无序R×C列表"><a href="#无序R×C列表" class="headerlink" title="无序R×C列表"></a>无序R×C列表</h2><h3 id="案例6-列与行的数目都大于2"><a href="#案例6-列与行的数目都大于2" class="headerlink" title="案例6:列与行的数目都大于2"></a>案例6:列与行的数目都大于2</h3><p>无序R×C列表这种情况是行、列都无序，并且行与列的数目都大于2，例如： 某医师研究物理疗法、药物治疗和外用膏药三种疗法治疗周围性面神经麻痹的疗效，资料见表7-8。问三种疗法的有效率有无差别（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-6）？<br>如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi11.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data76&lt;-matrix(c(199,164,118,7,18,26),</div><div class="line">               nr = 3,dimnames = list(c(&quot;物理疗法组&quot;, &quot;药物治疗组&quot;,&quot;外用膏药组&quot;),</div><div class="line">                                      c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">chi.result &lt;- chisq.test(data76)</div><div class="line">chi.result # 查看卡方分析结果</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi12.png" alt=""></p>
<h2 id="双向无序R×C列表的卡方检验"><a href="#双向无序R×C列表的卡方检验" class="headerlink" title="双向无序R×C列表的卡方检验"></a>双向无序R×C列表的卡方检验</h2><h3 id="案例7"><a href="#案例7" class="headerlink" title="案例7:"></a>案例7:</h3><p>某医师在研究血管紧张素I转化酶(ACE)基因I/D多态与2型糖尿病肾病(DN)的关系时，将249例2型糖尿病患者按有无糖尿病肾病分为两组，资料见表7-9，问两组2型糖尿病患者的ACE基因型总体分布有无差别（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-7）？<br><img src="http://ortxpw68f.bkt.clouddn.com/chi13.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">data77 &lt;- matrix(c(42,30,48,72,21,36),</div><div class="line">                 nrow=2,dimnames=list(c(&quot;DN组&quot;,&quot;无DN组&quot;),</div><div class="line">                                      c(&quot;DD&quot;,&quot;ID&quot;,&quot;II&quot;)))</div><div class="line">chi.result77 &lt;- chisq.test(data77)</div><div class="line">chi.result77$expected</div><div class="line">chi.result77</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi14.png" alt=""></p>
<h2 id="双向无序R×C列表的关联性检验"><a href="#双向无序R×C列表的关联性检验" class="headerlink" title="双向无序R×C列表的关联性检验"></a>双向无序R×C列表的关联性检验</h2><h3 id="案例8"><a href="#案例8" class="headerlink" title="案例8"></a>案例8</h3><p>测得某地5801人的ABO血型和MN血型结果如表7-10，问两种血型系统之间是否有关联？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-8）</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi15.png" alt=""></p>
<p>没有找到关于Pearson列联系数的函数，手工计算如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">data78 &lt;- matrix(c(431,388,495,137,490,410,587,179,902,800,950,32),nrow=4,dimnames=list(c(&quot;O&quot;,&quot;A&quot;,&quot;B&quot;,&quot;AB&quot;),</div><div class="line">                                                                                        c(&quot;M&quot;,&quot;N&quot;,&quot;MN&quot;)))</div><div class="line">chi.result &lt;- chisq.test(data78)</div><div class="line">chi.result</div><div class="line"></div><div class="line">sqrt(chi.result$statistic/(sum(data78)+chi.result$statistic)) # 列联系数</div><div class="line"></div><div class="line"># 根据手工计算结果，可以构建一个计算Pearson列联系数的自定义函数，如下所示：</div><div class="line"></div><div class="line">Pearson_Continuity &lt;- function(x)&#123;</div><div class="line">  chisq_result &lt;- chisq.test(x)$statistic </div><div class="line">  # 提取计算的卡方值</div><div class="line">  Pcoc &lt;- sqrt(chisq_result/(sum(x)+chisq_result))</div><div class="line">  print.noquote(&quot;Persaon列联系数&quot;) </div><div class="line"># print.noquote的作用是显示字符，不带引号，</div><div class="line"># 而print则是带引号</div><div class="line">  return(as.numeric(Pcoc))&#125;</div><div class="line"></div><div class="line">Pearson_Continuity(data78)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi16.png" alt=""></p>
<h2 id="两两比较——所有组进行两两比较"><a href="#两两比较——所有组进行两两比较" class="headerlink" title="两两比较——所有组进行两两比较"></a>两两比较——所有组进行两两比较</h2><p>当对所有组进行两两比较时，通常采用的方法是Bonferroni法，此方法对原有的检验水平进行调整，即原有的检验水平α除以比较次数得到调整后的检验水平。书本（《医学统计学》第三版，孙振球，P122）中的公式在分母中加了1，不清楚为什么，没有提出采用的是Bonferroni法。而另外两本参考书，即《医学统计学》第6版，马斌荣，P91与《医学统计学》第6版，颜虹，2010年，P155这两本书中所用到的两两比较的方法是Bonferroni法，在下面的题目中使用Bonferroni法。</p>
<h3 id="案例9"><a href="#案例9" class="headerlink" title="案例9"></a>案例9</h3><p>对例7-6中的资料进行两两比较，以推断是否任两种疗法治疗周围性面神经麻痹的有效率均有差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-9）</p>
<p>例7-6中共有三组疗法，需要两两比较的次数是3次，因此检验水平是0.05/3=0.0167。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">data76&lt;-matrix(c(199,164,118,7,18,26),</div><div class="line">               nr = 3,</div><div class="line">               dimnames = list(c(&quot;物理疗法组&quot;, &quot;药物治疗组&quot;,&quot;外用膏药组&quot;),</div><div class="line">                               c(&quot;有效&quot;, &quot;无效&quot;)))</div><div class="line">chisq.test(data76[1:2,],correct=F) </div><div class="line"># 比较物理疗法组与药物治疗组，</div><div class="line"># R中默认四格表进行了Yates校正，</div><div class="line"># 此处设为F，不进行校正，因为实际值与观测值都大于5</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/chi17.png" alt=""></p>
<p>从结果可以看出物理疗法组与药物治疗组有统计学差异。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[2:3,], correct=F)</div><div class="line">#比较药物治疗组与外用膏药组</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi18.png" alt=""><br>从结果来看，药物治疗组与外用膏药组无统计学上的差异。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[-2,],correct=F)</div><div class="line"># 比较物理疗法组与外用膏药组</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi19.png" alt=""></p>
<p>从结果来看，物理疗法组与外用膏药组有统计学上的差异。</p>
<h2 id="两两比较——各个实验组与一个对照组进行比较"><a href="#两两比较——各个实验组与一个对照组进行比较" class="headerlink" title="两两比较——各个实验组与一个对照组进行比较"></a>两两比较——各个实验组与一个对照组进行比较</h2><p>两两比较——各个实验组与一个对照组进行比较<br>当用各个实验组与一个对照组分别进行比较时，需要对检验水平α进行校正，即α/(k-1),其中k是组别。在此案例中，组别k=3,因此，调整后的检验水平=0.05/(3-2)=0.025。</p>
<h3 id="案例10"><a href="#案例10" class="headerlink" title="案例10:"></a>案例10:</h3><p>以表7-8资料中的药物治疗组为对照组，物理疗法组与外用膏药组为试验组，试分析两试验组与对照组的总体有效率有无差别？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-10）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">chisq.test(data76[1:2,],correct=F) </div><div class="line">#比较物理疗法组与药物治疗组</div><div class="line"></div><div class="line">chisq.test(data76[2:3,], correct=F) </div><div class="line">#比较药物治疗组与外用膏药组</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi20.png" alt=""></p>
<p>第一个结果显示，P=0.009343小于0.025，表明物理疗法组与药物治疗组有统计学意义<br>第二个结果显示，P=0.03214大于0.025，表明药物治疗组与外用膏药组无统计学意义。</p>
<p>如果不使用校正p值的这种方法，可以使用其它的R包来进行两两比较，其中要用到的R包是<code>rcompanion</code>。现在使用这个包来进行两两比较，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"rcompanion"</span>)</div><div class="line"><span class="keyword">library</span>(rcompanion)</div><div class="line">data76&lt;-matrix(c(<span class="number">199</span>,<span class="number">164</span>,<span class="number">118</span>,<span class="number">7</span>,<span class="number">18</span>,<span class="number">26</span>),</div><div class="line">               nr = <span class="number">3</span>,</div><div class="line">               dimnames = list(c(<span class="string">"物理疗法组"</span>, <span class="string">"药物治疗组"</span>,<span class="string">"外用膏药组"</span>),</div><div class="line">                               c(<span class="string">"有效"</span>, <span class="string">"无效"</span>))</div><div class="line"></div><div class="line">pairwiseNominalIndependence(data76,</div><div class="line">                            fisher = <span class="literal">FALSE</span>,</div><div class="line">                            gtest  = <span class="literal">FALSE</span>,</div><div class="line">                            chisq  = <span class="literal">TRUE</span>,</div><div class="line">                            method = <span class="string">"fdr"</span>,)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">               Comparison  p.Chisq p.adj.Chisq</div><div class="line"><span class="number">1</span> 物理疗法组 : 药物治疗组 <span class="number">1.68e-02</span>    <span class="number">0.025200</span></div><div class="line"><span class="number">2</span> 物理疗法组 : 外用膏药组 <span class="number">9.34e-06</span>    <span class="number">0.000028</span></div><div class="line"><span class="number">3</span> 药物治疗组 : 外用膏药组 <span class="number">4.78e-02</span>    <span class="number">0.047800</span></div></pre></td></tr></table></figure>
<h2 id="单向R×C列联表分析——列有序"><a href="#单向R×C列联表分析——列有序" class="headerlink" title="单向R×C列联表分析——列有序"></a>单向R×C列联表分析——列有序</h2><h3 id="案例11"><a href="#案例11" class="headerlink" title="案例11"></a>案例11</h3><p>某公司研制一种治疗风湿性关节炎的中药，选择试验组和对照组各60例，试验组服用新药，对照组服用常规药物。以中医证侯疗效为主要疗效指标，分为无效、有效、显效、痊愈四个等级。治疗两个疗程后，两组的疗效情况如表5.4所示（略，见代码），欲分析两种药物的疗效是否有差异（《医学案例统计分析与SAS应用》第五章例5.4，冯国双，北京大学医学出版社，2010:93）。</p>
<h3 id="第一种方法：Ridit分析"><a href="#第一种方法：Ridit分析" class="headerlink" title="第一种方法：Ridit分析"></a>第一种方法：Ridit分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data54 &lt;- c(33,18,24,31,1,9,2,2)</div><div class="line">data54m &lt;- matrix(data54,nrow=2,</div><div class="line">                  dimnames=list(c(&quot;对照组&quot;,&quot;实验组&quot;),</div><div class="line">                                c(&quot;无效&quot;,&quot;有效&quot;,&quot;显效&quot;,&quot;痊愈&quot;)))</div><div class="line">data54m</div><div class="line"></div><div class="line">#从数据来看，列变量，即无效、有效、显效、痊愈这四个等级是有序的，</div><div class="line"># 即越来越好，而行变量，对照组与实验组，这是无效的，适合采用Ridit分析：</div><div class="line"></div><div class="line">library(Ridit)</div><div class="line">ridit(data54m,1) </div><div class="line"># 函数ridit的参数中1表示分组信息是行，即行是无序的，列是有序的，</div><div class="line"># 如果是2，则表示分组信息在列，即列是无序的，行是有序的</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi21.png" alt=""></p>
<h3 id="第二种方法：CMH分析"><a href="#第二种方法：CMH分析" class="headerlink" title="第二种方法：CMH分析"></a>第二种方法：CMH分析</h3><p>用CMH也能进行RC列联表的单向有序分析，CMHtest函数在vcdExtra包中，需要载入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(vcdExtra)</div><div class="line">CMHtest(data54m)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi22.png" alt=""></p>
<p>CMH的单向有序分析参见第3行，即cmeans，这一行表示列有序，行无序的分析结果。</p>
<h2 id="双向有序R×C列联表分析-CMH检验"><a href="#双向有序R×C列联表分析-CMH检验" class="headerlink" title="双向有序R×C列联表分析-CMH检验"></a>双向有序R×C列联表分析-CMH检验</h2><p>对于双向有序的RC列联表进行分析，常用于CMH检验，卡方检验常用于分类变量资料的一种假设检验，该法主要用于两个或多个样本率的比较，也可以用于两变量间的关联分析、频属分析的拟合优度检验等。CMH检验是在1959年提出的mh统计方法的基础上提出来的，1988年才发展完善，现在习惯上称之为扩展的MH卡方检验。他们的主要区别在于，如果用同样的方法做同样的实验，由于实验的地点不同，若将这些不同地点的实验数据简单合并后有卡方检验，会参杂很多混杂因素，这会使检验结果产生很大的偏差—主要是由不同实验的点的软、硬条件不同造成的。采用CMH检验可以解决这类问题，采用的是多中心或分层分析方法，多用R×C列联表的分层统计处理1。此外，CMH还应用于双向有序的RC列联表的分析。如下所示：</p>
<h3 id="案例12"><a href="#案例12" class="headerlink" title="案例12"></a>案例12</h3><p>某研究者欲研究年龄与冠状动脉粥样硬化等级之间的关系，将278例尸解资料整理成表7-13，问年龄与冠状动脉粥样硬化等级之间是否存在线性变化趋势？（《医学统计学》第四版，孙振球，第七章 卡方检验，例7-9）</p>
<h4 id="第一种方法："><a href="#第一种方法：" class="headerlink" title="第一种方法："></a>第一种方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">library(vcdExtra) </div><div class="line"># 载入vcdExtra包</div><div class="line">data711 &lt;- matrix(c(70,27,16,9,22,24,23,20,4,9,13,15,2,3,7,14),nrow=4)</div><div class="line">dimnames(data711) &lt;- list(age=c(&quot;20~&quot;,&quot;30~&quot;,&quot;40~&quot;,&quot;≥50&quot;),degree=c(&quot;-&quot;,&quot;+&quot;,&quot;++&quot;,&quot;+++&quot;))</div><div class="line">CMHtest(data711) # 分析数据</div><div class="line">chisq.test(data711)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi23.png" alt=""></p>
<h4 id="第二种方法："><a href="#第二种方法：" class="headerlink" title="第二种方法："></a>第二种方法：</h4><p>通过coin包中的lbl_test函数也能进行CMH双向有序表的计算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(coin)</div><div class="line">data711t &lt;- as.table(data711)</div><div class="line">lbl_test(data711t,scores=list(age=c(1,2,3,4),degree=c(1,2,3,4)))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi24.png" alt=""></p>
<p>其中，scores是各个有序变量的得分，与教材中相同。</p>
<h4 id="第三种方法："><a href="#第三种方法：" class="headerlink" title="第三种方法："></a>第三种方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(reshape2)</div><div class="line">datax &lt;- melt(data711)</div><div class="line">datax$age &lt;- factor(datax$age,order=T)</div><div class="line">datax$degree &lt;- factor(datax$degree,order=T)</div><div class="line">CMHtest(xtabs(value~age+degree,data=datax))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi25.png" alt=""></p>
<p>结果解读：(1)第1行的cor指的是行与列都为有序变量时的结果，即教材中的线性回归分量，为63.389，这个与教材的结果不一致，但R计算的结果与教材附带的SAS程序计算出来的结果一致，教材可能是印刷错误；(2)第2行的rmeans表示行是有序变量时的结果；(3)第3行的cmeans表示列是有序变量时的结果；(4)general表示列与行都是无序变量时的结果。</p>
<p>常规卡方计算的结果是71.4325。线性回归分量的结果是63.389，二者之差是教材中的偏离线性回归分量，即71.4325-63.389=8.0435，相应的P值为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1-pchisq(8.0435,8)</div></pre></td></tr></table></figure>
<p>p值结果为0.4292325，可以认为年龄与冠状动物粥样硬化之间不仅存在相关关系，并且为线性关系，从数据中可以看出来，冠状动脉粥样硬化的等级随着年龄的增加而增高。<br>注：pchisq(8.0435,8)表示，计算自由度为8，卡方值是8.0435的左侧卡方分布曲线下面积。</p>
<h4 id="第4种方法："><a href="#第4种方法：" class="headerlink" title="第4种方法："></a>第4种方法：</h4><p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"multiCA"</span>)</div><div class="line"><span class="keyword">library</span>(multiCA)</div><div class="line">multiCA.test(data711)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; multiCA.test(data711)</div><div class="line">$overall</div><div class="line"></div><div class="line">	Multinomial Cochran-Armitage trend test</div><div class="line"></div><div class="line">data:  data711</div><div class="line">W = <span class="number">63.68</span>, df = <span class="number">3</span>, p-value = <span class="number">9.611e-14</span></div><div class="line">alternative hypothesis: true slope <span class="keyword">for</span> outcomes <span class="number">1</span>:nrow(x) is not equal to <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line">$individual</div><div class="line">[<span class="number">1</span>] <span class="number">1.020527e-10</span> <span class="number">4.248539e-01</span> <span class="number">1.963178e-02</span> <span class="number">2.613094e-09</span></div><div class="line">attr(,<span class="string">"method"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"Holm-Shaffer"</span></div></pre></td></tr></table></figure>
<h2 id="CMH检验对多层分类资料的分析"><a href="#CMH检验对多层分类资料的分析" class="headerlink" title="CMH检验对多层分类资料的分析"></a>CMH检验对多层分类资料的分析</h2><h3 id="案例13"><a href="#案例13" class="headerlink" title="案例13"></a>案例13</h3><p>某公司推出一种治疗颈椎病的治疗仪，为评价其疗效，进行多中心的随机对照试验。共选择两家医院，每家医院60例研究对象，试验组与对照组各30例。以颈痛疗效作为主要疗效指标，根据缓解程度分为有效和无效。治疗20天后，各中心每组的疗效情况如下所示（参见代码），欲分析两种治疗仪的疗效是否有差异（《医学案例统计分析与SAS应用》第五章例5.4，冯国双，北京大学医学出版社，2010:97）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data56 &lt;- c(8,4,22,26,11,9,19,21)</div><div class="line">data56a &lt;- array(data56,dim=c(2,2,2))</div><div class="line">data56a</div><div class="line">dimnames(data56a) &lt;- list(</div><div class="line">  c(&quot;对照组&quot;,&quot;试验组&quot;),</div><div class="line">  c(&quot;无效&quot;,&quot;有效&quot;),</div><div class="line">  c(&quot;中心1&quot;,&quot;中心2&quot;))</div><div class="line"></div><div class="line">CMHtest(data56a,overall=TRUE)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi26.png" alt=""></p>
<p>结果由三部分构成，第一部分是中心1的结果，第二部分是中心2 的结果，第三部分是控制了中心的影响后，两组疗效差异无统计学意义。</p>
<h2 id="拟合优势的卡方检验"><a href="#拟合优势的卡方检验" class="headerlink" title="拟合优势的卡方检验"></a>拟合优势的卡方检验</h2><h3 id="案例14：判断数据是否服从泊松分布"><a href="#案例14：判断数据是否服从泊松分布" class="headerlink" title="案例14：判断数据是否服从泊松分布"></a>案例14：判断数据是否服从泊松分布</h3><p>观察某克山病区克山病患者的空间分布情况，调查者将该地区划分为279个取样单位，统计各取样单位历年累计病例数，资料见表7-15的第（1）、（2）栏，问此资料是否服从Poisson分布？（《医学统计学》第三版，孙振球，第七章 卡方检验，例7-13）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">x&lt;-0:6</div><div class="line">y&lt;-c(26,51,75,63,38,17,9)</div><div class="line">mean&lt;-mean(rep(x,y))</div><div class="line">q&lt;-ppois(x,mean)</div><div class="line">n&lt;-length(y)</div><div class="line">p&lt;-c()</div><div class="line">p[1]&lt;-q[1]</div><div class="line">p[n]&lt;-1-q[n-1]</div><div class="line">for(i in 2:(n-1))</div><div class="line">  p[i]&lt;-q[i]-q[i-1]</div><div class="line"></div><div class="line">chisq.test(y, p=p,correct=F)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi27.png" alt=""></p>
<h3 id="案例15-：判断数据是否服从某一比例"><a href="#案例15-：判断数据是否服从某一比例" class="headerlink" title="案例15 ：判断数据是否服从某一比例"></a>案例15 ：判断数据是否服从某一比例</h3><p>假设H0：总体具有某分布F 备择假设H1：总体不具有该分布。<br>我们将数轴分成若干个区间，所抽取的样本会分布在这些区间中。在原假设成立的条件下，我们便知道每个区间包含样本的个数的期望值。用实际值Ni 与期望值Npi可以构造统计量K 。皮尔森证明，n趋向于无穷时，k收敛于m-1的塔防分布。m为我们分组的个数。有了这个分布，我们就可以做假设检验。 </p>
<p>某消费者协会为了确定市场上消费者对5咎品牌啤酒的喜好情况，随机抽取了1000名啤酒爱好者作为样本进行如下试验：每个人得到5种品牌的啤酒各一瓶，但未标明牌子。这5种啤酒按分别写着A、B、C、D、E字母的5张纸片随机的顺序送给每一个人，下表是根据样本资料整理得的各种品牌啤酒爱好者的频数分页，试根据这些数据判断消费者对这5种品牌啤酒的爱好有无明显差异？<br><img src="http://ortxpw68f.bkt.clouddn.com/chi28.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(210,312,170,85,223) </div><div class="line">n &lt;- sum(x); m &lt;- length(x) </div><div class="line">p &lt;- rep(1/m,m) </div><div class="line">K &lt;- sum((x-n*p)^2/(n*p)); K #计算出K值 </div><div class="line">p &lt;- 1-pchisq(K,m-1); p #计算出p值</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi29.png" alt=""></p>
<p>在R语言中 chisq.test()，可以完成拟合优度检验。默认就是检验是否为均匀分布，如果是其他分布，需要自己分组，并在参数p中指出。上面题目的解法如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chisq(x)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi30.png" alt=""></p>
<p>同样拒绝原假设。</p>
<h3 id="案例16-：判断数据是否服从正态分布"><a href="#案例16-：判断数据是否服从正态分布" class="headerlink" title="案例16 ：判断数据是否服从正态分布"></a>案例16 ：判断数据是否服从正态分布</h3><p>抽取31名学生的成绩，检验是否为正态分布。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(25,45,50,54,55,61,64,68,72,75,75,78,79,81,83,84,84,84,85,86,86,86,87,89,89,89,90,91,91,92,100) </div><div class="line">A &lt;- table(cut(x,breaks=c(0,69,79,89,100))) ;A#对样本数据进行分组。 </div><div class="line">p &lt;- pnorm(c(70,80,90,100),mean(x),sd(x)) #获得理论分布的概率值 </div><div class="line">p &lt;- c(p[1],p[2]-p[1],p[3]-p[2],1-p[3]) </div><div class="line">chisq.test(A,p=p)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi31.png" alt=""><br>结果显示，其p值小于0.05，成绩不属于正态分布。</p>
<p>再用shirpo.test()和qq图检验一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shapiro.test(x)</div><div class="line">qqnorm(x);qqline(x, col = 2)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi32.png" alt=""><br><img src="http://ortxpw68f.bkt.clouddn.com/chi33.png" alt=""></p>
<p>结果显示，p值小于0.05，不是正态分页，并且QQ图明显表示出成绩不符合正态分布。</p>
<h3 id="案例17-：判断数据是否符合原比例"><a href="#案例17-：判断数据是否符合原比例" class="headerlink" title="案例17 ：判断数据是否符合原比例"></a>案例17 ：判断数据是否符合原比例</h3><p>大麦杂交后关于芒性的比例应该是 无芒：长芒：短芒=9:3:4 。我们的实际观测值是335：125：160 。请问观测值是否符合预期？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p &lt;- c(9/16,3/16,4/16) </div><div class="line">x &lt;- c(335,125,160) </div><div class="line">chisq.test(x,p=p)</div></pre></td></tr></table></figure></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi34.png" alt=""></p>
<p>在分组的时候要注意，每组的频数要大于等于5.如果理论分布依赖于多个未知参数，只能先由样本得到参数的估计量。然后构造统计量K，此时K的自由度减少位置参数的数量个。</p>
<h2 id="ks检验"><a href="#ks检验" class="headerlink" title="ks检验"></a>ks检验</h2><p>R语言中提供了ks.test()函数，理论上可以检验任何分布。他既能够做单样本检验，也能做双样本检验。 </p>
<h3 id="案例18：判断数据是否服从指数分布"><a href="#案例18：判断数据是否服从指数分布" class="headerlink" title="案例18：判断数据是否服从指数分布"></a>案例18：判断数据是否服从指数分布</h3><p>记录一台设备无故障工作时常，并从小到大排序420 500 920 1380 1510 1650 1760 2100 2300 2350。问这些时间是否服从拉姆达=1/1500的指数分布？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(420,500,920,1380,1510,1650,1760,2100,2300,2350) </div><div class="line">ks.test(x,&quot;pexp&quot;,1/1500)</div></pre></td></tr></table></figure></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi35.png" alt=""></p>
<h3 id="案例19：判断两批数据是否服从相同分布"><a href="#案例19：判断两批数据是否服从相同分布" class="headerlink" title="案例19：判断两批数据是否服从相同分布"></a>案例19：判断两批数据是否服从相同分布</h3><p>有两个分布，分别抽样了一些数据，问他们是否服从相同的分布。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">X&lt;-scan() </div><div class="line">0.61 0.29 0.06 0.59 -1.73 -0.74 0.51 -0.56 0.39 1.64 0.05 -0.06 0.64 -0.82 0.37 1.77 1.09 -1.28 2.36 1.31 1.05 -0.32 -0.40 1.06 -2.47</div><div class="line"></div><div class="line">Y&lt;-scan() </div><div class="line">2.20 1.66 1.38 0.20 0.36 0.00 0.96 1.56 0.44 1.50 -0.30 0.66 2.31 3.29 -0.27 -0.37 0.38 0.70 0.52 -0.71</div><div class="line"></div><div class="line">ks.test(X,Y)</div></pre></td></tr></table></figure></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/chi36.png" alt=""></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="http://doctor.51daifu.com/2007/0305/1ADAD919C959T148648.shtml" target="_blank" rel="external">http://doctor.51daifu.com/2007/0305/1ADAD919C959T148648.shtml</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_686dcf990100z9q3.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_686dcf990100z9q3.html</a></li>
<li><a href="http://medstats.blog.163.com/blog/static/17974801620089108192736/" target="_blank" rel="external">http://medstats.blog.163.com/blog/static/17974801620089108192736/</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_4b361fe00100y222.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_4b361fe00100y222.html</a></li>
<li>孙振球. 医学统计学[M]. 人民卫生出版社, 2010.</li>
<li>徐俊晓. 统计学与R读书笔记(第六版)</li>
<li>葛毅, 胡良平. 高维列联表资料的统计分析与 SAS 软件实现 (一)[J]. 中西医结合学报, 2009, 7(11): 1086-1089.</li>
<li><a href="http://bbs.pinggu.org/thread-521307-1-1.html↩" target="_blank" rel="external">http://bbs.pinggu.org/thread-521307-1-1.html↩</a></li>
<li>白话统计.冯国双</li>
<li>医学统计学与R语言（公众号）</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/05/BioStatistics/生物统计-07方差分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/BioStatistics/生物统计-07方差分析/" itemprop="url">方差分析笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T12:01:00+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,371
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="方差分析的基本思想及应用条件"><a href="#方差分析的基本思想及应用条件" class="headerlink" title="方差分析的基本思想及应用条件"></a>方差分析的基本思想及应用条件</h2><h3 id="方差分析的基本思想"><a href="#方差分析的基本思想" class="headerlink" title="方差分析的基本思想"></a>方差分析的基本思想</h3><p>在进行科学研究时，有时要按实验设计将所研究的对象分为多个处理组进行不同的处理，其中<code>处理因素(treatment)</code>至少有两个<code>水平（level）</code>。这类科研资料的统计分析，是通过所获得的样本信息来推断各处理组均数间的差别是否有统计学意义，即处理是否有影响。常用采用的分析方法就<code>是方差分析（ANOVA，analysis of variance）</code>，这是由英国统计学家R.A.Fisher首创，以F命名，故方差分析又称为F检验。</p>
<p>设处理因素有$g(g\geq 2)$个不同水平，实验对象随机分为$g$组，分别接受不同水平的干预，第$i(i=1,2,\dots,g)$组的样本含量为$n_{i}$，第$i$处理组的第$j(j=1,2,…n_{i})$个观测值用$X_{ij}$来表示，其计算结果可能可以整理成以下面的形式，如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/anova11.png" alt=""></p>
<p>方差分析的目的就是在$H_{0}:\mu_{1}=\mu_{2}\dots=\mu_{_{g}}$成立的条件下，通过分析各处理组均数之间的差别大小，推荐$g$个总体均数$\bar{X}_{i}$间有无差别，从面说明处理因素的效应是否存在。</p>
<p>记总均数为$\bar{X}=\sum_{i=1}^g\sum_{j=1}^{n_{j}}X_{ij}/N$，各处理组均数为$\bar{X}=\sum_{j=1}^{n_{i}}X_{ij}/n_{i}$,总例数为$N=n_{1}+n_{2}+\dots+n_{g}$，g为处理组数。</p>
<p>实验数据有三个不同的变异：<br><strong>1. 总变异</strong>。全部观测值大小不同，这种变异称为总变异。总变异的大小可能用离均差平方和(sum of squares of deviations from eman,SS)来表示，即各观测值$X_{ij}$与总均数$\bar{X}$差值的平方和，记为$SS_{总}$。公式略。</p>
<p><strong>2. 组间变异</strong>。各处理组由于接受处理的水平不同，各组的样本均数$\bar{X}_{i}（i=1,2,\dots,g）$也大小不等，这种变异称为组间变异，其大小用各组均数$\bar{X_{i}}$与总均数$\bar{X}$的离均差平方和表示，记为$SS_{组间}$，计算公式略。</p>
<p>各组均数之间相关越悬殊，它们与总均数的差值越在在，$SS_{组间}$就越大，反之$SS_{组间}$就越小。$SS_{组间}$反应了各组均数的变异，存在这种变异的原因有：①随机误差；②处理的不同水平可能对实验结果的影响。</p>
<p><strong>3. 组内变异</strong>。在同一处理组中，虽然每个实验对象接受的处理相同，但观测值仍各不相同，这种变异称为组内变异（误差）。组内变异用组内各观测值$X_{ij}$与其所在组的均数$\bar{X_{i}}$的差值的平方和表示，记为$SS_{组内}$，表示随机误差的影响。公式略。</p>
<p>总离均差平方和分解为组间离均差平方和与组内离均差平方和，就有了以下公式：</p>
<script type="math/tex; mode=display">SS_{总}=SS_{组间}+SS_{组内}</script><p>各离均差平方和的自由度为：</p>
<script type="math/tex; mode=display">\nu_{总}=N-1，\nu_{组间}=g-1,\nu_{组内}=N-g</script><p>变异程序除与离均差平方和的大小腾外，还与其自由度有关，由于各部分自由度不相等，因此积分离均差平方和不能直接比较，须将各部分离均差平方和除以相应的自由度，其比值称为均方差，简称为均方（mean square, MS)。公式为：</p>
<script type="math/tex; mode=display">MS_{组间}=\frac{SS_{组间}}{\nu_{组间}}</script><script type="math/tex; mode=display">MS_{组内}=\frac{SS_{组内}}{\nu_{组内}}</script><p>如果各组样本的总体均数相等($H_{0}:\mu_{1}=\mu_{2}\dots=\mu_{_{g}}$)，即各处理组的样本来自相同的总体，无处理因素的作用，则组间变异同组内变异一样，只反映随机误差作用的大小，组间均方与组内无方的比值称为F统计量，如下所示：</p>
<script type="math/tex; mode=display">F=\frac{MS_{组间}}{MS_{组内}}</script><p>如果F值接近于1，就没有理由拒绝$H_{0}$;反之，F值越大，拒绝$H_{0}$的理由越充分，数理统计的理论证明，当$H_{0}$成立时，F统计量服从F分布，方差分析是单侧F检验。</p>
<h2 id="变异是方差分析的基本思想"><a href="#变异是方差分析的基本思想" class="headerlink" title="变异是方差分析的基本思想"></a>变异是方差分析的基本思想</h2><p>上面的话可能不太好理解。现在用大白话来理解一下，例如我们要研究某个化合物是否有改善肥胖的效果，我们最初肯定是要做动物实验，动物实验的话，例如采用C57的小鼠，分为5组，第1组，给生理盐水，第2组，给减肥药（相当于阳性对照），第3组，给高剂量的化合物，第4组，给中剂量的化合物，第5组，给低剂量的化合物。分别喂一段时间后，我们发现小鼠的体重有所变化，这个变化由两部分构成，第一个就是外界的刺激因素导致的，第二种就是小鼠自身导致的。这种变化我们可以称为<code>变异（variance），方差分析研究的本质就是这种变异（体重的变化，不是基因变异那种变异），方差分析的英语就是</code>Analysis of variance`，如果外界的刺激的因素导致的变异程度远远大于小鼠自身因素导致的变异，那么我们就可以认为，导致小鼠体重这种变异是由外界刺激引起的。</p>
<p>不过这样还有一个问题，因为数据越多，变异程度就越大，为了解决这个问题，就需要用变异除以自由度（例数-1），这样比较的就是平均的变异，因此方差分析中就出现了均方（MS）和组内均方的概念。组间均方/组内均方就是通常所说的F值，实际上代表了这样一个含义：如果组间变异远远大于组内变异，那么组间均方除以组内均方的值肯定很大，反之，这一值就会很小。但是，到底大到什么程度才认为有统计学意义呢，那就得根据F分布来判断。</p>
<h3 id="方差分析的应用条件"><a href="#方差分析的应用条件" class="headerlink" title="方差分析的应用条件"></a>方差分析的应用条件</h3><p>多个样本均数比较的方差分析其应用条件为：①各样本是相互独立的随机样本，均来自**正态分布总体；②相互比较的各样本的总体方差相等，即具有等方差齐性。</p>
<h2 id="R中的方差分析函数"><a href="#R中的方差分析函数" class="headerlink" title="R中的方差分析函数"></a>R中的方差分析函数</h2><p>所用的函数为aov()：<br>语法为：<code>aov（formula,data=dataframe）</code><br>其中formula可使用的特殊符号如下，其中y为因变量，A、B、C为自变量：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>符号</th>
<th>用法</th>
</tr>
</thead>
<tbody>
<tr>
<td>～</td>
<td>分隔符，左边为因变量，右边为自变量。例y～A+B+C</td>
</tr>
<tr>
<td>+</td>
<td>分隔自变量</td>
</tr>
<tr>
<td>：</td>
<td>表示交互项，如y～A+B+A:B</td>
</tr>
<tr>
<td>*</td>
<td>表示所有可能的交互项，如y～A <em> B </em>C等价于y～A+B+C+A:B+A:C+B:C+A:B:C</td>
</tr>
<tr>
<td>^</td>
<td>表示交互项达到的某个次数，如y～(A+B+C)^2等价于y～A+B+C+A:B+A:C+B:C</td>
</tr>
<tr>
<td>.</td>
<td>表示包含除因变量以外的所有变量。如y～.</td>
</tr>
</tbody>
</table>
</div>
<h2 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h2><h3 id="案例一：常规单因素方差分析"><a href="#案例一：常规单因素方差分析" class="headerlink" title="案例一：常规单因素方差分析"></a>案例一：常规单因素方差分析</h3><p>单因素方差分析（one-way ANOVA）是指对单因素试验结果进行分析，检验因素对试验结果有无显著性影响的方法。单因素方差分析是用来检验多个平均数之间的差异，从而确定因素对试验结果有无显著性影响的一种统计方法。对于完全随机设计试验且处理数大于2时可以用单因素方差分析（等于2 时用t检验）。离差平方和的分解公式为：SST(总和)=SSR(组间)+SSE(组内)，F统计量为MSR/MSE，MSR=SSR/k-1,MSE=SSE/n-k。其中SST为总离差、SSR为组间平方和、SSE为组内平方和或残差平方和、MSR为组间均方差、MSE为组内均方差。</p>
<h4 id="案例1-1"><a href="#案例1-1" class="headerlink" title="案例1.1"></a>案例1.1</h4><p>单因素方差分析例4-2：某医生为了研究一种降血脂新药的临床疗效，按统一纳入标准选择120名高血脂患者，采用完全随机设计方法将患者等分为4组（具体分组方法见例4-1），进行双盲试验。6周后测得低密度脂蛋白作为试验结果，见表4-3。问4个处理组患者的低密度脂蛋白含量总体均数有无差别?<br>数据如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/data_szq_402.png" alt=""></p>
<p><strong>计算过程如下所示：</strong></p>
<p><strong>1. 导入数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">anova1 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_szq_402.csv&quot;,sep=&quot;,&quot;)</div><div class="line">library(reshape2)</div><div class="line">anova1 &lt;- melt(anova1)</div></pre></td></tr></table></figure>
<p><strong>2. 正态检验</strong></p>
<p>方差分析需要一定的假设，即数据集应该符合正态和各组的方差相等，可以分别用shapiro.test和bartlett.test检验从P值观察到这两个假设是符合的。对于不符合假设的情况，我们就要用到非参数方法，例如Kruskal-Wallis秩和检验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shapiro.test(anova1$value)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/anova3.png" alt=""></p>
<p>P值大于0.05说明数据正态P值大于0.05说明数据正态</p>
<p><strong>3. 方差齐性检验:</strong><br>方差齐性检验就是检验各组样本所代表的总体方差是否一致的检验，两样本方差齐性检验使用Bartlett法，同样，它也适用于多样本的方差齐性检验，它是它要求所检验的样本总体符合正态分页，当不符合正态分布的时候，就不能使用，则要用Levene检验。Levene检验不受数据颁贩限制，是一种稳健的检验，因而被广泛地认为是一种标准的检验方差齐性的检验。</p>
<p><strong>方差齐性通常用bartlett检验</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bartlett.test(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova1.png" alt=""></p>
<p>结果显示p值大于0.05，可认为方差齐性。</p>
<p>或者用<strong>levene检验：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(car)</div><div class="line">leveneTest(anova1$value~anova1$variable)</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova2.png" alt=""><br>结果发现sig值大于0.05,表明符合方差齐性假设,可以进行进一步的参数检验。</p>
<p><strong>4. 检验整体均值是否有差异</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result &lt;- aov(value~variable,data=anova1)</div><div class="line">summary(result)</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova4.png" alt=""></p>
<p>其中p值小于0.001，因此各组之间存在显著性差异。另外，R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。</p>
<p><strong>5. 均数间的多重比较</strong></p>
<p>方差分析得出总体之间有差异，要进一步知道哪两组之间有差异，就要使用均数间的多重比较，常用的比较方法有SNK检验（q检验），LSD检验，Bonferroni检验，Dunnett检验，TurkeyHSD检验。</p>
<p><strong>现在计算各组之间的均数与SD</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=mean)</div><div class="line">aggregate(anova1$value,by=list(anova1$variable),FUN=sd)</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova1_mean_sd.png" alt=""></p>
<p><strong>绘制箱形图可能观察到不同因素对于因变量的影响</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot.design(value ~ variable,data =anova1, main = &quot;Group means&quot;) </div><div class="line"># plot.design was inclued in packages &quot;graphics&quot;</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/anova13.png" alt=""></p>
<p><strong>绘制有置信区间的组均值图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">library(gplots)</div><div class="line">plotmeans(value ~ variable,data =anova1 )</div></pre></td></tr></table></figure>
<p>图片如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/anova12.png" alt=""></p>
<p><strong>LSD检验与TukeyHSD检验</strong><br>通过方差分析后，如果整体有差异，则进一步进行两两比较，常用的方法用LSD和TukeyHSD方法，如下所示：</p>
<p><strong>LSD检验</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(agricolae) #此包中有LSD检验</div><div class="line">result &lt;- LSD.test(result,&quot;variable&quot;,p.adj=&quot;bonferroni&quot;)</div><div class="line">result</div></pre></td></tr></table></figure>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova5.png" alt=""></p>
<p>注：R给出的F值是24.88，而书中的例子是24.93，书中的值是由查F表得来的，是个范围，R中的是具体值。<br>Bonferroni校正(“bonferroni”)，用于多重比较的p值校正，次数不多时适用。如果在同一数据集上同时检验n个独立的假设，那么用于每一假设的统计显著水平，应为仅检验一个假设时的显著水平的1/n。举个例子：如要在同一数据集上检验两个独立的假设，显著水平设为常见的0.05。此时用于检验该两个假设应使用更严格的0.025。即0.05* (1/2)。该方法是由Carlo Emilio Bonferroni发展的，因此称Bonferroni校正。在药理实验中，动物数通常不会太多，用Bonferroni校正的居多。</p>
<p><strong>TukeyHSD()检验</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">result2 &lt;- aov(value~variable,data=anova1)</div><div class="line">result.tukey &lt;- TukeyHSD(result2)</div><div class="line">result.tukey</div><div class="line">plot(result.tukey)</div></pre></td></tr></table></figure>
<p>结果如下所示：<br><img src="http://ortxpw68f.bkt.clouddn.com/anova_tukey.png" alt=""></p>
<p>图片结果：<br><img src="http://ortxpw68f.bkt.clouddn.com/anova_tukey_plot.png" alt=""></p>
<h4 id="案例1-2"><a href="#案例1-2" class="headerlink" title="案例1.2"></a>案例1.2</h4><p>例5.1 某单位研究不同药物对小白鼠的镇咳作用，抽取40只小白鼠随机分配到各个药物组中，实验时先用0.2mL NH4OH对小白鼠喷雾，测定其发生咳嗽时间。以给药前后发生咳嗽时间的差值衡量不同药物的镇咳作用，结果见表5.1.试比较3种药物的平均推迟咳嗽时间的差异有无差异。（王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.）</p>
<p>计算过程如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">anova2 &lt;- read.csv(&quot;https://raw.githubusercontent.com/20170505a/raw_data/master/data_anova_01.csv&quot;,sep=&quot;,&quot;)</div><div class="line"># input raw data </div><div class="line"># 王炳顺. 医学统计学及SAS应用[M]. 上海交通大学出版社, 2007.例5.1</div><div class="line"></div><div class="line">anova2$group &lt;- as.factor(anova2$group)</div><div class="line">library(car)</div><div class="line">leveneTest(anova2$time~anova2$group)</div><div class="line">result &lt;- aov(anova2$time~anova2$group)</div><div class="line">summary(result)</div><div class="line">compareresult &lt;- TukeyHSD(result)</div><div class="line">compareresult</div><div class="line">plot(compareresult)</div></pre></td></tr></table></figure></p>
<p>结果如下所示：<img src="http://ortxpw68f.bkt.clouddn.com/anova2.1.png" alt=""></p>
<p>两两比较的结果<br><img src="http://ortxpw68f.bkt.clouddn.com/anova2.2.png" alt=""></p>
<p>绘图：<br><img src="http://ortxpw68f.bkt.clouddn.com/anova2.3.png" alt=""></p>
<h3 id="案例二：双因素方差分析（Two-way-ANOVA）"><a href="#案例二：双因素方差分析（Two-way-ANOVA）" class="headerlink" title="案例二：双因素方差分析（Two-way ANOVA）"></a>案例二：双因素方差分析（Two-way ANOVA）</h3><h3 id="案例四：重复测量方差分析"><a href="#案例四：重复测量方差分析" class="headerlink" title="案例四：重复测量方差分析"></a>案例四：重复测量方差分析</h3><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>白话统计.冯国双</li>
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/06/04/BioStatistics/生物统计-04常见概率分布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/04/BioStatistics/生物统计-04常见概率分布/" itemprop="url">常见概率分布笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-04T12:00:00+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生物统计/" itemprop="url" rel="index">
                    <span itemprop="name">生物统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8,775
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  35
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随机变量取一切可能值的概率的规律称为<strong>概率分布(probability distribution)</strong>，简称为分布，通常使用表格，图形，公式来表示这些分布，一个概率分布总是一和个总体(population)相关联的，这里的总体也称为<strong>样本空间(sample space)</strong>，它是由某种试验的所有可能结果构成的集合，这些结果的获取服从某种概率规律，因此， 一个总体（样本空间）是由一个取值范围及与之相连的概率所组成。于是，给出了这个概率分布就等于知了总体，这些用数学语言表示的概率分布有一些理论参数，称为<strong>总体参数(population parameter)</strong>，对于一个样本来说，它有自己的一些参数，例如样本均值、样本方差、样本标准差、样本分位数等。相对于总体，它也有总体均值、总体方差、总体标准差，总体分位数等参数。只是对于不同的总体，这些参数可能不同，并且对于某些总体，某些参数可能就不存在。 </p>
<h2 id="离散型分布"><a href="#离散型分布" class="headerlink" title="离散型分布"></a>离散型分布</h2><p>离散变量很常见，例如在一批产品的质量检查中可能发现的次品数目、一日内通过某电话总体的通话次数、在若干次试验中成功的次数等，这些变量取离散值，而且按照某种概率来取每个值，取每个值的概率应该大于或等于0、小于或等于1，并且取各种值的概率之和应该等于1，用符号来表示就是，假定离散随机变量X的取值范围为$x_{1},x_{2},\cdots,$而且取可能值$x_{i}$的概率记为$P(x_{i})\equiv P(X=x_{i})$，那么这些概率应该同时满足下面的关系：</p>
<p>$\sum_{i}P(x_{i})=1,\qquad 0 \leq P(x_{i})$</p>
<p>满足这样关系的概率$P(x_{i})​$的总和就是该离散变量的概率分布。离散变量的取值不一定是有穷的，例如Poisson分布的取值范围就是所有的非负整数，因而有无穷多可能的值。</p>
<p>除了分布函数$P(X=x_{i})$外，还有<strong>累积分布函数(cumulative distribution function, CDF)</strong>的概念，离散随机变量的累积分布函数的定义如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/eBibh51HkF.png?imageslim" alt="mark"></p>
<p><strong>统计教科书上的各种概率分布表，通常都是累积分布函数的值</strong>，在计算时，这往往比原始的概率分布要方便，例如我要计算$P(a&lt;X \leq b)$，那么或者用求和来计算，即如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/fHGbFGliIA.png?imageslim" alt="mark"></p>
<p>或者是通过相减来计算，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/I2KLcEdFA0.png?imageslim" alt="mark"></p>
<p>显然，通过相减计算要容易得多，只需要找到F(b)和F(a)即可。</p>
<p>对于离散分布随机变量X来说，它的总体均值（通常用$\mu$表示）定义如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/B4ECgkBac3.png?imageslim" alt="mark"></p>
<p>它又称为X的数学期望，这里的符号$E(x)$就是X的期望(expectation)的意思。</p>
<p>变量X的总体方差通常用$\delta^2$表示，它的公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/4jGcihFbea.png?imageslim" alt="mark"></p>
<p>这里的符号$Var(X)$就是X的方差(variance)的意思，总体标准差定义为总体方差的平方根，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/HjcKe9cHB1.png?imageslim" alt="mark"></p>
<p>显然，这里的均值、方差等概率和样本均值、样本方差很相似，只要把这里的$x_{i}$换成样本点，而把$P(x_{i})$换成$1/n$（在样本方差经常使用$1/(n-1)$，在样本量大的时候$1/n$和$1/(n-1)$差别不大），就和样本量为n的情况下的样本均值和样本方差一致了，需要注意的是，总体均值和总体方差有可能是无穷或者不存在的（总体的数据很难得到，只能根据样本来推测总体），但样本均值和样本方差总是存在的。</p>
<p>下面看一些常见的离散型分布</p>
<h2 id="二项分布"><a href="#二项分布" class="headerlink" title="二项分布"></a>二项分布</h2><p>先看一个案例描述。</p>
<p>某项考虑有10道题，假定某考生答对每道题的概率是0.6，并假定各个题目的答案独立，而及格的标准则是至少答对6道题，那么至少答对6道题的概率就是事件“通过考试“的概率，这时，如果把答对题目的数目记为X，那么X是一个定量变量，而通过考虑的或者考试及格的概率就可以用以下公式来表示，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/k0DhlIhj8m.png?imageslim" alt="mark"></p>
<p>而没有一道题答对的概率为$P(X=0)$，这就是说10道题都答错，根据题目中的描述，我们知道答错题的概率是0.4，10道全错的概率就是$0.4^{10} \approx 0.0001048576$，</p>
<p>这个案例中描述的变量就是一个二项分布随机变量，每回答一道题就是一个试验，每次试验成功的概率是固定的，这里是0.6，这10次试验（答10道题）是互相独立的，在重复的独立试验中，如查每个试验仅可能为两种可能结果之一，而且得到相应结果的概率在每次试验中保持不变，则称这些重复独立试验为Bernoulli试验，一般用$p$和$q=(1-p)$分别表示每次试验得到的两种结果的概率，这两种结果通常被抽象地称为”成功“和”失败“，这当然不是实际意义上的成功和失败，仅仅是两种结果的代号而已。</p>
<p>人们一般会关心，如果进行n次Bernoulli试验，每次成功的概率是p，那么某中成功次数X=k次的概率是多少？</p>
<p>我们用下面的抽球案例来理解这个问题。</p>
<h3 id="抽球实验"><a href="#抽球实验" class="headerlink" title="抽球实验"></a>抽球实验</h3><p>Bernoulli试验：一个罐子中，含有1个红球，3个蓝球，每次随机取出1个球，观察其颜色，再放回，再抽取下一个球（这是有放回的抽样），每次抽得的红球的概率为p=1/4，蓝球的概率是q=1-p=3/4，用R表示红球的事件，用B表示蓝球的事件，而用P(RB)表示第一次得到的是红球，第二次得到的蓝球的概率等，用X表示在n次试验中观测到红球的次数，下面以n=2和n=3为例说明一下这个概率。</p>
<p>其中下面的这个公式</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180816/59jKHa8hfk.png?imageslim" alt="mark"></p>
<p>它表示从n个元素中选取k个元素的组合数。</p>
<p>现在看n=2的情况。</p>
<p>n=2表示是我们抽取2次，这里面又分3种情况。</p>
<p>第1种情况：2次抽取，抽到0个红球，也就是两次都是蓝球，这种情况的概率如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/gcDa8laAGg.png?imageslim" alt="mark"></p>
<p>第2种：2次抽取，刚好有一次观测到红球的概率（这种情况可以理解为，第1次红球，第2次蓝球或第1次蓝球，第2次红球），如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/7jlJLk636K.png?imageslim" alt="mark"></p>
<p>第3种：2次抽取，均是红球的概率：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/86Hb6fjHDD.png?imageslim" alt="mark"></p>
<p>现在看n=3的情况。</p>
<p>n=3表示是我们抽取3次，这里面又分4种情况。</p>
<p>第1种情况：抽取3次，只有0个红球，概率如下：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/8dH4i22F99.png?imageslim" alt="mark"></p>
<p>第2种情况：抽取3次，只抽到1个红球，概率如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/BjD76CckKB.png?imageslim" alt="mark"></p>
<p>第3种情况：抽取3次，抽到2个红球，概率如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/iK1JlBDjlG.png?imageslim" alt="mark"></p>
<p>第4种情况：抽取3次，抽到3个红球，概率如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/DB40kife7i.png?imageslim" alt="mark"></p>
<p>从这个问题的描述中我们可以知道下面的信息：</p>
<p>当n=2时，对于$k=0,1,2,P(X=k)=C_{2}^kp^kq^{2-k}$</p>
<p>当n=3时，对于$k=0,1,2,3,P(X=k)=C_{3}^kp^kq^{3-k}$</p>
<p>因此，我们可以把它们放在一起，如下所示：</p>
<p>$P(X=k)=C_{n}^kp^k(1-p)^{n-k},\quad k=0,1,\cdots,n,$</p>
<p>这里的$C_{n}^k$就是$(a+b)^n$展开的系数，我们把在成功概率为p的n次Bernoulli试验中成功次数X称为具有参数(n,p)的二项分布(binomial distribution)的随机变量，可以用B(n,p)、Bin(n,p)或Binomial(n,p)等表示这样的二项分布，由于参数中的n和p可能取不同的值，因此二项分布是一族分布，称为二项分布族，在n=1时的二项分布又称为bernoulli分布，它的概率分布如下所示：</p>
<p>$P(X=1)=p,\quad P(X=0)=1-p$</p>
<p>可以利用排列组合和二项式展开的性质证明：二项分布Binomial(n,p)变量的总体均值为$\mu=np$，方差为$\delta^2=np(1-p)$，标准差为$\delta=\sqrt{np(1-np)}$。</p>
<p>下图就是二项分布Binomial(5,p)的图，这里p取0.1，0.2，，，一直到0.9，可以看出，当p=0.5时，分布是对称的，当p为0.1或0.9时，分布概率偏向左边或右边，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">k &lt;- seq(<span class="number">0.1</span>,<span class="number">0.9</span>,<span class="number">0.1</span>)</div><div class="line">par(mfrow=c(<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">9</span>)</div><div class="line">  barplot(dbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,k[i]),xlab=<span class="string">"x"</span>,</div><div class="line">          ylab=<span class="string">"Probability"</span>,</div><div class="line">          ylim=c(<span class="number">0</span>,<span class="number">0.6</span>),</div><div class="line">          main=substitute(Binomial(<span class="number">5</span>,b),</div><div class="line">                          list(b=k[i])))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/6eD3LJkah5.jpg?imageslim" alt="mark"></p>
<p>案例分析</p>
<p>假定在一项外语考试中，如果每题有四个选项，只有1个是对的，一共有5道题，这些题目相互独立，如果答题者没有任何知识，全凭随机猜测，那么答对一道题的概率应该是0.25，此时答题就像是一系列bernoulli试验，每次试验成功的概率是0.25，失败的概率为1-0.25=0.75，如果用X表示答对的题目，则X可以看成是参数为n=5，p=0.25的二项分布，下表就给出了对于k=0,1,2,3,4,5，X的概率分布函数P(X=k)和累积分布函数$P(X\leq x)$，如下所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>k</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>$P(X=k)$</td>
<td>0.2373</td>
<td>0.3955</td>
<td>0.2637</td>
<td>0.08789</td>
<td>0.01465</td>
<td>0.00098</td>
</tr>
<tr>
<td>$P(X\leq x)$</td>
<td>0.2373</td>
<td>0.6328</td>
<td>0.8965</td>
<td>0.98438</td>
<td>0.99902</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>此时，$P(X=k)=C_{5}^k\times0.25^k\times0.75^{5-k},\quad k=0,1,2,3,4,5$</p>
<p>下图的左图显示的是概率分布图，下图的右图是累积分布函数图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">x &lt;- dbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>)</div><div class="line">barplot(x,xlab=<span class="string">"X"</span>,</div><div class="line">        ylab=<span class="string">"Probability Function"</span>,</div><div class="line">        ylim=c(<span class="number">0</span>,<span class="number">0.4</span>),</div><div class="line">        main=<span class="string">"Binomial(5,0.25)"</span>)</div><div class="line">plot(<span class="number">0</span>:<span class="number">5</span>,pbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>),</div><div class="line">     ylim = c(<span class="number">0</span>,<span class="number">1</span>),</div><div class="line">     type=<span class="string">"s"</span>,</div><div class="line">     xlab=<span class="string">"X"</span>,</div><div class="line">     ylab=<span class="string">"Cumulative Distribution Function"</span>,</div><div class="line">     main=<span class="string">"Binomial(5,0.25)"</span>)</div><div class="line">points(<span class="number">0</span>:<span class="number">5</span>,pbinom(<span class="number">0</span>:<span class="number">5</span>,<span class="number">5</span>,<span class="number">0.25</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/0DE2elemcj.jpeg?imageslim" alt="mark"></p>
<h2 id="多项分布"><a href="#多项分布" class="headerlink" title="多项分布"></a>多项分布</h2><p>二项分布是基于每次的实验有两个可能结果的重复独立Bernoulli试验，如果把二项分布进行拓展，例如每次实验不是有2个结果，而有k个结果，并且针对每个结果的概率分别为$(p_{1},p_{2},\cdots,p_{k})$，并且这些概率都是固定的，其实可以简单地理解为掷骰子，这样在n次实验中，得到的k个可能的结果数目为$(X_{1},X_{2},\cdots,X_{k})$的概率分布为多项分布（multinomial distribution），显然约束条件为：</p>
<p>$X_{1}+X_{2}+\cdots+X_{k}=n$</p>
<p>$p_{1}+p_{2}+\cdots+p_{k}=1$</p>
<p>多项分布可以用$M(n,p_{1},\cdots,p_{k})$表示，多项分布为多元分布，也就是说我们感兴趣的随机变量有k个$(X_{1},X_{2},\cdots,X_{k})$，这是一个k维随机向量，如果用$P(X_{1}=n_{1},X_{2}=n_{2},\cdots,X_{k}=n_{k})=p(n_{1},\cdots,n_{k})$代表多项分布k的可能结果在n次试验中分别出现$n_{1},\cdots,n_{k}$次的概率，而$p_{1},\cdots,p_{k}$分别为一次试验时各种结果出现的概率，于是多项分布可以用下面的公式来表示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/FaGcCAi3lD.png?imageslim" alt="mark"></p>
<p>其中下面就是多项式系数：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/1GACKGGb94.png?imageslim" alt="mark"></p>
<p>它就是多项式展开，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180801/5m93JHA38h.png?imageslim" alt="mark"></p>
<p>多面项分布的一个典型就是掷骰子，此时k=6，而对于一个正常的骰子来说，每掷一次，它的6个面朝上的概率是一样的，即$p_{1}=p_{2}=\cdots =p_{k}=1/6$，显然，多项分布是一个分布族，用不同的参数来区分。</p>
<h2 id="超几何分布"><a href="#超几何分布" class="headerlink" title="超几何分布"></a>超几何分布</h2><p>超几何分布是一种离散概率分布，它描述的是不放回抽样的问题。例如在一批产品里，一共有N件产品，其中有M件次品，那么当我们任何取n件产品，其中恰有X件次品的概率P就可以按归照下面的公式进行计算：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180721/6bed6CC66m.png?imageslim" alt="mark"></p>
<p>其实超几何分布就是不放回的Bernoulli试验。此处我们回忆一下二项分布，如下所示：</p>
<blockquote>
<p>二项分布：一个罐子里有m个白球，n个黑球，如果每次随机取出1个，记录下颜色后放回，重复这样的试验就形成了一系列独立的Bernoulli试验，每次摸到白球的概率是p=m/(m=n)，在取了k次后，取到白球的总次数X就服从参数k和p的二项分布。</p>
</blockquote>
<p>如果我们不放回白球，我们在取了k后后，取到白球的总次数X就服从超几何分布(hypergeometric distribution)。</p>
<p>R语言中与超几何分布有关的函数为<code>phyper</code>，<code>dhyper</code>，<code>rhyper</code>，<code>qhyper</code>。</p>
<p>其中dhyper的参数为dhyper(x, m, n, k)，这几个参数的含义如下所示：<br>x：从一个含有白球和黑球的盒子里不放回取出的白球数目。<br>m：白球的数量<br>n：黑球的数量<br>k：抽取的次数</p>
<h3 id="超几何分布的计算"><a href="#超几何分布的计算" class="headerlink" title="超几何分布的计算"></a>超几何分布的计算</h3><p>现在计算一下，有100个白球，400个黑球，不放回取50个球，有10个白球的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">10</span>,<span class="number">100</span>,<span class="number">400</span>,<span class="number">50</span>,log = <span class="literal">FALSE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1474</span></div></pre></td></tr></table></figure>
<p>现在计算一下，有100个白球，400个黑球，不放回取50个球，小于等于10个白球的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; phyper(<span class="number">10</span>, <span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.5851</span></div></pre></td></tr></table></figure>
<h3 id="超几何分布的概率密度曲线"><a href="#超几何分布的概率密度曲线" class="headerlink" title="超几何分布的概率密度曲线"></a>超几何分布的概率密度曲线</h3><p>现在绘制超几何分布的概率密度曲线，如下所示：</p>
<p>参数说明：其中N表示的是总的球的数目，即<code>N=m+n</code>，这里设定的数目是500个，k表示抽取的次数，这里分别绘制了白球为100个抽取50次，白球为200个抽取60次，白球为300个抽取70次的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">50</span>)</div><div class="line">y1&lt;-dhyper(x,<span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">y2&lt;-dhyper(x,<span class="number">200</span>, <span class="number">300</span>, <span class="number">60</span>)</div><div class="line">y3&lt;-dhyper(x,<span class="number">300</span>, <span class="number">200</span>, <span class="number">70</span>)</div><div class="line">plot(x,y1)</div><div class="line">plot(x,y1,col=<span class="string">"red"</span>,ylab=<span class="string">"density"</span>,</div><div class="line">     xlim=c(<span class="number">0</span>,<span class="number">55</span>),xlab=<span class="string">""</span>,</div><div class="line">     main=<span class="string">"Hypergeometric distribution"</span>)</div><div class="line">lines(x,y1,col=<span class="string">"red"</span>)</div><div class="line">points(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">lines(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">points(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">lines(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"topright"</span>,legend=paste(<span class="string">"N="</span>,c(<span class="number">500</span>,<span class="number">500</span>,<span class="number">500</span>),</div><div class="line">                               <span class="string">"k="</span>,c(<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>)),</div><div class="line">       lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/4EjkaG80Km.png?imageslim" alt="mark"></p>
<h3 id="超几何分布的概率积累分布曲线"><a href="#超几何分布的概率积累分布曲线" class="headerlink" title="超几何分布的概率积累分布曲线"></a>超几何分布的概率积累分布曲线</h3><p>现在绘制超几何分布的概率积累分布曲线，参数说明：其中N表示的是总的球的数目，即<code>N=m+n</code>，这里设定的数目是500个，k表示抽取的次数，这里分别绘制了白球为100个抽取50次，白球为200个抽取60次，白球为300个抽取70次的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">50</span>)</div><div class="line">y1&lt;-phyper(x,<span class="number">100</span>, <span class="number">400</span>, <span class="number">50</span>)</div><div class="line">y2&lt;-phyper(x,<span class="number">200</span>, <span class="number">300</span>, <span class="number">60</span>)</div><div class="line">y3&lt;-phyper(x,<span class="number">300</span>, <span class="number">200</span>, <span class="number">70</span>)</div><div class="line">plot(x,y1)</div><div class="line">plot(x,y1,col=<span class="string">"red"</span>,ylab=<span class="string">"density"</span>,</div><div class="line">     xlim=c(<span class="number">0</span>,<span class="number">55</span>),xlab=<span class="string">""</span>,</div><div class="line">     main=<span class="string">"Hypergeometric Cumulative distribution"</span>)</div><div class="line">lines(x,y1,col=<span class="string">"red"</span>)</div><div class="line">points(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">lines(x,y2,col=<span class="string">"blue"</span>)</div><div class="line">points(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">lines(x,y3,col=<span class="string">"orange"</span>)</div><div class="line">legend(<span class="string">"bottomright"</span>,legend=paste(<span class="string">"N="</span>,c(<span class="number">500</span>,<span class="number">500</span>,<span class="number">500</span>),</div><div class="line">                               <span class="string">"k="</span>,c(<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>)),</div><div class="line">       lwd=<span class="number">1</span>,col=c(<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"orange"</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180720/GIlFbbElB8.png?imageslim" alt="mark"></p>
<p>案例分析</p>
<p>假定在一个20个人的研究生班中，有12个女生（用m表示，即m=12），有8个男生（用n表示，即n=8），因此，女生的比例是60%，如果随机抽取10个学生进行论文主审查，那么X=8篇女生的论文被抽中的概率是多少呢？</p>
<p>按照超几何分布Hyper(12,8,10)来计算，容易得出，其概率为0.0750，如果按照二项分布Binomial(10,0.6)来计算，则得出的概率是0.1209，显然这两种计算的差异很大，但是如果有120个女生和80个男生，那么随机抽取10个学生的论文，其中有8篇是女生的论文的概率就基本上差不多了，用超几何分布过计算，此概率是0.1183，用二项分布来计算，是0.1209。</p>
<p>现在计算一下这两个概率。</p>
<p>第1个概率（女生12个，男生8个），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; m=<span class="number">12</span>;n=<span class="number">8</span>;k=<span class="number">10</span>;x=<span class="number">8</span></div><div class="line">&gt; dhyper(x,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.07501786</span></div><div class="line">&gt; dbinom(x,k,m/(m+n))</div><div class="line">[<span class="number">1</span>] <span class="number">0.1209324</span></div></pre></td></tr></table></figure>
<p>dhyper的参数前面了解了，现在看一下dbinom的参数，它的参数有3个，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbinom(x, size, prob, log = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>其中x表示目标事件的次数，我们的目标事件是”论文中是女生论文“，目标次数是8篇，此处x就等于8，k表示抽样的次数，这里是取了10个同学，prob表示目标事件的概率，我们的目标事件是”论文中是女生论文“，因此这个prob此处为0.6，也就是m/(m+n)。</p>
<p>现在扩大一下样本，女生120个，男生80个，抽10份论文，女生论文是8篇的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; m=<span class="number">120</span>;n=<span class="number">80</span>;k=<span class="number">10</span>;x=<span class="number">8</span></div><div class="line">&gt; dhyper(x,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1182677</span></div><div class="line">&gt; dbinom(x,k,m/(m+n))</div><div class="line">[<span class="number">1</span>] <span class="number">0.1209324</span></div></pre></td></tr></table></figure>
<p>在这个案例中，我们研究的是具体的某个事件的概率，也就是抽到女生论文是8篇的概率，如果我们要研究至少投到8篇是女生论文的概率，那么就需要求出8，9，10篇是女生论文的概率之和（女生人数为120人，男生80个），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">8</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)+dhyper(<span class="number">9</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)+dhyper(<span class="number">10</span>,<span class="number">120</span>,<span class="number">80</span>,<span class="number">10</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>这里使用到了一个phyper函数，它的用法如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">phyper(q, m, n, k, lower.tail = TRUE, log.p = FALSE)</div></pre></td></tr></table></figure>
<p>q就是目标事件的次数，这里是8，因此使用这个函数计算出来的结果其实就是，抽取10篇，其中小于等于8篇是女生论文的概率，因此这个概率并不是我们想要的，我们想要的概率是至少8篇是女生论文的概率，也就是8，9，10篇。因此，此处我们计算出小于等于7篇是女生论文的概率，再用1减去就是我们要想的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="number">1</span>-phyper(<span class="number">7</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>现在用dhyper函数来验证下，分别计算出8，9，10篇是女生论文的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; dhyper(<span class="number">8</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1182677</span></div><div class="line">&gt; dhyper(<span class="number">9</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.03726013</span></div><div class="line">&gt; dhyper(<span class="number">10</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.005169843</span></div><div class="line">&gt; dhyper(<span class="number">8</span>,m,n,k)+dhyper(<span class="number">9</span>,m,n,k)+dhyper(<span class="number">10</span>,m,n,k)</div><div class="line">[<span class="number">1</span>] <span class="number">0.1606976</span></div></pre></td></tr></table></figure>
<p>结果是一样的。</p>
<h2 id="二项分布与超几何分布的联系与区别"><a href="#二项分布与超几何分布的联系与区别" class="headerlink" title="二项分布与超几何分布的联系与区别"></a>二项分布与超几何分布的联系与区别</h2><p>在抽样调查的实践中，一般不会重复调查同一个人，这相当于不放回抽样。严格来说应该用超几何分布来描述，但对于很大的总体，通常都考虑二项分布模型。这是因为，在一个很大的一群人中进行随机调查，就相当于从有大量黑白球的罐子中摸球，无论是放回抽样，还是不放回抽样，抽样时待抽取的黑白球所点的比例不会有显著的区别，由于二项分布计算简单，所以都用二项分布来近似。但是如果仅仅在一个人数不多的单位中进行调查，就相当于上面的不放回摸球，而且由于球的总数不多，每次抽样后，待抽取的黑白球所占的比例变化会很大，因此就应该考虑用超几何分布。</p>
<h2 id="Poisson分布"><a href="#Poisson分布" class="headerlink" title="Poisson分布"></a>Poisson分布</h2><p>在二战中，德国的导弹不断袭击英国，为了研究导弹袭击的规律，英国的统计学家R.D. Clarke把一个地区划分为许多小块，使得每个小块被击中的概率极小，在袭击是随机的假定下，各个小块被击中的概率在整个区域假定是一个常数，这样，一个小块被南路的次数就大致相当于在大量重复的成功概率很小的独立Bernoulli试验中成功的次数，他于是就导出了Poisson分布，而实际观测的导弹袭击的频数和用Poisson分布预测的频率相当吻合，在许多事件中，例如某种疾病的发生数目，一个自动生产线出现的废品数，某种事故发生的数目等，只要出现一次的概率很小，一般被看成近似地服从Poisson分布，Poisson分布的总体参数是其均值，而且其总体均值和总体方差相等，这里用λ表示该总体均值，Poission分布常用P(λ)或Poisson(λ)表示，此分布P(λ)的概率分布为：对于$x=0,1,\cdots$，以及$\lambda&gt;0$，有：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180814/29871IeHg8.png?imageslim" alt="mark"></p>
<p>下图就是参数为3、6、10的Poission分布图（只标出了20之内的部分），Poisson分布是一个分布族，其成员用不同的λ来区分，若干个独立的Poisson分布变量的和也服从Poisson分布，其参数等于那些Poisson分布的参数之和。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">x&lt;-<span class="number">0</span>:<span class="number">20</span></div><div class="line">z&lt;-cbind(dpois(x,<span class="number">3</span>),dpois(x,<span class="number">6</span>),dpois(x,<span class="number">10</span>))</div><div class="line">matplot(x,z,</div><div class="line">        pch=c(<span class="number">19</span>,<span class="number">8</span>,<span class="number">17</span>),</div><div class="line">        cex=<span class="number">1.5</span>,</div><div class="line">        xlab=<span class="string">"x"</span>,ylab=<span class="string">"P(X=x)"</span>,</div><div class="line">        col=<span class="number">1</span>,</div><div class="line">        main=<span class="string">"Poisson Distribution"</span>,</div><div class="line">        type=<span class="string">"b"</span>)</div><div class="line">legend(<span class="number">15</span>,<span class="number">0.23</span>,</div><div class="line">       c(<span class="string">"P(3)"</span>,<span class="string">"P(6)"</span>,<span class="string">"P(10)"</span>),</div><div class="line">       cex=<span class="number">1.5</span>,</div><div class="line">       pch=c(<span class="number">19</span>,<span class="number">8</span>,<span class="number">17</span>),</div><div class="line">       col=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180814/jf1B9225eB.jpeg?imageslim" alt="mark"></p>
<p>正如前面的导弹袭击案例所说，当Bernoulli试验的次数很大，而每次成功概率很小时，可以用Poisson分布来近似二项分布，数学上，如果二项分布Binomial(n,p)的p趋于0，而np趋于常数λ时，该二项分布则趋于Poisson分布P(λ)，由于当n很大，以及p很小时，二项分布计算很麻烦，因此在计算机出现之前，人们在计算概率时，往往用P(np)来对二项分布Binomial(n,p)做近似。</p>
<p>看一个案例，现在使用不同的n（例如取值10，100，1000，10000，100000，这里的n就是试验次数）和p（例如取值0.1，0.01，0.001，0.0001，0.00001，这里的p就是某事件发生的概率）分别利用二项分布和Poisson分布近似来计算X=2的概率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; n&lt;-c(<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>,<span class="number">10000</span>,<span class="number">100000</span>)</div><div class="line">&gt; p&lt;-c(<span class="number">0.1</span>,<span class="number">0.01</span>,<span class="number">0.001</span>,<span class="number">0.0001</span>,<span class="number">0.00001</span>)</div><div class="line">&gt; cbind(dbinom(<span class="number">2</span>,n,p),dpois(<span class="number">2</span>,n*p))</div><div class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]</div><div class="line">[<span class="number">1</span>,] <span class="number">0.1937102</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">2</span>,] <span class="number">0.1848648</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">3</span>,] <span class="number">0.1840317</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">4</span>,] <span class="number">0.1839489</span> <span class="number">0.1839397</span></div><div class="line">[<span class="number">5</span>,] <span class="number">0.1839406</span> <span class="number">0.1839397</span></div></pre></td></tr></table></figure>
<p>从上面的这个结果我们可以看到，随着试验次数的增加，以及p值的降低，那么二项分布与Poisson的结果就非常接近了。</p>
<h2 id="正态分布"><a href="#正态分布" class="headerlink" title="正态分布"></a>正态分布</h2><p>正态分布内容参见这篇笔记《正态分布笔记》</p>
<h2 id="伽玛分布（-Gamma-分布）"><a href="#伽玛分布（-Gamma-分布）" class="headerlink" title="伽玛分布（$\Gamma$分布）"></a>伽玛分布（$\Gamma$分布）</h2><p>这里介绍伽玛分布是因为它与卡方分布和指数分布有关，卡方分布与指数分布可以视为一种特殊的伽玛分布。</p>
<p>许多随机变量，例如计算机使用寿命的长度，假定仅取非负值，这种类型数据的相对频率分布通过用$\Gamma$型密度函数建模，$\Gamma$密度函数公式如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/all92Geej8.png?imageslim" alt="mark"></p>
<p>其中，</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/3KKfkDm5jG.png?imageslim" alt="mark"></p>
<p>$\Gamma$型随机变量的均值和方差分别如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/1lblKmkJG6.png?imageslim" alt="mark"></p>
<p>当α是正整数时，可以证明（略）Γ(α)=(α-1)Γ(α-1)以及Γ(α)=(α-1)！</p>
<p>Γ密度函数公式中包含两个参数α和β，参数β称作尺度参数，反映了Y度量单位的大小（它和出现在正态密度函数公式中的参数σ有相同的功能），参数α称作形状参数，改变它的值会改变Γ分布的形状，这就使得我们在建立试验数据的相对频率分布模型时，能得到许多不同形状的密度函数，下图就给出了α=1,3和5，β=1时的Γ密度函数图形：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">10</span>,length.out=<span class="number">100</span>)</div><div class="line">y1&lt;-data.frame(x,y=dgamma(x,<span class="number">1</span>,<span class="number">1</span>),g=<span class="string">"alpha=1,beta=1"</span>)</div><div class="line">y3&lt;-data.frame(x,y=dgamma(x,<span class="number">3</span>,<span class="number">1</span>),g=<span class="string">"alpha=3,beta=1"</span>)</div><div class="line">y5&lt;-data.frame(x,y=dgamma(x,<span class="number">5</span>,<span class="number">1</span>),g=<span class="string">"alpha=5,beta=1"</span>)</div><div class="line"></div><div class="line">y&lt;-sqldf(<span class="string">"</span></div><div class="line"><span class="string">         select x,y,g from y1</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y3</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y5"</span>)</div><div class="line"></div><div class="line">ggplot(y,aes(x=x,y=y,group=factor(g),colour=factor(g)))+geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/fgFDD1kB7C.png?imageslim" alt="mark"></p>
<p>以下是累积分布函数密度图，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1</span>)</div><div class="line">x&lt;-seq(<span class="number">0</span>,<span class="number">10</span>,length.out=<span class="number">100</span>)</div><div class="line">y1&lt;-data.frame(x,y=pgamma(x,<span class="number">1</span>,<span class="number">1</span>),g=<span class="string">"alpha=1,beta=1"</span>)</div><div class="line">y3&lt;-data.frame(x,y=pgamma(x,<span class="number">3</span>,<span class="number">1</span>),g=<span class="string">"alpha=3,beta=1"</span>)</div><div class="line">y5&lt;-data.frame(x,y=pgamma(x,<span class="number">5</span>,<span class="number">1</span>),g=<span class="string">"alpha=5,beta=1"</span>)</div><div class="line"></div><div class="line">y&lt;-sqldf(<span class="string">"</span></div><div class="line"><span class="string">         select x,y,g from y1</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y3</span></div><div class="line"><span class="string">         union all</span></div><div class="line"><span class="string">         select x,y,g from y5"</span>)</div><div class="line"></div><div class="line">ggplot(y,aes(x=x,y=y,group=factor(g),colour=factor(g)))+geom_line()</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/bBilEI9hh2.png?imageslim" alt="mark"></p>
<p>除了α作为整数的特殊情况外，我们不能得到Γ密度函数积分的显式表示，因此Γ随机变量的累积分布函数称作不完全Γ函数，必须在计算机帮助下用近似方法得到，在统计学中，重要的Γ型随机变量是卡方随机变量。</p>
<p>卡方随机变量是α=ν/2和β=2的Γ型随机变量，如下所示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/ac51g6IjEK.png?imageslim" alt="mark"></p>
<p>其中，</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180817/A89BLKGgFK.png?imageslim" alt="mark"></p>
<p>卡方随机变量的均值和方差分别为：$\mu=\nu \quad \delta^2=2\nu$，参数$\nu$称为卡方分布的自由度个数</p>
<h2 id="卡方分布"><a href="#卡方分布" class="headerlink" title="卡方分布"></a>卡方分布</h2><p>正态分布内容参见这篇笔记<a href="http://rvdsd.top/2017/06/06/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-08%E5%8D%A1%E6%96%B9%E5%88%86%E6%9E%90%E4%B8%8E%E5%8D%A1%E6%96%B9%E5%88%86%E5%B8%83/">《卡方检验》</a>。</p>
<h2 id="t分布"><a href="#t分布" class="headerlink" title="t分布"></a>t分布</h2><p>正态分布内容参见这篇笔记<a href="http://rvdsd.top/2017/06/03/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-03-T%E5%88%86%E5%B8%83%E4%B8%8E%E6%A3%80%E9%AA%8C/">《T分布与t检验》</a>。</p>
<h2 id="F分布"><a href="#F分布" class="headerlink" title="F分布"></a>F分布</h2><p>F-分布（F-distribution）是一种连续概率分布，被广泛应用于似然比率检验，特别是ANOVA中。F分布定义为：设X、Y为两个独立的随机变量，X服从自由度为k1的卡方分布，Y服从自由度为k2的卡方分布，这2个独立的卡方分布被各自的自由度除以后的比率这一统计量的分布。用公式表示就是下面的样子：</p>
<p>如果X是$\chi^2(m)$变量，Y是$\chi^2(n)$变量，而且X和Y独立，那么就有下面的这个公式，即<br>$F=\frac{X/m}{Y/n}$<br>这个公式可以称为具有自由度(m,n)的F分布，记为F(m,n)，也就是说，两个独立$\chi^2$分布变量（在除以它们各自的自由度后）的比为F分布变量。</p>
<p>F分布的概率密度函数为：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/A3HEemFA48.png?imageslim" alt="mark"></p>
<p>在F分布中，两个$\chi^2$分布的自由度则为F分布的自由度，因此，F分布有两个自由度，第一个自由度等于在分子上的$\chi^2$分布的自由度，第二个自由度等于在分母的$\chi^2$分布的自由度，下图显著了自由度分别为(3,20)，(10,20)和(50,20)的三条F分布密度曲线：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">x &lt;-c(seq(<span class="number">0</span>,<span class="number">4.5</span>,length=<span class="number">1000</span>))</div><div class="line">y2 &lt;- df(x,<span class="number">50</span>,<span class="number">20</span>)</div><div class="line">y3 &lt;- df(x,<span class="number">10</span>,<span class="number">20</span>)</div><div class="line">y5 &lt;- df(x,<span class="number">3</span>,<span class="number">20</span>)</div><div class="line">plot(x,y2,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">1</span>,main=<span class="string">""</span>)</div><div class="line">lines(x,y3,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">2</span>)</div><div class="line">lines(x,y5,type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,ylab=<span class="string">""</span>,lty=<span class="number">3</span>)</div><div class="line">legend(<span class="number">3</span>,<span class="number">1.1</span>,c(<span class="string">"F(50,20)"</span>,<span class="string">"F(10,20)"</span>,<span class="string">"F(3,20)"</span>),lty=<span class="number">1</span>:<span class="number">3</span>)</div><div class="line">text(<span class="number">0</span>,<span class="number">0.6</span>,<span class="string">"F(3,20)"</span>)</div><div class="line">text(<span class="number">0.8</span>,<span class="number">0.85</span>,<span class="string">"F(10,20)"</span>)</div><div class="line">text(<span class="number">1</span>,<span class="number">1.0</span>,<span class="string">"F(50,20)"</span>)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/03aejGc5ib.png?imageslim" alt="mark"></p>
<p>从图上可以看出，当第二个自由度相时，第一个自由度越小，峰越靠近左边。</p>
<h2 id="均匀分布"><a href="#均匀分布" class="headerlink" title="均匀分布"></a>均匀分布</h2><p>均匀分布(uniform distribution)是最简单的连续型分布，它的聚会范围是一个区间，例如(a,b)，均匀颁同随机变量X聚会在该区间的一个子区间的概率等于该子区间宽度与区间(a,b)宽度b-1的比值，如果区间(a,b)为(0,1)区间，那么X落入(0.3,0.7)的概率为(0.7-0.3)/(1-0)=0.4，显然，均匀分布的密度函数在(a,b)区间为常数1/(b-a)，而在该区间外为零，用公式就是以下表示：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/7EDA4K7gHg.png?imageslim" alt="mark"></p>
<p>这种形状为一个矩形，因此均匀分布也称为矩形分布(rectangular distribution)，定义在(a,b)区间上的均匀分布通常用U(a,b)或Unif(a,b)表示，下图是均匀分布U(0,1)的密度函数（左）和一个来自U(a,b)的样本的直方图（右），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># uniform distribution</span></div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">plot(-<span class="number">10</span>,<span class="number">10</span>,xlab=<span class="string">"X"</span>,ylab=<span class="string">""</span>,xlim=c(-<span class="number">0.3</span>,<span class="number">1.3</span>),ylim=c(<span class="number">0</span>,<span class="number">1.2</span>),main=<span class="string">"U(0,1)"</span>)</div><div class="line">segments(-<span class="number">0.3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</div><div class="line">segments(<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">segments(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1.3</span>,<span class="number">0</span>)</div><div class="line">segments(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,lty=<span class="number">2</span>)</div><div class="line">segments(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,lty=<span class="number">2</span>)</div><div class="line">x&lt;-runif(<span class="number">10000</span>)</div><div class="line">hist(x)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/BhKJ1cHm2K.png?imageslim" alt="mark"></p>
<h2 id="样本函数的分布"><a href="#样本函数的分布" class="headerlink" title="样本函数的分布"></a>样本函数的分布</h2><p>我们希望利用样本，尤其是通过作为样本函数的样本统计量来了解总体，并对总体参数进行推断。这些统计量包括閒贩蛭过的样本均值、样本中位数、样本标准差以及由它们组成的函数。统计量对不同的样本（但有相同的样本量）会取不同的值，作为随机样本的函数，它们也是随机的，也有自己的分布，这些分布就称为抽样分布(sampling distribution)， 我们来看一个案例。<br>我们有一个正常的色子，看一下每次投掷10次的试验（样本量为10），看一下这个均值的变化，下表记录了15次试验每次得到的结果和该次的样本均值，而和该表相应的左边为15条10个点的拆线，显示了15次共150个点数，右边为掷色子点数的15个均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a &lt;- <span class="literal">NULL</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">15</span>)&#123;</div><div class="line">  x &lt;- sample(<span class="number">1</span>:<span class="number">6</span>,<span class="number">10</span>,rep=<span class="literal">T</span>)</div><div class="line">  a &lt;- rbind(a,c(x,mean(x)))&#125;</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">matplot(<span class="number">1</span>:<span class="number">10</span>,t(a[,-<span class="number">11</span>]),type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,main=<span class="string">"每次掷10次色子，重复15遍"</span>,ylab=<span class="string">"点数"</span>)</div><div class="line">plot(<span class="number">1</span>:<span class="number">15</span>,a[,<span class="number">11</span>],type=<span class="string">"l"</span>,xlab=<span class="string">""</span>,main=<span class="string">"15个均值（每个来自10次掷色子结果)"</span>,ylab=<span class="string">"点数"</span>,ylim=c(<span class="number">1</span>,<span class="number">6</span>))</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/8H16g5CI5h.png?imageslim" alt="mark"></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/hJj3ikIchc.png?imageslim" alt="mark"></p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/Ej30i8DLEk.png?imageslim" alt="mark"></p>
<p>这些样本均值都和真正的总体均值(1+2+3+4+5+6)/6=3.5不完全一样，它们比较稳定，而不像那些原先的150个样本点，显然，这些均值有其自己的分布，与掷色子原先的多项分布不同，这使得人们对这些样本均值的分布感兴趣，前面介绍的$\chi^2$分布，t分布和F分布都可以是正态分布总体有关的抽样分布。</p>
<h2 id="样本均值的性质和中心极限定理"><a href="#样本均值的性质和中心极限定理" class="headerlink" title="样本均值的性质和中心极限定理"></a>样本均值的性质和中心极限定理</h2><p>我们把前面的掷色子试验的样本量从10增加到5000，而抽取1000个样本（原来是15个），结果得到1000个均值，这些均值的直方图如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a&lt;-<span class="literal">NULL</span></div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>)&#123;</div><div class="line">x&lt;-sample(<span class="number">1</span>:<span class="number">6</span>,<span class="number">5000</span>,rep=<span class="literal">T</span>)</div><div class="line">a&lt;-rbind(a,mean(x))&#125;</div><div class="line">hist(a,xlab=<span class="string">""</span>,<span class="number">15</span>,freq=<span class="literal">F</span>)</div><div class="line">lines(density(a))</div><div class="line">rug(a)</div><div class="line">mean(a)</div></pre></td></tr></table></figure>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/D8diDDjmLH.png?imageslim" alt="mark"></p>
<p>上图解释：做1000次试验，每次掷5000次色子，这样就得到了1000个均值的直方图，图中的曲线是对这1000个均值的密度估计，下面小的短线标出了这1000个均值的实际位置。</p>
<p>这看上去很像正态分布的形状，这些均值的均值为3.500001，接近掷色子的总体均值3.5。这就意味着，当样本量增加时，多项分布（掷色子）的总体均值或许可能用正态分布来近似。其实，在一定条件下，在样本量趋于无穷时，一般分布的样本均值的分布趋于正态分布，这就是关于样本均值的中心极限定量。</p>
<h2 id="中心极限定理"><a href="#中心极限定理" class="headerlink" title="中心极限定理"></a>中心极限定理</h2><p>假定随机变量X的n个独立观测值组成一个样本，假定X的总体均值为μ，而总体标准差为σ，这两个总体参数通常是未知的，从这个样本，我们还可以计算样本均值$\bar{x}$和样本标准差x，当然样本均值可以用来估计μ的值，具体这种估计的好坏，依赖于样本均值有什么样的抽样分布。样本均值作为随机变量有如下性质（注：这里没有假定X的分布）：</p>
<ol>
<li>样本均值$\bar{x}$的抽样分布的总体均值等于μ；</li>
<li>样本均值$\bar{x}$的抽样分布的总体标准差等于$\delta/\sqrt{n}$，样本量越大，$\bar{x}$的集中程度越大；</li>
<li>即使X的分布不是正态，那么在很一般的条件下（中心极限定理成立的一个充分条件是：样本点是独立的，来自一个总体（同一个分布），总体均值存在，并且有非零有限总体方差。），当样本量增加时，$\bar{x}$的分布走近于正态分布$N(\mu,\delta/\sqrt{n})$，这就是中心极限定理（CLT,central limit theorem)。</li>
</ol>
<p>把上面第二条中的样本均值$\bar{x}$的抽样分布的总体标准差公式中的σ换成样本标准差s，得到$s/\sqrt{n}$就是均值的标准误差(standard error of mean,SEM)，它是对$\delta/\sqrt{n}$的一个近似。现在我们从U(0,1)，$\chi^2(2)$和F(0,10)这三种分布对于三种样本量大小n=1，3，100分别取600个样本，再计算出每个样本的均值，这样对每一种样本量都有600个均值，用这些均值画直方图，如下所示，可以看出，样本量越大，均值的直方图就越像正态分布，并且数据的分散程度也越小（越集中）。</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180815/IgfLgBai7C.png?imageslim" alt="mark"></p>
<p>下面代码是《R语言与统计分析》（汤银才）书中的代码来模拟中心极限定理，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">limite.central &lt;- <span class="keyword">function</span>(r=runif,distpar=c(<span class="number">0</span>,<span class="number">1</span>),m=<span class="number">0.5</span>,</div><div class="line">                           s=<span class="number">1</span>/sqrt(<span class="number">12</span>),</div><div class="line">                           n=c(<span class="number">1</span>,<span class="number">3</span>,<span class="number">100</span>),N=<span class="number">600</span>)</div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> n)&#123;</div><div class="line">    <span class="keyword">if</span> (length(distpar)==<span class="number">2</span>)&#123;</div><div class="line">      x&lt;-matrix(r(i*N,distpar[<span class="number">1</span>],distpar[<span class="number">2</span>]),nc=i)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">      x&lt;-matrix(r(i*N,distpar),nc=i)</div><div class="line">    &#125;</div><div class="line">    x&lt;-(apply(x,<span class="number">1</span>,sum)-i*m)/(sqrt(i)*s)</div><div class="line">    hist(x,col=<span class="string">'Light blue'</span>,probability=<span class="literal">T</span>,main=paste(<span class="string">"n="</span>,i),</div><div class="line">         ylim=c(<span class="number">0</span>,max(<span class="number">0.4</span>,density(x)$y)))</div><div class="line">    lines(density(x),col=<span class="string">'red'</span>,lwd=<span class="number">3</span>)</div><div class="line">    curve(dnorm(x),col=<span class="string">'blue'</span>,lwd=<span class="number">3</span>,lty=<span class="number">3</span>,add=<span class="literal">T</span>)</div><div class="line">    <span class="keyword">if</span>(N&gt;<span class="number">100</span>)&#123;</div><div class="line">      rug(sample(x,<span class="number">100</span>))</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">      rug(x)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(runif,distpar = c(<span class="number">0</span>,<span class="number">1</span>))</div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(rchisq,distpar = c(<span class="number">2</span>))</div><div class="line"></div><div class="line">op &lt;- par(mfrow=c(<span class="number">1</span>,<span class="number">3</span>))</div><div class="line">limite.central(rf,distpar = c(<span class="number">2</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure>
<p>均匀分布：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180818/8D3lfeil3C.png?imageslim" alt="mark"></p>
<p>卡方分布：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180818/3mFegj4dF6.png?imageslim" alt="mark"></p>
<p>F分布：</p>
<p><img src="http://ortxpw68f.bkt.clouddn.com/professional/180818/CKGibJ6LFB.png?imageslim" alt="mark"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="http://blog.sina.com.cn/s/blog_670445240101m4z3.html" target="_blank" rel="external">每日一生信—富集分析（超几何分布）（Fisher’s Exact Test）</a> </li>
<li><a href="http://blog.sina.com.cn/s/blog_5d1edf6a0100ujcv.html" target="_blank" rel="external">R 超几何分布</a> </li>
<li><a href="https://en.wikipedia.org/wiki/Hypergeometric_distribution" target="_blank" rel="external">Wikipedia:Hypergeometric distribution</a></li>
<li>DawnGriffiths. 深入浅出统计学[M]. 电子工业出版社, 2012.</li>
<li>高桥信陈刚. 漫画统计学[M]. 科学出版社, 2009.</li>
<li>拉里·戈尼克, 沃尔科特·史密斯. 漫画统计学入门[M]. 辽宁教育出版社, 2002.</li>
<li>陈希孺.概率论与数理统计[M].中国科学技术大学出版社,1992.</li>
<li><a href="http://blog.fens.me/r-density/" target="_blank" rel="external">常用连续型分布介绍及R语言实现</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">116</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共449.0k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  










  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.1.4/dist/Valine.min.js"></script>
  <script type="text/javascript">
    new Valine({
        av: AV,
        el: '#vcomments' ,
        verify: true,
        notify: true,
        app_id: '4ORLDMxXCFDLSHPJ4wSSDkkw-gzGzoHsz',
        app_key: 'HSWpCY7XlN0pGV5DCrKoC0ic',
        placeholder: 'Comment input placeholder'
    });
  </script>



  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
