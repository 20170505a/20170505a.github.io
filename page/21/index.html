<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="RVDSD的个人笔记本">
<meta property="og:url" content="http://rvdsd.top/page/21/index.html">
<meta property="og:site_name" content="RVDSD的个人笔记本">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RVDSD的个人笔记本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rvdsd.top/page/21/"/>





  <title>RVDSD的个人笔记本</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RVDSD的个人笔记本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/10/R/R语言笔记之循环语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/R/R语言笔记之循环语句/" itemprop="url">R语言笔记之循环语句</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T12:00:00+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,133
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="if语句">if语句</h2>
<p>用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件) 表达式</div><div class="line"><span class="keyword">if</span>(条件) 表达式<span class="number">1</span> <span class="keyword">else</span> 表达式<span class="number">2</span></div></pre></td></tr></table></figure>
<p>其中<code>if</code>语句具体就是包含下面3个元素：</p>
<ol style="list-style-type: decimal">
<li>关键字<code>if</code>；</li>
<li>条件语句的判断结果，也就是一个逻辑值，是TRUE或FALSE；</li>
<li>执行语句，也就是上面提到的<code>表达式</code>。</li>
</ol>
<h3 id="if语句案例1-简单案例"><code>if</code>语句案例1-简单案例</h3>
<p>先看一个简单的案例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line"><span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line"><span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; p &lt;- <span class="number">0.03</span> ;&#123;</div><div class="line">+     <span class="keyword">if</span> (p &lt;= <span class="number">0.05</span>)</div><div class="line">+         print(<span class="string">"p&lt;=0.05!"</span>)</div><div class="line">+     <span class="keyword">else</span> print(<span class="string">"p &gt; 0.05!"</span>)</div><div class="line">+ &#125;</div><div class="line">[<span class="number">1</span>] <span class="string">"p&lt;=0.05!"</span></div></pre></td></tr></table></figure>
<h3 id="if语句案例2-函数体中添加if语句"><code>if</code>语句案例2-函数体中添加if语句</h3>
<p>现在编写一个函数,命名为<code>priceCalulator()</code>，这个函数的功能在于按照服务时长计算应该收取的费用，函数接收2个参数，分别是服务时长（hours）与每小时的单价(pph)，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在如果我们还要添加一个功能，例如有一批大客户，如果他们的服务需求时间长高于100小时，就打9折，也就是说，如果hours大于100，最后的总价乘以0.9，代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>)&#123;</div><div class="line">    net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  &#125;</div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours = <span class="number">55</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2200</span></div><div class="line">&gt; priceCalculator(hours = <span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">3960</span></div></pre></td></tr></table></figure>
<h3 id="if语句的省略形式"><code>if</code>语句的省略形式</h3>
<p>如果if语句的条件只有一行的话，那么就可以省略两旁的大括号，例如前面的服务计费案例可以改为如下形式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div></pre></td></tr></table></figure>
<p>完整的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  round(net.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ifelse语句"><code>ifelse</code>语句</h2>
<p><code>if...else</code>是<code>if</code>条件语句的扩展，它的用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(条件语句<span class="number">1</span>)&#123;</div><div class="line">    表达式<span class="number">1</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;表达式<span class="number">2</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<p>其中，当<code>条件语句1</code>为<code>TRUE</code>时，执行<code>表达式1</code>，当<code>条件语句1</code>为<code>FALSE</code>时，执行<code>表达式2</code>。</p>
<p>还以前面的<code>if</code>语句中的服务费用案例继续说明一下，在一些国家，针对不同类型的客户（公共组织或私有组织），除了就会的服务费外，还会收取不同的税(VAT)，假设公共组织需要支付6%的VAT，而私有组织需要支付12%的VAT，此时可以在<code>priceCalculator()</code>函数中添加一个新的参数<code>public</code>，用于判断组织是否是公共组织，现在代码更改如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例如同样工作25时，对于公共和私有组织客户的收费是不一样的，计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">TRUE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, public = <span class="literal">FALSE</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程就使用到了<code>if...else...</code>语句，如果参数<code>public</code>的值为<code>TRUE</code>，那么税后价是总价乘以1.06，否则要乘以1.12。</p>
<p>对于<code>if...else...</code>语句的表达式而言，如果只有一行代码，可以省略大括号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(public) tot.price &lt;- net.price * <span class="number">1.06</span> <span class="keyword">else</span></div><div class="line">  tot.price &lt;- net.price * <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>其中<code>else</code>要放到行末，不能放到下一行的行首，这是因为只要一个命令明显没有结束，R会自动读取多行代码，将它们合成一行，如果<code>else</code>没有放在行末，那么R会认为第一行代码已经结束，从而在执行下一行代码时报错，只有当条件表达式出现在函数中，并且一次性地Source整个脚本文件时，else才能出现在行首。</p>
<p><code>if...else...</code>还能继续简化，我们可以把<code>if</code>理解为一个函数，它的计算结果是<code>TRUE</code>或<code>FALSE</code>，因此可以把if表达式赋予一个对象，或者直接用到计算中，这里可以省略重新计算<code>net.price</code>的过程，直接将结果赋给tot.price`，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot.price &lt;- net.price * <span class="keyword">if</span>(public) <span class="number">1.06</span> <span class="keyword">else</span> <span class="number">1.12</span></div></pre></td></tr></table></figure>
<p>如果这么写，R会先执行<code>if...else</code>表达式，得到结果后，再乘以<code>net.price</code>，然后将结果赋给<code>tot.price</code>。</p>
<h2 id="判断选择的向量化">判断选择的向量化</h2>
<p>还以上面的<code>priceCalculator()</code>函数为例说明一下，这个函数的参数是一个数，而非一个向量，如果要计算一个向量就会出现警告信息，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public = <span class="literal">TRUE</span>)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  <span class="keyword">if</span>(hours &gt; <span class="number">100</span>) net.price &lt;- net.price*<span class="number">0.9</span></div><div class="line">  <span class="keyword">if</span>(public)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(c(<span class="number">25</span>, <span class="number">110</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span></div><div class="line">Warning message:</div><div class="line">In <span class="keyword">if</span> (hours &gt; <span class="number">100</span>) net.price &lt;- net.price * <span class="number">0.9</span> :</div><div class="line">  the condition has length &gt; <span class="number">1</span> and only the first element will be used</div></pre></td></tr></table></figure>
<p>从警告信息可以看出，R会告诉我们丢失了一些信息，并且反映出了整个计算结果就是错误的，因此第二个客户的最终结果应该是4198，而非4664，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">110</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4198</span></div></pre></td></tr></table></figure>
<p>这是因为警告信息中提示，<code>if</code>表达式只能处理单个值，而<code>hours &gt; 100</code>返回的是两个值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; c (<span class="number">25</span>, <span class="number">110</span>) &gt; <span class="number">100</span></div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<h2 id="ifelse函数"><code>ifelse()</code>函数</h2>
<p>如果使用<code>ifelse()</code>函数就能解决上面提到的问题，<code>ifelse()</code>函数接收3个参数：</p>
<ol style="list-style-type: decimal">
<li>包含逻辑值的条件向量；</li>
<li>包含返回值的向量，它仅在对应条件向量值为TRUE时才被返回；</li>
<li>另外一个包含返回值的向量，它仅在对应条件向量为FALSE时才被返回。</li>
</ol>
<h3 id="ifelse案例1-简单案例"><code>ifelse</code>案例1-简单案例</h3>
<p>先看一个简单的<code>ifelse</code>案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(c(<span class="number">1</span>,<span class="number">3</span>) &lt; <span class="number">2.5</span>, <span class="number">1</span>:<span class="number">2</span>, <span class="number">3</span>:<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>这行语句的运行过程为：</p>
<ol style="list-style-type: decimal">
<li>条件表达式<code>c(1,3) &lt; 2.5</code>被解析成一个逻辑向量，计算结果为<code>[1]  TRUE FALSE</code>；</li>
<li>这个逻辑向量的第一个值为<code>TRUE</code>，因此1确实小于2.5，所以结果向量的第1个元素为第2个参数的第1个元素，也就是1；</li>
<li>条件向量的第2个值为<code>FALSE</code>，因为3比2.5大，所以<code>ifelse()</code>函数将取第3个参数的第2个值（也就是4）作为结果向量的第2个元素。</li>
<li>把选出的值合成一个向量作为结果返回。</li>
</ol>
<p>再来看一个简单的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">ifelse(x != <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) </div><div class="line"><span class="comment"># 若果x的值不等于1，输出1，否则输出0</span></div><div class="line"><span class="comment"># [1] 0 0 0 1 1 0 0</span></div></pre></td></tr></table></figure>
<p>现在我们更改<code>priceCalculator()</code>函数，假设有2个客户，服务时长分别为25小时和110小时，那么就可以采用下面的代码完成计算：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; my.hours &lt;- c(<span class="number">25</span>, <span class="number">110</span>)</div><div class="line">&gt; my.hours*<span class="number">40</span>*ifelse(my.hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">3960</span></div></pre></td></tr></table></figure>
<p>在上面的代码中，<code>ifelse()</code>函数会计算<code>my.hours &gt; 100</code>的结果，分别是<code>FALSE</code>和<code>TRUE</code>，其中，25对应的是<code>FALSE</code>，那么结果就是<code>my.hour*40*1</code>，110对应的是<code>TRUE</code>，结果就是<code>my.hour*40*0.9</code>。</p>
<p>现在继续改造<code>priceCalculator()</code>函数，例之成为真正能处理向量的函数，此时需要改造<code>public</code>参数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, public)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  net.price &lt;- net.price * ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price * ifelse(public, <span class="number">1.06</span>, <span class="number">1.12</span>)</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  public = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>, <span class="literal">FALSE</span>, <span class="literal">FALSE</span>)</div><div class="line">)</div><div class="line"></div><div class="line">with(clients, priceCalculator(hours, public = public))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; with(clients, priceCalculator(hours, public = public))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4198</span> <span class="number">5040</span> <span class="number">1792</span></div></pre></td></tr></table></figure>
<h3 id="ifelse案例2-在函数中添加ifelse">ifelse案例2-在函数中添加<code>ifelse</code></h3>
<p>看一个案例，有两个向量，分别为x和y，它们是时间序列，例如它们是每小时收集的气温和气压测量值，我们定义两者的相关性为x和y同时上升或下降次数占总观测数的比例（其实就是Kendall’s tau方法），也就是计算<code>y[i+1]-y[i]1</code>与<code>x[i+1]-x[i]</code>符号相同时的次数占总数<code>i</code>的比例，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findud &lt;- <span class="keyword">function</span>(v)&#123;</div><div class="line">  vud &lt;- v[-<span class="number">1</span>]-v[-length(v)]</div><div class="line">  <span class="keyword">return</span>(ifelse(vud &gt; <span class="number">0</span>, <span class="number">1</span>,-<span class="number">1</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  ud &lt;- lapply(list(x,y),findud)</div><div class="line">  <span class="keyword">return</span>(mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在看一个案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">5</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">88</span>)</div><div class="line">&gt; y &lt;- c(<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">23</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">&gt; udcorr(x,y)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div></pre></td></tr></table></figure>
<p>在这个案例中，x和y在10次中同时上升3次（第一次同时上升是12到13，2到3），并同时下降1次，得到的相关性估计为4/10=0.4。</p>
<p>这个函数的思路就是先把x和y的值编码为1和-1，其中1代表当前观测值较前一个增加，-1表示减少，这个转换过程就是通过<code>vud &lt;- v[-1]-v[-length(v)]</code>这行代码实现的，它具体是怎么实现的呢，以向量x为例说明一下，看下面的示意图就行了：</p>
<div class="figure">
<img src="http://ortxpw68f.bkt.clouddn.com/professional/180918/CIJDbLmB77.png?imageslim" alt="mark">
<p class="caption">mark</p>
</div>
<p>其中，<code>x[-1]-x[-11]</code>表示的就是第2个元素减去第1个元素，第3个元素减去第2个元素等等，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; x[-<span class="number">1</span>]-x[-<span class="number">11</span>]</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p><code>return(ifelse(vud &gt; 0, 1,-1))</code>这个语句就是把上面的向量再转换为1与-1，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ifelse(x[-<span class="number">1</span>]-x[-<span class="number">11</span>] &gt;<span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>)</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>接着又构建了一个<code>udcorr</code>这个函数。其中<code>ud &lt;- lapply(list(x,y),findud)</code>这行的功能就是，使用<code>lapply()</code>函数对xy构成的这个列表使用findud函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; list(x,y)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">4</span>  <span class="number">2</span>  <span class="number">3</span> <span class="number">23</span>  <span class="number">6</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span>  <span class="number">6</span>  <span class="number">3</span>  <span class="number">2</span></div><div class="line"></div><div class="line">&gt; lapply(list(x,y),findud)</div><div class="line">[[<span class="number">1</span>]]</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div><div class="line"></div><div class="line">[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span> -<span class="number">1</span></div></pre></td></tr></table></figure>
<p>最后使用<code>return(mean(ud[[1]] == ud[[2]]))</code>这行代码来计算里面的均数，因为<code>ud[[1]] == ud[[2]]</code>的结果是一个逻辑向量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]]</div><div class="line"> [<span class="number">1</span>] <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div></pre></td></tr></table></figure>
<p>对于逻辑向量来说，TRUE就是1，FALSE就是0，因此计算这个向量的均值就是计算TRUE占总向量数目的比例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; mean(ud[[<span class="number">1</span>]] == ud[[<span class="number">2</span>]])</div><div class="line">[<span class="number">1</span>] <span class="number">0.4</span></div><div class="line"></div><div class="line"><span class="comment"># 逻辑向量也能使用数学函数，如下所示，TRUE就是1</span></div><div class="line">&gt; sum(c(<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">3</span></div></pre></td></tr></table></figure>
<p>但是在R中，上面的代码可以用<code>diff()</code>这个函数来进行计算，这个函数可以对向量做“滞后”运算，这个运算的效果如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div></pre></td></tr></table></figure>
<p>从上面的结果我们可以看出来，这个滞后运算其实就是后一个数减去前一个数。与滞后运算相匹配的函数是<code>sign()</code>函数，它可以将正值与负值转换为1，-1或0，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">5</span> <span class="number">12</span> <span class="number">13</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">0</span>  <span class="number">1</span> <span class="number">15</span> <span class="number">16</span>  <span class="number">8</span> <span class="number">88</span></div><div class="line">&gt; diff(x)</div><div class="line"> [<span class="number">1</span>]   <span class="number">7</span>   <span class="number">1</span> -<span class="number">10</span>   <span class="number">3</span>  -<span class="number">6</span>   <span class="number">1</span>  <span class="number">14</span>   <span class="number">1</span>  -<span class="number">8</span>  <span class="number">80</span></div><div class="line">&gt; sign(diff(x))</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span> -<span class="number">1</span>  <span class="number">1</span></div></pre></td></tr></table></figure>
<p>因此，我们可以把<code>undcorr()</code>函数换一种方式写，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">udcorr &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">  mean(sign(diff(x))==sign(diff(y)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ifelse案例3-转换某个字符串"><code>ifelse</code>案例3-转换某个字符串</h3>
<p><code>ifelse()</code>可以嵌套使用，看一个案例，<code>g</code>是一个鲍鱼的数据集，性别被编号为M、F或I（I是指Infant，幼虫的意思），现在我们将这些编号转换为1、2或3，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; g &lt;- c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>,<span class="string">"M"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; g</div><div class="line">[<span class="number">1</span>] <span class="string">"M"</span> <span class="string">"F"</span> <span class="string">"F"</span> <span class="string">"I"</span> <span class="string">"M"</span> <span class="string">"M"</span> <span class="string">"F"</span></div><div class="line">&gt; ifelse(g == <span class="string">"M"</span>,<span class="number">1</span>,ifelse(g == <span class="string">"F"</span>,<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面代码的运行过程是这个样子的：</p>
<ol style="list-style-type: decimal">
<li>R先执行外层的<code>ifelse()</code>，其中当<code>g==&quot;M&quot;</code>时，返回1；否则就返回<code>ifelse(g == &quot;F&quot;,2,3)</code>；</li>
<li>当返回的是<code>ifelse(g == &quot;F&quot;,2,3)</code>，这是一个表达式，还能计算，那么如果<code>g==&quot;F&quot;</code>，就返回2，否则返回3。</li>
</ol>
<p>如果希望按照性别形成子集，那么可以使用<code>which()</code>函数寻找M、F或I对应元素的编号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; m &lt;- which(g == <span class="string">"M"</span>)</div><div class="line">&gt; f &lt;- which(g == <span class="string">"F"</span>)</div><div class="line">&gt; i &lt;- which(g == <span class="string">"I"</span>)</div><div class="line">&gt; m</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">&gt; f</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">&gt; i</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>如果想把这些子集保存在一个列表中，可以按下面的代码操作，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">grps &lt;- list()</div><div class="line"><span class="keyword">for</span> (gen <span class="keyword">in</span> c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"I"</span>))&#123;</div><div class="line">  grps[[gen]] &lt;- which(g == gen)</div><div class="line">&#125;</div><div class="line">grps</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; grps</div><div class="line">$M</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">6</span></div><div class="line">$<span class="literal">F</span></div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></div><div class="line">$I</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<h3 id="嵌套if...else...表达式">嵌套<code>if...else...</code>表达式</h3>
<p>有的时候需要处理大于2种的选择，此时就需要使用嵌套<code>if...else...</code>嵌套语句，例如还以前面的<code>priceCalculator()</code>函数为例说明一下，客户假设说有3种，私有组织，税率为12%，公共组织税率为6%，国外客户为0%，现在改造<code>priceCalculator()</code>函数，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(client ==<span class="string">'private'</span>)&#123;</div><div class="line">    tot.price &lt;- net.price * <span class="number">1.12</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">if</span>(client == <span class="string">'public'</span>)&#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1.06</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      tot.price &lt;- net.price * <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"private"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2240</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"public"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2120</span></div><div class="line">&gt; priceCalculator(hours=<span class="number">50</span>,client=<span class="string">"abroad"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">2000</span></div></pre></td></tr></table></figure>
<p>虽然代码已经进行了改造，可以根据不同的客户类型计算不同的收费，但是此时这个函数还只一次只能处理一个值，无法进行向量化逻辑嵌套，对此，可以使用<code>ifelse()</code>函数进行嵌套，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- ifelse(client ==<span class="string">'private'</span>, <span class="number">1.12</span>, </div><div class="line">                ifelse(client==<span class="string">'public'</span>, <span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">privateData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>, <span class="string">'private'</span>)</div><div class="line">)</div><div class="line">with(privateData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">publicData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">)</div><div class="line">with(publicData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">abroadData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(abroadData, priceCalculator(hours, client = type))</div><div class="line"></div><div class="line">mixData &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">  type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">with(mixData, priceCalculator(hours, client = type))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt; with(privateData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4928</span> <span class="number">5600</span> <span class="number">1792</span></div><div class="line">&gt; </div><div class="line">&gt; publicData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>, <span class="string">'public'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(publicData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">4664</span> <span class="number">5300</span> <span class="number">1696</span></div><div class="line">&gt; </div><div class="line">&gt; abroadData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(abroadData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span> <span class="number">4400</span> <span class="number">5000</span> <span class="number">1600</span></div><div class="line">&gt; </div><div class="line">&gt; mixData &lt;- data.frame(</div><div class="line">+   hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>), </div><div class="line">+   type = c(<span class="string">'private'</span>, <span class="string">'public'</span>, <span class="string">'abroad'</span>, <span class="string">'abroad'</span>)</div><div class="line">+ )</div><div class="line">&gt; with(mixData, priceCalculator(hours, client = type))</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span> <span class="number">4664</span> <span class="number">5000</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="switch处理多种选择"><code>switch</code>处理多种选择</h2>
<p><code>if...else...</code>嵌套语句适用于多种条件的判断，假如判断的条件只有1个就不需要使用<code>if</code>嵌套，使用<code>switch()</code>函数即可。</p>
<p>在前面的<code>priceCalculator()</code>函数的案例中，税率实际上取决于客户的类型，即公共组织、私有组织或者外国客户，我们有3种可能，每种对应一种特定的税率，在这种情况下，就可以使用<code>switch</code>函数来简化判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>完整代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, abroad=<span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">numeric(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><code>switch()</code>函数调用的过程如下：</p>
<ol style="list-style-type: decimal">
<li>用一个单一值(Single Value)作为第1个参数（这里就是client），需要注意的是，<code>switch()</code>无法处理向量化数据，只能处理单一的数据，因此第1个参数不能是向量；</li>
<li>在第1个参数后，列出所有可能的情况及对应的值。</li>
<li>这里需要注意的是，我们只列出了3种情况，其实第3种情况<code>abroad</code>对应的是<code>其它情况</code>，如果使用其它的字符口中，则无法进行计算，后面会提到如何解这个问题。</li>
</ol>
<p><code>switch()</code>函数的第1个参数并不一定是一个特定的值，也可以是某个表达式，只要导出的结果是一个字符向量或数字即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">1</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some value"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">2</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"something else"</span></div><div class="line">&gt; <span class="keyword">switch</span>(<span class="number">3</span>, <span class="string">'some value'</span>, <span class="string">'something else'</span>, <span class="string">'some more'</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"some more"</span></div></pre></td></tr></table></figure>
<h3 id="在switch中使用默认值">在<code>switch()</code>中使用默认值</h3>
<p>在<code>switch()</code>函数的调用中，并不需要列出所有可能的情况，如果对于所有不满足条件的判断值，都返回同一个结果的话，可以把这个结果放在参数列表的末尾，并去掉前面的判断值，因此可以看下面的代码，这与<code>ifelse</code>调用的结果一样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, pblic=<span class="number">1.06</span>, <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>现在就可以使用这个解决前面提出的那个问题了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph</div><div class="line">  VAT &lt;- <span class="keyword">switch</span>(client, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>)</div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div><div class="line"></div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'private'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1120</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, client=<span class="string">'public'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'abroad'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div><div class="line">&gt; priceCalculator(<span class="number">25</span>, pph=<span class="number">40</span>, <span class="string">'other'</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1000</span></div></pre></td></tr></table></figure>
<p>在<code>switch()</code>函数中的第3个参数里，把<code>abroad=1</code>改为<code>1</code>则就说明了，这是其他情况，而非仅仅是<code>abroad</code>这一种情况。</p>
<h2 id="for-循环">for 循环</h2>
<p><code>for</code>循环用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> values)&#123;</div><div class="line">    <span class="keyword">...</span> do someting...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="for循环案例1-简单案例"><code>for</code>循环案例1-简单案例</h3>
<p>先看一个for循环的最简单案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">cat(i);</div><div class="line">cat(<span class="string">" "</span>);</div><div class="line">i=i+<span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">20</span>)&#123;</div><div class="line">+     cat(i);</div><div class="line">+     cat(<span class="string">" "</span>);</div><div class="line">+     i=i+<span class="number">3</span>;</div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></div></pre></td></tr></table></figure>
<p>从上面结果，我们可以看出，循环中处理的对象是1:20这20个数，对每个数进行操作不管循环内部i如何变化。因此，循环体内的i=i+3就不会对循环条件中的变量造成改变，具体执行过程相当于：<code>i=1</code> <code>-&gt;</code> <code>i=i+3</code>，此时<code>i=4</code>；<code>-&gt;</code> 第一次循环结束，第二次循环开始，<code>i=2</code>。尤其注意，i变成4又变成2，所以打印出来的结果是，1,2,3,4….20的连续值。如果想要随意的改变条件中的变量，可以使用while循环，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; i=<span class="number">1</span> </div><div class="line">&gt; <span class="keyword">while</span>(i&lt;=<span class="number">20</span>)&#123; </div><div class="line">+     cat(i); </div><div class="line">+     cat(<span class="string">" "</span>); </div><div class="line">+     i=i+<span class="number">3</span> </div><div class="line">+ &#125;</div><div class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">7</span> <span class="number">10</span> <span class="number">13</span> <span class="number">16</span> <span class="number">19</span></div></pre></td></tr></table></figure>
<h3 id="for循环案例2-pricecalculator函数"><code>for</code>循环案例2-<code>priceCalculator()</code>函数</h3>
<p>现在使用<code>for</code>循环来改造原来的<code>priceCalculator()</code>函数，使这个函数可以一次地计算出多个客户类型的结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">priceCalculator &lt;- <span class="keyword">function</span>(hours, pph=<span class="number">40</span>, client)&#123;</div><div class="line">  net.price &lt;- hours*pph*</div><div class="line">    ifelse(hours &gt; <span class="number">100</span>, <span class="number">0.9</span>, <span class="number">1</span>)</div><div class="line">  </div><div class="line">  VAT &lt;- numeric(<span class="number">0</span>)</div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> client)&#123;</div><div class="line">    VAT &lt;- c(VAT, <span class="keyword">switch</span>(i, private=<span class="number">1.12</span>, public=<span class="number">1.06</span>, <span class="number">1</span>))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  tot.price &lt;- net.price*VAT</div><div class="line">  round(tot.price)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这段代码中，做了以下修改：</p>
<ol style="list-style-type: decimal">
<li>创建了一个长度为0的数值向量，即<code>VAT &lt;- numeric(0)</code>；</li>
<li>对向量<code>client</code>中的每个值，用<code>switch()</code>来进行逻辑判断，选出对应的<code>VAT</code>值；</li>
<li>每次循环，都将<code>switch()</code>的结果放入向量VAT的末尾。</li>
</ol>
<p>这个函数的计算结果就是向量VAT包含每个客户对应的税率值，看一下计算结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">clients &lt;- data.frame(</div><div class="line">  hours = c(<span class="number">25</span>, <span class="number">110</span>, <span class="number">125</span>, <span class="number">40</span>),</div><div class="line">  type = c(<span class="string">'public'</span>,<span class="string">'abroad'</span>,<span class="string">'private'</span>,<span class="string">'abroad'</span>)</div><div class="line">)</div><div class="line">clients</div><div class="line">priceCalculator(clients$hours,client = clients$type)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; clients</div><div class="line">  hours    type</div><div class="line"><span class="number">1</span>    <span class="number">25</span>  public</div><div class="line"><span class="number">2</span>   <span class="number">110</span>  abroad</div><div class="line"><span class="number">3</span>   <span class="number">125</span> private</div><div class="line"><span class="number">4</span>    <span class="number">40</span>  abroad</div><div class="line">&gt; priceCalculator(clients$hours,client = clients$type)</div><div class="line">[<span class="number">1</span>] <span class="number">1060</span> <span class="number">3960</span> <span class="number">5040</span> <span class="number">1600</span></div></pre></td></tr></table></figure>
<h2 id="any与all">any()与all()</h2>
<p>使用<code>any()</code>和<code>all()</code>函数可以对某个变量进行判断，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">10</span></div><div class="line">&gt; x</div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span></div><div class="line">&gt; any(x&gt;<span class="number">8</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; any(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">88</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></div><div class="line">&gt; all(x&gt;<span class="number">0</span>)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div></pre></td></tr></table></figure>
<p>现在看一个案例，假设一个向量由若干个0或1构成，我们想要找𡵾其中连续出现1的游程（在一个0和1组成的序列中，一个由连续的0或1构成的串称为一个游程(run)）。例如对于向量x(假设它为1,0,0,1,1,1,0,1,1)，从它第4个索引处开始有长度为3的游程，而长度为2的游程分别始于第4，第5和第8索引的位置，因此现在我们构建一个函数，返回结果为(4,5,8)，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">findruns &lt;- <span class="keyword">function</span>(x,k)&#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  runs &lt;- <span class="literal">NULL</span></div><div class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(n-k+<span class="number">1</span>))&#123;</div><div class="line">    <span class="keyword">if</span> (all(x[i:(i+k-<span class="number">1</span>)]==<span class="number">1</span>)) </div><div class="line">       runs &lt;- c(runs,i)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span>(runs)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在运行这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">&gt; findruns(x,<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div><div class="line">&gt; findruns(x,<span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">5</span> <span class="number">8</span></div><div class="line">&gt; findruns(x,<span class="number">6</span>)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/10/R/数据的导入与导出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/R/数据的导入与导出/" itemprop="url">R语言笔记之数据的导入与导出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T12:00:00+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,696
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据的导入">数据的导入</h2>
<p>在R语言中，常常用到导入数据的源文件是Excel文件，CSV文件，文本文件等等。</p>
<h2 id="导入csv文件"> 导入csv文件</h2>
<p>此方法可以用以导入Excel数据，将Excel数据转化为csv格式。 CSV是（逗号分隔值）的英文缩写，通常都是纯文本文件。</p>
<p>其导入R中的数据格式为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mydataframe&lt;-read.table(file,header=logical_value,ep=<span class="string">"delimiter"</span>,row.names=<span class="string">"name"</span>)</div><div class="line">file:csv文件</div><div class="line">header:逻辑值，首先是否包括变量名</div><div class="line">sep:分隔符</div><div class="line">row.names:指定一个或多个表示行标识符的变量</div><div class="line">grades&lt;-read.table(<span class="string">"studentgrades.csv"</span>,header=<span class="literal">TRUE</span>,sep=<span class="string">","</span>,row.names=<span class="string">"STUDENTID"</span>)</div></pre></td></tr></table></figure>
<p>表示从当前目录中读取一个名为studentgrades.csv的逗号分隔文件，从文件的第一行取得变量名字，将STUDENTID指定为行标识符，整个结果保存到grades的数据框中。</p>
<h3 id="read.csv"><code>read.csv()</code></h3>
<p>另外一个导入csv文件的函数是<code>read.csv()</code>。</p>
<h3 id="read.delim和read.delim2"><code>read.delim</code>和<code>read.delim2</code></h3>
<p>这两个函数可以分别使用<strong>句号</strong>和<strong>逗号</strong>作为小数位来导入制表符分隔的文件。</p>
<h2 id="导入剪切板中的数据"> 导入剪切板中的数据</h2>
<p>通常情况下就是在Excel中复制，接着输入以下命令就可以导入数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt;- read.table(<span class="string">"clipboard"</span>, header = <span class="literal">T</span>, sep=<span class="string">"\t"</span>)</div></pre></td></tr></table></figure>
<h2 id="导入文本文件"> 导入文本文件</h2>
<p>一般采用<code>read.table()</code>函数和<code>read.csv()</code>函数实现文本文件数据的读取，对于这两个函数有几个重要的参数：</p>
<ol style="list-style-type: decimal">
<li><code>file</code>指定外部文件的路径和文件名；</li>
<li><code>header</code>指定是否将原数据的第一行最为字段名，<code>read.table()</code>函数默认设置为FALSE，而read.csv()函数默认设置为TRUE；</li>
<li><code>sep</code>指定字段之间的分割符，read.table()函数默认设置为空格“”，而read.csv()函数默认设置为逗号；</li>
<li>除此，<code>read.table()</code>函数还可以设置读入数据集的行名、列名、字符串是否转换为因子、缺失值的形式等，详细可查看<code>read.table()</code>函数的帮助文档。</li>
</ol>
<h2 id="从scan导入数据"> 从scan导入数据</h2>
<p>主要用于键盘输入数据，详细使用方法：</p>
<h3 id="scan函数"> scan() 函数</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">scan(file = <span class="string">""</span>, what = double(<span class="number">0</span>), nmax = -<span class="number">1</span>, n = -<span class="number">1</span>, sep = <span class="string">""</span>,</div><div class="line">     quote = <span class="keyword">if</span>(identical(sep, <span class="string">"\n"</span>)) <span class="string">""</span> <span class="keyword">else</span> <span class="string">"'\""</span>, dec = <span class="string">"."</span>,</div><div class="line">     skip = <span class="number">0</span>, nlines = <span class="number">0</span>, na.strings = <span class="string">"NA"</span>,</div><div class="line">     flush = <span class="literal">FALSE</span>, fill = <span class="literal">FALSE</span>, strip.white = <span class="literal">FALSE</span>,</div><div class="line">     quiet = <span class="literal">FALSE</span>, blank.lines.skip = <span class="literal">TRUE</span>, multi.line = <span class="literal">TRUE</span>,</div><div class="line">     comment.char = <span class="string">""</span>, allowEscapes = <span class="literal">FALSE</span>, encoding = <span class="string">"unknown"</span>)</div></pre></td></tr></table></figure>
<p><strong>参数使用如下所示：</strong> 1. what:声明读入为字符类型数据，可能指定读入的精度/类型，例如：what=integer(0)；what=numeric(0)；what=character(0)； 如果SCAN()读入有字符与数字，用what=“”来进行声明，则会把读入的数字隐式的都转变成字符； 2. sep：指定各个读入的数据之间的分隔符；默认情况下分隔符：空格、tab；如果不是其它分隔符，例如“：/”通过SEP来指定； 3. 可以通过list指定读入变量的变量名，同时生成的对象为列表，则可以同时读入字符与数字； 4. Skip 从第几行开始读入数据； 5. Nlines 指定最大读入行数； 6. 如果通过键盘输入的时候，不希望出现下标提示，则可以使用：quiet=TRUE； 7. encoding =””指定的编码格式，有时候读入的中文可能会出现乱码的时候，可能通过这个参数来指定：Latin-1 或者 UTF-8</p>
<h2 id="使用表格输入数据"> 使用表格输入数据</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mydata&lt;-data.frame(age=numeric(<span class="number">0</span>),</div><div class="line">                   gender=character(<span class="number">0</span>),</div><div class="line">                   weight=numeric(<span class="number">0</span>))</div><div class="line">mydata&lt;-edit(mydata)</div></pre></td></tr></table></figure>
<p>创建一个名为mydata的数据框，含三个变量，age为数据型，gender为字符型，weight为数值型。edit调用文本编辑器，键入数据。其中numeric(0)创建一个指定模型但不含实际数据的变量。如果再次调用mydata&lt;-edit(mydata)能够用来修改数据，或者使用fix(mydata)也行。</p>
<h2 id="使用readxl包来读取excel文件">使用<code>readxl</code>包来读取excel文件</h2>
<p><code>readxl</code>包中的几个函数可以读取excel文件，主要有<code>read_excel</code>，<code>read_xls</code>，<code>read_xlsx</code>。其中各个函数的参数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">read_excel(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div><div class="line"></div><div class="line">read_xls(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div><div class="line"></div><div class="line">read_xlsx(path, sheet = <span class="literal">NULL</span>, range = <span class="literal">NULL</span>, col_names = <span class="literal">TRUE</span>,</div><div class="line">  col_types = <span class="literal">NULL</span>, na = <span class="string">""</span>, trim_ws = <span class="literal">TRUE</span>, skip = <span class="number">0</span>,</div><div class="line">  n_max = <span class="literal">Inf</span>, guess_max = min(<span class="number">1000</span>, n_max),</div><div class="line">  progress = readxl_progress(), .name_repair = <span class="string">"unique"</span>)</div></pre></td></tr></table></figure>
<p>参数意义如下所示：</p>
<table>
<colgroup>
<col width="17%">
<col width="82%">
</colgroup>
<thead>
<tr class="header">
<th align="right">参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">path</td>
<td>xls/xlsx文件的路径</td>
</tr>
<tr class="even">
<td align="right">sheet</td>
<td>Excel文件中Sheet的参数，可以是一个字符串，也就是sheet的名称，可以是一个整数，它表示sheet的位置。如果不输入这个参数，默认输入第1个sheet的数据。</td>
</tr>
<tr class="odd">
<td align="right">range</td>
<td>sheet中单元格的范围，例如可以输入<code>range=B2:G14</code>。也可以指定某个sheet，例如<code>range=&quot;mtcars!B1:D5&quot;</code>。</td>
</tr>
<tr class="even">
<td align="right">col_names</td>
<td><code>TRUE</code> 使用第一行作为行名， <code>FALSE</code> 使用默认的名字，或者是使用一个字符串或字符串向量来表示第一行的名称。</td>
</tr>
<tr class="odd">
<td align="right">col_types</td>
<td>Either <code>NULL</code> to guess all from the spreadsheet or a character vector containing one entry per column from these options: “skip”, “guess”, “logical”, “numeric”, “date”, “text” or “list”. If exactly one <code>col_type</code> is specified, it will be recycled. The content of a cell in a skipped column is never read and that column will not appear in the data frame output. A list cell loads a column as a list of length 1 vectors, which are typed using the type guessing logic from <code>col_types = NULL</code>, but on a cell-by-cell basis.</td>
</tr>
<tr class="even">
<td align="right">na</td>
<td>Character vector of strings to interpret as missing values. By default, readxl treats blank cells as missing data.</td>
</tr>
<tr class="odd">
<td align="right">trim_ws</td>
<td>Should leading and trailing whitespace be trimmed?</td>
</tr>
<tr class="even">
<td align="right">skip</td>
<td>Minimum number of rows to skip before reading anything, be it column names or data. Leading empty rows are automatically skipped, so this is a lower bound. Ignored if <code>range</code> is given.</td>
</tr>
<tr class="odd">
<td align="right">n_max</td>
<td>Maximum number of data rows to read. Trailing empty rows are automatically skipped, so this is an upper bound on the number of rows in the returned tibble. Ignored if <code>range</code> is given.</td>
</tr>
<tr class="even">
<td align="right">guess_max</td>
<td>Maximum number of data rows to use for guessing column types.</td>
</tr>
<tr class="odd">
<td align="right">progress</td>
<td>Display a progress spinner? By default, the spinner appears only in an interactive session, outside the context of knitting a document, and when the call is likely to run for several seconds or more. See <code>readxl_progress()</code> for more details.</td>
</tr>
<tr class="even">
<td align="right">.name_repair</td>
<td>Handling of column names. By default, readxl ensures column names are not empty and are unique. If the tibble package version is recent enough, there is full support for <code>.name_repair</code> as documented in <code>tibble::tibble()</code>. If an older version of tibble is present, readxl falls back to name repair in the style of tibble v1.4.2.</td>
</tr>
</tbody>
</table>
<p>具体的可以参考<a href="https://readxl.tidyverse.org/reference/read_excel.html" target="_blank" rel="external">readxl资料</a>。</p>
<h2 id="批量读取数据">批量读取数据</h2>
<p>读取N个Excel文件，并将这N个Excel文件进行合并，分为四种情况，代码如下所示，其中read_excel函数所在的包为readxl。</p>
<p>解决方案如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data1'</span>) </div><div class="line"><span class="comment"># 设置R的工作空间</span></div><div class="line"><span class="comment">#res &lt;- NULL</span></div><div class="line"></div><div class="line">data1 &lt;- data.frame()</div><div class="line"><span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">4</span>)&#123;</div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,<span class="string">'test'</span>,i,<span class="string">'.xlsx'</span>)   <span class="comment"># 构造数据路径</span></div><div class="line">res &lt;- c(res,path)</div><div class="line">data1 &lt;- rbind(data1,read_excel(path = path))   <span class="comment"># 读取并合并数据</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件没有规律的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">'D:\\data file\\data2'</span>)  <span class="comment"># 设置工作空间</span></div><div class="line">filenames &lt;- dir()   <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line">data2 &lt;- data.frame()   <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"></div><div class="line"><span class="comment">#通过循环完成数据合并</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> filenames)&#123;</div><div class="line"><span class="comment"># 构造数据路径</span></div><div class="line">path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"><span class="comment">#res &lt;- c(res,path)</span></div><div class="line"><span class="comment"># 读取并合并数据</span></div><div class="line">data2 &lt;- rbind(data2,read_excel(path = path))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于文件名没有规律的情况，并且只读取某做后缀的文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加载第三方扩展包，用于编写SQL语句</span></div><div class="line"> <span class="keyword">library</span>(sqldf)</div><div class="line"> <span class="comment"># 设置工作空间</span></div><div class="line"> setwd(<span class="string">'D:\\data file\\data4'</span>)</div><div class="line"> <span class="comment"># 读取该工作空间下的所有文件名</span></div><div class="line"> filenames &lt;- dir()</div><div class="line"> <span class="comment"># 通过正则，获取所有xlsx结尾的文件名</span></div><div class="line"> filenames2 &lt;- grep(<span class="string">'\\.xlsx'</span>, filenames, value = <span class="literal">TRUE</span>)</div><div class="line"> <span class="comment"># 初始化数据框，用于后面的数据合并</span></div><div class="line"> data4 &lt;- data.frame()</div><div class="line"> <span class="comment">#通过循环完成数据合并</span></div><div class="line"> <span class="keyword">for</span> (i <span class="keyword">in</span> filenames2)&#123;</div><div class="line"> <span class="comment"># 构造数据路径</span></div><div class="line"> path &lt;- paste0(getwd(),<span class="string">'\\'</span>,i)</div><div class="line"> <span class="comment">#res &lt;- c(res,path)</span></div><div class="line"> <span class="comment"># 使用read_excel函数读取xlsx文件</span></div><div class="line"> data &lt;- read_excel(path = path)</div><div class="line"> <span class="comment"># 使用sqldf函数编写SQL语句，并把结果合并起来</span></div><div class="line"> data4 &lt;- rbind(data4, sqldf(<span class="string">"select id,name,gender,age from data"</span>))</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="导出数据"> 导出数据</h2>
<h3 id="导出的路径"> 导出的路径</h3>
<p>为了避免在导出路径中使用转义字符，可以使用file.path()函数来构建正确的路径，这个函数的工作原理类似于paste()，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.path(<span class="string">"d:"</span>,<span class="string">"download"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"d:/download"</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p> file.path(“d:”,“download”) [1] “d:/download”</p>
</blockquote>
<h3 id="导出为txt格式"> 导出为txt格式</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> a</div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">5</span>  <span class="number">4</span></div><div class="line">&gt; b</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="literal">NA</span>  <span class="string">"4"</span></div><div class="line"> c &lt;- data.frame(a,b)</div><div class="line"> c</div><div class="line">   a    b</div><div class="line"><span class="number">1</span>  <span class="number">1</span>    a</div><div class="line"><span class="number">2</span>  <span class="number">2</span>    b</div><div class="line"><span class="number">3</span>  <span class="number">4</span>    c</div><div class="line"><span class="number">4</span> <span class="literal">NA</span>    d</div><div class="line"><span class="number">5</span>  <span class="number">5</span> &lt;<span class="literal">NA</span>&gt;</div><div class="line"><span class="number">6</span>  <span class="number">4</span>    <span class="number">4</span></div><div class="line"> write.table(c,file = <span class="string">"c:\\data.txt"</span>,sep = <span class="string">","</span>,quote = <span class="literal">FALSE</span>, append = <span class="literal">FALSE</span>, na = <span class="string">"NA"</span>)</div></pre></td></tr></table></figure>
<p>c为导出的数据，file为导出的路径，sep = “,”表示用逗号隔开数据，quote = FALSE表示消除字符串的引号标志，append = FALSE打开一个新文件，如果为TRUE则表示将此数据追加到已经存在的文件中，na=”NA”表示用NA来代表na值。</p>
<h2 id="读取错误">读取错误</h2>
<p>R语言读取Excel文件有时会出错，如果要读取某些Excel表格文件，操作如下所示：</p>
<ol style="list-style-type: decimal">
<li>用鼠标选中据，然后Ctrl+C复制；</li>
<li>在Rstudio中输入：read.table(“clipboard”,header=T)-&gt;x1，显示以下结果：</li>
</ol>
<blockquote>
<p>Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :    line 2 did not have 8 elements</p>
</blockquote>
<p>大概意思是，有两行数据的元素不满足8个（即第No.2不满足8个元素），无法读取，因此需要改变一下代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x &lt;- read.table(<span class="string">"clipboard"</span>,sep=<span class="string">"\t"</span>,header=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<p> 这样就能正常读取了，因为Excel的文件中，每个单元格就是以制表符将它们分开的，而sep=“”的意思就是，读取数据的时候，以制表符进行分割来读取。</p>
<h2 id="r语言与目录操作">R语言与目录操作</h2>
<h3 id="设置目录file.path">设置目录<code>file.path()</code></h3>
<p>在R中，目录的表达方法与Windows有所不同，在Windows中，如果要表示D盘下的某个目录，就是<code>D:\biotest</code>，用的是<code>\</code>，而在R中，则是<code>/</code>或<code>\\</code>，即<code>D:/biotest</code>或<code>D:\\biotest</code>。为了避免在R中使用转义字符，可以使用<code>file.path()</code>函数来构建正确的路径。这个函数类似于<code>paste()</code>，会将传入的各个参数拼接在一起，与操作系统的设置无关，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div></pre></td></tr></table></figure>
<p>使用<code>file.path()</code>来设置工作目录非常方便，可以逐一指定目录，它会将各个目录连接起来，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/"</span></div><div class="line">&gt; setwd(file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>))</div><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div></pre></td></tr></table></figure>
<h3 id="操作文件dir或list.files">操作文件<code>dir()</code>或<code>list.files()</code></h3>
<p>有的时候，在R中如果要遍历某个指定目录下的所有文件和文件夹，并对它们进行某种操作，如果要获得指定目录下的文件列表，可以使用<code>list.files()</code>或<code>dir()</code>函数，这两个函数的功能是一样的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"D:/biotest"</span></div><div class="line">&gt; list.files()</div><div class="line"> [<span class="number">1</span>] <span class="string">"kegg"</span>                                          </div><div class="line"> [<span class="number">2</span>] <span class="string">"Miniconda2-latest-Linux-x86_64.sh"</span>             </div><div class="line"> [<span class="number">3</span>] <span class="string">"NGS 数据过滤之 Trimmomatic 详细说明 - 简书.pdf"</span></div><div class="line"> [<span class="number">4</span>] <span class="string">"nohup.out"</span>                                     </div><div class="line"> [<span class="number">5</span>] <span class="string">"paper and manual"</span>                              </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span>                                      </div><div class="line">&gt; dir()</div><div class="line"> [<span class="number">1</span>] <span class="string">"kegg"</span>                                          </div><div class="line"> [<span class="number">2</span>] <span class="string">"Miniconda2-latest-Linux-x86_64.sh"</span>             </div><div class="line"> [<span class="number">3</span>] <span class="string">"NGS 数据过滤之 Trimmomatic 详细说明 - 简书.pdf"</span></div><div class="line"> [<span class="number">4</span>] <span class="string">"nohup.out"</span>                                     </div><div class="line"> [<span class="number">5</span>] <span class="string">"paper and manual"</span>                              </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>也可以查看某个特定文件夹的内容：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; dir(file.path(<span class="string">"D:"</span>,<span class="string">"biotest"</span>,<span class="string">"kegg"</span>))</div><div class="line"> [<span class="number">1</span>] <span class="string">"eco00640.eco.kegg.png"</span>                       </div><div class="line"> [<span class="number">2</span>] <span class="string">"eco00640.png"</span>                                </div><div class="line"> [<span class="number">3</span>] <span class="string">"eco00640.xml"</span>                                </div><div class="line"> [<span class="number">4</span>] <span class="string">"hsa00640.gene.ensprot.cpd.cas.png"</span>           </div><div class="line"> [<span class="number">5</span>] <span class="string">"hsa00640.gene.entrez.cpd.kc.png"</span>      </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<h3 id="返回文件目录dirname与文件名basename">返回文件目录<code>dirname</code>与文件名<code>basename</code></h3>
<p><code>dirname</code>函数只返回文件目录，不返回文件名，而<code>basename</code>函数与之相反，只返回文件名，不返回言论的目录，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; file_name &lt;- <span class="string">"C:/Program Files/R/R-devel/bin/x64/RGui.exe"</span></div><div class="line">&gt; file_name</div><div class="line">[<span class="number">1</span>] <span class="string">"C:/Program Files/R/R-devel/bin/x64/RGui.exe"</span></div><div class="line">&gt; basename(file_name)</div><div class="line">[<span class="number">1</span>] <span class="string">"RGui.exe"</span></div><div class="line">&gt; dirname(file_name)</div><div class="line">[<span class="number">1</span>] <span class="string">"C:/Program Files/R/R-devel/bin/x64"</span></div></pre></td></tr></table></figure>
<h3 id="文件操作函数汇总">文件操作函数汇总</h3>
<p>常用的几个操作文件以及目录的函数，如下所示：</p>
<table>
<colgroup>
<col width="19%">
<col width="80%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>list.files</code></td>
<td>列出某个目录下的所有文件</td>
</tr>
<tr class="even">
<td><code>list.dirs</code></td>
<td>列出某个目录下的所有子目录</td>
</tr>
<tr class="odd">
<td><code>file.exists</code></td>
<td>检查某个特定的文件是否存在于某个目录下</td>
</tr>
<tr class="even">
<td><code>file.create</code></td>
<td>创建一个空文件</td>
</tr>
<tr class="odd">
<td><code>file.rename</code></td>
<td>重命名文件</td>
</tr>
<tr class="even">
<td><code>file.copy</code></td>
<td>复制文件</td>
</tr>
<tr class="odd">
<td><code>file.remove</code></td>
<td>删除文件</td>
</tr>
<tr class="even">
<td><code>unlink</code></td>
<td>删除目录，例如<code>unlink(&quot;tmp&quot;, recursive=F)</code> #如果文件夹tmp为空，删除文件夹tmp；<code>unlink(&quot;tmp&quot;, recursive=TRUE)</code>#删除文件夹tmp，如果其中有文件一并删除</td>
</tr>
<tr class="odd">
<td><code>file_test()</code></td>
<td>判断一个对象是目录还是文件，<code>-f</code>为判断文件，<code>-d</code>是判断目录，语法格式为：<code>file_test(&quot;-f&quot;, &quot;test&quot;)</code>。</td>
</tr>
<tr class="even">
<td><code>tempfile</code></td>
<td>返回一个临时文件的名称，例如想要在临时文件夹中创建一个文件，就可以将这个函数的返回值传入<code>file.create()</code>或<code>write.table()</code>函数中</td>
</tr>
<tr class="odd">
<td><code>tempdir</code></td>
<td>返回文件系统中临时文件目录的路径。</td>
</tr>
<tr class="even">
<td><code>dir.create</code></td>
<td>创建一个文件夹或目录，如果要创建多个目录<code>recursive = TRUE</code></td>
</tr>
<tr class="odd">
<td><code>getwd()</code></td>
<td>获取当前目录</td>
</tr>
<tr class="even">
<td><code>setwd()</code></td>
<td>设置工作目录</td>
</tr>
<tr class="odd">
<td><code>choose.dir()</code></td>
<td>以窗口的形式设置工作目录</td>
</tr>
<tr class="even">
<td><code>dir()</code></td>
<td>查看当前目录的子目录和文件，功能与<code>list.files()</code>相同</td>
</tr>
</tbody>
</table>
<h3 id="文件操作案例">文件操作案例</h3>
<p>现在创建一个临时文件，并将<code>iris</code>数据框传入其中，然后为了测试数据是否已经写入，再读取这个文件，并将结果保存到一个变量中，然后检查这个变量，最后将这个临时文件删除。</p>
<p>第一步，使用<code>tempfile()</code>函数得到一个字符串，它表示系统临时目录中的一个临时文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my.file &lt;- tempfile()</div><div class="line">my.file</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; my.file &lt;- tempfile()</div><div class="line">&gt; my.file</div><div class="line">[<span class="number">1</span>] <span class="string">"C:\\Users\\Public\\Documents\\Wondershare\\CreatorTemp\\RtmpCWS6Kb\\file26fc52842c9e"</span></div></pre></td></tr></table></figure>
<p>结果返回的是一个字符串，而不是文件，其实文件并不存在，现在通过<code>write.csv</code>将<code>iris</code>写入到<code>my.file</code>，然后使用<code>list.files()</code>来查看R创建的文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">write.csv(iris,file=my.file)</div><div class="line">list.files(tempdir())</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; write.csv(iris,file=my.file)</div><div class="line">&gt; list.files(tempdir())</div><div class="line">[<span class="number">1</span>] <span class="string">"file26fc25291904"</span>                                </div><div class="line">[<span class="number">2</span>] <span class="string">"file26fc52842c9e"</span>                                </div><div class="line">[<span class="number">3</span>] <span class="string">"libloc_185_b6156d26.rds"</span>                         </div><div class="line">[<span class="number">4</span>] <span class="string">"libloc_196_12ea9df4.rds"</span>                         </div><div class="line">[<span class="number">5</span>] <span class="string">"rs-graphics-c18658be-c44b-4ca8-b450-15a567601981"</span></div></pre></td></tr></table></figure>
<p>其中，<code>file26fc52842c9e</code>是临时文件，使用<code>read.csv</code>将文件导入到一个名为<code>file.iris</code>的变量中，并使用<code>str()</code>查看，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.iris &lt;- read.csv(my.file)</div><div class="line">str(file.iris)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; file.iris &lt;- read.csv(my.file)</div><div class="line">&gt; str(file.iris)</div><div class="line"><span class="string">'data.frame'</span>:	<span class="number">150</span> obs. of  <span class="number">6</span> variables:</div><div class="line"> $ X           : int  <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Length: num  <span class="number">5.1</span> <span class="number">4.9</span> <span class="number">4.7</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">5.4</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">4.4</span> <span class="number">4.9</span> <span class="keyword">...</span></div><div class="line"> $ Sepal.Width : num  <span class="number">3.5</span> <span class="number">3</span> <span class="number">3.2</span> <span class="number">3.1</span> <span class="number">3.6</span> <span class="number">3.9</span> <span class="number">3.4</span> <span class="number">3.4</span> <span class="number">2.9</span> <span class="number">3.1</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Length: num  <span class="number">1.4</span> <span class="number">1.4</span> <span class="number">1.3</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.7</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="keyword">...</span></div><div class="line"> $ Petal.Width : num  <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.4</span> <span class="number">0.3</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.1</span> <span class="keyword">...</span></div><div class="line"> $ Species     : Factor w/ <span class="number">3</span> levels <span class="string">"setosa"</span>,<span class="string">"versicolor"</span>,..: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<p>最后为了恢复文件系统原来的状态，使用<code>file.remove()</code>删除这个临时文件，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">file.remove(my.file)</div><div class="line">list.files(tempdir())</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; list.files(tempdir())</div><div class="line">[<span class="number">1</span>] <span class="string">"file26fc25291904"</span>                                </div><div class="line">[<span class="number">2</span>] <span class="string">"libloc_185_b6156d26.rds"</span>                         </div><div class="line">[<span class="number">3</span>] <span class="string">"libloc_196_12ea9df4.rds"</span>                         </div><div class="line">[<span class="number">4</span>] <span class="string">"rs-graphics-c18658be-c44b-4ca8-b450-15a567601981"</span></div></pre></td></tr></table></figure>
<p><code>file26fc52842c9e</code>这个文件已经被删除了。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey</li>
<li>学习R.[美] Richard，Cotton 著刘军 译</li>
<li><a href="https://www.jianshu.com/p/19b1f97083d0" target="_blank" rel="external">R语言目录及文件操作</a></li>
<li><a href="https://www.cnblogs.com/cloudtj/articles/6298107.html" target="_blank" rel="external">R语言-文件管理系统操作</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/09/R/函数构建与循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/09/R/函数构建与循环/" itemprop="url">R语言笔记之函数构建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-09T12:00:00+08:00">
                2017-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,993
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  30
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="函数的编写">函数的编写</h2>
<p>格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">函数名 &lt;- <span class="keyword">function</span>(数据,参数<span class="number">1</span>=默认值,<span class="keyword">...</span>)</div><div class="line">&#123;</div><div class="line">异常处理;</div><div class="line">表达式(循环/判别);</div><div class="line"><span class="keyword">return</span>(返回值);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数案例a">函数案例A</h3>
<p>输入直角三角形的两个边长，求斜边长</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">result &lt;- sqrt(z) </div><div class="line"><span class="keyword">return</span>(result) </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; rcal &lt;- <span class="keyword">function</span>(x,y)&#123; </div><div class="line">+     z &lt;- x^<span class="number">2</span> + y^<span class="number">2</span> </div><div class="line">+     result &lt;- sqrt(z) </div><div class="line">+     <span class="keyword">return</span>(result) </div><div class="line">+ &#125; </div><div class="line">&gt; rcal(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="函数案例b">函数案例B</h3>
<p>给出两个数字后，直接给出这两个数的平方和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line"><span class="keyword">return</span>(z3);</div><div class="line">&#125;</div><div class="line">sqtest(<span class="number">3</span>,<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; sqtest &lt;- <span class="keyword">function</span>(x,y)&#123;</div><div class="line">+     z1 = x^<span class="number">2</span>;z2=y^<span class="number">2</span>;z3=z1+z2;</div><div class="line">+     <span class="keyword">return</span>(z3);</div><div class="line">+ &#125;</div><div class="line">&gt; sqtest(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">25</span></div></pre></td></tr></table></figure>
<h3 id="函数案例c-转换百分比">函数案例C-转换百分比</h3>
<p>创建一个函数，将小数转换为百分数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">addPercent(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; addPercent(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>在R中，函数其实就是一种对象，可以像操作其他对象一样操作了娄，例如可以将函数赋予一个新的对象来实现它的拷贝，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">ppaste &lt;- addPercent</div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line"></div><div class="line">ppaste(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">+   percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">+   result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">+   <span class="keyword">return</span>(result)</div><div class="line">+ &#125;</div><div class="line">&gt; </div><div class="line">&gt; ppaste &lt;- addPercent</div><div class="line">&gt; x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">&gt; </div><div class="line">&gt; ppaste(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"1.1 % "</span>  <span class="string">"0.2 % "</span>  <span class="string">"12.3 % "</span></div></pre></td></tr></table></figure>
<p>需要注意的是，我们在输入<code>ppaste &lt;- addPercent</code>，函数<code>addPercent</code>后面我们并没有加<code>()</code>，这说明，只是将函数<code>addPercet</code>本身给<code>ppaste</code>这个变量，而不是调用<code>addPercent</code>这个函数。当我们输入<code>ppaste</code>，不加括号时，就会出现函数的内容，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; ppaste</div><div class="line"><span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实在R中，只输入函数本身，不输入括号，都会显示函数的内容，再看如下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; mean</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"mean"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000baf0a08</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div><div class="line">&gt; sd</div><div class="line"><span class="keyword">function</span> (x, na.rm = <span class="literal">FALSE</span>) </div><div class="line">sqrt(var(<span class="keyword">if</span> (is.vector(x) || is.factor(x)) x <span class="keyword">else</span> as.double(x), </div><div class="line">    na.rm = na.rm))</div><div class="line">&lt;bytecode: <span class="number">0x0000000004c04a38</span>&gt;</div><div class="line">&lt;environment: namespace:stats&gt;</div></pre></td></tr></table></figure>
<h3 id="函数的返回结果">函数的返回结果</h3>
<p>还以前面的<code>addPercent()</code>函数为例说明一下，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在大括号中最后一行是<code>return(result)</code>，把它删掉，再运行代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">addPercent(x)</div><div class="line">print(addPercent(x))</div></pre></td></tr></table></figure>
<p>可以发现，<code>addPercent(x)</code>没有返回结果，而<code>print(addPercent(x))</code>返回了原计算结果。因此在这里看来，<code>return(result)</code>这行代码是多余的，其实不一定，如果我们想要提前结束函数的运行，就会有用了，现在把<code>addPercent()</code>改造一下，加入一行代码，即<code>if(!is.numeric(x)) return(NULL)</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  <span class="keyword">if</span>(!is.numeric(x)) <span class="keyword">return</span>(<span class="literal">NULL</span>)</div><div class="line">  percent &lt;- round(x*<span class="number">100</span>, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.011</span>, <span class="number">0.0022</span>, <span class="number">0.1234</span>)</div><div class="line">y &lt;- c(<span class="string">"Hello, R"</span>)</div><div class="line">addPercent(x)</div><div class="line">addPercent(y)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x)</div><div class="line">&gt; addPercent(y)</div><div class="line"><span class="literal">NULL</span></div></pre></td></tr></table></figure>
<p>变量<code>x</code>是数字，运行没问题，但变量<code>y</code>是字符串，就出现了问题，此时<code>reurn()</code>语句就派上了用场，函数判断出来了变量<code>y</code>不是数字，就返回了<code>NULL</code>。</p>
<h3 id="函数的简化">函数的简化</h3>
<p>只要函数体只包含一行代码，那么包围函数体的大括号<code>{}</code>有的时候可以省略，将这行代码直接放在参数列表后面即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">odds(<span class="number">0.8</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; odds &lt;- <span class="keyword">function</span>(x) x / (<span class="number">1</span> - x)</div><div class="line">&gt; odds(<span class="number">0.8</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">4</span></div></pre></td></tr></table></figure>
<p>现在我们使用这种方式来重写<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">addPercent(<span class="number">0.0021</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下不所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent &lt;- <span class="keyword">function</span>(x) paste(round(x * <span class="number">100</span>, digits = <span class="number">1</span>), <span class="string">"%"</span>, sep = <span class="string">""</span>)</div><div class="line">&gt; addPercent(<span class="number">0.0021</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.2%"</span></div></pre></td></tr></table></figure>
<p>但是，通常情况下并不推荐这么写，因为可读性太差。其实这种方式还可以继续简化，那就是匿名函数。</p>
<h3 id="给函数添加更多的参数">给函数添加更多的参数</h3>
<p><code>addPercent()</code>会自动将传入的数字乘以100，如果待转换的数字已经是百分数了，那么就需要将其除以100，再传入参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">addPercent(percentages/<span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">&gt; addPercent(percentages/<span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2%"</span>  <span class="string">"120.4%"</span> <span class="string">"33%"</span></div></pre></td></tr></table></figure>
<p>此时，为了更加方法，可以给<code>addPercent()</code>函数再添加一个参数，用于控制数字的乘或除，例如我们添加一个<code>mult</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">percentages &lt;- c(<span class="number">58.23</span>, <span class="number">120.4</span>, <span class="number">33</span>)</div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">addPercent(decimalstages, mult = <span class="number">100</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(percentages, mult = <span class="number">1</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"58.2 % "</span>  <span class="string">"120.4 % "</span> <span class="string">"33 % "</span>   </div><div class="line">&gt; addPercent(decimalstages, mult = <span class="number">100</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="设置默认值">设置默认值</h4>
<p>还以上面的案例为例说明一下，如果我们忘记了传递<code>mult</code>参数，那么就会出错，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">Error <span class="keyword">in</span> addPercent(decimalstages) : </div><div class="line">  argument <span class="string">"mult"</span> is missing, with no default</div></pre></td></tr></table></figure>
<p>为避免这种情况，可以为<code>mult</code>参数添加一个默认值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, digits = <span class="number">1</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.001</span>, <span class="number">0.123</span>, <span class="number">1.334</span>)</div><div class="line">addPercent(decimalstages)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"0.1 % "</span>   <span class="string">"12.3 % "</span>  <span class="string">"133.4 % "</span></div></pre></td></tr></table></figure>
<h4 id="三点参数">三点参数</h4>
<p>如果我们再为<code>addPercent()</code>函数添加一个参数用于控制保留的小数位置，此时就已经有了3个参数，参数已经比较多了，这样参数的传入列表会很长，R中为此有一个很好的解决方案，就是三点参数（<code>...</code>），其实从R的很多函数中我们就能看到这种形式，例如我们在<code>pheatmap</code>这个包中的<code>pheatmap()</code>这个函数中就能看到这种形式，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">pheatmap(mat, color = colorRampPalette(rev(brewer.pal(n = <span class="number">7</span>, name =</div><div class="line">  <span class="string">"RdYlBu"</span>)))(<span class="number">100</span>), kmeans_k = <span class="literal">NA</span>, breaks = <span class="literal">NA</span>, border_color = <span class="string">"grey60"</span>,</div><div class="line">  cellwidth = <span class="literal">NA</span>, cellheight = <span class="literal">NA</span>, scale = <span class="string">"none"</span>, cluster_rows = <span class="literal">TRUE</span>,</div><div class="line">  cluster_cols = <span class="literal">TRUE</span>, clustering_distance_rows = <span class="string">"euclidean"</span>,</div><div class="line">  clustering_distance_cols = <span class="string">"euclidean"</span>, clustering_method = <span class="string">"complete"</span>,</div><div class="line">  clustering_callback = identity2, cutree_rows = <span class="literal">NA</span>, cutree_cols = <span class="literal">NA</span>,</div><div class="line">  treeheight_row = ifelse((class(cluster_rows) == <span class="string">"hclust"</span>) || cluster_rows,</div><div class="line">  <span class="number">50</span>, <span class="number">0</span>), treeheight_col = ifelse((class(cluster_cols) == <span class="string">"hclust"</span>) ||</div><div class="line">  cluster_cols, <span class="number">50</span>, <span class="number">0</span>), legend = <span class="literal">TRUE</span>, legend_breaks = <span class="literal">NA</span>,</div><div class="line">  legend_labels = <span class="literal">NA</span>, annotation_row = <span class="literal">NA</span>, annotation_col = <span class="literal">NA</span>,</div><div class="line">  annotation = <span class="literal">NA</span>, annotation_colors = <span class="literal">NA</span>, annotation_legend = <span class="literal">TRUE</span>,</div><div class="line">  annotation_names_row = <span class="literal">TRUE</span>, annotation_names_col = <span class="literal">TRUE</span>,</div><div class="line">  drop_levels = <span class="literal">TRUE</span>, show_rownames = <span class="literal">T</span>, show_colnames = <span class="literal">T</span>, main = <span class="literal">NA</span>,</div><div class="line">  fontsize = <span class="number">10</span>, fontsize_row = fontsize, fontsize_col = fontsize,</div><div class="line">  angle_col = c(<span class="string">"270"</span>, <span class="string">"0"</span>, <span class="string">"45"</span>, <span class="string">"90"</span>, <span class="string">"315"</span>), display_numbers = <span class="literal">F</span>,</div><div class="line">  number_format = <span class="string">"%.2f"</span>, number_color = <span class="string">"grey30"</span>, fontsize_number = <span class="number">0.8</span></div><div class="line">  * fontsize, gaps_row = <span class="literal">NULL</span>, gaps_col = <span class="literal">NULL</span>, labels_row = <span class="literal">NULL</span>,</div><div class="line">  labels_col = <span class="literal">NULL</span>, filename = <span class="literal">NA</span>, width = <span class="literal">NA</span>, height = <span class="literal">NA</span>,</div><div class="line">  silent = <span class="literal">FALSE</span>, na_col = <span class="string">"#DDDDDD"</span>, <span class="keyword">...</span>)</div></pre></td></tr></table></figure>
<p>可以看到，最后就是三个点（<code>...</code>），说明参数列表还有，省略了。</p>
<p>现在使用这种三点参数来修改<code>addPercent()</code>函数，其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- round(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">decimalstages &lt;- c(<span class="number">0.3331</span>, <span class="number">0.13323</span>, <span class="number">1.33334</span>)</div><div class="line">addPercent(decimalstages, digits = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(decimalstages, digits = <span class="number">2</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"33.31 % "</span>  <span class="string">"13.32 % "</span>  <span class="string">"133.33 % "</span></div><div class="line">&gt; addPercent(decimalstages)</div><div class="line">[<span class="number">1</span>] <span class="string">"33 % "</span>  <span class="string">"13 % "</span>  <span class="string">"133 % "</span></div></pre></td></tr></table></figure>
<h3 id="将函数当作参数">将函数当作参数</h3>
<p>在R中，可以将函数当作参数，例如在<code>apply()</code>系列函数中就能遇到。在前面的案例中，<code>addPercent()</code>中使用了<code>round()</code>函数，但是如果我们想要使用其它的函数，例如<code>signif()</code>，那么就可以将这个函数当作参数，具体的实现形式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种形式下，在<code>percent &lt;- FUN(x*mult, ...)</code>这一步，默认情况下使用的是<code>round()</code>函数，如果要使用<code>signif()</code>这个函数，使用<code>addPercent()</code>时，直接在<code>FUN=</code>中直接添加上<code>signif</code>即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">x &lt;- c(<span class="number">0.1223</span>, <span class="number">0.8956</span>, <span class="number">0.4234</span>)</div><div class="line">addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(x, FUN=signif, digits = <span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"12.2 % "</span> <span class="string">"89.6 % "</span> <span class="string">"42.3 % "</span></div></pre></td></tr></table></figure>
<p>现在解释一下这个函数的调用过程：</p>
<ol style="list-style-type: decimal">
<li>向量<code>x</code>乘以<code>mult</code>（默认是100）；</li>
<li>R将<code>signif()</code>函数的代码传递给<code>FUN</code>参数，这样<code>FUN()</code>就成了<code>signif()</code>函数的一份拷贝，功能和行为都与之相同；</li>
<li>R接收参数<code>digits</code>并将其传递给<code>FUN()</code>。</li>
</ol>
<p>在这里需要注意的是，<code>FUN=signif</code>这个参数中,<code>signif</code>并没有添加小括号，如果添加了小括号，就是将<code>signif()</code>函数的调用结果而非函数本身赋值给参数<code>FUN</code>。</p>
<h3 id="匿名函数">匿名函数</h3>
<p>在上面的案例中，参数<code>FUN</code>其实可以传递各种参数，甚至也可以没有函数名称，直接复制代码即可，因此<code>FUN</code>参数除了使用函数名进行赋值外，还可以直接将代码放在<code>FUN</code>中，这种直接放代码的形式就是以匿名函数的方式进行传递的，所谓的匿名函数（<code>Anonymous Function</code>）就是指没有名称的函数，看下面的案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits, FUN = <span class="keyword">function</span>(x) round(x / sum(x) *<span class="number">100</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>其实还可以继续简化，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">addPercent(profits/sum(profits))</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; profits &lt;- c(<span class="number">2100</span>, <span class="number">1430</span>, <span class="number">3580</span>, <span class="number">5230</span>)</div><div class="line">&gt; addPercent(profits/sum(profits))</div><div class="line">[<span class="number">1</span>] <span class="string">"17 % "</span> <span class="string">"12 % "</span> <span class="string">"29 % "</span> <span class="string">"42 % "</span></div></pre></td></tr></table></figure>
<p>匿名函数的使用前提是，①函数本身代码很短，②只会使用一次，不会用在别的地方。</p>
<h3 id="函数匹配">函数匹配</h3>
<p>前面提到的“将函数作为参数”案例中，通过将函数名将代码传递一个参数，这就意味着，假如有一个与函数名相同的对象，就会出错，例如我们在调用<code>addPercent()</code>函数之前，再定义一个名为<code>round</code>的对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div></pre></td></tr></table></figure>
<p>此时再调用<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">Error <span class="keyword">in</span> FUN(x * mult, <span class="keyword">...</span>) : could not find <span class="keyword">function</span> <span class="string">"FUN"</span></div></pre></td></tr></table></figure>
<p>此时就出错了，因为R没有将<code>round()</code>函数传递给<code>FUN</code>，而是把向量<code>round</code>赋予给了<code>FUN</code>，为了避免这种情况，可以调用一下<code>match.fun()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">addPercent(round, FUN=round)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; round &lt;- c(<span class="number">0.45</span>, -<span class="number">0.45</span>, <span class="number">58.5</span>)</div><div class="line">&gt; addPercent(round, FUN=round)</div><div class="line">[<span class="number">1</span>] <span class="string">"45 % "</span>   <span class="string">"-45 % "</span>  <span class="string">"5850 % "</span></div></pre></td></tr></table></figure>
<p><code>match.fun</code>函数会查找与名称<code>round</code>相匹配的函数，并将代码复制给<code>FUN</code>，而不会找到<code>round</code>向量，另外，<code>match.fun()</code>还支持字符对象，例如<code>FUN='round'</code>这样传递参数也是有效的。</p>
<h2 id="处理作用域">处理作用域</h2>
<p>在前面的案例中，我们只使用了Workspace，也就是说，创建的每一个以对象都存在于整个环境中，这个环境被称为全局环境（Global Environment）。在前面的案例中，函数内部的 一些参数，例如x，mult和FUN并非都是创建在Workspace中的对象，它们是在函数内部创建的对象，这些变量在退出函数回到Workspace后都无法使用了，看下面的一个案例：</p>
<p>首选创建一个对象<code>x</code>和函数<code>test()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x &lt;- <span class="number">1</span>:<span class="number">5</span></div><div class="line">test &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">"This is x: "</span>, x, <span class="string">"\n"</span>)</div><div class="line">  rm(x)</div><div class="line">  cat(<span class="string">"This is x after removing it:"</span>, x, <span class="string">"\n"</span>)</div><div class="line">&#125;</div><div class="line">x</div><div class="line">test(<span class="number">5</span>:<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div><div class="line">&gt; test(<span class="number">5</span>:<span class="number">1</span>)</div><div class="line">This is x:  <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> </div><div class="line">This is x after removing it: <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></div></pre></td></tr></table></figure>
<p>从上面的案例可以发现，<code>test()</code>这个函数的功能就是接收一个参数<code>x</code>，输出到控制台，然后将其删除，并再次输出。函数内部虽然已经使用了<code>rm(x)</code>来删除这个<code>x</code>，但是<code>x</code>还是能输出，不过，两次输出的<code>x</code>内容并不一样。</p>
<h3 id="函数的检索路径">函数的检索路径</h3>
<p>在一个函数被调用时，它将首选创建一个临时的本地环境(Local Environment)，这个本地环境嵌套在全局环境中，这意味着本地环境中仍然可以访问全局环境内的对象。只要函数执行完毕，本地环境就会立即释放，同时其中的所有对象也会被销毁。</p>
<p>换一种说法就是：函数创建的环境始终位于调用它的环境之内，而调用它的环境被称为父环境(Parent Environment)。所以，当我们从Worksapce中通过脚本或命令行调用某个函数时，它的父环境恰好为全局环境。</p>
<p>下图就是<code>test()</code>函数调用的原理：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621203341.png">

</div>
<p>外层的大矩形表示全局环境，而内层的灰色矩形则表示test函数的本地环境。在全局环境中，我们将对象<code>x</code>赋值为<code>1:5</code>，而在调用函数内部，则另外创建了一个参数<code>x</code>，赋值为<code>5:1</code>，这个参数成为了本地环境中的一个对象。</p>
<p>当R在代码中发现了一个对象<code>x</code>时，它将首先检索本地环境。而恰好能够找到参数<code>x</code>，所以它将被用在第一次的<code>cat()</code>调用中，接下来一行，R移除了这个对象<code>x</code>。所以，当R到达第三行时，就再也找不到本地环境中的对象<code>x</code>了。</p>
<p>此时，R会顺序环境栈上移，到达全局环境，并在其中查找名为<code>x</code>的对象，由于其中也恰好有<code>x</code>，因此它将被用于第二次的<code>cat()</code>调用。</p>
<p>如果在函数内部使用<code>rm()</code>，在默认情况下，它只会删除位于函数中的对象，这可以避免在函数中使用更大范围数据集所带来的内存消耗风险，因为我们可以在使用这个对象后立即将其删除，而无需等待函数执行完毕。</p>
<h3 id="使用内部函数">使用内部函数</h3>
<p><code>test()</code>函数出现的调用全局环境对象的问题其实是没有意义的，因为我们从一开始就应该避免函数对全局环境对象的依赖。事实上，R背后隐藏的整个概念都不支持将全局变量应用到函数内部。R作为一门函数式编程语言，它的一个主要思想就是在于任何函数的输出结果都不能依赖于外部环境，而仅仅是由传入的参数决定。只要各个参数的值相同，结果就不会发生变化。这种操作的优势在于，有时候我们想要在某个函数内部重复地执行某种操作，但离开这个函数后，这一操作又是没有意义的。</p>
<p>假设我们要比较几盏灯在半供电和全供电时亮度的差异，而用来遮挡外面太阳光的窗帘又不能完全阻挡光线的进入，因此还需要测量日光提供的亮度，然后将灯光的测量结果减去日光的亮度，来修正最终的结果。</p>
<p>要计算半供电时的灯光效率，可以实现下面的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z)  - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>ccalculate.eff()</code>函数内部，可以看到有另外一个函数的定义：<code>min.base()</code>，这个函数定义在<code>calculate.eff()</code>函数的本地环境中，并且也会在离开函数时销毁，也就是说，它并不存在于Workspace内。</p>
<p>我们可以像下面这样调用这个函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">calculate.eff &lt;- <span class="keyword">function</span>(x, y, control)&#123;</div><div class="line">  min.base &lt;- <span class="keyword">function</span>(z) z - mean(control)</div><div class="line">  min.base(x) / min.base(y)</div><div class="line">&#125;</div><div class="line"></div><div class="line">half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">calculate.eff(half, full,nothing)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; half &lt;- c(<span class="number">2.23</span>, <span class="number">3.23</span>, <span class="number">1.48</span>)</div><div class="line">&gt; full &lt;- c(<span class="number">4.85</span>, <span class="number">4.995</span>, <span class="number">4.12</span>)</div><div class="line">&gt; nothing &lt;- c(<span class="number">0.14</span>, <span class="number">0.18</span>, <span class="number">0.56</span>, <span class="number">0.23</span>)</div><div class="line">&gt; calculate.eff(half, full,nothing)</div><div class="line">[<span class="number">1</span>] <span class="number">0.4270093</span> <span class="number">0.6258612</span> <span class="number">0.3129473</span></div></pre></td></tr></table></figure>
<p>从源代码中可以看到，<code>min.base()</code>的定义中使用了对象<code>control</code>，但这个对象并没有出现在函数的参数列表中，其原因可以看一下这个函数的调用过程，如下所示：</p>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190621205945.png">

</div>
<p>调用过程如下所示：</p>
<ol style="list-style-type: decimal">
<li>函数<code>calculate.eff()</code>创建了一个本地环境，包含对象<code>x</code>（其值为<code>fifty</code>），<code>y</code>（其值为<code>hundred</code>），<code>control</code>（值为<code>nothing</code>），以及函数<code>min.base()</code>；</li>
<li>函数<code>min.base()</code>在<code>calculate.eff()</code>函数内创建了一个新的本地环境，包含对象<code>z</code>，值为<code>x</code>；</li>
<li><code>min.base()</code>在<code>calculate.eff()</code>的环境内查找对象<code>control</code>，计算其中每个元素的平均值，并将<code>z</code>的每个元素减去这个平均值，之后返回结果；</li>
<li>与前一个过程相同，只是<code>z</code>的值换成了<code>y</code>。</li>
<li><code>3</code>和<code>4</code>的结果相除，结果返回到全局环境。</li>
</ol>
<p>本地环境所嵌入的环境实际上是函数被定义的地方，而非调用的地方。假设我们在<code>calculate.eff()</code>内使用<code>addPercent()</code>来格式化数字，那么<code>addPercent()</code>所创建的本地环境不会被嵌入在<code>calculate.eff()</code>中，而是在全局环境内，也就是<code>addPercent()</code>被定义的地方。</p>
<h3 id="方法分配">方法分配</h3>
<p>关于函数的另外一个问题就是函数的方法问题。因为理解了这方面的知识，才能理解函数如何能够根据传入参数的类型来确定返回不同的结果。R中有一个机制被称为<code>通用函数系统</code>（Generic Function System），它允许用户使用相同的名称调用不同的函数。</p>
<p>例如，当我们输出一个列表时，输出会以行的方式进行排列，当我们输出一个数据框的时候，则会以列的方式显示，由此可见，<code>print()</code>函数对待列表和数据框的方式是不同的，但是所用的函数却是一样的。</p>
<p>现在看一下<code>print()</code>函数的代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; print</div><div class="line"><span class="keyword">function</span> (x, <span class="keyword">...</span>) </div><div class="line">UseMethod(<span class="string">"print"</span>)</div><div class="line">&lt;bytecode: <span class="number">0x000000000d7d7150</span>&gt;</div><div class="line">&lt;environment: namespace:base&gt;</div></pre></td></tr></table></figure>
<p>最后两行可以忽略，它表示的是<code>外层空间</code>的东西，供R语言的高手使用，第1行可以看出来，<code>print()</code>这个函数的函数体只有一行代码。</p>
<p>像这种什么都不做，仅仅是将对象正确地传递给其他函数的函数被称为<code>通用函数</code>(<code>Generic Function</code>)。<code>print()</code>就是一个通用函数。真正完成实际工作的函数被称<code>方法</code>（<code>Methods</code>）。可见，所有的方法都是函数，但并不是每个函数都是方法。</p>
<h4 id="通过usemethod调用方法">通过<code>UseMethod</code>调用方法</h4>
<p><code>print()</code>仅靠那一行代码肯定是完成无法完成不同方式打印向量、数据框、列表等复杂任务的，真正完成的其实是<code>UseMethod()</code>这个函数，这个函数做的所有事情就是告诉R查找一个能够处理传入参数<code>x</code>类型相匹配的函数。R会完整地遍历定义的函数名称，查找以<code>print</code>形状，后面接一个点号加上对象类型名的函数。</p>
<p>我们也可以通过<code>apropos('print\\.')</code>的命令来实现这个过程，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&gt; apropos(<span class="string">'print\\.'</span>)</div><div class="line"> [<span class="number">1</span>] <span class="string">".rs.rnbHooks.print.html"</span>             <span class="string">".rs.rnbHooks.print.htmlwidget"</span>      </div><div class="line"> [<span class="number">3</span>] <span class="string">".rs.rnbHooks.print.knit_asis"</span>        <span class="string">".rs.rnbHooks.print.knit_image_paths"</span></div><div class="line"> [<span class="number">5</span>] <span class="string">".rs.rnbHooks.print.shiny.tag"</span>        <span class="string">".rs.rnbHooks.print.shiny.tag.list"</span>  </div><div class="line"> [<span class="number">7</span>] <span class="string">"print.AsIs"</span>                          <span class="string">"print.by"</span>                           </div><div class="line"> [<span class="number">9</span>] <span class="string">"print.condition"</span>                     <span class="string">"print.connection"</span>                   </div><div class="line">[<span class="number">11</span>] <span class="string">"print.data.frame"</span>                    <span class="string">"print.Date"</span>                         </div><div class="line">[<span class="number">13</span>] <span class="string">"print.default"</span>                       <span class="string">"print.difftime"</span>                     </div><div class="line">[<span class="number">15</span>] <span class="string">"print.Dlist"</span>                         <span class="string">"print.DLLInfo"</span>                      </div><div class="line">[<span class="number">17</span>] <span class="string">"print.DLLInfoList"</span>                   <span class="string">"print.DLLRegisteredRoutines"</span>        </div><div class="line">[<span class="number">19</span>] <span class="string">"print.eigen"</span>                         <span class="string">"print.factor"</span>                       </div><div class="line">[<span class="number">21</span>] <span class="string">"print.function"</span>                      <span class="string">"print.hexmode"</span>                      </div><div class="line">[<span class="number">23</span>] <span class="string">"print.libraryIQR"</span>                    <span class="string">"print.listof"</span>                       </div><div class="line">[<span class="number">25</span>] <span class="string">"print.NativeRoutineList"</span>             <span class="string">"print.noquote"</span>                      </div><div class="line">[<span class="number">27</span>] <span class="string">"print.numeric_version"</span>               <span class="string">"print.octmode"</span>                      </div><div class="line">[<span class="number">29</span>] <span class="string">"print.packageInfo"</span>                   <span class="string">"print.POSIXct"</span>                      </div><div class="line">[<span class="number">31</span>] <span class="string">"print.POSIXlt"</span>                       <span class="string">"print.proc_time"</span>                    </div><div class="line">[<span class="number">33</span>] <span class="string">"print.restart"</span>                       <span class="string">"print.rle"</span>                          </div><div class="line">[<span class="number">35</span>] <span class="string">"print.simple.list"</span>                   <span class="string">"print.srcfile"</span>                      </div><div class="line">[<span class="number">37</span>] <span class="string">"print.srcref"</span>                        <span class="string">"print.summary.table"</span>                </div><div class="line">[<span class="number">39</span>] <span class="string">"print.summary.warnings"</span>              <span class="string">"print.summaryDefault"</span>               </div><div class="line">[<span class="number">41</span>] <span class="string">"print.table"</span>                         <span class="string">"print.warnings"</span></div></pre></td></tr></table></figure>
<p><code>apropos()</code>括号内的引号之间可以添加正则表达式，这与<code>grep()</code>函数非常类似。假如我们要打印一个数据框，那么R将查找函数<code>print.data.frame()</code>，并使用它来打印作为参数传入的对象，我们可以手工调用这个函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">print(small.one)</div><div class="line">print.data.frame(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; print.data.frame(small.one)</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div></pre></td></tr></table></figure>
<p>函数的输出结果与调用通过的<code>print(small.one)</code>函数是完全相同的，因为<code>print()</code>将打印<code>small.one</code>的任务完全交给了<code>print.data.frame()</code>函数来完成。</p>
<h4 id="使用默认方法">使用默认方法</h4>
<p>对于列表来说，你可能会觉得<code>print.list()</code>函数承担了打印任务，但实际上<code>print.list()</code>函数并不存在，此时R会忽略对象的类型，直接调用默认方法<code>print.default()</code>来打印列表。</p>
<p>许多通过函数都有一个默认方法，当无法调用特定方法执行时将派上用场，如果存在默认方法，那么它的名称必然是函数名后面加点，再加上<code>default</code>。我们来看一下默认方法打印<code>small.one</code>这个变量的结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">print.default(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; print.default(small.one)</div><div class="line">$a</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span></div><div class="line"></div><div class="line">$b</div><div class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">1</span></div><div class="line"></div><div class="line">attr(,<span class="string">"class"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<h4 id="实现自己的通用函数">实现自己的通用函数</h4>
<p>用户自己也可以实现自己的通用函数。现在看前面的<code>addPercent()</code>函数，它的代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于<code>addPercent()</code>函数来说，传入的参数<code>x</code>不能是字符向量，因为它无法参与后面的乘法运算，但可以利用方法分配机制，实现一个特定的函数来处理这一问题，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的是，这里的对象不是向量，而是字符，同样的原理，之前那个<code>addPercent(0</code>函数也应该变成针对特定类型对象的方法，将名称改为<code>addPercent.numeric</code>。在实现方法分配时，如果代码不是过长，应该尽量把所有函数的实现放在同一个脚本文件中，这样只要运行一个脚本，就可以使用完整的函数功能。</p>
<p>接着定义最外层的<code>addPercent()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>函数只定义了两个参数，<code>x</code>和<code>...</code>，<code>...</code>参数确保在<code>addPercent.numeric()</code>函数中使用的其它参数依然有效，这些附加参数将会原封不动地传递给内部调用的函数。当把完整的脚本文件发送给控制台后，就哦可以向<code>addPercent()</code>函数传入字符向量或数值向量了，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">Error <span class="keyword">in</span> UseMethod(<span class="string">"addPercent"</span>) : </div><div class="line">  no applicable method <span class="keyword">for</span> <span class="string">'addPercent'</span> applied to an object of class <span class="string">"data.frame"</span></div></pre></td></tr></table></figure>
<p>其中，<code>addPercent(small.one)</code>这行代码出错。出错的信息显示，没有适当的方法用于处理传入的数据框，此时 们还可以修改这种错误提示，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码的功能在于显示一条信息，这条信息相对于R默认的错误信息更容易理解，现在运行完整代码，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">addPercent.character &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  paste(x, <span class="string">"%"</span>, sep=<span class="string">""</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.numeric &lt;- <span class="keyword">function</span>(x, mult=<span class="number">100</span>, FUN=round, <span class="keyword">...</span>)&#123;</div><div class="line">  FUN &lt;- match.fun(FUN)</div><div class="line">  percent &lt;- FUN(x*mult, <span class="keyword">...</span>)</div><div class="line">  result &lt;- paste(percent, <span class="string">"%"</span>, setp=<span class="string">""</span>)</div><div class="line">  <span class="keyword">return</span>(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent &lt;- <span class="keyword">function</span>(x, <span class="keyword">...</span>)&#123;</div><div class="line">  UseMethod(<span class="string">"addPercent"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">addPercent.default &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  cat(<span class="string">'You should try a numeric or character vector.\n'</span>)</div><div class="line">&#125;</div><div class="line">new.numbers &lt;- c(<span class="number">0.82</span>,<span class="number">0.022</span>, <span class="number">1.62</span>, <span class="number">0.4</span>)</div><div class="line">addPercent(new.numbers,FUN=floor)</div><div class="line">addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">small.one</div><div class="line">addPercent(small.one)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; addPercent(new.numbers,FUN=floor)</div><div class="line">[<span class="number">1</span>] <span class="string">"82 % "</span>  <span class="string">"2 % "</span>   <span class="string">"162 % "</span> <span class="string">"40 % "</span> </div><div class="line">&gt; addPercent(letters[<span class="number">1</span>:<span class="number">6</span>])</div><div class="line">[<span class="number">1</span>] <span class="string">"a%"</span> <span class="string">"b%"</span> <span class="string">"c%"</span> <span class="string">"d%"</span> <span class="string">"e%"</span> <span class="string">"f%"</span></div><div class="line">&gt; small.one &lt;- data.frame(a = <span class="number">1</span>:<span class="number">2</span>, b = <span class="number">2</span>:<span class="number">1</span>)</div><div class="line">&gt; small.one</div><div class="line">  a b</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line">&gt; addPercent(small.one)</div><div class="line">You should <span class="keyword">try</span> a numeric or character vector.</div></pre></td></tr></table></figure>
<h2 id="函数返回多个结果">函数返回多个结果</h2>
<p>当函数需要返回多个结果时，通常用<code>list</code>的形式返回结果，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vms = <span class="keyword">function</span>(x)&#123;</div><div class="line">  xx=rev(sort(x)) </div><div class="line"><span class="comment"># 对向量x从小到大排序，然后用ver()转换为从大到小排序</span></div><div class="line">  xx=xx[<span class="number">1</span>:<span class="number">5</span>]</div><div class="line"><span class="comment"># 提取前5个元素</span></div><div class="line">  mean(xx)</div><div class="line"><span class="comment">#求均值</span></div><div class="line">  <span class="keyword">return</span>(list(xbar=mean(xx),top5=xx))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行后如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; y &lt;- c(12,4,65,22,33,123,322,90)</div><div class="line">&gt; vms(y)</div><div class="line">$xbar</div><div class="line">[1] 126.6</div><div class="line"></div><div class="line">$top5</div><div class="line">[1] 322 123  90  65  33</div></pre></td></tr></table></figure>
<h2 id="optimize解函数方程"><code>optimize()</code>解函数方程</h2>
<p>用到的函数是<code>optimize()</code>，先看一个案例：</p>
<p>经济学的一个基本模型就是随着价格上涨，产品的销量会下降，可以使用如下的函数来表示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div></pre></td></tr></table></figure>
<p>那么期望收益就是产品价格与销量的乘积，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div></pre></td></tr></table></figure>
<p>现在使用<code>curve()</code>函数将这两个函数画出来，它接收一个函数作为参数，并绘制出一定范围内的函数图像，我们假设定价范围在50美元到60美元之间，那么这个图像如下所示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sales &lt;- <span class="keyword">function</span>(price) &#123;<span class="number">100</span> - <span class="number">0.5</span>*price&#125;</div><div class="line">revenue &lt;- <span class="keyword">function</span>(price) &#123;price*sales(price)&#125;</div><div class="line">par(mfrow = c(<span class="number">1</span>, <span class="number">2</span>))</div><div class="line">curve(sales, from = <span class="number">50</span>, to = <span class="number">150</span>, xname=<span class="string">"price"</span>, ylab= <span class="string">"Sales"</span>, main=<span class="string">"Sales"</span>)</div><div class="line">curve(revenue, from=<span class="number">50</span>, to=<span class="number">150</span>, xname=<span class="string">"price"</span>, ylab=<span class="string">"Revenue"</span>, main=<span class="string">"Revenue"</span>)</div><div class="line">par(mfrow=c(<span class="number">1</span>,<span class="number">2</span>))</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190617074809.png">

</div>
<p>从上图的右图可以看出来，收益明显有一个最高点，因此现在使用R中的<code>optimize()</code>函数计算出这个最大值，如果要使用<code>optimize()</code>这个函数，要输入它目标函数（这里是<code>revenue()</code>)和区间（这里是<code>50~150</code>），默认情况下，<code>optimize()</code>计算的是最小值，但此时我们要计算最大值，就需要调整一下，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; optimise(revenue, interval = c(<span class="number">50</span>, <span class="number">150</span>), maximum = <span class="literal">TRUE</span>)</div><div class="line">$maximum</div><div class="line">[<span class="number">1</span>] <span class="number">100</span></div><div class="line"></div><div class="line">$objective</div><div class="line">[<span class="number">1</span>] <span class="number">5000</span></div></pre></td></tr></table></figure>
<h2 id="replicate函数"><code>replicate()</code>函数</h2>
<p><code>replicate</code>函数与<code>rep</code>函数类似，<code>rep</code>函数的功能是将一个参数重复数次，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; rep(<span class="number">1</span>,<span class="number">4</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></div><div class="line">&gt; rep(c(<span class="number">1</span>,<span class="number">4</span>),<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<p>而<code>replicate</code>函数则是把某个表达式重复计算数次，多数情况下，它们的计算结果都相同，除非是使用了随机数时才有可能不同，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; replicate(<span class="number">5</span>, runif(<span class="number">1</span>))</div><div class="line">[<span class="number">1</span>] <span class="number">0.7306532</span> <span class="number">0.8837189</span> <span class="number">0.5781437</span> <span class="number">0.2151454</span> <span class="number">0.4487271</span></div><div class="line">&gt; rep(runif(<span class="number">1</span>),<span class="number">5</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span> <span class="number">0.7360304</span></div></pre></td></tr></table></figure>
<p><code>replicate</code>函数的这种功能在比较复杂的例子中使用很广，例如Monte Carlo个分析中。</p>
<p>现在看一个比较简单的案例。</p>
<p>在这个案例中，我们会分析某人上下班时使用不同交通工具所花费的时间，我们在这个案例中会创建一个<code>time_for_commute</code>函数，这个函数用<code>sample</code>随机挑选一种交通工具（小汽车、公交车或自行车），然后使用<code>rnorm</code>或<code>rlnorm</code>找到一个正态分布或对数正态分布的行程时间，代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">time_for_commute &lt;- <span class="keyword">function</span>()&#123;</div><div class="line">  <span class="comment"># select communication tool</span></div><div class="line">  mode_of_transport &lt;- sample(</div><div class="line">    c(<span class="string">"car"</span>, <span class="string">"bus"</span>, <span class="string">"train"</span>, <span class="string">"bike"</span>),</div><div class="line">    size = <span class="number">1</span>,</div><div class="line">    prob = c(<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">0.4</span>)</div><div class="line">)</div><div class="line">  time &lt;- <span class="keyword">switch</span>(</div><div class="line">    mode_of_transport,</div><div class="line">    car = rlnorm(<span class="number">1</span>, log(<span class="number">30</span>), <span class="number">0.5</span>),</div><div class="line">    bus = rlnorm(<span class="number">1</span>, log(<span class="number">40</span>), <span class="number">0.5</span>),</div><div class="line">    train = rnorm(<span class="number">1</span>, <span class="number">30</span>, <span class="number">10</span>),</div><div class="line">    bike = rnorm(<span class="number">1</span>, <span class="number">60</span>, <span class="number">5</span>))</div><div class="line">  names(time) &lt;- mode_of_transport</div><div class="line">  time</div><div class="line">&#125;</div><div class="line"></div><div class="line">replicate(<span class="number">5</span>, time_for_commute())</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; replicate(<span class="number">5</span>, time_for_commute())</div><div class="line">   train      bus      bus     bike      bus </div><div class="line"><span class="number">56.38663</span> <span class="number">53.76305</span> <span class="number">29.99244</span> <span class="number">60.87293</span> <span class="number">98.38907</span></div></pre></td></tr></table></figure>
<p>代码解释：<code>switch</code>语句很难使这个函数被量化，这就说明，为了找到上下班时间的分布，我们需要多次调用<code>time_for_commute</code>来生成每天的数据。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey [法] Andrie de Vries 著</li>
<li>学习R.[美] Richard，Cotton 著刘军 译</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/08/R/字符串与日期与格式化代码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/08/R/字符串与日期与格式化代码/" itemprop="url">R语言笔记之字符串-日期-格式化代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-08T12:00:00+08:00">
                2017-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,236
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="字符串常用函数">字符串常用函数</h2>
<p>is.character()：判断是否是字符串； nchar()：有几个字符； length()：变量的长度 如下所示</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="string">"Hello, World!"</span>;x</div><div class="line">[<span class="number">1</span>] <span class="string">"Hello, World!"</span></div><div class="line">&gt; is.character(x)</div><div class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></div><div class="line">&gt; length(x)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line">&gt; nchar(x)</div><div class="line">[<span class="number">1</span>] <span class="number">13</span></div><div class="line">&gt; x2 &lt;- c(<span class="string">"Hello"</span>,<span class="string">"World!"</span>)</div><div class="line">&gt; length(x2)</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line">&gt; nchar(x2)</div><div class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">6</span></div></pre></td></tr></table></figure>
<h2 id="内置数据集"> 内置数据集</h2>
<p>R中有两个内置数据集，分别为LETTERS和letters，分别为大写字母和小写字母，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; letters</div><div class="line"> [<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span> <span class="string">"f"</span> <span class="string">"g"</span> <span class="string">"h"</span> <span class="string">"i"</span> <span class="string">"j"</span> <span class="string">"k"</span> <span class="string">"l"</span> <span class="string">"m"</span> <span class="string">"n"</span> <span class="string">"o"</span> <span class="string">"p"</span> <span class="string">"q"</span> <span class="string">"r"</span> <span class="string">"s"</span> <span class="string">"t"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"u"</span> <span class="string">"v"</span> <span class="string">"w"</span> <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; LETTERS</div><div class="line"> [<span class="number">1</span>] <span class="string">"A"</span> <span class="string">"B"</span> <span class="string">"C"</span> <span class="string">"D"</span> <span class="string">"E"</span> <span class="string">"F"</span> <span class="string">"G"</span> <span class="string">"H"</span> <span class="string">"I"</span> <span class="string">"J"</span> <span class="string">"K"</span> <span class="string">"L"</span> <span class="string">"M"</span> <span class="string">"N"</span> <span class="string">"O"</span> <span class="string">"P"</span> <span class="string">"Q"</span> <span class="string">"R"</span> <span class="string">"S"</span> <span class="string">"T"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"U"</span> <span class="string">"V"</span> <span class="string">"W"</span> <span class="string">"X"</span> <span class="string">"Y"</span> <span class="string">"Z"</span></div><div class="line">&gt; letters[<span class="number">2</span>:<span class="number">5</span>]</div><div class="line">[<span class="number">1</span>] <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span></div><div class="line">&gt; LETTERS[<span class="number">4</span>:<span class="number">9</span>]</div><div class="line">[<span class="number">1</span>] <span class="string">"D"</span> <span class="string">"E"</span> <span class="string">"F"</span> <span class="string">"G"</span> <span class="string">"H"</span> <span class="string">"I"</span></div></pre></td></tr></table></figure></p>
<h2 id="字符串的连接和分离">字符串的连接和分离</h2>
<h3 id="字符串的分离strsplit"> 字符串的分离<code>strsplit()</code></h3>
<p><code>strsplit()</code>函数用于分离字符串，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">pangram &lt;- <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">pangram</div><div class="line">length(pangram)</div><div class="line">str(pangram)</div><div class="line">pangram_split &lt;- strsplit(pangram, <span class="string">" "</span>)</div><div class="line">pangram_split</div><div class="line">length(pangram_split[[<span class="number">1</span>]])</div><div class="line">str(pangram_split)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; pangram &lt;- <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; pangram</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; length(pangram)</div><div class="line">[<span class="number">1</span>] <span class="number">1</span></div><div class="line">&gt; str(pangram)</div><div class="line"> chr <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; pangram_split &lt;- strsplit(pangram, <span class="string">" "</span>)</div><div class="line">&gt; pangram_split</div><div class="line">[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="string">"The"</span>   <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"over"</span>  <span class="string">"the"</span>   <span class="string">"lazy"</span>  <span class="string">"dog"</span>  </div><div class="line"></div><div class="line">&gt; length(pangram_split[[<span class="number">1</span>]])</div><div class="line">[<span class="number">1</span>] <span class="number">9</span></div><div class="line">&gt; str(pangram_split)</div><div class="line">List of <span class="number">1</span></div><div class="line"> $ : chr [<span class="number">1</span>:<span class="number">9</span>] <span class="string">"The"</span> <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span> <span class="keyword">...</span></div></pre></td></tr></table></figure>
<h3 id="字符串的连接paste"> 字符串的连接<code>paste()</code></h3>
<p>字符串的连接用的是paste函数，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(c(<span class="string">"hello"</span>,<span class="string">"world"</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"hello"</span> <span class="string">"world"</span></div></pre></td></tr></table></figure></p>
<p>在为某些数据添加新的一列，进行分组时，很有用，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; myvars&lt;-paste(<span class="string">"q"</span>,<span class="number">1</span>:<span class="number">5</span>,sep=<span class="string">""</span>) <span class="comment"># 将q分别与1到5这五个数字连接起来</span></div><div class="line">&gt; myvars</div><div class="line">[<span class="number">1</span>] <span class="string">"q1"</span> <span class="string">"q2"</span> <span class="string">"q3"</span> <span class="string">"q4"</span> <span class="string">"q5"</span></div></pre></td></tr></table></figure>
<h3 id="字符串连接的注意事项"> 字符串连接的注意事项</h3>
<p>以字符串的分离结果为数据进行连接，结果如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(result_split,collapse=<span class="string">" "</span>)-&gt;x3;x3</div><div class="line">[<span class="number">1</span>] <span class="string">"c(\"The\", \"quick\", \"brown\", \"fox\", \"jumps\", \"over\", \"the\", \"lazy\", \"dog\")"</span></div></pre></td></tr></table></figure></p>
<p>会发现字符之间出现的斜杠，原理如下： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">List of <span class="number">1</span></div><div class="line"> $ : chr [<span class="number">1</span>:<span class="number">9</span>] <span class="string">"The"</span> <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span> <span class="keyword">...</span></div><div class="line">&gt; result_split[[<span class="number">1</span>]]</div><div class="line">[<span class="number">1</span>] <span class="string">"The"</span>   <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"over"</span>  <span class="string">"the"</span>   <span class="string">"lazy"</span>  <span class="string">"dog"</span>  </div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">" "</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; str(result_split) </div><div class="line">List of <span class="number">1</span></div><div class="line"> $ : chr [<span class="number">1</span>:<span class="number">9</span>] <span class="string">"The"</span> <span class="string">"quick"</span> <span class="string">"brown"</span> <span class="string">"fox"</span> <span class="keyword">...</span></div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">" "</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The quick brown fox jumps over the lazy dog"</span></div><div class="line">&gt; paste(result_split[[<span class="number">1</span>]],collapse = <span class="string">"*"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"The*quick*brown*fox*jumps*over*the*lazy*dog"</span></div></pre></td></tr></table></figure></p>
<p>因为分离后的字符串结果为列表（list），对列表直接用paste进行连接时，容易出现这种情况，因此要对列表的第1个元素进行连接才能避免这种情况。另外，在进行连接时主，要用于collapase参数，即用什么连接，案例中使用了空格与星号进行连接。</p>
<h3 id="同时调用sep和collapse进行连接"> 同时调用sep和collapse进行连接</h3>
<p>以下面的这个例子中，先使用sep对不同向量进行连接，然后用collapse进行连接。 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(LETTERS[<span class="number">1</span>:<span class="number">5</span>],<span class="number">1</span>:<span class="number">5</span>,sep=<span class="string">"_"</span>,collapse = <span class="string">"---"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"A_1---B_2---C_3---D_4---E_5"</span></div></pre></td></tr></table></figure></p>
<h3 id="paste创建有规律的变量名"> paste创建有规律的变量名</h3>
<p>创造含有sample1-5的五个元素的向量： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; paste(<span class="string">"Sample"</span>,<span class="number">1</span>:<span class="number">5</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"Sample 1"</span> <span class="string">"Sample 2"</span> <span class="string">"Sample 3"</span> <span class="string">"Sample 4"</span> <span class="string">"Sample 5"</span></div></pre></td></tr></table></figure></p>
<h2 id="字符的排序"> 字符的排序</h2>
<p>排序用sort(),如果要倒序，则添加<code>decreasing = TRUE</code>，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; sort(letters)</div><div class="line"> [<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span> <span class="string">"d"</span> <span class="string">"e"</span> <span class="string">"f"</span> <span class="string">"g"</span> <span class="string">"h"</span> <span class="string">"i"</span> <span class="string">"j"</span> <span class="string">"k"</span> <span class="string">"l"</span> <span class="string">"m"</span> <span class="string">"n"</span> <span class="string">"o"</span> <span class="string">"p"</span> <span class="string">"q"</span> <span class="string">"r"</span> <span class="string">"s"</span> <span class="string">"t"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"u"</span> <span class="string">"v"</span> <span class="string">"w"</span> <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; sort(letters,decreasing = <span class="literal">TRUE</span>)</div><div class="line"> [<span class="number">1</span>] <span class="string">"z"</span> <span class="string">"y"</span> <span class="string">"x"</span> <span class="string">"w"</span> <span class="string">"v"</span> <span class="string">"u"</span> <span class="string">"t"</span> <span class="string">"s"</span> <span class="string">"r"</span> <span class="string">"q"</span> <span class="string">"p"</span> <span class="string">"o"</span> <span class="string">"n"</span> <span class="string">"m"</span> <span class="string">"l"</span> <span class="string">"k"</span> <span class="string">"j"</span> <span class="string">"i"</span> <span class="string">"h"</span> <span class="string">"g"</span></div><div class="line">[<span class="number">21</span>] <span class="string">"f"</span> <span class="string">"e"</span> <span class="string">"d"</span> <span class="string">"c"</span> <span class="string">"b"</span> <span class="string">"a"</span></div><div class="line">&gt; sort(result_split[[<span class="number">1</span>]])</div><div class="line">[<span class="number">1</span>] <span class="string">"brown"</span> <span class="string">"dog"</span>   <span class="string">"fox"</span>   <span class="string">"jumps"</span> <span class="string">"lazy"</span>  <span class="string">"over"</span>  <span class="string">"quick"</span> <span class="string">"the"</span>   <span class="string">"The"</span></div></pre></td></tr></table></figure></p>
<h2 id="查找文本"> 查找文本</h2>
<p>所用的案例是美国州的名字，数据集为state.name，如果要获取字符串的子字符串，则有2种方法，分别为： 1. 通过位置：例如让R返回从第5个位置开始的紧接的第3个字母。 2. 通过模式，例如返回匹配某个模式的子集。</p>
<h3 id="通过位置查询"> 通过位置查询</h3>
<p>此函数为substr，现在返回state.name中各个元素的第3到第6的子字符串，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; head(state.name)</div><div class="line">[<span class="number">1</span>] <span class="string">"Alabama"</span>    <span class="string">"Alaska"</span>     <span class="string">"Arizona"</span>    <span class="string">"Arkansas"</span>   <span class="string">"California"</span> <span class="string">"Colorado"</span>  </div><div class="line">&gt; head(substr(state.name, start = <span class="number">3</span>,<span class="keyword">stop</span>=<span class="number">6</span>))</div><div class="line">[<span class="number">1</span>] <span class="string">"abam"</span> <span class="string">"aska"</span> <span class="string">"izon"</span> <span class="string">"kans"</span> <span class="string">"lifo"</span> <span class="string">"lora"</span></div></pre></td></tr></table></figure></p>
<h3 id="通过模式查找匹配字符串"> 通过模式查找匹配字符串</h3>
<p>grep()函数可提取子字符串，它需要2个参数： 1. pattern：想要查询的模式； 2. x：被查询的向量。</p>
<p><strong>需要注意的是grep()函数区分大小写</strong> 现在查找名称中含有“New”的州，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; grep(<span class="string">"New"</span>,state.name)</div><div class="line">[<span class="number">1</span>] <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></div><div class="line">&gt; grep(<span class="string">"new"</span>,state.name)</div><div class="line">integer(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>返回的是数值变量，它表示的是元素的位置，例如： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; grep(<span class="string">"New"</span>,state.name)</div><div class="line">[<span class="number">1</span>] <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></div><div class="line">&gt; state.name[c(<span class="number">29</span>,<span class="number">30</span>)]</div><div class="line">[<span class="number">1</span>] <span class="string">"New Hampshire"</span> <span class="string">"New Jersey"</span></div></pre></td></tr></table></figure></p>
<p>可以直接返回元素，如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; state.name[grep(<span class="string">"New"</span>,state.name)]</div><div class="line">[<span class="number">1</span>] <span class="string">"New Hampshire"</span> <span class="string">"New Jersey"</span>    <span class="string">"New Mexico"</span>    <span class="string">"New York"</span></div></pre></td></tr></table></figure></p>
<h3 id="文本替换"> 文本替换</h3>
<p>sub()函数可以用于检索文本中的特定模式，并将其替换为其它的文本； gsub()可以实现所有的替换功能，它的三个参数为：查找的字符串，替换的字符串与被修改的文本。 例如替换A real world is cute中的cute与ugly: <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x1 &lt;- <span class="string">"A real world is cute."</span></div><div class="line">x1</div><div class="line">gsub(<span class="string">"cute"</span>,<span class="string">"ugly"</span>,x1)</div></pre></td></tr></table></figure></p>
<h4 id="子字符串的提取案例之一"> 子字符串的提取案例之一：</h4>
<p>一个向量，包含3个文件名，分别为file_a.csv，file_b.csv，file_c.csv，现在要提取这3个文件名中的a、b和c，需要用两个步骤，分别为： 1. 将字符串“file_”替换为空格； 2. 将“.csv”去掉，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="string">"file_a.csv"</span>,<span class="string">"file_b.csv"</span>,<span class="string">"file_c.csv"</span>)</div><div class="line">&gt; y &lt;- gsub(<span class="string">"file_"</span>,<span class="string">""</span>,x);y</div><div class="line">[<span class="number">1</span>] <span class="string">"a.csv"</span> <span class="string">"b.csv"</span> <span class="string">"c.csv"</span></div><div class="line">&gt; gsub(<span class="string">".csv"</span>,<span class="string">""</span>,y)</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span></div></pre></td></tr></table></figure>
<h2 id="大小写转换toupper与tolower">大小写转换toupper()与tolower()</h2>
<p>所用到的函数是<code>toupper()</code>与<code>tolower()</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="string">"word"</span>)</div><div class="line">&gt; toupper(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"WORD"</span></div><div class="line">&gt; x &lt;- c(<span class="string">"word"</span>)</div><div class="line">&gt; y &lt;- c(<span class="string">"Excel"</span>)</div><div class="line">&gt; toupper(x)</div><div class="line">[<span class="number">1</span>] <span class="string">"WORD"</span></div><div class="line">&gt; tolower(y)</div><div class="line">[<span class="number">1</span>] <span class="string">"excel"</span></div></pre></td></tr></table></figure>
<h2 id="日期格式的创建"> 日期格式的创建</h2>
<p>日期通常以字符串的形式输入到R中，然后转化为数值形式存储的日期变量，函数as.Date()用于执行这种转化，其语法为<code>as.Date(x, &quot;input_format&quot;)</code>，其中x是 字符型数据，input_format则是读入日期的适当格式。</p>
<p>其格式如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">%d 数字表示的日期（<span class="number">0</span>~<span class="number">31</span>） 例如<span class="number">01</span>~<span class="number">31</span></div><div class="line">%a 缩写的星期名 例如Mon</div><div class="line">%A 非缩写的星期名 例如Monday</div><div class="line">%m 月份（<span class="number">00</span>~<span class="number">12</span>） 例如<span class="number">00</span>~<span class="number">12</span></div><div class="line">%b 缩写的月份 例如Jan</div><div class="line">%B 非缩写的月份 例如January</div><div class="line">%y 两位数的年份 例如<span class="number">07</span></div><div class="line">%Y 四位数的年份  例如<span class="number">2007</span></div></pre></td></tr></table></figure>
<p>默认的日期格式为yyyy-mm-dd，语句为： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mydates &lt;- as.Date(c(<span class="string">"2007-06-22"</span>,<span class="string">"2004-02-13"</span>))</div><div class="line">mydates</div><div class="line">str(mydates)</div></pre></td></tr></table></figure></p>
<p>结果如下： &gt; mydates &lt;- as.Date(c(“2007-06-22”,“2004-02-13”)) &gt; mydates &gt;[1] “2007-06-22” “2004-02-13” &gt; str(mydates) &gt; Date[1:2], format: “2007-06-22” “2004-02-13”</p>
<h3 id="weekdays函数"> weekdays()函数</h3>
<p>返回某个日期是星期几如下所示： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 格式转化</span></div><div class="line">​```r</div><div class="line">&gt; strDates &lt;- c("01/05/1965", "08/16/1975")</div><div class="line">&gt; dates &lt;- as.Date(strDates, "%m/%d/%Y")</div><div class="line">#输入的日期转化为对应日期，其中%m对应为月份，%d对应为日期，%Y对应为年</div><div class="line">&gt; dates</div><div class="line">[1] "1965-01-05" "1975-08-16"</div><div class="line">&gt; str(dates)</div><div class="line"> Date[1:2], format: "1965-01-05" "1975-08-16"</div></pre></td></tr></table></figure></p>
<h3 id="案例"> 案例：</h3>
<p>在leadership数据集中，日期是以mm/dd/yy的格式来表示的，现在将其转化为默认的yyyy-mm-dd格式，代码为： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; myformat &lt;- <span class="string">"%m/%d/%y"</span></div><div class="line">&gt; leadership$testDate &lt;- as.Date(leadership$testDate, myformat)</div><div class="line">&gt; leadership</div><div class="line">  managerID   testDate country gender age item1 item2 item3 item4 item5 stringsAsFactor</div><div class="line"><span class="number">1</span>         <span class="number">1</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">24</span>      US      M  <span class="number">32</span>     <span class="number">5</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">5</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">2</span>         <span class="number">2</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">28</span>      US      <span class="literal">F</span>  <span class="number">45</span>     <span class="number">3</span>     <span class="number">5</span>     <span class="number">2</span>     <span class="number">5</span>     <span class="number">5</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">3</span>         <span class="number">3</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">01</span>      UK      <span class="literal">F</span>  <span class="number">25</span>     <span class="number">3</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">5</span>     <span class="number">2</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">4</span>         <span class="number">4</span> <span class="number">2008</span>-<span class="number">10</span>-<span class="number">12</span>      UK      M  <span class="number">39</span>     <span class="number">3</span>     <span class="number">3</span>     <span class="number">4</span>    <span class="literal">NA</span>    <span class="literal">NA</span>           <span class="literal">FALSE</span></div><div class="line"><span class="number">5</span>         <span class="number">5</span> <span class="number">2009</span>-<span class="number">05</span>-<span class="number">01</span>      UK      <span class="literal">F</span>  <span class="literal">NA</span>     <span class="number">2</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">1</span>           <span class="literal">FALSE</span></div><div class="line">  agecat</div><div class="line"><span class="number">1</span>  Young</div><div class="line"><span class="number">2</span>  Young</div><div class="line"><span class="number">3</span>  Young</div><div class="line"><span class="number">4</span>  Young</div><div class="line"><span class="number">5</span>   &lt;<span class="literal">NA</span>&gt;</div></pre></td></tr></table></figure></p>
<h3 id="当前日期">当前日期</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; Sys.Date() <span class="comment"># 给出当前日期</span></div><div class="line">[<span class="number">1</span>] <span class="string">"2014-01-18"</span></div><div class="line">&gt; date() <span class="comment">#返回当前的日期和时间</span></div><div class="line">[<span class="number">1</span>] <span class="string">"Sat Jan 18 14:22:07 2014"</span></div><div class="line">&gt; today&lt;-Sys.Date()</div><div class="line">&gt; format(today,format = <span class="string">"%B %d %Y"</span>) <span class="comment"># 格式化当前日期</span></div><div class="line">[<span class="number">1</span>] <span class="string">"一月 18 2014"</span></div><div class="line">&gt; format(today,fomat =<span class="string">"%A"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"2014-01-18"</span></div></pre></td></tr></table></figure>
<h3 id="两个日期的相减">两个日期的相减</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; startdate &lt;- as.Date(<span class="string">"2004-02-12"</span>)</div><div class="line">&gt; enddate &lt;- as.Date(<span class="string">"2011-01-22"</span>)</div><div class="line">&gt; days &lt;-enddate - startdate;days <span class="comment"># 两个时间点之差</span></div><div class="line">Time difference of <span class="number">2536</span> days</div></pre></td></tr></table></figure>
<p>用difftime()来计算时间间隔，并以星期，天，时，分，秒来表示。 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; today &lt;- Sys.Date()</div><div class="line">&gt; dob &lt;- as.Date(<span class="string">"1956-10-12"</span>)</div><div class="line">&gt; difftime(today, dob, units=<span class="string">"weeks"</span>)</div><div class="line">Time difference of <span class="number">2988.143</span> weeks</div></pre></td></tr></table></figure></p>
<p>as.character(dates)用于将日期转化为字符型变量，其它与日期有关的函数可以查看help(as.Date),help(strftime)，与日期有关的包为lubridate，复杂日期计算有关 的包为fCalendar。</p>
<h2 id="格式化r代码format与sprintf">格式化R代码format()与sprintf()</h2>
<p>这一步通常是在计算了所有的数据之后进行的，主要用于输出一份报表，使输出的数据看起来比较整齐 ，例如我们可以设置小数点对齐，或指定固定的列宽，或者是添加一些货币符号，或百分号。</p>
<p>如果要实现上述功能，用到的函数就是<code>format()</code>，它可以将数字变成美观的文本需要注意的是，此时数字会转换为文本，也就是转换为字符串，因此这一步要在最后一步进行。<code>format()</code>的参数如下所示：</p>
<ul>
<li><code>trim</code>：逻辑值。FALSE表示通过添加空格现实现文本的右对齐；TRUE会去掉前面的空格；</li>
<li><code>digits</code>：控制显示的有效数字的个数；</li>
<li><code>nsmall</code>：小数点后最少显示多少个数字；</li>
<li><code>decimal.mark</code>：小数点的格式；</li>
<li><code>big.mark</code>：设置小数点前整数部分的分段符；</li>
<li><code>small.mark</code>：设置小数点后小数部分的分段符。</li>
</ul>
<h4 id="案例1fromat输出小数">案例1：<code>fromat()</code>输出小数</h4>
<p>看一个案例，我们要输出一个数字<code>12345.6789</code>，以<code>逗号作为小数点</code>，<code>空格作为整数部分的分段符</code>，<code>点号</code>作为小数部分的分段符（分段则是3个数字作为一段），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">format(<span class="number">12345.6789</span>, diits = <span class="number">9</span>, decimal.mark=<span class="string">","</span>,</div><div class="line">       big.mark = <span class="string">" "</span>, small.mark = <span class="string">"."</span>, small.interval = <span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; format(<span class="number">12345.6789</span>, diits = <span class="number">9</span>, decimal.mark=<span class="string">","</span>,</div><div class="line">+        big.mark = <span class="string">" "</span>, small.mark = <span class="string">"."</span>, small.interval = <span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"12 345,68"</span></div></pre></td></tr></table></figure>
<p>使用<code>print()</code>函数时，也可以使用<code>digits</code>参数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; print(<span class="number">11</span>/<span class="number">3</span>,digits=<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">3.67</span></div></pre></td></tr></table></figure>
<h4 id="案例2format输出列表">案例2：<code>format()</code>输出列表</h4>
<p>计算<code>mtcars</code>中某几列的平均值，并且以两位小数的形式将其输出，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x &lt;- colMeans(mtcars[,<span class="number">1</span>:<span class="number">4</span>])</div><div class="line">format(x, digits = <span class="number">2</span>, nsamll = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- colMeans(mtcars[,<span class="number">1</span>:<span class="number">4</span>])</div><div class="line">&gt; format(x, digits = <span class="number">2</span>, nsamll = <span class="number">2</span>)</div><div class="line">    mpg     cyl    disp      hp </div><div class="line"><span class="string">" 20.1"</span> <span class="string">"  6.2"</span> <span class="string">"230.7"</span> <span class="string">"146.7"</span></div></pre></td></tr></table></figure>
<h4 id="案例3sprintf添加百分号">案例3：<code>sprintf()</code>添加百分号<code>%</code></h4>
<p><code>sprintf</code>是一种能够使用输出的字符以C语言的风格进行格式化，<code>sprintf</code>的第一个参数包含字符串或数字变量的点位符，其他参数则将逐个代入这些占位符<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>。</p>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">y &lt;- seq(<span class="number">0.5</span>, <span class="number">0.55</span>, <span class="number">0.01</span>)</div><div class="line">sprintf(<span class="string">"%.1f %%"</span>, <span class="number">100</span>*y)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; sprintf(<span class="string">"%.1f %%"</span>, <span class="number">100</span>*y)</div><div class="line">[<span class="number">1</span>] <span class="string">"50.0 %"</span> <span class="string">"51.0 %"</span> <span class="string">"52.0 %"</span> <span class="string">"53.0 %"</span> <span class="string">"54.0 %"</span> <span class="string">"55.0 %"</span></div></pre></td></tr></table></figure>
<p>解释一下：<code>&quot;%.1f %%&quot;, 100*y</code>是用来格式化字符串的，这在C与Python中很常见，这是告诉函数要将哪此部分远的为变量，<code>%.1f</code>表示将传入的第一个值进行格式化，要求显示小数点后一位数字 ，<code>%%</code>则是表示输出一个<code>%</code>。</p>
<h4 id="案例4sprintf输出货币格式">案例4：<code>sprintf()</code>输出货币格式</h4>
<p>输出货币格式只需要在<code>sprintf()</code>函数中添加上一个<code>$</code>符号即可，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set.seed(<span class="number">1000</span>)</div><div class="line">z &lt;- <span class="number">1000</span>*runif(<span class="number">5</span>)</div><div class="line">sprintf(<span class="string">"$ %3.2f"</span>, z)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; set.seed(<span class="number">1000</span>)</div><div class="line">&gt; z &lt;- <span class="number">1000</span>*runif(<span class="number">5</span>)</div><div class="line">&gt; sprintf(<span class="string">"$ %3.2f"</span>, z)</div><div class="line">[<span class="number">1</span>] <span class="string">"$ 327.88"</span> <span class="string">"$ 758.85"</span> <span class="string">"$ 113.94"</span> <span class="string">"$ 690.76"</span> <span class="string">"$ 516.40"</span></div></pre></td></tr></table></figure>
<h4 id="案例5sprintf替换变量">案例5：<code>sprintf()</code>替换变量</h4>
<p>再看一个<code>sprintf()</code>函数的案例，这个在Python或C中会经常遇到：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">stuff &lt;- c(<span class="string">"bread"</span>, <span class="string">"cookies"</span>)</div><div class="line">price &lt;- c(<span class="number">2.1</span>, <span class="number">4</span>)</div><div class="line">sprintf(<span class="string">"%s costed $ %3.2f"</span>, stuff, price)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; stuff &lt;- c(<span class="string">"bread"</span>, <span class="string">"cookies"</span>)</div><div class="line">&gt; price &lt;- c(<span class="number">2.1</span>, <span class="number">4</span>)</div><div class="line">&gt; sprintf(<span class="string">"%s costed $ %3.2f"</span>, stuff, price)</div><div class="line">[<span class="number">1</span>] <span class="string">"bread costed $ 2.10"</span>   <span class="string">"cookies costed $ 4.00"</span></div></pre></td></tr></table></figure>
<h2 id="formatc使用c语言风格格式化数字"><code>formatC()</code>使用C语言风格格式化数字</h2>
<p><code>formatC</code>可以使用C语言风格来输出字符串，可以指定使用固定型或科学型的格式，小数的位数以及输出的宽度，无论使用哪种选项，输入都应该是numeric类型（包括数组），输出的是character字符向量或数组，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; pow &lt;- <span class="number">1</span>:<span class="number">3</span></div><div class="line">&gt; formatC(pow)</div><div class="line">[<span class="number">1</span>] <span class="string">"1"</span> <span class="string">"2"</span> <span class="string">"3"</span></div><div class="line">&gt; powers_of_e &lt;- exp(pow)</div><div class="line">&gt; powers_of_e</div><div class="line">[<span class="number">1</span>]  <span class="number">2.718282</span>  <span class="number">7.389056</span> <span class="number">20.085537</span></div><div class="line">&gt; formatC(powers_of_e)</div><div class="line">[<span class="number">1</span>] <span class="string">"2.718"</span> <span class="string">"7.389"</span> <span class="string">"20.09"</span></div><div class="line">&gt; formatC(powers_of_e,digits=<span class="number">3</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"2.72"</span> <span class="string">"7.39"</span> <span class="string">"20.1"</span></div><div class="line">&gt; formatC(powers_of_e,digits=<span class="number">3</span>,width = <span class="number">10</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"      2.72"</span> <span class="string">"      7.39"</span> <span class="string">"      20.1"</span></div></pre></td></tr></table></figure>
<h2 id="特殊字符">特殊字符</h2>
<p>有一些特殊字符可以被以包含在字符中，例如我们可以通过<code>\t</code>来插入一个制表符，下面我们使用<code>cat()</code>函数来输出这种特殊字符，这里不使用<code>print()</code>是因为print执行的额外转换动作会所制表符<code>\t</code>转换成反斜框和一个<code>t.</code>。cat的参数<code>fill = TRUE</code>使光标在一行结束后移动到下一行，如下所示<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; cat(<span class="string">"foo\tbar"</span>, fill=<span class="literal">TRUE</span>)</div><div class="line">foo	bar</div></pre></td></tr></table></figure>
<p>使用<code>\n</code>可以输出换行符，如下扬尘：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; cat(<span class="string">"foo\nbar"</span>, fill = <span class="literal">TRUE</span>)</div><div class="line">foo</div><div class="line">bar</div></pre></td></tr></table></figure>
<p>这里的转义字符与Python语言类似，不再多述。</p>
<h2 id="文件路径">文件路径</h2>
<p>参考<a href="http://rvdsd.top/2017/04/10/R/%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA/">《数据的导入与导出》</a>那篇笔记。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey</li>
</ol>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>学习R.[美] Richard，Cotton 著刘军 译<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>学习R.[美] Richard，Cotton 著刘军 译<a href="#fnref2">↩</a></p></li>
</ol>
</div>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/07/R/R包的操作与内置数据集/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/07/R/R包的操作与内置数据集/" itemprop="url">R语言笔记之包的操作与内置数据集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-07T12:00:00+08:00">
                2017-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,015
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  20
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="r语言包的安装">R语言包的安装</h2>
<p>在R中大概有几种包的安装方式。</p>
<h3 id="install.packages常规包的安装"><code>install.packages()</code>常规包的安装</h3>
<p>括号里面包的名称要加英文引号，在列出的CRAN镜像站点列表中选择一个进行下载，例如 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(“ggplot2”)</div></pre></td></tr></table></figure></p>
<p>安装包的时候可以切换安装源，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">install.packages(pkgs, lib, repos = getOption(&quot;repos&quot;),</div><div class="line">    contriburl = contrib.url(repos, type),</div><div class="line">    method, available = NULL, destdir = NULL,</div><div class="line">    dependencies = NA, type = getOption(&quot;pkgType&quot;),</div><div class="line">    configure.args = getOption(&quot;configure.args&quot;),</div><div class="line">    configure.vars = getOption(&quot;configure.vars&quot;),</div><div class="line">    clean = FALSE, Ncpus = getOption(&quot;Ncpus&quot;, 1L),</div><div class="line">    verbose = getOption(&quot;verbose&quot;),</div><div class="line">    libs_only = FALSE, INSTALL_opts, quiet = FALSE,</div><div class="line">    keep_outputs = FALSE, ...)</div></pre></td></tr></table></figure>
<p>使用格式为： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(&quot;ABC&quot;,repos=&quot;http://mirror.bjtu.edu.cn/ &quot;)</div></pre></td></tr></table></figure></p>
<h3 id="使用devtools从github上安装包">使用<code>devtools</code>从Github上安装包</h3>
<p>如果是要从GitHub上安装包，需要先安装<code>devtools</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"devtools"</span>)</div><div class="line">install_github(<span class="string">"genomicsclass/dagdata"</span>)</div></pre></td></tr></table></figure>
<p>其它的包安装命令，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"installr"</span>)   <span class="comment"># 下载并安装 installr 包</span></div><div class="line"><span class="keyword">library</span>(installr)              <span class="comment"># 装载 installr 包</span></div><div class="line">install.RStudio()              <span class="comment"># 下载并安装 RStudio IDE</span></div><div class="line">install.Rtools()               <span class="comment"># 你需要 Rtools 来构建自己的包</span></div><div class="line">install.git()                  <span class="comment">#git 提供了代码的版本控制功能</span></div></pre></td></tr></table></figure>
<p>如果要想把R包安装到其他位置，可以使用以下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">install.packages( </div><div class="line">  c(<span class="string">"xts"</span>, <span class="string">"zoo"</span>),</div><div class="line">  lib = <span class="string">"some/other/folder/to/install/to"</span>, </div><div class="line">  repos = <span class="string">"http://www.stats.bris.ac.uk/R/"</span> </div><div class="line">)</div></pre></td></tr></table></figure>
<p>其中<code>lib</code>参数就是安装的包的位置，<code>repos</code>就是安装源。</p>
<h3 id="通过bioclite来安装生信工具">通过<code>BiocLite</code>来安装生信工具</h3>
<p>生信很多工具是在<code>bioconductor</code>上，因此需要<code>biocLite</code>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span>(<span class="string">"https://bioconductor.org/biocLite.R"</span>)</div><div class="line">options(BioC_mirror=<span class="string">"http://mirrors.ustc.edu.cn/bioc/"</span>)</div><div class="line"><span class="comment"># 使用相应的镜像</span></div><div class="line">biocLite(c(<span class="string">"ALL"</span>,<span class="string">"CLL"</span>, <span class="string">"pasilla"</span>, <span class="string">"airway"</span>)) <span class="comment">#数据包</span></div><div class="line">biocLite(c(<span class="string">"limma"</span>,<span class="string">"DESeq2"</span>, <span class="string">"clusterProfiler"</span>)) <span class="comment">#软件包</span></div></pre></td></tr></table></figure>
<h3 id="通过biocmanager来安装生信工具">通过<code>BiocManager</code>来安装生信工具</h3>
<p>在使用<code>bioconductor</code>时由于需要在线连接才能安装包，现在很多已经使用<code>BiocManager</code>的方式来安装，安装代码如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">"BiocManager"</span>, quietly = <span class="literal">TRUE</span>))</div><div class="line">    install.packages(<span class="string">"BiocManager"</span>)</div><div class="line"></div><div class="line">BiocManager::install(<span class="string">"ballgown"</span>, version = <span class="string">"3.8"</span>)</div></pre></td></tr></table></figure>
<h3 id="批量下载并且加载r包">批量下载并且加载R包</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">list.of.packages &lt;- c(<span class="string">"xx"</span>, <span class="string">"yy"</span>) <span class="comment"># replace xx and yy with package names</span></div><div class="line">new.packages &lt;- list.of.packages[!(list.of.packages %<span class="keyword">in</span>% installed.packages()[,<span class="string">"Package"</span>])]</div><div class="line"><span class="keyword">if</span>(length(new.packages)) install.packages(new.packages)</div><div class="line">lapply(new.packages, <span class="keyword">require</span>, character.only=<span class="literal">T</span>)</div></pre></td></tr></table></figure>
<h3 id="使用if语句安装并加载包">使用if语句安装并加载包</h3>
<p>通过if语句，可以判断某个包是否存在，如果不存在，就先下载，后加载，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#另外可以检测某个包是否存在，只有不存在时才会安装</span></div><div class="line"><span class="keyword">if</span> (! <span class="keyword">require</span> (<span class="string">'reshape2'</span>))&#123;</div><div class="line">    install.package(<span class="string">"reshape2"</span>)</div><div class="line">    <span class="keyword">library</span>(reshape2)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果是bioconductor上的包，也可以按以下方式进行安装：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (! <span class="keyword">require</span> (<span class="string">'CLL'</span>))&#123;</div><div class="line">    options(BioC_mirror=<span class="string">"http://mirrors.ustc.edu.cn/bioc/"</span>)</div><div class="line">    BiocInstaller::biocLite(<span class="string">'CLL'</span>,ask = <span class="literal">F</span>, suppressUpdates = <span class="literal">T</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="包的加载">包的加载</h2>
<p>包的载入函数为<code>library()</code>或<code>require()</code>，安装完包后，需要加载才能使用其中的函数，此时括号中不使用引号。两者的不同之处在于library()载入之后不返回任何信息，而require()载入后则会返回TRUE，因此require()适合用于程序的书写。 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">require</span>(foreign)</div><div class="line">Loading required package: foreign</div></pre></td></tr></table></figure></p>
<p>如果想不加载包就使用其中的函数，则需要使用双冒号，即<code>::</code>，看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x &lt;- rnorm(<span class="number">1000</span>)</div><div class="line">skewness(x)</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; skewness(x)</div><div class="line">Error <span class="keyword">in</span> skewness(x) : could not find <span class="keyword">function</span> <span class="string">"skewness"</span></div></pre></td></tr></table></figure>
<p>结果显示，没有<code>skewness</code>这个函数，因为这个函数是<code>moments</code>包中的函数，没有加载这个包，就无法使用这个函数。现在我们在没有加载这个包的情况下，使用双冒号来看一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; moments::skewness(x) </div><div class="line">[<span class="number">1</span>] -<span class="number">0.01674</span></div></pre></td></tr></table></figure>
<p>再用<code>library()</code>来使用一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(moments)</div><div class="line">&gt; skewness(x)</div><div class="line">[<span class="number">1</span>] -<span class="number">0.01674</span></div></pre></td></tr></table></figure>
<p>使用双冒号这种方式在一种情况下比较适合。</p>
<p>这种情况就是：假设我们同时加载了A包与B包，A包中有一个名为<code>a()</code>的函数，B包中也有一个名为<code>a()</code>的函数。此时，如果先导入A包，再导入B包，B包中的<code>a()</code>函数就会屏蔽A包中的<code>a()</code>函数，也就是说，这两个同名函数就会出现冲突。</p>
<p>因此为了避免出现这种情况，可以不加载A包，也不加载B包，而是将它们的同名函数提取出来，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fun1 &lt;- A::a</div><div class="line">fun2 &lt;- B::a</div></pre></td></tr></table></figure>
<p>如果你此时已经恰好载入一个包，想要解决绑定，就可以使用<code>unloadNamespace()</code>函数即可，例如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unloadNamespace(<span class="string">"moments"</span>)</div></pre></td></tr></table></figure>
<h2 id="查看一个包的帮助">查看一个包的帮助</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">help(package=<span class="string">"base"</span>)</div></pre></td></tr></table></figure>
<h2 id="卸载包">卸载包</h2>
<p>detach()，这是library()的反向操作，此操作主要是为了避免某些包中的函数名称相同，造成冲突，注意与library()的参数不同，detach()参数为detach(package:包的名称),library(包的名称)，例如： <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2) <span class="comment">#加载包</span></div><div class="line">(.packages()) <span class="comment">#列出当前已经加载的包</span></div><div class="line"> [<span class="number">1</span>] <span class="string">"foreign"</span>   <span class="string">"ggplot2"</span>   <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>    </div><div class="line"> [<span class="number">7</span>] <span class="string">"datasets"</span>  <span class="string">"methods"</span>   <span class="string">"base"</span></div><div class="line"><span class="keyword">detach</span>(package:ggplot2)  <span class="comment">#卸载ggplot2包</span></div><div class="line">(.packages()) <span class="comment">#列出当前已经加载的包</span></div><div class="line"> [<span class="number">1</span>] <span class="string">"foreign"</span>   <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>     <span class="string">"datasets"</span> </div><div class="line"> [<span class="number">7</span>] <span class="string">"methods"</span>   <span class="string">"base"</span></div></pre></td></tr></table></figure></p>
<h3 id="删除包remove.packages">删除包<code>remove.packages()</code></h3>
<p>使用条件：R语言自带的<code>install.packages()</code>函数来安装一个包时，都是默认安装最新版的。 但是有些R包的开发者他会引用其它的一些R包，但是它用的是旧版本的功能，自己来不及更新或者疏忽了。 而我们又不得不用他的包，这时候就不得不卸载最新版包，转而安装旧版本包。</p>
<h2 id="查询加载的包">查询加载的包</h2>
<p>search() <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">search()</div><div class="line"> [<span class="number">1</span>] <span class="string">".GlobalEnv"</span>        <span class="string">"package:stats"</span>     <span class="string">"package:graphics"</span> </div><div class="line"> [<span class="number">4</span>] <span class="string">"package:grDevices"</span> <span class="string">"package:utils"</span>     <span class="string">"package:datasets"</span> </div><div class="line"> [<span class="number">7</span>] <span class="string">"package:methods"</span>   <span class="string">"Autoloads"</span>         <span class="string">"package:base"</span></div></pre></td></tr></table></figure></p>
<h2 id="libpaths能够显示库所在的位置">.libPaths()能够显示库所在的位置</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.libPaths()</div><div class="line"> [<span class="number">1</span>] <span class="string">"C:/Users/Cloud/Documents/R/win-library/3.1"</span></div><div class="line"> [<span class="number">2</span>] <span class="string">"C:/Program Files/R/R-3.1.3/library"</span></div></pre></td></tr></table></figure>
<h2 id="library显示库中有哪些包">library()显示库中有哪些包</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>()</div><div class="line">backports               Reimplementations of Functions Introduced Since</div><div class="line">                        R-<span class="number">3.0</span><span class="number">.0</span></div><div class="line">base64enc               Tools <span class="keyword">for</span> base64 encoding</div><div class="line">bitops                  Bitwise Operations</div><div class="line">bookdown                Authoring Books and Technical Documents with R</div><div class="line">                        Markdown</div><div class="line">caTools                 Tools: moving window statistics, GIF, Base64,</div><div class="line">                        ROC AUC, etc.</div><div class="line">cellranger              Translate Spreadsheet Cell Ranges to Rows and</div><div class="line">                        Columns</div><div class="line">digest                  Create Compact Hash Digests of R Objects</div><div class="line">evaluate                Parsing and Evaluation Tools that Provide More</div><div class="line">                        Details than the Default</div><div class="line"><span class="keyword">...</span></div><div class="line"><span class="keyword">...</span></div></pre></td></tr></table></figure>
<h3 id="查看已经安装的包">查看已经安装的包</h3>
<p>函数<code>installed.packages()</code></p>
<p>如下所示： <img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190712120619.png"></p>
<p>还可以这么输入代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pkgs &lt;- installed.packages()</div><div class="line">colnames(pkgs)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; pkgs &lt;- installed.packages()</div><div class="line">&gt; colnames(pkgs)</div><div class="line"> [<span class="number">1</span>] <span class="string">"Package"</span>               <span class="string">"LibPath"</span>               <span class="string">"Version"</span>              </div><div class="line"> [<span class="number">4</span>] <span class="string">"Priority"</span>              <span class="string">"Depends"</span>               <span class="string">"Imports"</span>              </div><div class="line"> [<span class="number">7</span>] <span class="string">"LinkingTo"</span>             <span class="string">"Suggests"</span>              <span class="string">"Enhances"</span>             </div><div class="line">[<span class="number">10</span>] <span class="string">"License"</span>               <span class="string">"License_is_FOSS"</span>       <span class="string">"License_restricts_use"</span></div><div class="line">[<span class="number">13</span>] <span class="string">"OS_type"</span>               <span class="string">"MD5sum"</span>                <span class="string">"NeedsCompilation"</span>     </div><div class="line">[<span class="number">16</span>] <span class="string">"Built"</span></div></pre></td></tr></table></figure>
<p>当需要检查包是否已经安装时，可以使用以下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c(<span class="string">"moments"</span>, <span class="string">"Built"</span>) %<span class="keyword">in</span>% installed.packages()[, <span class="string">"Package"</span>]</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; c(<span class="string">"moments"</span>, <span class="string">"Built"</span>) %<span class="keyword">in</span>% installed.packages()[, <span class="string">"Package"</span>]</div><div class="line">[<span class="number">1</span>]  <span class="literal">TRUE</span> <span class="literal">FALSE</span></div></pre></td></tr></table></figure>
<h3 id="查看包的版本">查看包的版本</h3>
<p>查看包的版本可以通过下面代码实现：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; installed.packages()[<span class="string">"ggplot2"</span>, <span class="string">"Version"</span>]</div><div class="line">[<span class="number">1</span>] <span class="string">"3.2.0"</span></div></pre></td></tr></table></figure>
<h2 id="包的更新update.packages">包的更新<code>update.packages()</code></h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update.packages()</div></pre></td></tr></table></figure>
<h2 id="查看本地的包">查看本地的包</h2>
<h3 id="查看默认加载的包忽略基本的包">查看默认加载的包，忽略基本的包</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; getOption(<span class="string">"defaultPackages"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"datasets"</span>  <span class="string">"utils"</span>     <span class="string">"grDevices"</span> <span class="string">"graphics"</span>  <span class="string">"stats"</span>     <span class="string">"methods"</span></div></pre></td></tr></table></figure>
<h3 id="查看当前已经加载过的包">查看当前已经加载过的包</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; (.packages())</div><div class="line">[<span class="number">1</span>] <span class="string">"stats"</span>     <span class="string">"graphics"</span>  <span class="string">"grDevices"</span> <span class="string">"utils"</span>     <span class="string">"datasets"</span>  <span class="string">"methods"</span></div><div class="line">[<span class="number">7</span>] <span class="string">"base"</span></div></pre></td></tr></table></figure>
<h2 id="显示所有可用的包">显示所有可用的包</h2>
<p>(.packages(all.available=TRUE)) <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">(.packages(all.available=<span class="literal">TRUE</span>))</div><div class="line">  [<span class="number">1</span>] <span class="string">"bitops"</span>       <span class="string">"car"</span>          <span class="string">"caTools"</span>      <span class="string">"coin"</span>        </div><div class="line">  [<span class="number">5</span>] <span class="string">"colorspace"</span>   <span class="string">"crayon"</span>       <span class="string">"curl"</span>         <span class="string">"dichromat"</span>   </div><div class="line">  [<span class="number">9</span>] <span class="string">"digest"</span>       <span class="string">"evaluate"</span>     <span class="string">"formatR"</span>      <span class="string">"fun"</span>         </div><div class="line"> [<span class="number">13</span>] <span class="string">"ggplot2"</span>      <span class="string">"gtable"</span>       <span class="string">"highr"</span>        <span class="string">"htmltools"</span>   </div><div class="line"> [<span class="number">17</span>] <span class="string">"httr"</span>         <span class="string">"ISwR"</span>         <span class="string">"jsonlite"</span>     <span class="string">"KMsurv"</span>      </div><div class="line"> [<span class="number">21</span>] <span class="string">"knitr"</span>        <span class="string">"labeling"</span>     <span class="string">"lme4"</span>         <span class="string">"magrittr"</span>    </div><div class="line"> [<span class="number">25</span>] <span class="string">"maps"</span>         <span class="string">"maptools"</span>     <span class="string">"markdown"</span>     <span class="string">"MatrixModels"</span></div><div class="line"> [<span class="number">29</span>] <span class="string">"memoise"</span>      <span class="string">"mime"</span>         <span class="string">"minqa"</span>        <span class="string">"mnormt"</span>      </div><div class="line"> [<span class="number">33</span>] <span class="string">"modeltools"</span>   <span class="string">"multcomp"</span>     <span class="string">"munsell"</span>      <span class="string">"mvtnorm"</span>     </div><div class="line"> [<span class="number">37</span>] <span class="string">"nloptr"</span>       <span class="string">"openssl"</span>      <span class="string">"pbkrtest"</span>     <span class="string">"plyr"</span>        </div><div class="line"> [<span class="number">41</span>] <span class="string">"praise"</span>       <span class="string">"psych"</span>        <span class="string">"quantreg"</span>     <span class="string">"R6"</span>          </div><div class="line"> [<span class="number">45</span>] <span class="string">"RColorBrewer"</span> <span class="string">"Rcpp"</span>         <span class="string">"RcppEigen"</span>    <span class="string">"RCurl"</span>       </div><div class="line"> [<span class="number">49</span>] <span class="string">"reshape2"</span>     <span class="string">"rmarkdown"</span>    <span class="string">"sandwich"</span>     <span class="string">"scales"</span>      </div><div class="line"> [<span class="number">53</span>] <span class="string">"sp"</span>           <span class="string">"SparseM"</span>      <span class="string">"stringi"</span>      <span class="string">"stringr"</span>     </div><div class="line"> [<span class="number">57</span>] <span class="string">"swirl"</span>        <span class="string">"testthat"</span>     <span class="string">"TH.data"</span>      <span class="string">"yaml"</span>        </div><div class="line"> [<span class="number">61</span>] <span class="string">"zoo"</span>          <span class="string">"base"</span>         <span class="string">"boot"</span>         <span class="string">"class"</span>       </div><div class="line"> [<span class="number">65</span>] <span class="string">"cluster"</span>      <span class="string">"codetools"</span>    <span class="string">"compiler"</span>     <span class="string">"datasets"</span>    </div><div class="line"> [<span class="number">69</span>] <span class="string">"foreign"</span>      <span class="string">"graphics"</span>     <span class="string">"grDevices"</span>    <span class="string">"grid"</span>        </div><div class="line"> [<span class="number">73</span>] <span class="string">"KernSmooth"</span>   <span class="string">"lattice"</span>      <span class="string">"MASS"</span>         <span class="string">"Matrix"</span>      </div><div class="line"> [<span class="number">77</span>] <span class="string">"methods"</span>      <span class="string">"mgcv"</span>         <span class="string">"nlme"</span>         <span class="string">"nnet"</span>        </div><div class="line"> [<span class="number">81</span>] <span class="string">"parallel"</span>     <span class="string">"rpart"</span>        <span class="string">"spatial"</span>      <span class="string">"splines"</span>     </div><div class="line"> [<span class="number">85</span>] <span class="string">"stats"</span>        <span class="string">"stats4"</span>       <span class="string">"survival"</span>     <span class="string">"tcltk"</span>       </div><div class="line"> [<span class="number">89</span>] <span class="string">"tools"</span>        <span class="string">"utils"</span></div></pre></td></tr></table></figure></p>
<h2 id="自定义启动时候的加载包">自定义启动时候的加载包</h2>
<p>如果需要长期使用某个包的话，每次开启都需要输入library()，比较麻烦，因此可以让R启动时自动加载某些包。在R的安装目录/etc/Rprofile.site加入下载语句：</p>
<p>例如让R启动时自动加载ggplot2包 <figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">local(&#123;old &lt;- getOption(“defaultPackages”)</div><div class="line">options(defaultPackages = c(old, “ggplot2”))&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="安装包并加载包">安装包，并加载包</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span>(!<span class="keyword">require</span>(<span class="string">"multcomp"</span>))&#123;</div><div class="line"></div><div class="line">  install.packages(<span class="string">"multcomp"</span>)</div><div class="line"></div><div class="line">  <span class="keyword">library</span>(multcomp)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="常用r包的搜集">常用R包的搜集</h2>
<h3 id="数据导入">数据导入</h3>
<p>以下R包主要用于数据导入和保存数据</p>
<ul>
<li><p>feather：一种快速，轻量级的文件格式。在R和python上都可使用</p></li>
<li><p>readr：实现表格数据的快速导入。中文介绍可参考这里</p></li>
<li><p>readxl：读取Microsoft Excel电子表格数据</p></li>
<li><p>openxlsx：读取Microsoft Excel电子表格数据</p></li>
<li><p>googlesheets：读取google电子表格数据</p></li>
<li><p>haven：读取SAS，SPSS和Stata统计软件格式的数据</p></li>
<li><p>httr：从网站开放的API中读取数据</p></li>
<li><p>rvest：网页数据抓取包</p></li>
<li><p>xml2：读取HTML和XML格式数据</p></li>
<li><p>webreadr：读取常见的Web日志格式数据</p></li>
<li><p>DBI：数据库管理系统通用接口包</p></li>
<li><ul>
<li>RMySQL：用于连接MySQL数据库的R包</li>
</ul></li>
<li>RPostgres：用于连接PostgreSQL数据库的R包</li>
<li><p>bigrquery用于连接Google BigQuery的R包</p></li>
<li><p>PivotalR：用于读取Pivitol（Greenplum）和HAWQ数据库中的数据</p></li>
<li><p>dplyr：提供了一个访问常见数据库的接口</p></li>
<li><p>data.table：data.table包的<code>fread()</code>函数可以快速读取大数据集</p></li>
<li><p>git2r：用于访问git仓库</p></li>
</ul>
<h3 id="数据整理">数据整理</h3>
<p>以下R包主要用于数据整理，以便于你后续建模分析：</p>
<ul>
<li>tidyr：用于整理表格数据的布局</li>
<li>dplyr：用于将多个数据表连接成一个整齐的数据集</li>
<li>purrr：函数式编程工具，在做数据整理时非常有用。</li>
<li>broom：用于将统计模型的结果整理成数据框形式</li>
<li>zoo：定义了一个名zoo的S3类型对象，用于描述规则的和不规则的有序的时间序列数据。</li>
</ul>
<h3 id="数据可视化">数据可视化</h3>
<p>以下R包用于数据可视化：</p>
<ul>
<li><p>ggplot2及其扩展：ggplot2包提供了一个强大的绘图系统，并实现了以下扩展</p></li>
<li><ul>
<li>ggthemes：提供扩展的图形风格主题</li>
</ul></li>
<li>ggmap：提供Google Maps，Open Street Maps等流行的在线地图服务模块</li>
<li>ggiraph：绘制交互式的ggplot图形</li>
<li>ggstance：实现常见图形的横向版本</li>
<li>GGally：绘制散点图矩阵</li>
<li>ggalt：添加额外的坐标轴，geoms等</li>
<li>ggforce：添加额外geoms等</li>
<li>ggrepel：用于避免图形标签重叠</li>
<li>ggraph：用于绘制网络状、树状等特定形状的图形</li>
<li>ggpmisc：光生物学相关扩展</li>
<li>geomnet：绘制网络状图形</li>
<li>ggExtra：绘制图形的边界直方图</li>
<li>gganimate：绘制动画图</li>
<li>plotROC：绘制交互式ROC曲线图</li>
<li>ggspectra：绘制光谱图</li>
<li>ggnetwork：网络状图形的geoms</li>
<li>ggradar：绘制雷达图</li>
<li>ggTimeSeries：时间序列数据可视化</li>
<li>ggtree：树图可视化</li>
<li><p>ggseas：季节调整工具</p></li>
<li><p>lattice：生成栅栏图</p></li>
<li><p>rgl：交互式3D绘图</p></li>
<li><p>ggvis：交互式图表多功能系统</p></li>
<li><p>htmlwidgets：一个专为R语言打造的可视化JS库</p></li>
<li><ul>
<li>leaflet：绘制交互式地图</li>
</ul></li>
<li>dygraphs：绘制交互式时间序列图</li>
<li>plotly：交互式绘图包，中文介绍详见这里</li>
<li>rbokeh：用于创建交互式图表和地图，中文介绍</li>
<li>Highcharter：绘制交互式Highcharts图</li>
<li>visNetwork：绘制交互式网状图</li>
<li>networkD3：绘制交互式网状图</li>
<li>d3heatmap：绘制交互式热力图，中文介绍</li>
<li>DT：用于创建交互式表格</li>
<li>threejs：绘制交互式3d图形和地球仪 -rglwidget：绘制交互式3d图形</li>
<li>DiagrammeR：绘制交互式图表</li>
<li><p>MetricsGraphics：绘制交互式MetricsGraphics图</p></li>
<li><p>rCharts：提供了对多个javascript数据可视化库（highcharts/nvd3/polychart）的R封装。</p></li>
<li><p>coefplot：可视化统计模型结果</p></li>
<li><p>quantmod：可视化金融图表</p></li>
<li><p>colorspace：基于HSL的调色板</p></li>
<li><p>viridis：Matplotlib viridis调色板</p></li>
<li><p>munsell：Munsell调色板</p></li>
<li><p>RColorBrewer：图形调色板</p></li>
<li><p>igraph：用于网络分析和可视化</p></li>
<li><p>latticeExtra：lattice绘图系统扩展包</p></li>
<li><p>sp：空间数据工具</p></li>
</ul>
<h3 id="数据转换">数据转换</h3>
<p>以下R包用于将数据转换为新的数据类型</p>
<ul>
<li>dplyr：一个用于高效数据清理的R包。视频学习课程</li>
<li>magrittr：一个高效的管道操作工具包。</li>
<li>tibble：高效的显示表格数据的结构</li>
<li>stringr：一个字符串处理工具集</li>
<li>lubridate：用于处理日期时间数据</li>
<li>xts：xts是对时间序列数据(zoo)的一种扩展实现，提供了时间序列的操作接口。</li>
<li>data.table：用于快速处理大数据集</li>
<li>vtreat：一个对预测模型进行变量预处理的工具</li>
<li>stringi：一个快速字符串处理工具</li>
<li>Matrix：著名的稀疏矩阵包</li>
</ul>
<h3 id="统计建模与推断">统计建模与推断</h3>
<p>下述R包是统计建模最常用的几个R包，其中的一些R包适用于多个主题。</p>
<ul>
<li>car：提供了大量的增强版的拟合和评价回归模型的函数。</li>
<li>Hmisc：提供各种用于数据分析的函数</li>
<li>multcomp：参数模型中的常见线性假设的同时检验和置信区间计算，包括线性、广义线性、线性混合效应和生存模型。</li>
<li>pbkrtest用于线性混合效应模型的参数Bootstrap检验</li>
<li>MatrixModels：用于稠密矩阵和稀疏矩阵建模</li>
<li>mvtnorm：用于计算多元正态分布和t分布的概率，分位数，随机偏差等</li>
<li>SparseM：用于稀疏矩阵的基本线性代数运算</li>
<li>lme4：利用C++矩阵库 Eigen进行线性混合效应模型的计算。</li>
<li>broom：将统计模型结果整理成数据框形式</li>
<li>caret：一个用于解决分类和回归问题的数据训练综合工具包</li>
<li>glmnet：通过极大惩罚似然来拟合广义线性模型</li>
<li>gbm：用于实现随机梯度提升算法</li>
<li>xgboost：全称是eXtreme Gradient Boosting。是Gradient Boosting Machine的一个c++实现。目前已制作了xgboost工具的R语言接口。详见统计之都的一篇介绍</li>
<li>randomForest：提供了用随机森林做回归和分类的函数</li>
<li>ranger：用于随机森林算法的快速实现</li>
<li>h2o：H2O是0xdata的旗舰产品，是一款核心数据分析平台。它的一部分是由R语言编写的，另一部分是由Java和Python语言编写的。用户可以部署H2O的R程序安装包，之后就可以在R语言环境下运行了。</li>
<li>ROCR：通过绘图来可视化分类器的综合性能。</li>
<li>pROC：用于可视化，平滑和对比ROC曲线</li>
</ul>
<h3 id="沟通交流">沟通交流</h3>
<p>以下R包用于实现数据科学结果的自动化报告，以便于你跟人们进行沟通交流。</p>
<ul>
<li>rmarkdown ：用于创建可重复性报告和动态文档</li>
<li>knitr：用于在PDF和HTML文档中嵌入R代码块</li>
<li>flexdashboard：基于rmarkdown，可以轻松的创建仪表盘</li>
<li>bookdown：以R Markdown为基础，用于创作书籍和长篇文档</li>
<li>rticles：提供了一套R Markdown模板</li>
<li>tufte：用于实现Tufte讲义风格的R Markdown模板</li>
<li>DT：用于创建交互式的数据表</li>
<li>pixiedust：用于自定义数据表的输出</li>
<li>xtable：用于自定义数据表的输出</li>
<li>highr：用于实现R代码的LaTeX或HTML格式输出</li>
<li>formatR：通过<code>tidy_source</code>函数格式化R代码的输出</li>
<li>yaml：用于实现R数据与YAML格式数据之间的通信。</li>
</ul>
<h3 id="自动化分析">自动化分析</h3>
<p>以下R包用于创建自动化分析结果的数据科学产品：</p>
<ul>
<li><p>shiny：一个使用R语言开发交互式web应用程序的工具。中文教程</p></li>
<li><ul>
<li>shinydashboard：用于创建交互式仪表盘</li>
</ul></li>
<li>shinythemes：给出了Shiny应用程序的常用风格主题</li>
<li>shinyAce：为Shiny应用程序开发者提供Ace代码编辑器。</li>
<li>shinyjs：用于在Shiny应用程序中执行常见的JavaScript操作</li>
<li>miniUI：提供了一个UI小部件，用于在R命令行中集成交互式应用程序</li>
<li>shinyapps.io：为创建的Shiny应用程序提供托管服务</li>
<li>Shiny Server Open Source：为Shiny应用程序提供开源免费的服务器</li>
<li><p>Shiny Server Pro：为企业级用户提供一个Shiny应用程序服务器</p></li>
<li><p>rsconnect：用于将Shiny应用程序部署到shinyapps.io</p></li>
<li><p>plumber：用于将R代码转化为一个web API</p></li>
<li><p>rmarkdown：用于创建可重复性报告和动态文档</p></li>
<li><p>rstudioapi：用于安全地访问RStudio IDE的API</p></li>
</ul>
<h3 id="程序开发">程序开发</h3>
<p>以下这些包主要用于开发自定义的R包：</p>
<ul>
<li>RStudio Desktop IDE：R的IDE。大家都懂，不用解释。</li>
<li>RStudio Server Open Source：开源免费的RStudio服务器</li>
<li>RStudio Server Professional：商业版RStudio服务器</li>
<li>devtools：一个让开发R包变得简单的工具集</li>
<li>packrat：创建项目的特定库，用于处理包的版本问题，增强代码重现能力。</li>
<li>drat：一个用于创建和使用备选R包库的工具</li>
<li>testthat：单元测试，让R包稳定、健壮，减少升级的痛苦。</li>
<li>roxygen2：通过注释的方式，生成文档，远离Latex的烦恼。</li>
<li>purrr：一个用于 提供函数式编程方法的工具</li>
<li>profvis：用于可视化R代码的性能分析数据</li>
<li>Rcpp：用于实现R与C++的无缝整合。详见统计之都文章</li>
<li>R6：R6是R语言的一个面向对象的R包，可以更加高效的构建面向对象系统。</li>
<li>htmltools：用于生成HTML格式输出</li>
<li>nloptr：提供了一个NLopt非线性优化库的接口</li>
<li>minqa：一个二次近似的优化算法包</li>
<li>rngtools：一个用于处理随机数生成器的实用工具</li>
<li>NMF：提供了一个执行非负矩阵分解的算法和框架</li>
<li>crayon：用于在输出终端添加颜色</li>
<li>RJSONIO：rjson是一个R语言与json进行转的包，是一个非常简单的包，支持用 C类库转型和R语言本身转型两种方式。</li>
<li>jsonlite：用于实现R语言与json数据格式之间的转化</li>
<li>RcppArmadillo：提供了一个Armadillo C++ Library（一种C++的线性代数库）的接口</li>
</ul>
<hr>
<h3 id="实验数据">实验数据</h3>
<p>以下R包给出了案例实战过程中可用的训练数据集：</p>
<ul>
<li>babynames：包含由美国社会保障局提供的三个数据集</li>
<li>neiss：2009-2014年期间提供给美国急诊室的所有事故报告样本数据</li>
<li>yrbss：美国疾病控制中心2009-2013年期间青年危险行为监测系统数据</li>
<li>hflights：</li>
<li>USAboundaries：2011年全年休斯顿机场的所有航班数据</li>
<li>rworldmap：国家边界数据</li>
<li>usdanutrients：美国农业部营养数据库</li>
<li>fueleconomy：美国环保署1984-2015年期间的燃油经济数据</li>
<li>nasaweather：包含了一个覆盖中美洲的非常粗糙的24*24格地理位置和大气测量数据。</li>
<li>mexico-mortality：墨西哥死亡人数数据</li>
<li>data-movies和ggplotmovies：来自互联网电影数据库imdb.com的数据</li>
<li>pop-flows：2008年全美人口流动数据</li>
<li>data-housing-crisis：经过清洗后的2008美国房地产危机数据</li>
<li>gun-sales：纽约时报提供的有关枪支购买的每月背景调查统计分析数据</li>
<li>stationaRy：从成千上万个全球站点收集到的每小时气象数据</li>
<li>gapminder：摘自Gapminder的数据</li>
<li>janeaustenr：简·奥斯丁小说全集数据</li>
</ul>
<h2 id="查看r的版本">查看R的版本</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sessionInfo() <span class="comment"># 要加括号</span></div></pre></td></tr></table></figure>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; sessionInfo() <span class="comment"># 要加括号</span></div><div class="line">R version <span class="number">3.4</span><span class="number">.0</span> (<span class="number">2017</span>-<span class="number">04</span>-<span class="number">21</span>)</div><div class="line">Platform: x86_64-w64-mingw32/x64 (<span class="number">64</span>-bit)</div><div class="line">Running under: Windows &gt;= <span class="number">8</span> x64 (build <span class="number">9200</span>)</div><div class="line"></div><div class="line">Matrix products: default</div><div class="line"></div><div class="line">locale:</div><div class="line">[<span class="number">1</span>] LC_COLLATE=Chinese (Simplified)_China.936  LC_CTYPE=Chinese (Simplified)_China.936   </div><div class="line">[<span class="number">3</span>] LC_MONETARY=Chinese (Simplified)_China.936 LC_NUMERIC=C                              </div><div class="line">[<span class="number">5</span>] LC_TIME=Chinese (Simplified)_China.936    </div><div class="line"></div><div class="line">attached base packages:</div><div class="line">[<span class="number">1</span>] stats     graphics  grDevices utils     datasets  methods   base     </div><div class="line"></div><div class="line">other attached packages:</div><div class="line">[<span class="number">1</span>] downloader_0.4 rafalib_1.0.0 </div><div class="line"></div><div class="line">loaded via a namespace (and not attached):</div><div class="line">[<span class="number">1</span>] compiler_3.4.0     tools_3.4.0        RColorBrewer_1.1-<span class="number">2</span> digest_0.6.15</div></pre></td></tr></table></figure>
<h2 id="查看r语言的内置数据集data">查看R语言的内置数据集<code>data()</code></h2>
<p>R的基本包中有一个叫<code>datasets</code>，里面全是示例数据集，供用户练习用。同时也可以使用<code>data()</code>来查看所有已经成功加载的包的数据集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Data sets <span class="keyword">in</span> package ‘datasets’:</div><div class="line"></div><div class="line">AirPassengers                         Monthly Airline Passenger Numbers <span class="number">1949</span>-<span class="number">1960</span></div><div class="line">BJsales                               Sales Data with Leading Indicator</div><div class="line">BJsales.lead (BJsales)                Sales Data with Leading Indicator</div><div class="line"><span class="keyword">...</span></div><div class="line">略</div></pre></td></tr></table></figure>
<p>如果需要查看更完整的列表，包括已安装的所有包的数据，可以使用下面代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data(package = .packages(<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<h3 id="加载特定包中的数据集">加载特定包中的数据集</h3>
<p>如果想要访问任意数据集里面的数据，可以使用<code>data()</code>函数，传入数据集的名称以及所在的包名（如果这个包已经被加载了，就可以不用<code>packages=&quot;包名&quot;</code>这个以参数了），如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data(<span class="string">"kidney"</span>, package = <span class="string">"survival"</span>)</div><div class="line">head(kidney)</div></pre></td></tr></table></figure>
<p>这个命令是调用<code>survival</code>这个包中的<code>kidney</code>这个数据集，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; data(<span class="string">"kidney"</span>, package = <span class="string">"survival"</span>)</div><div class="line">&gt; head(kidney)</div><div class="line">  id time status age sex disease frail</div><div class="line"><span class="number">1</span>  <span class="number">1</span>    <span class="number">8</span>      <span class="number">1</span>  <span class="number">28</span>   <span class="number">1</span>   Other   <span class="number">2.3</span></div><div class="line"><span class="number">2</span>  <span class="number">1</span>   <span class="number">16</span>      <span class="number">1</span>  <span class="number">28</span>   <span class="number">1</span>   Other   <span class="number">2.3</span></div><div class="line"><span class="number">3</span>  <span class="number">2</span>   <span class="number">23</span>      <span class="number">1</span>  <span class="number">48</span>   <span class="number">2</span>      GN   <span class="number">1.9</span></div><div class="line"><span class="number">4</span>  <span class="number">2</span>   <span class="number">13</span>      <span class="number">0</span>  <span class="number">48</span>   <span class="number">2</span>      GN   <span class="number">1.9</span></div><div class="line"><span class="number">5</span>  <span class="number">3</span>   <span class="number">22</span>      <span class="number">1</span>  <span class="number">32</span>   <span class="number">1</span>   Other   <span class="number">1.2</span></div><div class="line"><span class="number">6</span>  <span class="number">3</span>   <span class="number">28</span>      <span class="number">1</span>  <span class="number">32</span>   <span class="number">1</span>   Other   <span class="number">1.2</span></div></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>http://www.xueqing.tv/cms/article/198</li>
<li>http://blog.fens.me/</li>
<li>学习R.[美] Richard，Cotton 著刘军 译</li>
<li><a href="https://zhuanlan.zhihu.com/p/50345757" target="_blank" rel="external">R 从安装开始：BiocLite 到 BiocManager</a></li>
<li>R语言编程指南.任坤 著，王婷，赵孟韬，王泽贤 译</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/06/R/文档检索与环境配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/06/R/文档检索与环境配置/" itemprop="url">R语言笔记之文档检索与环境配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-06T12:00:00+08:00">
                2017-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,969
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="r帮助函数">R帮助函数</h2>
<p><code>help.start()</code> ，打开帮助文档首页</p>
<p><code>help.search(&quot;foo&quot;)</code>或<code>??foo，</code>以foo为关键词搜索本地帮助文档，<code>?Startup</code>查看与R有关的启动文件信息；</p>
<p><code>example(&quot;foo&quot;)</code> ，函数foo的使用示例（引号可以省略）</p>
<p><code>RSiteSearch(&quot;foo&quot;)</code>，以 foo 为关键词，查询整个 http://search.r-project.org 网站的包，例如<code>RSiteSearch(&quot;{Bayesian regression}&quot;)</code></p>
<p><code>apropos(&quot;foo&quot;,mode=&quot;function&quot;)</code>， 列出名称中含有 foo 的所有可用函数 。<code>apropos</code>支持正则表达式，例如<code>apropos(&quot;z$&quot;)</code>表示列出所有以z为结尾的变量。而<code>apropos(&quot;[4-9]&quot;)</code>则是含有4到9之间数字的所有变量。</p>
<p><code>data()</code>，列出当前已加载包中所含的所有可用示例数据集</p>
<p><code>vignette()</code> ，列出当前已安装包中所有可用的 vignette 文档，vignette指是一类小文章，会描述某个R函数的用法。</p>
<p><code>vignette(&quot;foo&quot;)</code>，为主题 foo 显示指定的 vignette 文档</p>
<p><code>demo()</code>，演示某些R案例</p>
<p><code>browseVignettes()</code>，查看当前系统里的Vignettes</p>
<p>注：在搜索帮助文档的过程中，可能会遇到R软件无法给出任何搜索项的相关信息的情况，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">help(adf.test)</div><div class="line"><span class="comment">## No documentation for 'adf.test' in specified packages and libraries:</span></div><div class="line"><span class="comment">## you could try '??adf.test'</span></div></pre></td></tr></table></figure>
<p>若你确定该函数安装在计算机中，则导致这样情况的原因可能是由于包含该函数的R包未载入，你不清楚哪个R包中包含这个函数。要解决这样的问题，需要在所有已安装的R包中搜索该函数。使用错误消息中提示的方法来进行搜索（即用help.search命令），例如:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">help.search(<span class="string">"adf.test"</span>)</div><div class="line"><span class="comment">## starting httpd help server ...</span></div><div class="line"><span class="comment">##  done</span></div></pre></td></tr></table></figure>
<h3 id="vignette">vignette()</h3>
<p>有些软件包中也会包含vignette，这是一些附加的文档，例如简介、教程或者开发文档等。这些vignette都会在安装软件包时，作为软件包的一部分安装到计算机中。vignette显示在软件包的帮助页面底部。可以通过vignette命令查看计算机中包含的所有软件包的附加文档列表，也可以通过在vignette命令中指定某一软件包的名称，查看特定软件包所附带的vignette?，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vignette(package=<span class="string">"ggplot2"</span>)</div></pre></td></tr></table></figure>
<p>每个vignette都对应一特定的名称，因此可以通过以下命令进行查看:vignette(“vignettename”) 。</p>
<h2 id="某看某个函数的文档">某看某个函数的文档</h2>
<p>用法：help(函数名)或<code>?函数名</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">help(mean)</div></pre></td></tr></table></figure>
<p>或者使用args函数快速获取函数的参数。例如，args(functionname)</p>
<p>或者用example函数查看函数的使用示例。例如example(functionname)</p>
<h2 id="查看某个包的文档">查看某个包的文档</h2>
<p>用法：help(package=“包的名称”)</p>
<p>需要与这区别的是，查看一个函数的帮助命令是help(函数名)，如果要查看一个包的帮助，操作与函数有所不同，需要加上package=，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">help(mean) <span class="comment"># 查看函数mean的帮助文档</span></div><div class="line">help(package=<span class="string">"ggplot2"</span>) <span class="comment"># 查看包ggplot2的帮助文档</span></div></pre></td></tr></table></figure>
<h2 id="网络资源">网络资源</h2>
<h3 id="rseek.org">Rseek.org</h3>
<p><a href="http://rseek.org/" target="_blank" rel="external">http://rseek.org</a></p>
<h3 id="qa网站">Q&amp;A网站</h3>
<p><a href="http://stackoverflow.com/" target="_blank" rel="external">http://stackoverflow.com</a></p>
<p>针对编程有关问题的Q&amp;A网站，例如数据结构、代码以及图表绘制等。</p>
<h3 id="有关统计的的qa网站">有关统计的的Q&amp;A网站</h3>
<p><a href="http://stats.stackexchange.com/" target="_blank" rel="external">http://stats.stackexchange.com</a></p>
<h3 id="r官网">R官网</h3>
<p><a href="http://cran.r-project.org/web/views" class="uri" target="_blank" rel="external">http://cran.r-project.org/web/views</a></p>
<p>网站中的任务视图，寻找并阅读与你研究相关的内容，其中能找到链接和相关软件包的简介。</p>
<h3 id="关键词检索软件包">关键词检索软件包</h3>
<p>通过关键字检索合适的软件包</p>
<p><a href="http://crantastic.org/" target="_blank" rel="external">http://crantastic.org</a></p>
<h3 id="sos">sos</h3>
<p>提供查询R包的其他方式：</p>
<p>http://cran.r-project.org/web/packages/sos/vignettes/sos.pdf</p>
<h2 id="环境配置">环境配置</h2>
<h3 id="历史命令保留">历史命令保留</h3>
<p>默认情况下，R会将一次对话中所有的命令都记录下来，方便随时重用，如果要将历史记录保存下来，可以使用<code>savehistory()</code>这个函数。默认情况下，R会当历史记录保存在当前工作目录下一个名为<code>.Rhistory</code>的文件中。</p>
<p>如果要将历史记录保存在其他文件，可以使用<code>file</code>参数，即<code>savehistory(file=&quot;TestHistory&quot;)</code>，扩展名对此文件并无影响。</p>
<p>如果要再次载入这个历史记录，使用可以<code>loadhistory()</code>命令，即<code>loadhistory(&quot;TestHistory&quot;)</code>。</p>
<h3 id="查看r当前的版本">查看R当前的版本</h3>
<p>使用<code>R.version()</code>命令可以返回当前运行R的版本信息，包括运行平台本身的信息，比较丰富，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&gt; R.Version()</div><div class="line">$platform</div><div class="line">[<span class="number">1</span>] <span class="string">"x86_64-w64-mingw32"</span></div><div class="line"></div><div class="line">$arch</div><div class="line">[<span class="number">1</span>] <span class="string">"x86_64"</span></div><div class="line"></div><div class="line">$os</div><div class="line">[<span class="number">1</span>] <span class="string">"mingw32"</span></div><div class="line"></div><div class="line">$system</div><div class="line">[<span class="number">1</span>] <span class="string">"x86_64, mingw32"</span></div><div class="line"></div><div class="line">$status</div><div class="line">[<span class="number">1</span>] <span class="string">""</span></div><div class="line"></div><div class="line">$major</div><div class="line">[<span class="number">1</span>] <span class="string">"3"</span></div><div class="line"></div><div class="line">$minor</div><div class="line">[<span class="number">1</span>] <span class="string">"5.2"</span></div><div class="line"></div><div class="line">$year</div><div class="line">[<span class="number">1</span>] <span class="string">"2018"</span></div><div class="line"></div><div class="line">$month</div><div class="line">[<span class="number">1</span>] <span class="string">"12"</span></div><div class="line"></div><div class="line">$day</div><div class="line">[<span class="number">1</span>] <span class="string">"20"</span></div><div class="line"></div><div class="line">$`svn rev`</div><div class="line">[<span class="number">1</span>] <span class="string">"75870"</span></div><div class="line"></div><div class="line">$language</div><div class="line">[<span class="number">1</span>] <span class="string">"R"</span></div><div class="line"></div><div class="line">$version.string</div><div class="line">[<span class="number">1</span>] <span class="string">"R version 3.5.2 (2018-12-20)"</span></div><div class="line"></div><div class="line">$nickname</div><div class="line">[<span class="number">1</span>] <span class="string">"Eggshell Igloo"</span></div></pre></td></tr></table></figure>
<p>如果只是想知道R的版本号，则用<code>getRversion()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; getRversion()</div><div class="line">[<span class="number">1</span>] ‘<span class="number">3.5</span><span class="number">.2</span>’</div></pre></td></tr></table></figure>
<h3 id="设置r语言默认cran镜像">设置R语言默认CRAN镜像</h3>
<p>R使用的CRAN镜像信息保存在一个<code>.RProfile</code>为扩展名的文件中，这个文件位于用户的home文件夹或R的启动目录中，如果要想更改CRAN镜像就需要修改这个文件。</p>
<p>查看R语言可选的镜像要用到<code>chooseCRANmirror()</code>命名，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; chooseCRANmirror()</div><div class="line">Secure CRAN mirrors </div><div class="line"></div><div class="line"> <span class="number">1</span>: <span class="number">0</span>-Cloud [https]                      <span class="number">2</span>: Algeria [https]                   </div><div class="line"> <span class="number">3</span>: Australia (Canberra) [https]         <span class="number">4</span>: Australia (Melbourne <span class="number">1</span>) [https]   </div><div class="line"> <span class="number">5</span>: Australia (Melbourne <span class="number">2</span>) [https]      <span class="number">6</span>: Australia (Perth) [https]         </div><div class="line"> <span class="number">7</span>: Austria [https]                      <span class="number">8</span>: Belgium (Ghent) [https]           </div><div class="line"> <span class="number">9</span>: Brazil (PR) [https]                 <span class="number">10</span>: Brazil (RJ) [https]      </div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div><div class="line"><span class="keyword">...</span> <span class="keyword">...</span></div><div class="line"></div><div class="line">Selection:</div></pre></td></tr></table></figure>
<p>选择19（上海的镜像）。</p>
<p>输入<code>options(&quot;repos&quot;)[[1]][1]</code>就可以查看选择后的镜像，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; options(<span class="string">"repos"</span>)[[<span class="number">1</span>]][<span class="number">1</span>]</div><div class="line">                                CRAN </div><div class="line"><span class="string">"https://mirrors.tongji.edu.cn/CRAN"</span></div></pre></td></tr></table></figure>
<p>将上面的镜像添加到<code>.RProfile</code>文件中即可 ，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">options(repos=<span class="string">"https://mirrors.tongji.edu.cn/CRAN"</span>)</div></pre></td></tr></table></figure>
<h2 id="r代码的运行source">R代码的运行<code>source()</code></h2>
<p>运行R代码的方式有以下几种：</p>
<p>第一，若要在控制台上执行编辑器中的某一行代码，点击想要运行的那行代码，在RStudio中，按下<code>Ctrl</code>+<code>Enter</code>或按<code>Run</code>即可。</p>
<p>第二，若要运行编辑窗口中的所有代码，那么就需要点击源代码编辑器中的任何位置，按下<code>Ctrl</code>+<code>Shift</code>+<code>Enter</code>即可，或者是按<code>Source</code>按钮。或者是在控制台中直接输入<code>source(&quot;R代码的路径+R代码文件&quot;)</code>即可，例如在D盘下保存了一个R代码文件<code>test.r</code>，那么就需要输入<code>source(&quot;D:/test.r&quot;)</code>，按回车。</p>
<p>需要注意的是：Rstudio的编辑窗口中有一个<code>Source on Save</code>复选框，这个是表示自动保存，最好选上。</p>
<h2 id="worksapce">Worksapce</h2>
<p>在一次R任务中，会导入数据，会创建变量，这些所有的内容称为Worksapce，它具体指的是，在所有会话中创建的变量，函数，载入的包。如果要查看当前Worksapce中创建的哪些变量，可以使用<code>ls()</code>命令。</p>
<h3 id="保存workspace命令save.image">保存Workspace命令save.image()</h3>
<p>如果想要保存整个Worksapce，要用到<code>save.image()</code>命令，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">"D:/"</span>)</div><div class="line">test1 &lt;- c(<span class="number">1</span>:<span class="number">4</span>)</div><div class="line">test2 &lt;- rep(<span class="number">1</span>:<span class="number">3</span>, <span class="number">4</span>)</div><div class="line">save.image(file=<span class="string">"test.Rdata"</span>)</div></pre></td></tr></table></figure>
<p>现在就在D盘下保存了一个名为<code>test.Rdata</code>的文件，现在关闭Rstudio。去D盘下，再打开<code>test</code>文件，发现原来的变量<code>test1</code>和<code>test2</code>都还在，跟原来的一样。</p>
<h2 id="rda文件">Rda文件</h2>
<p>Rda的全称是rdata，保存的是变量名与相应的多个变量，看以下代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">setwd(<span class="string">"D:/"</span>)</div><div class="line">x &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">y &lt;- c(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</div><div class="line">save(x,file=<span class="string">"x.rda"</span>)</div></pre></td></tr></table></figure>
<p>现在就在D盘保存了一个<code>x.rda</code>文件。当要载入这个文件时，要使用<code>load()</code>命令，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rm(list=ls())</div><div class="line">load(<span class="string">"D:/x.rda"</span>)</div><div class="line">x</div></pre></td></tr></table></figure>
<h2 id="save与save.image函数使用"><code>save()</code>与<code>save.image()</code>函数使用</h2>
<p>在R中如果要保存某个变量或工作环境需要用到<code>save()</code>和<code>save.iamge()</code>命令，它们的用法如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Usage</div><div class="line">save(<span class="keyword">...</span>, list = character(),</div><div class="line">     file = <span class="keyword">stop</span>(<span class="string">"'file' must be specified"</span>),</div><div class="line">     ascii = <span class="literal">FALSE</span>, version = <span class="literal">NULL</span>, envir = parent.frame(),</div><div class="line">     compress = isTRUE(!ascii), compression_level,</div><div class="line">     eval.promises = <span class="literal">TRUE</span>, precheck = <span class="literal">TRUE</span>)</div><div class="line"></div><div class="line">save.image(file = <span class="string">".RData"</span>, version = <span class="literal">NULL</span>, ascii = <span class="literal">FALSE</span>,</div><div class="line">           compress = !ascii, safe = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p>其中参数含义如下所示：</p>
<ul>
<li>list:一个包含要保存的对象名称的字符向量。</li>
<li>file:连接或保存数据的文件的名称。必须是保存的文件名。</li>
<li>ascii: ASCII码，默认FALSE。</li>
<li>envir: 寻找要保存的对象的环境。</li>
<li>compress:逻辑或字符串指定是否保存到指定文件是使用压缩。TRUE对应于gzip压缩，而字符串“gzip”、“bzip2”或“xz”指定压缩的类型。当文件是连接和工作空间格式版本时忽略。</li>
<li>save.image()只是“保存我当前工作空间”的捷径。</li>
</ul>
<p><code>save()</code>与<code>save.image()</code>函数的简单区别就在前者只保存一个变量（也可以保存多个），而后者可以一次保存所有的变量。</p>
<h2 id="ls查看当前对象">ls()查看当前对象</h2>
<p>例如ls()可以查看当前环境中的所有对象，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&gt; a = <span class="number">1</span>:<span class="number">4</span></div><div class="line">&gt; b = c(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"C"</span>)</div><div class="line">&gt; ls()</div><div class="line">[<span class="number">1</span>] <span class="string">"a"</span> <span class="string">"b"</span>    </div><div class="line">&gt; ls(pattern = <span class="string">"^is"</span>,baseenv()) <span class="comment"># 列出base包中所有的以is开头的函数</span></div><div class="line"><span class="comment"># baseenv()表示返回base包中所有的环境</span></div><div class="line"> [<span class="number">1</span>] <span class="string">"is.array"</span>                <span class="string">"is.atomic"</span>               <span class="string">"is.call"</span>                </div><div class="line"> [<span class="number">4</span>] <span class="string">"is.character"</span>            <span class="string">"is.complex"</span>              <span class="string">"is.data.frame"</span>          </div><div class="line"> [<span class="number">7</span>] <span class="string">"is.double"</span>               <span class="string">"is.element"</span>              <span class="string">"is.environment"</span>         </div><div class="line">[<span class="number">10</span>] <span class="string">"is.expression"</span>           <span class="string">"is.factor"</span>               <span class="string">"is.finite"</span>              </div><div class="line">[<span class="number">13</span>] <span class="string">"is.function"</span>             <span class="string">"is.infinite"</span>             <span class="string">"is.integer"</span>             </div><div class="line">[<span class="number">16</span>] <span class="string">"is.language"</span>             <span class="string">"is.list"</span>                 <span class="string">"is.loaded"</span>              </div><div class="line">[<span class="number">19</span>] <span class="string">"is.logical"</span>              <span class="string">"is.matrix"</span>               <span class="string">"is.na"</span>                  </div><div class="line">[<span class="number">22</span>] <span class="string">"is.na.data.frame"</span>        <span class="string">"is.na.numeric_version"</span>   <span class="string">"is.na.POSIXlt"</span>          </div><div class="line">[<span class="number">25</span>] <span class="string">"is.na&lt;-"</span>                 <span class="string">"is.na&lt;-.default"</span>         <span class="string">"is.na&lt;-.factor"</span>         </div><div class="line">[<span class="number">28</span>] <span class="string">"is.na&lt;-.numeric_version"</span> <span class="string">"is.name"</span>                 <span class="string">"is.nan"</span>                 </div><div class="line">[<span class="number">31</span>] <span class="string">"is.null"</span>                 <span class="string">"is.numeric"</span>              <span class="string">"is.numeric.Date"</span>        </div><div class="line">[<span class="number">34</span>] <span class="string">"is.numeric.difftime"</span>     <span class="string">"is.numeric.POSIXt"</span>       <span class="string">"is.numeric_version"</span>     </div><div class="line">[<span class="number">37</span>] <span class="string">"is.object"</span>               <span class="string">"is.ordered"</span>              <span class="string">"is.package_version"</span>     </div><div class="line">[<span class="number">40</span>] <span class="string">"is.pairlist"</span>             <span class="string">"is.primitive"</span>            <span class="string">"is.qr"</span>                  </div><div class="line">[<span class="number">43</span>] <span class="string">"is.R"</span>                    <span class="string">"is.raw"</span>                  <span class="string">"is.recursive"</span>           </div><div class="line">[<span class="number">46</span>] <span class="string">"is.single"</span>               <span class="string">"is.symbol"</span>               <span class="string">"is.table"</span>               </div><div class="line">[<span class="number">49</span>] <span class="string">"is.unsorted"</span>             <span class="string">"is.vector"</span>               <span class="string">"isatty"</span>                 </div><div class="line">[<span class="number">52</span>] <span class="string">"isBaseNamespace"</span>         <span class="string">"isdebugged"</span>              <span class="string">"isFALSE"</span>                </div><div class="line">[<span class="number">55</span>] <span class="string">"isIncomplete"</span>            <span class="string">"isNamespace"</span>             <span class="string">"isNamespaceLoaded"</span>      </div><div class="line">[<span class="number">58</span>] <span class="string">"isOpen"</span>                  <span class="string">"isRestart"</span>               <span class="string">"isS4"</span>                   </div><div class="line">[<span class="number">61</span>] <span class="string">"isSeekable"</span>              <span class="string">"isSymmetric"</span>             <span class="string">"isSymmetric.matrix"</span>     </div><div class="line">[<span class="number">64</span>] <span class="string">"isTRUE"</span></div></pre></td></tr></table></figure>
<h3 id="ls.str查看对象的类型"><code>ls.str()</code>查看对象的类型</h3>
<p>使用<code>ls.str()</code>命令可以查看变量的结构，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; ls.str()</div><div class="line">a :  int [<span class="number">1</span>:<span class="number">4</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></div><div class="line">b :  chr [<span class="number">1</span>:<span class="number">3</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"C"</span></div></pre></td></tr></table></figure>
<p>类似的函数还有<code>browseEnv()</code>，只是它是以HTML格式输出的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">browseEnv()</div></pre></td></tr></table></figure>
<div class="figure">
<img src="https://pic-1256416512.cos.ap-chengdu.myqcloud.com/img/20190704215727.png">

</div>
<h2 id="工作空间管理">工作空间管理</h2>
<p>如果把R对象的运行方式比较为游戏规则，那么工作空间就可以看作游戏场地。如果要玩好游戏，你不仅需要熟悉 规则，也要熟悉场地，这里的规则就是指R语言的各种语法，这里的场地就是R语言的运行工作空间。</p>
<h3 id="r语言的工作目录">R语言的工作目录</h3>
<p>当R开始运行时，它总是运行在某一个目录下的，这个目录就是R会话的工作目录，多数情况话，使用的就是绝对路径，例如<code>C:\test</code>这种工作，或者是使用相对路径，例如<code>\test</code>这样的。</p>
<p>在R中使用<code>getwd()</code>可以获取当前R的工作目录，使用<code>setwd()</code>是设置工作目录。</p>
<h3 id="创建r项目">创建R项目</h3>
<p>在Rstudio中要创建一个新项目就是使用<code>File|New Project</code>这个选项，具体的可以看Rstudio的实际操作。一旦创建了这个项目，就会在目录中创建一个扩展名为<code>.Rproj</code>文件。这个文件中储存了一些R的设计，一旦打开这个文件，这些设置就会启动，工作目录也将被设计为项目文件所在的位置。</p>
<p>假设我们在Rstudio中创建了一个R项目，此时就会在设置的目录中创建了一个<code>.Rproj</code>文件，这个项目就包括R脚本，数据文件，文本文件，图表等。</p>
<h3 id="检查工作环境">检查工作环境</h3>
<p>在R中，每个代码语句都是在指定环境中运行的，这个环境就是符号和其绑定物的集合，当我们当一个值赋给一个变量时，调用一个函数，或者对应一个函数名，R就会在当前的环境中寻找这个变量。如果在Rstudio的控制台中输入命令，它们会在全局环境中运行。例如当我们在Rstudio中开始一个新的R对话时，就是在一个空的全局环境中开始工作，这个空的全局环境就是没有定义任何变量的全局变量。</p>
<p>使用<code>objects()</code>这个命令就可以查看当前工作环境中的变量，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) </div><div class="line">y &lt;- c(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>) </div><div class="line">z &lt;- list(m = <span class="number">1.5</span>, n = c(<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"z"</span>)) </div><div class="line">objects()</div><div class="line">ls()</div><div class="line">ls.str()</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) </div><div class="line">&gt; y &lt;- c(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>) </div><div class="line">&gt; z &lt;- list(m = <span class="number">1.5</span>, n = c(<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"z"</span>)) </div><div class="line">&gt; objects()</div><div class="line">[<span class="number">1</span>] <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; ls()</div><div class="line">[<span class="number">1</span>] <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div><div class="line">&gt; ls.str()</div><div class="line">x :  num [<span class="number">1</span>:<span class="number">3</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></div><div class="line">y :  chr [<span class="number">1</span>:<span class="number">3</span>] <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span></div><div class="line">z : List of <span class="number">2</span></div><div class="line"> $ m: num <span class="number">1.5</span></div><div class="line"> $ n: chr [<span class="number">1</span>:<span class="number">3</span>] <span class="string">"x"</span> <span class="string">"y"</span> <span class="string">"z"</span></div></pre></td></tr></table></figure>
<p>从上面结果可以看出来，这个工作空间中有三个变量，另外，使用<code>ls()</code>与<code>objects()</code>的目的是一样的，但是<code>ls()</code>用的更多。使用<code>ls.str()</code>可以查看所有的变量的数据类型，此时也可以查看特定类型的，例如<code>ls.str(mode = &quot;list&quot;)</code>就可以列出列表类型的变量，此命令还支持正则表达式，使用<code>ls.str(patten = &quot;^\\w$&quot;, mode = &quot;list&quot;)</code>就列出匹配了所有字符串的list变量。</p>
<h3 id="修改全局选项">修改全局选项</h3>
<p>R语言中能够查看所有选项的值，例如<code>getOption()</code>就可以查看，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; getOption(<span class="string">"digits"</span>)</div><div class="line">[<span class="number">1</span>] <span class="number">7</span></div></pre></td></tr></table></figure>
<p>在查看某个参数时，要加上引号，从上面就可以知道，R中默认的数值是7位，使用<code>options()</code>可以改变显示位数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="number">123.4567891011121314145</span></div><div class="line">[<span class="number">1</span>] <span class="number">123.4568</span></div><div class="line">&gt; options(digits = <span class="number">2</span>)</div><div class="line">&gt; <span class="number">123.4567891011121314145</span></div><div class="line">[<span class="number">1</span>] <span class="number">123</span></div><div class="line">&gt; options(digits = <span class="number">4</span>)</div><div class="line">&gt; <span class="number">123.4567891011121314145</span></div><div class="line">[<span class="number">1</span>] <span class="number">123.5</span></div></pre></td></tr></table></figure>
<h2 id="查看r程序运行时间">查看R程序运行时间</h2>
<h3 id="proc.time查看用户时间"><code>proc.time()</code>查看用户时间</h3>
<p>R中的<code>proc.time()</code>函数可以查看程序运行时，其实<code>proc</code>就是程序<code>procedure</code>的缩写，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; proc.time()</div><div class="line"> 用户  系统  流逝 </div><div class="line"> <span class="number">0.32</span>  <span class="number">0.73</span> <span class="number">26.81</span></div></pre></td></tr></table></figure>
<p>由于系统是中文的，R中显示的是中文，其中用户(user)表示：R执行用户指标的CPU运行时间；系统(system)是指：系统所需要的时间，流逝(elapsed)是指R打开到现在总共运行的时间。</p>
<h3 id="system.time查看程序运行时间"><code>system.time()</code>查看程序运行时间</h3>
<p>使用<code>system.time()</code>函数可以查看R程序的运行时间，其语法是<code>system.time(expr,gcFirst = TRUE)</code>。</p>
<p>其中<code>expr</code>是需要运行的表达式，<code>gcFirst</code>是逻辑参数，<code>system.time()</code>这个函数实际上是调用了2次<code>proc.time()</code>函数，在程序运行前调用一次，在程序运行结束后又调用一次，然后计算这两次的时间差，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">system.time(<span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>) mad(runif(<span class="number">1000</span>)))</div><div class="line">ptm &lt;- proc.time() <span class="comment">#将proc.time()的返回值保存到ptm对象里</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>) mad(runif(<span class="number">1000</span>))</div><div class="line">proc.time() - ptm</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; system.time(<span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>) mad(runif(<span class="number">1000</span>)))</div><div class="line">用户 系统 流逝 </div><div class="line"><span class="number">0.17</span> <span class="number">0.00</span> <span class="number">0.17</span> </div><div class="line">&gt; ptm &lt;- proc.time() <span class="comment">#将proc.time()的返回值保存到ptm对象里</span></div><div class="line">&gt; <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>) mad(runif(<span class="number">1000</span>))</div><div class="line">&gt; proc.time() - ptm</div><div class="line">用户 系统 流逝 </div><div class="line"><span class="number">0.15</span> <span class="number">0.00</span> <span class="number">0.16</span></div></pre></td></tr></table></figure>
<p>再来看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ptm &lt;- proc.time()</div><div class="line">x &lt;- rnorm(<span class="number">100000</span>)</div><div class="line">y &lt;- rnomr(<span class="number">100000</span>)</div><div class="line">z &lt;- c()</div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">100000</span>)&#123;</div><div class="line">  z &lt;- c(z, x[i] + y[i])</div><div class="line">&#125;</div><div class="line">proc.time() - ptm</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; ptm &lt;- proc.time()</div><div class="line">&gt; x &lt;- rnorm(<span class="number">100000</span>)</div><div class="line">&gt; y &lt;- rnomr(<span class="number">100000</span>)</div><div class="line">Error <span class="keyword">in</span> rnomr(<span class="number">1e+05</span>) : could not find <span class="keyword">function</span> <span class="string">"rnomr"</span></div><div class="line">&gt; z &lt;- c()</div><div class="line">&gt; <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">100000</span>)&#123;</div><div class="line">+   z &lt;- c(z, x[i] + y[i])</div><div class="line">+ &#125;</div><div class="line">&gt; proc.time() - ptm</div><div class="line"> 用户  系统  流逝 </div><div class="line"><span class="number">14.42</span>  <span class="number">1.05</span> <span class="number">15.68</span></div></pre></td></tr></table></figure>
<p>从上面结果我们可以发现，这段程序运行的时间为：15.68秒，这是因为在R中，使用<code>for</code>循环非常没有效率，最好不要用for循环。在上面的这个案例中，程序每次都增加一个元素z向量里，这样总共增加了100000次，如果我们已经知道了z的长度，首先给定z的长度，就可以提高运行效率，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ptm &lt;- proc.time()</div><div class="line">x &lt;- rnorm(<span class="number">100000</span>)</div><div class="line">y &lt;- rnomr(<span class="number">100000</span>)</div><div class="line">z &lt;- rep(<span class="literal">NA</span>, <span class="number">100000</span>)</div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">100000</span>)&#123;</div><div class="line">  z[i] &lt;- x[i] + y[i]</div><div class="line">&#125;</div><div class="line">proc.time() - ptm</div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; proc.time() - ptm</div><div class="line">用户 系统 流逝 </div><div class="line"><span class="number">0.19</span> <span class="number">0.00</span> <span class="number">0.19</span></div></pre></td></tr></table></figure>
<p>用了0.19秒。</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li><a href="https://www.cnblogs.com/cloudtj/articles/7192452.html" target="_blank" rel="external">R语言-默认镜像设置</a></li>
<li>R语言轻松入门与提高 [法]Andrie de Vries ,[比利时]Joris Mey</li>
<li><a href="https://www.jianshu.com/p/6d701d789ab2" target="_blank" rel="external">R语言_save()函数用法</a></li>
<li>学习R[美]Richard，Cotton著，刘军译</li>
<li>R语言编程指南.任坤 著，王婷，赵孟韬，王泽贤 译</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/05/R/数据类型5-数组/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/R/数据类型5-数组/" itemprop="url">R语言笔记之数据类型5-数组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T12:00:00+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  827
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数组">数组</h1>
<h2 id="什么是数组">什么是数组</h2>
<p>数组：一维数据是向量，二维数据是矩阵，数组是向量和矩阵的直接推广，是由三维或三维以上的数据构成的。</p>
<h2 id="构建数组">构建数组</h2>
<p>数组函数是<code>array(),</code>语法是：<code>array(dadta, dim)</code>，其中<code>data</code>必须是同一类型的数据，<code>dim</code>是各维的长度组成的向量。函数<code>rowSums</code>, <code>colSums</code>, <code>rowMeans</code>, <code>colMeans</code>分别可以计算行总和，行均值，列总和，列均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">a&lt;-array(rep(<span class="number">1</span>:<span class="number">3</span>,each=<span class="number">3</span>),dim=c(<span class="number">3</span>,<span class="number">3</span>))</div><div class="line">a</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    2    3</span></div><div class="line"><span class="comment">## [2,]1    2    3</span></div><div class="line"><span class="comment">## [3,]1    2    3</span></div><div class="line"></div><div class="line">rowSums(a)</div><div class="line"><span class="comment">## [1] 6 6 6</span></div><div class="line"></div><div class="line">colSums(a)</div><div class="line"><span class="comment">## [1] 3 6 9</span></div><div class="line"></div><div class="line">table(a)</div><div class="line"><span class="comment">## a</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 3 3 3</span></div></pre></td></tr></table></figure>
<h2 id="多维数组">多维数组</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">colSums (x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) rowSums (x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) colMeans(x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>) rowMeans(x, na.rm = <span class="literal">FALSE</span>, dims = <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>其中dims为整数，表示哪个或哪些维数被看做行或列，对于row统计函数，dims+1及以后的维度被看做行，对于col函数，dims及以前的维度（1:dims）被看做列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">b &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">9</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>));b</div><div class="line"></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    1    1</span></div><div class="line"><span class="comment">## [2,]1    1    1</span></div><div class="line"><span class="comment">## [3,]1    1    1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    2    2</span></div><div class="line"><span class="comment">## [2,]2    2    2</span></div><div class="line"><span class="comment">## [3,]2    2    2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    3    3</span></div><div class="line"><span class="comment">## [2,]3    3    3</span></div><div class="line"><span class="comment">## [3,]3    3    3</span></div><div class="line"></div><div class="line">rowSums(b)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">1</span>)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]6    6    6</span></div><div class="line"><span class="comment">## [2,]6    6    6</span></div><div class="line"><span class="comment">## [3,]6    6    6</span></div><div class="line"></div><div class="line">colSums(b)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    6    9</span></div><div class="line"><span class="comment">## [2,]3    6    9</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">colSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1]  9 18 27</span></div><div class="line"></div><div class="line">table(b)</div><div class="line"><span class="comment">## b</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 9 9 9</span></div></pre></td></tr></table></figure>
<h2 id="数组命名">数组命名</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">x&lt;-<span class="number">1</span>:<span class="number">3</span> <span class="comment">#建立向量x</span></div><div class="line">names(x) <span class="comment">#提取向量x的名称</span></div><div class="line"><span class="comment">## NULL</span></div><div class="line"></div><div class="line">names(x)&lt;-c(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>);x<span class="comment">#将a,b,c作为x的名称</span></div><div class="line"><span class="comment">## a b c </span></div><div class="line"><span class="comment">## 1 2 3</span></div><div class="line"></div><div class="line">names(x)<span class="comment">#显示向量x的名称</span></div><div class="line"><span class="comment">## [1] "a" "b" "c"</span></div><div class="line"></div><div class="line">names(x)&lt;-<span class="literal">NULL</span>;x <span class="comment">#删除向量x的名称</span></div><div class="line"><span class="comment">## [1] 1 2 3</span></div><div class="line"></div><div class="line">x&lt;-matrix(<span class="number">1</span>:<span class="number">4</span>,<span class="number">2</span>)</div><div class="line">rownames(x)&lt;-c(<span class="string">"a"</span>,<span class="string">"b"</span>) <span class="comment"># 将行命名为a,b</span></div><div class="line">colnames(x)&lt;-c(<span class="string">"c"</span>,<span class="string">"d"</span>);x <span class="comment"># 将列命名为c,d</span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 1 3</span></div><div class="line"><span class="comment">## b 2 4</span></div><div class="line"></div><div class="line">dimnames(x)<span class="comment">#返回包含两个向量的列表</span></div><div class="line"><span class="comment">## [[1]]</span></div><div class="line"><span class="comment">## [1] "a" "b"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[2]]</span></div><div class="line"><span class="comment">## [1] "c" "d"</span></div><div class="line"></div><div class="line">a&lt;-array(<span class="number">1</span>:<span class="number">8</span>,dim=c(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>));a<span class="comment">#建立数组a,维度为2，2，2</span></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]2    4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]5    7</span></div><div class="line"><span class="comment">## [2,]6    8</span></div><div class="line"></div><div class="line">dimnames(a)&lt;-list(c(<span class="string">"a"</span>,<span class="string">"b"</span>),c(<span class="string">"c"</span>,<span class="string">"d"</span>),c(<span class="string">"e"</span>,<span class="string">"f"</span>));a <span class="comment"># 将数组a的各组命名</span></div><div class="line"><span class="comment">## , , e</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 1 3</span></div><div class="line"><span class="comment">## b 2 4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , f</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##   c d</span></div><div class="line"><span class="comment">## a 5 7</span></div><div class="line"><span class="comment">## b 6 8</span></div></pre></td></tr></table></figure>
<h2 id="行列求和平均值和频数">行列求和，平均值和频数</h2>
<h3 id="简单数组">简单数组</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">3</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>));a</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    2    3</span></div><div class="line"><span class="comment">## [2,]1    2    3</span></div><div class="line"><span class="comment">## [3,]1    2    3</span></div><div class="line"></div><div class="line">rowSums(a) <span class="comment"># 求行的和</span></div><div class="line"><span class="comment">## [1] 6 6 6</span></div><div class="line"></div><div class="line">colSums(a) <span class="comment"># 求列的和　</span></div><div class="line"><span class="comment">## [1] 3 6 9</span></div><div class="line"></div><div class="line">table(a) <span class="comment"># 频数表</span></div><div class="line"><span class="comment">## a</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 3 3 3</span></div></pre></td></tr></table></figure>
<h3 id="多维数组-1">多维数组</h3>
<p>对于多维数组，rowSums, colSums, rowMeans, colMeans的使用稍为复杂点。它们的参数为:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">b &lt;- array(rep(<span class="number">1</span>:<span class="number">3</span>, each=<span class="number">9</span>), dim=c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>));b</div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    1    1</span></div><div class="line"><span class="comment">## [2,]1    1    1</span></div><div class="line"><span class="comment">## [3,]1    1    1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    2    2</span></div><div class="line"><span class="comment">## [2,]2    2    2</span></div><div class="line"><span class="comment">## [3,]2    2    2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    3    3</span></div><div class="line"><span class="comment">## [2,]3    3    3</span></div><div class="line"><span class="comment">## [3,]3    3    3</span></div><div class="line"></div><div class="line">rowSums(b)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">1</span>)</div><div class="line"><span class="comment">## [1] 18 18 18</span></div><div class="line"></div><div class="line">rowSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]6    6    6</span></div><div class="line"><span class="comment">## [2,]6    6    6</span></div><div class="line"><span class="comment">## [3,]6    6    6</span></div><div class="line"></div><div class="line">colSums(b)</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]3    6    9</span></div><div class="line"><span class="comment">## [2,]3    6    9</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">colSums(b,dims=<span class="number">2</span>)</div><div class="line"><span class="comment">## [1]  9 18 27</span></div><div class="line"></div><div class="line">table(b)</div><div class="line"><span class="comment">## b</span></div><div class="line"><span class="comment">## 1 2 3 </span></div><div class="line"><span class="comment">## 9 9 9</span></div><div class="line"></div><div class="line">c &lt;- sample(letters[<span class="number">1</span>:<span class="number">5</span>], <span class="number">10</span>, replace=<span class="literal">TRUE</span>)</div><div class="line">table(c)</div><div class="line"><span class="comment">## c</span></div><div class="line"><span class="comment">## a b d e </span></div><div class="line"><span class="comment">## 1 3 2 4</span></div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/05/R/数据类型6-列表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/R/数据类型6-列表/" itemprop="url">R语言笔记之数据类型6-列表</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T12:00:00+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  179
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="列表">列表</h1>
<h2 id="什么是列表">什么是列表</h2>
<p>列表(list)为最复杂的数据类型，是一些对象或成分的有序集合，例如可以是向量，矩阵，数据框，或其他列表的组合。用<code>list()</code>创建：<code>mylist&lt;-list(object1,object2,...)</code>， 或命名列表：<code>mylist&lt;-list(name1=object1,name2=object2,...)</code>。</p>
<h2 id="创建列表">创建列表</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"> g&lt;-<span class="string">"My First List"</span></div><div class="line">h&lt;-c(<span class="number">25</span>,<span class="number">26</span>,<span class="number">18</span>,<span class="number">39</span>)</div><div class="line">j&lt;-matrix(<span class="number">1</span>:<span class="number">10</span>,nrow=<span class="number">5</span>)</div><div class="line">k&lt;-c(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>)</div><div class="line">mylist&lt;-list(title=g,ages=h,j,k)</div><div class="line">mylist <span class="comment">#输出列表</span></div><div class="line"></div><div class="line"><span class="comment">## $title</span></div><div class="line"><span class="comment">## [1] "My First List"</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[3]]</span></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    6</span></div><div class="line"><span class="comment">## [2,]2    7</span></div><div class="line"><span class="comment">## [3,]3    8</span></div><div class="line"><span class="comment">## [4,]4    9</span></div><div class="line"><span class="comment">## [5,]5   10</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## [[4]]</span></div><div class="line"><span class="comment">## [1] "one"   "two"   "three"</span></div></pre></td></tr></table></figure>
<h3 id="显示列表数据">显示列表数据</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mylist[<span class="number">1</span>]</div><div class="line"><span class="comment">## $title</span></div><div class="line"><span class="comment">## [1] "My First List"</span></div><div class="line"></div><div class="line">mylist[<span class="number">2</span>]</div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"></div><div class="line">mylist[[<span class="number">2</span>]]</div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div><div class="line"></div><div class="line">mylist[<span class="string">"ages"</span>]</div><div class="line"><span class="comment">## $ages</span></div><div class="line"><span class="comment">## [1] 25 26 18 39</span></div></pre></td></tr></table></figure>
<h1 id="section"></h1>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/04/R/数据类型4-矩阵/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/04/R/数据类型4-矩阵/" itemprop="url">R语言笔记之数据类型4-矩阵</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-04T12:00:00+08:00">
                2017-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,515
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  18
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="矩阵">矩阵</h1>
<h2 id="矩阵定义">矩阵定义</h2>
<p>矩阵是一个二维数组，只是每个元素都拥有相同的模式（数值型、字符型或逻辑型）。可通过函数<code>matrix()</code>创建矩阵。一般使用格式为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">myymatrix &lt;- matrix(vector, nrow=number_of_rows, ncol=number_of_columns, </div><div class="line">                    byrow=logical_value, dimnames=list(  </div><div class="line">                      char_vector_rownames, char_vector_colnames))</div></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li>vector包含了矩阵的元素；</li>
<li>nrow和ncol用以指定行和列的维数；</li>
<li>dimnames包含了可选的、以字符型向量表示的行名和列名。</li>
<li>选项 byrow 则表明矩阵应当按行填充（ byrow=TRUE ）还是按列填充（ byrow=FALSE ），默认情况下按列填充。</li>
</ul>
<h2 id="创建矩阵">创建矩阵</h2>
<h3 id="matrix">matrix()</h3>
<p>此函数在默认情况下是按列进行填充，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a &lt;- <span class="number">1</span>:<span class="number">12</span></div><div class="line">a </div><div class="line">matrix(a, nrow=<span class="number">4</span>, ncol=<span class="number">3</span>) <span class="comment"># 默认按列填充</span></div><div class="line">matrix(a, nrow=<span class="number">3</span>, ncol=<span class="number">3</span>, byrow=<span class="literal">T</span>) <span class="comment"># 按行填充</span></div></pre></td></tr></table></figure>
<p>运行结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; a &lt;- <span class="number">1</span>:<span class="number">12</span></div><div class="line">&gt; a </div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span></div><div class="line">&gt; matrix(a, nrow=<span class="number">4</span>, ncol=<span class="number">3</span>) <span class="comment"># 默认按列填充</span></div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">5</span>    <span class="number">9</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">6</span>   <span class="number">10</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span></div><div class="line">&gt; matrix(a, nrow=<span class="number">3</span>, ncol=<span class="number">3</span>, byrow=<span class="literal">T</span>) <span class="comment"># 按行填充</span></div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">4</span>    <span class="number">5</span>    <span class="number">6</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">7</span>    <span class="number">8</span>    <span class="number">9</span></div></pre></td></tr></table></figure>
<h3 id="dim">dim()</h3>
<p>通过dim来创建，先生成向量x，接着给向量x适当的维数，此例子中给向量的维数为5行，3列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">15</span></div><div class="line">&gt; x <span class="comment"># 建立x</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span></div><div class="line">&gt; x &lt;- <span class="number">1</span>:<span class="number">15</span></div><div class="line">&gt; x <span class="comment"># 建立x</span></div><div class="line"> [<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span></div><div class="line">&gt; dim(x) <span class="comment">#查看x的维度</span></div><div class="line"><span class="literal">NULL</span></div><div class="line">&gt; dim(x) &lt;- c(<span class="number">5</span>,<span class="number">3</span>) <span class="comment"># 将向量x转化为5行3列的矩阵</span></div><div class="line">&gt; x</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">6</span>   <span class="number">11</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">7</span>   <span class="number">12</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">8</span>   <span class="number">13</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">4</span>    <span class="number">9</span>   <span class="number">14</span></div><div class="line">[<span class="number">5</span>,]    <span class="number">5</span>   <span class="number">10</span>   <span class="number">15</span></div></pre></td></tr></table></figure>
<h3 id="矩阵命名">矩阵命名</h3>
<p>用法：Dimnames(Row_name,Col_name)，给定行和列的名称,如果不需要给行或者列命名，则以NULL代替。例如：给下面的矩阵列命令：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>);a</div><div class="line"><span class="comment">## [1] 1 2 3 4 5 6</span></div><div class="line"></div><div class="line">a&lt;-matrix(a,nrow=<span class="number">2</span>,byrow=<span class="literal">T</span>,dimnames=list(c(<span class="string">'a'</span>,<span class="string">'b'</span>),c(<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>)));a</div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div></pre></td></tr></table></figure>
<p>用rownames与colnames实现</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">b&lt;-c(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>) <span class="comment"># 建立向量b</span></div><div class="line">b</div><div class="line"><span class="comment">## [1] 2 3 4 5 6 7</span></div><div class="line"></div><div class="line">b&lt;-matrix(b,nrow=<span class="number">2</span>) <span class="comment"># 将向量b转化为矩阵</span></div><div class="line">b</div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    4    6</span></div><div class="line"><span class="comment">## [2,]3    5    7</span></div><div class="line"></div><div class="line">rownames(b)&lt;-c(<span class="string">"row_1"</span>,<span class="string">"row_2"</span>) <span class="comment"># 将矩阵行命名</span></div><div class="line">colnames(b)&lt;-c(<span class="string">"col_1"</span>,<span class="string">"col_2"</span>,<span class="string">"col_3"</span>) <span class="comment"># 将矩阵的列命名</span></div><div class="line">b</div><div class="line"><span class="comment">##       col_1 col_2 col_3</span></div><div class="line"><span class="comment">## row_12     4     6</span></div><div class="line"><span class="comment">## row_23     5     7</span></div></pre></td></tr></table></figure>
<h2 id="查看矩阵">查看矩阵</h2>
<h3 id="查看矩阵的列行相关信息">查看矩阵的列/行相关信息</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">colnames(a) <span class="comment"># 查看矩阵列名</span></div><div class="line"><span class="comment">## [1] "A" "B" "C"</span></div><div class="line"></div><div class="line">rownames(a) <span class="comment"># 查看矩阵行名</span></div><div class="line"><span class="comment">## [1] "a" "b"</span></div></pre></td></tr></table></figure>
<h3 id="查看矩阵的维度">查看矩阵的维度</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dim(a) <span class="comment"># 返回行与列数</span></div><div class="line"><span class="comment">## [1] 2 3</span></div><div class="line"></div><div class="line">nrow(a) <span class="comment"># 返回行数</span></div><div class="line"><span class="comment">## [1] 2</span></div><div class="line"></div><div class="line">ncol(a) <span class="comment"># 返回列数</span></div><div class="line"><span class="comment">## [1] 3</span></div></pre></td></tr></table></figure>
<h2 id="条件提取子矩阵">条件提取子矩阵</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">a <span class="comment"># 查看矩阵a</span></div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">a[<span class="number">2</span>,<span class="number">3</span>] <span class="comment">#取矩阵a的第2列，第3个元素</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 6</span></div><div class="line"></div><div class="line"> a[,<span class="number">1</span>] <span class="comment">#取矩阵a的第1列</span></div><div class="line"></div><div class="line"><span class="comment">## a b </span></div><div class="line"><span class="comment">## 1 4</span></div><div class="line"></div><div class="line">a[<span class="number">1</span>,] <span class="comment"># 取矩阵a的第1行</span></div><div class="line"></div><div class="line"><span class="comment">## A B C </span></div><div class="line"><span class="comment">## 1 2 3</span></div><div class="line"></div><div class="line">c&lt;-a[a[,<span class="number">2</span>]&gt;<span class="number">4</span>] <span class="comment"># 取矩阵a第2行并且大于4的元素，并将其赋值给c</span></div><div class="line">c</div><div class="line"></div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line"></div><div class="line">x&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>)</div><div class="line">x&lt;-matrix(x,nrow=<span class="number">3</span>)</div><div class="line">x</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    4    7</span></div><div class="line"><span class="comment">## [2,]2    5    8</span></div><div class="line"><span class="comment">## [3,]3    6    8</span></div><div class="line"></div><div class="line">x[,<span class="number">3</span>] <span class="comment"># 选取矩阵的第3列</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 7 8 8</span></div><div class="line"></div><div class="line">x[<span class="number">3</span>,] <span class="comment"># 选取矩阵的第3行</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3 6 8</span></div><div class="line"></div><div class="line">y&lt;-x[,<span class="number">3</span>,drop=<span class="literal">FALSE</span>] <span class="comment"># 选取x矩阵的第3列，并返回一个矩阵给y</span></div><div class="line">y</div><div class="line"></div><div class="line"><span class="comment">##      [,1]</span></div><div class="line"><span class="comment">## [1,]    7</span></div><div class="line"><span class="comment">## [2,]    8</span></div><div class="line"><span class="comment">## [3,]    8</span></div><div class="line"></div><div class="line">x[,-<span class="number">1</span>] <span class="comment"># 不显示矩阵的第1列</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]4    7</span></div><div class="line"><span class="comment">## [2,]5    8</span></div><div class="line"><span class="comment">## [3,]6    8</span></div><div class="line"></div><div class="line">x[-<span class="number">1</span>,] <span class="comment"># 不显示矩阵的第1行</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]2    5    8</span></div><div class="line"><span class="comment">## [2,]3    6    8</span></div><div class="line"></div><div class="line">x[,-(<span class="number">1</span>:<span class="number">2</span>)] <span class="comment"># 不显示矩阵的第1，2列</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 7 8 8</span></div><div class="line"></div><div class="line">z&lt;-x[,-(<span class="number">1</span>:<span class="number">2</span>),drop=<span class="literal">FALSE</span>] <span class="comment">#不显示矩阵x的第1，2列，并且返回为一矩阵y</span></div><div class="line">z</div><div class="line"></div><div class="line"><span class="comment">##      [,1]</span></div><div class="line"><span class="comment">## [1,]    7</span></div><div class="line"><span class="comment">## [2,]    8</span></div><div class="line"><span class="comment">## [3,]    8</span></div></pre></td></tr></table></figure>
<h2 id="提取矩阵的行或列">提取矩阵的行或列</h2>
<p><code>nrow</code>与<code>ncol</code>函数： nrow与ncol函数返回行或列的某一个数字。NCOL与NROW用于向量，即把向量作为单行的矩阵处理。 用法： nrow(x) ncol(x) NCOL(x) NROW(x) 参数： x：向量，或数据框； 值：长度为1或无的整数： 类似的有dim函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">ma &lt;- matrix(<span class="number">1</span>:<span class="number">12</span>, <span class="number">3</span>, <span class="number">4</span>);ma <span class="comment"># 建矩阵3行4列的矩阵</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1    4    710</span></div><div class="line"><span class="comment">## [2,]2    5    811</span></div><div class="line"><span class="comment">## [3,]3    6    912</span></div><div class="line"></div><div class="line">nrow(ma)   <span class="comment"># 行数为3</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 3</span></div><div class="line"></div><div class="line">ncol(ma)   <span class="comment"># 列数为4</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 4</span></div><div class="line"></div><div class="line">y &lt;-array(<span class="number">1</span>:<span class="number">24</span>, dim = <span class="number">2</span>:<span class="number">4</span>);y <span class="comment"># 建2行4列的数组</span></div><div class="line"></div><div class="line"><span class="comment">## , , 1</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    3    5</span></div><div class="line"><span class="comment">## [2,]2    4    6</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 2</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]7    9   11</span></div><div class="line"><span class="comment">## [2,]8   10   12</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 3</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]13   15   17</span></div><div class="line"><span class="comment">## [2,]14   16   18</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">## , , 4</span></div><div class="line"><span class="comment">## </span></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]19   21   23</span></div><div class="line"><span class="comment">## [2,]20   22   24</span></div><div class="line"></div><div class="line">ncol(y)</div><div class="line"></div><div class="line"><span class="comment">## [1] 3</span></div><div class="line"></div><div class="line">NCOL(<span class="number">1</span>:<span class="number">12</span>) <span class="comment"># NCOL把数组作为单行的矩阵处理</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 1</span></div><div class="line"></div><div class="line">NROW(<span class="number">1</span>:<span class="number">12</span>) <span class="comment"># 12</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 12</span></div></pre></td></tr></table></figure>
<h2 id="矩阵的运算">矩阵的运算</h2>
<h3 id="矩阵相乘">矩阵相乘%*%</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">d &lt;- c(<span class="number">1</span>:<span class="number">6</span>)</div><div class="line">d &lt;- matrix(d,nrow=<span class="number">3</span>)</div><div class="line">d</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    4</span></div><div class="line"><span class="comment">## [2,]2    5</span></div><div class="line"><span class="comment">## [3,]3    6</span></div><div class="line"></div><div class="line">e&lt;-a%*%d</div><div class="line">e</div><div class="line"></div><div class="line"><span class="comment">##   [,1] [,2]</span></div><div class="line"><span class="comment">## a   14   32</span></div><div class="line"><span class="comment">## b   32   77</span></div></pre></td></tr></table></figure>
<p>只有当矩阵a的列数与矩阵b的行数相等时a×b才有意义。一个m×n的矩阵a（m,n)左乘一个n×p的矩阵b（n,p)，会得到一个m×p的矩阵c（m,p)，满足矩阵乘法满足结合律，但不满足交换律。 运算的法则： 矩阵a的第1行的3个元素(1,2,3)分别与矩阵b第1列的3个元素(1,2,3)相乘，其和为结果为e[1,1]，即e[1,1]=1×1+2×2+3×3=14； 矩阵a的第1行的3个元素(1,2,3)分别与矩阵b第2列的3个元素(4,5,6)相乘1×4+2×5+3×6=32，得到e[1,2]； 矩阵a的第2行的3个元素(4,5,6)分别与矩阵b第1列的3个元素(1,2,3)相乘4×1+5×2+6×3=32，得到e[2,1]； 矩阵a的第2行的3个元素(4,5,6)分别与矩阵b第2列的3个元素(4,5,6)相乘4×4+5×5+6×6=77，得到e[2,2].</p>
<h3 id="矩阵合并">矩阵合并</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">m1&lt;-matrix(<span class="number">1</span>,nrow=<span class="number">2</span>,ncol=<span class="number">2</span>)</div><div class="line">m1 <span class="comment"># 建立矩阵m1,2行2列，值为1</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    1</span></div><div class="line"><span class="comment">## [2,]1    1</span></div><div class="line"></div><div class="line">m2&lt;-matrix(<span class="number">2</span>,nrow=<span class="number">2</span>,ncol=<span class="number">2</span>)</div><div class="line">m2 <span class="comment"># 建立矩阵m2,2行2列，值为2</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]2    2</span></div><div class="line"><span class="comment">## [2,]2    2</span></div><div class="line"></div><div class="line">m_rbind&lt;-rbind(m1,m2);m_rbind <span class="comment"># 对两个矩阵m1,m2进行行合并，即上下合并</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    1</span></div><div class="line"><span class="comment">## [2,]1    1</span></div><div class="line"><span class="comment">## [3,]2    2</span></div><div class="line"><span class="comment">## [4,]2    2</span></div><div class="line"></div><div class="line">m_cbind&lt;-cbind(m1,m2);m_cbind <span class="comment">#对两个矩阵m1,m2进行列合并，即左右合并</span></div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1    1    22</span></div><div class="line"><span class="comment">## [2,]1    1    22</span></div></pre></td></tr></table></figure>
<h3 id="星号表示相乘">星号表示相乘</h3>
<p>把两个矩阵中每个对应的元素相乘，例子中a与b拥有相同的维度</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"></div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line"></div><div class="line">b</div><div class="line"></div><div class="line"><span class="comment">##       col_1 col_2 col_3</span></div><div class="line"><span class="comment">## row_12     4     6</span></div><div class="line"><span class="comment">## row_23     5     7</span></div><div class="line"></div><div class="line">result&lt;-a*b <span class="comment">#将矩阵a与矩阵b相乘，并将其结果给result</span></div><div class="line">result</div><div class="line"></div><div class="line"><span class="comment">##    AB  C</span></div><div class="line"><span class="comment">## a  2  8 18</span></div><div class="line"><span class="comment">## b 12 25 42</span></div></pre></td></tr></table></figure>
<p>如果维度不同，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line"><span class="comment">##   A B C</span></div><div class="line"><span class="comment">## a 1 2 3</span></div><div class="line"><span class="comment">## b 4 5 6</span></div><div class="line">c</div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line">a*c <span class="comment"># a矩阵中的每一列与c的每一行相乘，循环c</span></div><div class="line"><span class="comment">##    AB  C</span></div><div class="line"><span class="comment">## a  4 12 15</span></div><div class="line"><span class="comment">## b 20 20 36</span></div></pre></td></tr></table></figure>
<h3 id="增加行与列">增加行与列</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">f&lt;-matrix(,<span class="number">4</span>,<span class="number">2</span>) <span class="comment"># 建立4行2列的空矩阵f</span></div><div class="line">f</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]NA   NA</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]NA   NA</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">f[c(<span class="number">1</span>,<span class="number">3</span>),]&lt;-matrix(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)) <span class="comment">#取f的1行与3行，将向量(1,2,3,4)填充进去，默认按列填充</span></div><div class="line">f</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">g&lt;-matrix(,<span class="number">4</span>,<span class="number">2</span>)</div><div class="line">g</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]NA   NA</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]NA   NA</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">g[c(<span class="number">1</span>,<span class="number">3</span>),]&lt;-matrix(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>),byrow=<span class="literal">FALSE</span>) <span class="comment"># byrow=FALSE则按行填充</span></div><div class="line">g</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div></pre></td></tr></table></figure>
<h3 id="矩阵转置t">矩阵转置<code>t()</code></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">f</div><div class="line"><span class="comment">##      [,1] [,2]</span></div><div class="line"><span class="comment">## [1,]1    3</span></div><div class="line"><span class="comment">## [2,]NA   NA</span></div><div class="line"><span class="comment">## [3,]2    4</span></div><div class="line"><span class="comment">## [4,]NA   NA</span></div><div class="line"></div><div class="line">h&lt;-t(f)</div><div class="line">h</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3] [,4]</span></div><div class="line"><span class="comment">## [1,]1   NA    2NA</span></div><div class="line"><span class="comment">## [2,]3   NA    4NA</span></div></pre></td></tr></table></figure>
<h3 id="取对角元素diag">取对角元素<code>diag()</code></h3>
<p>若要取一个方阵的对角元素，对一个向量应用<code>diag()</code>函数将产生以这个向量为对角元素的对角矩阵，对一个正整数k应用<code>diag()</code>函数将产生k维单位矩阵，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">j&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)</div><div class="line">j&lt;-matrix(j,nrow=<span class="number">3</span>)</div><div class="line">j_diag&lt;-diag(j) <span class="comment">#取对角</span></div><div class="line">j_diag</div><div class="line">diag(diag(j_diag))</div><div class="line">diag(<span class="number">3</span>)</div><div class="line"></div><div class="line">A &lt;- matrix(<span class="number">1</span>:<span class="number">16</span>,nrow=<span class="number">4</span>,ncol=<span class="number">4</span>)</div><div class="line">diag(A)</div><div class="line">diag(<span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; j_diag</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">9</span></div><div class="line">&gt; diag(diag(j_diag))</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">5</span> <span class="number">9</span></div><div class="line">&gt; diag(<span class="number">3</span>)</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">0</span>    <span class="number">0</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">0</span>    <span class="number">1</span>    <span class="number">0</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">0</span>    <span class="number">0</span>    <span class="number">1</span></div><div class="line"></div><div class="line">&gt; A &lt;- matrix(<span class="number">1</span>:<span class="number">16</span>,nrow=<span class="number">4</span>,ncol=<span class="number">4</span>)</div><div class="line">&gt; diag(A)</div><div class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">6</span> <span class="number">11</span> <span class="number">16</span></div><div class="line">&gt; diag(<span class="number">3</span>)</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">0</span>    <span class="number">0</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">0</span>    <span class="number">1</span>    <span class="number">0</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">0</span>    <span class="number">0</span>    <span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="求各行与列的总和与均值rowsumrowmeans">求各行与列的总和与均值<code>rowSum()</code>，<code>rowMeans()</code></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">j</div><div class="line"></div><div class="line"><span class="comment">##      [,1] [,2] [,3]</span></div><div class="line"><span class="comment">## [1,]1    4    7</span></div><div class="line"><span class="comment">## [2,]2    5    8</span></div><div class="line"><span class="comment">## [3,]3    6    9</span></div><div class="line"></div><div class="line">rowSums(j) <span class="comment"># 求各行的总和</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 12 15 18</span></div><div class="line"></div><div class="line">rowMeans(j) <span class="comment"># 求行的均值</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 4 5 6</span></div><div class="line"></div><div class="line">colSums(j) <span class="comment">#求各列的总和</span></div><div class="line"></div><div class="line"><span class="comment">## [1]  6 15 24</span></div><div class="line"></div><div class="line">colMeans(j) <span class="comment">#求各列的均值</span></div><div class="line"></div><div class="line"><span class="comment">## [1] 2 5 8</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的特征值与特征向量eigen">矩阵的特征值与特征向量<code>eigen()</code></h3>
<p>矩阵A的谱分解为<code>A=UΛU</code>，其中Λ是由A的特征值组成的对角矩阵，U的列为A的特征值对应的特征向量，在R中可以使用eigen()得到U和A，<code>eigen(x,symmertic, only.values=FALSE,EISPACK=FALSE)</code>，其中参数symmetric项是逻辑值，是F或T，它用于指定矩阵x是否为对称矩阵，如果不指定，系统将自动检验x是否为对称矩阵，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; eigen(j)</div><div class="line">eigen() decomposition</div><div class="line">$values</div><div class="line">[<span class="number">1</span>]  <span class="number">1.611684e+01</span> -<span class="number">1.116844e+00</span> -<span class="number">5.700691e-16</span></div><div class="line"></div><div class="line">$vectors</div><div class="line">           [,<span class="number">1</span>]       [,<span class="number">2</span>]       [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">0.4645473</span> -<span class="number">0.8829060</span>  <span class="number">0.4082483</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.5707955</span> -<span class="number">0.2395204</span> -<span class="number">0.8164966</span></div><div class="line">[<span class="number">3</span>,] -<span class="number">0.6770438</span>  <span class="number">0.4038651</span>  <span class="number">0.4082483</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的求逆solve">矩阵的求逆<code>solve()</code></h3>
<p>矩阵求逆可用函数solve()，应用sovle(A,b)运算结果可以解线性方程组Ax=b，若b缺少，则系统默认为单位矩阵，因此可以用其进行矩阵求逆，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">A &lt;- matrix(rnorm(<span class="number">16</span>),<span class="number">4</span>,<span class="number">4</span>);A</div><div class="line">solve(A)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- matrix(rnorm(<span class="number">16</span>),<span class="number">4</span>,<span class="number">4</span>);A</div><div class="line">        [,<span class="number">1</span>]    [,<span class="number">2</span>]     [,<span class="number">3</span>]    [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,]  <span class="number">0.3981</span>  <span class="number">1.4330</span>  <span class="number">0.56972</span>  <span class="number">0.6897</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.6120</span>  <span class="number">1.9804</span> -<span class="number">0.13505</span>  <span class="number">0.0280</span></div><div class="line">[<span class="number">3</span>,]  <span class="number">0.3411</span> -<span class="number">0.3672</span>  <span class="number">2.40162</span> -<span class="number">0.7433</span></div><div class="line">[<span class="number">4</span>,] -<span class="number">1.1294</span> -<span class="number">1.0441</span> -<span class="number">0.03924</span>  <span class="number">0.1888</span></div><div class="line">&gt; solve(A)</div><div class="line">        [,<span class="number">1</span>]    [,<span class="number">2</span>]      [,<span class="number">3</span>]    [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,] <span class="number">0.12130</span> -<span class="number">0.4308</span> -<span class="number">0.063267</span> -<span class="number">0.6283</span></div><div class="line">[<span class="number">2</span>,] <span class="number">0.04397</span>  <span class="number">0.3764</span>  <span class="number">0.007696</span> -<span class="number">0.1862</span></div><div class="line">[<span class="number">3</span>,] <span class="number">0.30921</span> -<span class="number">0.0369</span>  <span class="number">0.344768</span>  <span class="number">0.2331</span></div><div class="line">[<span class="number">4</span>,] <span class="number">1.03306</span> -<span class="number">0.5029</span> -<span class="number">0.264247</span>  <span class="number">0.5569</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的特征值与特征向量eigen-1">矩阵的特征值与特征向量<code>eigen()</code></h3>
<p>矩阵A的谱分解为<span class="math inline">\(A=U\Lambda U&#39;\)</span>，其中<span class="math inline">\(\Lambda\)</span>是由<span class="math inline">\(A\)</span>的特征值组成的对角矩阵，<span class="math inline">\(U\)</span>的列为<span class="math inline">\(A\)</span>的特征值对应的特征向量，在R中可以使用<code>eigen()</code>得到<span class="math inline">\(U\)</span>和<span class="math inline">\(A\)</span>，此函数参数如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eigen(x,symmetric,only.values=<span class="literal">FALSE</span>, EISPACK=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p>其中，x为矩阵，symmetric项指定矩阵x是否为对称矩阵，若不指定，系统将自动检测x是否为对称矩阵，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">A &lt;- diag(<span class="number">4</span>) +<span class="number">1</span></div><div class="line">A.e &lt;- eigen(A, symmetric=<span class="literal">T</span>)</div><div class="line">A.e</div><div class="line">A.e$vectors%*%diag(A.e$values)%*%t(A.e$vectors)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- diag(<span class="number">4</span>) +<span class="number">1</span></div><div class="line">&gt; A.e &lt;- eigen(A, symmetric=<span class="literal">T</span>)</div><div class="line">&gt; A.e</div><div class="line">eigen() decomposition</div><div class="line">$values</div><div class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></div><div class="line"></div><div class="line">$vectors</div><div class="line">     [,<span class="number">1</span>]    [,<span class="number">2</span>]    [,<span class="number">3</span>]    [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">0.5</span>  <span class="number">0.8660</span>  <span class="number">0.0000</span>  <span class="number">0.0000</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.5</span> -<span class="number">0.2887</span> -<span class="number">0.5774</span> -<span class="number">0.5774</span></div><div class="line">[<span class="number">3</span>,] -<span class="number">0.5</span> -<span class="number">0.2887</span> -<span class="number">0.2113</span>  <span class="number">0.7887</span></div><div class="line">[<span class="number">4</span>,] -<span class="number">0.5</span> -<span class="number">0.2887</span>  <span class="number">0.7887</span> -<span class="number">0.2113</span></div><div class="line"></div><div class="line">&gt; A.e$vectors%*%diag(A.e$values)%*%t(A.e$vectors)</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">2</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">1</span>    <span class="number">2</span>    <span class="number">1</span>    <span class="number">1</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">2</span>    <span class="number">1</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的choleskey分解">矩阵的Choleskey分解</h3>
<p>对于正定矩阵A，可对其进行Choleskey分解，即<span class="math inline">\(A=P&#39;P\)</span>，其中<span class="math inline">\(P\)</span>为上三角矩阵，在R中可以用函数<code>chol()</code>进行Choleskey分解，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A &lt;- diag(<span class="number">4</span>) +<span class="number">1</span></div><div class="line">A.c &lt;-chol(A);A.c</div><div class="line">t(A.c)%*%A.c</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- diag(<span class="number">4</span>) +<span class="number">1</span></div><div class="line">&gt; A.c &lt;-chol(A);A.c</div><div class="line">      [,<span class="number">1</span>]   [,<span class="number">2</span>]   [,<span class="number">3</span>]   [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,] <span class="number">1.414</span> <span class="number">0.7071</span> <span class="number">0.7071</span> <span class="number">0.7071</span></div><div class="line">[<span class="number">2</span>,] <span class="number">0.000</span> <span class="number">1.2247</span> <span class="number">0.4082</span> <span class="number">0.4082</span></div><div class="line">[<span class="number">3</span>,] <span class="number">0.000</span> <span class="number">0.0000</span> <span class="number">1.1547</span> <span class="number">0.2887</span></div><div class="line">[<span class="number">4</span>,] <span class="number">0.000</span> <span class="number">0.0000</span> <span class="number">0.0000</span> <span class="number">1.1180</span></div><div class="line">&gt; t(A.c)%*%A.c</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">2</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">1</span>    <span class="number">2</span>    <span class="number">1</span>    <span class="number">1</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">2</span>    <span class="number">1</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="矩阵奇异值分解svd">矩阵奇异值分解<code>svd()</code></h3>
<p>A为<span class="math inline">\(m \times n\)</span>矩阵，<span class="math inline">\(rank(A)=r\)</span>，可以分解为<span class="math inline">\(A=UDV‘\)</span>，其中，<span class="math inline">\(U’U=V&#39;V=I\)</span>。在R中可以使用函数<code>svd()</code>进行奇异值分解，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A &lt;- matrix(<span class="number">1</span>:<span class="number">18</span>, <span class="number">3</span>,<span class="number">6</span>);A</div><div class="line">A.s &lt;- svd(A);A.s</div><div class="line">A.s$u%*%diag(A.s$d)%*%t(A.s$v)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- matrix(<span class="number">1</span>:<span class="number">18</span>, <span class="number">3</span>,<span class="number">6</span>);A</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>] [,<span class="number">5</span>] [,<span class="number">6</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">4</span>    <span class="number">7</span>   <span class="number">10</span>   <span class="number">13</span>   <span class="number">16</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">5</span>    <span class="number">8</span>   <span class="number">11</span>   <span class="number">14</span>   <span class="number">17</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span>   <span class="number">12</span>   <span class="number">15</span>   <span class="number">18</span></div><div class="line">&gt; A.s &lt;- svd(A);A.s</div><div class="line">$d</div><div class="line">[<span class="number">1</span>] <span class="number">4.589e+01</span> <span class="number">1.641e+00</span> <span class="number">1.367e-15</span></div><div class="line"></div><div class="line">$u</div><div class="line">        [,<span class="number">1</span>]    [,<span class="number">2</span>]    [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">0.5290</span>  <span class="number">0.7439</span>  <span class="number">0.4082</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.5761</span>  <span class="number">0.0384</span> -<span class="number">0.8165</span></div><div class="line">[<span class="number">3</span>,] -<span class="number">0.6231</span> -<span class="number">0.6671</span>  <span class="number">0.4082</span></div><div class="line"></div><div class="line">$v</div><div class="line">         [,<span class="number">1</span>]    [,<span class="number">2</span>]     [,<span class="number">3</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">0.07736</span> -<span class="number">0.7196</span> -<span class="number">0.40767</span></div><div class="line">[<span class="number">2</span>,] -<span class="number">0.19033</span> -<span class="number">0.5089</span>  <span class="number">0.57456</span></div><div class="line">[<span class="number">3</span>,] -<span class="number">0.30330</span> -<span class="number">0.2983</span> -<span class="number">0.02801</span></div><div class="line">[<span class="number">4</span>,] -<span class="number">0.41627</span> -<span class="number">0.0876</span>  <span class="number">0.22266</span></div><div class="line">[<span class="number">5</span>,] -<span class="number">0.52924</span>  <span class="number">0.1231</span> -<span class="number">0.62121</span></div><div class="line">[<span class="number">6</span>,] -<span class="number">0.64221</span>  <span class="number">0.3337</span>  <span class="number">0.25966</span></div><div class="line"></div><div class="line">&gt; A.s$u%*%diag(A.s$d)%*%t(A.s$v)</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>] [,<span class="number">5</span>] [,<span class="number">6</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">4</span>    <span class="number">7</span>   <span class="number">10</span>   <span class="number">13</span>   <span class="number">16</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">5</span>    <span class="number">8</span>   <span class="number">11</span>   <span class="number">14</span>   <span class="number">17</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span>   <span class="number">12</span>   <span class="number">15</span>   <span class="number">18</span></div></pre></td></tr></table></figure>
<h3 id="矩阵qr分解qr">矩阵QR分解<code>qr()</code></h3>
<p>A为<span class="math inline">\(m \times n\)</span>矩阵时可以进行QR分解，<span class="math inline">\(A=QR\)</span>，其中，<span class="math inline">\(Q&#39;Q=I\)</span>，在R中可以使用<code>qr()</code>进行QR分解，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">A &lt;- matrix(<span class="number">1</span>:<span class="number">16</span>,<span class="number">4</span>,<span class="number">4</span>);A</div><div class="line">qr(A)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- matrix(<span class="number">1</span>:<span class="number">16</span>,<span class="number">4</span>,<span class="number">4</span>);A</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">5</span>    <span class="number">9</span>   <span class="number">13</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">6</span>   <span class="number">10</span>   <span class="number">14</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span>   <span class="number">15</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span>   <span class="number">16</span></div><div class="line">&gt; qr(A)</div><div class="line">$qr</div><div class="line">        [,<span class="number">1</span>]     [,<span class="number">2</span>]       [,<span class="number">3</span>]       [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,] -<span class="number">5.4772</span> -<span class="number">12.7802</span> -<span class="number">2.008e+01</span> -<span class="number">2.739e+01</span></div><div class="line">[<span class="number">2</span>,]  <span class="number">0.3651</span>  -<span class="number">3.2660</span> -<span class="number">6.532e+00</span> -<span class="number">9.798e+00</span></div><div class="line">[<span class="number">3</span>,]  <span class="number">0.5477</span>  -<span class="number">0.3782</span>  <span class="number">1.601e-15</span>  <span class="number">2.217e-15</span></div><div class="line">[<span class="number">4</span>,]  <span class="number">0.7303</span>  -<span class="number">0.9125</span> -<span class="number">5.547e-01</span> -<span class="number">1.478e-15</span></div><div class="line"></div><div class="line">$rank</div><div class="line">[<span class="number">1</span>] <span class="number">2</span></div><div class="line"></div><div class="line">$qraux</div><div class="line">[<span class="number">1</span>] <span class="number">1.183e+00</span> <span class="number">1.156e+00</span> <span class="number">1.832e+00</span> <span class="number">1.478e-15</span></div><div class="line"></div><div class="line">$pivot</div><div class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></div><div class="line"></div><div class="line">attr(,<span class="string">"class"</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"qr"</span></div></pre></td></tr></table></figure>
<h3 id="矩阵kronecker积kronecker">矩阵kronecker积<code>kronecker()</code></h3>
<p>A为<span class="math inline">\(m \times n\)</span>矩阵,B为<span class="math inline">\(h \times k\)</span>矩阵，而A与B的kronecker积为一个<span class="math inline">\(nh \times mk\)</span>维矩阵，在R中，使用函数<code>kronecker()</code>来过计算kronecker积，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A &lt;- matrix(<span class="number">1</span>:<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>);A</div><div class="line">B &lt;- matrix(rep(<span class="number">1</span>,<span class="number">4</span>),<span class="number">2</span>,<span class="number">2</span>);B</div><div class="line">kronecker(A,B)</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; A &lt;- matrix(<span class="number">1</span>:<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>);A</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">3</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">4</span></div><div class="line">&gt; B &lt;- matrix(rep(<span class="number">1</span>,<span class="number">4</span>),<span class="number">2</span>,<span class="number">2</span>);B</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">1</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">1</span>    <span class="number">1</span></div><div class="line">&gt; kronecker(A,B)</div><div class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>] [,<span class="number">4</span>]</div><div class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">3</span></div><div class="line">[<span class="number">2</span>,]    <span class="number">1</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">3</span></div><div class="line">[<span class="number">3</span>,]    <span class="number">2</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">4</span></div><div class="line">[<span class="number">4</span>,]    <span class="number">2</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">4</span></div></pre></td></tr></table></figure>
<h3 id="矩阵的维数dimnrow和ncol">矩阵的维数<code>dim()</code>，<code>nrow()</code>和<code>ncol()</code></h3>
<p>在R中，使用<code>dim()</code>函数返回矩阵的维数，<code>nrow()</code>返回行数，<code>ncol()</code>返回列数。</p>
<p>时可以进行QR分解，<span class="math inline">\(A=QR\)</span>，其中，<span class="math inline">\(Q&#39;Q=I\)</span>，在R中可以使用<code>qr()</code>进行QR分解，如下所示：</p>
<h2 id="参考资料">参考资料</h2>
<ol style="list-style-type: decimal">
<li>元统计分析及R语言建模（第4版） [Multivariate Statistical Analysis and Modeling for R Language] .王斌会 著</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rvdsd.top/2017/04/03/R/数据类型3-数据框/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RVDSD">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RVDSD的个人笔记本">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/03/R/数据类型3-数据框/" itemprop="url">R语言笔记之数据类型3-数据框</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-03T12:00:00+08:00">
                2017-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,086
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  27
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数据框定义">数据框定义</h2>
<p>一种矩阵形式的数据，但数据框中各列可以是不同类型的数据。数据框每列是一个变量，每行是一个观测。数据框可以看成是矩阵的推广，也可看作一种特殊的列表对象。</p>
<h2 id="数据框的创建">数据框的创建</h2>
<h3 id="data.frame">data.frame()</h3>
<p>通过data.frame函数来创建数据框，该函数包含的主要参数为: data.frame(…, row.names = NULL, check.rows = FALSE, check.names = TRUE, stringsAsFactors = default.stringsAsFactors()) 如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rats &lt;- c(<span class="number">1</span>:<span class="number">6</span>)</div><div class="line">group &lt;- c(<span class="string">"postive"</span>,<span class="string">"postive"</span>,<span class="string">"model"</span>,<span class="string">"model"</span>,<span class="string">"control"</span>,<span class="string">"control"</span>)</div><div class="line">sex &lt;- c(<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>)</div><div class="line">glu.d1 &lt;- c(<span class="number">11.97</span>,<span class="number">12.97</span>,<span class="number">27.34</span>,<span class="number">23.97</span>,<span class="number">6.79</span>,<span class="number">5.19</span>)</div><div class="line">glu.d7 &lt;- c(<span class="number">12.97</span>,<span class="number">13.97</span>,<span class="number">25.56</span>,<span class="number">23.97</span>,<span class="number">5.79</span>,<span class="number">6.19</span>)</div><div class="line">rat.data &lt;- data.frame(rats,group,sex,glu.d1,glu.d7)</div><div class="line">rat.data</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data   rats   group sex glu.d1 glu.d7 1    1 postive   F  11.97  12.97 2    2 postive   M  12.97  13.97 3    3   model   F  27.34  25.56 4    4   model   M  23.97  23.97 5    5 control   F   6.79   5.79 6    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="expand.grid">expand.grid()</h3>
<p>通过expand.grid()创建一个数据框，此函数可以创建元素所有可能的组合：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x&lt;-expand.grid(h=c(<span class="number">60</span>,<span class="number">80</span>),w=c(<span class="number">100</span>,<span class="number">300</span>),sex=c(<span class="string">"M"</span>,<span class="string">"F"</span>))</div><div class="line">x</div></pre></td></tr></table></figure>
<blockquote>
<p> x    h   w sex 1 60 100   M 2 80 100   M 3 60 300   M 4 80 300   M 5 60 100   F 6 80 100   F 7 60 300   F 8 80 300   F</p>
</blockquote>
<h3 id="查看数据框信息">查看数据框信息</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class(rat.data) <span class="comment"># 查看类型</span></div></pre></td></tr></table></figure>
<blockquote>
<p> class(rat.data) # 查看类型 [1] “data.frame”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class(rat.data$sex) # 查看某列的类型</div></pre></td></tr></table></figure>
<blockquote>
<p> class(rat.data$sex) # 查看某列的类型 [1] “factor”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">length(rat.data) # 查看数据框长度</div></pre></td></tr></table></figure>
<blockquote>
<p> length(rat.data) # 查看数据框长度 [1] 5</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names(rat.data) <span class="comment"># 数据框各项名称</span></div></pre></td></tr></table></figure>
<blockquote>
<p> names(rat.data) # 数据框各项名称 [1] “rats”   “group”  “sex”    “glu.d1” “glu.d7”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">summary(rat.data) </div><div class="line"># 数据框信息总结,对字符类/因子类数据，给出相应的频数统计；给数值型数据给出5个主要的指标</div></pre></td></tr></table></figure>
<blockquote>
<p> summary(rat.data)        rats          group   sex       glu.d1           glu.d7    <br>
 Min.   :1.00   control:2   F:3   Min.   : 5.190   Min.   : 5.790<br>
 1st Qu.:2.25   model  :2   M:3   1st Qu.: 8.085   1st Qu.: 7.885<br>
 Median :3.50   postive:2         Median :12.470   Median :13.470<br>
 Mean   :3.50                     Mean   :14.705   Mean   :14.742<br>
 3rd Qu.:4.75                     3rd Qu.:21.220   3rd Qu.:21.470<br>
 Max.   :6.00                     Max.   :27.340   Max.   :25.560 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">table(rat.data$group,rat.data$sex) </div><div class="line"><span class="comment"># 将数据框中的group与sex关联为一个表</span></div></pre></td></tr></table></figure>
<blockquote>
<p> table(rat.data<span class="math inline">\(group,rat.data\)</span>sex)  <br>
   F M   control 1 1   model   1 1   postive 1 1</p>
</blockquote>
<h2 id="数据框的去重">数据框的去重</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data2 &lt;- rbind(rat.data,rat.data) <span class="comment"># 创建一个新数据框rat.data2，内容是rat.data的2倍</span></div><div class="line">unique(rat.data2) <span class="comment"># 对数据框进行去重，即提取不重复的元素</span></div></pre></td></tr></table></figure>
<blockquote>
<p> unique(rat.data2) # 对数据框进行去重，即提取不重复的元素   rats   group sex glu.d1 glu.d7 1    1 postive   F  11.97  12.97 2    2 postive   M  12.97  13.97 3    3   model   F  27.34  25.56 4    4   model   M  23.97  23.97 5    5 control   F   6.79   5.79 6    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="去重函数unique">去重函数unique()</h3>
<p>查询数据中的唯一值只可以使用<code>unique()</code>函数，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mtcars$cyl</div><div class="line">unique(mtcars$cyl)</div><div class="line">levels(as.factor(mtcars$cyl)) <span class="comment"># 采用levles()这种方式只是核对一下，这种方式不推荐</span></div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; mtcars$cyl</div><div class="line"> [<span class="number">1</span>] <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="number">6</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span></div><div class="line">&gt; unique(mtcars$cyl)</div><div class="line">[<span class="number">1</span>] <span class="number">6</span> <span class="number">4</span> <span class="number">8</span></div><div class="line">&gt; levels(as.factor(mtcars$cyl))</div><div class="line">[<span class="number">1</span>] <span class="string">"4"</span> <span class="string">"6"</span> <span class="string">"8"</span></div></pre></td></tr></table></figure>
<h3 id="取重复的行duplicated">取重复的行duplicated()</h3>
<p>查找重复数据的函数是<code>duplicated()</code>，现在找出数据集<code>iris</code>中的一个重复值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>)</div><div class="line">duplicated(x)</div><div class="line"><span class="comment"># 有重复的值就会标为TRUE，没有重复的值就标为FALSE</span></div><div class="line"></div><div class="line">dupes &lt;- duplicated(iris)</div><div class="line">head(dupes)</div><div class="line">which(dupes)</div><div class="line">iris[dupes,]</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; x &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>)</div><div class="line">&gt; duplicated(x)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span></div><div class="line">&gt; <span class="comment"># 有重复的值就会标为TRUE，没有重复的值就标为FALSE</span></div><div class="line"></div><div class="line"></div><div class="line">&gt; dupes &lt;- duplicated(iris)</div><div class="line">&gt; head(dupes)</div><div class="line">[<span class="number">1</span>] <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span></div><div class="line">&gt; which(dupes)</div><div class="line">[<span class="number">1</span>] <span class="number">143</span></div><div class="line">&gt; iris[dupes,]</div><div class="line">    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</div><div class="line"><span class="number">143</span>          <span class="number">5.8</span>         <span class="number">2.7</span>          <span class="number">5.1</span>         <span class="number">1.9</span> virginica</div></pre></td></tr></table></figure>
<p>从上面结果可以看出来两个信息：</p>
<ol style="list-style-type: decimal">
<li>当duplicated()遇到重复的值时（重复的值必然至少有2个），第1个重复的值返回的是FALSE，到第2个以及第2个往后重复的值才显示为TRUE；</li>
<li>duplicated()返回的是一个逻辑向量，因此可以将其当作索引去除重复行，如下所示：</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">head(iris[!dupes, ])</div><div class="line">nrow(iris[!dupes, ])</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; head(iris[!dupes, ])</div><div class="line">  Sepal.Length Sepal.Width Petal.Length Petal.Width Species</div><div class="line"><span class="number">1</span>          <span class="number">5.1</span>         <span class="number">3.5</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">2</span>          <span class="number">4.9</span>         <span class="number">3.0</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">3</span>          <span class="number">4.7</span>         <span class="number">3.2</span>          <span class="number">1.3</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">4</span>          <span class="number">4.6</span>         <span class="number">3.1</span>          <span class="number">1.5</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">5</span>          <span class="number">5.0</span>         <span class="number">3.6</span>          <span class="number">1.4</span>         <span class="number">0.2</span>  setosa</div><div class="line"><span class="number">6</span>          <span class="number">5.4</span>         <span class="number">3.9</span>          <span class="number">1.7</span>         <span class="number">0.4</span>  setosa</div><div class="line">&gt; nrow(iris[!dupes, ])</div><div class="line">[<span class="number">1</span>] <span class="number">149</span></div></pre></td></tr></table></figure>
<p>再看一个案例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data2[duplicated(rat.data2),]<span class="comment"># 取数据框中重复的行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data2[duplicated(rat.data2),]# 取数据框中重复的行    rats   group sex glu.d1 glu.d7 7     1 postive   F  11.97  12.97 8     2 postive   M  12.97  13.97 9     3   model   F  27.34  25.56 10    4   model   M  23.97  23.97 11    5 control   F   6.79   5.79 12    6 control   M   5.19   6.19</p>
</blockquote>
<h3 id="提取某个元素">提取某个元素</h3>
<p>rat.data[i,j]指第i行第j列的数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[<span class="number">1</span>,<span class="number">2</span>] <span class="comment">#取第1行第2列</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1,2] #取第1行第2列 [1] postive Levels: control model postive</p>
</blockquote>
<h3 id="提取某行">提取某行</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data[<span class="number">2</span>,] <span class="comment">#取第2行</span></div><div class="line">rat.data[c(<span class="number">1</span>,<span class="number">4</span>),] <span class="comment">#取1，4行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[2,] #取第2行   rats   group sex glu.d1 glu.d7 2    2 postive   M  12.97  13.97</p>
</blockquote>
<blockquote>
<p> rat.data[c(1,4),] #取1，4行   rats   group sex glu.d1 glu.d7 1    1 postive   F  11.97  12.97 4    4   model   M  23.97  23.97</p>
</blockquote>
<h3 id="提取某列用列号提取">提取某列——用列号提取</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[,3] #取第3列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[,3] #取第3列 [1] F M F M F M Levels: F M</p>
</blockquote>
<h3 id="提取某列用列名称提取">提取某列——用列名称提取</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data$rats #取rat.data数据框中的rats列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data$rats #取rat.data数据框中的rats列 [1] 1 2 3 4 5 6</p>
</blockquote>
<h3 id="提取除掉某列的其余列">提取除掉某列的其余列</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[,-3] #取除了第3列外的其余列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[,-3] #取除了第3列外的其余列   rats   group glu.d1 glu.d7 1    1 postive  11.97  12.97 2    2 postive  12.97  13.97 3    3   model  27.34  25.56 4    4   model  23.97  23.97 5    5 control   6.79   5.79 6    6 control   5.19   6.19</p>
</blockquote>
<h3 id="取1到4行中的第4列">取1到4行中的第4列</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1:4,4]</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1:4,4][1] 11.97 12.97 27.34 23.97</p>
</blockquote>
<h3 id="取1到4行中的第3列">取1到4行中的第3列</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1:4,3]</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1:4,3][1] F M F M Levels: F M</p>
</blockquote>
<h3 id="取第1行2到4列">取第1行，2到4列</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data[1,2:4] #取第1行，2到4列</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data[1,2:4] #取第1行，2到4列     group sex glu.d1 1 postive   F  11.97</p>
</blockquote>
<h3 id="提取满足某一条件的列或match">提取满足某一条件的列<code>==</code>或<code>match()</code></h3>
<p>提取rat.data中所有control级别的观察值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Sel &lt;- rat.data$group == &quot;control&quot;</div><div class="line">rat.data.control &lt;- rat.data[Sel,]</div><div class="line">rat.data.control</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data.control   rats   group sex glu.d1 glu.d7 5    5 control   F   6.79   5.79 6    6 control   M   5.19   6.19</p>
</blockquote>
<p>使用<code>match()</code>函数，</p>
<p>在mtcars的行名称中检索<code>Toyota Corolla</code>元素，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">index &lt;- match(<span class="string">"Toyota Corolla"</span>, rownames(mtcars))</div><div class="line">index</div><div class="line">mtcars[index, <span class="number">1</span>:<span class="number">4</span>]</div></pre></td></tr></table></figure>
<p>计算结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; index &lt;- match(<span class="string">"Toyota Corolla"</span>, rownames(mtcars))</div><div class="line">&gt; index</div><div class="line">[<span class="number">1</span>] <span class="number">20</span></div><div class="line">&gt; mtcars[index, <span class="number">1</span>:<span class="number">4</span>]</div><div class="line">                mpg cyl disp hp</div><div class="line">Toyota Corolla <span class="number">33.9</span>   <span class="number">4</span> <span class="number">71.1</span> <span class="number">65</span></div></pre></td></tr></table></figure>
<h3 id="使用with计算条件总和">使用with计算条件总和</h3>
<p>案例：计算mtcars在不同马力段中油耗的平均值使用<code>mean()</code>函数，在阈值为150马力的情况下，计算过程如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">with(mtcars, mean(mpg))</div><div class="line">with(mtcars, mean(mpg[hp &lt; <span class="number">150</span>]))</div><div class="line">with(mtcars, mean(mpg[hp &gt;= <span class="number">150</span>]))</div></pre></td></tr></table></figure>
<p>结果如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; with(mtcars, mean(mpg))</div><div class="line">[<span class="number">1</span>] <span class="number">20.09062</span></div><div class="line">&gt; with(mtcars, mean(mpg[hp &lt; <span class="number">150</span>]))</div><div class="line">[<span class="number">1</span>] <span class="number">24.22353</span></div><div class="line">&gt; with(mtcars, mean(mpg[hp &gt;= <span class="number">150</span>]))</div><div class="line">[<span class="number">1</span>] <span class="number">15.40667</span></div></pre></td></tr></table></figure>
<h3 id="提取子集案例二">提取子集案例二</h3>
<p>如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&gt; manager&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; date&lt;-c(<span class="string">"10/24/08"</span>,<span class="string">"10/28/08"</span>,<span class="string">"10/01/08"</span>,<span class="string">"10/12/08"</span>,<span class="string">"05/01/09"</span>)</div><div class="line">&gt; country&lt;-c(<span class="string">"US"</span>,<span class="string">"US"</span>,<span class="string">"UK"</span>,<span class="string">"China"</span>,<span class="string">"UK"</span>)</div><div class="line">&gt; gender&lt;-c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; age&lt;-c(<span class="number">32</span>,<span class="number">45</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">99</span>)</div><div class="line">&gt; q1&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">&gt; q2&lt;-c(<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; q3&lt;-c(<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>)</div><div class="line">&gt; q4&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>,<span class="number">2</span>)</div><div class="line">&gt; q5&lt;-c(<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>)</div><div class="line">&gt; leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactors=<span class="literal">FALSE</span>)</div><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div><div class="line">&gt; newdata &lt;- leadership[, c(<span class="number">6</span>:<span class="number">10</span>)] <span class="comment">#从leadership数据框中取第6行到第10行的变量，并且将其保存在newdata中，将行下标留空(,），表示取所有行</span></div><div class="line">&gt; newdata</div><div class="line">  q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>再看一案例，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div><div class="line">&gt; newdata&lt;- leadership[which(leadership$gender == <span class="string">"M"</span> &amp; leadership$age&gt;<span class="number">30</span>),] <span class="comment"># 将leaderhip中30岁以上的男性选入newdata中</span></div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div></pre></td></tr></table></figure>
<h3 id="将某一数值转换为某一类别变量">将某一数值转换为某一类别变量</h3>
<h4 id="创建数据框">创建数据框</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">manager&lt;-c(1,2,3,4,5)</div><div class="line">date&lt;-c(&quot;10/24/08&quot;,&quot;10/28/08&quot;,&quot;10/1/08&quot;,&quot;10/12/08&quot;,&quot;5/1/09&quot;)</div><div class="line">country&lt;-c(&quot;US&quot;,&quot;US&quot;,&quot;UK&quot;,&quot;UK&quot;,&quot;UK&quot;)</div><div class="line">gender&lt;-c(&quot;M&quot;,&quot;F&quot;,&quot;F&quot;,&quot;M&quot;,&quot;F&quot;)</div><div class="line">age&lt;-c(32,45,25,39,99)</div><div class="line">q1&lt;-c(5,3,3,3,2)</div><div class="line">q2&lt;-c(4,5,5,3,2)</div><div class="line">q3&lt;-c(5,2,5,4,1)</div><div class="line">q4&lt;-c(5,5,5,NA,2)</div><div class="line">q5&lt;-c(5,5,2,NA,1)</div><div class="line">leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactor=FALSE)</div><div class="line">#把字符转化为因子</div><div class="line">leadership</div></pre></td></tr></table></figure>
<blockquote>
<p> leadership   manager     date country gender age q1 q2 q3 q4 q5 stringsAsFactor 1       1 10/24/08      US      M  32  5  4  5  5  5           FALSE 2       2 10/28/08      US      F  45  3  5  2  5  5           FALSE 3       3  10/1/08      UK      F  25  3  5  5  5  2           FALSE 4       4 10/12/08      UK      M  39  3  3  4 NA NA           FALSE 5       5   5/1/09      UK      F  99  2  2  1  2  1           FALSE</p>
</blockquote>
<h4 id="转变变量可转化为因子型变量">转变变量(可转化为因子型变量)</h4>
<p>要求：将大于99的转换为缺失，age大于75的为Elder，55到75之间的为Middle，55以下的为Young：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">leadership$age[leadership$age == <span class="number">99</span>] &lt;-<span class="literal">NA</span> <span class="comment"># 年龄为99时，表示缺失</span></div><div class="line">leadership$agecat[leadership$age &gt;<span class="number">75</span>] &lt;- <span class="string">"Elder"</span> <span class="comment"># 当age大于75时，agecat为Elder</span></div><div class="line">leadership$agecat[leadership$age &gt;= <span class="number">55</span> &amp; leadership$age&lt;= <span class="number">75</span>] &lt;- <span class="string">"Middle"</span> <span class="comment"># 当55&lt;= age &lt;=75时，agecat为Middle</span></div><div class="line">leadership$agecat[leadership$age &lt; <span class="number">55</span>] &lt;-<span class="string">"Young"</span> <span class="comment">#age&lt;55时，agecat为Young</span></div><div class="line">leadership</div></pre></td></tr></table></figure>
<blockquote>
<p> leadership   manager     date country gender age q1 q2 q3 q4 q5 stringsAsFactor agecat 1       1 10/24/08      US      M  32  5  4  5  5  5           FALSE  Young 2       2 10/28/08      US      F  45  3  5  2  5  5           FALSE  Young 3       3  10/1/08      UK      F  25  3  5  5  5  2           FALSE  Young 4       4 10/12/08      UK      M  39  3  3  4 NA NA           FALSE  Young 5       5   5/1/09      UK      F  NA  2  2  1  2  1           FALSE   <na></na></p>
</blockquote>
<h2 id="判断数据框各行是否完整complete.cases">判断数据框各行是否完整<code>complete.cases</code></h2>
<p>所用函数为<code>complete.cases</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rat.data</div><div class="line">rat.data1$group[<span class="number">2</span>]&lt;-<span class="literal">NA</span></div><div class="line">complete.cases(rat.data1) <span class="comment">#判断数据框是否完整</span></div></pre></td></tr></table></figure>
<blockquote>
<p> complete.cases(rat.data1) #判断数据框是否完整 [1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE</p>
</blockquote>
<p>如果要删除某个数据集中的包含缺失值的行，那么就可以通过下面的代码实现：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rat.data1 &lt;- rat.data1[complete.cases(rat.data1),]</div><div class="line"></div><div class="line"><span class="comment"># 或者是使用na.omit()函数</span></div><div class="line">rat.data1 &lt;- na.omit(rat.data1)</div></pre></td></tr></table></figure>
<h2 id="提取非缺失值">提取非缺失值</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rat.data1[complete.cases(rat.data1),] #选择非缺失值的数据</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1[complete.cases(rat.data1),] #选择非缺失值的数据   rats   group sex glu.d1 glu.d7 1    1 postive   F  11.97  12.97 3    3   model   F  27.34  25.56 4    4   model   M  23.97  23.97 5    5 control   F   6.79   5.79 6    6 control   M   5.19   6.19</p>
</blockquote>
<h2 id="增加列">增加列</h2>
<h3 id="直接添加">直接添加</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data$result&lt;-c(rat.data$glu.d1-rat.data$glu.d7)</div><div class="line">rat.data</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data   rats   group sex glu.d1 glu.d7 result 1    1 postive   F  11.97  12.97  -1.00 2    2 postive   M  12.97  13.97  -1.00 3    3   model   F  27.34  25.56   1.78 4    4   model   M  23.97  23.97   0.00 5    5 control   F   6.79   5.79   1.00 6    6 control   M   5.19   6.19  -1.00</p>
</blockquote>
<h3 id="cbind添加">cbind添加</h3>
<p>格式为data.frame1 &lt;- cbind(data.fram1,新的变量（可以由公式得到）)，例如下面的例子就是在rat.data1添加一个result变量，result的变量是由rat.data1中的glu.d1减去glu.d7得到的。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-cbind(rat.data1, result=c(rat.data1$glu.d1-rat.data1$glu.d7))</div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-cbind(rat.data1, result=c(rat.data1<span class="math inline">\(glu.d1-rat.data1\)</span>glu.d7))  rat.data1   rats   group sex glu.d1 glu.d7 result 1    1 postive   F  11.97  12.97  -1.00 2    2    <na>   M  12.97  13.97  -1.00 3    3   model   F  27.34  25.56   1.78 4    4   model   M  23.97  23.97   0.00 5    5 control   F   6.79   5.79   1.00 6    6 control   M   5.19   6.19  -1.00</na></p>
</blockquote>
<p>另外的方法为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1$result &lt;- rat.data1$glu.d1-rat.data1$glu.d7</div><div class="line"><span class="comment"># 或</span></div><div class="line">rat.data1 &lt;- transform(rat.data1,result=glu.d1-glu.d7)</div></pre></td></tr></table></figure>
<h3 id="merge添加">merge()添加</h3>
<p>用法为<code>total &lt;- merge(dataframeA, dataframeB, by = &quot;ID&quot;)</code>，它表示，将dataframeA与dataframeB按照ID进行合并，这种联结通常是横向的，即向数据框中添加变量。</p>
<h2 id="删除列">删除列</h2>
<h3 id="使用null">使用NULL</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rat.data1</div><div class="line">rat.data1$result&lt;-<span class="literal">NULL</span> <span class="comment"># 删除result这一列，原数列有2列result</span></div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1   rats   group sex glu.d1 glu.d7 result 1    1 postive   F  11.97  12.97  -1.00 2    2    <na>   M  12.97  13.97  -1.00 3    3   model   F  27.34  25.56   1.78 4    4   model   M  23.97  23.97   0.00 5    5 control   F   6.79   5.79   1.00 6    6 control   M   5.19   6.19  -1.00</na></p>
</blockquote>
<blockquote>
<p> rat.data1$result&lt;-NULL # 删除result这一列</p>
</blockquote>
<blockquote>
<p> rat.data1   rats   group sex glu.d1 glu.d7 1    1 postive   F  11.97  12.97 2    2    <na>   M  12.97  13.97 3    3   model   F  27.34  25.56 4    4   model   M  23.97  23.97 5    5 control   F   6.79   5.79 6    6 control   M   5.19   6.19</na></p>
</blockquote>
<h3 id="用subset">用subset()</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-subset(rat.data1,select=c(-sex,-group)) <span class="comment">#删除sex,group列</span></div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-subset(rat.data1,select=c(-sex,-group)) #删除sex,group列  rat.data1   rats glu.d1 glu.d7 1    1  11.97  12.97 2    2  12.97  13.97 3    3  27.34  25.56 4    4  23.97  23.97 5    5   6.79   5.79 6    6   5.19   6.19</p>
</blockquote>
<h3 id="in"><code>%in%</code></h3>
<p><code>%in%</code>是一种特殊类型的函数，被称为二元运算符。</p>
<p>使用<code>%in%</code>，如下所示：</p>
<p>先生成一个数据框，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; manager&lt;-c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; date&lt;-c(<span class="string">"10/24/08"</span>,<span class="string">"10/28/08"</span>,<span class="string">"10/01/08"</span>,<span class="string">"10/12/08"</span>,<span class="string">"05/01/09"</span>)</div><div class="line">&gt; country&lt;-c(<span class="string">"US"</span>,<span class="string">"US"</span>,<span class="string">"UK"</span>,<span class="string">"China"</span>,<span class="string">"UK"</span>)</div><div class="line">&gt; gender&lt;-c(<span class="string">"M"</span>,<span class="string">"F"</span>,<span class="string">"F"</span>,<span class="string">"M"</span>,<span class="string">"F"</span>)</div><div class="line">&gt; age&lt;-c(<span class="number">32</span>,<span class="number">45</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">99</span>)</div><div class="line">&gt; q1&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">&gt; q2&lt;-c(<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">&gt; q3&lt;-c(<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>)</div><div class="line">&gt; q4&lt;-c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>,<span class="number">2</span>)</div><div class="line">&gt; q5&lt;-c(<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="literal">NA</span>)</div><div class="line">&gt; leadership&lt;-data.frame(manager,date,country,gender,age,q1,q2,q3,q4,q5,stringsAsFactors=<span class="literal">FALSE</span>)</div><div class="line">&gt; leadership</div><div class="line">  manager     date country gender age q1 q2 q3 q4 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">4</span> <span class="literal">NA</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">2</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>现在删除q3与q4，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; myvars &lt;-names(leadership)%<span class="keyword">in</span>%c(<span class="string">"q3"</span>,<span class="string">"q4"</span>)</div><div class="line">&gt; newdata&lt;-leadership[!myvars]</div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<p>names(leadership)生成了一个包含所有变量名的字符型微量，即<code>c(&quot;manager&quot;,&quot;date&quot;,&quot;country&quot;，&quot;gender&quot;，&quot;age&quot;，&quot;q1&quot;，&quot;q2&quot;，&quot;q3&quot;,&quot;q4&quot;,&quot;q5&quot;,&quot;stringsAsFactor&quot;)</code>，<code>names(leadership)%in%c(&quot;item3&quot;,&quot;item4&quot;)</code>返回了一个逻辑型向量，<code>names(leadership)``中每个匹配item3或item4的元素值为TRUE，反之为</code>FALSE，c(FALSE, FALSE, FALSE, FALSE,FALSE, FALSE, FALSE, TRUE, TRUE, FALSE)<code>，运算符非（!）将逻辑值反转：</code>c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE,FALSE, TRUE)<code>,</code>leadership[c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE,TRUE)]`选择了逻辑值为TRUE的列，于是q3和q4被剔除了。</p>
<p>或者直接使用<code>-</code>号，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt; newdata &lt;- leadership[c(-<span class="number">8</span>,-<span class="number">9</span>) ] <span class="comment">#直接在变量前加减号</span></div><div class="line">&gt; newdata</div><div class="line">  manager     date country gender age q1 q2 q5</div><div class="line"><span class="number">1</span>       <span class="number">1</span> <span class="number">10</span>/<span class="number">24</span>/<span class="number">08</span>      US      M  <span class="number">32</span>  <span class="number">5</span>  <span class="number">4</span>  <span class="number">5</span></div><div class="line"><span class="number">2</span>       <span class="number">2</span> <span class="number">10</span>/<span class="number">28</span>/<span class="number">08</span>      US      <span class="literal">F</span>  <span class="number">45</span>  <span class="number">3</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">3</span>       <span class="number">3</span> <span class="number">10</span>/<span class="number">01</span>/<span class="number">08</span>      UK      <span class="literal">F</span>  <span class="number">25</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">4</span>       <span class="number">4</span> <span class="number">10</span>/<span class="number">12</span>/<span class="number">08</span>   China      M  <span class="number">23</span>  <span class="number">2</span>  <span class="number">4</span>  <span class="number">3</span></div><div class="line"><span class="number">5</span>       <span class="number">5</span> <span class="number">05</span>/<span class="number">01</span>/<span class="number">09</span>      UK      <span class="literal">F</span>  <span class="number">99</span>  <span class="number">1</span>  <span class="number">5</span> <span class="literal">NA</span></div></pre></td></tr></table></figure>
<h2 id="增加行">增加行</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rbind(rat.data1,rat.data1)</div><div class="line">rat.data1</div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-rbind(rat.data1,rat.data1)  rat.data1    rats glu.d1 glu.d7 1     1  11.97  12.97 2     2  12.97  13.97 3     3  27.34  25.56 4     4  23.97  23.97 5     5   6.79   5.79 6     6   5.19   6.19 7     1  11.97  12.97 8     2  12.97  13.97 9     3  27.34  25.56 10    4  23.97  23.97 11    5   6.79   5.79 12    6   5.19   6.19</p>
</blockquote>
<h2 id="删除行">删除行</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rat.data1&lt;-rat.data1[-<span class="number">8</span>,] <span class="comment">#删除第8行</span></div><div class="line">rat.data1[-c(<span class="number">1</span>,<span class="number">2</span>),] <span class="comment">#删除1，2行</span></div></pre></td></tr></table></figure>
<blockquote>
<p> rat.data1&lt;-rat.data1[-8,] #删除第8行  rat.data1[-c(1,2),] #删除1，2行    rats glu.d1 glu.d7 3     3  27.34  25.56 4     4  23.97  23.97 5     5   6.79   5.79 6     6   5.19   6.19 7     1  11.97  12.97 9     3  27.34  25.56 10    4  23.97  23.97 11    5   6.79   5.79 12    6   5.19   6.19</p>
</blockquote>
<h2 id="数据框的排序">数据框的排序</h2>
<h3 id="基于单列进行排序">基于单列进行排序</h3>
<p>排序所用的函数为sort()和order(),sort()是对元素直接进行排序，而order()则是反回排序后的元素在原来列中的位置，现在以内置的CO2数据为例说明，只取CO2的前10行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">raw_data &lt;- CO2[<span class="number">1</span>:<span class="number">10</span>,]</div><div class="line">raw_data</div><div class="line">sort(raw_data$uptake) <span class="comment">#对uptake进行排序，默认为升序</span></div><div class="line">sort(raw_data$uptake,decreasing = <span class="literal">TRUE</span>) <span class="comment"># decreasing为T时，为降序</span></div><div class="line">order.raw_data &lt;- order(raw_data$uptake);order.raw_data</div><div class="line"><span class="comment"># order的结果是说，在排序后的数据中，第1个元素位于原来的第8个位置</span></div><div class="line"><span class="comment"># 排序后的第1个数据是13.6，而13.6在原来uptake中位于第8</span></div><div class="line">raw_data$uptake[order.raw_data] <span class="comment">#这个结果与sort(raw_data$uptake)是一样的</span></div><div class="line">raw_data[order.raw_data,] <span class="comment">#按照uptake的升序对数据框进行排序</span></div></pre></td></tr></table></figure>
<blockquote>
<p> raw_data &lt;- CO2[1:10,]  raw_data    Plant   Type  Treatment conc uptake 1    Qn1 Quebec nonchilled   95   16.0 2    Qn1 Quebec nonchilled  175   30.4 3    Qn1 Quebec nonchilled  250   34.8 4    Qn1 Quebec nonchilled  350   37.2 5    Qn1 Quebec nonchilled  500   35.3 6    Qn1 Quebec nonchilled  675   39.2 7    Qn1 Quebec nonchilled 1000   39.7 8    Qn2 Quebec nonchilled   95   13.6 9    Qn2 Quebec nonchilled  175   27.3 10   Qn2 Quebec nonchilled  250   37.1  sort(raw_data<span class="math inline">\(uptake) #对uptake进行排序，默认为升序  [1] 13.6 16.0 27.3 30.4 34.8 35.3 37.1 37.2 39.2 39.7  sort(raw_data\)</span>uptake,decreasing = TRUE) # decreasing为T时，为降序  [1] 39.7 39.2 37.2 37.1 35.3 34.8 30.4 27.3 16.0 13.6  order.raw_data &lt;- order(raw_data$uptake);order.raw_data  [1]  8  1  9  2  3  5 10  4  6  7</p>
</blockquote>
<blockquote>
<p>   order的结果是说，在排序后的数据中，第1个元素位于原来的第8个位置</p>
</blockquote>
<blockquote>
<p>   排序后的第1个数据是13.6，而13.6在原来uptake中位于第8</p>
</blockquote>
<blockquote>
<p> raw_data$uptake[order.raw_data] #这个结果与sort(raw_data$uptake)是一样的  [1] 13.6 16.0 27.3 30.4 34.8 35.3 37.1 37.2 39.2 39.7  raw_data[order.raw_data,] #按照uptake的升序对数据框进行排序    Plant   Type  Treatment conc uptake 8    Qn2 Quebec nonchilled   95   13.6 1    Qn1 Quebec nonchilled   95   16.0 9    Qn2 Quebec nonchilled  175   27.3 2    Qn1 Quebec nonchilled  175   30.4 3    Qn1 Quebec nonchilled  250   34.8 5    Qn1 Quebec nonchilled  500   35.3 10   Qn2 Quebec nonchilled  250   37.1 4    Qn1 Quebec nonchilled  350   37.2 6    Qn1 Quebec nonchilled  675   39.2 7    Qn1 Quebec nonchilled 1000   39.7</p>
</blockquote>
<h3 id="基于多列的排序">基于多列的排序</h3>
<p>还以前述的数据为例说明：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">order.raw_data2 &lt;- with(raw_data,order(conc,uptake))</div><div class="line">raw_data[order.raw_data2,]</div><div class="line"></div><div class="line">order.raw_data3 &lt;- with(raw_data,order(uptake,conc))</div><div class="line">raw_data[order.raw_data3,]</div></pre></td></tr></table></figure>
<blockquote>
<p> order.raw_data2 &lt;- with(raw_data,order(conc,uptake))  raw_data[order.raw_data2,]    Plant   Type  Treatment conc uptake 8    Qn2 Quebec nonchilled   95   13.6 1    Qn1 Quebec nonchilled   95   16.0 9    Qn2 Quebec nonchilled  175   27.3 2    Qn1 Quebec nonchilled  175   30.4 3    Qn1 Quebec nonchilled  250   34.8 10   Qn2 Quebec nonchilled  250   37.1 4    Qn1 Quebec nonchilled  350   37.2 5    Qn1 Quebec nonchilled  500   35.3 6    Qn1 Quebec nonchilled  675   39.2 7    Qn1 Quebec nonchilled 1000   39.7</p>
<p> order.raw_data3 &lt;- with(raw_data,order(uptake,conc))  raw_data[order.raw_data3,]    Plant   Type  Treatment conc uptake 8    Qn2 Quebec nonchilled   95   13.6 1    Qn1 Quebec nonchilled   95   16.0 9    Qn2 Quebec nonchilled  175   27.3 2    Qn1 Quebec nonchilled  175   30.4 3    Qn1 Quebec nonchilled  250   34.8 5    Qn1 Quebec nonchilled  500   35.3 10   Qn2 Quebec nonchilled  250   37.1 4    Qn1 Quebec nonchilled  350   37.2 6    Qn1 Quebec nonchilled  675   39.2 7    Qn1 Quebec nonchilled 1000   39.7</p>
</blockquote>
<p>可以看出来，在第1种排序中， with(raw_data,order(conc,uptake))，先以order进行排序，如果order相同，则按照uptake进行排序；在第2种排序中，with(raw_data,order(uptake,conc))，先以uptake进行排序，如果uptake相同，则按conc进行排序。</p>
<h3 id="混合排序">混合排序</h3>
<p>混合排序是指某一列是升序，某一列为降序，所用到的函数是xtfrm()，其中在需要降序的列前加上铅，在升序的列前加正号，现在以raw_data数据为例说明，以conc的降序，uptake的升序进行排序，用法如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">order.raw_data4 &lt;- order(-xtfrm(raw_data$conc),+raw_data$uptake)</div><div class="line">raw_data[order.raw_data4,]</div></pre></td></tr></table></figure>
<blockquote>
<p> order.raw_data4 &lt;- order(-xtfrm(raw_data<span class="math inline">\(conc),+raw_data\)</span>uptake)  raw_data[order.raw_data4,]    Plant   Type  Treatment conc uptake 7    Qn1 Quebec nonchilled 1000   39.7 6    Qn1 Quebec nonchilled  675   39.2 5    Qn1 Quebec nonchilled  500   35.3 4    Qn1 Quebec nonchilled  350   37.2 3    Qn1 Quebec nonchilled  250   34.8 10   Qn2 Quebec nonchilled  250   37.1 9    Qn2 Quebec nonchilled  175   27.3 2    Qn1 Quebec nonchilled  175   30.4 8    Qn2 Quebec nonchilled   95   13.6 1    Qn1 Quebec nonchilled   95   16.0</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">RVDSD</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">212</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">100</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RVDSD</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>


<div class="BbeiAn-info">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018102000118" style="color:#909090;text-decoration:none;padding-left:0px;no-repeat left center" rel="nofollow">豫公网安备 41018102000118</a>	  <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->
</div>

  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共841.7k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
